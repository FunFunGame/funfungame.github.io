(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
/*
* JavaScript TimeSpan Library
*
* Copyright (c) 2010 Michael Stum, Charlie Robbins
* 
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
* 
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
* 
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/

//
// ### Time constants
//
var msecPerSecond = 1000,
    msecPerMinute = 60000,
    msecPerHour = 3600000,
    msecPerDay = 86400000;

//
// ### Timespan Parsers
//
var timeSpanWithDays = /^(\d+):(\d+):(\d+):(\d+)(\.\d+)?/,
    timeSpanNoDays = /^(\d+):(\d+):(\d+)(\.\d+)?/;

//
// ### function TimeSpan (milliseconds, seconds, minutes, hours, days)
// #### @milliseconds {Number} Number of milliseconds for this instance.
// #### @seconds {Number} Number of seconds for this instance.
// #### @minutes {Number} Number of minutes for this instance.
// #### @hours {Number} Number of hours for this instance.
// #### @days {Number} Number of days for this instance.
// Constructor function for the `TimeSpan` object which represents a length
// of positive or negative milliseconds componentized into milliseconds, 
// seconds, hours, and days.
//
var TimeSpan = exports.TimeSpan = function (milliseconds, seconds, minutes, hours, days) {
  this.msecs = 0;
  
  if (isNumeric(days)) {
    this.msecs += (days * msecPerDay);
  }
  
  if (isNumeric(hours)) {
    this.msecs += (hours * msecPerHour);
  }
  
  if (isNumeric(minutes)) {
    this.msecs += (minutes * msecPerMinute);
  }
  
  if (isNumeric(seconds)) {
    this.msecs += (seconds * msecPerSecond);
  }
  
  if (isNumeric(milliseconds)) {
    this.msecs += milliseconds;
  }
};

//
// ## Factory methods
// Helper methods for creating new TimeSpan objects
// from various criteria: milliseconds, seconds, minutes,
// hours, days, strings and other `TimeSpan` instances.
//

//
// ### function fromMilliseconds (milliseconds)
// #### @milliseconds {Number} Amount of milliseconds for the new TimeSpan instance.
// Creates a new `TimeSpan` instance with the specified `milliseconds`.
//
exports.fromMilliseconds = function (milliseconds) {
  if (!isNumeric(milliseconds)) { return }
  return new TimeSpan(milliseconds, 0, 0, 0, 0);
}

//
// ### function fromSeconds (seconds)
// #### @milliseconds {Number} Amount of seconds for the new TimeSpan instance.
// Creates a new `TimeSpan` instance with the specified `seconds`.
//
exports.fromSeconds = function (seconds) {
  if (!isNumeric(seconds)) { return }
  return new TimeSpan(0, seconds, 0, 0, 0);
};

//
// ### function fromMinutes (milliseconds)
// #### @milliseconds {Number} Amount of minutes for the new TimeSpan instance.
// Creates a new `TimeSpan` instance with the specified `minutes`.
//
exports.fromMinutes = function (minutes) {
  if (!isNumeric(minutes)) { return }
  return new TimeSpan(0, 0, minutes, 0, 0);
};

//
// ### function fromHours (hours)
// #### @milliseconds {Number} Amount of hours for the new TimeSpan instance.
// Creates a new `TimeSpan` instance with the specified `hours`.
//
exports.fromHours = function (hours) {
  if (!isNumeric(hours)) { return }
  return new TimeSpan(0, 0, 0, hours, 0);
};

//
// ### function fromDays (days)
// #### @milliseconds {Number} Amount of days for the new TimeSpan instance.
// Creates a new `TimeSpan` instance with the specified `days`.
//
exports.fromDays = function (days) {
  if (!isNumeric(days)) { return }
  return new TimeSpan(0, 0, 0, 0, days);
};

//
// ### function parse (str)
// #### @str {string} Timespan string to parse.
// Creates a new `TimeSpan` instance from the specified
// string, `str`.
//
exports.parse = function (str) {
  var match, milliseconds;
  
  function parseMilliseconds (value) {
    return value ? parseFloat('0' + value) * 1000 : 0;
  }
  
  // If we match against a full TimeSpan: 
  //   [days]:[hours]:[minutes]:[seconds].[milliseconds]?
  if ((match = str.match(timeSpanWithDays))) {
    return new TimeSpan(parseMilliseconds(match[5]), match[4], match[3], match[2], match[1]);
  }
  
  // If we match against a partial TimeSpan:
  //   [hours]:[minutes]:[seconds].[milliseconds]?
  if ((match = str.match(timeSpanNoDays))) {
    return new TimeSpan(parseMilliseconds(match[4]), match[3], match[2], match[1], 0);
  }
  
  return null;
};

//
// List of default singular time modifiers and associated
// computation algoritm. Assumes in order, smallest to greatest
// performing carry forward additiona / subtraction for each
// Date-Time component.
//
var parsers = {
  'milliseconds': {
    exp: /(\d+)milli(?:second)?[s]?/i,
    compute: function (delta, computed) {
      return _compute(delta, computed, {
        current: 'milliseconds',
        next: 'seconds', 
        max: 1000
      });
    }
  },
  'seconds': {
    exp: /(\d+)second[s]?/i,
    compute: function (delta, computed) {
      return _compute(delta, computed, {
        current: 'seconds',
        next: 'minutes', 
        max: 60
      });
    }
  },
  'minutes': {
    exp: /(\d+)minute[s]?/i,
    compute: function (delta, computed) {
      return _compute(delta, computed, {
        current: 'minutes',
        next: 'hours', 
        max: 60
      });
    }
  },
  'hours': {
    exp: /(\d+)hour[s]?/i,
    compute: function (delta, computed) {
      return _compute(delta, computed, {
        current: 'hours',
        next: 'days', 
        max: 24
      });
    }
  },
  'days': {
    exp: /(\d+)day[s]?/i,
    compute: function (delta, computed) {
      var days     = monthDays(computed.months, computed.years),
          sign     = delta >= 0 ? 1 : -1,
          opsign   = delta >= 0 ? -1 : 1,
          clean    = 0;
      
      function update (months) {
        if (months < 0) { 
          computed.years -= 1;
          return 11;
        }
        else if (months > 11) { 
          computed.years += 1;
          return 0 
        }
        
        return months;
      }
      
      if (delta) {          
        while (Math.abs(delta) >= days) {
          computed.months += sign * 1;
          computed.months = update(computed.months);
          delta += opsign * days;
          days = monthDays(computed.months, computed.years);
        }
      
        computed.days += (opsign * delta);
      }
      
      if (computed.days < 0) { clean = -1 }
      else if (computed.days > months[computed.months]) { clean = 1 }
      
      if (clean === -1 || clean === 1) {
        computed.months += clean;
        computed.months = update(computed.months);
        computed.days = months[computed.months] + computed.days;
      }
            
      return computed;
    }
  },
  'months': {
    exp: /(\d+)month[s]?/i,
    compute: function (delta, computed) {
      var round = delta > 0 ? Math.floor : Math.ceil;
      if (delta) { 
        computed.years += round.call(null, delta / 12);
        computed.months += delta % 12;
      }
      
      if (computed.months > 11) {
        computed.years += Math.floor((computed.months + 1) / 12);
        computed.months = ((computed.months + 1) % 12) - 1;
      }
      
      return computed;
    }
  },
  'years': {
    exp: /(\d+)year[s]?/i,
    compute: function (delta, computed) {
      if (delta) { computed.years += delta; }
      return computed;
    }
  }
};

//
// Compute the list of parser names for
// later use.
//
var parserNames = Object.keys(parsers);

//
// ### function parseDate (str)
// #### @str {string} String to parse into a date
// Parses the specified liberal Date-Time string according to
// ISO8601 **and**:
//
// 1. `2010-04-03T12:34:15Z+12MINUTES`
// 2. `NOW-4HOURS`
//
// Valid modifiers for the more liberal Date-Time string(s):
//
//     YEAR, YEARS
//     MONTH, MONTHS
//     DAY, DAYS
//     HOUR, HOURS
//     MINUTE, MINUTES
//     SECOND, SECONDS
//     MILLI, MILLIS, MILLISECOND, MILLISECONDS
//
exports.parseDate = function (str) {
  var dateTime = Date.parse(str),
      iso = '^([^Z]+)',
      zulu = 'Z([\\+|\\-])?',
      diff = {},
      computed,
      modifiers,
      sign;

  //
  // If Date string supplied actually conforms 
  // to UTC Time (ISO8601), return a new Date.
  //
  if (!isNaN(dateTime)) {
    return new Date(dateTime);
  }
  
  //
  // Create the `RegExp` for the end component
  // of the target `str` to parse.
  //
  parserNames.forEach(function (group) {
    zulu += '(\\d+[a-zA-Z]+)?';
  });
  
  if (/^NOW/i.test(str)) {
    //
    // If the target `str` is a liberal `NOW-*`,
    // then set the base `dateTime` appropriately.
    //
    dateTime = Date.now();
    zulu = zulu.replace(/Z/, 'NOW');
  }
  else if (/^\-/.test(str) || /^\+/.test(str)) {
    dateTime = Date.now();
    zulu = zulu.replace(/Z/, '');
  }
  else {
    //
    // Parse the `ISO8601` component, and the end
    // component from the target `str`.
    //
    dateTime = str.match(new RegExp(iso, 'i'));
    dateTime = Date.parse(dateTime[1]);
  }
  
  //
  // If there was no match on either part then 
  // it must be a bad value.
  //
  if (!dateTime || !(modifiers = str.match(new RegExp(zulu, 'i')))) {
    return null;
  }
    
  //
  // Create a new `Date` object from the `ISO8601`
  // component of the target `str`.
  //
  dateTime = new Date(dateTime);
  sign = modifiers[1] === '+' ? 1 : -1;
  
  //
  // Create an Object-literal for consistently accessing
  // the various components of the computed Date.
  //
  var computed = {
    milliseconds: dateTime.getMilliseconds(),
    seconds: dateTime.getSeconds(),
    minutes: dateTime.getMinutes(),
    hours: dateTime.getHours(),
    days: dateTime.getDate(),
    months: dateTime.getMonth(),
    years: dateTime.getFullYear()
  };
  
  //
  // Parse the individual component spans (months, years, etc)
  // from the modifier strings that we parsed from the end 
  // of the target `str`.
  //
  modifiers.slice(2).filter(Boolean).forEach(function (modifier) {
    parserNames.forEach(function (name) {
      var match;
      if (!(match = modifier.match(parsers[name].exp))) {
        return;
      }
      
      diff[name] = sign * parseInt(match[1], 10);
    })
  });
  
  //
  // Compute the total `diff` by iteratively computing 
  // the partial components from smallest to largest.
  //
  parserNames.forEach(function (name) {    
    computed = parsers[name].compute(diff[name], computed);
  });
  
  return new Date(
    computed.years,
    computed.months,
    computed.days,
    computed.hours,
    computed.minutes,
    computed.seconds,
    computed.milliseconds
  );
};

//
// ### function fromDates (start, end, abs)
// #### @start {Date} Start date of the `TimeSpan` instance to return
// #### @end {Date} End date of the `TimeSpan` instance to return
// #### @abs {boolean} Value indicating to return an absolute value
// Returns a new `TimeSpan` instance representing the difference between
// the `start` and `end` Dates.
//
exports.fromDates = function (start, end, abs) {
  if (typeof start === 'string') {
    start = exports.parseDate(start);
  }
  
  if (typeof end === 'string') {
    end = exports.parseDate(end);
  }
  
  if (!(start instanceof Date && end instanceof Date)) {
    return null;
  }
  
  var differenceMsecs = end.valueOf() - start.valueOf();
  if (abs) {
    differenceMsecs = Math.abs(differenceMsecs);
  }

  return new TimeSpan(differenceMsecs, 0, 0, 0, 0);
};

//
// ## Module Helpers
// Module-level helpers for various utilities such as:
// instanceOf, parsability, and cloning.
//

//
// ### function test (str)
// #### @str {string} String value to test if it is a TimeSpan
// Returns a value indicating if the specified string, `str`,
// is a parsable `TimeSpan` value.
//
exports.test = function (str) {
  return timeSpanWithDays.test(str) || timeSpanNoDays.test(str);
};

//
// ### function instanceOf (timeSpan)
// #### @timeSpan {Object} Object to check TimeSpan quality.
// Returns a value indicating if the specified `timeSpan` is
// in fact a `TimeSpan` instance.
//
exports.instanceOf = function (timeSpan) {
  return timeSpan instanceof TimeSpan;
};

//
// ### function clone (timeSpan)
// #### @timeSpan {TimeSpan} TimeSpan object to clone.
// Returns a new `TimeSpan` instance with the same value
// as the `timeSpan` object supplied.
//
exports.clone = function (timeSpan) {
  if (!(timeSpan instanceof TimeSpan)) { return }
  return exports.fromMilliseconds(timeSpan.totalMilliseconds());
};

//
// ## Addition
// Methods for adding `TimeSpan` instances, 
// milliseconds, seconds, hours, and days to other
// `TimeSpan` instances.
//

//
// ### function add (timeSpan)
// #### @timeSpan {TimeSpan} TimeSpan to add to this instance
// Adds the specified `timeSpan` to this instance.
//
TimeSpan.prototype.add = function (timeSpan) {
  if (!(timeSpan instanceof TimeSpan)) { return }
  this.msecs += timeSpan.totalMilliseconds();
};

//
// ### function addMilliseconds (milliseconds)
// #### @milliseconds {Number} Number of milliseconds to add.
// Adds the specified `milliseconds` to this instance.
//
TimeSpan.prototype.addMilliseconds = function (milliseconds) {
  if (!isNumeric(milliseconds)) { return }
  this.msecs += milliseconds;
};

//
// ### function addSeconds (seconds)
// #### @seconds {Number} Number of seconds to add.
// Adds the specified `seconds` to this instance.
//
TimeSpan.prototype.addSeconds = function (seconds) {
  if (!isNumeric(seconds)) { return }
  
  this.msecs += (seconds * msecPerSecond);
};

//
// ### function addMinutes (minutes)
// #### @minutes {Number} Number of minutes to add.
// Adds the specified `minutes` to this instance.
//
TimeSpan.prototype.addMinutes = function (minutes) {
  if (!isNumeric(minutes)) { return }
  this.msecs += (minutes * msecPerMinute);
};

//
// ### function addHours (hours)
// #### @hours {Number} Number of hours to add.
// Adds the specified `hours` to this instance.
//
TimeSpan.prototype.addHours = function (hours) {
  if (!isNumeric(hours)) { return }
  this.msecs += (hours * msecPerHour);
};

//
// ### function addDays (days)
// #### @days {Number} Number of days to add.
// Adds the specified `days` to this instance.
//
TimeSpan.prototype.addDays = function (days) {
  if (!isNumeric(days)) { return }
  this.msecs += (days * msecPerDay);
};

//
// ## Subtraction
// Methods for subtracting `TimeSpan` instances, 
// milliseconds, seconds, hours, and days from other
// `TimeSpan` instances.
//

//
// ### function subtract (timeSpan)
// #### @timeSpan {TimeSpan} TimeSpan to subtract from this instance.
// Subtracts the specified `timeSpan` from this instance.
//
TimeSpan.prototype.subtract = function (timeSpan) {
  if (!(timeSpan instanceof TimeSpan)) { return }
  this.msecs -= timeSpan.totalMilliseconds();
};

//
// ### function subtractMilliseconds (milliseconds)
// #### @milliseconds {Number} Number of milliseconds to subtract.
// Subtracts the specified `milliseconds` from this instance.
//
TimeSpan.prototype.subtractMilliseconds = function (milliseconds) {
  if (!isNumeric(milliseconds)) { return }
  this.msecs -= milliseconds;
};

//
// ### function subtractSeconds (seconds)
// #### @seconds {Number} Number of seconds to subtract.
// Subtracts the specified `seconds` from this instance.
//
TimeSpan.prototype.subtractSeconds = function (seconds) {
  if (!isNumeric(seconds)) { return }
  this.msecs -= (seconds * msecPerSecond);
};

//
// ### function subtractMinutes (minutes)
// #### @minutes {Number} Number of minutes to subtract.
// Subtracts the specified `minutes` from this instance.
//
TimeSpan.prototype.subtractMinutes = function (minutes) {
  if (!isNumeric(minutes)) { return }
  this.msecs -= (minutes * msecPerMinute);
};

//
// ### function subtractHours (hours)
// #### @hours {Number} Number of hours to subtract.
// Subtracts the specified `hours` from this instance.
//
TimeSpan.prototype.subtractHours = function (hours) {
  if (!isNumeric(hours)) { return }
  this.msecs -= (hours * msecPerHour);
};

//
// ### function subtractDays (days)
// #### @days {Number} Number of days to subtract.
// Subtracts the specified `days` from this instance.
//
TimeSpan.prototype.subtractDays = function (days) {
  if (!isNumeric(days)) { return }
  this.msecs -= (days * msecPerDay);
};

//
// ## Getters
// Methods for retrieving components of a `TimeSpan`
// instance: milliseconds, seconds, minutes, hours, and days.
//

//
// ### function totalMilliseconds (roundDown)
// #### @roundDown {boolean} Value indicating if the value should be rounded down.
// Returns the total number of milliseconds for this instance, rounding down
// to the nearest integer if `roundDown` is set.
//
TimeSpan.prototype.totalMilliseconds = function (roundDown) {
  var result = this.msecs;
  if (roundDown === true) {
    result = Math.floor(result);
  }
  
  return result;
};

//
// ### function totalSeconds (roundDown)
// #### @roundDown {boolean} Value indicating if the value should be rounded down.
// Returns the total number of seconds for this instance, rounding down
// to the nearest integer if `roundDown` is set.
//
TimeSpan.prototype.totalSeconds = function (roundDown) {
  var result = this.msecs / msecPerSecond;
  if (roundDown === true) {
    result = Math.floor(result);
  }
  
  return result;
};

//
// ### function totalMinutes (roundDown)
// #### @roundDown {boolean} Value indicating if the value should be rounded down.
// Returns the total number of minutes for this instance, rounding down
// to the nearest integer if `roundDown` is set.
//
TimeSpan.prototype.totalMinutes = function (roundDown) {
  var result = this.msecs / msecPerMinute;
  if (roundDown === true) {
    result = Math.floor(result);
  }
  
  return result;
};

//
// ### function totalHours (roundDown)
// #### @roundDown {boolean} Value indicating if the value should be rounded down.
// Returns the total number of hours for this instance, rounding down
// to the nearest integer if `roundDown` is set.
//
TimeSpan.prototype.totalHours = function (roundDown) {
  var result = this.msecs / msecPerHour;
  if (roundDown === true) {
    result = Math.floor(result);
  }
  
  return result;
};

//
// ### function totalDays (roundDown)
// #### @roundDown {boolean} Value indicating if the value should be rounded down.
// Returns the total number of days for this instance, rounding down
// to the nearest integer if `roundDown` is set.
//
TimeSpan.prototype.totalDays = function (roundDown) {
  var result = this.msecs / msecPerDay;
  if (roundDown === true) {
    result = Math.floor(result);
  }
  
  return result;
};

//
// ### @milliseconds
// Returns the length of this `TimeSpan` instance in milliseconds.
//
TimeSpan.prototype.__defineGetter__('milliseconds', function () {
  return this.msecs % 1000;
});

//
// ### @seconds
// Returns the length of this `TimeSpan` instance in seconds.
//
TimeSpan.prototype.__defineGetter__('seconds', function () {
  return Math.floor(this.msecs / msecPerSecond) % 60;
});

//
// ### @minutes
// Returns the length of this `TimeSpan` instance in minutes.
//
TimeSpan.prototype.__defineGetter__('minutes', function () {
  return Math.floor(this.msecs / msecPerMinute) % 60;
});

//
// ### @hours
// Returns the length of this `TimeSpan` instance in hours.
//
TimeSpan.prototype.__defineGetter__('hours', function () {
  return Math.floor(this.msecs / msecPerHour) % 24;
});

//
// ### @days
// Returns the length of this `TimeSpan` instance in days.
//
TimeSpan.prototype.__defineGetter__('days', function () {
  return Math.floor(this.msecs / msecPerDay);
});

//
// ## Instance Helpers
// Various help methods for performing utilities
// such as equality and serialization
//

//
// ### function equals (timeSpan)
// #### @timeSpan {TimeSpan} TimeSpan instance to assert equal
// Returns a value indicating if the specified `timeSpan` is equal
// in milliseconds to this instance.
//
TimeSpan.prototype.equals = function (timeSpan) {
  if (!(timeSpan instanceof TimeSpan)) { return }
  return this.msecs === timeSpan.totalMilliseconds();
};

//
// ### function toString () 
// Returns a string representation of this `TimeSpan`
// instance according to current `format`.
//
TimeSpan.prototype.toString = function () {
  if (!this.format) { return this._format() }
  return this.format(this);
};

//
// ### @private function _format () 
// Returns the default string representation of this instance.
//
TimeSpan.prototype._format = function () {
  return [
    this.days,
    this.hours,
    this.minutes,
    this.seconds + '.' + this.milliseconds
  ].join(':')
};

//
// ### @private function isNumeric (input) 
// #### @input {Number} Value to check numeric quality of.
// Returns a value indicating the numeric quality of the 
// specified `input`.
//
function isNumeric (input) {
  return input && !isNaN(parseFloat(input)) && isFinite(input);
};

//
// ### @private function _compute (delta, date, computed, options)
// #### @delta {Number} Channge in this component of the date
// #### @computed {Object} Currently computed date.
// #### @options {Object} Options for the computation
// Performs carry forward addition or subtraction for the
// `options.current` component of the `computed` date, carrying 
// it forward to `options.next` depending on the maximum value,
// `options.max`.
//
function _compute (delta, computed, options) {
  var current = options.current,
      next    = options.next,
      max     = options.max,
      round  = delta > 0 ? Math.floor : Math.ceil;
      
  if (delta) {
    computed[next] += round.call(null, delta / max);
    computed[current] += delta % max;
  }
  
  if (Math.abs(computed[current]) >= max) {
    computed[next] += round.call(null, computed[current] / max)
    computed[current] = computed[current] % max;
  }

  return computed;
}


//
// ### @private monthDays (month, year)
// #### @month {Number} Month to get days for.
// #### @year {Number} Year of the month to get days for.
// Returns the number of days in the specified `month` observing
// leap years.
//
var months = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
function monthDays (month, year) {    
  if (((year % 100 !== 0 && year % 4 === 0) 
    || year % 400 === 0) && month === 1) {
    return 29;
  }
  
  return months[month];
}
},{}],2:[function(require,module,exports){
/**
 * Created by qinning on 15/4/14.
 */
var VERSION_ASSET_ID = "@version";
var MANIFEST_ASSET_ID = "@manifest";
var AssetsManager = cc.Class.extend({
    /**
     * {jsb.AssetsManager}
     */
    _am : null,
    /**
     * {number}失败次数
     */
    _failCount : 0,
    /**
     * {number}最大错误重试次数
     */
    _maxFailCount : 1,
    ctor:function(){

    },
    purge:function() {
        if(this._am){
            this._am.release();
        }
        this._am = null;
    },

    retryDownAssets: function () {
        this._failCount = 0;
        this._maxFailCount = 5;
        if(this._am) {
            this._am.downloadFailedAssets();
        }
    },

    downLoadAssets : function(projectManifestPath,storagePath,updateCallBack,endCallBack) {
        this._failCount = 0;
        this._maxFailCount = 5;
        this._am = new jsb.AssetsManager(projectManifestPath, storagePath);
        this._am.retain();
        if (!this._am.getLocalManifest().isLoaded()) {
            endCallBack("error_local_manifest_not_loaded");
            return;
        }
        var that = this;
        var listener = new jsb.EventListenerAssetsManager(this._am, function (event) {
            switch (event.getEventCode()) {
                case jsb.EventAssetsManager.UPDATE_PROGRESSION:
                    var msg = event.getMessage();
                    cc.log("UPDATE_PROGRESSION:" + msg);
                    var assetId = event.getAssetId();
                    cc.log("assetId:"+assetId);
                    if(assetId == VERSION_ASSET_ID || assetId == MANIFEST_ASSET_ID) {
                        updateCallBack(1, "update manifest");
                    } else {
                        updateCallBack(event.getPercent(), msg);
                    }
                    break;
                case jsb.EventAssetsManager.UPDATE_FAILED:
                    cc.log("Update failed. " + event.getMessage());
                    that._failCount++;
                    if (that._failCount < that._maxFailCount) {
                        that._am.downloadFailedAssets();
                    }
                    else {
                        cc.log("Reach maximum fail count, exit update process");
                        that._failCount = 0;
                        endCallBack(event.getEventCode());
                    }
                    break;
                case jsb.EventAssetsManager.UPDATE_FINISHED:
                case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:
                    endCallBack(null);
                    break;

                case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:
                    cc.log("No local manifest file found, skip assets update.");
                    endCallBack(event.getEventCode());
                    break;
                case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:
                    endCallBack(event.getEventCode());
                    cc.log("Fail to download manifest file, update skipped.");
                    break;
                case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:
                    endCallBack(event.getEventCode());
                    cc.log("Fail to parse manifest file, update skipped.");
                    break;
                case jsb.EventAssetsManager.ERROR_UPDATING:
                    cc.log("Asset update error: " + event.getMessage());
                    endCallBack(event.getEventCode());
                    break;
                case jsb.EventAssetsManager.ERROR_DECOMPRESS:
                    cc.log(event.getMessage());
                    endCallBack(event.getEventCode());
                    break;
                default:
                    cc.log("default: " + event.getEventCode());
                    break;
            }
        });

        cc.eventManager.addListener(listener, 1);
        this._am.update();
    }
});

AssetsManager._instance = null;
AssetsManager._firstUseInstance = true;

/**
 *
 * @returns {AssetsManager}
 */
AssetsManager.getInstance = function () {
    if (AssetsManager._firstUseInstance) {
        AssetsManager._firstUseInstance = false;
        AssetsManager._instance = new AssetsManager();
    }
    return AssetsManager._instance;
};


module.exports = AssetsManager;
},{}],3:[function(require,module,exports){

var Downlaoder = cc.Class.extend({
    
    ctor: function () {
    },

    download: function (url, localStoragePath, param, callback) {
        var downloader = new jsb.Downloader();
        cc.log("Downlaoder url:" + url);
        cc.log("Downlaoder localStoragePath:" + localStoragePath);
        downloader.createDownloadFileTask(url, localStoragePath);
        downloader.setOnTaskError(function () {
            cc.log("Downlaoder setOnTaskError");
            this.delayDownload(downloader, url, localStoragePath);
        }.bind(this));
        downloader.setOnTaskProgress(function () {
            cc.log("Downlaoder setOnTaskProgress");
        });
        downloader.setOnFileTaskSuccess(function () {
            cc.log("Downlaoder setOnFileTaskSuccess");
            callback && callback(param);
        });
    },

    delayDownload: function (downloader, url, localStoragePath) {
        setTimeout(function () {
            downloader.createDownloadFileTask(url, localStoragePath);
        }.bind(this), 3000);
    }
});

Downlaoder._instance = null;
Downlaoder._firstUseInstance = true;

/**
 *
 * @returns {Downlaoder}
 */
Downlaoder.getInstance = function () {
    if (Downlaoder._firstUseInstance) {
        Downlaoder._firstUseInstance = false;
        Downlaoder._instance = new Downlaoder();
    }
    return Downlaoder._instance;
};

module.exports = Downlaoder;
},{}],4:[function(require,module,exports){
/**
 * Created by qinning on 15/4/27.
 */


var AudioEngineWrapper = {
    //Used for native
    _musicId: -1,
    _musicVolume: 1.0,
    _effectVolume: 1.0,
    _audioIdMap: {},

    useJsbAudioEngine: function() {
        return (cc.sys.isNative);
    },

    getMusicVolume: function () {
        var volume = 0;
        if (this.useJsbAudioEngine()) {
            volume = this._musicVolume;
        } else {
            volume = cc.audioEngine.getMusicVolume();
        }
        return volume;
    },

    setMusicVolume: function (volume) {
        if (this.useJsbAudioEngine()) {
            this._musicVolume = volume;
            jsb.AudioEngine.setVolume(this._musicId, volume);
        } else {
            cc.audioEngine.setMusicVolume(volume);
        }
    },

    getEffectsVolume: function () {
        var volume;
        if (this.useJsbAudioEngine()) {
            volume = this._effectVolume;
        } else {
            volume = cc.audioEngine.getEffectsVolume();
        }
        return volume;
    },

    setEffectsVolume: function (volume) {
        if (this.useJsbAudioEngine()) {
            this._effectVolume = volume;
            var audioIds = Object.keys(this._audioIdMap);
            audioIds.forEach (function (audioId) {
                jsb.AudioEngine.setVolume(parseInt(audioId), volume);
            });
        } else {
            cc.audioEngine.setEffectsVolume(volume);
        }
    },

    playEffect: function (url, loop) {
        var audioId;
        if (this.useJsbAudioEngine()) {
            audioId = jsb.AudioEngine.play2d(url, loop, this._effectVolume);
            this._audioIdMap[audioId] = audioId;
        } else {
            audioId = cc.audioEngine.playEffect(url, loop);
        }
        return audioId;
    },

    stopEffect: function (audioId) {
        if (this.useJsbAudioEngine()) {
            this._nativeStopAudio(audioId);
            delete this._audioIdMap[audioId];
        } else {
            cc.audioEngine.stopEffect(audioId);
        }
    },

    stopAllEffects: function () {
        if (this.useJsbAudioEngine()) {
            var audioIds = Object.keys(this._audioIdMap);
            var self = this;
            audioIds.forEach(function (audioId) {
                self._nativeStopAudio(audioId);
            });
            this._audioIdMap = {};
        } else {
            cc.audioEngine.stopAllEffects();
        }
    },

    playMusic: function (url, loop) {
        if (this.useJsbAudioEngine()) {
            if (-1 !== this._musicId) {
                this._nativeStopAudio(this._musicId);
            }
            this._musicId = jsb.AudioEngine.play2d(url, loop, this._musicVolume);
        } else {
            cc.audioEngine.playMusic(url, loop);
        }
    },

    isMusicPlaying: function () {
        var result;
        if (this.useJsbAudioEngine()) {
            result = (jsb.AudioEngine.getState(this._musicId) === 1);
        } else {
            result = cc.audioEngine.isMusicPlaying();
        }
        return result;
    },

    resumeMusic: function () {
        if (this.useJsbAudioEngine()) {
            jsb.AudioEngine.resume(this._musicId);
        } else {
            cc.audioEngine.resumeMusic();
        }
    },

    pauseMusic: function () {
        if (this.useJsbAudioEngine()) {
            jsb.AudioEngine.pause(this._musicId);
        } else {
            cc.audioEngine.pauseMusic();
        }
    },

    _nativeStopAudio: function (audioId) {
        jsb.AudioEngine.stop(audioId);
    },

    stopMusic: function () {
        if (this.useJsbAudioEngine()) {
            this._nativeStopAudio(this._musicId);
            this._musicId = -1;
        } else {
            cc.audioEngine.stopMusic();
        }
    },

    preloadEffect: function (effectName) {
        if (this.useJsbAudioEngine()) {
            jsb.AudioEngine.preload(effectName);
        }
    },

    unloadEffect: function (effectName) {
        if (this.useJsbAudioEngine()) {
            jsb.AudioEngine.uncache(effectName);
        }
    }
};

var ACTION_TYPE = {
    ACTION_NULL: 0,
    ACTION_PAUSE: 1,
    ACTION_RESUME: 2
};

var PLAY_TYPE = {
    PLAY_TYPE_NORMAL: 0,
    PLAY_TYPE_FADE_OUT_FADE_IN: 1
};

var AudioPlayer = cc.Class.extend({
    lastMusicVolume: 0,
    suffix: null,
    effectMap: null,
    playType: PLAY_TYPE.PLAY_TYPE_NORMAL,
    actionType: ACTION_TYPE.ACTION_NULL,
    musicName: null,
    loop: false,
    ctor: function () {
        if (cc.sys.os === cc.sys.OS_ANDROID) {
            this.suffix = "res/audio_ogg/%s.ogg";
        } else {
            this.suffix = "res/audio_mp3/%s.mp3";
        }
        this.effectMap = {};
        var isMusicOn = this.isMusicOn();
        this.lastMusicVolume = 1;
        this.setMusicOn(isMusicOn);
    },

    beginSchedule: function () {
        cc.director.getScheduler().scheduleCallbackForTarget(this, this.update, 0.1, cc.REPEAT_FOREVER, 0, false);
    },

    stopSchedule: function () {
        cc.director.getScheduler().unscheduleCallbackForTarget(this, this.update);
    },

    update: function (dt) {
        dt *= 0.5;
        var isFinish = false;
        var volume = cc.audioEngine.getMusicVolume();
        if (this.playType == PLAY_TYPE.PLAY_TYPE_FADE_OUT_FADE_IN) {
            if (volume > 0.001) {
                if (this.actionType == ACTION_TYPE.ACTION_PAUSE) {
                    volume -= dt;
                    if (volume < 0.001) {
                        volume = 0.01;
                        this.playMusicByKey(this.musicName, this.loop);
                        this.actionType = ACTION_TYPE.ACTION_RESUME;
                    }
                    cc.audioEngine.setMusicVolume(volume);
                } else if (this.actionType == ACTION_TYPE.ACTION_RESUME) {
                    volume += dt;
                    if (volume > 0.99) {
                        volume = 0.99;
                        isFinish = true;
                    }
                    cc.audioEngine.setMusicVolume(volume);
                }
            } else {
                this.playMusicByKey(this.musicName, this.loop);
            }
            if (isFinish) {
                this.actionType = ACTION_TYPE.ACTION_NULL;
                this.playType = PLAY_TYPE.PLAY_TYPE_NORMAL;
                this.stopSchedule();
            }
        } else {
            if (volume > 0.001) {
                if (this.actionType == ACTION_TYPE.ACTION_PAUSE) {
                    volume -= dt;
                    if (volume < 0.001) {
                        volume = 0.01;
                        isFinish = true;
                        this.pauseMusic();
                    }
                    cc.audioEngine.setMusicVolume(volume);
                } else if (this.actionType == ACTION_TYPE.ACTION_RESUME) {
                    volume += dt;
                    if (volume > 0.99) {
                        volume = 0.99;
                        isFinish = true;
                    }
                    cc.audioEngine.setMusicVolume(volume);
                }
            } else {
                isFinish = true;
            }
            if (isFinish) {
                this.actionType = ACTION_TYPE.ACTION_NULL;
                this.stopSchedule();
            }
        }
    },

    playEffectByKey: function (effectName, loop) {
        if (!this.isEffectOn()) {
            return;
        }
        var fileName = game.utils.sprintf(this.suffix, effectName);
        var key = "";
        if (cc.sys.isNative) {
            if (jsb.fileUtils.isFileExist(fileName)) {
                key = AudioEngineWrapper.playEffect(fileName, loop);
            } else {
                cc.log(game.utils.sprintf("effect file %s not found", fileName));
            }
        } else {
            if (cc.loader.getRes(fileName)) {
                key = AudioEngineWrapper.playEffect(fileName, loop);
            }
        }
        if (key) {
            this.effectMap[fileName] = key;
        }
    },

    playMusicByKey: function (musicName, loop) {
        this.actionType = ACTION_TYPE.ACTION_NULL;
        this.playType = PLAY_TYPE.PLAY_TYPE_NORMAL;
        if (this.isMusicOn()) {
            if (this.lastMusicVolume != 0) {
                AudioEngineWrapper.setMusicVolume(this.lastMusicVolume);
            } else {
                AudioEngineWrapper.setMusicVolume(1);
            }
        }
        var fileName = game.utils.sprintf(this.suffix, musicName);
        if (cc.sys.isNative) {
            if (jsb.fileUtils.isFileExist(fileName)) {
                AudioEngineWrapper.playMusic(fileName, loop);
            } else {
                cc.log(game.utils.sprintf("music file %s not found", fileName));
            }
        } else {
            if (cc.loader.getRes(fileName)) {
                AudioEngineWrapper.playMusic(fileName, loop);
            }
        }
    },

    isPlayingMusic: function () {
        return AudioEngineWrapper.isMusicPlaying();
    },

    resumeMusic: function () {
        AudioEngineWrapper.resumeMusic();
    },

    resumeMusicSlowly: function () {
        var volume = AudioEngineWrapper.getMusicVolume();
        if (volume < 0.0001 || volume >= 0.99) {
            return;
        }
        if (this.actionType == ACTION_TYPE.ACTION_NULL) {
            this.beginSchedule();
        }
        AudioEngineWrapper.setMusicVolume(0.01);
        this.resumeMusic();
        this.actionType = ACTION_TYPE.ACTION_RESUME;
    },

    stopMusic: function () {
        AudioEngineWrapper.stopMusic();
    },

    stopEffect: function (effectName) {
        var fileName = game.utils.sprintf(this.suffix, effectName);
        var effectKey = this.effectMap[fileName];
        if (effectKey) {
            AudioEngineWrapper.stopEffect(effectKey);
            delete this.effectMap[fileName];
        }
    },

    stopAllEffects: function () {
        AudioEngineWrapper.stopAllEffects();
    },

    isEffectOn: function () {
        var isOn = game.storageController.getItem("effect_on", "true");
        if (isOn == "true") {
            return true;
        }
        return false;
    },

    isMusicOn: function () {
        var isOn = game.storageController.getItem("music_on", "true");
        if (isOn == "true") {
            return true;
        }
        return false;
    },

    isVibrateOn: function () {
        var isOn = game.storageController.getItem("vibrate_on", "true");
        if (isOn == "true") {
            return true;
        }
        return false;
    },

    pauseMusic: function () {
        AudioEngineWrapper.pauseMusic();
    },

    pauseMusicSlowly: function () {
        if (!this.isPlayingMusic()) {
            return;
        }
        if (AudioEngineWrapper.getMusicVolume() < 0.0001) {
            return;
        }
        if (this.actionType == ACTION_TYPE.ACTION_NULL) {
            this.beginSchedule();
        }
        //AudioEngineWrapper.setMusicVolume(0.99);
        this.actionType = ACTION_TYPE.ACTION_PAUSE;
    },

    playMusicSlowlyByKey: function (musicName, loop) {
        if (!this.isPlayingMusic()) {
            this.playMusicByKey(musicName, loop);
            return;
        }

        this.playType = PLAY_TYPE.PLAY_TYPE_FADE_OUT_FADE_IN;
        this.musicName = musicName;
        this.loop = loop;

        if (this.actionType == ACTION_TYPE.ACTION_NULL) {
            this.beginSchedule();
        }
        this.actionType = ACTION_TYPE.ACTION_PAUSE;
    },
    
    setEffectOn: function (isOn) {
        game.storageController.setItem("effect_on", "" + isOn);
    },

    setVibrateOn: function (isOn) {
        game.storageController.setItem("vibrate_on", "" + isOn);
    },

    setMusicOn: function (isOn) {
        if (isOn) {
            if (this.lastMusicVolume != 0) {
                AudioEngineWrapper.setMusicVolume(this.lastMusicVolume);
            } else {
                AudioEngineWrapper.setMusicVolume(1);
            }
        } else {
            this.lastMusicVolume = AudioEngineWrapper.getMusicVolume();
            AudioEngineWrapper.setMusicVolume(0);
        }
        game.storageController.setItem("music_on", "" + isOn);
    },

    setMusicVolume: function (volume) {
        if (this.isMusicOn()) {
            AudioEngineWrapper.setMusicVolume(volume);
        }
    },

    preloadEffect: function (effectName) {
        var fileName = game.utils.sprintf(this.suffix, effectName);
        cc.log("preload effect:" + fileName);
        AudioEngineWrapper.preloadEffect(fileName);
    },

    unloadEffect: function (effectName) {
        var fileName = game.utils.sprintf(this.suffix, effectName);
        cc.log("unload effect:" + fileName);
        AudioEngineWrapper.unloadEffect(fileName);
    },

    vibrateShort: function () {
        if (!this.isVibrateOn()) {
            return;
        }
        if (cc.sys.isNative) {
            if (cc.sys.os === cc.sys.OS_ANDROID) {
                return;
            }
            jsb_dp.oneSdkBridge.vibrateShort();
        }
    },

    vibrateLong: function () {
        if (!this.isVibrateOn()) {
            return;
        }
        if (cc.sys.isNative) {
            if (cc.sys.os === cc.sys.OS_ANDROID) {
                return;
            }
            jsb_dp.oneSdkBridge.vibrateLong();
        }
    }
});

AudioPlayer._instance = null;
AudioPlayer._firstUseInstance = true;

/**
 *
 * @returns {AudioPlayer}
 */
AudioPlayer.getInstance = function () {
    if (AudioPlayer._firstUseInstance) {
        AudioPlayer._firstUseInstance = false;
        AudioPlayer._instance = new AudioPlayer();
    }
    return AudioPlayer._instance;
};

module.exports = AudioPlayer;
},{}],5:[function(require,module,exports){
var GameBridge = {
    getMenuScene: function () {
        var MenuScene = require("../../many_bricks/scene/MenuScene");
        return new MenuScene();
    },

    getConfig: function () {
        return require("../../many_bricks/config/Config");
    },

    getPopupMan: function () {
        return require("../../many_bricks/model/PopupMan");
    },

    getConfigMan: function () {
        return require("../../many_bricks/config/ConfigMan").getInstance();
    },

    getLoadingScene: function () {
        var LoadingScene = require("../../many_bricks/scene/LoadingScene");
        return new LoadingScene();
    },

    getGameMan: function () {
        var GameMan = require("../../many_bricks/model/GameMan");
        return GameMan.getInstance();
    },

    getAdsHelper: function () {
        var AdsHelper = require("../../many_bricks/model/AdsHelper");
        return AdsHelper.getInstance();
    },

    getChallengeMan: function () {
        var ChallengeMan = require("../../many_bricks/model/ChallengeMan");
        return ChallengeMan.getInstance();
    },

    getActivityTaskType: function () {
        return require("../../many_bricks/enum/ActivityTaskType");
    },

    getActivityMan: function () {
        var ActivityMan = require("../../many_bricks/model/ActivityMan");
        return ActivityMan.getInstance();
    },

    getABTestType: function () {
        var ABTestType = require("../../many_bricks/enum/ABTestType");
        return ABTestType;
    },

    getStoreMan: function () {
        var StoreHelper = require("../../many_bricks/model/StoreHelper");
        return StoreHelper.getInstance();
    }
};

module.exports = GameBridge;
},{"../../many_bricks/config/Config":51,"../../many_bricks/config/ConfigMan":52,"../../many_bricks/enum/ABTestType":152,"../../many_bricks/enum/ActivityTaskType":153,"../../many_bricks/model/ActivityMan":170,"../../many_bricks/model/AdsHelper":171,"../../many_bricks/model/ChallengeMan":172,"../../many_bricks/model/GameMan":173,"../../many_bricks/model/PopupMan":175,"../../many_bricks/model/StoreHelper":178,"../../many_bricks/scene/LoadingScene":183,"../../many_bricks/scene/MenuScene":184}],6:[function(require,module,exports){
/**
 * Created by qinning on 15/4/23.
 */
var Utils = require("../util/Utils");

var BaseCCBController = function() {
};

BaseCCBController.prototype.onDidLoadFromCCB = function() {
    var self = this;
    var oldOnEnter = this.rootNode["onEnter"];
    this.rootNode["onEnter"] = function() {
        if(cc.isFunction(oldOnEnter)){
            oldOnEnter.apply(self.rootNode, arguments);
        }
        self.onEnter();
    };
    var oldOnExit = this.rootNode["onExit"];
    this.rootNode["onExit"] = function() {
        if (cc.isFunction(oldOnExit)) {
            oldOnExit.apply(self.rootNode, arguments);
        }
        self.onExit();
    };
    this._visitNodes();
};

BaseCCBController.prototype.onEnter = function() {
};

BaseCCBController.prototype.onExit = function() {
};

function setScaleWithParentSize(label) {
    cc.log("setScaleWithParentSize");
    var parent = label.getParent();
    var parentSize = parent.getContentSize();
    var fontSize = label.getContentSize();

    if (!label.__origin_scale) {
        label.__origin_scale = {
            x: label.getScaleX(),
            y: label.getScaleY()
        };
    }

    var size = {
        width : fontSize.width * label.__origin_scale.x,
        height : fontSize.height * label.__origin_scale.y
    };

    // a clean hacking, save us to calc the label height manually. :]
    // parentSize.height *= label.__origin_scale.y;

    if (size.width > parentSize.width || size.height > parentSize.height) {
        var x = Math.min(parentSize.width / size.width, 1) * label.__origin_scale.x;
        var y = Math.min(parentSize.height / size.height, 1) * label.__origin_scale.y;

        var scale = Math.min(x, y);
        label.setScale(scale);
    } else {
        //maybe reused, reset origin size
        label.setScale(label.__origin_scale.x);
    }
}

BaseCCBController.prototype._visitNodes = function () {
    var TouchedNode = require("../ext/TouchedNode");
    Utils.walkNode(this.rootNode, function(nd) {
        if (nd.___visited) {
            return true;
        }
        nd.___visited = true;
        if (!game.config.menuNoScale) {
            var isMenuItem = Utils.isNodeMenuItem(nd);
            if (isMenuItem || (Utils.isNodeButton(nd) && nd.zoomOnTouchDown)) {
                if (nd.zoomOnTouchDown) {
                    nd.zoomOnTouchDown = false;
                }
                var node = new TouchedNode(isMenuItem);
                nd.addChild(node);
            }
        }

        if (nd.getString != null && nd.setString != null) {
            var parent = nd.getParent();
            //cc.log("_visitNodes tag:" + parent.getTag());
            if (parent && parent.getTag() === 79) {
                var isBMFont = false;
                if(Utils.isLabelBMFont(nd)) {
                    isBMFont = true;
                }
                //cc.log("_visitNodes nd._className:" + nd._className);
                //cc.log("_visitNodes isBMFont:" + isBMFont);
                if(isBMFont) {
                    if (cc.sys.isNative) {
                        //cc.log("_visitNodes 2");
                        // maybe repeat call in onEnter
                        if (!nd.__origin_setstring) {
                            nd.__origin_setstring = nd.setString;
                            nd.setString = function(newString) {
                                this.__origin_setstring(newString);
                                // here we start to hack
                                setScaleWithParentSize(this);
                            }.bind(nd);
                        }
                    } else {
                        nd.setString = function(newString, needUpdateLabel) {
                            // origin code copied from CCLabelBMFont.js setString

                            newString = String(newString);
                            if (needUpdateLabel == null)
                                needUpdateLabel = true;
                            if (newString == null || !cc.isString(newString))
                                newString = newString + "";

                            //this._initialString = newString;
                            this._setString(newString, needUpdateLabel);

                            // here we start to hack
                            // set the dimension according to it's parent who has a tag 79
                            // needUpdateLabel == true, it prevents the loop been called recursively.
                            if (needUpdateLabel == true) {
                                setScaleWithParentSize(this);
                            }

                        }.bind(nd);
                    }
                }
            }

            var str = nd.getString();
            var searchStr = "&key.";
            if (str.substr(0, searchStr.length) == searchStr) {
                var key = str.substr(searchStr.length);
                var value = _(key);
                nd.setString(value);
            }
        }

        return true;
    });
};

module.exports = BaseCCBController;
},{"../ext/TouchedNode":17,"../util/Utils":38}],7:[function(require,module,exports){
var EventsName = require("../../many_bricks/events/EventsName");

var CrossAdsController = function () {
    BaseCCBController.call(this);

    this.lbAdsTitle = null;
    this.lbAdsContent = null;
    this.lbInstall = null;

    this.btnAd = null;

    this.config = null;
};

game.utils.inherits(CrossAdsController, BaseCCBController);

CrossAdsController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
};

CrossAdsController.prototype.initWith = function (config, size) {
    this.config = config;
    this.size = size;
    // var localPath = jsb.fileUtils.getWritablePath() + "/cross-video-" + config.id + ".mp4";
    // cc.log("CrossAdsController:localPath:" + localPath);
    // var video = game.utils.createVideoAd(size, cc.p(0, 0), cc.p(0.5, 0.5), localPath);
    // this.rootNode.addChild(video);
    // this.lbAdsTitle.setString(config.name);
    // this.lbAdsContent.setString(config.desc);
    // this.video = video;

    this.refresh();
};

CrossAdsController.prototype.refresh = function () {
    var localPath = jsb.fileUtils.getWritablePath() + "/cross-video-" + this.config.id + ".mp4";
    if (!this.video) {
        this.video = game.utils.createVideoAd(this.size, cc.p(0, 0), cc.p(0.5, 0.5), localPath);
        this.rootNode.addChild(this.video);
    } else {
        if (localPath !== this.video.getURL()) {
            this.video.setURL(localPath);
        } else {
            cc.log("url is same with before");
        }
    }
    this.lbAdsTitle.setString(this.config.name);
    this.lbAdsContent.setString(this.config.desc);
    game.analyseManager.trackEvent("CrossPromAdShow", {"id": this.config.id});
};

CrossAdsController.prototype.onAdsClicked = function () {
    AudioHelper.playBtnSound();
    game.analyseManager.trackEvent("CrossPromAdClick", {"id": this.config.id});
    cc.sys.openURL(this.config.getDownloadUrl());
};

CrossAdsController.prototype.hideVideo = function () {
    if (this.video) {
        this.video.visible = false;
        this.video.stop();
    }
};

CrossAdsController.prototype.showVideo = function (config) {
    this.config = config;
    this.refresh();
    this.video.visible = true;
    this.video.seekTo(0);
    this.video.play();
};

CrossAdsController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/cross_ads_view.ccbi", null, "CrossAdsController", new CrossAdsController(), true);
    return node;
};

module.exports = CrossAdsController;
},{"../../many_bricks/events/EventsName":169}],8:[function(require,module,exports){
/**
 * Created by qinning on 2017/8/29.
 */


var CrossPromController = function () {
    BaseCCBController.call(this);
    this._crossPromPic = null;

    this._corssPromConfig = null;
};

game.utils.inherits(CrossPromController, BaseCCBController);

CrossPromController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);

    if (this._infoLabel) {
        if (game.local.isChinese()) {
            this._infoLabel.setString("马上玩");
        } else {
            this._infoLabel.setString("Play");
        }
    }
};

CrossPromController.prototype.closeClicked = function (sender) {
    AudioHelper.playBtnSound();
    this.close();
};

CrossPromController.prototype.downloadClicked = function (sender) {
    AudioHelper.playBtnSound();
    cc.sys.openURL(this._corssPromConfig.downloadUrl);
    this.close();
};

CrossPromController.prototype.initWith = function (config, texture) {
    this._corssPromConfig = config;
    this._crossPromPic.setTexture(texture);
};

CrossPromController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode);
};

CrossPromController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

CrossPromController.createFromCCB = function(ccbName) {
    var node = game.utils.loadNodeFromCCB(ccbName, null, "CrossPromController", new CrossPromController());
    return node;
};

module.exports = CrossPromController;
},{}],9:[function(require,module,exports){

var NumberAnimation = cc.Class.extend({
    animing: false,
    startNum: 0,
    endNum: 0,
    step: 0,
    time: 0.8,
    label: null,
    endCallback: null,
    prefix: "",

    ctor: function (label, prefix) {
        this.label = label;
        if (prefix) {
            this.prefix = prefix;
        }
    },

    playNumAnim: function (startNum, endNum, endCallback) {
        this.animing = true;
        this.startNum = startNum;
        this.endNum = endNum;
        this.elapsedTime = 0;
        this.step = (this.endNum - this.startNum) / this.time;
        this.endCallback = endCallback;
    },

    update: function (dt) {
        if (this.animing) {
            this.elapsedTime += dt;
            cc.log("number:" + (this.startNum + this.step * this.elapsedTime));
            this.label.setString(this.prefix + Math.floor(this.startNum + this.step * this.elapsedTime));
            if (this.elapsedTime >= this.time) {
                this.label.setString(this.prefix + this.endNum);
                this.animing = false;
                this.endCallback && this.endCallback();
            }
        }
    },

    destroy: function () {
        this.label = null;
    }

});

module.exports = NumberAnimation;
},{}],10:[function(require,module,exports){
/**
 * Created by qinning on 2017/1/23.
 */

var PaymentInfo = function() {
    this.purchaseId = null;
    this.productId = null;
    this.receipt = null;
    this.signature = null;

    this.info = "";
};

PaymentInfo.prototype.unmarshal = function(jsonObj) {
    this.purchaseId = jsonObj["purchaseId"] || "";
    this.productId = jsonObj["productId"] || "";
    this.receipt = jsonObj["receipt"] || "";
    this.signature = jsonObj["signature"] || "";
    this.info = jsonObj["info"] || "";
};

module.exports = PaymentInfo;
},{}],11:[function(require,module,exports){
/**
 * Created by oye on 15-5-17.
 */
var PlayerInfo = function(){
    this.playerId = "";
    this.bestScore = 0;
    this.removedAds = false;
    this.level = 0;
    this.progress = 0;
    this.levelMap = null;
    this.rated = false;
};

PlayerInfo.prototype.unmarshall = function (json) {
    this.playerId = json["playerId"];
    this.bestScore = json["bestScore"] || 0;
    this.removedAds = json["removedAds"] || false;
    this.level = json["level"] || 1;
    this.progress = json["progress"] || 0;
    this.levelMap = json["levelMap"] || {};
    this.rated = json["rated"] || false;
};

PlayerInfo.createDefault = function () {
    var playerInfo = new PlayerInfo();
    playerInfo.hintsCount = 5;
    playerInfo.bestScore = 0;
    playerInfo.removedAds = false;
    playerInfo.level = 1;
    playerInfo.progress = 0;
    playerInfo.levelMap = {};
    playerInfo.rated = false;
    return playerInfo;
};

module.exports = PlayerInfo;

},{}],12:[function(require,module,exports){
/**
 * Created by qinning on 2017/1/23.
 */

var ProductInfo = function () {
    this.productId = 0;
    this.price = 0;
    this.description = null;
    this.title = null;
};

ProductInfo.prototype.unmarshal = function (jsonObj) {
    this.productId = jsonObj["productId"];
    this.price = jsonObj["price"];
    this.description = jsonObj["description"];
    this.title = jsonObj["title"];
};

module.exports = ProductInfo;
},{}],13:[function(require,module,exports){
var AdsPlace = {
    Pass: 1,
    Home: 2,
    BackGround: 3,
    Refresh: 4,
    FirstEnter: 5,
    Num: 5
};

AdsPlace.getName = function (place) {
    switch (place) {
        case AdsPlace.Pass:
            return "pass";
        case AdsPlace.Home:
            return "home";
        case AdsPlace.BackGround:
            return "background";
        case AdsPlace.Refresh:
            return "refresh";
        case AdsPlace.FirstEnter:
            return "first_enter";
        default:
            return "unknown";
    }
};

module.exports = AdsPlace;
},{}],14:[function(require,module,exports){
/**
 * Created by qinning on 2017/1/23.
 */

var PaymentCode = {
    PAYMENT_CODE_SUCCESS: 0,
    PAYMENT_CODE_FAIL: 1
};

module.exports = PaymentCode;
},{}],15:[function(require,module,exports){
/**
 * Created by alanmars on 15/4/17.
 */
var EventPackage = cc.Class.extend({
    callback: null,
    target: null,
    listener: null,

    ctor: function (callback, target, listener) {
        this.callback = callback;
        this.target = target;
        this.listener = listener;
    }
});

var EventUserData = cc.Class.extend({
    userData: null,

    ctor: function (userData, target, listener) {
        this.userData = userData;
    },

    getUserData: function() {
        return this.userData;
    }
});
var EventDispatcher = (function () {
    var instance;

    function createInstance() {
        var listenersMap = {};
        var listenersCustomMap = {};
        return {
            /**
             * @param {string} eventName
             * @param {function} callback
             * @param {object} target
             */
            addEventListener: function (eventName, callback, target) {

                var shouldAdd = true;
                var eventPackages = listenersMap[eventName];
                if (cc.isUndefined(eventPackages)) {
                    eventPackages = [];
                    listenersMap[eventName] = eventPackages;
                }
                else {
                    for (var i = 0; i < eventPackages.length; ++i) {
                        var eventPackage = eventPackages[i];
                        if (eventPackage.callback === callback && eventPackage.target === target) {
                            shouldAdd = false;
                            break;
                        }
                    }
                }

                if (shouldAdd) {
                    eventPackages.push(new EventPackage(callback, target, null));
                }
            },

            /**
             * @param {string} eventName
             * @param {function} callback
             * @param {object} target
             */
            removeEventListener: function (eventName, callback, target) {
                if (listenersMap[eventName]) {
                    /**
                     * @type {Array.<EventPackage>}
                     */
                    var eventPackages = listenersMap[eventName];
                    if (!cc.isUndefined(eventPackages) && eventPackages.length > 0) {
                        var newPackages = [];
                        for (var i = 0; i < eventPackages.length; ++i) {
                            /**
                             * @type {EventPackage}
                             */
                            var eventPackage = eventPackages[i];
                            if (eventPackage.callback === callback && eventPackage.target === target) {
                                //cc.eventManager.removeListener(eventPackage.listener);
                            }
                            else {
                                newPackages.push(eventPackage);
                            }
                        }
                        listenersMap[eventName] = newPackages;
                    }
                }
            },

            /**
             * @param {string} eventName
             * @param {object} userData
             */
            dispatchEvent: function (eventName, userData) {
                if (listenersMap[eventName]) {
                    var eventPackages = listenersMap[eventName];
                    if (!cc.isUndefined(eventPackages) && eventPackages.length > 0) {
                        var eventData = new EventUserData(userData);
                        for (var i = 0; i < eventPackages.length; ++i) {
                            var eventPackage = eventPackages[i];
                            if (eventPackage.callback != null) {
                                eventPackage.callback.call(eventPackage.target, eventData);
                            }
                        }
                    }
                }
            },

            /**
             * @param {string} eventName
             * @param {function} callback
             * @param {object} target
             */
            addCustomEventListener: function (eventName, callback, target) {
                var eventListener = cc.eventManager.addCustomListener(eventName, function (event) {
                    callback.call(target, event);
                });

                var shouldAdd = true;
                var eventPackages = listenersCustomMap[eventName];
                if (cc.isUndefined(eventPackages)) {
                    eventPackages = [];
                    listenersCustomMap[eventName] = eventPackages;
                }
                else {
                    for (var i = 0; i < eventPackages.length; ++i) {
                        var eventPackage = eventPackages[i];
                        if (eventPackage.callback === callback && eventPackage.target === target) {
                            shouldAdd = false;
                            break;
                        }
                    }
                }

                if (shouldAdd) {
                    eventPackages.push(new EventPackage(callback, target, eventListener));
                }
            },

            /**
             * @param {string} eventName
             * @param {function} callback
             * @param {object} target
             */
            removeCustomEventListener: function (eventName, callback, target) {
                if (listenersCustomMap[eventName]) {
                    /**
                     * @type {Array.<EventPackage>}
                     */
                    var eventPackages = listenersCustomMap[eventName];
                    if (!cc.isUndefined(eventPackages) && eventPackages.length > 0) {
                        var newPackages = [];
                        for (var i = 0; i < eventPackages.length; ++i) {
                            /**
                             * @type {EventPackage}
                             */
                            var eventPackage = eventPackages[i];
                            if (eventPackage.callback === callback && eventPackage.target === target) {
                                cc.eventManager.removeListener(eventPackage.listener);
                            }
                            else {
                                newPackages.push(eventPackage);
                            }
                        }
                        listenersCustomMap[eventName] = newPackages;
                    }
                }
            },

            /**
             * @param {string} eventName
             * @param {object} userData
             */
            dispatchCustomEvent: function (eventName, userData) {
                cc.eventManager.dispatchCustomEvent(eventName, userData);
            }
        };
    }

    return {
        getInstance: function () {
            if (!instance) {
                instance = createInstance();
            }
            return instance;
        }
    };
})();

module.exports = EventDispatcher;
},{}],16:[function(require,module,exports){
/**
 * Created by qinning on 15/7/2.
 */
cc.TABLEVIEW_FILL_LEFT_RIGHT = 0;
cc.TABLEVIEW_FILL_RIGHT_LEFT = 0;

/**
 * Sole purpose of this delegate is to single touch event in this version.
 */
cc.MultiColTableViewDelegate = cc.Class.extend(/** @lends cc.MultiColTableViewDelegate# */{
    gridTouched:function(table,grid){
    }
});

/**
 * Data source that governs table backend data.
 */
cc.MultiColTableViewDataSource = cc.Class.extend(/** @lends cc.TableViewDataSource# */{
    gridAtIndex:function(table,idx){
       return null;
    },
    numberOfCellsInTableView:function(table){
        return 0;
    },
    numberOfGridsInCell:function(table, idx){
        return 0;
    },
    gridSizeForTable:function(table, idx){
        return cc.size(0,0);
    }
});

cc.MultiColTableView = cc.LayerColor.extend({
    _multiTableViewDataSource: null,
    _multiTableViewDelegate: null,
    _horizontalOrder: cc.TABLEVIEW_FILL_LEFT_RIGHT,
    _gridsFreed: null,
    _curTouchLocation: null,

    _tableView: null,
    _touchNode: null,
    _gridCells: null,

    /**
     * @param dataSource
     * @param {cc.Size} size
     * @param container
     */
    ctor: function (dataSource, size, container) {
        this._super(cc.color(0, 0, 255, 0), size.width, size.height);
        this._gridsFreed = [];
        this._gridCells = {};
        this.setMultiTableViewDataSource(dataSource);
        this._tableView = new cc.TableView(this, size, container);
        this._tableView.setDelegate(this);
        this.addChild(this._tableView);
        this._touchNode = new cc.Node();
        this._tableView.addChild(this._touchNode,1);
    },

    onEnter: function () {
        this._super();
        cc.eventManager.addListener({
            event: cc.EventListener.TOUCH_ONE_BY_ONE,
            swallowTouches: false,
            onTouchBegan: this.onTouchBegan.bind(this)
        }, this._touchNode);
    },

    dequeueGrid: function () {
        if (this._gridsFreed.length == 0) {
            return null;
        } else {
            var grid = this._gridsFreed.shift();
            this._autoRelease(grid);
            return grid;
        }
    },

    _releaseCB: function () {
        this.release();
    },

    _autoRelease: function (obj) {
        var running = obj._running === undefined ? false : !obj._running;
        cc.director.getScheduler().schedule(this._releaseCB, obj, 0, 0, 0, running, obj.__instanceId);
    },

    tableCellSizeForIndex: function (table, idx) {
        var size = this.getMultiTableViewDataSource().gridSizeForTable(this, idx);
        if (table.getDirection() === cc.SCROLLVIEW_DIRECTION_HORIZONTAL) {
            size.height *= this.getMultiTableViewDataSource().numberOfGridsInCell(this, idx);
        } else {
            size.width *= this.getMultiTableViewDataSource().numberOfGridsInCell(this, idx);
        }
        return size;
    },

    tableCellAtIndex: function (table, idx) {
        var grid;
        var numberOfGridsInCell = this.getMultiTableViewDataSource().numberOfGridsInCell(this, idx);
        var cell = table.dequeueCell();
        if (!cell) {
            cell = new cc.TableViewCell();
        } else {
            var children = cell.getChildren();
            for (var i = children.length - 1; i >= 0; --i) {
                grid = children[i];
                this._gridsFreed.push(grid);
                grid.setIdx(cc.INVALID_INDEX);
                grid.retain();
                grid.removeFromParent(false);
            }
        }
        var startIndex = 0;
        for (var localIdx = 0; localIdx < idx; ++localIdx) {
            startIndex += this.getMultiTableViewDataSource().numberOfGridsInCell(this, localIdx);
        }
        var gridSize = this.getMultiTableViewDataSource().gridSizeForTable(this, idx);
        for (var gridIdx = startIndex, colIdx = 0; gridIdx < (numberOfGridsInCell + startIndex); gridIdx++, colIdx++) {
            grid = this.getMultiTableViewDataSource().gridAtIndex(this, gridIdx);
            if (grid) {
                grid.setIdx(gridIdx);
                this._gridCells[gridIdx] = grid;
                grid.setAnchorPoint(cc.p(0, 0));
                if (table.getDirection() === cc.SCROLLVIEW_DIRECTION_HORIZONTAL) {
                    if (table.getVerticalFillOrder() === cc.TABLEVIEW_FILL_TOPDOWN) {
                        grid.setPosition(cc.p(0, gridSize.height * (numberOfGridsInCell - colIdx - 1)));
                    } else {
                        grid.setPosition(cc.p(0, gridSize.height * colIdx));
                    }
                } else {
                    grid.setPosition(cc.p(gridSize.width * colIdx, 0));
                }
                cell.addChild(grid);
            }
        }
        return cell;
    },

    numberOfCellsInTableView: function (table) {
        var numberOfCells = this.getMultiTableViewDataSource().numberOfCellsInTableView(this);
        return numberOfCells;
    },

    tableCellTouched: function (table, cell) {
        if (!this.getMultiTableViewDelegate()) {
            return;
        }
        for (var i = 0; i < cell.getChildren().length; i++) {
            var grid = cell.getChildren()[i];
            grid.setContentSize(this.getMultiTableViewDataSource().gridSizeForTable(this, cell.getIdx()));
            if (grid != null && this.isTouchInside(grid, this._curTouchLocation)) {
                this.getMultiTableViewDelegate().gridTouched(this, grid);
                break;
            }
        }
    },

    scrollViewDidScroll: function (view) {
        if (this._multiTableViewDelegate && this._multiTableViewDelegate.scrollViewDidScroll) {
            this._multiTableViewDelegate.scrollViewDidScroll(this);
        }
    },

    tableCellWillRecycle: function (table, cell) {
    },

    tableCellHighlight:function(table, cell){
    },

    tableCellUnhighlight:function(table, cell){
    },

    onTouchBegan: function (touch, event) {
        this._curTouchLocation = touch.getLocation();
        return false;
    },

    getMultiTableViewDataSource: function () {
        return this._multiTableViewDataSource;
    },
    setMultiTableViewDataSource: function (dataSource) {
        this._multiTableViewDataSource = dataSource;
    },

    getMultiTableViewDelegate: function () {
        return this._multiTableViewDelegate;
    },

    setMultiTableViewDelegate: function (delegate) {
        this._multiTableViewDelegate = delegate;
    },

    setHorizontalOrder: function (order) {
        this._horizontalOrder = order;
    },
    getHorizontalOrder: function () {
        return this._horizontalOrder;
    },

    isTouchInside: function (owner, touchLocation) {
        if (!owner || !owner.getParent()) {
            return false;
        }
        touchLocation = owner.getParent().convertToNodeSpace(touchLocation);
        return cc.rectContainsPoint(owner.getBoundingBox(), touchLocation);
    },

    reloadData: function () {
        this._tableView.reloadData();
    },

    setContentOffset: function (offset, animated) {
        return this._tableView.setContentOffset(offset, animated);
    },

    getContentOffset:function () {
        return this._tableView.getContentOffset();
    },

    minContainerOffset:function () {
        return this._tableView.minContainerOffset();
    },

    maxContainerOffset:function () {
        return this._tableView.maxContainerOffset();
    },

    setDirection:function (direction) {
        this._tableView.setDirection(direction);
    },

    /**
     * determines how cell is ordered and filled in the view.
     */
    setVerticalFillOrder: function (fillOrder) {
        this._tableView.setVerticalFillOrder(fillOrder);
    },

    setContentOffsetInDuration: function (offset, dt) {
        this._tableView.setContentOffsetInDuration(offset, dt);
    },

    getViewSize: function () {
        return this._tableView.getViewSize();
    },

    getContentSize: function () {
        return this._tableView.getContentSize();
    },

    getGridAtIndex:function (idx) {
        return this._gridCells[idx];
    },

    setViewSize: function (viewSize) {
        this.setContentSize(viewSize);
        this._tableView.setViewSize(viewSize);
    },

    setBounceable: function (bounceable) {
        this._tableView.setBounceable(bounceable);
    },

    setTouchEnabled: function (touchable) {
        this._tableView.setTouchEnabled(touchable);
    },

    isDragging: function () {
        return this._tableView.isDragging();
    },

    getContainer: function () {
        return this._tableView.getContainer();
    }
});

module.exports = cc.MultiColTableView;
},{}],17:[function(require,module,exports){
/**
 * Created by zhangmingxu on 29/11/2016.
 */

var TouchedNode = cc.Node.extend({
    offsetX: 10,
    offsetY: 5,

    ctor: function (isMenuItem) {
        this._isMenuItem = isMenuItem;
        this._isTouched = false;
        this._isHover = false;
        this._isHoverPlaying = false;

        this._buttonToucher = null;
        this._buttonMouser = null;
        this._super();
        this._name = "TouchedNode";
    },

    onEnter: function () {
        this._super();

        ///Touch Events
        this._buttonToucher = cc.EventListener.create({
            event: cc.EventListener.TOUCH_ONE_BY_ONE,
            swallowTouches: false,
            onTouchBegan: this.onTouchBegan.bind(this),
            onTouchMoved: this.onTouchMoved.bind(this),
            onTouchEnded: this.onTouchEnded.bind(this)
        }, this);
        cc.eventManager.addListener(this._buttonToucher, this);

        ///Mouse Events
        if(! cc.sys.isNative) {
            this._buttonMouser = cc.EventListener.create({
                event: cc.EventListener.MOUSE,
                swallowTouches: true,
                onMouseMove: this.onMouseMove.bind(this)
            });
            cc.eventManager.addListener(this._buttonMouser, this);
        }
    },

    onExit: function() {
        if(this._buttonToucher) {
            cc.eventManager.removeListener(this._buttonToucher);
            this._buttonToucher = null;
        }
        if(! cc.sys.isNative) {
            if(this._buttonMouser) {
                cc.eventManager.removeListener(this._buttonMouser);
                this._buttonMouser = null;
            }
        }

        this._super();
    },

    onTouchBegan:function (touch, event) {
        var pos = touch.getLocation();
        var target = this.parent;
        if (target && cc.rectContainsPoint(target.getBoundingBoxToWorld(), pos)) {
            if(target.enabled && target.visible) {
                this._isTouched = true;
                this._isHover = false;
                this._playBegin(target);
                return true;
            }
        }
        return false;
    },

    onTouchMoved:function (touch, event) {

    },

    onTouchEnded:function (touch, event) {
        if(this._isTouched) {
            this._isTouched = false;
            var target = this.parent;
            if (target) {
                this._playEnd(target);
            }
        }
    },

    onMouseMove: function(event) {
        var pos = event.getLocation();
        ///NOTE: target's parent is Button
        var target = this.parent;
        if (target) {
            if(cc.rectContainsPoint(target.getBoundingBoxToWorld(), pos)) {
                if(!this._isHover && !this._isTouched) {
                    if(target.enabled && target.visible) {
                        this._isHover = true;
                        this._playHover(target, true);
                    }
                }
            } else {
                if(this._isHover) {
                    this._isHover = false;
                    this._playHover(target, false);
                }
            }
        }
    },

    _onHoverEnded: function() {
        this._isHoverPlaying = false;
    },

    _playBeginEx: function(target) {
        /**
         * NOTE: CCB has bug, CCControlButton can NOT set child, so use empty node contains button and label
         * CCNode[empty]
         *    |_CCControlButton
         *          |_TouchedNode
         */
        if(target.parent) {
            target = target.parent;
        }
        /**
         * NOTE: MenuItem is more specially
         * CCNode[empty]
         *    |_CCMenu
         *          |_CCMenuItemImage
         *                  |_TouchedNode
         */
        if(this._isMenuItem && target.parent) {
            target = target.parent;
        }
        target.stopAllActions();
        target.runAction(
            cc.sequence(
                cc.delayTime(0.01),
                cc.scaleTo(0.1, 1.1, 0.9),
                cc.delayTime(0.01)
            )
        );
    },

    _playEndEx: function(target) {
        /**
         * NOTE: CCB has bug, CCControlButton can NOT set child, so use empty node contains button and label
         * CCNode[empty]
         *    |_CCControlButton
         *          |_TouchedNode
         */
        if(target.parent) {
            target = target.parent;
        }
        /**
         * NOTE: MenuItem is more specially
         * CCNode[empty]
         *    |_CCMenu
         *          |_CCMenuItemImage
         *                  |_TouchedNode
         */
        if(this._isMenuItem && target.parent) {
            target = target.parent;
        }
        target.stopAllActions();
        target.runAction(
            cc.sequence(
                cc.delayTime(0.01),
                cc.scaleTo(0.1, 1, 1),
                cc.delayTime(0.01)
            )
        );
    },

    _playBegin: function(target) {
        /**
         * NOTE: CCB has bug, CCControlButton can NOT set child, so use empty node contains button and label
         * CCNode[empty]
         *    |_CCControlButton
         *          |_TouchedNode
         */
        if(target.parent) {
            target = target.parent;
        }
        /**
         * NOTE: MenuItem is more specially
         * CCNode[empty]
         *    |_CCMenu
         *          |_CCMenuItemImage
         *                  |_TouchedNode
         */
        if(this._isMenuItem && target.parent) {
            target = target.parent;
        }
        target.stopAllActions();
        target.runAction(
            cc.scaleTo(0.20, 0.85, 0.85)
        );
    },

    _playEnd: function(target) {
        /**
         * NOTE: CCB has bug, CCControlButton can NOT set child, so use empty node contains button and label
         * CCNode[empty]
         *    |_CCControlButton
         *          |_TouchedNode
         */
        if(target.parent) {
            target = target.parent;
        }
        /**
         * NOTE: MenuItem is more specially
         * CCNode[empty]
         *    |_CCMenu
         *          |_CCMenuItemImage
         *                  |_TouchedNode
         */
        if(this._isMenuItem && target.parent) {
            target = target.parent;
        }
        target.stopAllActions();
        target.runAction(
            cc.scaleTo(0.20 ,1, 1)
        );
    },

    _playHoverEx: function(target) {
        var bounding = target.getBoundingBox();
        if(bounding.width < this.offsetX) {
            bounding.width = this.offsetX;
        }
        if(bounding.height < this.offsetY) {
            bounding.height = this.offsetY;
        }

        /**
         * NOTE: CCB has bug, CCControlButton can NOT set child, so use empty node contains button and label
         * CCNode[empty]
         *    |_CCControlButton
         *          |_TouchedNode
         */
        if(target.parent) {
            target = target.parent;
        }
        /**
         * NOTE: MenuItem is more specially
         * CCNode[empty]
         *    |_CCMenu
         *          |_CCMenuItemImage
         *                  |_TouchedNode
         */
        if(this._isMenuItem && target.parent) {
            target = target.parent;
        }
        target.stopAllActions();
        target.runAction(
            cc.sequence(
                cc.scaleTo(0.08, (bounding.width-this.offsetX)/bounding.width, (bounding.height+this.offsetY)/bounding.height),
                cc.scaleTo(0.1, (bounding.width+this.offsetX)/bounding.width, (bounding.height-this.offsetY)/bounding.height),
                cc.delayTime(0.04),
                cc.scaleTo(0.1, 1, 1),
                cc.callFunc(this._onHoverEnded, this)
            )
        );
    },

    _playHover: function(target, isHover) {
        //cc.error("hover: target = ", target, Date.now());
        /**
         * NOTE: CCB has bug, CCControlButton can NOT set child, so use empty node contains button and label
         * CCNode[empty]
         *    |_CCControlButton
         *          |_TouchedNode
         */
        if(target.parent) {
            target = target.parent;
        }
        /**
         * NOTE: MenuItem is more specially
         * CCNode[empty]
         *    |_CCMenu
         *          |_CCMenuItemImage
         *                  |_TouchedNode
         */
        if(this._isMenuItem && target.parent) {
            target = target.parent;
        }
        target.stopAllActions();

        if(isHover) {
            target.runAction(
                cc.sequence(
                    cc.scaleTo(0.16, 1.08, 1.08),
                    cc.scaleTo(0.1, 1.06, 1.06)
                )
            );
        } else {
            target.setScale(1, 1);
        }

    }

});

module.exports = TouchedNode;
},{}],18:[function(require,module,exports){
/**
 * Created by oye on 15-5-17.
 */
var HttpClient = require("../../common/net/HttpClient");
var AdsPlace = require("../enum/AdsPlace");

var AD_CONFIG_URL = "https://qinning199.github.io/game.html";

//var ONE_MINUTE = 60 * 1000;
var AdListener = cc.Class.extend({
    onRewardedVideoFinished: function (isRewarded, channelName) {
    },

    onInterstitialAdEnd: function (channelName) {
    },

    onShowVideoAdBegin: function () {
    },

    onShowVideoAdEnd: function () {
    }
});

var AdPlaceInfo = function (interval) {
    this.interval = interval;
    this.lastShowTime = Date.now();
};


var AdsManager = cc.Class.extend({
    DEFAULT_AD_INTERVAL: 40 * 1000,

    ONE_MINUTE_SECOND: 60 * 1000,

    adConfigUrl: "",

    rateTime: 0,
    ratedTime: 0,
    rateRemoveAds: false,

    isNewPlayer: true,

    adPlaceMap: {},

    /**
     * @type {AdListener}
     */
    adListener: null,

    showTopBanner: true,
    topBannerDay: 0,

    showFirstEnterAd: true,
    firstEnterShowAdDay: 2,

    lastInterstitialTime: 0,
    lastRewardedTime: 0,
    enabledInterstitialAd: true,

    popupLevelLimit: 4,
    skinMaxPopCount: 3,
    boxMaxPopCount: 3,
    cardMaxPopCount: 3,
    startLevelLimit: 2,
    popupResetLimit: 8,

    crossPromPercent: 0.5,

    challengeTipsDay: 1,

    challengeOpenLevel: 20,

    flyGiftOpenLevel: 3,

    disableInterstitialTime: 0,

    rewardRemoveAdsLevelLimit: 4,

    flyGiftCount: 5,

    adsInterval: 40 * 1000,

    ctor: function () {
        if(cc.sys.isNative) {
            jsb_dp.oneSdkBridge.onInterstitialAdFinished = this.onAdFinishedJsb.bind(this);
            jsb_dp.oneSdkBridge.onVideoAdFinished = this.onVideoAdFinishedJsb.bind(this);
            jsb_dp.oneSdkBridge.onShowVideoAdBegin = this.onShowVideoAdBeginJsb.bind(this);
            jsb_dp.oneSdkBridge.onShowVideoAdEnd = this.onShowVideoAdEndJsb.bind(this);
        }

        for (var i = 1; i <= AdsPlace.Num; ++i) {
            this.adPlaceMap[i] = new AdPlaceInfo(this.DEFAULT_AD_INTERVAL);
        }
    },

    init: function () {
    },

    setAdsInterval: function (secTime) {
        this.adsInterval = secTime * 1000;
    },

    loadRemoteData: function () {
        var adConfigUrl = game.config.getAdUrl() || AD_CONFIG_URL;
        cc.log("AdsManager loadRemoteData:" + adConfigUrl);
        var self = this;
        HttpClient.doGet(adConfigUrl, function (error, text) {
            cc.log("AdsManager remote response:" + error + ",text:" + text);
            if (!error) {
                try {
                    var adConfig = JSON.parse(text);

                    if (cc.sys.os === cc.sys.OS_ANDROID) {
                        if (adConfig && adConfig.androidConfig) {
                            adConfig = adConfig.androidConfig;
                        }
                    }

                    var showTopBanner = adConfig.showTopBanner;
                    if (!cc.isUndefined(showTopBanner)) {
                        self.showTopBanner = showTopBanner;
                    }

                    var showTopBannerNew = adConfig.showTopBannerNew;
                    if (!cc.isUndefined(showTopBannerNew)) {
                        self.showTopBanner = showTopBannerNew;
                    }

                    var topBannerDay = adConfig.topBannerDay;
                    if (!cc.isUndefined(topBannerDay)) {
                        self.topBannerDay = topBannerDay;
                    }

                    var showFirstEnterAd = adConfig.showFirstEnterAd;
                    if (!cc.isUndefined(showFirstEnterAd)) {
                        self.showFirstEnterAd = showFirstEnterAd;
                    }

                    var firstEnterShowAdDay = adConfig.firstEnterShowAdDay;
                    if (!cc.isUndefined(firstEnterShowAdDay)) {
                        self.firstEnterShowAdDay = firstEnterShowAdDay;
                    }

                    var backToGroundInterval = adConfig.backToGroundInterval;
                    if (!cc.isUndefined(backToGroundInterval)) {
                        self.adPlaceMap[AdsPlace.BackGround].interval = backToGroundInterval * 1000;
                    }

                    var backToHomeInterval = adConfig.backToHomeInterval;
                    if (!cc.isUndefined(backToHomeInterval)) {
                        self.adPlaceMap[AdsPlace.Home].interval = backToHomeInterval * 1000;
                    }

                    var refreshInterval = adConfig.refreshInterval;
                    if (!cc.isUndefined(refreshInterval)) {
                        self.adPlaceMap[AdsPlace.Refresh].interval = refreshInterval * 1000;
                    }

                    var popupLevelLimit = adConfig.popupLevelLimit;
                    if (!cc.isUndefined(popupLevelLimit)) {
                        self.popupLevelLimit = popupLevelLimit;
                    }

                    var skinMaxPopCount = adConfig.skinMaxPopCount;
                    if (!cc.isUndefined(skinMaxPopCount)) {
                        self.skinMaxPopCount = skinMaxPopCount;
                    }

                    var boxMaxPopCount = adConfig.boxMaxPopCount;
                    if (!cc.isUndefined(boxMaxPopCount)) {
                        self.boxMaxPopCount = boxMaxPopCount;
                    }

                    var startLevelLimit = adConfig.startLevelLimit;
                    if (!cc.isUndefined(startLevelLimit)) {
                        self.startLevelLimit = startLevelLimit;
                    }

                    var cardMaxPopCount = adConfig.cardMaxPopCount;
                    if (!cc.isUndefined(cardMaxPopCount)) {
                        self.cardMaxPopCount = cardMaxPopCount;
                    }

                    var popupResetLimit = adConfig.popupResetLimit;
                    if (!cc.isUndefined(popupResetLimit)) {
                        self.popupResetLimit = popupResetLimit;
                    }

                    var crossPromPercent = adConfig.crossPromPercent;
                    if (!cc.isUndefined(crossPromPercent)) {
                        self.crossPromPercent = crossPromPercent;
                    }

                    var challengeTipsDay = adConfig.challengeTipsDay;
                    if (!cc.isUndefined(challengeTipsDay)) {
                        self.challengeTipsDay = challengeTipsDay;
                    }

                    var challengeOpenLevel = adConfig.challengeOpenLevel;
                    if (!cc.isUndefined(challengeOpenLevel)) {
                        self.challengeOpenLevel = challengeOpenLevel;
                    }

                    var flyGiftOpenLevel = adConfig.flyGiftOpenLevel;
                    if (!cc.isUndefined(flyGiftOpenLevel)) {
                        self.flyGiftOpenLevel = flyGiftOpenLevel;
                    }

                    var rewardRemoveAdsLevelLimit = adConfig.rewardRemoveAdsLevelLimit;
                    if (!cc.isUndefined(rewardRemoveAdsLevelLimit)) {
                        self.rewardRemoveAdsLevelLimit = rewardRemoveAdsLevelLimit;
                    }

                    var flyGiftCount = adConfig.flyGiftCount;
                    if (!cc.isUndefined(flyGiftCount)) {
                        self.flyGiftCount = flyGiftCount;
                    }
                } catch (e) {
                    cc.log("AdsManager error:" + e.message);
                }
            }
        });
    },

    getRegisterDay: function () {
        return game.playerMan.getRegisterDay();
    },

    setIsNewPlayer: function (isNew) {
        this.isNewPlayer = isNew;
    },

    onGameOnShow: function () {
    },

    setAdListener: function (adListener) {
        this.adListener = adListener;
    },

    isRemovedAds: function () {
        return game.playerMan.player.removedAds;
    },

    showBannerAds: function (placement) {
        cc.log("AdsManager showBannerAds:" + placement);
        if (this.isRemovedAds()) return;
        if (cc.sys.isNative) {
            if (!this.isShowBannerAds(placement)) {
                jsb_dp.oneSdkBridge.showBannerAd(placement);
            }
        }
    },

    removeBannerAds: function (placement) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.removeBannerAd(placement);
        }
    },

    isShowBannerAds: function (placement) {
        if (cc.sys.isNative) {
            return jsb_dp.oneSdkBridge.isShowBannerAd(placement);
        }
        return false;
    },

    isShowNativeAd: function (placement) {
        if (cc.sys.isNative) {
            return jsb_dp.oneSdkBridge.isShowNativeAd(placement);
        }
        return false;
    },

    isNativeAdReady: function (placement) {
        if (cc.sys.isNative) {
            return jsb_dp.oneSdkBridge.isNativeAdReady(placement);
        }
        return false;
    },

    interstitialCount: 0,

    isInterstitialDisabled: function () {
        return this.disableInterstitialTime - Date.now() > 0;
    },

    interstitialEndCallback: null,

    showInterstitial: function (place, endCallback) {
        cc.log("AdsManager show interstitial start");
        place = AdsPlace.Pass;
        if (!this.enabledInterstitialAd) {
            return false;
        }
        if (this.isRemovedAds()) {
            return false;
        }

        cc.log("AdsManager show interstitial time:" + (this.disableInterstitialTime - Date.now()));
        if (this.isInterstitialDisabled()) {
            return false;
        }

        var placement = "default";
        if (place === AdsPlace.Home) {
            placement = "home";
        } else if (place === AdsPlace.Refresh) {
            placement = "refresh";
        }

        if (cc.sys.isNative) {
            if (!jsb_dp.oneSdkBridge.isInterstitialAdReady(placement)) {
                game.analyseManager.trackEvent("WatchISNotReady", {name: AdsPlace.getName(place)});
                cc.log("AdsManager showInterstitial ads not ready");
                return false;
            }
        }
        cc.log("AdsManager showInterstitial place:" + place + ", interval:" + this.adsInterval + ",current interval:" +
            (Date.now() - this.adPlaceMap[place].lastShowTime));
        if (Date.now() - this.adPlaceMap[place].lastShowTime < this.adsInterval) {
            return false;
        }

        if (Date.now() - this.lastInterstitialTime < 5 * 1000) {
            cc.log("AdsManager showInterstitial interval less than 5 seconds");
            return false;
        }
        if (Date.now() - this.lastRewardedTime < 5 * 1000) {
            cc.log("AdsManager showInterstitial rewarded video disable interstitial 5 seconds");
            return false;
        }

        this.adPlaceMap[place].lastShowTime = Date.now();

        cc.log("AdsManager showInterstitial place:" + place + " showed");
        this.lastInterstitialTime = Date.now();

        this.interstitialCount++;

        this.place = place;
        this.interstitialEndCallback = endCallback;
        game.analyseManager.trackEvent("WatchISSourceStart", {name: AdsPlace.getName(this.place)});
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.showInterstitalAd(placement);
        }
        return true;
    },

    shouldShowNativeAd: true,

    showNativeAd: function (place, posX, posY) {
        cc.log("showNativeAd:" + place);
        if (this.isRemovedAds()) {
            return;
        }
        if (cc.sys.isNative) {
            if (this.isShowNativeAd(place)) {
                return;
            }
            cc.log("showNativeAd:" + place + ",1");
            var showNativeAd = game.utils.randomNextInt(100) > this.crossPromPercent * 100;
            var isNativeAdReady = this.isNativeAdReady(place);
            var hasCrossPromAd = game.crossPromMan.hasCrossPromAd();
            cc.log("showNativeAd: hasCrossPromAd" + hasCrossPromAd);
            cc.log("showNativeAd: showNativeAd" + showNativeAd);
            if (!hasCrossPromAd || this.crossPromPercent <= 0 || (showNativeAd && isNativeAdReady)) {
                cc.log("showNativeAd:" + place + ",2");
                this.shouldShowNativeAd = true;
                jsb_dp.oneSdkBridge.showNativeAd(place, posX, posY);
            } else {
                cc.log("showNativeAd:" + place + ",3");
                this.shouldShowNativeAd = false;
                game.crossPromMan.showCrossPromAd(cc.p(cc.winSize.width * 0.5 + posX, cc.winSize.height * 0.5 + posY), cc.size(330, 330));
            }
        }
    },

    removeNativeAd: function (place) {
        if (this.isRemovedAds()) return;
        cc.log("removeNativeAd:" + place + ",1");
        if (cc.sys.isNative) {
            if (this.shouldShowNativeAd) {
                cc.log("removeNativeAd:" + place + ",2");
                jsb_dp.oneSdkBridge.removeNativeAd(place);
            } else {
                cc.log("removeNativeAd:" + place + ",3");
                game.crossPromMan.removeCrossPromAd();
            }
        }
        this.shouldShowNativeAd = true;
    },

    setInterstitialShowed: function (place) {
        this.adPlaceMap[place].lastShowTime = Date.now();
    },

    showCrossPromotion: function () {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.showCrossPromoteAd();
        }
    },

    isRewardVideoReady: function () {
        if (cc.sys.isNative) {
            return jsb_dp.oneSdkBridge.isRewardVideoReady();
        }
        return false;
    },

    showRewardVideoAd: function (name) {
        if (!this.isRewardVideoReady()) {
            return;
        }
        this.enabledInterstitial(false);
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.showRewardVideoAd(name);
        }
    },

    enabledInterstitial: function (enabled) {
        this.enabledInterstitialAd = enabled;
    },

    disableInterstitialWithTime: function (seconds) {
        this.disableInterstitialTime = Date.now() + seconds * 1000;
    },

    onAdFinishedJsb: function (str) {
        cc.log("onAdFinishedJsb:" + str);
        var adsFinishedObj = JSON.parse(str);
        var channelName = adsFinishedObj["channelName"];
        cc.log("channel :" + channelName + " show interstitial ads finished");

        if (this.adListener && this.adListener.onInterstitialAdEnd) {
            this.adListener.onInterstitialAdEnd(channelName);
        }
        if (game.gameMan.isNewAdsShowType()) {
            this.adPlaceMap[this.place].lastShowTime = Date.now();
        }
        game.analyseManager.trackEvent("WatchISSourceEnd", {name: AdsPlace.getName(this.place), channel: channelName});
        game.playerMan.addInterstitialAdCount();
        this.disableInterstitialWithTime(5);
        if (this.interstitialEndCallback != null) {
            this.interstitialEndCallback();
            this.interstitialEndCallback = null;
        }
    },

    onVideoAdFinishedJsb: function (str) {
        cc.log("onVideoAdFinishedJsb:" + str);
        var adsFinishedObj = JSON.parse(str);
        var isSkipped = adsFinishedObj.isSkipped;
        var channelName = adsFinishedObj.channelName;
        if (!isSkipped) {
            cc.log("reward video ads show success");
        } else {
            cc.log("reward video ads skipped");
        }

        if (this.adListener && this.adListener.onRewardedVideoFinished) {
            this.adListener.onRewardedVideoFinished(!isSkipped, channelName);
        }
        if (!isSkipped) {
            game.playerMan.addRewardedAdCount();
        }
    },

    onShowVideoAdBeginJsb: function () {
        if (this.adListener && this.adListener.onShowVideoAdBegin) {
            this.adListener.onShowVideoAdBegin();
        }
    },

    onShowVideoAdEndJsb: function () {
        if (this.adListener && this.adListener.onShowVideoAdEnd) {
            this.adListener.onShowVideoAdEnd();
        }
        this.enabledInterstitial(true);
        this.lastRewardedTime = Date.now();
    }
});

AdsManager.sharedDirector = null;
AdsManager.firstUseDirector = true;

AdsManager.getInstance = function () {
    if (AdsManager.firstUseDirector) {
        AdsManager.firstUseDirector = false;
        AdsManager.sharedDirector = new AdsManager();
    }
    return AdsManager.sharedDirector;
};

module.exports = AdsManager;
},{"../../common/net/HttpClient":32,"../enum/AdsPlace":13}],19:[function(require,module,exports){
/**
 * Created by oye on 15-5-17.
 */

var AnalyseManager = cc.Class.extend({
    g_pAnalytics: null,
    ctor: function () {
    },

    initAnalytics: function () {
    },

    trackLoginEvent: function () {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.trackLogin();
        }
    },

    /**
     * @param {number} amountNum
     * @param {string} itemType
     * @param {string} itemId
     * @param {string} receipt
     */
    trackPurchaseEvent: function (amountNum, itemType, itemId, receipt) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.trackPurchase(amountNum, itemType, itemId, receipt);
        }
    },

    trackStartProgressionEvent: function (name, value) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.trackStartProgression(name, value);
        }
    },

    trackCompletedProgressionEvent: function (name, value) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.trackCompletedProgression(name, value);
        }
    },

    trackFailedProgressionEvent: function (name, value) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.trackFailProgression(name, value);
        }
    },

    /**
     * track error event
     * @param {string} errorMsg
     */
    trackErrorEvent: function (errorMsg) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.trackError(errorMsg);
        }
    },

    trackEvent: function (name, obj) {
        if (cc.sys.isNative) {
            var info = "";
            if (obj) {
                info = JSON.stringify(obj);
            }
            jsb_dp.oneSdkBridge.trackEvent(name, info);
        }
    },

    addVirtualCurrency: function (reason, value) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.addVirtualCurrency(reason, value);
        }
    },

    consumeVirtualCurrency: function (itemName, itemCount, virutalCurrency) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.consumeVirtualCurrency(itemName, itemCount, virutalCurrency);
        }
    },

    consumeItem: function (itemName, itemCount) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.consumeItem(itemName, itemCount);
        }
    },

    trackChargeRequest: function (orderId, iapId, currencyAmount, currencyType, virtualCurrencyAmount, paymentType) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.trackChargeRequest(orderId, iapId, currencyAmount, currencyType, virtualCurrencyAmount, paymentType);
        }
    },

    trackChargeSuccess: function (orderId) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.trackChargeSuccess(orderId);
        }
    },

    missionBegan: function (missionId) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.missionBegan(missionId);
        }
    },

    missionCompleted: function (missionId) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.missionCompleted(missionId);
        }
    },

    missionFailed: function (missionId, reason) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.missionFailed(missionId, reason);
        }
    },

    trackPlayerLevel: function (level) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.setPlayerLevel(level);
        }
    }
});

AnalyseManager.sharedDirector = null;
AnalyseManager.firstUseDirector = true;

AnalyseManager.getInstance = function () {
    if (AnalyseManager.firstUseDirector) {
        AnalyseManager.firstUseDirector = false;
        AnalyseManager.sharedDirector = new AnalyseManager();
    }
    return AnalyseManager.sharedDirector;
};

module.exports = AnalyseManager;
},{}],20:[function(require,module,exports){
/**
 * Created by oye on 15-5-17.
 */
var CaptureListener = cc.Class.extend({
    onCaptureAudio: function (audioDecible) {
    }
});


var CaptureManager = cc.Class.extend({

    ctor: function () {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.onCaptureAudio = this.onCaptureAudio.bind(this);
        }
    },

    setCaptureListener: function (listener) {
        this.listener = listener;
    },

    captureAudio: function () {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.captureAudio();
        }
    },

    getAudioDecible: function () {
        if (cc.sys.isNative) {
            return jsb_dp.oneSdkBridge.getAudioDecible();
        }
        return 0;
    },

    onCaptureAudio: function (audioDecibleString) {
        var audioObj = JSON.parse(audioDecibleString);
        var audioDecible = audioObj["audioDecible"];
        if (this.listener) {
            this.listener.onCaptureAudio(audioDecible);
        }
    }
});

CaptureManager.sharedDirector = null;
CaptureManager.firstUseDirector = true;

CaptureManager.getInstance = function () {
    if (CaptureManager.firstUseDirector) {
        CaptureManager.firstUseDirector = false;
        CaptureManager.sharedDirector = new CaptureManager();
    }
    return CaptureManager.sharedDirector;
};

module.exports = CaptureManager;
},{}],21:[function(require,module,exports){
/**
 * Created by qinning on 2017/8/29.
 */

var HttpClient = require("../../common/net/HttpClient");
var Downloader = require("../assets/Downloader");

var CrossPromData = function () {
    this.scoreLimit = 0;
    this.imageUrl = "";
    this.downloadUrl = "";
    this.weight = 0;
    this.appId = "";
};

var CrossAdConfig = function (jsonObj) {
    this.id = jsonObj["id"] || 1;
    this.name = jsonObj["name"];
    this.desc = jsonObj["desc"];
    this.weight = jsonObj["weight"] || 1;
    this.videoUrl = jsonObj["videoUrl"];
    this.iosUrl = jsonObj["iosUrl"];
    this.androidUrl = jsonObj["androidUrl"];
};

CrossAdConfig.prototype.getDownloadUrl = function () {
    if (cc.sys.os === cc.sys.OS_ANDROID) {
        return this.androidUrl;
    }
    return this.iosUrl;
};

var CrossPromManager = cc.Class.extend({
    cachedTexture: null,
    cachedConfig: null,
    crossProms: null,

    videoCrossProms: null,

    // videoDownloaded: false,

    ctor: function () {
    },

    tryToLoadFromRemote: function () {
        var crossPromUrl = game.config.getCrossPromUrl();

        var self = this;
        HttpClient.doGet(crossPromUrl, function (error, text) {
            if (!error) {
                try {
                    cc.log("cross promotion tryToLoadFromRemote downloaded:" + text);
                    var data = JSON.parse(text);
                    var open = data.open || false;
                    if (!open) {
                        return;
                    }
                    var scoreLimit = data.scoreLimit || 0;

                    if (!cc.isUndefined(game.playerMan.player.level)) {
                        if (game.playerMan.player.level < scoreLimit) {
                            return;
                        }
                    }
                    var maxPopCount = data.maxPopCount || 3;
                    self.downloadedShow = data.downloadedShow || false;
                    self.crossProms = data["crossProms"];
                    var videoCrossProms = data["videoCrossProms"];
                    self.videoCrossProms = [];
                    for (var i = 0; i < videoCrossProms.length; ++i) {
                        var crossProm = new CrossAdConfig(videoCrossProms[i]);
                        self.videoCrossProms.push(crossProm);
                    }

                    self.maxPopCount = maxPopCount;
                    self.tryToDownloadPromoImg();
                    self.tryToDownloadPromVideo();
                } catch (e) {
                }
            }
        });
    },

    tryToDownloadPromVideo: function () {
        cc.log("tryToDownloadPromVideo:1");
        if (this.videoCrossProms && this.videoCrossProms.length > 0) {
            cc.log("tryToDownloadPromVideo:2,length:" + this.videoCrossProms.length);
            var downloader = Downloader.getInstance();
            for (var i = 0; i < this.videoCrossProms.length; ++i) {
                var config = this.videoCrossProms[i];
                cc.log("tryToDownloadPromVideo:2-1");
                var storagePath = jsb.fileUtils.getWritablePath() + "/cross-video-" + config.id + ".mp4";
                cc.log("tryToDownloadPromVideo:2-3");
                if (game.utils.isFileExist(storagePath)) {
                    config.videoDownloaded = true;
                    cc.log("tryToDownloadPromVideo:3:id:" + config.id);
                } else {
                    cc.log("tryToDownloadPromVideo:4");
                    downloader.download(config.videoUrl, storagePath, config, function (p) {
                        cc.log("tryToDownloadPromVideo:downloaded:" + p.id);
                        p.videoDownloaded = true;
                    });
                    cc.log("tryToDownloadPromVideo:5");
                }
            }
        }
    },

    tryToDownloadPromoImg: function () {
        if (this.maxPopCount <= 0) {
            return;
        }
        if (this.cachedConfig || this.cachedTexture) {
            return;
        }
        this.maxPopCount--;
        cc.log("cross promotion tryToDownloadPromoImg check");
        var self = this;
        if (!cc.isUndefined(this.crossProms) && cc.isArray(this.crossProms) && this.crossProms.length > 0) {
            var randomConfig = this.getRandomConfig(this.crossProms);
            this.removeCrossPromoCfg(randomConfig);
            //game.utils.download
            cc.log("cross promotion tryToDownloadPromoImg start download");
            game.utils.loadRemoteImg(randomConfig.imageUrl, function (error, tex, extra) {
                if (!error && tex) {
                    cc.log("cross promotion tryToDownloadPromoImg downloaded:" + self.downloadedShow);
                    self.cachedTexture = tex;
                    self.cachedTexture.retain();
                    self.cachedConfig = randomConfig;
                    if (self.downloadedShow) {
                        self.downloadedShow = false;
                        self.tryToPopupCrossPromDlg();
                    }
                }
            }, null);
        }
    },

    removeCrossPromoCfg: function (crossPromCfg) {
        for (var i = 0; i < this.crossProms.length; ++i) {
            if (this.crossProms[i] === crossPromCfg) {
                this.crossProms.splice(i, 1);
                break;
            }
        }
    },


    getRandomConfig: function (crossProms) {
        var totalWeight = 0;
        var i;
        for (i = 0; i < crossProms.length; ++i) {
            totalWeight += crossProms[i].weight;
        }

        var randomNum = game.utils.randomNextInt(totalWeight);

        var curWeight = 0;
        for (i = 0; i < crossProms.length; ++i) {
            curWeight += crossProms[i].weight;
            if (curWeight > randomNum) {
                return crossProms[i];
            }
        }

        return crossProms[0];
    },

    popupCrossPromDlg: function (crossPromsConfig, texture) {
        var CrossPromController = require("../controller/CrossPromController");
        var crossPromNode = CrossPromController.createFromCCB("res/cross/cross_prom_view.ccbi");
        crossPromNode.controller.initWith(crossPromsConfig, texture);
        crossPromNode.controller.popup();
    },

    tryToPopupCrossPromDlg: function () {
        cc.log("cross promotion tryToPopupCrossPromDlg start");
        if (this.cachedConfig && this.cachedTexture) {
            cc.log("cross promotion tryToPopupCrossPromDlg poped");
            this.popupCrossPromDlg(this.cachedConfig, this.cachedTexture);
            this.cachedTexture.release();
            this.cachedConfig = null;
            this.cachedTexture = null;
            this.tryToDownloadPromoImg();
        }
    },

    hasCrossPromAd: function () {
        if (this.videoCrossProms && this.videoCrossProms.length > 0) {
            for (var i = 0; i < this.videoCrossProms.length; ++i) {
                if (this.videoCrossProms[i].videoDownloaded) {
                    return true;
                }
            }
        }
        return false;
    },

    selectVideoCrossProm: function () {
        if (this.lastConfig && (Date.now() - this.lastConfig.time) < 30000) {
            return this.lastConfig;
        }
        var configs = [];
        var totalWeight = 0;
        for (var i = 0; i < this.videoCrossProms.length; ++i) {
            var config = this.videoCrossProms[i];
            if (config.videoDownloaded) {
                configs.push(config);
                totalWeight += config.weight;
            }
        }
        var randomNum = game.utils.randomNextInt(totalWeight);
        var currentWeight = 0;
        var selectConfig = null;
        for (var i = 0; i < configs.length; ++i) {
            currentWeight += configs[i].weight;
            if (currentWeight > randomNum) {
                selectConfig = configs[i];
                break;
            }
        }
        this.lastConfig = selectConfig;
        this.lastConfig.time = Date.now();
        return selectConfig;
    },

    showCrossPromAd: function (worldPos, size) {
        if (this.crossPromNode) {
            this.crossPromNode.visible = true;
            var randomConfig = this.selectVideoCrossProm();
            this.crossPromNode.controller.showVideo(randomConfig);
            cc.director.getRunningScene().addChild(this.crossPromNode, 100000);
            this.crossPromNode.release();
            this.crossPromNode.setPosition(worldPos);
            return;
        }

        cc.log("showCrossPromAd:" + JSON.stringify(this.videoCrossProms));
        if (this.videoCrossProms && this.videoCrossProms.length > 0) {
            var randomConfig = this.selectVideoCrossProm();
            cc.log("showCrossPromAd:" + JSON.stringify(randomConfig));
            var CrossAdsController = require("../controller/CrossAdsController");
            var node = CrossAdsController.createFromCCB();
            cc.director.getRunningScene().addChild(node, 100000);
            node.controller.initWith(randomConfig, size);
            node.setPosition(worldPos);
            this.crossPromNode = node;
        }
    },

    removeCrossPromAd: function () {
        if (this.crossPromNode) {
            this.crossPromNode.visible = false;
            this.crossPromNode.controller.hideVideo();
            this.crossPromNode.retain();
            this.crossPromNode.removeFromParent(false);

        }
    }
});

CrossPromManager.sharedDirector = null;
CrossPromManager.firstUseDirector = true;

CrossPromManager.getInstance = function () {
    if (CrossPromManager.firstUseDirector) {
        CrossPromManager.firstUseDirector = false;
        CrossPromManager.sharedDirector = new CrossPromManager();
    }
    return CrossPromManager.sharedDirector;
};


module.exports = CrossPromManager;
},{"../../common/net/HttpClient":32,"../assets/Downloader":3,"../controller/CrossAdsController":7,"../controller/CrossPromController":8}],22:[function(require,module,exports){
/**
 * Created by oye on 15-5-17.
 */
var GCManager = cc.Class.extend({

    ctor: function () {
    },

    isGameCenterAvailable: function () {
        if (cc.sys.isNative) {
            return jsb_dp.oneSdkBridge.isGameCenterAvailable();
        }
        return false;
    },

    reportScore: function (score, leaderBoardKey) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.reportScore(score, leaderBoardKey);
        }
    },

    showLeaderboard: function (leaderBoardKey) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.showLeaderboard(leaderBoardKey);
        }
    },

    reportAchievement: function (percentCompleted, archievementKey) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.reportAchievement(percentCompleted, archievementKey);
        }
    },

    showAchievements: function (leaderBoardkey) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.showAchievements(leaderBoardkey);
        }
    },

    highScoreForLeaderboard: function (leaderBoardKey) {
        if (cc.sys.isNative) {
            return jsb_dp.oneSdkBridge.highScoreForLeaderboard(leaderBoardKey);
        }
        return 0;
    },

    progressForAchievement: function (archievementKey) {
        if (cc.sys.isNative) {
            return jsb_dp.oneSdkBridge.progressForAchievement(archievementKey);
        }
        return 0;
    }
});

GCManager.sharedDirector = null;
GCManager.firstUseDirector = true;

GCManager.getInstance = function () {
    if (GCManager.firstUseDirector) {
        GCManager.firstUseDirector = false;
        GCManager.sharedDirector = new GCManager();
    }
    return GCManager.sharedDirector;
};

module.exports = GCManager;
},{}],23:[function(require,module,exports){
/**
 * Created by qinning on 2017/3/11.
 */

var LocalizationManager = cc.Class.extend({

    _isLoaded: false,
    curLanguage: null,
    ctor: function () {
        if (cc.sys.language === cc.sys.LANGUAGE_ARABIC ||
            cc.sys.language === cc.sys.LANGUAGE_RUSSIAN ||
            cc.sys.language === cc.sys.LANGUAGE_FRENCH ||
            cc.sys.language === cc.sys.LANGUAGE_SPANISH ||
            cc.sys.language === cc.sys.LANGUAGE_ITALIAN ||
            cc.sys.language === cc.sys.LANGUAGE_GERMAN
        ) {
            var searchPathArr = jsb.fileUtils.getSearchPaths();
            searchPathArr.unshift("res/ru");
            cc.log("search paths:" + JSON.stringify(searchPathArr));
            jsb.fileUtils.setSearchPaths(searchPathArr);
        }
    },

    reload: function () {
        if (this._isLoaded) {
            return;
        }
        if (game.utils.isSelfGame()) {
            this.curLanguage = game.utils.loadJson("res/config/languages/strings-zhs.json");
        } else {
            var fileName = "res/config/languages/strings-" + cc.sys.language + ".json";
            cc.log("local file:" + fileName);
            if (game.utils.isFileExist(fileName)) {
                this.curLanguage = game.utils.loadJson(fileName);
            } else {
                this.curLanguage = game.utils.loadJson("res/config/languages/strings-en.json");
            }
        }
        this._isLoaded = true;
    },

    getValue: function (key) {
        var value = this.curLanguage[key] || key;
        return value;
    },

    isChinese: function () {
        if (game.utils.isSelfGame()) {
            return true;
        }
        return false;
    }
});

LocalizationManager.sharedDirector = null;
LocalizationManager.firstUseDirector = true;

LocalizationManager.getInstance = function () {
    if (LocalizationManager.firstUseDirector) {
        LocalizationManager.firstUseDirector = false;
        LocalizationManager.sharedDirector = new LocalizationManager();
    }
    return LocalizationManager.sharedDirector;
};


module.exports = LocalizationManager;
},{}],24:[function(require,module,exports){
/**
 * Created by oye on 15-5-17.
 */
var NotificationManager = cc.Class.extend({

    ctor: function () {
    },

    registerNotification: function () {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.registerNotification();
        }
    },

    /**
     *
     * @param timeFromNow
     * @param alertText
     * @param alertAction
     * @param badgeNumber
     * @param sound
     */
    scheduleNotification: function (timeFromNow, alertText, alertAction, badgeNumber) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.scheduleNotification(timeFromNow, alertText, alertAction, badgeNumber);
        }
    },

    unscheduleNotification: function () {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.unscheduleNotification();
        }
    }
});

NotificationManager.sharedDirector = null;
NotificationManager.firstUseDirector = true;

NotificationManager.getInstance = function () {
    if (NotificationManager.firstUseDirector) {
        NotificationManager.firstUseDirector = false;
        NotificationManager.sharedDirector = new NotificationManager();
    }
    return NotificationManager.sharedDirector;
};


module.exports = NotificationManager;
},{}],25:[function(require,module,exports){
/**
 * Created by oye on 15-5-17.
 */
var RateManager = cc.Class.extend({

    ctor: function () {
    },

    init: function () {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.initRateParams(3, 1, 0.5, 0.5, true);
        }
    },

    rate: function () {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.launchRate();
        }
    },

    likeInFacebook: function (url) {
        cc.sys.openURL(url);
    },

    launchAppReview: function () {
        if (cc.sys.isNative) {
            return jsb_dp.oneSdkBridge.launchAppReview();
        }
        return false;
    }
});

RateManager.sharedDirector = null;
RateManager.firstUseDirector = true;

RateManager.getInstance = function () {
    if (RateManager.firstUseDirector) {
        RateManager.firstUseDirector = false;
        RateManager.sharedDirector = new RateManager();
    }
    return RateManager.sharedDirector;
};

module.exports = RateManager;
},{}],26:[function(require,module,exports){
/**
 * Created by oye on 15-5-17.
 */
var RemoteConfigManager = cc.Class.extend({

    remoteReceivedCB: null,
    ctor: function () {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.onRemoteConfigReceived = this.onRemoteConfigReceived.bind(this);
        }
    },

    setRemoteConfigReceivedCallback: function (callback) {
        this.remoteReceivedCB = callback;
    },

    onRemoteConfigReceived: function () {
        if (this.remoteReceivedCB) {
            this.remoteReceivedCB();
        }
    },

    setDefaultRemoteConfig: function (params) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.setDefaultRemoteConfig(JSON.stringify(params));
        }
    },

    fetchRemoteConfig: function () {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.fetchRemoteConfig();
        }
    },

    getRemoteConfig: function (key) {
        if (cc.sys.isNative) {
            return jsb_dp.oneSdkBridge.getRemoteConfig(key);
        }
        return "";
    },

    activateRemoteFetched: function () {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.activateRemoteFetched();
        }
    },

    isRemoteConfigReady: function () {
        if (cc.sys.isNative) {
            return jsb_dp.oneSdkBridge.isRemoteConfigReady();
        }
        return false;
    }

});

RemoteConfigManager.sharedDirector = null;
RemoteConfigManager.firstUseDirector = true;

RemoteConfigManager.getInstance = function () {
    if (RemoteConfigManager.firstUseDirector) {
        RemoteConfigManager.firstUseDirector = false;
        RemoteConfigManager.sharedDirector = new RemoteConfigManager();
    }
    return RemoteConfigManager.sharedDirector;
};

module.exports = RemoteConfigManager;
},{}],27:[function(require,module,exports){
/**
 * Created by oye on 15-5-17.
 */

var ShareManager = cc.Class.extend({
    ctor: function () {
    },

    shareWithSystem: function (tips, url) {
        if (cc.sys.isNative) {
            var fileName = "";
            if (cc.sys.os === cc.sys.OS_IOS) {
                fileName = url;
            }
            jsb_dp.oneSdkBridge.systemShare(fileName, tips);
        }
    },

    openAppWithIdentifier: function (appId) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.openAppWithIdentifier(appId);
        }
    },

    sendEmail: function (address, title, body) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.sendEmail(address, title, body);
        }
    }
});

ShareManager.sharedDirector = null;
ShareManager.firstUseDirector = true;

ShareManager.getInstance = function () {
    if (ShareManager.firstUseDirector) {
        ShareManager.firstUseDirector = false;
        ShareManager.sharedDirector = new ShareManager();
    }
    return ShareManager.sharedDirector;
};

module.exports = ShareManager;
},{}],28:[function(require,module,exports){
/**
 * Created by oye on 15-5-17.
 */
var PaymentInfo = require("../entity/PaymentInfo");
var PaymentCode = require("../enum/PaymentCode");
var ProductInfo = require("../entity/ProductInfo");

var PaymentDelegate = cc.Class.extend({
    /**
     * @param {PaymentCode} error
     * @param {PaymentInfo} paymentInfo
     */
    onPaymentCompleted: function (error, paymentInfo) {
    },

    /**
     * @param {Array.<PaymentInfo>} paymentInfoList
     */
    onGetUnverifiedReceiptList: function (paymentInfoList) {
    },

    /**
     * on get product list.
     * @param {Array.<ProductInfo>} productList
     */
    onGetProductList: function (productList) {
    }
});

var StoreManager = cc.Class.extend({
    /**
     * @type {PaymentDelegate}
     */
    paymentDelegate: null,

    /**
     * @param {Array.<PaymentInfo>} paymentInfoList
     */
    productList: null,

    ctor: function () {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.onGetProductList = this.onGetProductList.bind(this);
            jsb_dp.oneSdkBridge.onPurchase = this.onPurchase.bind(this);
            jsb_dp.oneSdkBridge.onConsume = this.onConsume.bind(this);
            jsb_dp.oneSdkBridge.onGetUnverifiedReceiptList = this.onGetUnverifiedReceiptList.bind(this);
        }
    },

    /**
     * set payment delegate.
     * @param {PaymentDelegate} paymentDelegate
     */
    setPaymentDelegate: function (paymentDelegate) {
        this.paymentDelegate = paymentDelegate;
    },

    onGetProductList: function (jsonResult) {
        cc.log("onGetProductList: " + jsonResult);
        if (jsonResult) {
            var products = JSON.parse(jsonResult);
            if (products && products.length > 0) {
                var productList = [];
                for (var i = 0; i < products.length; ++i) {
                    var productInfo = new ProductInfo();
                    productInfo.unmarshal(products[i]);
                    productList.push(productInfo);
                }
                this.paymentDelegate && this.paymentDelegate.onGetProductList(productList);
                this.productList = productList;
            }
        }
    },

    onPurchase: function (jsonResult) {
        cc.log("onPurchase: " + jsonResult);
        var purchaseResult = JSON.parse(jsonResult);
        var purchaseData;
        if (purchaseResult.errorCode === PaymentCode.PAYMENT_CODE_SUCCESS) {
            purchaseData = JSON.parse(jsonResult);
            this._paymentCompleted(PaymentCode.PAYMENT_CODE_SUCCESS, purchaseData);
        } else {
            purchaseData = JSON.parse(jsonResult);
            this._paymentCompleted(PaymentCode.PAYMENT_CODE_FAIL, purchaseData);
        }
    },

    onConsume: function (jsonInfo) {
        cc.log("onConsume: " + jsonInfo);
    },

    onGetUnverifiedReceiptList: function (purchaseListString) {
        cc.log("onGetUnverifiedReceiptList: " + purchaseListString);
        if (purchaseListString && purchaseListString.length > 0) {
            var purchaseJsonList = JSON.parse(purchaseListString);
            if (purchaseJsonList && purchaseJsonList.length > 0) {
                var purchaseInfoList = [];
                for (var i = 0; i < purchaseJsonList.length; ++i) {
                    var paymentMsg = purchaseJsonList[i];
                    var paymentInfo = new PaymentInfo();
                    paymentInfo.unmarshal(paymentMsg);
                    purchaseInfoList.push(paymentInfo);
                }
                this.paymentDelegate && this.paymentDelegate.onGetUnverifiedReceiptList(purchaseInfoList);
            }
        }

    },

    _paymentCompleted: function (error, paymentMsg) {
        var paymentInfo = new PaymentInfo();
        paymentInfo.unmarshal(paymentMsg);
        if (error === PaymentCode.PAYMENT_CODE_SUCCESS) {
            if (paymentMsg) {
                this.paymentDelegate && this.paymentDelegate.onPaymentCompleted(PaymentCode.PAYMENT_CODE_SUCCESS, paymentInfo);
            } else {
                this.paymentDelegate && this.paymentDelegate.onPaymentCompleted(PaymentCode.PAYMENT_CODE_FAIL, paymentInfo);
            }
        } else {
            this.paymentDelegate && this.paymentDelegate.onPaymentCompleted(PaymentCode.PAYMENT_CODE_FAIL, paymentInfo);
        }
        //if (cc.sys.os !== cc.sys.OS_ANDROID) {
        //    this.consume(paymentInfo.purchaseId);
        //}
    },

    _getNumFromString: function (text) {
        return text.replace(/[^0-9.]/ig, "");
    },

    requestProduct: function (productIds) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.getProductsInfo(productIds);
        }
    },

    payForProduct: function (productId) {
        cc.log("payForProduct:" + productId);
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.purchase(productId);
        }
    },

    consume: function (transactionId) {
        cc.log("consume:" + transactionId);
        if (cc.sys.isNative) {
            if (transactionId && transactionId.length > 0) {
                jsb_dp.oneSdkBridge.consume(transactionId);
            }
        }
    },

    restoreCompletedTransactions: function () {
        cc.log("restoreCompletedTransactions");
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.restoreTransactions();
        }
    },

    getUnverifiedReceiptList: function () {
        cc.log("getUnverifiedReceiptList");
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.getUnverifiedReceiptList();
        }
    },

    _getProductById: function (productId) {
        if (this.productList && this.productList.length > 0) {
            for (var i = 0; i < this.productList.length; ++i) {
                var product = this.productList[i];
                if (product.productId === productId) {
                    return product;
                }
            }
        }
        return null;
    }
});

StoreManager.sharedDirector = null;
StoreManager.firstUseDirector = true;

StoreManager.getInstance = function () {
    if (StoreManager.firstUseDirector) {
        StoreManager.firstUseDirector = false;
        StoreManager.sharedDirector = new StoreManager();
    }
    return StoreManager.sharedDirector;
};

module.exports = StoreManager;
},{"../entity/PaymentInfo":10,"../entity/ProductInfo":12,"../enum/PaymentCode":14}],29:[function(require,module,exports){
var EffectMan = cc.Class.extend({
    ctor: function () {
    },

    playFlyCoins: function (startWorld, endWorld, coinNum, speed, startCallback, endCallback) {
        var parentNode = cc.director.getRunningScene();
        var self = this;
        coinNum = 10;
        //cc.loader.loadRes("prefabs/coins_anim", function (err, prefab) {
        var i = 0;
        while (i < coinNum) {
            var func = function (node, isStart, isEnd) {
                return function () {
                    var cb = null;
                    if (isStart) {
                        cb = startCallback;
                    } else if (isEnd) {
                        cb = endCallback;
                    }
                    self.showFlyAnim(startWorld, endWorld, node, parentNode, speed, cb);
                }
            };
            var newNode = new cc.Sprite("#icon_diamond_effect.png");
            newNode.scale = 0.8;
            newNode.retain();
            var isStart = (i === 0);
            var isEnd = (i === coinNum - 1);
            // 500 => 100 500x = 100, 1000x = 50 500x = -50, x = -0.2
            // 1000 => 50
            setTimeout(func(newNode, isStart, isEnd), (200 - speed / 10) * i);
            i++;
        }
        //});
    },

    showFlyAnim: function (starWorld, endWorld, animNode, parentNode, speed, callback) {
        var start = starWorld;
        var end = endWorld;
        var length = Math.sqrt((start.x - end.x) * (start.x - end.x) + (start.y - end.y) * (start.y - end.y));
        var delay = length / speed;
        parentNode.addChild(animNode, 2000);
        animNode.release();
        animNode.setPosition(start);
        var controlPoints = [
            start,
            this.getPerpendicularPoint(start, end, 50, 0.5),
            end
        ];
        animNode.runAction(cc.sequence(cc.bezierTo(delay, controlPoints), cc.callFunc(function () {
            if (callback) {
                callback();
            }
        }, this), cc.removeSelf()));
    },

    getPerpendicularPoint: function(from, to, dis, factor) {
        var vec = {x: from.x - to.x, y: from.y - to.y};
        var perpendicularVec = {x: vec.y, y: -vec.x};
        var centerPoint = this.lerpPosition(from, to, factor);
        var perpendicularVecLen = Math.sqrt(perpendicularVec.x * perpendicularVec.x + perpendicularVec.y * perpendicularVec.y);
        var perpendicularVecNoraml = {
            x: perpendicularVec.x / perpendicularVecLen,
            y: perpendicularVec.y / perpendicularVecLen
        };
        return new cc.p(centerPoint.x + perpendicularVecNoraml.x * dis,
            centerPoint.y + Math.abs(perpendicularVecNoraml.y * dis));
    },

    lerpPosition: function(pos0,pos1,step){
        return {x:(pos1.x - pos0.x)*step + pos0.x, y:(pos1.y - pos0.y)*step + pos0.y};
    }
});

EffectMan._instance = null;

/**
 * @returns {EffectMan}
 */
EffectMan.getInstance = function() {
    if(!EffectMan._instance) {
        EffectMan._instance = new EffectMan();
    }
    return EffectMan._instance;
}

module.exports = EffectMan;
},{}],30:[function(require,module,exports){
var DAY_IN_SECONDS = 24 * 60 * 60;

var NOTIFICATION_DAYS = [1, 3, 7, 15, 30];
var AdsPlace = require("../enum/AdsPlace");

var LogicMan = cc.Class.extend({
    _isRegisterGameEventListener: false,
    _start: false,
    ctor: function() {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge = jsb_dp.OneSDKJSBridge.getInstance();
            if (jsb_dp.LogicJSBridge && jsb_dp.LogicJSBridge.getInstance) {
                jsb_dp.logicBridge = jsb_dp.LogicJSBridge.getInstance();
            }
        }

        var EventDispatcher = require("../events/EventDispatcher");
        var NotificationManager = require("../manager/NotificationManager");
        var AnalyseManager = require("../manager/AnalyseManager");
        var StoreManager = require("../manager/StoreManager");
        var GCManager = require("../manager/GCManager");
        var RateManager = require("../manager/RateManager");
        var PlayerMan = require("../model/PlayerMan");
        var StorageController = require("../storage/StorageController");
        var AdsManager = require("../manager/AdsManager");
        var AudioPlayer = require("../audio/AudioPlayer");
        var Utils = require("../util/Utils");
        var ShareManager = require("../manager/ShareManager");
        var DialogManager = require("../popup/DialogManager");
        var AssetsManager = require("../assets/AssetsManager");

        var BaseCCBController = require("../controller/BaseCCBController");
        var AudioHelper = require("../util/AudioHelper");
        var CaptureManager = require("../manager/CaptureManager");
        var LocalizationManager = require("../manager/LocalizationManager");
        var CrossPromManager = require("../manager/CrossPromManager");
        var EffectMan = require("../model/EffectMan");
        var RemoteConfigManager = require("../manager/RemoteConfigManager");

        window.game = {};
        window.game.utils = Utils;
        window.game.eventDispatcher = EventDispatcher.getInstance();
        window.game.logicMan = this;
        window.game.notificationManager = NotificationManager.getInstance();
        window.game.analyseManager = AnalyseManager.getInstance();
        window.game.storeManager = StoreManager.getInstance();
        window.game.gcManager = GCManager.getInstance();
        window.game.rateManager = RateManager.getInstance();
        window.game.playerMan = PlayerMan.getInstance();
        window.game.storageController = StorageController.getInstance();
        window.game.adsManager = AdsManager.getInstance();
        window.game.audioPlayer = AudioPlayer.getInstance();
        window.game.shareManager = ShareManager.getInstance();
        window.game.dialogManager = DialogManager.getInstance();
        window.game.assetsManager = AssetsManager.getInstance();
        window.game.captureManager = CaptureManager.getInstance();
        window.game.local = LocalizationManager.getInstance();
        window.game.effectMan = EffectMan.getInstance();
        //window.game.abtest = ABTest;
        window.game.remoteConfig = RemoteConfigManager.getInstance();

        window.BaseCCBController = BaseCCBController;
        window.AudioHelper = AudioHelper;

        var GameBridge = require("../bridge/GameBridge");
        window.GameBridge = GameBridge;
        window.game.config = GameBridge.getConfig();
        window.game.popupMan = GameBridge.getPopupMan();
        window.game.gameMan = GameBridge.getGameMan();

        window.game.crossPromMan = CrossPromManager.getInstance();
        window.game.adsHelper = GameBridge.getAdsHelper();
        window.game.challengeMan = GameBridge.getChallengeMan();
        window.game.activityTaskType = GameBridge.getActivityTaskType();
        window.game.activityMan = GameBridge.getActivityMan();
        window.game.abTestType = GameBridge.getABTestType();
        window.game.configMan = GameBridge.getConfigMan();
        window.game.storeMan = GameBridge.getStoreMan();
        window.game.adsPlace = AdsPlace;

        _ = function (key) {
            return game.local.getValue(key);
        };
    },

    init: function () {
    },

    registerGameEventListener: function() {
        if(!this._isRegisterGameEventListener) {
            this._isRegisterGameEventListener = true;
            game.eventDispatcher.addCustomEventListener(cc.game.EVENT_SHOW, this.gameOnShow, this);
            game.eventDispatcher.addCustomEventListener(cc.game.EVENT_HIDE, this.gameOnHide, this);
        }
    },

    purge: function() {
        game.eventDispatcher.removeCustomEventListener(cc.game.EVENT_SHOW, this.gameOnShow, this);
        game.eventDispatcher.removeCustomEventListener(cc.game.EVENT_HIDE, this.gameOnHide, this);
    },

    gameOnShow: function() {
        game.notificationManager.unscheduleNotification();

        game.adsManager.onGameOnShow();

        this.tryRollbackData();

        setTimeout(function () {
            game.adsHelper.showBackgroundAds();
        }.bind(this), 100);
    },

    gameOnHide: function() {
        if (cc.sys.isNative) {
            this.scheduleLocalNotification();
        }
        game.adsManager.setInterstitialShowed(AdsPlace.BackGround);
        this.lastHideTime = Date.now();
    },

    registerNotification: function () {
        game.notificationManager.registerNotification();
    },

    startGame: function (notInitPlayer) {
        if (this._start) {
            return;
        }
        this._start = true;
        game.notificationManager.unscheduleNotification();
        this.registerGameEventListener();

        if (!notInitPlayer) {
            game.playerMan.initData();
        }
        game.configMan.reload();
        game.adsManager.init();
        game.adsManager.loadRemoteData();
        game.analyseManager.initAnalytics();
        game.gcManager.isGameCenterAvailable();
        game.rateManager.init(3, 1, 0.5, 0.5, true);
        game.analyseManager.trackLoginEvent();
        game.crossPromMan.tryToLoadFromRemote();
        game.adsManager.setIsNewPlayer(game.playerMan.isNewPlayer());

        this.tryRollbackData();
    },

    scheduleLocalNotification: function () {
        if (!cc.sys.isNative) {
            return;
        }

        var leftTimeSeconds = Math.floor(game.gameMan.getWheelLeftTime() / 1000);
        if (leftTimeSeconds < 30 * 60) {
            leftTimeSeconds = 30 * 60;
        }
        var index = 1;
        //wheel notification.
        game.notificationManager.scheduleNotification(leftTimeSeconds,
            _("wheel_is_ready"), game.local.getValue("app_name"), index++);

        //daily bonus notification.
        var lastClaimDay = game.playerMan.player.lastClaimDailyBonusDay;
        var currentDayClaimed = (lastClaimDay >= game.utils.getDayByTs(Date.now()));
        var dailyBonusSeconds = 0;
        if (currentDayClaimed) {
            var nextDayTime = (game.utils.getDayByTs(Date.now()) + 1) * (24 * 3600 * 1000);
            dailyBonusSeconds = (nextDayTime - Date.now()) / 1000;
        }
        if (dailyBonusSeconds <= 60 * 60) {
            dailyBonusSeconds = 60 * 60;
        }
        game.notificationManager.scheduleNotification(dailyBonusSeconds,
            _("daily_bonus_is_ready"), game.local.getValue("app_name"), index++);

        var maxTime = Math.max(leftTimeSeconds, dailyBonusSeconds);

        //normal notification.
        for (var i = 0; i < NOTIFICATION_DAYS.length; ++i) {
            game.notificationManager.scheduleNotification(maxTime + DAY_IN_SECONDS * NOTIFICATION_DAYS[i],
                game.local.getValue(game.utils.sprintf("noti_tips%d", i + 1)), game.local.getValue("app_name"), index++);
        }
    },

    rsyncUserDataFromGC: function () {
        //var highLevel = game.gcManager.highScoreForLeaderboard(game.config.getLeaderBoardKey());
        //if (highLevel > game.playerMan.getLevel()) {
        //    game.playerMan.setLevel(highLevel);
        //}
    },

    tryRollbackData: function () {
        if (game.playerMan.player.currentDay !== game.utils.getCurrentDay()) {
            game.playerMan.resetDailyTaskData();
            game.playerMan.resetCurrentDay();
        }
    }
});

LogicMan._instance = null;
LogicMan._firstUseInstance = true;

/**
 *
 * @returns {LogicMan}
 */
LogicMan.getInstance = function () {
    if (LogicMan._firstUseInstance) {
        LogicMan._firstUseInstance = false;
        LogicMan._instance = new LogicMan();
    }
    return LogicMan._instance;
};

module.exports = LogicMan;
},{"../assets/AssetsManager":2,"../audio/AudioPlayer":4,"../bridge/GameBridge":5,"../controller/BaseCCBController":6,"../enum/AdsPlace":13,"../events/EventDispatcher":15,"../manager/AdsManager":18,"../manager/AnalyseManager":19,"../manager/CaptureManager":20,"../manager/CrossPromManager":21,"../manager/GCManager":22,"../manager/LocalizationManager":23,"../manager/NotificationManager":24,"../manager/RateManager":25,"../manager/RemoteConfigManager":26,"../manager/ShareManager":27,"../manager/StoreManager":28,"../model/EffectMan":29,"../model/PlayerMan":31,"../popup/DialogManager":33,"../storage/StorageController":35,"../util/AudioHelper":36,"../util/Utils":38}],31:[function(require,module,exports){
/**
 * Created by qinning on 15/5/12.
 */
var PlayerInfo = require("../entity/PlayerInfo");

var PLAYER_KEY = "player_key";

var PlayerMan = cc.Class.extend({
    player: null,
    bestScoreKey: null,
    levelBoardKey: null,
    ctor: function () {
    },

    initData: function () {
        var playerInfoStr = game.storageController.getItem(PLAYER_KEY, null);
        var player;
        if (playerInfoStr == null || playerInfoStr == "") {
            player = PlayerInfo.createDefault();
            game.storageController.setItem(PLAYER_KEY, JSON.stringify(player));
        } else {
            player = new PlayerInfo();
            player.unmarshall(JSON.parse(playerInfoStr));
        }
        this.player = player;
    },

    getBestScore: function () {
        return this.player.bestScore;
    },

    getLevel: function () {
        if (cc.isUndefined(this.player.level)) {
            return 1;
        } else {
            return this.player.level;
        }
    },

    setLevel: function (level) {
        this.player.level = level;
        this._flushToStorage();
    },

    updateLevelStar: function (level, levelStar) {
        if (cc.isUndefined(this.player.levelMap[level]) || this.player.levelMap[level] < levelStar) {
            this.player.levelMap[level] = levelStar;
            game.gcManager.reportScore(level, this.getLevelBoardKey());
            this._flushToStorage();
        }
    },

    getLevelStar: function (level) {
        return this.player.levelMap[level] || 0;
    },

    addLevel: function () {
        game.gcManager.reportScore(this.player.level, this.getLevelBoardKey());
        this.player.level++;
        this.player.progress = 0;
        this._flushToStorage();
    },

    updateBestScore: function (newBestScore) {
        if (newBestScore > this.player.bestScore) {
            this.player.bestScore = newBestScore;
            game.gcManager.reportScore(newBestScore, this.getBestScoreBoardKey());
            this._flushToStorage();
            return true;
        }
        return false;
    },

    getLevelBoardKey: function () {
        return this.levelBoardKey || game.config.getLeaderBoardKey();
    },

    getBestScoreBoardKey: function () {
        return this.bestScoreKey || game.config.getLeaderBoardKey();
    },

    setLevelBoardKey: function (key) {
        this.levelBoardKey = key;
    },

    setBestScoreBoardKey: function (bestScoreKey) {
        this.bestScoreKey = bestScoreKey;
    },

    updateProgress: function (progress) {
        if (this.player.progress < progress) {
            this.player.progress = progress;
            this._flushToStorage();
        }
    },

    removedAds: function () {
        this.player.removedAds = true;
        game.adsManager.removeBannerAds();
        this._flushToStorage();
    },

    setRated: function () {
        this.player.rated = true;
        this._flushToStorage();
    },

    _flushToStorage: function () {
        game.storageController.setItem(PLAYER_KEY, JSON.stringify(this.player));
    }
});

PlayerMan._instance = null;
PlayerMan._firstUseInstance = true;

/**
 *
 * @returns {PlayerMan}
 */
PlayerMan.getInstance = function () {
    if (PlayerMan._firstUseInstance) {
        PlayerMan._firstUseInstance = false;
        PlayerMan._instance = new PlayerMan();
    }
    return PlayerMan._instance;
};

module.exports = PlayerMan;
},{"../entity/PlayerInfo":11}],32:[function(require,module,exports){
/**
 * Created by qinning on 15/4/22.
 */
var HttpClient = {

    /**
     * get request,jsb ok,html5 shows  No 'Access-Control-Allow-Origin' header is present on the requested resource
     * @param {string} url
     * @param {function} callback
     */
    doGet: function (url, callback) {
        var xhr = cc.loader.getXMLHttpRequest();
        xhr.open("GET", url, true);

        xhr.onreadystatechange = function () {
            cc.log("readyState:"+xhr.readyState+",status:"+xhr.status+",statuText:"+xhr.statusText+",,,responseText:"+xhr.responseText);
            if (xhr.readyState == 4 && xhr.status == 200) {
                var httpStatus = xhr.statusText;
                var response = xhr.responseText;
                callback(null,response);
            }else{
                callback(xhr.statusText);
            }
        };
        xhr.send();
    },

    /**
     *
     * @param {string} url
     * @param {string} param
     * @param {Object.<string,string>} headers
     * @param {Function} callback
     */
    doPost: function (url, params, headers, callback) {
        var xhr = cc.loader.getXMLHttpRequest();
        xhr.open("POST", url);
        for (var key in headers) {
            xhr.setRequestHeader(key, headers[key]);
        }
        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4) {
                if (xhr.status >= 200 && xhr.status <= 207) {
                    callback(null, xhr.responseText);
                } else {
                    callback(xhr.status, xhr.statusText);
                }
            }
        };
        try {
            xhr.send(params);
        } catch (e) {
        }
    }
};

module.exports = HttpClient;
},{}],33:[function(require,module,exports){
var ModalLayer = require("./ModalLayer");

var DialogManager = cc.Class.extend({
    DIALOG_ZORDER_BEGIN: 999,
    DIALOG_ZORDER_STEP: 2,

    /**
     * @types {ModalLayer}
     */
    _overlay: null,
    _scaleFactor: 0,
    /**
     * @types {Array.<ModalLayer>}
     */
    _dialogStack: null,

    ctor: function () {
    },

    createOverlay: function () {
        this._overlay = new ModalLayer();
        this._overlay.setColor(cc.color.BLACK);
        this._overlay.setOpacity(190);
        this._overlay.setContentSize(cc.size(cc.winSize.width, cc.winSize.height));
        this._overlay.setLocalZOrder(999);
        this._overlay.retain();
        this._scaleFactor = 1.0;
        this._dialogStack = [];
    },

    popup: function (dlg, param) {
        dlg.ignoreAnchorPointForPosition(false);
        dlg.setScale(this._scaleFactor);
        var dlgLen = this._dialogStack.length;
        cc.log("dlgLen:" + dlgLen);
        if (dlgLen == 0) {
            dlg.setLocalZOrder(this.DIALOG_ZORDER_BEGIN);
        }
        else {
            dlg.setLocalZOrder(this._dialogStack[dlgLen - 1].getLocalZOrder() + this.DIALOG_ZORDER_STEP);
        }
        this._dialogStack.push(dlg);

        if (param && param.withoutOverlay) {

        } else {
            this._overlay.setLocalZOrder(dlg.getLocalZOrder() - 1);
            if (this._overlay.getParent() == null) {
                this.attachScene(this._overlay);
            }
            if (param && param.overlayColor) {
                this._overlay.setColor(param.overlayColor);
            } else {
                this._overlay.setColor(cc.color.BLACK);
            }

            if (param && param.overlayOpacity) {
                this._overlay.setOpacity(param.overlayOpacity);
            } else {
                this._overlay.setOpacity(190);
            }
        }

        if (param && param.popupAnim) {
            if (dlg.getChildren() && dlg.getChildren().length > 0) {
                //this._overlay.setLocalZOrder(dlg.getLocalZOrder() + 1);
                this.popupDialogAnim(dlg.getChildren()[0], function () {
                    //this._overlay.setLocalZOrder(dlg.getLocalZOrder() - 1);
                }, this);
            }
        }

        this.attachScene(dlg);

        game.eventDispatcher.dispatchEvent("dialog_poped");
    },

    popupDialogAnim: function (panel,callback,callbackTarget) {
        panel.setScale(0.8, 0.8);
        panel.runAction(cc.sequence(
            cc.scaleTo(0.066, 1.05, 1.05).easing(cc.easeOut(2)),
            cc.scaleTo(0.05, 0.98, 0.98).easing(cc.easeOut(2)),
            cc.scaleTo(0.084, 1, 1).easing(cc.easeOut(2)),
            cc.callFunc(callback, callbackTarget)
        ));
    },

    attachScene: function (node) {
        cc.director.getRunningScene().addChild(node);
    },

    close: function (dlg, dispose) {
        if (cc.isUndefined(dispose)) {
            dispose = true;
        }
        var closeIndex;
        var dlgLen = this._dialogStack.length;
        for (closeIndex = dlgLen - 1; closeIndex >= 0; --closeIndex) {
            if (dlg === this._dialogStack[closeIndex]) {
                break;
            }
        }

        if (closeIndex >= 0) {
            this._dialogStack.splice(closeIndex, 1);
            dlgLen = this._dialogStack.length;
            dlg.removeFromParent(dispose);
        } else {
            return;
        }

        if (this._overlay.getParent() != null) {
            if (dlgLen === 0) {
                this._overlay.removeFromParent(false);
            } else {
                var topIndex = dlgLen - 1;

                if (topIndex >= 0) {
                    this._overlay.setLocalZOrder(this._dialogStack[topIndex].getLocalZOrder() - 1);
                } else {
                    this._overlay.removeFromParent(false);
                    this._dialogStack.length = 0;
                }
            }
        }
        game.eventDispatcher.dispatchEvent("dialog_closed");
    },

    closeAll: function () {
        var dlgLen = this._dialogStack.length;
        while (dlgLen != 0) {
            var modalLayer = this._dialogStack[dlgLen - 1];
            this.close(modalLayer, true);
            dlgLen = this._dialogStack.length;
        }
    },

    isTopestDialog: function (node) {
        return (this._dialogStack[this._dialogStack.length - 1] === node);
    },

    hasDlg: function () {
        return this._dialogStack.length > 0;
    }

});

DialogManager._instance = null;
DialogManager._firstUseInstance = true;

/**
 *
 * @returns {DialogManager}
 */
DialogManager.getInstance = function () {
    if (DialogManager._firstUseInstance) {
        DialogManager._firstUseInstance = false;
        DialogManager._instance = new DialogManager();
    }
    return DialogManager._instance;
};

module.exports = DialogManager;
},{"./ModalLayer":34}],34:[function(require,module,exports){
/**
 * Created by qinning on 15/4/28.
 */
var ModalLayer = cc.LayerColor.extend({
    ctor:function(){
        this._super();
        cc.eventManager.addListener({
            event: cc.EventListener.TOUCH_ONE_BY_ONE,
            swallowTouches: true,
            onTouchBegan: this.onTouchBegan.bind(this)
        }, this);
    },
    onTouchBegan:function(touch, event) {
        if(!this.isVisible() || (!this.isTouchInside(this,touch))){
            return false;
        }
        return true;
    },
    isTouchInside: function (owner,touch) {
        if(!owner || !owner.getParent()){
            return false;
        }
        var touchLocation = touch.getLocation(); // Get the touch position
        touchLocation = owner.getParent().convertToNodeSpace(touchLocation);
        return cc.rectContainsPoint(owner.getBoundingBox(), touchLocation);
    }
});

module.exports = ModalLayer;
},{}],35:[function(require,module,exports){
/**
 * Created by qinning on 15/4/23.
 */

var StorageController = cc.Class.extend({
    setItem: function (key, value) {
        cc.sys.localStorage.setItem(key, value);
    },
    getItem: function (key, defaultValue) {
        var value = cc.sys.localStorage.getItem(key);
        if (value == "" || value == null) {
            return defaultValue;
        }
        return value;
    },
    removeItem: function (key) {
        cc.sys.localStorage.removeItem(key);
    }
});

StorageController._instance = null;
StorageController._firstUseInstance = true;

/**
 *
 * @returns {StorageController}
 */
StorageController.getInstance = function () {
    if (StorageController._firstUseInstance) {
        StorageController._firstUseInstance = false;
        StorageController._instance = new StorageController();
    }
    return StorageController._instance;
};

module.exports = StorageController;
},{}],36:[function(require,module,exports){
/**
 * Created by oye on 16/3/12.
 */

var AudioHelper = {
    playBtnSound: function () {
        game.audioPlayer.playEffectByKey("enter");
    }
};

module.exports = AudioHelper;
},{}],37:[function(require,module,exports){
var FileCacheStub = function() {
    this.cachedFiles = [];
};

FileCacheStub.prototype.cacheFile = function(filename) {
    if (cc.sys.isNative) {
        if(cc.sys.os == cc.sys.OS_ANDROID) {
            // cc.log("FileCacheStub.prototype.cacheFile.android");
            if(jsb.fileUtils.cacheFile) {
                var ret = jsb.fileUtils.cacheFile(filename);
                // cc.log("FileCacheStub.prototype.cacheFile ----> cache:" + filename + ", ret:" + ret);
                this.cachedFiles.push(filename);
            }
        }
    }
};

FileCacheStub.prototype.clear = function() {
    if (cc.sys.isNative) {
        if(cc.sys.os == cc.sys.OS_ANDROID) {
            if (jsb.fileUtils.uncacheFile) {
                this.cachedFiles.forEach(function (filename) {
                    jsb.fileUtils.uncacheFile(filename);
                    // cc.log("FileCacheStub.prototype.dispose ----> uncached file " + filename);
                });
            }
            this.cachedFiles = [];
        }
    }
};

module.exports = FileCacheStub;
},{}],38:[function(require,module,exports){
/**
 * Created by oye on 15-4-19.
 */
var timespan = require('timespan');

var Utils = {
    /**
     * Generate a random integer value which meets [0, upperValue)
     * @param {number} upperValue
     * @returns {number}
     */
    randomNextInt: function(upperValue) {
        return Math.floor(Math.random() * upperValue);
    },

    /**
     * generate a random number value which meets [0, upperValue)
     * @param upperValue
     * @returns {number}
     */
    randomNextNumber: function (upperValue) {
        return Math.random() * upperValue;
    },

    /**
     * random a integer from [min, max]
     * @param {number} min
     * @param {number} max
     * @returns {number}
     */
    rangeNextInt: function(min, max) {
        return min + this.randomNextInt(max - min + 1);
    },

    rangeNextNumber: function (min, max) {
        return min + this.randomNextNumber(max - min);
    },

    /**
     * Generate a random number value which meets [lowerValue, upperValue)
     * @param {number} lowerValue
     * @param {number} upperValue
     * @returns {number}
     */
    randomNextNumberInRange: function (lowerValue, upperValue) {
        return Math.random() * (upperValue - lowerValue) + lowerValue;
    },

    /**
     * Generate a random integer value which meets [lowerValue, upperValue)
     * @param {number} lowerValue
     * @param {number} upperValue
     * @returns {number}
     */
    randomNextIntInRange: function (lowerValue, upperValue) {
        return Math.floor(Math.random() * (upperValue - lowerValue) + lowerValue);
    },

    /**
     * 格式化字符串
     * @returns {string}
     */
    sprintf: function () {
        var i = 0, a, f = arguments[i++], o = [], m, p, c, x, s = '';
        while (f) {
            if (m = /^[^\x25]+/.exec(f)) {
                o.push(m[0]);
            }
            else if (m = /^\x25{2}/.exec(f)) {
                o.push('%');
            }
            else if (m = /^\x25(?:(\d+)\$)?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(f)) {
                if (((a = arguments[m[1] || i++]) == null) || (a == undefined)) {
                    throw('Too few arguments.');
                }
                if (/[^s]/.test(m[7]) && (typeof(a) != 'number')) {
                    throw('Expecting number but found ' + typeof(a));
                }
                switch (m[7]) {
                    case 'b':
                        a = a.toString(2);
                        break;
                    case 'c':
                        a = String.fromCharCode(a);
                        break;
                    case 'd':
                        a = parseInt(a);
                        break;
                    case 'e':
                        a = m[6] ? a.toExponential(m[6]) : a.toExponential();
                        break;
                    case 'f':
                        a = m[6] ? parseFloat(a).toFixed(m[6]) : parseFloat(a);
                        break;
                    case 'o':
                        a = a.toString(8);
                        break;
                    case 's':
                        a = ((a = String(a)) && m[6] ? a.substring(0, m[6]) : a);
                        break;
                    case 'u':
                        a = Math.abs(a);
                        break;
                    case 'x':
                        a = a.toString(16);
                        break;
                    case 'X':
                        a = a.toString(16).toUpperCase();
                        break;
                }
                a = (/[def]/.test(m[7]) && m[2] && a >= 0 ? '+' + a : a);
                c = m[3] ? m[3] == '0' ? '0' : m[3].charAt(1) : ' ';
                x = m[5] - String(a).length - s.length;
                p = m[5] ? str_repeat(c, x) : '';
                o.push(s + (m[4] ? a + p : p + a));
            }
            else {
                throw('sprintf params error');
            }
            f = f.substring(m[0].length);
        }
        return o.join('');
    },

    getDistance : function(point1,point2){
        return Math.sqrt((point1.x - point2.x) * (point1.x - point2.x) + (point1.y - point2.y) * (point1.y - point2.y));
    },

    arrayContain : function (arr, element) {
        if(arr && arr.length > 0) {
            for(var i = 0; i < arr.length; ++i) {
                if(arr[i] == element) {
                    return true;
                }
            }
        }
        return false;
    },

    /**
     * @param {string} ccbFileName
     * @param {string} containerNode
     * @param {string} controllerName
     * @param {object | cc.Node} controllerNode
     * @returns {cc.Node | null}
     */
    loadNodeFromCCB : function(ccbFileName,containerNode,controllerName,controllerNode, keepController){
        cc.log("load node from ccb:" + ccbFileName);
        Utils.setTrackValue("ccbName", ccbFileName);
        if(!cc.isUndefined(controllerName) && !cc.isUndefined(controllerNode)){
            cc.BuilderReader.registerController(controllerName,controllerNode);
        }
        var node = cc.BuilderReader.load(ccbFileName, containerNode);
        if (controllerName && controllerNode && !keepController) {
            cc.BuilderReader._controllerClassCache[controllerName] = undefined;
        }
        node.retain();
        cc.log("load node retain:" + ccbFileName);
        this.executeInNextFrame(function () {
            cc.log("load node release:" + ccbFileName);
            node.release();
        });
        return node;
    },

    registerController: function (controllerName, controllerNode) {
        cc.BuilderReader.registerController(controllerName, controllerNode);
    },

    unRegisterController: function (controllerName) {
        cc.BuilderReader._controllerClassCache[controllerName] = undefined;
    },

    /**
     *
     * @param {function} subType
     * @param {function} superType
     */
    inherits: function(subType, superType) {
        var subPrototype = Object.create(superType.prototype);
        subPrototype.constructor = subType;
        subType.prototype = subPrototype;
    },

    /**
     *
     * @param {string} url
     * @returns {Object}
     */
    loadJson: function (url) {
        if (!cc.sys.isNative) {
            return cc.loader.getRes(url);
        } else {
            if(jsb.fileUtils.isFileExist(url)) {
                return JSON.parse(jsb.fileUtils.getStringFromFile(url));
            } else {
                return null;
            }
        }
    },

    loadPlist: function (url) {
        if (!cc.sys.isNative) {
            return cc.loader.getRes(url);
        } else {
            if(jsb.fileUtils.isFileExist(url)) {
                return cc.plistParser.parse(jsb.fileUtils.getStringFromFile(url));
            } else {
                return null;
            }
        }
    },

    getScreenShot: function (fileName) {
        cc.log("fileName:" + fileName);
        var tex = new cc.RenderTexture(cc.winSize.width, cc.winSize.height, cc.Texture2D.PIXEL_FORMAT_RGBA8888);
        tex.setPosition(cc.p(cc.winSize.width / 2, cc.winSize.height / 2));
        tex.begin();
        cc.director.getRunningScene().visit();
        tex.end();

        var imgPath = jsb.fileUtils.getWritablePath();
        if (imgPath.length == 0) {
            return "";
        }
        var result = tex.saveToFile(fileName, cc.IMAGE_FORMAT_JPEG);
        if (result) {
            imgPath += fileName;
            cc.log("save image:" + imgPath);
            return imgPath;
        }
        return "";
    },

    isPad: function () {
        if (jsb_dp.oneSdkBridge.isPad) {
            return jsb_dp.oneSdkBridge.isPad();
        }
        var winSize = cc.winSize;
        if (!!GameBridge.getConfig().horizontalGame) {
            return (winSize.width / winSize.height < 1.5);
        } else {
            return (winSize.height / winSize.width < 1.5);
        }
    },

    getFormatRotation: function (rotation) {
        return ((rotation % 360) + 360) % 360;
    },

    doClipping: function (maskLayer, clipLayer) {
        if(maskLayer && clipLayer){
            var clipParentNode = clipLayer.getParent();
            clipLayer.retain();
            clipLayer.removeFromParent(false);

            maskLayer.removeFromParent(false);
            maskLayer.visible = true;

            var clippingNode = new cc.ClippingNode(maskLayer);
            clippingNode.alphaThreshold = 1;
            clippingNode.addChild(clipLayer);
            clipLayer.release();

            clipParentNode.addChild(clippingNode);
        }
    },

    isPixelCollision: function (spr1, spr2) {
        if (cc.sys.isNative) {
            return jsb_dp.oneSdkBridge.isPixelCollision(spr1, spr2);
        } else {
            return cc.rectIntersectsRect(spr1.getBoundingBox(), spr2.getBoundingBox());
        }
    },

    scaleCCLabelBMFont: function (label, maxWidth) {
        if (label.width > maxWidth) {
            var scaleFactor = maxWidth / label.width;
            label.scaleX = label.scaleY = scaleFactor;
        } else {
            label.scaleX = label.scaleY = 1.0;
        }
    },

    scaleCCLabelBMFontWithMaxScale: function (label, maxWidth, maxScale) {
        if (label.width * label.scaleX > maxWidth) {
            label.scaleX = label.scaleY = maxWidth / label.width;
        }
        if (label.scaleX > maxScale) {
            label.scaleX = label.scaleY = maxScale;
        }
    },

    scaleSpriteFrame: function (sprite, frameName) {
        var originalWidth = sprite.width * sprite.scaleX;
        sprite.setSpriteFrame(frameName);
        sprite.scale = originalWidth / sprite.width;
    },

    /**
     *
     * @param {cc.Node} node
     */
    walkNode: function (node, cb) {
        if(node) {
            var more = cb(node);
            if(more) {
                for(var k in node.children) {
                    more = this.walkNode(node.children[k], cb);
                    if(!more)
                        break;
                }
            }
            return more;
        }
        else {
            return true;
        }
    },

    isNodeButton: function(nd) {
        return (nd instanceof cc.ControlButton);
    },

    isNodeMenuItem: function(nd) {
        return (nd instanceof cc.MenuItem || nd instanceof cc.MenuItemImage);
    },

    isLabelBMFont:function (nd) {
        return (nd instanceof cc.LabelBMFont || nd instanceof cc.Label);
    },

    /**
     * Load an image with the given url
     * @param {string} url
     * @param {function} callback - function(error, texture, extra)
     * @param {*} extra
     */
    loadRemoteImg: function (url, callback, extra) {
        if (!cc.sys.isNative) {
            cc.loader.loadImg(url, {isCrossOrigin: true}, function (error, img) {
                var texture2d = new cc.Texture2D();
                texture2d.initWithElement(img);
                texture2d.handleLoadedTexture();
                callback(error, texture2d, extra);
            });
        } else {
            cc.loader.loadImg(url, {isCrossOrigin: true}, function (error, texture2d) {
                callback(error, texture2d, extra);
            });
        }
    },

    playCCBAnimation: function(node, anmName){
        var animMgr = node.animationManager;
        var seqId;
        if(anmName) {
            if (cc.sys.isNative){
                seqId = animMgr.getSequenceId(anmName);
            }
            else{
                seqId = animMgr._getSequenceId(anmName);
            }
        } else {
            seqId = animMgr.getAutoPlaySequenceId();
        }

        if (seqId != -1){
            if(!anmName) {
                animMgr.runAnimationsForSequenceIdTweenDuration(seqId, 0);
            } else {
                animMgr.runAnimationsForSequenceNamed(anmName);
            }
            return true;
        } else {
            cc.log("animation " + anmName + " not exists!");
            return false;
        }
    },

    randomScaleAnim: function (spr, startScale, totalTime) {
        totalTime = this.randomNextNumberInRange(totalTime * 0.8, totalTime * 1.2);
        var delayTime = this.randomNextNumber(totalTime / 2);

        var scaleBigTime = 0.3 * (totalTime - delayTime) * 2;
        var scaleSmallTime = 0.1 * (totalTime - delayTime) * 2;
        var scaleNormalTime = 0.1 * (totalTime - delayTime) * 2;

        spr.stopAllActions();
        spr.setScale(0);
        spr.runAction(cc.sequence(cc.delayTime(delayTime),
            cc.scaleTo(scaleBigTime, 1.1 * startScale).easing(cc.easeInOut(2)) ,
            cc.scaleTo(scaleSmallTime, 0.9 * startScale).easing(cc.easeInOut(2)),
            cc.scaleTo(scaleNormalTime, 1 * startScale).easing(cc.easeInOut(2))));
    },

    getFormatTime: function (time) {
        var decimals = time - Math.floor(time);
        time = Math.floor(time);
        if (time <= 60) {
            return "" + (time + decimals).toFixed(2);
        } else if (time <= 3600) {
            return Math.floor(time / 60) + ":" + ((time % 60) + decimals).toFixed(2);
        } else {
            return Math.floor(time / 3600) + ":" + Math.floor(time % 3600 / 60) + ":" + ((time % (3600 * 60)) + decimals).toFixed(2);
        }
    },

    getLongFormatTime: function (time) {
        return this.getTwoDigit(Math.floor(time / 3600)) +
            ":" + this.getTwoDigit(Math.floor(time % 3600 / 60)) +
            ":" +  this.getTwoDigit(Math.floor(time % 3600 % 60));
    },

    getLetterTime: function (millisecond) {
        var timeSpan = timespan.fromSeconds(millisecond / 1000);
        if (!timeSpan) {
            return "0m 0s";
        }
        if (timeSpan.totalDays(true) > 0) {
            return Utils.sprintf("%dd %dh", timeSpan.totalDays(true), timeSpan.hours);
        } else {
            if (timeSpan.totalHours(true) > 0) {
                return Utils.sprintf("%dh %dm", timeSpan.totalHours(true), timeSpan.minutes);
            } else {
                return Utils.sprintf("%dm %ds", timeSpan.totalMinutes(true), timeSpan.seconds);
            }
        }
    },

    getTwoDigit: function (num) {
        if (num >= 0 && num <= 9) {
            return "0" + num;
        }
        return "" + num;
    },

    seekNodeByTag: function (rootNode, tag) {
        if (null === rootNode){
            return null;
        }
        if(rootNode.getTag() === tag){
            return rootNode;
        }
        var arrayRootChildren = rootNode.getChildren();
        if(arrayRootChildren && arrayRootChildren.length > 0) {
            var length = arrayRootChildren.length;
            for(var i = 0; i < length; i++) {
                var child = arrayRootChildren[i];
                if (null !== child){
                    var res = this.seekNodeByTag(child, tag);
                    if (null !== res) {
                        return res;
                    }
                }
            }
        }
        return null;
    },

    autoRelease: function (obj) {
        Utils.executeInNextFrame(function () {
            obj.release();
        });
    },

    executeInNextFrame: function (callback) {
        setTimeout(function () {
            if (callback) {
                callback();
            }
        }, 0);
    },

    isIOS: function () {
        if (cc.sys.os === cc.sys.OS_IOS) {
            return true;
        }
        return false;
    },

    getDayByTs: function(ts) {
        return Math.floor(ts / (1000 * 3600 * 24));
    },

    getCurrentDay: function () {
        var now = new Date();
        return now.getFullYear() * 365 + now.getMonth() * 12 + now.getDate();
    },

    isSelfGame: function () {
        if (cc.sys.os === cc.sys.OS_IOS) {
            if (cc.sys.language === cc.sys.LANGUAGE_CHINESE) {
                return true;
            }
        } else {
            //var platformName = jsb_dp.oneSdkBridge.getChannelName();
            //if (platformName === "taptap") {
            //    return true;
            //}
            return this.isAndroidAndSelfGame();
        }
        return false;
    },

    isAndroidAndSelfGame: function () {
        return false;
        var platformName = jsb_dp.oneSdkBridge.getChannelName();
        if (platformName === "taptap") {
            return true;
        }
        return false;
    },

    getDashPointsNode: function (parent, points, dashArray, dashOffset, addDotFunc) {
        var lastx = points[0].x,
            lasty = points[0].y;

        var dx, dy;

        var totalLength = 0;
        var length = 0;

        var dashLength = dashArray.length;
        var dashIndex = 0;

        var from = dashOffset;
        var drawLength = dashArray[dashIndex];
        var to = dashOffset + drawLength;

        var x1, y1;
        var x, y;

        //var parent = new cc.Node();

        for (var i = 0, l = points.length; i < l; i++) {
            x = points[i].x;
            y = points[i].y;

            if (i !== 0) {
                dx = x - lastx;
                dy = y - lasty;

                length = Math.sqrt(dx * dx + dy * dy);

                if (!x1) x1 = lastx;
                if (!y1) y1 = lasty;

                while (length > 0) {
                    if (totalLength + length < from) {
                        totalLength += length;
                        length = 0;

                        x1 = x;
                        y1 = y;

                        continue;
                    }

                    if (totalLength <= from) {
                        var difLength = from - totalLength;
                        var p = difLength / length;

                        x1 = x1 + p * (x - x1);
                        y1 = y1 + p * (y - y1);

                        //ctx.moveTo(x1, y1);
                        addDotFunc(x1, y1)

                        length -= difLength;
                        totalLength += difLength;
                    }

                    if ((totalLength + length) < to) {
                        x1 = x;
                        y1 = y;

                        //ctx.lineTo(x1, y1);
                        addDotFunc(x1, y1);

                        totalLength += length;
                        length = 0;
                    }
                    else if ((totalLength + length) >= to) {
                        var difLength = to - totalLength;
                        var p = difLength / length;

                        x1 = x1 + p * (x - x1);
                        y1 = y1 + p * (y - y1);

                        //ctx.lineTo(x1, y1);
                        addDotFunc(x1, y1);

                        length -= difLength;
                        totalLength += difLength;

                        from = to + dashArray[++dashIndex % dashLength];
                        to = from + dashArray[++dashIndex % dashLength];
                    }
                }
            }

            lastx = x;
            lasty = y;
        }
        return parent;
    },

    isFileExist: function (fileName) {
        if (cc.sys.isNative) {
            if (jsb.fileUtils.isFileExist(fileName)) {
                return true;
            }
        } else {
            if (cc.loader.getRes(fileName)) {
                return true;
            }
        }
        return false;
    },

    /**
     * 判断宽高比是否大于2，如果大于2，则使用刘海屏适配方式来显示UI
     * @returns {boolean}
     */
    isNotchScreen: function () {
        if (cc.sys.isNative) {
            return jsb_dp.oneSdkBridge.isNotchScreen();
        }
        return false;
    },

    isAndroidNotchScreen: function () {
        if (cc.sys.isNative) {
            if (cc.sys.os === cc.sys.OS_ANDROID) {
                return jsb_dp.oneSdkBridge.isNotchScreen();
            }
        }
        return false;
    },

    isIOSNotchScreen: function () {
        if (cc.sys.isNative) {
            if (cc.sys.os === cc.sys.OS_IOS) {
                return jsb_dp.oneSdkBridge.isNotchScreen();
            }
        }
        return false;
    },

    loadIterator: function (funcList, callback) {
        var self = this;
        var func = funcList.shift();
        if (func) {
            Utils.executeInNextFrame(function () {
                func();
                self.loadIterator(funcList, callback);
            });
        } else {
            if (callback) {
                callback();
            }
        }
    },

    getTotalMemory: function () {
        if (cc.sys.isNative) {
            if (!this.totalMemory) {
                this.totalMemory = jsb_dp.oneSdkBridge.getTotalMemory();
            }
            return this.totalMemory;
        }
        return 0;
    },

    isLowAndroid: function () {
        if (cc.sys.os === cc.sys.OS_ANDROID) {
            cc.log("memory: ", this.getTotalMemory());
            return (this.getTotalMemory() <= 1536);
        }
        return false;
    },

    isLowIOS: function () {
        if (cc.sys.os === cc.sys.OS_IOS) {
            cc.log("memory: ", this.getTotalMemory());
            return (this.getTotalMemory() <= 1024);
        }
        return false;
    },

    setTrackValue: function (name, value) {
        if (cc.sys.isNative) {
            jsb_dp.oneSdkBridge.setTrackValue(name, value);
        }
    },

    getReverseString: function (str) {
        return str.split('').reverse().join('');
    },

    getCurrentFPS: function () {
        if (game.utils.isLowAndroid()) {
            return game.config.lowAndroidFPS;
        }
        return 60;
    },

    createProgressTimer: function(sprite, horizontal, radial) {
        var pos = sprite.getPosition();
        var anchor = sprite.getAnchorPoint();
        var scaleX = sprite.getScaleX();
        var scaleY = sprite.getScaleY();
        var parent = sprite.getParent();
        sprite.retain();
        sprite.removeFromParent();
        var ret = new cc.ProgressTimer(sprite);
        sprite.release();
        if (!radial) {
            ret.setType(cc.ProgressTimer.TYPE_BAR);
            if(horizontal) {
                ret.setBarChangeRate(cc.p(1, 0));
                ret.setMidpoint(cc.p(0, 0.5));
            } else {
                ret.setBarChangeRate(cc.p(0, 1));
                ret.setMidpoint(cc.p(0.5, 0));
            }
        } else {
            ret.setType(cc.ProgressTimer.TYPE_RADIAL);
            ret.setAnchorPoint(cc.p(0.5, 0.5));
        }
        parent.addChild(ret);
        ret.setPosition(pos);
        ret.setAnchorPoint(anchor);
        ret.setScaleX(scaleX);
        ret.setScaleY(scaleY);
        return ret;
    },

    shuffle: function (vec) {
        if (!vec || vec.length === 0) return;
        vec.sort(function (a, b) {
            return Math.random() < 0.5 ? -1 : 1;
        });
    },

    clone: function(srcObj) {
        return JSON.parse(JSON.stringify(srcObj));
    },

    createVideoAd: function (size, pos, anchor, url) {
        var video = new ccui.VideoPlayer(url);
        video.setContentSize(size);
        video.setAnchorPoint(anchor);
        video.setScale(1);
        video.setURL(url);
        video.setFullScreenEnabled(false);
        video.play();
        video.setPosition(pos);

        video.setEventListener(ccui.VideoPlayer.EventType.COMPLETED, function () {
            cc.log("ccui.VideoPlayer.EventType.COMPLETED");
            if (cc.sys.os === cc.sys.OS_ANDROID) {
                video.setURL(url);
            }
            video.seekTo(0);
            video.play();
        });
        return video;
    }
};

module.exports = Utils;
},{"timespan":1}],39:[function(require,module,exports){
/**
 * Created by XinCheng on 8/18/16.
 */

var EasingFunctions = {
    // no easing, no acceleration
    linear: function (t) { return t; },
    // accelerating from zero velocity
    easeInQuad: function (t) { return t*t; },
    // decelerating to zero velocity
    easeOutQuad: function (t) { return t*(2-t); },
    // acceleration until halfway, then deceleration
    easeInOutQuad: function (t) { return t<0.5 ? 2*t*t : -1+(4-2*t)*t; },
    // accelerating from zero velocity
    easeInCubic: function (t) { return t*t*t; },
    // decelerating to zero velocity
    easeOutCubic: function (t) { return (--t)*t*t+1; },
    // acceleration until halfway, then deceleration
    easeInOutCubic: function (t) { return t<0.5 ? 4*t*t*t : (t-1)*(2*t-2)*(2*t-2)+1; },
    // accelerating from zero velocity
    easeInQuart: function (t) { return t*t*t*t; },
    // decelerating to zero velocity
    easeOutQuart: function (t) { return 1-(--t)*t*t*t; },
    // acceleration until halfway, then deceleration
    easeInOutQuart: function (t) { return t<0.5 ? 8*t*t*t*t : 1-8*(--t)*t*t*t; },
    // accelerating from zero velocity
    easeInQuint: function (t) { return t*t*t*t*t; },
    // decelerating to zero velocity
    easeOutQuint: function (t) { return 1+(--t)*t*t*t*t; },
    // acceleration until halfway, then deceleration
    easeInOutQuint: function (t) { return t<0.5 ? 16*t*t*t*t*t : 1+16*(--t)*t*t*t*t; },

    easeOutElastic: function(t){  var p = 0.4; return Math.pow(2,-10*t) * Math.sin((t-p/4)*(2*Math.PI)/p) + 1; },

    elastic: function(t, x) { return Math.pow(2, 10 * (t-1)) * Math.cos(20*Math.PI*x/3*t); },

    // 弹跳
    bounce: function(t) {
        for(var a = 0, b = 1; 1; a += b, b /= 2) {
            if (t >= (7 - 4 * a) / 11) {
                return -Math.pow((11 - 6 * a - 11 * t) / 4, 2) + Math.pow(b, 2);
            }
        }
    },

    //三次贝塞尔算法
    bseBase: function(t, p0, p1, p2, p3){
        var x = p0.x * (1 - t) * (1 - t) * (1 - t) + p1.x * 3 * t * (1 - t) * (1 - t) + p2.x * 3 * t * t * (1 - t) + p3.x * t * t * t;
        var y = p0.y * (1 - t) * (1 - t) * (1 - t) + p1.y * 3 * t * (1 - t) * (1 - t) + p2.y * 3 * t * t * (1 - t) + p3.y * t * t * t;
        return {x:x,y:y};
    },

    doShaking: function (t) {
        return -Math.sin(2 * Math.PI * 3 * t) * Math.pow((1 - t), 2);
    }

};

var Wheel = cc.Class.extend({
    target: null,                               // the target node you want to rotate
    bCurve: [0.42, -0.08, 0.58, 1.10],          // magic curve
    fps: 0,                                     // fps
    nRound: 1,                                  // move nRound x 360

    frameCount: 0,
    elapsedTime: 0,
    totalRotationTime: 0,
    startRotation: 0,       // the start rotation
    movement: 0,             // the movement degrees
    easyFunction: null,
    endCallback: null,
    targetRotation: 0,
    wheelItemAngle: 0,
    lastTime: 0,
    lastRotation: 0,
    speed: 0,

    _lotteryReseting: false,
    _isHighRotating: false,
    _startUpdate: false,


    /*
     * target: the node you want to rotate
     * fps: 30fps by default
     */
    ctor: function (target, fps) {
        this.target = target;
        this.fps = fps || 60;
    },

    /**
     * rotate the target node to the specified value
     * the index should start with 0
     * @param {number} rotationTime
     * @param {number} targetRotation
     * @param {number} wheelItemAngle
     * @param {Function} rollEndCallback
     */
    rotate: function (rotationTime, targetRotation, wheelItemAngle, rollEndCallback) {
        // I am moving
        if (this._startUpdate) {
            return;
        }

        this.targetRotation = targetRotation;
        this.frameCount = 0;
        this.totalRotationTime = rotationTime;

        this.startRotation = this.target.rotation % 360;
        this.movement = targetRotation - this.startRotation;
        this.wheelItemAngle = wheelItemAngle;

        this.lastTime = Date.now();
        this.lastRotation = 0;
        this._isHighRotating = false;
        this._lotteryReseting = false;

        this.easyFunction = this.defaultEasyFunction;
        //// use bezier
        //if (Array.isArray(params.easyFunction)) {
        //    this.bCurve = params.easyFunction;
        //    this.easyFunction = this.defaultEasyFunction;
        //}
        //// provide a function
        //else if (typeof easyFunction === 'function') {
        //    this.easyFunction = params.easyFunction;
        //}
        //// provide a functionName
        //else {
        //    this.easyFunction = EasingFunctions[params.easyFunction] || this.defaultEasyFunction;
        //}

        this.endCallback = rollEndCallback;

        this.scheduleUpdate();
        this._startUpdate = true;
    },

    scheduleUpdate: function () {
        this.elapsedTime = 0;
        cc.director.getScheduler().scheduleUpdateForTarget(this, 0, false);
    },

    unscheduleUpdate: function () {
        cc.director.getScheduler().unscheduleUpdateForTarget(this);
        this.elapsedTime = 0;
    },

    update: function (dt) {
        if (this._startUpdate) {
            this.moveByFrame(dt);
        }
    },

    /*rotate the reel frame by frame*/
    moveByFrame: function (dt) {
        // calculate elapsed time
        this.elapsedTime += dt;

        // calculate the moving progress
        var progress = this.easyFunction(this.elapsedTime / this.totalRotationTime);

        // do the rotation
        this.target.rotation = progress * this.movement + this.startRotation;

        //var hasStop = false;
        // stop here
        if (this.targetRotation <= this.target.rotation) {
            this.target.rotation = this.targetRotation;
            this.unscheduleUpdate();
            this._startUpdate = false;

            //game.audio.stopEffect("slots/roulette-bg");

            if (this.endCallback) {
                this.endCallback();
            }
        }

        this.speed = (this.target.rotation - this.lastRotation) / (Date.now() - this.lastTime) * 1000;

        this.lastTime = Date.now();
        this.lastRotation = this.target.rotation;
    },

    /* Use bezier Curive as default */
    defaultEasyFunction: function (t) {
        var bez = this.bCurve;
        var coord = EasingFunctions.bseBase(t, {x: 0, y: 0}, {x: bez[0], y: bez[1]}, {x: bez[2], y: bez[3]}, {
            x: 1,
            y: 1
        });
        return coord.y;
    },

    getTargetRotation: function () {
        return this.targetRotation;
    },

    getSpeed: function () {
        return this.speed;
    }
});


module.exports = Wheel;

},{}],40:[function(require,module,exports){
/**
 * A brief explanation for "project.json":
 * Here is the content of project.json file, this is the global configuration for your game, you can modify it to customize some behavior.
 * The detail of each field is under it.
 {
    "project_type": "javascript",
    // "project_type" indicate the program language of your project, you can ignore this field

    "debugMode"     : 1,
    // "debugMode" possible values :
    //      0 - No message will be printed.
    //      1 - cc.error, cc.assert, cc.warn, cc.log will print in console.
    //      2 - cc.error, cc.assert, cc.warn will print in console.
    //      3 - cc.error, cc.assert will print in console.
    //      4 - cc.error, cc.assert, cc.warn, cc.log will print on canvas, available only on web.
    //      5 - cc.error, cc.assert, cc.warn will print on canvas, available only on web.
    //      6 - cc.error, cc.assert will print on canvas, available only on web.

    "showFPS"       : true,
    // Left bottom corner fps information will show when "showFPS" equals true, otherwise it will be hide.

    "frameRate"     : 60,
    // "frameRate" set the wanted frame rate for your game, but the real fps depends on your game implementation and the running environment.

    "id"            : "gameCanvas",
    // "gameCanvas" sets the id of your canvas element on the web page, it's useful only on web.

    "renderMode"    : 0,
    // "renderMode" sets the renderer type, only useful on web :
    //      0 - Automatically chosen by engine
    //      1 - Forced to use canvas renderer
    //      2 - Forced to use WebGL renderer, but this will be ignored on mobile browsers

    "engineDir"     : "frameworks/cocos2d-html5/",
    // In debug mode, if you use the whole engine to develop your game, you should specify its relative path with "engineDir",
    // but if you are using a single engine file, you can ignore it.

    "modules"       : ["cocos2d"],
    // "modules" defines which modules you will need in your game, it's useful only on web,
    // using this can greatly reduce your game's resource size, and the cocos console tool can package your game with only the modules you set.
    // For details about modules definitions, you can refer to "../../frameworks/cocos2d-html5/modulesConfig.json".

    "jsList"        : [
    ]
    // "jsList" sets the list of js files in your game.
 }
 *
 */

cc.game.onStart = function() {
    if (!cc.sys.isNative && document.getElementById("cocosLoading"))
        document.body.removeChild(document.getElementById("cocosLoading"));

    cc.view.enableRetina(false);
    cc.view.adjustViewPort(true);

    var LogicMan = require("./common/model/LogicMan");
    LogicMan.getInstance().init();

    var Utils = require("./common/util/Utils");
    cc.view.resizeWithBrowserSize(true);
    cc.view.setDesignResolutionSize(1000, 1300, cc.ResolutionPolicy.SHOW_ALL);
    //if (cc.sys.isNative) {
    //    var width = 0;
    //    var height = 0;
    //    if (!!GameBridge.getConfig().horizontalGame) {
    //        height = 640;
    //        if (Utils.isPad()) {
    //            height = 768;
    //        }
    //        width = height * cc.winSize.width / cc.winSize.height;
    //        cc.log("cc.winSize.width:" + cc.winSize.width);
    //        cc.log("cc.winSize.height:" + cc.winSize.height);
    //
    //    } else {
    //        height = 1136;
    //        if (Utils.isPad()) {
    //            height = 1024;
    //        }
    //        width = height * cc.winSize.width / cc.winSize.height;
    //    }
    //    cc.log("width:" + width);
    //    cc.log("height:" + height);
    //    cc.view.setDesignResolutionSize(width, height, cc.ResolutionPolicy.SHOW_ALL);
    //} else {
    //    if (!!GameBridge.getConfig().horizontalGame) {
    //        cc.view.setDesignResolutionSize(960, 640, cc.ResolutionPolicy.SHOW_ALL);
    //    } else {
    //        cc.view.setDesignResolutionSize(640, 960, cc.ResolutionPolicy.SHOW_ALL);
    //    }
    //}

    // The game will be resized when browser size change
    cc.BuilderReader.setResourcePath("res/");
    cc.view.resizeWithBrowserSize(true);

    game.dialogManager.createOverlay();
    window.isEditor = true;

    var AdsReminderController = require("./many_bricks/controller/AdsReminderController");
    var DiamondsController = require("./many_bricks/controller/DiamondsController");
    cc.BuilderReader.registerController("AdsReminderController", new AdsReminderController());
    cc.BuilderReader.registerController("DiamondsController", new DiamondsController());

    if (cc.sys.isNative) {
        game.local.reload();
        cc.director.runScene(new GameBridge.getMenuScene());
    } else {
        cc.loader.loadJson("res/resource_list/resource_list.json", function (error, result) {
            if (!error) {
                cc.LoaderScene.preload(result, function () {
                    game.local.reload();
                    var EditorScene = require("./many_bricks/editor/scene/EditorScene");
                    cc.director.runScene(new EditorScene());
                }, this);
            }
        });
    }
};
cc.game.run();

},{"./common/model/LogicMan":30,"./common/util/Utils":38,"./many_bricks/controller/AdsReminderController":67,"./many_bricks/controller/DiamondsController":87,"./many_bricks/editor/scene/EditorScene":140}],41:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */

var ActivityTaskConfig = function () {
    this.id = 0;
    this.type = "";
    this.score = 0;
    this.limit = 0;
    this.name = "";
};

ActivityTaskConfig.prototype.unmarshal = function (jsonObj) {
    this.id = jsonObj["id"];
    this.type = jsonObj["type"];
    this.score = jsonObj["score"];
    this.limit = jsonObj["limit"];
    this.name = jsonObj["name"];
};

module.exports = ActivityTaskConfig;


},{}],42:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */

var ActivityTaskRewardConfig = function () {
    this.id = 0;
    this.type = "";
    this.score = 0;
    this.count = 0;
    this.image = "";
    this.scale = 1;
};

ActivityTaskRewardConfig.prototype.unmarshal = function (jsonObj) {
    this.id = jsonObj["id"];
    this.type = jsonObj["type"];
    this.score = jsonObj["score"];
    this.count = jsonObj["count"];
    this.image = jsonObj["image"];
    this.scale = jsonObj["scale"] || 1;
};

module.exports = ActivityTaskRewardConfig;


},{}],43:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */

var BoardConfig = function () {
    this.id = 0;
    this.count = "";
    this.image = 0;
    this.scale = 1;
    this.type = 0;
};

BoardConfig.prototype.unmarshal = function (jsonObj) {
    this.id = jsonObj["id"];
    this.count = jsonObj["count"];
    this.image = jsonObj["image"];
    this.scale = jsonObj["scale"] || 1;
    this.type = jsonObj["type"] || 2;
};

module.exports = BoardConfig;


},{}],44:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */

var BoxConfig = function () {
    this.id = 0;
    this.count = "";
    this.image = 0;
    this.type = 0;
    this.extra = 0;
    this.scale = 0;
};

BoxConfig.prototype.unmarshal = function (jsonObj) {
    this.id = jsonObj["id"];
    this.count = jsonObj["count"];
    this.image = jsonObj["image"];
    this.type = jsonObj["type"];
    this.extra = jsonObj["extra"];
    this.scale = jsonObj["scale"];
};

module.exports = BoxConfig;


},{}],45:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */
var BoxConfig = require("./BoxConfig");

var BoxRewardConfig = function () {
    this.boxReward1 = [];
    this.boxReward2 = [];
    this.boxReward3 = [];
};

BoxRewardConfig.prototype.unmarshal = function (jsonObj) {
    var i, box;
    var boxReward1 = jsonObj["boxReward1"];
    for (i = 0; i < boxReward1.length; ++i) {
        box = new BoxConfig();
        box.unmarshal(boxReward1[i]);
        this.boxReward1.push(box);
    }
    var boxReward2 = jsonObj["boxReward2"];
    for (i = 0; i < boxReward2.length; ++i) {
        box = new BoxConfig();
        box.unmarshal(boxReward2[i]);
        this.boxReward2.push(box);
    }
    var boxReward3 = jsonObj["boxReward3"];
    for (i = 0; i < boxReward3.length; ++i) {
        box = new BoxConfig();
        box.unmarshal(boxReward3[i]);
        this.boxReward3.push(box);
    }
};

module.exports = BoxRewardConfig;


},{"./BoxConfig":44}],46:[function(require,module,exports){

var BrickConfig = function () {
    this.width = 0;
    this.height = 0;
    this.x = 0;
    this.y = 0;
    this.type = 0;
};

BrickConfig.prototype.unmarshal = function (jsonObj) {
    this.x = jsonObj[0];
    this.y = jsonObj[1];
    this.width = jsonObj[2];
    this.height = jsonObj[3];
    this.type = jsonObj[4];
};

BrickConfig.prototype.getHardCfg = function () {
    var hardCfg = new BrickConfig();
    hardCfg.x = this.x * 2;
    hardCfg.y = this.y * 2;
    hardCfg.width = this.width * 2;
    hardCfg.height = this.height * 2;
    hardCfg.type = this.type;
    return hardCfg;
};

module.exports = BrickConfig;
},{}],47:[function(require,module,exports){

var CardConfig = function () {
    this.id = 0;
    this.count = 0;
    this.image = "";
};

CardConfig.prototype.unmarshal = function (jsonObj) {
    this.id = jsonObj["id"];
    this.count = jsonObj["count"];
    this.image = jsonObj["image"];
};

module.exports = CardConfig;
},{}],48:[function(require,module,exports){
var ChallengeRewardConfig = require("./ChallengeRewardConfig");
var ChallengeInfoConfig = require("./ChallengeInfoConfig");

var ChallengeConfig = function () {
    this.levelLimit = 0;
    /**
     * @type {Array.<ChallengeInfoConfig>}
     */
    this.challenges = [];
    this.challengeMap = {};
};

ChallengeConfig.prototype.unmarshal = function (jsonObj) {
    this.levelLimit = jsonObj["levelLimit"];
    var challenges = jsonObj["challenges"];
    this.challenges = [];
    var j;
    for (j = 0; j < challenges.length; ++j) {
        var challengeInfoCfg = new ChallengeInfoConfig();
        challengeInfoCfg.unmarshal(challenges[j]);
        this.challenges.push(challengeInfoCfg);
    }
    for (j = 0; j < this.challenges.length; ++j) {
        var challenge = this.challenges[j];
        var id = challenge.id;
        this.challengeMap[id] = [];
        var challengeList = jsonObj["challenge" + id];
        var i, challengeConfig;
        for (i = 0; i < challengeList.length; ++i) {
            challengeConfig = new ChallengeRewardConfig();
            challengeConfig.unmarshal(challengeList[i]);
            this.challengeMap[id].push(challengeConfig);
        }
    }
};

ChallengeConfig.prototype.getChallengeInfoCfg = function (challengeId) {
    return this.challenges[challengeId - 1];
};

ChallengeConfig.prototype.getChallengeList = function (challengeId) {
    return this.challengeMap[challengeId];
};

module.exports = ChallengeConfig;
},{"./ChallengeInfoConfig":49,"./ChallengeRewardConfig":50}],49:[function(require,module,exports){

var ChallengeInfoConfig = function () {
    this.id = 0;
    this.image = "";
    this.grayImage = "";
    this.nameKey = "";
    this.levelLimit = 0;
};

ChallengeInfoConfig.prototype.unmarshal = function (jsonObj) {
    this.id = jsonObj["id"];
    this.image = jsonObj["image"] || "";
    this.grayImage = jsonObj["grayImage"] || "";
    this.nameKey = jsonObj["nameKey"] || "";
    this.levelLimit = jsonObj["levelLimit"] || 0;
};

module.exports = ChallengeInfoConfig;
},{}],50:[function(require,module,exports){
var RewardConfig = require("./RewardConfig");

var ChallengeRewardConfig = function () {
    this.id = 0;
    this.level = 0;
    this.rewards = [];
};

ChallengeRewardConfig.prototype.unmarshal = function (jsonObj) {
    this.id = jsonObj["id"];
    this.level = jsonObj["level"];
    var rewards = jsonObj["rewards"];
    for (var i = 0; i < rewards.length; ++i) {
        var rewardCfg = new RewardConfig();
        rewardCfg.unmarshal(rewards[i]);
        this.rewards.push(rewardCfg);
    }
};

module.exports = ChallengeRewardConfig;
},{"./RewardConfig":55}],51:[function(require,module,exports){
/**
 * Created by oye on 16/5/19.
 */
var Config = {
    itunesDownloadUrl: "itms-apps://itunes.apple.com/app/id1372837123?action=write-review",
    googlePlayUrl: "http://bit.ly/2O8G9vx",
    iosShortUrl: "https://apple.co/2UPCwz6",
    androidShortUrl: "http://bit.ly/2O8G9vx",
    iosUrl: "https://apps.apple.com/cn/app/id1372837123",
    appName: "Break Bricks",
    iosLeaderBoardKey: "com.douapp.manybricks.rank",
    iosHardLeaderBoardKey: "com.douapp.manybricks.hardrank",
    googlePlayLeaderBoardKey: "CgkIouCt0-kBEAIQAQ",
    facebookFanPageUrl: "https://www.facebook.com/PlayBreakBricks/",
    taptapUrl: "https://www.taptap.com/app/87537",
    iosStarRankKey: "com.douapp.manybricks.starrank",
    IS_DEBUG: false,
    IS_ENABLE_HOT_UPDATE: false,

    getFansUrl: function () {
        if (game.local.isChinese()) {
            return this.taptapUrl;
        } else {
            return this.facebookFanPageUrl;
        }
    },

    getStarLeaderBoardKey: function () {
        return this.iosStarRankKey;
    },

    getLeaderBoardKey: function () {
        if (cc.sys.os == cc.sys.OS_ANDROID) {
            return this.googlePlayLeaderBoardKey;
        } else {
            return this.iosLeaderBoardKey;
        }
    },

    getHardBoardKey: function () {
        if (cc.sys.os == cc.sys.OS_ANDROID) {
            return this.googlePlayLeaderBoardKey;
        } else {
            return this.iosHardLeaderBoardKey;
        }
    },

    getPlatformDownloadUrl: function () {
        if (cc.sys.os == cc.sys.OS_ANDROID) {
            return this.googlePlayUrl;
        } else {
            return this.itunesDownloadUrl;
        }
    },

    getShortPlatformDownloadUrl: function () {
        if (cc.sys.os == cc.sys.OS_ANDROID) {
            return this.androidShortUrl;
        } else {
            return this.iosShortUrl;
        }
    },

    getShareUrl: function () {
        if (cc.sys.os === cc.sys.OS_ANDROID) {
            return this.androidShortUrl;
        } else {
            return this.iosUrl;
        }
    },

    getCrossPromUrl: function () {
        if (cc.sys.os == cc.sys.OS_ANDROID) {
            return this.crossPromUrl;
        } else {
            if (game.utils.isSelfGame()) {
                return this.cnCrossPromUrl;
            }
            return this.crossPromUrl;
        }
    },
    getPackageName: function () {
        if (cc.sys.os == cc.sys.OS_ANDROID) {
            if (game.utils.isSelfGame()) {
                return "com.douapp.manybricks";
            } else {
                return "com.q1.breakbricks";
            }
        } else {
            return "com.douapp.manybricks";
        }
    },
    getAdUrl: function () {
        if (game.utils.isSelfGame()) {
            return this.cnNewAdConfigUrl;
        }
        return this.adConfigUrl;
    },

    getEmail: function () {
        if (game.local.isChinese()) {
            return this.cnConnectEmail;
        } else {
            return this.connectEmail;
        }
    },

    horizontalGame: false,

    //bingchuan ad url.
    adConfigUrl: "https://onegameinc.github.io/many_bricks/game_bingchuan.html",
    //bingchuan prom url.
    crossPromUrl: "https://onegameinc.github.io/cross_promotion/config/many_bricks/cross_promotion_bingchuan.html",

    //old version cn ad url.
    cnAdConfigUrl: "https://onegameinc.github.io/many_bricks/game.html",
    //new version cn ad url.
    cnNewAdConfigUrl: "https://onegameinc.github.io/many_bricks/game_cn.html",
    //cn prom url.
    cnCrossPromUrl: "https://onegameinc.github.io/cross_promotion/config/many_bricks/cross_promotion.html",
    
    connectEmail: "bricks.crush.play@gmail.com",

    cnConnectEmail: "break_bricks_2019@163.com",

    rewardAdMaxCountPerDay: 10,
    rewardDiamonds: 5,
    rewardDiamondMap: {
        "1": 1,
        "2": 3,
        "3": 5
    },
    relifeDiamonds: 20,
    skipDiamonds: 100,
    aimItemDiamonds: 50,
    lowAndroidFPS: 40,
    dailyDiamonds: 50,
    boostProbability: 0.04,
    challengeBoostProbability: 0.1,
    multiClaimRange: [3, 20],
    multiDiamondsRange: [15, 40],
    rewardRemoveAdsCfg: {
        "multi": 1,
        "add": 1,
        "timeInMinute": 4
    },
    multiClaimPossibility: [
        {start:3, end: 4, p: 20},
        {start:5, end: 6, p: 35},
        {start:7, end: 8, p: 20},
        {start:9, end: 10, p: 15},
        {start:11, end: 15, p: 7},
        {start:16, end: 20, p: 3}
    ],
    multiDiamondsPossibility: [
        {start:15, end: 20, p: 25},
        {start:21, end: 25, p: 40},
        {start:26, end: 30, p: 20},
        {start:31, end: 35, p: 10},
        {start:36, end: 40, p: 5}
    ],
    dailyWheelMaxCount: 3,
    activityTaskDay: 10
    // activityTaskEndTime: new Date(2019, 11, 26, 0, 0, 0, 0)
};

module.exports = Config;
},{}],52:[function(require,module,exports){
/**
 * Created by qinning on 2017/3/25.
 */
var LevelConfig = require("./LevelConfig");
//var PackageConfig = require("./PackageConfig");
var StoreConfig = require("./StoreConfig");
var WheelConfig = require("./WheelConfig");
var ShareConfig = require("./ShareConfig");
var SkinConfig = require("./SkinConfig");
var DailyBonusConfig = require("./DailyBonusConfig");
var StoreType = require("../enum/StoreType");
var TaskConfig = require("./TaskConfig");
var BoostType = require("../enum/BoostType");
var TaskOldConfig = require("./TaskOldConfig");
var CardConfig = require("./CardConfig");
var ChallengeConfig = require("./ChallengeConfig");
var BoardConfig = require("./BoardConfig");
var BoxRewardConfig = require("./BoxRewardConfig");
var ActivityTaskConfig = require("./ActivityTaskConfig");
var ActivityTaskRewardConfig = require("./ActivityTaskRewardConfig");

var LevelConfigMan = cc.Class.extend({

    levelList: null,
    levelListB: null,
    hardLevelList: null,
    serverHardLevelList: null,
    storeList: null,
    wheelList: null,
    boxWheelList: null,
    shareList: null,
    skinList: null,
    dailyBonusList: null,
    storeListWithoutFirstPurchase: null,
    storeListWithoutFirstPurchaseAndAimItem: null,
    taskList: null,
    oldTaskList: null,
    originalLevelList: null,
    cardConfigList: null,
    boardList: null,
    boxList: null,

    // challengeLevelList: null,

    challengeConfig: null,
    activityTaskList: null,
    activityTaskBList: null,
    activityTaskRewardList: null,

    ctor: function () {
        this.storeList = [];
        this.levelList = [];
        this.wheelList = [];
        this.boxWheelList = [];
        this.shareList = [];
        this.skinList = [];
        this.dailyBonusList = [];
        this.storeListWithoutFirstPurchase = [];
        this.storeListWithoutFirstPurchaseAndAimItem = [];
        this.taskList = [];
        this.oldTaskList = [];
        this.cardConfigList = [];
        // this.challengeLevelList = [];
        this.challengeConfig = null;
        this.boardList = [];
        this.boxList = [];
        this.activityTaskList = [];
        this.activityTaskBList = [];
        this.activityTaskRewardList = [];

        // this.reload();
    },

    reload: function () {
        var i;

        var jsonObj = game.utils.loadJson("res/config/store_config.json");
        var storeConfigs = jsonObj["stores"];
        for (i = 0; i < storeConfigs.length; ++i) {
            var storeConfig = new StoreConfig();
            storeConfig.unmarshal(storeConfigs[i]);
            this.storeList.push(storeConfig);

            if (storeConfig.type === StoreType.FIRST_PURCHASE) {
                this.specialOfferCfg = storeConfig;
            } else {
                if (storeConfig.type !== StoreType.AIM_ITEM) {
                    this.storeListWithoutFirstPurchaseAndAimItem.push(storeConfig);
                }
                this.storeListWithoutFirstPurchase.push(storeConfig);
            }
        }

        this.reloadLevelConfig();

        jsonObj = game.utils.loadJson("res/config/data_config.json");
        var wheelConfigs = jsonObj["wheel"];
        var wheelConfig;
        for (i = 0; i < wheelConfigs.length; ++i) {
            wheelConfig = new WheelConfig();
            wheelConfig.unmarshal(wheelConfigs[i]);
            this.wheelList.push(wheelConfig);
        }

        var boxWheelConfigs = jsonObj["box"];
        for (i = 0; i < boxWheelConfigs.length; ++i) {
            wheelConfig = new WheelConfig();
            wheelConfig.unmarshal(boxWheelConfigs[i]);
            this.boxWheelList.push(wheelConfig);
        }

        var shareConfigs = jsonObj["share"];
        for (i = 0; i < shareConfigs.length; ++i) {
            var shareConfig = new ShareConfig();
            shareConfig.unmarshal(shareConfigs[i]);
            this.shareList.push(shareConfig);
        }

        var cardConfigs = jsonObj["cards"];
        for (i = 0; i < cardConfigs.length; ++i) {
            var cardConfig = new CardConfig();
            cardConfig.unmarshal(cardConfigs[i]);
            this.cardConfigList.push(cardConfig);
        }

        var dailyBonusConfigs = jsonObj["daily_bonus"];
        for (i = 0; i < dailyBonusConfigs.length; ++i) {
            var dailyBonusConfig = new DailyBonusConfig();
            dailyBonusConfig.unmarshal(dailyBonusConfigs[i]);
            if (dailyBonusConfig.type === BoostType.SKIN) {
                var getted = game.playerMan.hasSkin(dailyBonusConfig.arg1);
                if (getted) {
                    dailyBonusConfig.type = dailyBonusConfig.extra.type;
                    dailyBonusConfig.count = dailyBonusConfig.extra.count;
                    dailyBonusConfig.image = dailyBonusConfig.extra.image;
                }
            }

            this.dailyBonusList.push(dailyBonusConfig);
        }

        jsonObj = game.utils.loadJson("res/config/skins_config.json");
        var skinsConfigs = jsonObj["skins"];
        for (i = 0; i < skinsConfigs.length; ++i) {
            var skinConfig = new SkinConfig();
            skinConfig.unmarshal(skinsConfigs[i]);
            this.skinList.push(skinConfig);
        }

        jsonObj = game.utils.loadJson("res/config/boards_config.json");
        var skinsConfigs = jsonObj["boards"];
        for (i = 0; i < skinsConfigs.length; ++i) {
            var skinConfig = new BoardConfig();
            skinConfig.unmarshal(skinsConfigs[i]);
            this.boardList.push(skinConfig);
        }

        jsonObj = game.utils.loadJson("res/config/box_config.json");
        this.boxRewardConfig = new BoxRewardConfig();
        this.boxRewardConfig.unmarshal(jsonObj);

        jsonObj = game.utils.loadJson("res/config/task_config.json");
        var taskConfigs = jsonObj["tasks"];
        for (i = 0; i < taskConfigs.length; ++i) {
            var taskConfig = new TaskConfig();
            taskConfig.unmarshal(taskConfigs[i]);
            this.taskList.push(taskConfig);
        }

        jsonObj = game.utils.loadJson("res/config/task_old_config.json");
        var taskConfigs = jsonObj["tasks"];
        for (i = 0; i < taskConfigs.length; ++i) {
            var taskConfig = new TaskOldConfig();
            taskConfig.unmarshal(taskConfigs[i]);
            this.oldTaskList.push(taskConfig);
        }

        jsonObj = game.utils.loadJson("res/config/activity_task_config.json");
        var taskConfigs = jsonObj["tasks"];
        for (i = 0; i < taskConfigs.length; ++i) {
            var taskConfig = new ActivityTaskConfig();
            taskConfig.unmarshal(taskConfigs[i]);
            this.activityTaskList.push(taskConfig);
        }

        jsonObj = game.utils.loadJson("res/config/activity_task_config-b.json");
        var taskConfigs = jsonObj["tasks"];
        for (i = 0; i < taskConfigs.length; ++i) {
            var taskConfig = new ActivityTaskConfig();
            taskConfig.unmarshal(taskConfigs[i]);
            this.activityTaskBList.push(taskConfig);
        }

        var taskConfigs = jsonObj["rewards"];
        for (i = 0; i < taskConfigs.length; ++i) {
            var taskConfig = new ActivityTaskRewardConfig();
            taskConfig.unmarshal(taskConfigs[i]);
            this.activityTaskRewardList.push(taskConfig);
        }

        jsonObj = game.utils.loadJson("res/config/challenge_config.json");

        this.challengeConfig = new ChallengeConfig();
        this.challengeConfig.unmarshal(jsonObj);


        this.challengeLevelMap = {};
        for (i = 0; i < this.challengeConfig.challenges.length; ++i) {
            var challenge = this.challengeConfig.challenges[i];
            jsonObj = game.utils.loadJson("res/config/challenge" + challenge.id + "_level_configs.json");
            var levelConfigs = jsonObj["levels"];
            this.challengeLevelMap[challenge.id] = [];
            for (var j = 0; j < levelConfigs.length; ++j) {
                var levelConfig = new LevelConfig();
                levelConfig.unmarshal(levelConfigs[j]);
                this.challengeLevelMap[challenge.id].push(levelConfig);
            }
        }
    },

    getChallenge: function () {
        return this.challengeConfig;
    },

    reloadLevelConfig: function () {
        this.levelList = this.loadLevelConfigs("a");
        this.levelListB = this.loadLevelConfigs("b");
        this.hardLevelList = this.loadLevelConfigs("hard");
    },

    loadLevelConfigs: function (group) {
        var levelList = [];
        var path = "res/config/level_configs.json";
        if (group === "b") {
            path = "res/config/level_configs-b.json";
        }
        else if (group === "hard") {
            path = "res/config/level_configs-hard.json";
        }
        var jsonObj = game.utils.loadJson(path);
        var levelConfigs = jsonObj["levels"];
        for (var i = 0; i < levelConfigs.length; ++i) {
            var levelConfig = new LevelConfig();
            levelConfig.unmarshal(levelConfigs[i]);
            levelList.push(levelConfig);
        }
        return levelList;
    },

    getChallengeLevelList: function (challengeId) {
        return this.challengeLevelMap[challengeId];
    },

    getChallengeConfig: function (challengeId, levelId) {
        var challengeList = this.challengeLevelMap[challengeId];
        if (levelId < challengeList.length) {
            return challengeList[levelId - 1];
        }
        return null;
    },

    getCardList: function () {
        return this.cardConfigList;
    },

    getStoreList: function () {
        return this.storeList;
    },

    getStoreListWithoutFirstPurchase: function () {
        return this.storeListWithoutFirstPurchase;
    },

    getStoreListWithoutFirstPurchaseAndAimItem: function () {
        return this.storeListWithoutFirstPurchaseAndAimItem;
    },

    getLevelList: function () {
        return this.levelList;
    },

    getNewHardLevelList: function () {
        if (!this.serverHardLevelList) {
            return this.hardLevelList;
        }
        return this.hardLevelList.concat(this.serverHardLevelList);
    },

    addHardLevelList: function (hardList) {
        this.serverHardLevelList = hardList;
    },

    _getLevelList: function (group) {
        if (group === "b") {
            return this.levelListB;
        }
        return this.levelList;
    },

    getNewHardLevelConfig: function (levelId) {
        var list = this.getNewHardLevelList();
        if (levelId - 1 >= list.length) {
            if (levelId - 1 >= list.length) {
                return null;
            } else {
                return list[levelId - 1];
            }
        }
        return list[levelId - 1];
    },

    getLevelConfig: function (levelId) {
        var group = game.playerMan.getGroup(game.abTestType.Level);
        var list = this._getLevelList(group);
        if (levelId - 1 >= list.length) {
            if (levelId - 1 >= this.levelList.length) {
                return null;
            } else {
                return this.levelList[levelId - 1];
            }
        }
        return list[levelId - 1];
    },

    getOriginalLevelConfig: function (levelId) {
        return this.originalLevelList[levelId - 1];
    },

    getWheelList: function () {
        return this.wheelList;
    },

    getBoxWheelList: function () {
        return this.boxWheelList;
    },

    getShareList: function () {
        return this.shareList;
    },

    getSkinList: function () {
        return this.skinList;
    },

    getBoardList: function () {
        return this.boardList;
    },

    getBoardListByType: function (type) {
        var list = [];
        for (var i = 0; i < this.boardList.length; ++i) {
            if (type === this.boardList[i].type) {
                list.push(this.boardList[i]);
            }
        }
        return list;
    },

    getSkinListByType: function (type) {
        var list = [];
        for (var i = 0; i < this.skinList.length; ++i) {
            if (type === this.skinList[i].type) {
                list.push(this.skinList[i]);
            }
        }
        return list;
    },

    getTaskList: function () {
        return this.taskList;
    },

    getOldTaskList: function () {
        return this.oldTaskList;
    },

    getSkinCfg: function (skinId) {
        for (var i = 0; i < this.skinList.length; ++i) {
            if (skinId === this.skinList[i].id) {
                return this.skinList[i];
            }
        }
        return null;
    },

    getBoardCfg: function (boardId) {
        for (var i = 0; i < this.boardList.length; ++i) {
            if (boardId == this.boardList[i].id) {
                return this.boardList[i];
            }
        }
        return null;
    },

    getDailyBonusList: function () {
        return this.dailyBonusList;
    },

    getSpecialOfferCfg: function () {
        return this.specialOfferCfg;
    },

    getActivityTaskConfig: function (type) {
        var taskList = this.getActivityTaskList();
        for (var i = 0; i < taskList.length; ++i) {
            if (taskList[i].type === type) {
                return taskList[i];
            }
        }
        return null;
    },

    getActivityTaskList: function () {
        return this.activityTaskList;
    },

    getActivityTaskRewards: function () {
        return this.activityTaskRewardList;
    }

    //getPackage: function (packageId) {
    //    for (var i = 0; i < this.packageList.length; ++i) {
    //        if (this.packageList[i].id === packageId) {
    //            return this.packageList[i];
    //        }
    //    }
    //    return null;
    //}
});

LevelConfigMan._instance = null;
LevelConfigMan._firstUseInstance = true;

/**
 *
 * @returns {LevelConfigMan}
 */
LevelConfigMan.getInstance = function () {
    if (LevelConfigMan._firstUseInstance) {
        LevelConfigMan._firstUseInstance = false;
        LevelConfigMan._instance = new LevelConfigMan();
    }
    return LevelConfigMan._instance;
};

module.exports = LevelConfigMan;

},{"../enum/BoostType":154,"../enum/StoreType":167,"./ActivityTaskConfig":41,"./ActivityTaskRewardConfig":42,"./BoardConfig":43,"./BoxRewardConfig":45,"./CardConfig":47,"./ChallengeConfig":48,"./DailyBonusConfig":53,"./LevelConfig":54,"./ShareConfig":56,"./SkinConfig":57,"./StoreConfig":58,"./TaskConfig":59,"./TaskOldConfig":60,"./WheelConfig":61}],53:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */

var DailyBonusConfig = function () {
    this.id = 0;
    this.type = 0;
    this.count = 0;
    //this.probability = 0;
    this.image = "";
    this.arg1 = "";
};

DailyBonusConfig.prototype.unmarshal = function (jsonObj) {
    this.id = jsonObj["id"];
    this.type = jsonObj["type"];
    this.count = jsonObj["count"];
    //this.probability = jsonObj["probability"];
    this.image = jsonObj["image"];
    this.arg1 = jsonObj["arg1"];
    this.extra = jsonObj["extra"];
};

module.exports = DailyBonusConfig;


},{}],54:[function(require,module,exports){
/**
 * Created by qinning on 2017/3/25.
 */
var BrickConfig = require("./BrickConfig");

var LevelConfig = function () {
    this.lifeProbability = 0;
    this.boostProbability = 0;
    this.pixelWidth = 0;
    this.pixelHeight = 0;
    this.width = 0;
    this.height = 0;
    /**
     * @type {Array.<BrickConfig>}
     */
    this.obstacles = [];
    /**
     * @type {Array.<BrickConfig>}
     */
    this.bricks = [];
    this.starTime = 0;
    this.bombProbability = 0;
    this.lazerInterval = 0;
    this.noneLazerCount = 0;
    this.continuousLazers = [];
};

LevelConfig.prototype.unmarshal = function (jsonObj) {
    this.lifeProbability = jsonObj["l"] || 0;
    this.boostProbability = jsonObj["b"] || 0;
    this.bombProbability = jsonObj["m"] || 1;
    this.pixelWidth = jsonObj["pixelWidth"];
    this.pixelHeight = jsonObj["pixelHeight"];
    this.width = jsonObj["width"];
    this.height = jsonObj["height"];
    var i;
    var obstacles = jsonObj["obstacles"];
    for (i = 0; i < obstacles.length; ++i) {
        var obstacle = obstacles[i];
        var obstacleCfg = new BrickConfig();
        obstacleCfg.unmarshal(obstacle);
        this.obstacles.push(obstacleCfg);
    }

    var bricks = jsonObj["bricks"];
    for (i = 0; i < bricks.length; ++i) {
        var brick = bricks[i];
        var brickCfg = new BrickConfig();
        brickCfg.unmarshal(brick);
        this.bricks.push(brickCfg);
    }
    this.starTime = 3 * jsonObj["starTime"] || 0;
    this.lazerInterval = jsonObj["lazerInterval"] || 3;
    this.noneLazerCount = jsonObj["noneLazerCount"] || 5;
    this.continuousLazers = jsonObj["continuousLazers"] || [2];
};

LevelConfig.prototype.getHardCfg = function () {
    var levelCfg = new LevelConfig();
    levelCfg.lifeProbability = this.lifeProbability;
    levelCfg.boostProbability = this.boostProbability * 0.9;
    levelCfg.pixelWidth = this.pixelWidth;
    levelCfg.pixelHeight = this.pixelHeight;
    levelCfg.width = this.width * 2;
    levelCfg.height = this.height * 2;
    levelCfg.obstacles = [];
    levelCfg.bricks = [];
    levelCfg.starTime = this.starTime * 1.2;
    var i;
    for (i = 0; i < this.obstacles.length; ++i) {
        levelCfg.obstacles.push(this.obstacles[i].getHardCfg());
    }
    for (i = 0; i < this.bricks.length; ++i) {
        levelCfg.bricks.push(this.bricks[i].getHardCfg());
    }
    return levelCfg;
};

module.exports = LevelConfig;
},{"./BrickConfig":46}],55:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */
var BoostType = require("../enum/BoostType");

var RewardConfig = function () {
    this.type = 0;
    this.count = "";
    this.param1 = null;
    this.image = "";
};

RewardConfig.prototype.unmarshal = function (jsonObj) {
    this.type = jsonObj["type"];
    this.count = jsonObj["count"] || 1;
    this.param1 = jsonObj["param1"];
    this.image = RewardConfig.getImage(this);
};

RewardConfig.getImage = function (cfg) {
    switch (cfg.type) {
        case BoostType.SPLIT:
            return "store_3_multiple.png";
        case BoostType.THREE_BALL:
            return "store_3_new.png";
        case BoostType.DIAMOND:
            return "icon_diamond.png";
        case BoostType.AIM_ITEM:
            return "store_aim.png";
        case BoostType.SKIN:
            return "skin_" + cfg.param1 + ".png";
        case BoostType.BOARD_SKIN:
            return "icon_board_" + cfg.param1 + ".png";
    }
};

module.exports = RewardConfig;


},{"../enum/BoostType":154}],56:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */

var ShareConfig = function () {
    this.id = 0;
    this.image = "";
    this.desc = "";
};

ShareConfig.prototype.unmarshal = function (jsonObj) {
    this.id = jsonObj["id"];
    this.image = jsonObj["image"];
    this.desc = jsonObj["desc"];
};

ShareConfig.prototype.copy = function () {
    var config = new ShareConfig();
    config.id = this.id;
    config.image = this.image;
    config.desc = this.desc;
    return config;
};

module.exports = ShareConfig;


},{}],57:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */

var SkinConfig = function () {
    this.id = 0;
    this.count = "";
    this.image = 0;
    this.scale = 1;
    this.type = 0;

    this.extra = null;
};

SkinConfig.prototype.unmarshal = function (jsonObj) {
    this.id = jsonObj["id"];
    this.count = jsonObj["count"];
    this.image = jsonObj["image"];
    this.scale = jsonObj["scale"] || 1;
    this.type = jsonObj["type"] || 2;
};

module.exports = SkinConfig;


},{}],58:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */

var StoreConfig = function () {
    this.id = 0;
    this.type = 0;
    this.name = "";
    this.price = 0;
    this.count = 1;
    this.image = "";
    this.pid = "";
    this.key = "";
    this.hot = false;
    this.best = false;
    this.data = null;
    this.original_price = 0;
    this.discount_multi = 0;
    this.extra = 0;
    this.priceUS = 0;
};

StoreConfig.prototype.unmarshal = function (jsonObj) {
    this.id = jsonObj["id"];
    this.type = jsonObj["type"];
    this.name = jsonObj["name"];
    this.price = jsonObj["price"];
    this.count = jsonObj["count"];
    this.image = jsonObj["image"];
    this.pid = jsonObj["pid"];
    if (cc.sys.os === cc.sys.OS_ANDROID) {
        this.pid = jsonObj["pid_gp"];
    }
    this.key = jsonObj["key"];
    this.hot = jsonObj["hot"];
    this.best = jsonObj["best"];
    this.data = jsonObj["data"] || {};
    this.original_price = jsonObj["original_price"];
    this.discount_multi = jsonObj["discount_multi"];
    this.extra = jsonObj["extra"] || 0;
    this.priceUS = parseFloat(this.price.substr(1));
};

module.exports = StoreConfig;


},{}],59:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */

var TaskConfig = function () {
    this.id = 0;
    this.type = 0;
    this.count = "";
    this.rewardCount = 0;
    this.name = "";
};

TaskConfig.prototype.unmarshal = function (jsonObj) {
    this.id = jsonObj["id"];
    this.type = jsonObj["type"];
    this.count = jsonObj["count"];
    this.rewardCount = jsonObj["rewardCount"];
    this.name = jsonObj["name"];
};

module.exports = TaskConfig;


},{}],60:[function(require,module,exports){

/**
 * Created by qinning on 2017/12/15.
 */

var TaskOldConfig = function () {
    this.id = 0;
    this.count = "";
    this.image = 0;
    this.scale = 1;
    this.type = 0;
};

TaskOldConfig.prototype.unmarshal = function (jsonObj) {
    this.id = jsonObj["id"];
    this.type = jsonObj["type"];
    this.count = jsonObj["count"];
    this.image = jsonObj["image"];
    this.scale = jsonObj["scale"] || 1;
};

module.exports = TaskOldConfig;


},{}],61:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */

var WheelConfig = function () {
    this.id = 0;
    this.type = 0;
    this.count = 0;
    this.probability = 0;
    this.image = "";
    this.scale = 1;
};

WheelConfig.prototype.unmarshal = function (jsonObj) {
    this.id = jsonObj["id"];
    this.type = jsonObj["type"];
    this.count = jsonObj["count"];
    this.probability = jsonObj["probability"];
    this.image = jsonObj["image"];
    this.scale = jsonObj["scale"] || 1;
};

module.exports = WheelConfig;


},{}],62:[function(require,module,exports){
var ActivityTaskItemController = require("./ActivityTaskItemController");
var ConfigMan = require("../config/ConfigMan");
var EventsName = require("../events/EventsName");
var MultiColTableView = require("../../common/ext/MultiColTableView");
var ActivityTaskRewardItemController = require("./ActivityTaskRewardItemController");

var GRID_SIZE = cc.size(540, 120);

var StoreItemCellView = cc.TableViewCell.extend({
    entity: null,
    itemNode: null,
    ctor: function () {
        this._super();
        this.itemNode = ActivityTaskItemController.createFromCCB();
        this.addChild(this.itemNode);
        this.itemNode.setPosition(cc.p(GRID_SIZE.width * 0.5, GRID_SIZE.height * 0.5));
    },

    initWith: function (entity, idx) {
        this.entity = entity;
        this.itemNode.controller.initWith(entity, idx);
    }
});

var ActivityTaskController = function () {
    BaseCCBController.call(this);

    this.REWARD_START_TAG = 100;
    this.REWARD_COUNT = 5;

    this.ndRewardContainer  = null;

    this.ndContainer = null;

    this.lblTitle = null;

    this.spProgress = null;

    this.bottomProgress = null;

    this.lbLeftTime = null;

    this._tableView = null;

    //user data.
    this.configs = null;
};

game.utils.inherits(ActivityTaskController, BaseCCBController);

ActivityTaskController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
    game.eventDispatcher.addEventListener(EventsName.UPDATE_ACTIVITY_TASK_SCORE, this.onUpdateActivityTaskScore, this);
    game.eventDispatcher.addEventListener(EventsName.CLOSE_ACTIVITY_TASK, this.close, this);
    this.intervalKey = setInterval(this.onUpdate.bind(this), 1000);

};

ActivityTaskController.prototype.onExit = function () {
    clearInterval(this.intervalKey);
    game.eventDispatcher.removeEventListener(EventsName.UPDATE_ACTIVITY_TASK_SCORE, this.onUpdateActivityTaskScore, this);
    game.eventDispatcher.removeEventListener(EventsName.CLOSE_ACTIVITY_TASK, this.close, this);
    BaseCCBController.prototype.onExit.call(this);
};

ActivityTaskController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);

    var rewards = ConfigMan.getInstance().getActivityTaskRewards();
    var totalLimit = game.activityMan.getTotalActivityTaskLimitCount();
    this.rewardNodes = [];
    for (var i = 0; i < this.REWARD_COUNT; ++i) {
        var tag = this.REWARD_START_TAG + i;
        cc.log("tag:" + tag);
        var node = game.utils.seekNodeByTag(this.ndRewardContainer, tag);
        node.controller.initWith(rewards[i], i);
        this.rewardNodes.push(node);
        node.x = rewards[i].score / totalLimit * this.ndRewardContainer.width;
    }

    this.configs = ConfigMan.getInstance().getActivityTaskList();
    this.onUpdateActivityTaskScore();
    this.updateTime();
};

ActivityTaskController.prototype.initWith = function (callback) {
    this.closeCallback = callback;
};

ActivityTaskController.prototype.onUpdate = function () {
    this.updateTime();
};

ActivityTaskController.prototype.updateTime = function () {
    cc.log("activity left time:" + game.activityMan.getActivityLeftTime());
    this.lbLeftTime.setString(game.utils.sprintf(_("daily_task_tips"), game.utils.getLongFormatTime(game.activityMan.getActivityLeftTime())));
};

ActivityTaskController.prototype.onUpdateActivityTaskScore = function () {
    var width = this.bottomProgress.getPreferredSize().width * game.activityMan.getTotalActivityTaskPercent();
    var height = this.spProgress.getPreferredSize().height;
    this.spProgress.setPreferredSize(cc.size(width, height));
    this.showTableView();
    for (var i = 0; i < this.rewardNodes.length; ++i) {
        this.rewardNodes[i].controller.refresh();
    }
};

ActivityTaskController.prototype.onUpdateSkin = function (event) {
    this.showTableView();
};

ActivityTaskController.prototype.rewardClicked = function (sender) {
    //TODO popup rewards and claim it.
};

ActivityTaskController.prototype.showTableView = function () {
    if (!this._tableView) {
        var size = this.ndContainer.getContentSize();
        this._tableView = new MultiColTableView(this, size, null);
        this._tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL);
        this._tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN);
        this._tableView.setMultiTableViewDelegate(this);
        this._tableView.ignoreAnchorPointForPosition(false);
        this._tableView.setAnchorPoint(cc.p(0, 0));
        this.ndContainer.addChild(this._tableView);
    } else {
        this._offset = this._tableView.getContentOffset();
    }
    this._tableView.reloadData();
    if (this._offset) {
        this._tableView.setContentOffset(this._offset);
        this._offset = null;
    }
};

ActivityTaskController.prototype.scrollViewDidScroll = function (view) {
};

ActivityTaskController.prototype.scrollViewDidZoom = function (view) {
};

ActivityTaskController.prototype.gridAtIndex = function(multiTable,  idx) {
    var cell = multiTable.dequeueGrid();
    if (!cell) {
        cell = new StoreItemCellView();
    }

    if (idx < this.configs.length) {
        var skinCfg = this.configs[idx];
        cell.initWith(skinCfg, idx);
        cell.visible = true;
    } else {
        cell.visible = false;
    }

    return cell;
};

ActivityTaskController.prototype.numberOfCellsInTableView = function(multiTable) {
    var gridsInCell = this.numberOfGridsInCell(multiTable);
    return Math.ceil(this.configs.length / gridsInCell);
};

ActivityTaskController.prototype.numberOfGridsInCell = function(multiTable, colIdx) {
    return 1;
};

ActivityTaskController.prototype.gridSizeForTable = function(table, colIdx) {
    return cc.size(GRID_SIZE.width, GRID_SIZE.height);
};

ActivityTaskController.prototype.gridTouched = function(table, grid) {
};

ActivityTaskController.prototype.closeClicked = function (sender) {
    AudioHelper.playBtnSound();

    this.close();
};

ActivityTaskController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {popupAnim: true});
};

ActivityTaskController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
    if (this.closeCallback) {
        this.closeCallback();
        this.closeCallback = null;
    }
};

ActivityTaskController.createFromCCB = function() {
    game.utils.registerController("ActivityTaskRewardItemController", new ActivityTaskRewardItemController());
    var node = game.utils.loadNodeFromCCB("res/activity/christmas_view.ccbi", null, "ActivityTaskController", new ActivityTaskController());
    game.utils.unRegisterController("ActivityTaskRewardItemController");
    return node;
};

module.exports = ActivityTaskController;
},{"../../common/ext/MultiColTableView":16,"../config/ConfigMan":52,"../events/EventsName":169,"./ActivityTaskItemController":64,"./ActivityTaskRewardItemController":65}],63:[function(require,module,exports){

var ActivityTaskEntranceController = function () {
    BaseCCBController.call(this);

    this.lbLeftTime = null;
};

game.utils.inherits(ActivityTaskEntranceController, BaseCCBController);

ActivityTaskEntranceController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
    this.intervalKey = setInterval(this.onUpdate.bind(this), 1000);
};

ActivityTaskEntranceController.prototype.onExit = function () {
    clearInterval(this.intervalKey);
    BaseCCBController.prototype.onExit.call(this);
};

ActivityTaskEntranceController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.onUpdate();
};

ActivityTaskEntranceController.prototype.initWith = function (callback) {
    this.closeCallback = callback;
};

ActivityTaskEntranceController.prototype.onUpdate = function () {
    var leftTime = game.activityMan.getActivityLeftTime();
    if (leftTime > 0) {
        this.lbLeftTime.setString(game.utils.getLetterTime(leftTime));
    } else {
        this.close();
    }
};

ActivityTaskEntranceController.prototype.playClicked = function () {
    AudioHelper.playBtnSound();
    this.close();
    game.popupMan.popupActivityTask();
};

ActivityTaskEntranceController.prototype.closeClicked = function (sender) {
    AudioHelper.playBtnSound();

    this.close();
};

ActivityTaskEntranceController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {popupAnim: true});
};

ActivityTaskEntranceController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
    if (this.closeCallback) {
        this.closeCallback();
        this.closeCallback = null;
    }
};


ActivityTaskEntranceController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/activity/christmas_notice_view.ccbi", null, "ActivityTaskEntranceController", new ActivityTaskEntranceController());
    return node;
};

module.exports = ActivityTaskEntranceController;
},{}],64:[function(require,module,exports){
var SkinRewardType = require("../enum/SkinRewardType");
var EventsName = require("../events/EventsName");
var BoostType = require("../enum/BoostType");
var StoreHelper = require("../model/StoreHelper");
var ConfigMan = require("../config/ConfigMan");

var ActivityTaskItemController = function () {
    BaseCCBController.call(this);

    this.lblDesc = null;

    this.lblCountDesc = null;

    this.ndGo = null;
    this.ndCompleted = null;

    this.spProgress = null;
    this.bottomProgress = null;
    // this.ptProgress = null;

    this.idx = 0;
    this.data = null;
};

game.utils.inherits(ActivityTaskItemController, BaseCCBController);

ActivityTaskItemController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    // this.ptProgress = game.utils.createProgressTimer(this.spProgress, true, false);
};
/**
 * @param {TaskConfig} data
 * @param {number} idx
 */
ActivityTaskItemController.prototype.initWith = function (data, idx) {
    this.idx = idx;
    this.data = data;
    this.refresh();
};

ActivityTaskItemController.prototype.refresh = function () {
    var data = this.data;

    var config = ConfigMan.getInstance().getActivityTaskConfig(data.type);
    var currentCount = game.activityMan.getActivityTaskCount(data.type);
    var completed = currentCount >= config.limit;
    var percent = Math.min(1, currentCount / config.limit);

    this.spProgress.setPreferredSize(cc.size(this.bottomProgress.getPreferredSize().width * percent, this.spProgress.getPreferredSize().height));
    if (currentCount > config.limit) {
        currentCount = config.limit;
    }
    this.lblCountDesc.setString(currentCount + "/" + config.limit);

    this.ndGo.visible = false;
    this.ndCompleted.visible = false;

    if (completed) {
        this.ndCompleted.visible = true;
    } else {
        this.ndGo.visible = true;
    }

    this.lblDesc.setString(_(data.name));
};

ActivityTaskItemController.prototype.goClicked = function () {
    AudioHelper.playBtnSound();

    game.eventDispatcher.dispatchEvent(EventsName.CLOSE_ACTIVITY_TASK);

    game.analyseManager.trackEvent("DailyTaskGoClick", {"type": game.activityTaskType.getName(this.data.type)});

    switch (this.data.type) {
        case game.activityTaskType.Wheel:
            var WheelType = require("../enum/WheelType");
            game.popupMan.popupWheelDlg(WheelType.DailyBonus);
            break;
        case game.activityTaskType.UseBoost:
        case game.activityTaskType.Level:
        case game.activityTaskType.OpenBox:
        case game.activityTaskType.ChestOpen:
            game.gameMan.isChallengeLevel = false;
            game.gameMan.setHardMode(false);
            game.gameMan.setNewHardMode(false);
            if (game.gameMan.chooseLatestLevel()) {
                if (this.played) {
                    return;
                }
                this.played = true;
                game.sceneMan.switchScene(game.sceneType.GAME);
            } else {
                game.popupMan.popupCommonDlg(_("all_completed"));
            }
            break;
        case game.activityTaskType.ChallengeLevel:
            game.gameMan.isChallengeLevel = true;
            game.sceneMan.switchScene(game.sceneType.CHALLENGE_LIST);
            break;

    }
};

ActivityTaskItemController.createFromCCB = function() {
    return game.utils.loadNodeFromCCB("res/activity/christmas_item_view.ccbi", null, "ActivityTaskItemController", new ActivityTaskItemController());
};

module.exports = ActivityTaskItemController;
},{"../config/ConfigMan":52,"../enum/BoostType":154,"../enum/SkinRewardType":165,"../enum/WheelType":168,"../events/EventsName":169,"../model/StoreHelper":178}],65:[function(require,module,exports){
var SkinRewardType = require("../enum/SkinRewardType");
var EventsName = require("../events/EventsName");
var BoostType = require("../enum/BoostType");
var StoreHelper = require("../model/StoreHelper");
var ConfigMan = require("../config/ConfigMan");

var ActivityTaskRewardItemController = function () {
    BaseCCBController.call(this);

    this.ndReward = null;
    this.spRewardBig = null;

    this.spReward = null;
    this.lbReward = null;

    this.lbScore = null;

    this.spUnCompleted = null;
    this.spCompleted = null;

    this.spGrayMask = null;

    this.idx = 0;
    this.data = null;
};

game.utils.inherits(ActivityTaskRewardItemController, BaseCCBController);

ActivityTaskRewardItemController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
};
/**
 * @param {TaskConfig} data
 * @param {number} idx
 */
ActivityTaskRewardItemController.prototype.initWith = function (data, idx) {
    this.idx = idx;
    this.data = data;
    this.refresh();
};

ActivityTaskRewardItemController.prototype.refresh = function () {
    var data = this.data;

    var completed = game.activityMan.isActivityTaskCompleted(data);

    this.spUnCompleted.visible = !completed;
    this.spCompleted.visible = completed;

    this.ndReward.visible = false;
    this.spRewardBig.visible = false;
    if (data.type === BoostType.DIAMOND) {
        this.ndReward.visible = true;
        this.lbReward.setString("+" + data.count);
    } else {
        this.spRewardBig.visible = true;
        this.spRewardBig.setSpriteFrame(cc.spriteFrameCache.getSpriteFrame(data.image));
        this.spRewardBig.setScale(data.scale);
    }

    // this.lbScore.setString("" + data.score);

    if (this.canClaimReward()) {
        game.utils.playCCBAnimation(this.rootNode, "reward");
    } else {
        game.utils.playCCBAnimation(this.rootNode, "normal");
    }

    this.spGrayMask.visible = game.activityMan.isRewardClaimed(data);
};

ActivityTaskRewardItemController.prototype.canClaimReward = function () {
    return game.activityMan.canClaimReward(this.data);
};

ActivityTaskRewardItemController.prototype.rewardClicked = function () {
    if (this.canClaimReward()) {
        AudioHelper.playBtnSound();
        game.activityMan.claimActivityTaskReward(this.data);
    }
};

module.exports = ActivityTaskRewardItemController;
},{"../config/ConfigMan":52,"../enum/BoostType":154,"../enum/SkinRewardType":165,"../events/EventsName":169,"../model/StoreHelper":178}],66:[function(require,module,exports){
var EventsName = require("../events/EventsName");

var ActivityTaskTipsController = function () {
    BaseCCBController.call(this);

    this.spReward = null;
    this.spProgress = null;
    this.lbScore = null;
};

game.utils.inherits(ActivityTaskTipsController, BaseCCBController);

ActivityTaskTipsController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
    game.eventDispatcher.addEventListener(EventsName.UPDATE_ACTIVITY_TASK_SCORE, this.onUpdateProgress, this);
};

ActivityTaskTipsController.prototype.onExit = function () {
    game.eventDispatcher.removeEventListener(EventsName.UPDATE_ACTIVITY_TASK_SCORE, this.onUpdateProgress, this);
    BaseCCBController.prototype.onExit.call(this);
};

ActivityTaskTipsController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    if (!game.activityMan.isOpen()) {
        this.rootNode.visible = false;
        return;
    }
    this.ptProgress = game.utils.createProgressTimer(this.spProgress, false, false);
    this.updateProgress(false);
};

ActivityTaskTipsController.prototype.onUpdateProgress = function () {
    this.updateProgress(true);
    game.audioPlayer.playEffectByKey("add_task_progress");
};

ActivityTaskTipsController.prototype.updateProgress = function (anim) {
    if (!game.activityMan.isOpen()) {
        return;
    }
    var nextReward = game.activityMan.getNextStageRewardCfg();
    var currentReward = game.activityMan.getCurrentStageRewardCfg();
    var currentScore = 0;
    if (currentReward) {
        currentScore = currentReward.score;
    }
    var totalScore = nextReward.score - currentScore;
    var nowScore = game.activityMan.getTotalActivityTaskCount() - currentScore;
    var percent = Math.min(1, nowScore / totalScore);
    if (anim) {
        if (this.lastNextReward !== nextReward) {
            this.ptProgress.runAction(cc.sequence(cc.progressTo(0.5, 100), cc.progressFromTo(0.5, 0, percent * 100)));
        } else {
            this.ptProgress.runAction(cc.progressTo(0.5, percent * 100));
        }
    } else {
        this.ptProgress.setPercentage(percent * 100);
    }
    this.lbScore.setString(game.activityMan.getTotalActivityTaskCount() + "/" + nextReward.score);
    this.spReward.setSpriteFrame(cc.spriteFrameCache.getSpriteFrame(nextReward.image));
    this.lastNextReward = nextReward;

    if (game.activityMan.hasUnClaimedReward()) {
        game.utils.playCCBAnimation(this.rootNode, "anim");
    } else {
        game.utils.playCCBAnimation(this.rootNode, "Default Timeline");
    }
};

ActivityTaskTipsController.prototype.taskClicked = function () {
    AudioHelper.playBtnSound();
    game.analyseManager.trackEvent("DailyTaskTipsClick");
    game.popupMan.popupActivityTask();
};

module.exports = ActivityTaskTipsController;
},{"../events/EventsName":169}],67:[function(require,module,exports){
var EventsName = require("../events/EventsName");

var AdsReminderController = function () {
    BaseCCBController.call(this);

    this.spReminder = null;
    this.lbReminder = null;
};

game.utils.inherits(AdsReminderController, BaseCCBController);

AdsReminderController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
    game.eventDispatcher.addEventListener(EventsName.REWARDED_VIDEO_COUNT, this.onUpdateReminder, this);
};

AdsReminderController.prototype.onExit = function () {
    game.eventDispatcher.removeEventListener(EventsName.REWARDED_VIDEO_COUNT, this.onUpdateReminder, this);
    BaseCCBController.prototype.onExit.call(this);
};

AdsReminderController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.onUpdateReminder();
};

AdsReminderController.prototype.onUpdateReminder = function () {
    var count = game.config.rewardAdMaxCountPerDay - game.playerMan.getRewardAdPlaceCountPerDay();
    if (count < 0) {
        count = 0;
    }
    this.lbReminder.setString(count);
};

AdsReminderController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/ads_reminder_view.ccbi", null, "AdsReminderController", new AdsReminderController(), true);
    return node;
};

module.exports = AdsReminderController;
},{"../events/EventsName":169}],68:[function(require,module,exports){


var AimHelpController = function () {
    BaseCCBController.call(this);
    this.spHand = null;
};

game.utils.inherits(AimHelpController, BaseCCBController);

AimHelpController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    //this.lbHelpInfo.setString(game.local.getValue("aim_help_content"));
    //this.lbHelpInfo.setAlignment(cc.TEXT_ALIGNMENT_CENTER);
};

AimHelpController.prototype.getHandWorldPosition = function () {
    return this.spHand.parent.convertToWorldSpace(this.spHand.getPosition());
};

module.exports = AimHelpController;
},{}],69:[function(require,module,exports){
var EventsName = require("../events/EventsName");

var AimItemController = function () {
    BaseCCBController.call(this);

    this.btnAimItem = null;
    this.lbAimPrice = null;
    //this.lbAimTips = null;

    this.hided = false;
};

game.utils.inherits(AimItemController, BaseCCBController);

AimItemController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.lbAimPrice.setString(game.config.aimItemDiamonds);
};

AimItemController.prototype.tryAimItemClicked = function () {
    AudioHelper.playBtnSound();
    var StoreHelper = require("../model/StoreHelper");
    StoreHelper.getInstance().tryAimItem(game.gameMan.levelId, function () {
        game.gameMan.tryAimItem();
        this.playHideAnim();
    }.bind(this));
};

AimItemController.prototype.playHideAnim = function () {
    if (this.hided) {
        return;
    }
    this.hided = true;
    this.btnAimItem.enabled = false;
    game.utils.playCCBAnimation(this.rootNode, "hide");

    this.rootNode.runAction(cc.sequence(cc.delayTime(0.5), cc.hide()));
};

AimItemController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/aim_item_view.ccbi", null, "AimItemController", new AimItemController(), true);
    return node;
};

module.exports = AimItemController;
},{"../events/EventsName":169,"../model/StoreHelper":178}],70:[function(require,module,exports){
//var SkinItemController = require("./SkinItemController");
//var ConfigMan = require("../config/ConfigMan");
//var EventsName = require("../events/EventsName");
//
//var GRID_SIZE = cc.size(350, 500);
//
//var StoreItemCellView = cc.TableViewCell.extend({
//    entity: null,
//    itemNode: null,
//    ctor: function () {
//        this._super();
//        this.itemNode = SkinItemController.createFromCCB();
//        this.addChild(this.itemNode);
//        this.itemNode.setPosition(cc.p(GRID_SIZE.width * 0.5, GRID_SIZE.height * 0.5));
//    },
//
//    initWith: function (entity, idx, inited) {
//        this.entity = entity;
//        this.itemNode.controller.initWith(entity, idx);
//    }
//});
var BoostType = require("../enum/BoostType");
var GameMan = require("../model/GameMan");

var BagController = function () {
    BaseCCBController.call(this);
    this.lbBoostName1 = null;
    this.lbBoostName2 = null;
    this.lbBoostDesc1 = null;
    this.lbBoostDesc2 = null;
    this.lbShareTips = null;
};

game.utils.inherits(BagController, BaseCCBController);

BagController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
};

BagController.prototype.onExit = function () {
    BaseCCBController.prototype.onExit.call(this);
};

BagController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.lbBoostName1.setString(_("boost_split_title") + " X" + (game.playerMan.getBoostCount(BoostType.SPLIT)));
    this.lbBoostName2.setString(_("boost_new_title") + " X" + (game.playerMan.getBoostCount(BoostType.THREE_BALL)));
    this.lbBoostDesc1.setString(_("boost_split_desc"));
    this.lbBoostDesc2.setString(_("boost_new_desc"));
    this.lbShareTips.setString("");//_("bag_share_tips"));
    this.lbTitle.setString(_("bag_title"));
};

BagController.prototype.backClicked = function (sender) {
    AudioHelper.playBtnSound();

    this.close();
};

BagController.prototype.shareClicked = function (sender) {
    AudioHelper.playBtnSound();
    var share = GameMan.getInstance().getShareConfig();
    game.shareManager.wxShare(share, function (shared) {

    });
};

BagController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode);
};

BagController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

BagController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/bag_view.ccbi", null, "BagController", new BagController());
    return node;
};

module.exports = BagController;
},{"../enum/BoostType":154,"../model/GameMan":173}],71:[function(require,module,exports){
var GameMan = require("../model/GameMan");
var EventsName = require("../events/EventsName");

var BoardController = function () {
    BaseCCBController.call(this);

    this.spCircle = null;
    this.ndBoard = null;
    this.spBall = null;
    this.sprBoard = null;
};

game.utils.inherits(BoardController, BaseCCBController);

BoardController.prototype.onEnter = function() {
    BaseCCBController.prototype.onEnter.call(this);
    game.eventDispatcher.addEventListener(EventsName.UPDATE_BOARD, this.onUpdateSkin, this);
};

BoardController.prototype.onExit = function() {
    game.eventDispatcher.removeEventListener(EventsName.UPDATE_BOARD, this.onUpdateSkin, this);
    BaseCCBController.prototype.onExit.call(this);
};

BoardController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    GameMan.getInstance().updateSkin(this.spBall);
    this.onUpdateSkin();
};

BoardController.prototype.onUpdateSkin = function () {
    var skinCfg = GameMan.getInstance().getCurrentBoardCfg();
    var image = skinCfg.image + ".png";
    this.sprBoard.setSpriteFrame(cc.spriteFrameCache.getSpriteFrame(image));
};

BoardController.prototype.initWith = function (ballWidth) {
    var scale = GameMan.getInstance().getCurrentSkinCfg().scale;
    this.spBall.scaleX = ballWidth / this.spBall.width * scale;
    this.spBall.scaleY = ballWidth / this.spBall.height * scale;
};

BoardController.prototype.hideBall = function () {
    this.spBall.visible = false;
};

BoardController.prototype.showBall = function () {
    this.spBall.visible = true;
};

BoardController.createFromCCB = function(ballWidth) {
    var node = game.utils.loadNodeFromCCB("res/game/board_view.ccbi", null, "BoardController", new BoardController());
    node.controller.initWith(ballWidth);
    return node;
};

module.exports = BoardController;
},{"../events/EventsName":169,"../model/GameMan":173}],72:[function(require,module,exports){
var EventsName = require("../events/EventsName");

var BoardGetController = function () {
    BaseCCBController.call(this);

    this.btnPurchase = null;
    // this.lbAimPrice = null;
    // //this.lbAimTips = null;

    this.spBoardSkin = null;
    this.hided = false;
};

game.utils.inherits(BoardGetController, BaseCCBController);

BoardGetController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    // this.lbAimPrice.setString(game.config.aimItemDiamonds);
};

BoardGetController.prototype.initWith = function (boardCfg) {
    this.boardCfg = boardCfg;
    this.spBoardSkin.setSpriteFrame(boardCfg.image + ".png");
};

BoardGetController.prototype.purchaseBoardClicked = function () {
    AudioHelper.playBtnSound();
    var StoreHelper = require("../model/StoreHelper");
    StoreHelper.getInstance().buyBoard(this.boardCfg, "buy_board_in_game", function (rewarded) {
        if (rewarded) {
            this.playHideAnim();
        }
    }.bind(this));
};

BoardGetController.prototype.playHideAnim = function () {
    if (this.hided) {
        return;
    }
    this.hided = true;
    this.btnPurchase.enabled = false;
    game.utils.playCCBAnimation(this.rootNode, "hide");

    this.rootNode.runAction(cc.sequence(cc.delayTime(0.6), cc.hide()));
};

BoardGetController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/board_get_view.ccbi", null, "BoardGetController", new BoardGetController(), true);
    return node;
};

module.exports = BoardGetController;
},{"../events/EventsName":169,"../model/StoreHelper":178}],73:[function(require,module,exports){
var SkinRewardType = require("../enum/SkinRewardType");
var EventsName = require("../events/EventsName");
var SkinType = require("../enum/SkinType");

var BoardItemController = function () {
    BaseCCBController.call(this);

    this.ndPurchase = null;
    this.ndOwned = null;
    this.ndWatchAds = null;
    this.ndChallenge = null;
    this.ndKeyActivity = null;

    this.lbDiamondPrice = null;
    this.lbUsing = null;
    this.lbRewardAdsCount = null;

    this.spSkin = null;

    this.idx = 0;
    this.skinCfg = null;
};

game.utils.inherits(BoardItemController, BaseCCBController);

BoardItemController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
};

BoardItemController.prototype.onEnter = function() {
    BaseCCBController.prototype.onEnter.call(this);
    game.eventDispatcher.addEventListener(EventsName.UPDATE_BOARD, this.onUpdateSkin, this);
};

BoardItemController.prototype.onExit = function() {
    game.eventDispatcher.removeEventListener(EventsName.UPDATE_BOARD, this.onUpdateSkin, this);
    BaseCCBController.prototype.onExit.call(this);
};
/**
 * @param {SkinConfig} data
 * @param {number} idx
 */
BoardItemController.prototype.initWith = function (data, idx) {
    this.idx = idx;
    this.skinCfg = data;
    try {
        var spriteFrame = cc.spriteFrameCache.getSpriteFrame(data.image + ".png");
        this.spSkin.setSpriteFrame(spriteFrame);

        this.ndPurchase.visible = false;
        this.ndOwned.visible = false;
        this.ndWatchAds.visible = false;
        this.ndChallenge.visible = false;
        this.ndKeyActivity.visible = false;
        this.ndChristmas.visible = false;

        var owned = game.playerMan.hasBoard(this.skinCfg.id);
        if (owned) {
            this.ndOwned.visible = true;
            if (data.id === game.playerMan.getCurrentBoardId()) {
                this.lbUsing.setString(_("selected_title"));
            } else {
                this.lbUsing.setString(_("select_title"));
            }
        } else {
            switch (data.type) {
                case SkinType.WatchAds:
                    var skinRewardCount = game.playerMan.getBoardAdsCount(data.id);
                    this.ndWatchAds.visible = true;
                    this.lbRewardAdsCount.setString(game.utils.sprintf("%d/%d", skinRewardCount, data.count));
                    break;
                case SkinType.Diamonds:
                    this.ndPurchase.visible = true;
                    this.lbDiamondPrice.setString(this.skinCfg.count);
                    break;
                case SkinType.Challenge:
                    this.ndChallenge.visible = true;
                    break;
                case SkinType.KeyActivity:
                    this.ndKeyActivity.visible = true;
                    break;
                case SkinType.Christmas:
                    this.ndChristmas.visible = true;
                    break;
            }
        }
    } catch (ex) {
        cc.error(ex);
    }
};

BoardItemController.prototype.onUpdateSkin = function () {
    this.initWith(this.skinCfg, this.idx);
};

BoardItemController.prototype.getContentSize = function () {
    return this.spBgSelected.getContentSize();
};

BoardItemController.prototype.purchaseClicked = function () {
    AudioHelper.playBtnSound();
    var StoreHelper = require("../model/StoreHelper");
    StoreHelper.getInstance().buyBoard(this.skinCfg, "buy_board_in_store");
};

BoardItemController.prototype.selectClicked = function () {
    AudioHelper.playBtnSound();
    game.playerMan.setCurrentBoardId(this.skinCfg.id);
    game.eventDispatcher.dispatchEvent(EventsName.UPDATE_BOARD);
};

BoardItemController.createFromCCB = function() {
    return game.utils.loadNodeFromCCB("res/menu/board_item_view.ccbi", null, "BoardItemController", new BoardItemController());
};

module.exports = BoardItemController;
},{"../enum/SkinRewardType":165,"../enum/SkinType":166,"../events/EventsName":169,"../model/StoreHelper":178}],74:[function(require,module,exports){
var BoxItemController = require("./BoxItemController");
var ConfigMan = require("../config/ConfigMan");
var EventsName = require("../events/EventsName");
var MultiColTableView = require("../../common/ext/MultiColTableView");
var StoreHelper = require("../model/StoreHelper");
var EventsName = require("../events/EventsName");
var BoostType = require("../enum/BoostType");

var GRID_SIZE = cc.size(183, 183);

var StoreItemCellView = cc.TableViewCell.extend({
    entity: null,
    itemNode: null,
    ctor: function () {
        this._super();
        this.itemNode = BoxItemController.createFromCCB();
        this.addChild(this.itemNode);
        this.itemNode.setPosition(cc.p(GRID_SIZE.width * 0.5, GRID_SIZE.height * 0.5));
    },

    initWith: function (entity, idx, bestReward) {
        this.entity = entity;
        this.itemNode.controller.initWith(entity, idx, bestReward);
    },

    playFlyBoxAnim: function () {
        this.itemNode.controller.playFlyBoxAnim();
    },

    isOpened: function () {
        return this.itemNode.controller.opened;
    }
});

var BoxController = function () {
    BaseCCBController.call(this);
    this.KEY_START_NO_TAG = 200;
    this.KEY_COUNT = 3;
    this.KEY_START_TAG = 300;

    this.ndContainer = null;
    this.ndWatchAds = null;
    this.ndKey = null;
    this.spSuperReward = null;
    this.ndKeyNode = null;
    this.ndAllCompleted = null;

    this.btnWatchAds = null;
    this.topBg = null;

    this._tableView = null;

    //user data.
    this.configs = null;
    this.superConfig = null;

    // this.unlockCount = 0;
};

game.utils.inherits(BoxController, BaseCCBController);

BoxController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
    game.eventDispatcher.addEventListener(EventsName.OPEN_KEY_BOX, this.onUpdateKeyBox, this);
};

BoxController.prototype.onExit = function () {
    game.eventDispatcher.removeEventListener(EventsName.OPEN_KEY_BOX, this.onUpdateKeyBox, this);
    BaseCCBController.prototype.onExit.call(this);
};

BoxController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);

    this.ndKeyNodes = [];
    this.ndKeyNoNodes = [];
    for (var i = 0; i < this.KEY_COUNT; ++i) {
        var keyNode = this.ndKeyNode.getChildByTag(this.KEY_START_TAG + i);
        var keyNoNode = this.ndKeyNode.getChildByTag(this.KEY_START_NO_TAG + i);
        this.ndKeyNodes.push(keyNode);
        this.ndKeyNoNodes.push(keyNoNode);
    }

    this.configs = game.gameMan.getBoxRewards();
    this.superConfig = this.configs[0];
    game.gameMan.boxConfigs = this.configs;
    game.gameMan.unlockBoxCount = 0;
    // game.utils.shuffle(this.configs);
    switch (this.superConfig.type) {
        case BoostType.SKIN:
            this.spSuperReward.setSpriteFrame(this.superConfig.extra.image + "_l.png");
            break;
        default:
            if (this.superConfig.extra) {
                this.spSuperReward.setSpriteFrame(this.superConfig.extra.image + ".png");
            } else {
                this.spSuperReward.setSpriteFrame(this.superConfig.image);
            }
    }

    this.showTableView();
    this.updateKey();

    // this.topBg.runAction(cc.rotateBy(2, 360).repeatForever());
};

BoxController.prototype.initWith = function (callback) {
    this.closeCallback = callback;
};

BoxController.prototype.updateKey = function () {
    this.ndWatchAds.visible = false;
    this.ndKey.visible = false;
    this.ndAllCompleted.visible = false;
    if (game.playerMan.player.currentKeyCount > 0) {
        this.ndKey.visible = true;
        var keyCount = game.playerMan.player.currentKeyCount;
        for (var i = 0; i < this.KEY_COUNT; ++i) {
            var node = this.ndKeyNodes[i];
            node.visible = (keyCount > i);
        }
    } else {
        if (game.gameMan.unlockBoxCount >= 9) {
            this.ndAllCompleted.visible = true;
        } else {
            this.ndWatchAds.visible = true;
            game.utils.playCCBAnimation(this.rootNode, "Default Timeline");
            // this.topBg.runAction(cc.rotateBy(2, 360).repeatForever());
        }
    }
};

BoxController.prototype.onUpdateKeyBox = function (event) {
    game.gameMan.unlockBoxCount ++;
    if (game.gameMan.unlockBoxCount === 3) {
        game.activityMan.addActivityTaskCount(game.activityTaskType.ChestOpen);
    }
    this.updateKey();
};

BoxController.prototype.showTableView = function () {
    if (!this._tableView) {
        var size = this.ndContainer.getContentSize();
        this._tableView = new MultiColTableView(this, size, null);
        this._tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL);
        this._tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN);
        this._tableView.setMultiTableViewDelegate(this);
        this._tableView.ignoreAnchorPointForPosition(false);
        this._tableView.setAnchorPoint(cc.p(0, 0));
        this._tableView.setBounceable(false);
        this.ndContainer.addChild(this._tableView);
    } else {
        this._offset = this._tableView.getContentOffset();
    }
    this._tableView.reloadData();
    if (this._offset) {
        this._tableView.setContentOffset(this._offset);
        this._offset = null;
    }
};

BoxController.prototype.scrollViewDidScroll = function (view) {
};

BoxController.prototype.scrollViewDidZoom = function (view) {
};

BoxController.prototype.gridAtIndex = function(multiTable,  idx) {
    var cell = multiTable.dequeueGrid();
    if (!cell) {
        cell = new StoreItemCellView();
    }

    if (idx < this.configs.length) {
        var skinCfg = this.configs[idx];
        cell.initWith(skinCfg, idx, this.superConfig);
        cell.visible = true;
    } else {
        cell.visible = false;
    }

    return cell;
};

BoxController.prototype.numberOfCellsInTableView = function(multiTable) {
    var gridsInCell = this.numberOfGridsInCell(multiTable);
    return Math.ceil(this.configs.length / gridsInCell);
};

BoxController.prototype.numberOfGridsInCell = function(multiTable, colIdx) {
    return 3;
};

BoxController.prototype.gridSizeForTable = function(table, colIdx) {
    return cc.size(GRID_SIZE.width, GRID_SIZE.height);
};

BoxController.prototype.gridTouched = function(table, grid) {
};

BoxController.prototype.watchAdsClicked = function (sender) {
    AudioHelper.playBtnSound();

    var self = this;
    StoreHelper.getInstance().checkAndShowRewardVideo("get_new_key", function (watched) {
        if (watched) {
            game.playerMan.setCurrentKeyCount(3);
            self.updateKey();
        }
    });
};

BoxController.prototype.closeClicked = function (sender) {
    AudioHelper.playBtnSound();

    this.close();
};

BoxController.prototype.allCompletedClicked = function (sender) {
    AudioHelper.playBtnSound();

    this.close();
};

BoxController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {popupAnim: true});
};

BoxController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
    if (this.closeCallback) {
        this.closeCallback();
        this.closeCallback = null;
    }
};

BoxController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/activity/activity_openbox_view.ccbi", null, "BoxController", new BoxController());
    return node;
};

module.exports = BoxController;
},{"../../common/ext/MultiColTableView":16,"../config/ConfigMan":52,"../enum/BoostType":154,"../events/EventsName":169,"../model/StoreHelper":178,"./BoxItemController":75}],75:[function(require,module,exports){
var LockStatus = require("../enum/LockStatus");
var GameMan = require("../model/GameMan");
var StoreHelper = require("../model/StoreHelper");
var EventsName = require("../events/EventsName");

var BoxItemController = function () {
    BaseCCBController.call(this);

    this.ndItem = null;
    this.ndBox = null;
    this.sprItem = null;
    this.lbCount = null;
    this.bg = null;

    this.idx = 0;
    this.data = null;

    this.opened = false;
};

game.utils.inherits(BoxItemController, BaseCCBController);

BoxItemController.prototype.onDidLoadFromCCB = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
};

BoxItemController.prototype.playFlyBoxAnim = function () {
    this.opened = true;
    // this.ndItem.visible = true;
    // this.ndBox.visible = false;

    this.data = game.gameMan.randomBox();

    if (this.data.extra && this.data.extra.image) {
        this.sprItem.setSpriteFrame(this.data.extra.image + ".png");
    } else {
        this.sprItem.setSpriteFrame(this.data.image);
    }
    if (this.data.scale) {
        this.sprItem.scale *= this.data.scale;
    }
    this.lbCount.setString("X" + this.data.count);
    game.audioPlayer.playEffectByKey("open_box");
    game.eventDispatcher.dispatchEvent(EventsName.OPEN_KEY_BOX);
    StoreHelper.getInstance().claimBoxReward(this.data);

    this.bg.runAction(cc.rotateBy(2, 360).repeatForever());

    if (this.bestReward === this.data) {
        game.activityMan.addActivityTaskCount(game.activityTaskType.OpenBox);
    }

    game.utils.playCCBAnimation(this.rootNode, "flip");
};

/**
 * @param {LevelConfig} data
 * @param {number} idx
 * @param {Object} best
 */
BoxItemController.prototype.initWith = function (data, idx, best) {
    cc.log("BoxItemController initWith");
    this.opened = false;
    this.idx = idx;
    this.bestReward = best;
    // this.ndItem.visible = false;
    // this.ndBox.visible = true;
};

BoxItemController.prototype.boxClicked = function () {
    AudioHelper.playBtnSound();
    if (game.playerMan.player.currentKeyCount > 0 && !this.opened) {
        game.playerMan.reduceCurrentKeyCount();
        this.playFlyBoxAnim();
    }
};

BoxItemController.createFromCCB = function() {
    return game.utils.loadNodeFromCCB("res/activity/activity_box_item_view.ccbi", null, "BoxItemController", new BoxItemController());
};

module.exports = BoxItemController;
},{"../enum/LockStatus":161,"../events/EventsName":169,"../model/GameMan":173,"../model/StoreHelper":178}],76:[function(require,module,exports){
var Wheel = require("../../common/wheel/Wheel");
var ConfigMan = require("../config/ConfigMan");
var BoostType = require("../enum/BoostType");
var StoreHelper = require("../model/StoreHelper");
var GameMan = require("../model/GameMan");
var WheelType = require("../enum/WheelType");
var CardItemController = require("./CardItemController");

var CardController = function () {
    BaseCCBController.call(this);

    this.X = 120;
    this.Y = 140;

    this.ndCard1 = null;
    this.ndCard2 = null;
    this.ndCard3 = null;
    this.ndCard4 = null;

    this.ndWatch = null;
    this.ndClose = null;

    this.cardList = null;
    this.cardNodes = null;
    this.intervalKey = null;

    this.cardCount = 0;
    this.cardAnimCount = 0;
};

game.utils.inherits(CardController, BaseCCBController);

CardController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
    // this.intervalKey = setInterval(this.onUpdate.bind(this), 1000);
};

CardController.prototype.onExit = function () {
    // clearInterval(this.intervalKey);
    BaseCCBController.prototype.onExit.call(this);

    if (this.closeCallback) {
        this.closeCallback();
    }
};

CardController.prototype.onDidLoadFromCCB = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);

    var cardList = ConfigMan.getInstance().getCardList();

    this.cardList = game.utils.clone(cardList);
    for (var i = 0; i < this.cardList.length; ++i) {
        var card = this.cardList[i];
        card.count = game.utils.randomNextIntInRange(card.count - 3, card.count + 3);
    }
    game.utils.shuffle(this.cardList);

    this.cardNodes = [
        this["ndCard1"],
        this["ndCard2"],
        this["ndCard3"],
        this["ndCard4"]
    ];

    this.playShuffleAnim();

    this.ndWatch.visible = false;
    this.ndClose.visible = false;
};

CardController.prototype.initWith = function (callback) {
    this.closeCallback = callback;
};

CardController.prototype.playShuffleAnim = function () {
    var animTime = 0.5;
    var offsetX = 70;
    for (var i = 0; i < this.cardNodes.length; ++i) {
        var cardNode = this.cardNodes[i];
        cardNode.controller.initWith(this.cardList[i]);
        cardNode.startPos = cardNode.getPosition();
        cardNode.controller.showCardFront();
        cardNode.controller.enabledClick = false;
        cardNode.setPosition(cc.p(0, 0));
        var direction = ((i % 2) === 0) ? 1 : -1;
        var totalTime = 2.5;
        var action = cc.sequence(
            cc.delayTime(i * 0.5 + 0.5),//0.5, 1, 1.5, 2
            cc.callFunc(function () {
                game.audioPlayer.playEffectByKey("card_turn");
            }, this),
            cc.moveTo(animTime, cardNode.startPos),
            cc.delayTime(totalTime - i * 0.5 - 0.5),
            cc.callFunc(cardNode.controller.showCardBackAnim, cardNode.controller),
            cc.delayTime(1),
            cc.moveTo(animTime, cc.p(0, 0)),
            cc.callFunc(this.onShowShuffleAudio, this),
            cc.moveTo(animTime * 0.2, cc.p(direction * offsetX, 0)),
            cc.moveTo(animTime * 0.2, cc.p(0, 0)),
            cc.moveTo(animTime * 0.2, cc.p(-direction * offsetX, 0)),
            cc.moveTo(animTime * 0.2, cc.p(0, 0)),
            cc.moveTo(animTime * 0.2, cc.p(direction * offsetX, 0)),
            cc.moveTo(animTime * 0.2, cc.p(0, 0)),
            cc.moveTo(animTime * 0.2, cc.p(-direction * offsetX, 0)),
            cc.moveTo(animTime * 0.2, cc.p(0, 0)),
            cc.callFunc(this.onEndShuffleAudio, this),
            cc.moveTo(animTime, cardNode.startPos),
            cc.callFunc(this.onShuffled, this)
        );
        cardNode.runAction(action);
    }
};

CardController.prototype.onShowShuffleAudio = function () {
    if (this.showedShuffleAudio) {
        return;
    }
    this.showedShuffleAudio = true;
    game.audioPlayer.playEffectByKey("card_turn", true);
};

CardController.prototype.onEndShuffleAudio = function () {
    if (this.endShuffleAudio) {
        return;
    }
    this.endShuffleAudio = true;
    game.audioPlayer.stopEffect("card_turn");
};

CardController.prototype.onShuffled = function () {
    if (this.shuffled) {
        return;
    }
    cc.log("CardController.prototype.onShuffled");
    this.shuffled = true;
    game.utils.shuffle(this.cardList);
    for (var i = 0; i < this.cardNodes.length; ++i) {
        var cardNode = this.cardNodes[i];
        cardNode.controller.enabledClick = true;
        cardNode.controller.initWith(this.cardList[i], this.onShowCardCallback.bind(this), this.onCardAnimEndCallback.bind(this));
    }
};

CardController.prototype.onShowCardCallback = function () {
    this.cardCount++;
    game.audioPlayer.playEffectByKey("card_turn");
    if (this.cardCount >= 2) {
        cc.log("CardController.prototype.onShowCardCallback 1:" + this.cardCount);
        for (var i = 0; i < this.cardNodes.length; ++i) {
            var cardNode = this.cardNodes[i];
            cardNode.controller.enabledClick = false;
        }
    } else {
        cc.log("CardController.prototype.onShowCardCallback 2");
    }
};

CardController.prototype.onCardAnimEndCallback = function () {
    this.cardAnimCount++;
    if (this.cardAnimCount >= 2) {
        game.audioPlayer.playEffectByKey("card_turn");
        for (var i = 0; i < this.cardNodes.length; ++i) {
            var cardNode = this.cardNodes[i];
            cardNode.controller.stopClaimed = true;
            cardNode.controller.showCardFrontAnim();
        }
        this.ndWatch.visible = true;
        this.ndClose.visible = true;
        game.utils.playCCBAnimation(this.rootNode, "show");
    }
};

CardController.prototype.watchAdsClicked = function () {
    AudioHelper.playBtnSound();
    // this.close();
    StoreHelper.getInstance().checkAndShowRewardVideo("flip_card_again", function (watched) {
        if (watched) {
            this.close();
            game.popupMan.popupCard();
        }
    }.bind(this));
};

CardController.prototype.closeClicked = function () {
    AudioHelper.playBtnSound();
    this.close();
};

CardController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {popupAnim: true});
};

CardController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

CardController.createFromCCB = function() {
    game.utils.registerController("CardItemController", new CardItemController());
    //var ccbiName = game.utils.isSelfGame() ? "res/wheel/wheel_view.ccbi" : "res/wheel/wheel_view_new.ccbi";
    var node = game.utils.loadNodeFromCCB("res/menu/cards_view.ccbi", null, "CardController", new CardController());
    game.utils.unRegisterController("CardItemController");
    return node;
};

module.exports = CardController;
},{"../../common/wheel/Wheel":39,"../config/ConfigMan":52,"../enum/BoostType":154,"../enum/WheelType":168,"../model/GameMan":173,"../model/StoreHelper":178,"./CardItemController":77}],77:[function(require,module,exports){
var BoostType = require("../enum/BoostType");

var CardItemController = function () {
    BaseCCBController.call(this);

    this.ANIM_TIME = 0.4;

    this.lblCount = null;
    this.spCardBack = null;
    this.spCardFront = null;

    this.spDiamond = null;

    this.ndCardBack = null;
    this.ndCardFront = null;

    this.cardData = null;

    this.enabledClick = false;

    this.stopClaimed = false;
};

game.utils.inherits(CardItemController, BaseCCBController);

CardItemController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
};
/**
 * @param {CardConfig} data
 */
//day, state, rewardObj, claimed
CardItemController.prototype.initWith = function (data, showCardCallback, animEndCallback) {
    this.cardData = data;
    this.lblCount.setString("x" + data.count);
    this.showCardCallback = showCardCallback;
    this.animEndCallback = animEndCallback;
};

CardItemController.prototype.onCardClicked = function () {
    if (!this.enabledClick) {
        return;
    }
    // AudioHelper.playBtnSound();
    this.showCardFrontAnim();
};

CardItemController.prototype.showCardBack = function () {
    this.ndCardBack.visible = true;
    this.ndCardFront.visible = false;
    this.ndCardBack.scaleX = 1;
};

CardItemController.prototype.showCardFront = function () {
    this.ndCardBack.visible = false;
    this.ndCardFront.visible = true;
    this.ndCardFront.scaleX = 1;
};

CardItemController.prototype.showCardFrontAnim = function () {
    if (this.clicked) {
        return;
    }
    this.clicked = true;
    this.showCardCallback && this.showCardCallback();
    this.ndCardBack.visible = true;
    this.ndCardFront.visible = false;
    this.ndCardBack.scaleX = 1;
    this.ndCardBack.runAction(cc.sequence(
        cc.scaleTo(this.ANIM_TIME, 0, 1),
        cc.callFunc(this.onCardFrontShowed, this)
    ));
};

CardItemController.prototype.onCardFrontShowed = function () {
    this.ndCardFront.visible = true;
    this.ndCardBack.visible = false;
    this.ndCardFront.scaleX = 0;
    this.ndCardFront.runAction(cc.sequence(
        cc.scaleTo(this.ANIM_TIME, 1, 1),
        cc.callFunc(this.onCardShowed, this)
    ));
};

CardItemController.prototype.onCardShowed = function () {
    if (this.stopClaimed) {
        return;
    }
    var diamondPos = this.spDiamond.parent.convertToWorldSpace(this.spDiamond.getPosition());
    var diamndEndPos = cc.p(cc.winSize.width - 80, cc.winSize.height - 60);
    game.effectMan.playFlyCoins(diamondPos, diamndEndPos, 10, 1000, function () {
        game.playerMan.addDiamonds(this.cardData.count, "card_flip");
    }.bind(this), function () {
        //this.ndClaimDiamonds.runAction(cc.sequence(cc.delayTime(1), cc.fadeOut(0.3)));
        this.animEndCallback && this.animEndCallback();
    }.bind(this));
};

CardItemController.prototype.showCardBackAnim = function () {
    this.ndCardBack.visible = false;
    this.ndCardFront.visible = true;
    this.ndCardFront.scaleX = 1;
    this.ndCardFront.runAction(cc.sequence(
        cc.scaleTo(this.ANIM_TIME, 0, 1),
        cc.callFunc(this.onCardBackShowed, this)
    ));
};

CardItemController.prototype.onCardBackShowed = function () {
    this.ndCardFront.visible = false;
    this.ndCardBack.visible = true;
    this.ndCardBack.scaleX = 0;
    this.ndCardBack.runAction(cc.sequence(
       cc.scaleTo(this.ANIM_TIME, 1, 1),
        cc.callFunc(this.onCardBacked, this)
    ));
};

CardItemController.prototype.onCardBacked = function () {

};

CardItemController.createFromCCB = function() {
    return game.utils.loadNodeFromCCB("res/menu/daily_bonus_item_view.ccbi", null, "CardItemController", new CardItemController());
};

module.exports = CardItemController;
},{"../enum/BoostType":154}],78:[function(require,module,exports){
var ChallengeLevelController = require("./ChallengeLevelController");

var ChallengeController = function () {
    BaseCCBController.call(this);

    this.LEVEL_COUNT = 25;

    this.currentChallengeNode = null;
};

game.utils.inherits(ChallengeController, BaseCCBController);

ChallengeController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    if (!game.utils.isPad()) {
        this.rootNode.scale = 640.0 / 768.0;
    }
    var lastNode = null;
    for (var i = 1; i <= this.LEVEL_COUNT; ++i) {
        cc.log("ChallengeController level:" + i);
        var node = game.utils.seekNodeByTag(this.rootNode, i);
        var config = game.challengeMan.getLevelConfig(i);
        node.controller.initWithLevel(i, config);

        if (i === game.challengeMan.getChallengeLevel()) {
            this.currentChallengeNode = node;
        }
        lastNode = node;
    }

    if (!this.currentChallengeNode) {
        this.currentChallengeNode = lastNode;
    }
};

ChallengeController.prototype.getCurrentChallengeNode = function () {
    return this.currentChallengeNode;
};

ChallengeController.createFromCCB = function() {
    cc.BuilderReader.registerController("ChallengeLevelController", new ChallengeLevelController());
    var node = game.utils.loadNodeFromCCB("res/activity/activity_view.ccbi", null, "ChallengeController", new ChallengeController());
    cc.BuilderReader._controllerClassCache["ChallengeLevelController"] = undefined;
    return node;
};

module.exports = ChallengeController;
},{"./ChallengeLevelController":80}],79:[function(require,module,exports){
var SkinRewardType = require("../enum/SkinRewardType");
var EventsName = require("../events/EventsName");
var BoostType = require("../enum/BoostType");
var StoreHelper = require("../model/StoreHelper");
var ConfigMan = require("../config/ConfigMan");

var ChallengeItemController = function () {
    BaseCCBController.call(this);

    this.sprChallengeIcon = null;
    this.lbChallengeNum = null;
    this.lbBtnTitle = null;
    this.btnChallenge = null;
    this.lbName = null;

    this.lbUnlockTips = null;
    this.sprChallengeGrayIcon = null;

    this.ndNormal = null;
    this.ndGray = null;

    this.idx = 0;
    this.challengeCfg = null;
};

game.utils.inherits(ChallengeItemController, BaseCCBController);

ChallengeItemController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
};
/**
 * @param {TaskConfig} data
 * @param {number} idx
 */
ChallengeItemController.prototype.initWith = function (data, idx) {
    this.idx = idx;
    this.challengeCfg = data;
    this.refresh();
};

ChallengeItemController.prototype.refresh = function () {
    var data = this.challengeCfg;

    this.ndNormal.visible = false;
    this.ndGray.visible = false;

    var spriteFrame;
    if (game.challengeMan.isChallengeUnlocked(this.challengeCfg.id)) {
        this.ndNormal.visible = true;

        spriteFrame = cc.spriteFrameCache.getSpriteFrame(data.image + ".png");
        this.sprChallengeIcon.setSpriteFrame(spriteFrame);

        var challengeLevel = game.playerMan.getOrCreateChallenge(data.id).challengeLevel;
        var challengeList = ConfigMan.getInstance().getChallengeLevelList(data.id);
        if (challengeLevel > challengeList.length) {
            challengeLevel = challengeList.length;
        }
        this.lbChallengeNum.setString(challengeLevel + "/" + challengeList.length);
    } else {
        this.ndGray.visible = true;
        spriteFrame = cc.spriteFrameCache.getSpriteFrame(data.grayImage + ".png");
        this.sprChallengeGrayIcon.setSpriteFrame(spriteFrame);
        this.lbUnlockTips.setString(game.utils.sprintf(_("unlock_tips"), this.challengeCfg.levelLimit));
    }

    this.lbName.setString(_(data.nameKey));
};

ChallengeItemController.prototype.getContentSize = function () {
    return this.spBgSelected.getContentSize();
};

ChallengeItemController.prototype.enterClicked = function () {
    AudioHelper.playBtnSound();
    game.challengeMan.currentChallengeId = this.challengeCfg.id;
    game.sceneMan.switchScene(game.sceneType.CHALLENGE);
    // cc.log("task claimed:" + game.playerMan.isTaskClaimed(this.taskCfg.id));
    // if (!game.playerMan.isTaskClaimed(this.taskCfg.id)) {
    //     cc.log("task set claimed:" + this.taskCfg.id);
    //     game.playerMan.setTaskClaimed(this.taskCfg.id);
    //     var rewardCount = this.taskCfg.rewardCount;
    //     StoreHelper.getInstance().popupRewardDoubleDlg(rewardCount, BoostType.DIAMOND,  game.utils.isIOS() ? "tasks" : "tasks", function () {
    //     }.bind(this));
    //     this.refresh();
    //     game.eventDispatcher.dispatchEvent(EventsName.TASK_UPDATE);
    // }
};

ChallengeItemController.createFromCCB = function() {
    return game.utils.loadNodeFromCCB("res/activity/pattern_item_view.ccbi", null, "ChallengeItemController", new ChallengeItemController());
};

module.exports = ChallengeItemController;
},{"../config/ConfigMan":52,"../enum/BoostType":154,"../enum/SkinRewardType":165,"../events/EventsName":169,"../model/StoreHelper":178}],80:[function(require,module,exports){
var RewardPopupController = require("./RewardPopupController");

var ChallengeLevelController = function () {
    BaseCCBController.call(this);
    this.spLocked = null;
    this.spCurrent = null;
    this.spCompleted = null;

    this.lbLevel = null;

    this.ndGift = null;
    this.sprGiftNormal = null;
    this.sprGiftGray = null;

    this.ndNextGift = null;
    this.ndCurrentGift = null;
    this.ndOpenedGift = null;
    this.ndGiftFinal = null;

    this.ndGiftFinalOpened = null;
    this.ndGiftFinalClosed = null;

    this.levelConfig = null;
};

game.utils.inherits(ChallengeLevelController, BaseCCBController);

ChallengeLevelController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
};

ChallengeLevelController.prototype.initWithLevel = function (levelId, levelConfig) {
    this.levelConfig = levelConfig;
    levelConfig.levelId = levelId;
    var currentLevel = game.challengeMan.getChallengeLevel();
    this.spLocked.visible = false;
    this.spCurrent.visible = false;
    this.spCompleted.visible = false;
    this.lbLevel.setString(levelId);
    if (levelId > currentLevel) {
        //locked
        this.spLocked.visible = true;
    } else if (levelId === currentLevel) {
        //current
        this.spCurrent.visible = true;
        game.utils.playCCBAnimation(this.rootNode, "current");
    } else {
        //completed
        this.spCompleted.visible = true;
    }

    if (levelId % 5 === 0) {
        this.ndGift.visible = true;
        var milestoneId = this.levelConfig.levelId / 5;
        this.ndNextGift.visible = false;
        this.ndCurrentGift.visible = false;
        this.ndOpenedGift.visible = false;
        this.ndGiftFinal.visible = false;
        cc.log("current:" + game.challengeMan.getCurrentMilestoneId());
        if (this.levelConfig.levelId === 25) {
            this.ndGiftFinal.visible = true;
            this.spLocked.visible = false;
            this.spCurrent.visible = false;
            this.spCompleted.visible = false;

            if (game.challengeMan.isMilestonePassed(milestoneId)) {
                this.ndGiftFinalOpened.visible = false;
                this.ndGiftFinalClosed.visible = true;
            } else {
                this.ndGiftFinalOpened.visible = true;
                this.ndGiftFinalClosed.visible = false;
            }
        } else if (game.challengeMan.isMilestonePassed(milestoneId)) {
            this.ndOpenedGift.visible = true;
        } else if (game.challengeMan.getCurrentMilestoneId() === milestoneId) {
            this.ndCurrentGift.visible = true;
        } else {
            this.ndNextGift.visible = true;
        }
        this.lbLevel.visible = false;
    } else {
        this.ndGift.visible = false;
    }
};

ChallengeLevelController.prototype.onLevelClicked = function () {
    AudioHelper.playBtnSound();
    var currentLevel = game.challengeMan.getChallengeLevel();
    if (this.levelConfig.levelId === currentLevel) {
        //enter game.
        game.gameMan.chooseLevel(currentLevel);
        game.sceneMan.switchScene(game.sceneType.GAME);

        if ((this.levelConfig.levelId - 1) % 5 === 0) {
            var milestoneId = (this.levelConfig.levelId - 1) / 5 + 1;
            game.analyseManager.trackEvent("ChallengeEnterLevel", {"id": milestoneId});
        }
    } else {
        if (this.levelConfig.levelId % 5 === 0) {
            var milestoneId = this.levelConfig.levelId / 5;
            if (game.challengeMan.getCurrentMilestoneId() === milestoneId) {
                var scrollViewContainer = this.rootNode.parent;
                var pos = scrollViewContainer.convertToNodeSpace(this.rootNode.convertToWorldSpace(cc.p(0, 0)));
                pos = cc.pAdd(pos, cc.p(0, 50));
                var challenge = game.challengeMan.getChallenge(milestoneId);
                RewardPopupController.createAndPop(challenge.rewards, scrollViewContainer, pos);
            }
        }
    }
};

module.exports = ChallengeLevelController;
},{"./RewardPopupController":115}],81:[function(require,module,exports){
// var TaskItemController = require("./TaskItemController");
var ChallengeItemController = require("./ChallengeItemController");
var ConfigMan = require("../config/ConfigMan");
var EventsName = require("../events/EventsName");
var MultiColTableView = require("../../common/ext/MultiColTableView");

var GRID_SIZE = cc.size(540, 230);

var StoreItemCellView = cc.TableViewCell.extend({
    entity: null,
    itemNode: null,
    ctor: function () {
        this._super();
        this.itemNode = ChallengeItemController.createFromCCB();
        this.addChild(this.itemNode);
        this.itemNode.setPosition(cc.p(GRID_SIZE.width * 0.5, GRID_SIZE.height * 0.5));
    },

    initWith: function (entity, idx) {
        this.entity = entity;
        this.itemNode.controller.initWith(entity, idx);
    }
});

var ChallengeListController = function () {
    BaseCCBController.call(this);
    this.ndContainer = null;

    // this.lblTitle = null;

    this._tableView = null;

    //user data.
    this.configs = null;
};

game.utils.inherits(ChallengeListController, BaseCCBController);

ChallengeListController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
};

ChallengeListController.prototype.onExit = function () {
    BaseCCBController.prototype.onExit.call(this);
};

ChallengeListController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);

    game.gameMan.isChallengeLevel = true;
    game.playerMan.setChallengeUnlockTipsShowed();
    game.playerMan.setChallengeEntered();

    this.configs = ConfigMan.getInstance().getChallenge().challenges;
    this.showTableView();
};

ChallengeListController.prototype.onUpdateSkin = function (event) {
    this.showTableView();
};

ChallengeListController.prototype.showTableView = function () {
    if (!this._tableView) {
        var size = this.ndContainer.getContentSize();
        this._tableView = new MultiColTableView(this, size, null);
        this._tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL);
        this._tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN);
        this._tableView.setMultiTableViewDelegate(this);
        this._tableView.ignoreAnchorPointForPosition(false);
        this._tableView.setAnchorPoint(cc.p(0, 0));
        this.ndContainer.addChild(this._tableView);
    } else {
        this._offset = this._tableView.getContentOffset();
    }
    this._tableView.reloadData();
    if (this._offset) {
        this._tableView.setContentOffset(this._offset);
        this._offset = null;
    }
};

ChallengeListController.prototype.scrollViewDidScroll = function (view) {
};

ChallengeListController.prototype.scrollViewDidZoom = function (view) {
};

ChallengeListController.prototype.gridAtIndex = function(multiTable,  idx) {
    var cell = multiTable.dequeueGrid();
    if (!cell) {
        cell = new StoreItemCellView();
    }

    if (idx < this.configs.length) {
        var skinCfg = this.configs[idx];
        cell.initWith(skinCfg, idx);
        cell.visible = true;
    } else {
        cell.visible = false;
    }

    return cell;
};

ChallengeListController.prototype.numberOfCellsInTableView = function(multiTable) {
    var gridsInCell = this.numberOfGridsInCell(multiTable);
    return Math.ceil(this.configs.length / gridsInCell);
};

ChallengeListController.prototype.numberOfGridsInCell = function(multiTable, colIdx) {
    return 1;
};

ChallengeListController.prototype.gridSizeForTable = function(table, colIdx) {
    return cc.size(GRID_SIZE.width, GRID_SIZE.height);
};

ChallengeListController.prototype.gridTouched = function(table, grid) {
};

ChallengeListController.prototype.backClicked = function () {
    AudioHelper.playBtnSound();
    game.sceneMan.switchScene(game.sceneType.MENU);
};

// ChallengeListController.prototype.popup = function () {
//     game.dialogManager.popup(this.rootNode, {popupAnim: true});
// };
//
// ChallengeListController.prototype.close = function () {
//     game.dialogManager.close(this.rootNode);
// };
//
// ChallengeListController.prototype.onExit = function () {
//     //if (this.closeCallback) {
//     //    this.closeCallback();
//     //    this.closeCallback = null;
//     //}
// };

ChallengeListController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/activity/activity_challenge_view.ccbi", null, "ChallengeListController", new ChallengeListController());
    return node;
};

module.exports = ChallengeListController;
},{"../../common/ext/MultiColTableView":16,"../config/ConfigMan":52,"../events/EventsName":169,"./ChallengeItemController":79}],82:[function(require,module,exports){
var ChallengeController = require("./ChallengeController");

var ChallengeParentController = function () {
    BaseCCBController.call(this);
    this.ndContainer = null;
    this.lbChallengeName = null;

    this.scrollView = null;
};

game.utils.inherits(ChallengeParentController, BaseCCBController);

ChallengeParentController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);

    var challengeInfoCfg = game.challengeMan.getChallengeInfoCfg(game.challengeMan.currentChallengeId);
    this.lbChallengeName.setString(_(challengeInfoCfg.nameKey));

    var playing = game.playerMan.getOrCreateChallenge(game.challengeMan.currentChallengeId).challengePlaying;
    if (playing) {
        game.challengeMan.rollBackProgress();
    }

    var node = ChallengeController.createFromCCB();

    this.scrollView = new cc.ScrollView(this.ndContainer.getContentSize());
    this.scrollView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL);
    this.scrollView.setBounceable(false);
    this.scrollView.setViewSize(this.ndContainer.getContentSize());
    this.scrollView.setDelegate(this);
    this.scrollView.setContainer(node);

    this.ndContainer.addChild(this.scrollView);

    var yOffset = -(node.controller.getCurrentChallengeNode().y - cc.winSize.height * 0.5);

    if (yOffset < this.scrollView.minContainerOffset().y) {
        yOffset = this.scrollView.minContainerOffset().y;
    } else if (yOffset >= this.scrollView.maxContainerOffset().y) {
        yOffset = this.scrollView.maxContainerOffset().y;
    }
    this.scrollView.setContentOffset(cc.p(0, yOffset));

    setTimeout(function () {
        if (playing) {
            game.popupMan.popupCommonDlg(game.utils.sprintf(_("challenge_restart_tips"), game.challengeMan.getRollbackLevel()), function () {
                game.challengeMan.checkAndShowRewards();
            });
        } else {
            game.challengeMan.checkAndShowRewards();
        }
    }, 500);
};

ChallengeParentController.prototype.scrollViewDidScroll = function (view) {
    cc.log("scrollViewDidScroll:" + JSON.stringify(view.getContentOffset()));
};

ChallengeParentController.prototype.scrollViewDidZoom = function (view) {

};

ChallengeParentController.prototype.backClicked = function () {
    AudioHelper.playBtnSound();
    game.sceneMan.switchScene(game.sceneType.CHALLENGE_LIST);
};

ChallengeParentController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/activity/activity_parent_view.ccbi", null, "ChallengeParentController", new ChallengeParentController());
    return node;
};

module.exports = ChallengeParentController;
},{"./ChallengeController":78}],83:[function(require,module,exports){
var StoreHelper = require("../model/StoreHelper");
var FailReason = require("../enum/FailReason");

var ChallengeReliveController = function () {
    BaseCCBController.call(this);

    this.lbRelifeTitle = null;

    this.lbCostDiamonds = null;

    this.lbReviveCount = null;

    this.ndWatchAds = null;
    this.ndDiamond = null;

    this._reliveCallback = null;
    this._cancelCallback = null;
};

game.utils.inherits(ChallengeReliveController, BaseCCBController);

ChallengeReliveController.prototype.onExit = function () {
    BaseCCBController.prototype.onExit.call(this);
    this._reliveCallback = null;
    this._cancelCallback = null;
};

ChallengeReliveController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);

    this.lbCostDiamonds.setString("x" + game.config.relifeDiamonds);

    this.ndDiamond.visible = false;
    this.ndWatchAds.visible = false;
    if (game.adsManager.isRewardVideoReady()) {
        this.ndWatchAds.visible = true;
    } else {
        this.ndDiamond.visible = true;
    }

    var totalLifeCount = game.challengeMan.TOTAL_LIFE_COUNT;
    var currentLifeCount = totalLifeCount - game.playerMan.getOrCreateChallenge(game.challengeMan.currentChallengeId).challengeReviveCount;
    this.lbReviveCount.setString(game.utils.sprintf(_("lifes_count"), currentLifeCount, totalLifeCount));
};

ChallengeReliveController.prototype.watchAdsClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    var StoreHelper = require("../model/StoreHelper");
    StoreHelper.getInstance().checkAndShowRewardVideo(game.utils.isIOS() ? "relive" : "relive");
};

ChallengeReliveController.prototype.reliveClicked = function (sender) {
    AudioHelper.playBtnSound();
    if (StoreHelper.getInstance().reliveLevel(game.gameMan.levelId)) {
        game.analyseManager.trackEvent("ChallengeRevive", {"type": "diamonds"});
        if (this._reliveCallback) {
            this._reliveCallback();
        }
        this.close();
    }
};

ChallengeReliveController.prototype.watchAdsReliveClicked = function (sender) {
    AudioHelper.playBtnSound();
    var self = this;
    StoreHelper.getInstance().checkAndShowRewardVideo("challenge_revive_" + game.challengeMan.currentChallengeId, function (watched) {
        if (watched) {
            game.analyseManager.trackEvent("ChallengeRevive", {"type": "watch_ads_" + game.challengeMan.currentChallengeId});
            if (self._reliveCallback) {
                self._reliveCallback();
            }
            self.close();
        }
    });
};

ChallengeReliveController.prototype.closeClicked = function (sender) {
    AudioHelper.playBtnSound();
    if (this._cancelCallback) {
        this._cancelCallback();
    }
    this.close();
};

ChallengeReliveController.prototype.initWith = function (reason, reliveCallback, cancelCallback) {
    this._reason = reason;
    this._reliveCallback = reliveCallback;
    this._cancelCallback = cancelCallback;

    switch (this._reason) {
        case FailReason.Bomb:
            this.lbRelifeTitle.setString(_("bomb_title"));
            break;
        case FailReason.Timeout:
            this.lbRelifeTitle.setString(_("time_out_title"));
            break;
        default:
            this.lbRelifeTitle.setString(_("lost_title"));
            break;
    }
};

ChallengeReliveController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {popupAnim: true});
};

ChallengeReliveController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

ChallengeReliveController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/activity/relife_view.ccbi", null, "ChallengeReliveController", new ChallengeReliveController());
    return node;
};

module.exports = ChallengeReliveController;
},{"../enum/FailReason":157,"../model/StoreHelper":178}],84:[function(require,module,exports){
var ConfigMan = require("../config/ConfigMan");
var DailyBonusItemController = require("./DailyBonusItemController");
var BoostType = require("../enum/BoostType");
var StoreHelper = require("../model/StoreHelper");

var DailyBonusController = function () {
    BaseCCBController.call(this);
    this.DAILY_BONUS_COUNT = 7;
    this.DAILY_BONUS_TAG = 200;
    this.ndContainer = null;

    this.lblTitle = null;

    this.ndDailyBonus = null;

    this.btnDouble = null;
    this.btnClaim = null;

    this.lblClaim = null;
    this.lblDouble = null;

    this.dailyBonusNodes = [];

    //user data.
    this.configs = null;

    this.curConfig = null;

    this.claimed = false;
};

game.utils.inherits(DailyBonusController, BaseCCBController);

DailyBonusController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.lblTitle.setString(_("daily_bonus_title"));
    this.lblClaim.setString(_("claim_title"));
    this.lblDouble.setString(_("double_title"));

    this.configs = ConfigMan.getInstance().getDailyBonusList();

    for (var i = 0; i < this.DAILY_BONUS_COUNT; ++i) {
        var node = this.ndDailyBonus.getChildByTag(this.DAILY_BONUS_TAG + i);
        var itemNode = DailyBonusItemController.createFromCCB();
        this.dailyBonusNodes.push(itemNode);
        node.addChild(itemNode);
    }

    this.initUI();
};

DailyBonusController.prototype.initUI = function () {
    var lastClaimDay = game.playerMan.player.lastClaimDailyBonusDay;
    var consecutiveDay = game.playerMan.checkConsecutiveLoginDay();
    var currentDayClaimed = lastClaimDay >= game.utils.getDayByTs(Date.now());
    consecutiveDay %= 7;
    consecutiveDay = consecutiveDay || 7;
    this.claimed = currentDayClaimed;

    this.btnClaim.enabled = !currentDayClaimed;
    this.btnDouble.enabled = !currentDayClaimed;

    cc.log("consecutiveDay:" + consecutiveDay + ",dailyBonusNodes length:" + this.dailyBonusNodes.length + ",currentDayClaimed:" + currentDayClaimed);
    for (var i = 1; i <= 7; ++i) {
        cc.log("initUI:" + i);
        var config = this.configs[i - 1];
        var node = this.dailyBonusNodes[i - 1];
        if (!node) {
            cc.log("daily bonus node is null:" + i);
            continue;
        }
        var controller = node.controller;
        if (!controller) {
            cc.log("daily bonus controller is null:" + i);
            continue;
        }
        if (i < consecutiveDay) {
            controller.initWith(config, i, false, true);
        }
        else if (i === consecutiveDay) {
            controller.initWith(config, i, true, currentDayClaimed);
            this.curConfig = config;
        }
        else {
            controller.initWith(config, i, false, false);
        }
    }

    if (consecutiveDay === 3) {
        this.btnDouble.enabled = false;
    }
};

DailyBonusController.prototype.popupClaimReward = function (config, double, callback) {
    //var count = double ? config.count * 2 : config.count;
    var param = double ? 2 : 1;
    var count = config.count;
    var splitCount = 0;
    var threeBallCount = 0;
    var rewardName = game.utils.isIOS() ? "daily_bonus_tips" : "daily_bonus_tips";
    if (config.type === BoostType.SPLIT) {
        splitCount = count;
    } else if (config.type === BoostType.THREE_BALL) {
        threeBallCount = count;
    } else if (config.type === BoostType.GIFT) {
        splitCount = game.utils.randomNextIntInRange(2, 4);
        threeBallCount = game.utils.randomNextIntInRange(2, 4);
    } else if (config.type === BoostType.SKIN) {
        game.popupMan.popupRewardNoticeDlg(game.local.getValue("skin_claimed"),
            function () {
                game.playerMan.setClaimedSkin(config.arg1);
                if (callback) {
                    callback();
                }
            }, config.image, 1);
        return;
    } else if (config.type === BoostType.DIAMOND) {
        var diamondCount = config.count;
        if (double) {
            game.popupMan.popupRewardNoticeDlg(game.local.getValue("reward_video_diamonds"),
                function () {
                    game.playerMan.addDiamonds(diamondCount, rewardName);
                    if (callback) {
                        callback();
                    }
                }, config.image, diamondCount);
        } else {
            StoreHelper.getInstance().popupRewardDoubleDlg(diamondCount, BoostType.DIAMOND, rewardName, function () {
                if (callback) {
                    callback();
                }
            }.bind(this));
        }
        return;
    }
    splitCount = splitCount * param;
    threeBallCount = threeBallCount * param;
    if (double) {
        StoreHelper.getInstance().popupBoostRewardDlg(splitCount, threeBallCount, function () {
            callback && callback();
        });
    } else {
        if (splitCount > 0) {
            StoreHelper.getInstance().popupRewardDoubleDlg(splitCount, BoostType.SPLIT, rewardName, function () {
                callback && callback();
            }.bind(this));
        }
        if (threeBallCount > 0) {
            StoreHelper.getInstance().popupRewardDoubleDlg(threeBallCount, BoostType.THREE_BALL, rewardName, function () {
                callback && callback();
            }.bind(this));
        }
    }
};

DailyBonusController.prototype.claimClicked = function (sender) {
    AudioHelper.playBtnSound();
    var self = this;
    if (!this.claimed) {
        this.popupClaimReward(this.curConfig, false, function () {
            self.setClaimed();
            self.close();
        });
    } else {
        self.close();
    }
};

DailyBonusController.prototype.doubleClicked = function (sender) {
    AudioHelper.playBtnSound();
    var self = this;
    if (!this.claimed) {
        StoreHelper.getInstance().checkAndShowRewardVideo(game.utils.isIOS() ? "shuangbeilibao" : "dailybonus", function (rewarded) {
            if (rewarded) {
                this.popupClaimReward(this.curConfig, true, function () {
                    self.setClaimed();
                    self.close();
                });
            }
        }.bind(this));
    } else {
        self.close();
    }
};

DailyBonusController.prototype.setClaimed = function () {
    game.playerMan.setLastClaimDailyBonusDay(game.utils.getDayByTs(Date.now()));
    this.claimed = true;
};

DailyBonusController.prototype.backClicked = function (sender) {
    AudioHelper.playBtnSound();

    this.close();
};

DailyBonusController.prototype.initWith = function (callback) {
    this.closeCallback = callback;
};

DailyBonusController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {popupAnim: true});
};

DailyBonusController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
    if (this.closeCallback) {
        this.closeCallback();
        this.closeCallback = null;
    }
};

DailyBonusController.prototype.onExit = function () {
    BaseCCBController.prototype.onExit.call(this);
};

DailyBonusController.createFromCCB = function() {
    cc.BuilderReader.registerController("DailyBonusItemController", new DailyBonusItemController());
    var node = game.utils.loadNodeFromCCB("res/menu/daily_bonus_view.ccbi", null, "DailyBonusController", new DailyBonusController());
    cc.BuilderReader._controllerClassCache["DailyBonusItemController"] = undefined;
    return node;
};

module.exports = DailyBonusController;
},{"../config/ConfigMan":52,"../enum/BoostType":154,"../model/StoreHelper":178,"./DailyBonusItemController":85}],85:[function(require,module,exports){
var BoostType = require("../enum/BoostType");

var DailyBonusItemController = function () {
    BaseCCBController.call(this);

    this.spBlack = null;
    this.spItem = null;
    this.spCurrent = null;
    this.spClaimed = null;
    this.lblCount = null;
    this.lblDay = null;

    this.dailyBonusCfg = null;
};

game.utils.inherits(DailyBonusItemController, BaseCCBController);

DailyBonusItemController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
};
/**
 * @param {DailyBonusConfig} data
 * @param {number} day
 * @param {boolean} current
 * @param {boolean} claimed
 */
//day, state, rewardObj, claimed
DailyBonusItemController.prototype.initWith = function (data, day, current, claimed) {
    this.dailyBonusCfg = data;

    if (data.type === BoostType.SKIN) {
        var getted = game.playerMan.hasSkin(data.arg1);
        if (getted) {
            data.type = data.extra.type;
            data.count = data.extra.count;
            data.image = data.extra.image;
        }
    }

    this.spBlack.visible = claimed;
    this.spItem.setSpriteFrame(data.image);
    //game.utils.scaleCCLabelBMFont(this.spItem, 59);
    if (!claimed) {
        this.spCurrent.visible = current;
    } else {
        this.spCurrent.visible = false;
    }

    this.spClaimed.visible = claimed;
    this.lblCount.setString("x" + data.count);
    this.lblDay.setString(game.utils.sprintf(_("day_title"), day));
};

DailyBonusItemController.prototype.getContentSize = function () {
    return this.spBgSelected.getContentSize();
};

DailyBonusItemController.createFromCCB = function() {
    return game.utils.loadNodeFromCCB("res/menu/daily_bonus_item_view.ccbi", null, "DailyBonusItemController", new DailyBonusItemController());
};

module.exports = DailyBonusItemController;
},{"../enum/BoostType":154}],86:[function(require,module,exports){
var EventsName = require("../events/EventsName");
var DailyTaskPos = require("../enum/DailyTaskPos");

var DailyTaskEntranceController = function () {
    BaseCCBController.call(this);

    this.ndActivity = null;
    this.btnActivity = null;

    this.lbActivityLeftTime = null;

    this.ndDailyTaskReminder = null;
    this.lblDailyTaskReminder = null;
    this.spDailyTaskClaimReminder = null;

    this.dailyTaskPos = DailyTaskPos.Menu;
};

game.utils.inherits(DailyTaskEntranceController, BaseCCBController);

DailyTaskEntranceController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
    game.eventDispatcher.addEventListener(EventsName.UPDATE_ACTIVITY_TASK_SCORE, this.updateActivityEntrance, this);
};

DailyTaskEntranceController.prototype.onExit = function () {
    game.eventDispatcher.removeEventListener(EventsName.UPDATE_ACTIVITY_TASK_SCORE, this.updateActivityEntrance, this);
    BaseCCBController.prototype.onExit.call(this);
};

DailyTaskEntranceController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.updateActivityEntrance();
};

DailyTaskEntranceController.prototype.initWith = function (pos) {
    this.dailyTaskPos = pos;
};

DailyTaskEntranceController.prototype.updateActivityEntrance = function () {
    this.ndDailyTaskReminder.stopAllActions();
    this.ndDailyTaskReminder.scale = 1;
    this.ndActivity.visible = true;
    this.btnActivity.enabled = true;
    this.ndDailyTaskReminder.visible = false;
    if (game.activityMan.isOpen()) {
        this.spDailyTaskClaimReminder.visible = false;
        this.lblDailyTaskReminder.visible = false;
        if (game.activityMan.hasUnClaimedReward()) {
            this.ndDailyTaskReminder.visible = true;
            this.spDailyTaskClaimReminder.visible = true;
            this.ndDailyTaskReminder.runAction(cc.sequence(cc.scaleTo(0.2, 1.2), cc.scaleTo(0.4, 0.8), cc.scaleTo(0.2, 1)).repeatForever());
        } else if (game.activityMan.getUnCompletedTask() > 0) {
            this.ndDailyTaskReminder.visible = true;
            this.lblDailyTaskReminder.visible = true;
            this.lblDailyTaskReminder.setString(game.activityMan.getUnCompletedTask());
        }
    } else {
        this.ndActivity.visible = false;
    }
};

DailyTaskEntranceController.prototype.activityClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.analyseManager.trackEvent("DailyTask" + DailyTaskPos.getName(this.dailyTaskPos) + "Click");

    game.popupMan.popupActivityTask();
};

module.exports = DailyTaskEntranceController;
},{"../enum/DailyTaskPos":156,"../events/EventsName":169}],87:[function(require,module,exports){
var EventsName = require("../events/EventsName");
var NumberAnimation = require("../../common/entity/NumberAnimation");

var DiamondsController = function () {
    BaseCCBController.call(this);

    this.lbDiamonds = null;

    this.numberAnimation = null;
};

game.utils.inherits(DiamondsController, BaseCCBController);

DiamondsController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
    game.eventDispatcher.addEventListener(EventsName.DIAMONDS_UPDATE, this.onUpdateDiamonds, this);
    cc.director.getScheduler().scheduleCallbackForTarget(this, this.onUpdate, 0.05, cc.REPEAT_FOREVER, 0, false);
};

DiamondsController.prototype.onExit = function () {
    this.numberAnimation.destroy();
    cc.director.getScheduler().unscheduleCallbackForTarget(this, this.onUpdate);
    game.eventDispatcher.removeEventListener(EventsName.DIAMONDS_UPDATE, this.onUpdateDiamonds, this);
    BaseCCBController.prototype.onExit.call(this);
};

DiamondsController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.numberAnimation = new NumberAnimation(this.lbDiamonds);
    this.lbDiamonds.setString(game.playerMan.getDiamonds());
};

DiamondsController.prototype.onUpdateDiamonds = function (event) {
    var data = event.getUserData();
    var diamonds = data.diamonds;
    var delta = data.delta;
    this.numberAnimation.playNumAnim(diamonds - delta, diamonds);
};

DiamondsController.prototype.diamondClicked = function (sender) {
    AudioHelper.playBtnSound();
    var StoreType = require("../enum/StoreType");
    game.popupMan.popupStoreDlg(StoreType.DIAMOND);
};

DiamondsController.prototype.onUpdate = function (dt) {
    this.numberAnimation.update(dt);
};

DiamondsController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/diamond_view.ccbi", null, "DiamondsController", new DiamondsController(), true);
    return node;
};

module.exports = DiamondsController;
},{"../../common/entity/NumberAnimation":9,"../enum/StoreType":167,"../events/EventsName":169}],88:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */
var GameMan = require("../model/GameMan");
var RemoveAdsController = require("./RemoveAdsController");

var FailCnController = function () {
    BaseCCBController.call(this);
    this._replayCallback = null;
    this._nextCallback = null;

    this.spFailCn = null;
    this.spFailEn = null;

    // this.lblReward = null;
    //this.lblRelife = null;
    // this.lblWheel = null;

    this.lblSkip = null;

    this.lblMulti = null;
    //this.ndSkipMask = null;
    //new
    this.lblSkipCostDiamonds = null;

    //this.btnSkip = null;
};

game.utils.inherits(FailCnController, BaseCCBController);

FailCnController.prototype.onExit = function () {
    this._replayCallback = null;
    // game.eventDispatcher.removeEventListener("dialog_poped", this.onDialogPoped, this);
    // game.eventDispatcher.removeEventListener("dialog_closed", this.onDialogClosed, this);
    // this.removeNativeAd();
};

FailCnController.prototype.onEnter = function () {
    // game.eventDispatcher.addEventListener("dialog_poped", this.onDialogPoped, this);
    // game.eventDispatcher.addEventListener("dialog_closed", this.onDialogClosed, this);
    if (game.adsManager.showTopBanner) {
        game.adsManager.removeBannerAds("top");
    }
};

// FailCnController.prototype.onDialogPoped = function () {
//     this.updateNativeAd();
// };
//
// FailCnController.prototype.onDialogClosed = function () {
//     this.updateNativeAd();
// };
//
// FailCnController.prototype.updateNativeAd = function () {
//     if (game.dialogManager.isTopestDialog(this.rootNode)) {
//         this.showNativeAd();
//     } else {
//         this.removeNativeAd();
//     }
// };
//
// FailCnController.prototype.showNativeAd = function () {
//     game.adsManager.showNativeAd("fail", 0, 0);
// };
//
// FailCnController.prototype.removeNativeAd = function () {
//     game.adsManager.removeNativeAd("fail");
// };

FailCnController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    // this.lblWheel.setString(_("lucky_wheel_title"));
    // this.lblReward.setString(_("watch_ads_get_boosts"));
    this.lblSkip.setString(_("skip_level_title"));
    //this.lblSkipCostDiamonds.setString("x" + game.config.skipDiamonds);
    game.audioPlayer.playEffectByKey("fail");

    if (!game.utils.isPad()) {
        var node = RemoveAdsController.createFromCCB();
        this.rootNode.addChild(node);
        if (game.utils.isIOSNotchScreen()) {
            node.y += 40;
        }
    }

    this.lblMulti.setString(game.utils.sprintf(_("multi_diamonds_title"),
        game.config.multiDiamondsRange[0],
        game.config.multiDiamondsRange[1]));

    //200 diamonds to skip.

    // if (game.gameMan.canSkip()) {
    //     cc.log("can skip");
    //     this.ndSkipMask.visible = false;
    //     this.btnSkip.enabled = true;
    // } else {
    //     cc.log("can not skip");
    //     this.ndSkipMask.visible = true;
    //     this.btnSkip.enabled = false;
    // }

    var RewardRemoveAdController = require("./RewardRemoveAdController");
    this.ndRewardRemoveAds.addChild(RewardRemoveAdController.createFromCCB());
};

FailCnController.prototype.initWith = function (replayCallback, skipCallback) {
    this._replayCallback = replayCallback;
    this._skipCallback = skipCallback;
};

FailCnController.prototype.onAnimEnd = function () {
    if (!game.gameMan.checkAndShowBox()) {
        if (!GameMan.getInstance().tryShowFailPopup()) {
            game.adsHelper.showPassAds();
        }
    }
};

FailCnController.prototype.restartClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    game.adsHelper.showPassAds();
    if (this._replayCallback) {
        this._replayCallback();
    }
    this.close();
};

FailCnController.prototype.homeClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    game.adsHelper.showBackHomeAds();
    game.sceneMan.switchScene(game.sceneType.MENU);
};

FailCnController.prototype.watchAdsMultiClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    var StoreHelper = require("../model/StoreHelper");
    StoreHelper.getInstance().checkAndGetRandomDiamonds("diamonds_random_fail");
};

FailCnController.prototype.relifeClicked = function (sender) {
    //game.audioPlayer.playEffectByKey("enter");
    //var StoreHelper = require("../model/StoreHelper");
    //StoreHelper.getInstance().checkAndShowRewardVideo(function () {
    //});
};

FailCnController.prototype.skipClicked = function (sender) {
    var StoreHelper = require("../model/StoreHelper");
    StoreHelper.getInstance().checkAndShowRewardVideo(game.utils.isIOS() ? "tiaoguo01" : "skip", function (rewarded) {
        if (rewarded) {
            game.analyseManager.trackEvent("WatchAdsToSkipLevel", {"level": GameMan.getInstance().levelId});
            if (this._skipCallback) {
                this._skipCallback();
            }
        }
    }.bind(this));
};

FailCnController.prototype.wheelClicked = function (sender) {
    AudioHelper.playBtnSound();
    var WheelType = require("../enum/WheelType");
    game.popupMan.popupWheelDlg(WheelType.DailyBonus);
};

FailCnController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode);
};

FailCnController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

FailCnController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/fail_view_1.ccbi", null, "FailCnController", new FailCnController());
    return node;
};

module.exports = FailCnController;
},{"../enum/WheelType":168,"../model/GameMan":173,"../model/StoreHelper":178,"./RemoveAdsController":109,"./RewardRemoveAdController":116}],89:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */
var GameMan = require("../model/GameMan");
var RemoveAdsController = require("./RemoveAdsController");

var FailController = function () {
    BaseCCBController.call(this);
    this._replayCallback = null;
    this._nextCallback = null;

    this.spFailCn = null;
    this.spFailEn = null;

    this.lblReward = null;
    //this.lblRelife = null;
    // this.lblWheel = null;

    this.lblSkip = null;
    //this.ndSkipMask = null;
    //new
    this.lblSkipCostDiamonds = null;
    //this.btnSkip = null;

    this.ndFreeDiamondShort = null;
    this.ndFreeDiamondLong = null;
};

game.utils.inherits(FailController, BaseCCBController);

FailController.prototype.onExit = function () {
    this._replayCallback = null;
};

FailController.prototype.onEnter = function () {
    if (game.adsManager.showTopBanner) {
        game.adsManager.removeBannerAds("top");
    }
};

FailController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    // this.lblWheel.setString(_("lucky_wheel_title"));
    this.lblReward.setString(_("free_coins_title"));
    this.lblSkip.setString(_("skip_level_title"));
    //this.lblSkipCostDiamonds.setString("x" + game.config.skipDiamonds);
    game.audioPlayer.playEffectByKey("fail");

    if (!game.utils.isPad()) {
        var node = RemoveAdsController.createFromCCB();
        this.rootNode.addChild(node);
        if (game.utils.isIOSNotchScreen()) {
            node.y += 40;
        }
    }

    this.ndFreeDiamondShort.visible = false;
    this.ndFreeDiamondLong.visible = false;
    if (game.activityMan.isOpen()) {
        this.ndFreeDiamondShort.visible = true;
    } else {
        this.ndFreeDiamondLong.visible = true;
    }

    //200 diamonds to skip.

    // if (game.gameMan.canSkip()) {
    //     cc.log("can skip");
    //     this.ndSkipMask.visible = false;
    //     this.btnSkip.enabled = true;
    // } else {
    //     cc.log("can not skip");
    //     this.ndSkipMask.visible = true;
    //     this.btnSkip.enabled = false;
    // }
};

FailController.prototype.initWith = function (replayCallback, skipCallback) {
    this._replayCallback = replayCallback;
    this._skipCallback = skipCallback;
};

FailController.prototype.onAnimEnd = function () {
    if (!game.gameMan.checkAndShowBox()) {
        if (!GameMan.getInstance().tryShowFailPopup()) {
            game.adsHelper.showPassAds();
        }
    }
};

FailController.prototype.restartClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    game.adsHelper.showPassAds();
    if (this._replayCallback) {
        this._replayCallback();
    }
    this.close();
};

FailController.prototype.homeClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    game.adsHelper.showBackHomeAds();
    game.sceneMan.switchScene(game.sceneType.MENU);
};

FailController.prototype.watchAdsClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    var StoreHelper = require("../model/StoreHelper");
    StoreHelper.getInstance().checkAndShowRewardVideo(game.utils.isIOS() ? "failgift" : "jili06", null, "FailAndWatchDiamondsAds");
};

FailController.prototype.relifeClicked = function (sender) {
    //game.audioPlayer.playEffectByKey("enter");
    //var StoreHelper = require("../model/StoreHelper");
    //StoreHelper.getInstance().checkAndShowRewardVideo(function () {
    //});
};

FailController.prototype.activityClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.analyseManager.trackEvent("DailyTaskFailClick");
    game.popupMan.popupActivityTask();
};

FailController.prototype.skipClicked = function (sender) {
    var StoreHelper = require("../model/StoreHelper");
    StoreHelper.getInstance().checkAndShowRewardVideo(game.utils.isIOS() ? "tiaoguo01" : "skip", function (rewarded) {
        if (rewarded) {
            game.analyseManager.trackEvent("WatchAdsToSkipLevel", {"level": GameMan.getInstance().levelId});
            if (this._skipCallback) {
                this._skipCallback();
            }
        }
    }.bind(this));
};

FailController.prototype.wheelClicked = function (sender) {
    AudioHelper.playBtnSound();
    var WheelType = require("../enum/WheelType");
    game.popupMan.popupWheelDlg(WheelType.DailyBonus);
};

FailController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode);
};

FailController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

FailController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/fail_view.ccbi", null, "FailController", new FailController());
    return node;
};

module.exports = FailController;
},{"../enum/WheelType":168,"../model/GameMan":173,"../model/StoreHelper":178,"./RemoveAdsController":109}],90:[function(require,module,exports){
var EventsName = require("../events/EventsName");
var BricksView = require("../view/BricksView");
var GameMan = require("../model/GameMan");
var BoostType = require("../enum/BoostType");
var HelpController = require("./HelpController");
var StoreType = require("../enum/StoreType");
var AimItemController = require("./AimItemController");
var AimHelpController = require("./AimHelpController");
var StoreHelper = require("../model/StoreHelper");
var GiftBoxController = require("../controller/GiftBoxController");
var BoardGetController = require("./BoardGetController");
var SkinType = require("../enum/SkinType");
var LaserController = require("./LaserController");
var ChallengeId = require("../enum/ChallengeId");

var GameController = function () {
    BaseCCBController.call(this);
    this.LIFE_START_TAG = 100;
    this.LIFE_COUNT = 6;
    this.KEY_START_NO_TAG = 200;
    this.KEY_COUNT = 3;
    this.KEY_START_TAG = 300;
    this.LASER_COUNT = 10;
    this.LASER_START_TAG = 400;

    this.ndLifeNode = null;
    this.lbTime = null;
    this._gameNode = null;
    this.ndHelp = null;
    this.ndAimHelp = null;

    this.ndBoost1 = null;
    this.ndBoost2 = null;

    this.ndLifeNodes = null;

    this.spTopProgress = null;

    this.spYellow1 = null;
    this.spYellow2 = null;
    this.spYellow3 = null;

    this.spBlack1 = null;
    this.spBlack2 = null;
    this.spBlack3 = null;

    this.lbLevel = null;

    this.ndAnimItem = null;
    this.ndGetBoardSkin = null;

    this.ndTopContainer = null;
    this.ndTopBg = null;

    this.ndLeft = null;
    this.ndRight = null;

    this.ndSkip = null;

    this.lb3New = null;
    this.lb3Multiple = null;

    this.ndDiamondNew = null;
    this.ndDiamondMultiple = null;

    this.lbDiamondNew = null;
    this.lbDiamondMulti = null;

    this.ndGift = null;

    this.ndStar = null;

    this.ndChallenge = null;

    this.ndLevelTitle = null;

    this.ndFlyGift = null;

    this.spYellows = [];
    this.spBlacks = [];

    this.ndCountDown = null;
    this.lbChallengeCountDown = null;
    this.lbChallengeLevel = null;
    this.ndKeyNode = null;

    this.showedSkipAnim = false;
    this.config = null;
    this.ndLaser = null;

    this.spLevels = [];

    this.ndLasers = [];
};

game.utils.inherits(GameController, BaseCCBController);

GameController.prototype.onEnter = function () {
    game.eventDispatcher.addEventListener(EventsName.UPDATE_LEVEL, this.onUpdateLevel, this);
    game.eventDispatcher.addEventListener(EventsName.REFRESH_BOOST, this.onUpdateBoost, this);
    game.eventDispatcher.addEventListener(EventsName.UPDATE_AIM_ITEM, this.onUpdateAimItem, this);
    // game.eventDispatcher.addEventListener(EventsName.UPDATE_BOARD_SKIN_ITEM, this.onUpdateBoardSkinItem, this);

};

GameController.prototype.onExit = function () {
    game.eventDispatcher.removeEventListener(EventsName.REFRESH_BOOST, this.onUpdateBoost, this);
    game.eventDispatcher.removeEventListener(EventsName.UPDATE_LEVEL, this.onUpdateLevel, this);
    game.eventDispatcher.removeEventListener(EventsName.UPDATE_AIM_ITEM, this.onUpdateAimItem, this);
    // game.eventDispatcher.removeEventListener(EventsName.UPDATE_BOARD_SKIN_ITEM, this.onUpdateBoardSkinItem, this);
    this._gameCoreNode = null;
};

GameController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);

    this.ndLifeNodes = [];
    this.ndKeyNodes = [];
    this.ndKeyNoNodes = [];
    for (var i = 0; i < this.LIFE_COUNT; ++i) {
        var lifeNode = this.ndLifeNode.getChildByTag(this.LIFE_START_TAG + i);
        this.ndLifeNodes.push(lifeNode);
    }
    for (i = 0; i < this.KEY_COUNT; ++i) {
        var keyNode = this.ndKeyNode.getChildByTag(this.KEY_START_TAG + i);
        var keyNoNode = this.ndKeyNode.getChildByTag(this.KEY_START_NO_TAG + i);
        this.ndKeyNodes.push(keyNode);
        this.ndKeyNoNodes.push(keyNoNode);
    }

    for (i = 0; i < this.LASER_COUNT; ++i) {
        var node = this.ndLaser.getChildByTag(this.LASER_START_TAG + i);
        this.ndLasers.push(node);
    }

    this.spYellows = [this.spYellow1, this.spYellow2, this.spYellow3];
    this.spBlacks = [this.spBlack1, this.spBlack2, this.spBlack3];

    var config = null;
    var levelId = null;
    if (window.isEditor) {
        config = game.gameMan.levelCfg;
        levelId = 0;
    } else {
        config = GameMan.getInstance().getCurConfig();
        levelId = GameMan.getInstance().levelId;
    }
    this.config = config;

    this._gameCoreNode = new BricksView(config, this);
    this._gameNode.addChild(this._gameCoreNode);

    if (game.gameMan.isChallengeLevel) {
        this.lbLevel.setString(game.utils.sprintf(_("challenge_title"), levelId));
        this.lbChallengeLevel.setString(game.utils.sprintf(_("challenge_title"), levelId));
        this.ndKeyNode.visible = false;
    } else {
        this.lbLevel.setString(game.utils.sprintf(_("level_title"), levelId));
        this.ndKeyNode.visible = true;
    }

    this.updateLifeCount();
    this.updateBoost();
    this.updateKeyCount();

    this.ndHelp.visible = false;

    if (game.playerMan.player.isAimVersion) {
        var firstEnter = game.storageController.getItem("first_enter", "true");
        if (firstEnter === "true") {
            this.ndAimHelp.visible = true;
            this._gameCoreNode.showAimGuideAnimation();
        } else {
            this.ndAimHelp.visible = false;
        }
    } else {
        this.ndAimHelp.visible = false;
    }

    this.updateTime();

    if (game.utils.isIOSNotchScreen()) {
        this.ndTopContainer.height += 70;
        this.ndTopBg.height += 70;
    } else if (game.utils.isPad()) {
        this.ndTopContainer.height -= 40;
        this.ndTopBg.height -= 40;
    }

    if (game.gameMan.isChallengeLevel && game.challengeMan.currentChallengeId === ChallengeId.Laser) {
        this.ndTopBg.height += 42;
    }
    if (window.isEditor) {
        var xOffset = cc.winSize.width - 640;
        this.ndLeft.width = this.ndLeft.width + xOffset * 0.5;
        this.ndRight.width = this.ndRight.width + xOffset * 0.5;
    }
    this.lbDiamondMulti.setString("20");
    this.lbDiamondNew.setString("20");
    this.onUpdateAimItem();
    this.onUpdateBoardSkinItem(levelId);
    // this.ndAimHelp.visible = false;

    this.ndSkip.visible = false;

    var self = this;
    var giftBox = GiftBoxController.createFromCCB();
    giftBox.controller.setCallback(function (state) {
        if (state === "start") {
            self._gameCoreNode.stop();
        } else {
            self._gameCoreNode.resume();
        }
    });
    this.ndGift.addChild(giftBox);
    this.ndCountDown.visible = false;

    this.ndLevelTitle.visible = true;

    this.ndLaser.visible = false;

    if (game.gameMan.isChallengeLevel) {
        this.ndStar.visible = false;
        this.ndChallenge.visible = true;
        this.spLevels = [this.spLevel1, this.spLevel2, this.spLevel3, this.spLevel4, this.spLevel5];
        var level = (game.challengeMan.getChallengeLevel() - 1) % 5;
        for (var i = 0; i < this.spLevels.length; ++i) {
            var spLevel = this.spLevels[i];
            if (i <= level) {
                spLevel.setSpriteFrame("icon_completed_4.png");
            } else {
                spLevel.setSpriteFrame("icon_locked_4.png");
            }
        }

        if (game.challengeMan.currentChallengeId === ChallengeId.TimeLimit) {
            this.ndCountDown.visible = true;
            this.ndLevelTitle.visible = false;
        } else {
            this.ndLevelTitle.x = this.ndLevelTitle.parent.width * 0.5;
        }
        if (game.challengeMan.currentChallengeId === ChallengeId.Laser) {
            this.ndLaser.visible = true;
        }
    } else {
        this.ndStar.visible = true;
        this.ndChallenge.visible = false;
    }

    this.ndFlyGift.visible = false;
};

GameController.prototype.showLaser = function () {
    var list = [];
    var config = this.config;
    for (var i = 0; i < config.continuousLazers.length; ++i) {
        var continuousCount = config.continuousLazers[i];
        var randomNum = game.utils.randomNextInt(this.LASER_COUNT - continuousCount);
        for (var i = 0; i < continuousCount; ++i) {
            list.push(randomNum + i);
        }
    }

    while (list.length < config.noneLazerCount) {
        var randomNum = game.utils.randomNextInt(this.LASER_COUNT);
        if (list.indexOf(randomNum) === -1) {
            list.push(randomNum);
        }
    }
    for (var i = 0; i < this.ndLasers.length; ++i) {
        if (list.indexOf(i) === -1) {
            this.ndLasers[i].controller.showLaser();
        }
    }
};

GameController.prototype.isCollisionWithLaser = function (board) {
    var boardBoundingBox = board.getBoundingBox();
    for (var i = 0; i < this.ndLasers.length; ++i) {
        if (this.ndLasers[i].controller.isShowedLaser()) {
            if (cc.rectIntersectsRect(this.ndLasers[i].controller.getLaserBoundingBox(), boardBoundingBox)) {
                return true;
            }
        }
    }
    return false;
};

GameController.prototype.showSkipBtnAnim = function () {
    if (game.gameMan.isChallengeLevel) {
        return;
    }
    if (this.showedSkipAnim) {
        return;
    }
    this.showedSkipAnim = true;
    this.ndSkip.visible = true;
    var time = 0.5;
    this.ndSkip.runAction(cc.sequence( cc.scaleTo(time, 1.2), cc.scaleTo(time, 1),
        cc.scaleTo(time, 0.8), cc.scaleTo(time, 1)).repeatForever());
};

GameController.prototype.showAimHelp = function () {
    this.ndAimHelp.visible = true;
};

GameController.prototype.onUpdateAimItem = function () {
    if (game.gameMan.canTryAimItem()) {
        this.ndAnimItem.visible = true;
        cc.log("game controller can use aim item");
    } else {
        this.ndAnimItem.visible = false;
        cc.log("game controller not use aim item");
    }
};

GameController.prototype.onUpdateBoardSkinItem = function (levelId) {
    if (levelId < 2) {
        this.ndGetBoardSkin.visible = false;
        return;
    }
    var randomBoardSkinCfg = game.gameMan.getRandomBoard(SkinType.WatchAds);
    if (randomBoardSkinCfg) {
        this.ndGetBoardSkin.visible = true;
        this.ndGetBoardSkin.controller.initWith(randomBoardSkinCfg);
        if (game.utils.isIOSNotchScreen()) {
            this.ndGetBoardSkin.y += 40;
        }
    } else {
        this.ndGetBoardSkin.visible = false;
    }
    // if (game.gameMan.canTryAimItem()) {
    //     this.ndGetBoardSkin.visible = true;
    //     // cc.log("game controller can use aim item");
    // } else {
    //     this.ndGetBoardSkin.visible = false;
    //     // cc.log("game controller not use aim item");
    // }
};



GameController.prototype.updateKeyCount = function () {
    var keyCount = game.playerMan.player.currentKeyCount;
    for (var i = 0; i < this.KEY_COUNT; ++i) {
        var node = this.ndKeyNodes[i];
        node.visible = (keyCount > i);
    }
};

GameController.prototype.updateLifeCount = function () {
    var nowLifeCount = this._gameCoreNode.lifeCount;
    for (var i = 0; i < this.LIFE_COUNT; ++i) {
        var lifeNode = this.ndLifeNodes[i];
        if (lifeNode) {
            lifeNode.visible = (nowLifeCount > i);
        }
    }
};

GameController.prototype.onUpdateBoost = function () {
    this.updateBoost();
};

GameController.prototype.updateCountDownTime = function (leftTime) {
    cc.log("lbChallengeCountDown:" + leftTime);
    this.lbChallengeCountDown.setString(Math.floor(leftTime));
};

GameController.prototype.updateBoost = function () {
    var threeBallBoostCount = game.playerMan.getBoostCount(BoostType.THREE_BALL);
    var splitBallBoostCount = game.playerMan.getBoostCount(BoostType.SPLIT);
    this.lb3New.setString("x" + threeBallBoostCount);
    this.lb3Multiple.setString("x" + splitBallBoostCount);

    this.lb3New.visible = false;
    this.lb3Multiple.visible = false;

    this.ndDiamondMultiple.visible = false;
    this.ndDiamondNew.visible = false;
    if (threeBallBoostCount > 0) {
        this.lb3New.visible = true;
    } else {
        this.ndDiamondNew.visible = true;
    }

    if (splitBallBoostCount > 0) {
        this.lb3Multiple.visible = true;
    } else {
        this.ndDiamondMultiple.visible = true;
    }

};

GameController.prototype.updateTime = function () {
    var costTime = 0;
    if (this._gameCoreNode.eclipsedTime) {
        costTime = this._gameCoreNode.eclipsedTime / 1000;
    }
    this.lbTime.setString(game.utils.getLongFormatTime(costTime));

    var percent = GameMan.getInstance().getProgressPercent(costTime);
    this.spTopProgress.setPreferredSize(cc.size(150 * percent * 0.01, 8));
    var star = GameMan.getInstance().getCurrentStar(costTime);
    this.updateStar(star);

    if (costTime >= this.config.starTime * 1.5) {
        this.showSkipBtnAnim();
    }
};

GameController.prototype.updateStar = function (star) {
    for (var i = 0; i < 3; ++i) {
        this.spYellows[i].visible = (star >= i + 1);
        this.spBlacks[i].visible = (star < i + 1);
    }
};

GameController.prototype.pauseClicked = function () {
    AudioHelper.playBtnSound();
    if (window.isEditor) {
        var EditorScene = require("../editor/scene/EditorScene");
        cc.director.runScene(new EditorScene());
    } else {
        this.showPause();
    }
};

GameController.prototype.showPause = function () {
    this._gameCoreNode.stop();
    var self = this;
    game.popupMan.popupPauseDlg(function () {
        self._gameCoreNode.resume();
    });
};

//GameController.prototype.storeClicked = function () {
//    AudioHelper.playBtnSound();
//    this._gameCoreNode.stop();
//    var self = this;
//    game.popupMan.popupStoreDlg(StoreType.DIAMOND, function () {
//        self._gameCoreNode.resume();
//    });
//};

GameController.prototype.new3Clicked = function () {
    AudioHelper.playBtnSound();
    if (!this._gameCoreNode.canUseBoost()) {
        return;
    }
    if (game.playerMan.useBoost(BoostType.THREE_BALL) ||
        (StoreHelper.getInstance().buyOneBoost() && game.playerMan.useBoost(BoostType.THREE_BALL))) {
        this._gameCoreNode.useNew3BallBoost();
        this.updateBoost();
    } else {
        this._gameCoreNode.stop();
        var self = this;
        game.popupMan.popupStoreDlg(StoreType.DIAMOND, function () {
            self._gameCoreNode.resume();
        });
    }
};

GameController.prototype.multiple3Clicked = function () {
    AudioHelper.playBtnSound();
    if (!this._gameCoreNode.canUseBoost()) {
        return;
    }
    if (game.playerMan.useBoost(BoostType.SPLIT) ||
        (StoreHelper.getInstance().buyOneBoost() && game.playerMan.useBoost(BoostType.SPLIT))) {
        this._gameCoreNode.useSplitBallBoost();
        this.updateBoost();
    } else {
        this._gameCoreNode.stop();
        var self = this;
        game.popupMan.popupStoreDlg(StoreType.DIAMOND, function () {
            self._gameCoreNode.resume();
        });
    }
};

GameController.prototype.storeClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.analyseManager.trackEvent("ClickStoreInGame");
    this._gameCoreNode.stop();
    var self = this;
    game.popupMan.popupStoreDlg(StoreType.DIAMOND, function () {
        self._gameCoreNode.resume();
    });
};

GameController.prototype.skinClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.analyseManager.trackEvent("ClickSkinsInGame");
    this._gameCoreNode.stop();
    var self = this;
    game.popupMan.popupStoreDlg(StoreType.SKIN, function () {
        self._gameCoreNode.resume();
    });
};

GameController.prototype.skipClicked = function (sender) {
    this._gameCoreNode.stop();
    var StoreHelper = require("../model/StoreHelper");
    StoreHelper.getInstance().checkAndShowRewardVideo("skip_game", function (rewarded) {
        if (rewarded) {
            game.analyseManager.trackEvent("WatchAdsToSkipLevelGame", {"level": GameMan.getInstance().levelId});
            GameMan.getInstance().skipLevel();
            game.sceneMan.switchScene(game.sceneType.GAME);
        } else {
            this._gameCoreNode.resume();
        }
    }.bind(this));
};

GameController.prototype.flyGiftClicked = function (sender) {
    this.ndFlyGift.visible = false;
    if (game.adsManager.isRewardVideoReady()) {
        this._gameCoreNode.stop();
    }
    var StoreHelper = require("../model/StoreHelper");
    StoreHelper.getInstance().checkAndGetRandomDiamonds("fly_gift", function () {
        this._gameCoreNode.resume();
    }.bind(this));
};

GameController.createFromCCB = function() {
    game.utils.registerController("HelpController", new HelpController());
    game.utils.registerController("AimHelpController", new AimHelpController());
    game.utils.registerController("AimItemController", new AimItemController());
    game.utils.registerController("BoardGetController", new BoardGetController());
    game.utils.registerController("LaserController", new LaserController());

    var node = game.utils.loadNodeFromCCB("res/game/game_view.ccbi", null, "GameController", new GameController());
    game.utils.unRegisterController("AimItemController");
    game.utils.unRegisterController("HelpController");
    game.utils.unRegisterController("AimHelpController");
    game.utils.unRegisterController("BoardGetController");
    game.utils.unRegisterController("LaserController");
    return node;
};

module.exports = GameController;
},{"../controller/GiftBoxController":93,"../editor/scene/EditorScene":140,"../enum/BoostType":154,"../enum/ChallengeId":155,"../enum/SkinType":166,"../enum/StoreType":167,"../events/EventsName":169,"../model/GameMan":173,"../model/StoreHelper":178,"../view/BricksView":186,"./AimHelpController":68,"./AimItemController":69,"./BoardGetController":72,"./HelpController":94,"./LaserController":95}],91:[function(require,module,exports){
var GameMan = require("../model/GameMan");
var GameMode = require("../enum/GameMode");

var GameOverController = function () {
    BaseCCBController.call(this);
    this._bestScoreLabel = null;
    this._scoreLabel = null;

    this._iconEnglish = null;
    this._iconChinese = null;
    this._newRecordLabel = null;

    this._replayCallback = null;
};

game.utils.inherits(GameOverController, BaseCCBController);

GameOverController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this._newRecordLabel.visible = false;
};

GameOverController.prototype.initWith = function (percent, callback) {
    if (GameMan.getInstance().gameMode === GameMode.GAME_MODE_ENDLESS) {
        this._bestScoreLabel.setString(game.utils.sprintf(game.local.getValue("best_score_title"), game.playerMan.getBestScore()));
        this._scoreLabel.setString(percent);
        this._newRecordLabel.setString(game.local.getValue("new_record_title"));
        if (GameMan.getInstance().isNewRecord) {
            this._newRecordLabel.visible = true;
            this._newRecordLabel.runAction(cc.sequence(cc.fadeOut(0.3), cc.fadeIn(0.3)).repeatForever());
        }
    } else {
        this._bestScoreLabel.setString(game.utils.sprintf(game.local.getValue("level_title"), GameMan.getInstance().levelConfig.id));
        this._scoreLabel.setString(game.utils.sprintf("%d%%", percent));
    }
    this._replayCallback = callback;
};

GameOverController.prototype.homeClicked = function (sender) {
    AudioHelper.playBtnSound();
    var reScene = new cc.TransitionFade(0.5, GameBridge.getMenuScene(), cc.color(255, 255, 255));
    cc.director.runScene(reScene);
};

GameOverController.prototype.replayClicked = function (sender) {
    AudioHelper.playBtnSound();
    if (this._replayCallback) {
        this._replayCallback();
    }
    this.close();
};

GameOverController.prototype.rankClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.gcManager.showLeaderboard(game.config.getLeaderBoardKey());
};

GameOverController.prototype.shareClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.shareManager.shareWithSystem(game.utils.sprintf(game.local.getValue("share_tips"),
        game.playerMan.getBestScore(), game.config.getPlatformDownloadUrl()));
};

GameOverController.prototype.popup = function () {
    //game.dialogManager.popup(this.rootNode);
    //game.dialogManager.popup(this.rootNode, {"overlayOpacity": 100});
    game.dialogManager.popup(this.rootNode, {"overlayColor": cc.color(243, 243, 243), "overlayOpacity": 210});
};

GameOverController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

GameOverController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/game_over_view.ccbi", null, "GameOverController", new GameOverController());
    return node;
};

module.exports = GameOverController;
},{"../enum/GameMode":158,"../model/GameMan":173}],92:[function(require,module,exports){
var GameMan = require("../model/GameMan");

var GameWinController = function () {
    BaseCCBController.call(this);
    this.YELLOW_COLOR = cc.color(254, 175, 25);

    this._nextNode = null;

    this._resultLabel = null;

    this._replayCallback = null;
    this._nextCallback = null;
};

game.utils.inherits(GameWinController, BaseCCBController);

GameWinController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);

    this._resultLabel.setString(game.local.getValue("mission_completed_title"));
    var hasNextLevel = GameMan.getInstance().hasNextLevel();
    if (!hasNextLevel) {
        this._nextNode.visible = false;
    }
};

GameWinController.prototype.initWith = function (callback, nextCallback) {
    this._replayCallback = callback;
    this._nextCallback = nextCallback;
};

GameWinController.prototype.homeClicked = function (sender) {
    AudioHelper.playBtnSound();
    var reScene = new cc.TransitionFade(0.5, GameBridge.getMenuScene(), cc.color(255, 255, 255));
    cc.director.runScene(reScene);
};

GameWinController.prototype.nextClicked = function (sender) {
    AudioHelper.playBtnSound();
    if (this._nextCallback) {
        this._nextCallback();
    }
    this.close();
};

GameWinController.prototype.replayClicked = function (sender) {
    if (this._replayCallback) {
        this._replayCallback();
    }
    this.close();
};

GameWinController.prototype.rankClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.gcManager.showLeaderboard(game.config.getLeaderBoardKey());
};

GameWinController.prototype.shareClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.shareManager.shareWithSystem(game.utils.sprintf(game.local.getValue("share_tips"),
        game.playerMan.getBestScore(), game.config.getPlatformDownloadUrl()));
};

GameWinController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {"overlayColor": cc.color(243, 243, 243), "overlayOpacity": 210});
};

GameWinController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

GameWinController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/game_win_view.ccbi", null, "GameWinController", new GameWinController());
    return node;
};

module.exports = GameWinController;
},{"../model/GameMan":173}],93:[function(require,module,exports){
var GiftBoxController = function () {
    BaseCCBController.call(this);
    this.callback = null;
};

game.utils.inherits(GiftBoxController, BaseCCBController);

GiftBoxController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
};

GiftBoxController.prototype.onExit = function () {
    BaseCCBController.prototype.onExit.call(this);
    clearTimeout(this.timeoutKey);
};

GiftBoxController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.rootNode.visible = false;
    this.timeoutKey = setTimeout(this.onTimeout.bind(this), 5000);
};

GiftBoxController.prototype.setCallback = function (callback) {
    this.callback = callback;
};

GiftBoxController.prototype.onTimeout = function () {
    if (game.gameMan.canShowGiftBox()) {
        this.rootNode.visible = true;
        game.gameMan.addGiftCount();
    } else {
        this.rootNode.visible = false;
    }
};

GiftBoxController.prototype.giftClicked = function () {
    AudioHelper.playBtnSound();
    var self = this;
    if (game.adsManager.isRewardVideoReady()) {
        this.rootNode.visible = false;
        if (self.callback) {
            self.callback("start");
        }
        var StoreHelper = require("../model/StoreHelper");
        StoreHelper.getInstance().checkAndShowRewardVideo("gift_box", function (watched) {
            if (watched) {
                game.gameMan.onGiftBoxOpened(function () {
                    if (self.callback) {
                        self.callback("end");
                    }
                });
            } else {
                if (self.callback) {
                    self.callback("end");
                }
            }
        });
    }
};

GiftBoxController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/gift_box_view.ccbi", null, "GiftBoxController", new GiftBoxController(), true);
    return node;
};

module.exports = GiftBoxController;
},{"../model/StoreHelper":178}],94:[function(require,module,exports){


var HelpController = function () {
    BaseCCBController.call(this);
    this.lbHelpInfo = null;
};

game.utils.inherits(HelpController, BaseCCBController);

HelpController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    if (game.playerMan.player.isAimVersion) {
        this.lbHelpInfo.setString(game.local.getValue("help_content_new"));
    } else {
        this.lbHelpInfo.setString(game.local.getValue("help_content"));
    }
    this.lbHelpInfo.setAlignment(cc.TEXT_ALIGNMENT_CENTER);
};

module.exports = HelpController;
},{}],95:[function(require,module,exports){
var LaserController = function () {
    BaseCCBController.call(this);
    this.ndLaser = null;
    this.ndLaserRegion = null;
};

game.utils.inherits(LaserController, BaseCCBController);

LaserController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
};

LaserController.prototype.onEnter = function() {
    BaseCCBController.prototype.onEnter.call(this);
};

LaserController.prototype.onExit = function() {
    BaseCCBController.prototype.onExit.call(this);
};

LaserController.prototype.showLaser = function () {
    this.ndLaser.visible = true;
    game.utils.playCCBAnimation(this.rootNode, "show");
};

LaserController.prototype.onShowLaserEnd = function () {
    this.ndLaser.visible = false;
};

LaserController.prototype.isShowedLaser = function () {
    return this.ndLaser.visible;
};

LaserController.prototype.getLaserBoundingBox = function () {
    return this.ndLaserRegion.getBoundingBoxToWorld();
};

module.exports = LaserController;
},{}],96:[function(require,module,exports){
var GameScene = require("../scene/GameScene");
var StoreHelper = require("../model/StoreHelper");
var MultiColTableView = require("../../common/ext/MultiColTableView");
var LevelItemController = require("./LevelItemController");
var LevelConfigMan = require("../config/ConfigMan");
var LockStatus = require("../enum/LockStatus");
var GameMan = require("../model/GameMan");
var TitleController = require("./TitleController");

var GRID_SIZE = [137.5, 120];

var LevelItemCellView = cc.TableViewCell.extend({
    levelEntity: null,
    levelItemNode: null,
    ctor: function () {
        this._super();
        this.levelItemNode = LevelItemController.createFromCCB();
        this.addChild(this.levelItemNode);

        this.levelItemNode.setPosition(cc.p(GRID_SIZE[0] * 0.5, GRID_SIZE[1] * 0.5));
    },

    initWith: function (levelEntity, idx) {
        this.levelEntity = levelEntity;
        this.levelItemNode.controller.initWith(levelEntity, idx);
    },

    showAppearAnim: function () {
        this.levelItemNode.controller.showAppearAnim();
    },

    showDisappearAnim: function () {
        this.levelItemNode.controller.showDisappearAnim();
    }
});

var LevelController = function () {
    BaseCCBController.call(this);
    this.ndContainer = null;
    this.lbLevelName = null;

    //user data.
    this._levelList = null;
};

game.utils.inherits(LevelController, BaseCCBController);

LevelController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);

    this._levelList = GameMan.getInstance().getLevelList();
    this.showLevelTableView();

    var userLevel = GameMan.getInstance().getPlayerLevel();
    if (userLevel > this._levelList.length) {
        userLevel = this._levelList.length;
    }
    var curRow = 0;
    if (userLevel % this.numberOfGridsInCell() === 0) {
        curRow = Math.floor(userLevel / this.numberOfGridsInCell());
    } else {
        curRow = Math.floor(userLevel / this.numberOfGridsInCell()) + 1;
    }

    var yOffset = -(this.numberOfCellsInTableView() - curRow + 1) * this.gridSizeForTable().height +
        this._tableView.getViewSize().height;

    if (yOffset < this._tableView.minContainerOffset().y) {
        yOffset = this._tableView.minContainerOffset().y;
    } else if (yOffset >= this._tableView.maxContainerOffset().y) {
        yOffset = this._tableView.maxContainerOffset().y;
    }

    this._tableView.setContentOffset(cc.p(0, yOffset));
};

LevelController.prototype.showLevelTableView = function () {
    var size = this.ndContainer.getContentSize();
    this._tableView = new MultiColTableView(this, size, null);
    this._tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL);
    this._tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN);
    this._tableView.setMultiTableViewDelegate(this);
    this._tableView.ignoreAnchorPointForPosition(false);
    this._tableView.setAnchorPoint(cc.p(0, 0));
    this.ndContainer.addChild(this._tableView);
    this._tableView.reloadData();
};

LevelController.prototype.scrollViewDidScroll = function (view) {
};

LevelController.prototype.scrollViewDidZoom = function (view) {
};

LevelController.prototype.gridAtIndex = function(multiTable,  idx) {
    var cell = multiTable.dequeueGrid();
    if (!cell) {
        cell = new LevelItemCellView();
    }

    if (idx < this._levelList.length) {
        var levelEntity = this._levelList[idx];
        cell.initWith(levelEntity, idx);
        cell.visible = true;
    } else {
        cell.visible = false;
    }

    return cell;
};

LevelController.prototype.numberOfCellsInTableView = function(multiTable) {
    var gridsInCell = this.numberOfGridsInCell(multiTable);
    if (this._levelList.length % gridsInCell === 0) {
        return Math.floor(this._levelList.length / gridsInCell);
    } else {
        return Math.floor(this._levelList.length / gridsInCell) + 1;
    }
};

LevelController.prototype.numberOfGridsInCell = function(multiTable, colIdx) {
    return 4;
};

LevelController.prototype.gridSizeForTable = function(table, colIdx) {
    return cc.size(GRID_SIZE[0], GRID_SIZE[1]);
};

LevelController.prototype.gridTouched = function(table, grid) {
    //console.log("grid touched at index: " + grid.getIdx());
    AudioHelper.playBtnSound();
    if (grid.getIdx() < GameMan.getInstance().getPlayerLevel()) {
        if (this.clicked) {
            return;
        }
        this.clicked = true;
        GameMan.getInstance().chooseLevel(grid.getIdx() + 1);
        game.sceneMan.switchScene(game.sceneType.GAME);
    }
};

LevelController.prototype.backClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.sceneMan.switchScene(game.sceneType.MENU);
};

LevelController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/level_view.ccbi", null, "LevelController", new LevelController());
    return node;
};

module.exports = LevelController;
},{"../../common/ext/MultiColTableView":16,"../config/ConfigMan":52,"../enum/LockStatus":161,"../model/GameMan":173,"../model/StoreHelper":178,"../scene/GameScene":181,"./LevelItemController":97,"./TitleController":130}],97:[function(require,module,exports){
var LockStatus = require("../enum/LockStatus");
var GameMan = require("../model/GameMan");

var LevelItemController = function () {
    BaseCCBController.call(this);

    this.GRAY_COLOR = cc.color(78, 100, 169);
    this.LIGHT_COLOR = cc.color(251, 252, 255);

    this.lbLevel = null;
    this.spPlayed = null;
    this.spLocked = null;

    this.spCurrent = null;

    this.ndStar = null;

    this.spYellow1 = null;
    this.spYellow2 = null;
    this.spYellow3 = null;

    this.spBlack1 = null;
    this.spBlack2 = null;
    this.spBlack3 = null;

    this.spYellows = [];
    this.spBlacks = [];

    this.idx = 0;
};

game.utils.inherits(LevelItemController, BaseCCBController);

LevelItemController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.spYellows = [this.spYellow1, this.spYellow2, this.spYellow3];
    this.spBlacks = [this.spBlack1, this.spBlack2, this.spBlack3];
};

LevelItemController.prototype.showAppearAnim = function () {
    game.utils.randomScaleAnim(this.rootNode, 1, 0.8);
};

LevelItemController.prototype.showDisappearAnim = function () {
    this.rootNode.runAction(cc.scaleTo(0.4, 0));
};

/**
 * @param {LevelConfig} data
 * @param {number} idx
 */
LevelItemController.prototype.initWith = function (data, idx) {
    cc.log("LevelItemController initWith");
    this.idx = idx;
    this.lbLevel.setString(idx + 1);
    var level = idx + 1;

    this.spCurrent.visible = false;
    this.spLocked.visible = false;
    this.spPlayed.visible = false;
    this.ndStar.visible = false;
    this.lbLevel.visible = true;
    var curLevel = GameMan.getInstance().getPlayerLevel();
    if (curLevel === idx + 1) {
        this.spCurrent.visible = true;
        this.lbLevel.y = 0;
        this.lbLevel.setColor(this.LIGHT_COLOR);
    } else if (curLevel > idx + 1) {
        this.spPlayed.visible = true;
        this.ndStar.visible = true;
        var star = 0;
        if (GameMan.getInstance().isNewHardMode()) {
            star = game.playerMan.getNewHardLevelStar(level) || 0;
        } else
        if (GameMan.getInstance().isHardMode()) {
            star = game.playerMan.getHardLevelStar(level) || 0;
        } else {
            star = game.playerMan.getLevelStar(level) || 0;
        }
        cc.log("LevelItemController star:" + star);
        for (var i = 0; i < 3; ++i) {
            this.spYellows[i].visible = (star >= i + 1);
            this.spBlacks[i].visible = (star < i + 1);
        }
        this.lbLevel.y = 11;
        this.lbLevel.setColor(this.LIGHT_COLOR);
    } else {
        this.lbLevel.y = 0;
        //this.lbLevel.visible = false;
        this.spLocked.visible = true;
        this.lbLevel.setColor(this.GRAY_COLOR);
    }
};

LevelItemController.prototype.levelClicked = function () {
    AudioHelper.playBtnSound();
    if (this.idx < GameMan.getInstance().getPlayerLevel()) {
        GameMan.getInstance().chooseLevel(this.idx + 1);
        game.sceneMan.switchScene(game.sceneType.GAME);
    }
};

LevelItemController.prototype.getContentSize = function () {
    return this.spPlayed.getContentSize();
};

LevelItemController.createFromCCB = function() {
    return game.utils.loadNodeFromCCB("res/menu/level_item_view.ccbi", null, "LevelItemController", new LevelItemController());
};

module.exports = LevelItemController;
},{"../enum/LockStatus":161,"../model/GameMan":173}],98:[function(require,module,exports){
var MenuScene = require("../scene/MenuScene");
var PlayerMan = require("../model/PlayerMan");
var StoreHelper = require("../model/StoreHelper");
var GameScene = require("../scene/GameScene");
var SceneType = require("../enum/SceneType");
var GameMan = require("../model/GameMan");
var SceneMan = require("../model/SceneMan");
var AdsReminderController = require("../controller/AdsReminderController");
var DiamondsController = require("../controller/DiamondsController");
var ActivityTaskTipsController = require("../controller/ActivityTaskTipsController");
var DailyTaskEntranceController = require("../controller/DailyTaskEntranceController");

var LoadingController = function () {
    BaseCCBController.call(this);
    this.bgEnSprite = null;
    this.bgCnSprite = null;
};

game.utils.inherits(LoadingController, BaseCCBController);

LoadingController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);

    cc.BuilderReader.registerController("AdsReminderController", new AdsReminderController());
    cc.BuilderReader.registerController("DiamondsController", new DiamondsController());
    cc.BuilderReader.registerController("ActivityTaskTipsController", new ActivityTaskTipsController());
    cc.BuilderReader.registerController("DailyTaskEntranceController", new DailyTaskEntranceController());

    game.playerMan = PlayerMan.getInstance();
    game.playerMan.initData();

    var LogicMan = require("../../common/model/LogicMan");
    LogicMan.getInstance().startGame(true);

    var ResourcesMan = require("../model/ResourcesMan");

    game.sceneMan = SceneMan.getInstance();
    game.sceneType = SceneType;

    game.gameMan.init();
    game.gameMan.registerRemoteConfig();
    //game.gameMan.adjustSkinConfigs();

    game.analyseManager.trackEvent("Loading");
    game.analyseManager.trackEvent("TestBoostProbability");
    var isFirstEnterGame = true;
    var firstOpenGame = game.storageController.getItem("firstOpenGame", "true");
    if (firstOpenGame != "true") {
        isFirstEnterGame = false;
    } else {
        game.storageController.setItem("firstOpenGame", "false");
    }

    var myLogo = game.utils.isSelfGame();

    cc.log("isFirstEnterGame:" + isFirstEnterGame);

    this.bgCnSprite.visible = false;
    this.bgEnSprite.visible = false;
    var sprite = myLogo ? this.bgCnSprite : this.bgEnSprite;
    sprite.visible = true;
    sprite.opacity = 0;
    var WAIT_TIME = 2000;
    sprite.runAction(cc.sequence(cc.fadeIn(0.5), cc.callFunc(function () {
        var time = Date.now();
        ResourcesMan.getInstance().preload(function () {
            var loadTime = Date.now() - time;
            cc.log("loadTime:" + loadTime);
            var delayTime = Math.max(WAIT_TIME - loadTime, 200);
            sprite.runAction(cc.sequence(cc.delayTime(delayTime / 1000), cc.fadeOut(0.5), cc.callFunc(function () {
                if (isFirstEnterGame) {
                    GameMan.getInstance().chooseLatestLevel();
                    game.sceneMan.switchScene(game.sceneType.GAME);
                    game.analyseManager.trackEvent("EnterFirstLevel");
                } else {
                    cc.director.runScene(new MenuScene());
                }
            }, this)));
        });
    }, this)));
};

LoadingController.prototype.onExit = function () {
    BaseCCBController.prototype.onExit.call(this);
};

LoadingController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
};

LoadingController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/loading_view.ccbi", null, "LoadingController", new LoadingController());
    return node;
};

module.exports = LoadingController;
},{"../../common/model/LogicMan":30,"../controller/ActivityTaskTipsController":66,"../controller/AdsReminderController":67,"../controller/DailyTaskEntranceController":86,"../controller/DiamondsController":87,"../enum/SceneType":163,"../model/GameMan":173,"../model/PlayerMan":174,"../model/ResourcesMan":176,"../model/SceneMan":177,"../model/StoreHelper":178,"../scene/GameScene":181,"../scene/MenuScene":184}],99:[function(require,module,exports){
var StoreHelper = require("../model/StoreHelper");

var LuckySpinController = function () {
    BaseCCBController.call(this);

    this.lblMulti = null;
    this.randomEndCallback = null;

    this.multiNum = 1;
    this.range = null;
};

game.utils.inherits(LuckySpinController, BaseCCBController);

LuckySpinController.prototype.onExit = function () {
    BaseCCBController.prototype.onExit.call(this);
};

LuckySpinController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
};

LuckySpinController.prototype.initWith = function (multi, range, endCallback) {
    this.multiNum = multi;
    this.range = range;
    this.randomEndCallback = endCallback;
    this.startSpinAnim();
};

LuckySpinController.prototype.startSpinAnim = function () {
    this.spinCount = 10;
    this.showRandomMulti();
};

LuckySpinController.prototype.showRandomMulti = function () {
    this.spinCount--;
    if (this.spinCount <= 0) {
        game.audioPlayer.playEffectByKey("bonus");
        this.lblMulti.setString("X" + this.multiNum);
        this.rootNode.scheduleOnce(this.close.bind(this), 1);
    } else {
        game.audioPlayer.playEffectByKey("bonus");
        var randomNum = game.utils.randomNextIntInRange(this.range[0], this.range[1]);
        this.lblMulti.setString("X" + randomNum);
        this.rootNode.scheduleOnce(this.showRandomMulti.bind(this), 0.3);
    }
};

LuckySpinController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {popupAnim: false});
};

LuckySpinController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
    if (this.randomEndCallback) {
        this.randomEndCallback();
        this.randomEndCallback = null;
    }
};

LuckySpinController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/lucky_spin_view.ccbi", null, "LuckySpinController", new LuckySpinController());
    return node;
};

module.exports = LuckySpinController;
},{"../model/StoreHelper":178}],100:[function(require,module,exports){
//var PackageScene = require("../scene/PackageScene");
//var StoreHelper = require("../model/StoreHelper");
//var LevelScene = require("../scene/LevelScene");
//var GameScene = require("../scene/GameScene");
var GameMan = require("../model/GameMan");
var StoreHelper = require("../model/StoreHelper");
var EventsName = require("../events/EventsName");
var CrossAdsController = require("../../common/controller/CrossAdsController");

game.firstEnter = true;

var MenuController = function () {
    BaseCCBController.call(this);

    this.FLY_GIFT_MIN_X = 50;

    //this.spPlayEn = null;
    //this.spPlayCn = null;
    //this.spLevelsEn = null;
    //this.spLevelsCn = null;
    this.spIconEn = null;
    this.spIconCn = null;

    this._rankItem = null;
    this._supportItem = null;
    this._storeItem = null;
    this._rateItem = null;
    this._soundItem = null;

    //this.spHardCn = null;
    //this.spHardEn = null;

    this.spHardHint = null;

    //this.btnGiftEn = null;
    //this.btnGiftCn = null;
    //
    //this.btnWheelCn = null;
    //this.btnWheelEn = null;

    this.spGiftBg = null;
    this.ndSpecialOffer = null;

    this.ndGifts = null;

    this.spTaskReminder = null;
    this.spSkinReminder = null;

    this.lbStarCount = null;

    this.ndCrossAd = null;

    this.ndChallengeNormal = null;
    this.ndChallengeGray = null;

    this.spChallengeReminder = null;

    this.ndRemoveAds = null;

    // this.ndChristmas = null;
};

game.utils.inherits(MenuController, BaseCCBController);

MenuController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
    // setTimeout(function () {
    //     var firstOpenGame = game.storageController.getItem("firstOpenGame", "true");
    //     if (firstOpenGame != "true") {
    //         if (game.firstEnter) {
    //             GameMan.getInstance().addCheck();
    //             GameMan.getInstance().onCheckNext();
    //         } else {
    //             GameMan.getInstance().checkAutoPopup(game.firstEnter);
    //         }
    //     } else {
    //         game.storageController.setItem("firstOpenGame", "false");
    //     }
    //     game.firstEnter = false;
    // }, 300);
    this.updateTaskReminder();
    this.intervalKey = setInterval(this.onUpdate.bind(this), 1000);
    game.eventDispatcher.addEventListener(EventsName.UPDATE_SPECIAL_OFFER, this.updateSpeicialOffer, this);
    game.eventDispatcher.addEventListener(EventsName.TASK_UPDATE, this.updateTaskReminder, this);
};

MenuController.prototype.onExit = function () {
    clearInterval(this.intervalKey);
    game.eventDispatcher.removeEventListener(EventsName.TASK_UPDATE, this.updateTaskReminder, this);
    game.eventDispatcher.removeEventListener(EventsName.UPDATE_SPECIAL_OFFER, this.updateSpeicialOffer, this);
    BaseCCBController.prototype.onExit.call(this);
};

MenuController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);

    game.analyseManager.trackEvent("EnterMenu");
    //this.createClubButton();
    this.updateSoundItem();
    this.updateGiftItem();
    //this.spPlayEn.visible = false;
    //this.spPlayCn.visible = false;
    //this.spLevelsEn.visible = false;
    //this.spLevelsCn.visible = false;
    this.spIconEn.visible = false;
    this.spIconCn.visible = false;
    //this.spHardCn.visible = false;
    //this.spHardEn.visible = false;
    //this.btnGiftEn.visible = false;
    //this.btnGiftCn.visible = false;
    //this.btnWheelCn.visible = false;
    //this.btnWheelEn.visible = false;

    if (game.local.isChinese()) {
        //this.spPlayCn.visible = true;
        //this.spLevelsCn.visible = true;
        this.spIconCn.visible = true;
        //this.spHardCn.visible = true;
        //this.btnGiftCn.visible = true;
        //this.btnWheelCn.visible = true;
    } else {
        //this.spPlayEn.visible = true;
        //this.spLevelsEn.visible = true;
        this.spIconEn.visible = true;
        //this.spHardEn.visible = true;
        //this.btnGiftEn.visible = true;
        //this.btnWheelEn.visible = true;
    }
    this.ndGifts.visible = true;

    this.spGiftBg.runAction(cc.rotateBy(3, 360).repeatForever());
    this.updateSpeicialOffer();
    this.updateSkinReminder();
    this.ndRemoveAds.visible = false;

    this.lbStarCount.setString(game.gameMan.getTotalStarCount());

    this.ndChallengeNormal.visible = false;
    this.ndChallengeGray.visible = false;
    this.spChallengeReminder.visible = false;
    // if (game.challengeMan.isChallengeUnlocked()) {
    //     this.ndChallengeNormal.visible = true;
    //     if (!game.playerMan.player.challengeEntered && game.playerMan.getOrCreateChallenge(1).challengeLevel === 1) {
    //         this.spChallengeReminder.visible = true;
    //     } else {
    //         this.spChallengeReminder.visible = false;
    //     }
    // } else {
    //     this.ndChallengeGray.visible = true;
    // }
    this.ndChallengeNormal.visible = true;
    if (!game.playerMan.player.challengeEntered && game.playerMan.getOrCreateChallenge(1).challengeLevel === 1) {
        this.spChallengeReminder.visible = false;
    } else {
        this.spChallengeReminder.visible = false;
    }

    this.showedFlyGift = false;
    this.ndFlyGift.visible = false;

    this.checkAndShowFlyGift();

    var DailyTaskPos = require("../enum/DailyTaskPos");
    this.ndActivity.controller.initWith(DailyTaskPos.Menu);

    this.downloadServerLevels(false);
};

MenuController.prototype.updateSpeicialOffer = function () {
    this.ndSpecialOffer.visible = !GameMan.getInstance().isSpecialOfferPurchased();
};

MenuController.prototype.onUpdate = function () {
    this.updateGiftItem();
    this.checkAndShowFlyGift();
};

MenuController.prototype.updateGiftItem = function () {
    if (game.adsManager.isRewardVideoReady()) {
        this.ndGifts.visible = true;
    } else {
        this.ndGifts.visible = false;
    }
};

MenuController.prototype.updateSoundItem = function () {
    var isSoundOn = game.audioPlayer.isEffectOn();
    if (isSoundOn) {
        this._soundItem.setNormalImage(new cc.Sprite("#btn_sound_on.png"));
        this._soundItem.setSelectedImage(new cc.Sprite("#btn_sound_on.png"));
    } else {
        this._soundItem.setNormalImage(new cc.Sprite("#btn_sound_off.png"));
        this._soundItem.setSelectedImage(new cc.Sprite("#btn_sound_off.png"));
    }
};

MenuController.prototype.storeClicked = function (sender) {
    AudioHelper.playBtnSound();
    var StoreType = require("../enum/StoreType");
    game.popupMan.popupStoreDlg(StoreType.DIAMOND);
};

MenuController.prototype.shareClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.shareManager.shareWithSystem(game.utils.sprintf(game.local.getValue("share_tips"),
        game.playerMan.getLevel(), game.config.getPlatformDownloadUrl()), game.config.getShareUrl());
};

MenuController.prototype.rankClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.gcManager.showLeaderboard(game.config.getLeaderBoardKey());
};

MenuController.prototype.supportClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.shareManager.sendEmail(game.config.getEmail(),
        game.local.getValue("feed_back_title"), game.local.getValue("feed_back_content"));
};

MenuController.prototype.rateClicked = function (sender) {
    AudioHelper.playBtnSound();
    cc.sys.openURL(game.config.getPlatformDownloadUrl());
};

MenuController.prototype.playClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.gameMan.isChallengeLevel = false;
    if (GameMan.getInstance().chooseLatestLevel()) {
        if (this.played) {
            return;
        }
        this.played = true;
        game.sceneMan.switchScene(game.sceneType.GAME);
    } else {
        game.popupMan.popupCommonDlg(game.local.getValue("all_completed"));
    }
};

MenuController.prototype.packageClicked = function (sender) {
    AudioHelper.playBtnSound();
    if (this.played) {
        return;
    }
    this.played = true;
    game.gameMan.isChallengeLevel = false;
    GameMan.getInstance().setHardMode(false);
    GameMan.getInstance().setNewHardMode(false);
    game.sceneMan.switchScene(game.sceneType.LEVEL);
};

MenuController.prototype.challengeClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.sceneMan.switchScene(game.sceneType.CHALLENGE_LIST);
    return;
    /*
    if (game.challengeMan.isChallengeUnlocked()) {
        game.gameMan.isChallengeLevel = true;
        game.sceneMan.switchScene(game.sceneType.CHALLENGE_LIST);
        game.analyseManager.trackEvent("ChallengeEnter", {"source": "menu"});
    } else {
        game.popupMan.popupCommonDlg(game.utils.sprintf(_("challenge_unlock_tips"), game.challengeMan.getUnlockLevel()));
    }*/
};

MenuController.prototype.soundClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.audioPlayer.setEffectOn(!game.audioPlayer.isEffectOn());
    game.audioPlayer.setMusicOn(!game.audioPlayer.isMusicOn());
    this.updateSoundItem();
};

MenuController.prototype.wheelClicked = function (sender) {
    AudioHelper.playBtnSound();
    var WheelType = require("../enum/WheelType");
    game.popupMan.popupWheelDlg(WheelType.DailyBonus);
};

MenuController.prototype.dailyBonusClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.popupMan.popupDailyBonus();
};

MenuController.prototype.hardClicked = function (sender) {
    AudioHelper.playBtnSound();
    if (this.played) {
        return;
    }
    this.played = true;
    game.gameMan.isChallengeLevel = false;
    game.storageController.setItem("hard_reminded", "false");
    // this.spHardHint.visible = false;
    GameMan.getInstance().setHardMode(true);
    GameMan.getInstance().setNewHardMode(false);
    game.sceneMan.switchScene(game.sceneType.LEVEL);
};

MenuController.prototype.hardModeClicked = function (sender) {
    AudioHelper.playBtnSound();
    if (this.played) {
        return;
    }
    this.played = true;
    game.gameMan.isChallengeLevel = false;
    game.storageController.setItem("hard_reminded", "false");
    GameMan.getInstance().setHardMode(false);
    GameMan.getInstance().setNewHardMode(true);
    game.sceneMan.switchScene(game.sceneType.LEVEL);
};

MenuController.prototype.fetchLevelClicked = function (sender) {
    AudioHelper.playBtnSound();

};

MenuController.prototype.giftClicked = function (sender) {
    AudioHelper.playBtnSound();
    StoreHelper.getInstance().checkAndShowRewardVideo(game.utils.isIOS() ? "shouye" : "jili04");
};

MenuController.prototype.taskClicked = function (sender) {
    AudioHelper.playBtnSound();
    this.downloadServerLevels(true);
};

MenuController.prototype.downloadServerLevels = function (notify) {
    var HttpClient = require("../../common/net/HttpClient");
    var dict = {"Content-type": "application/json"};
    HttpClient.doPost("//server.minigame.io:7000/tools/fetch_levels", "", dict, function (error, text) {
        if (!error) {
            console.log("results:" + text);
            var json = JSON.parse(text);
            if (json.errno === 0) {
                var levels = json.data;
                var results = [];
                var LevelConfig = require("../config/LevelConfig");
                for (var i = 0; i < levels.length; ++i) {
                    var level = levels[i];
                    var result = JSON.parse(level.content);
                    var levelConfig = new LevelConfig();
                    levelConfig.unmarshal(result);
                    results.push(levelConfig);
                }
                var ConfigMan = require("../config/ConfigMan");
                ConfigMan.getInstance().addHardLevelList(results);
                if (notify) {
                    game.popupMan.popupCommonDlg("Download Success");
                }
            } else {
                if (notify) {
                    game.popupMan.popupCommonDlg("Download Fail:" + json.errmsg);
                }
            }
        } else {
            if (notify) {
                game.popupMan.popupCommonDlg("Download Fail:" + text);
            }
        }
    });
};

MenuController.prototype.updateTaskReminder = function () {
    var clickSkin = game.storageController.getItem("click_task", "false");
    if (clickSkin == "false") {
        this.spTaskReminder.visible = true;
    } else {
        if (GameMan.getInstance().hasCompletedTask()) {
            this.spTaskReminder.visible = true;
        } else {
            this.spTaskReminder.visible = false;
        }
    }
};

MenuController.prototype.updateSkinReminder = function () {
    var clickSkin = game.storageController.getItem("click_skin_new", "false");
    if (clickSkin == "false") {
        this.spSkinReminder.visible = true;
    } else {
        this.spSkinReminder.visible = false;
    }
};

MenuController.prototype.specialOfferClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.popupMan.popupSpeicialOffer();
};

MenuController.prototype.skinClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.analyseManager.trackEvent("ClickSkins");
    var StoreType = require("../enum/StoreType");
    game.popupMan.popupStoreDlg(StoreType.SKIN);
    game.storageController.setItem("click_skin_new", "true");
    this.updateSkinReminder();
};

MenuController.prototype.settingClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.popupMan.popupSettingDlg();
};

MenuController.prototype.removeAdsClicked = function (sender) {
    AudioHelper.playBtnSound();
    var StoreType = require("../enum/StoreType");
    var StoreHelper = require("../model/StoreHelper");
    var removeAdEntity = StoreHelper.getInstance().getStoreEntityByType(StoreType.REMOVE_ADS);
    StoreHelper.getInstance().buyProduct(removeAdEntity);
};

MenuController.prototype.flyGiftClicked = function (sender) {
    AudioHelper.playBtnSound();
    if (!game.adsManager.isRewardVideoReady()) {
        return;
    }
    this.ndFlyGift.stopAllActions();
    this.ndFlyGift.visible = false;
    var StoreHelper = require("../model/StoreHelper");
    StoreHelper.getInstance().checkAndGetRandomDiamonds("menu_fly_gift");
};

MenuController.prototype.checkAndShowFlyGift = function () {
    if (this.showedFlyGift) {
        return;
    }
    return;
    if (game.gameMan.getPlayerLevel() <= game.adsManager.flyGiftOpenLevel) {
        return;
    }
    if (!game.adsManager.isRewardVideoReady()) {
        return;
    }
    this.showedFlyGift = true;
    this.ndFlyGift.visible = true;

    this.ndFlyGift.x = -10 - this.FLY_GIFT_MIN_X;
    this.ndFlyGift.y = game.utils.randomNextIntInRange(cc.winSize.height * 0.3, cc.winSize.height * 0.9);
    this.startFlyGift();
};

MenuController.prototype.startFlyGift = function () {
    var randomY1 = game.utils.randomNextIntInRange(cc.winSize.height * 0.3, cc.winSize.height * 0.9);
    var randomY2 = game.utils.randomNextIntInRange(cc.winSize.height * 0.3, cc.winSize.height * 0.9);
    this.ndFlyGift.stopAllActions();
    this.ndFlyGift.runAction(
        cc.sequence(
            cc.show(),
            cc.moveTo(10, cc.p(cc.winSize.width - this.FLY_GIFT_MIN_X + 10, randomY1)),
            cc.moveTo(10, cc.p(-this.FLY_GIFT_MIN_X * 0.5 - 20, randomY2)),
            cc.hide(),
            cc.delayTime(12),
            cc.callFunc(this.startFlyGift, this)
        ));
};

MenuController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/menu_view.ccbi", null, "MenuController", new MenuController());
    return node;
};

MenuController.time = 0;

module.exports = MenuController;
},{"../../common/controller/CrossAdsController":7,"../../common/net/HttpClient":32,"../config/ConfigMan":52,"../config/LevelConfig":54,"../enum/DailyTaskPos":156,"../enum/StoreType":167,"../enum/WheelType":168,"../events/EventsName":169,"../model/GameMan":173,"../model/StoreHelper":178}],101:[function(require,module,exports){


var NoticeController = function () {
    BaseCCBController.call(this);
    this._okItem = null;
    this._cancelItem = null;
    this._confirmItem = null;
    this._closeItem = null;
    this._infoLabel = null;

    this._okLabel = null;
    this._cancelLabel = null;
    this._confirmLabel = null;

    this.ndReward1 = null;
    this.ndReward2 = null;

    this.spReward1 = null;
    this.lbReward1 = null;
    this.spReward2 = null;
    this.lbReward2 = null;
    this.lbReward2Info = null;

    this.spReward = null;
    this.lbReward = null;
    this.lbRewardInfo = null;

    this.sprAd = null;

    this._okCallFunc = null;
    this._failCallFunc = null;
};

game.utils.inherits(NoticeController, BaseCCBController);

NoticeController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
    //game.adsManager.showNativeAd("notice", 0, 0);
};

NoticeController.prototype.onExit = function () {
    //game.adsManager.removeNativeAd("notice");
    BaseCCBController.prototype.onExit.call(this);
};

NoticeController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this._titleLabel.setString(game.local.getValue("notice_title"));
    this.ndReward1.visible = false;
    this.ndReward2.visible = false;
    this._infoLabel.visible = false;
    this.sprAd.visible = false;
};

NoticeController.prototype.initWithYes = function (info, okCallFunc) {
    this._infoLabel.visible = true;
    this._infoLabel.setString(info);
    this._infoLabel.setAlignment(cc.TEXT_ALIGNMENT_CENTER);
    this._okCallFunc = okCallFunc;
    this._confirmItem.visible = true;
    this._okItem.visible = false;
    this._cancelItem.visible = false;
    this._okLabel.visible = false;
    this._cancelLabel.visible = false;
    this._closeItem.visible = false;
    this._confirmLabel.visible = true;
    this._confirmLabel.setString(game.local.getValue("confirm_info"));
    this._confirmLabel.setAlignment(cc.TEXT_ALIGNMENT_CENTER);
};

NoticeController.prototype.initWithYesNo = function (info, yesInfo, cancelInfo, okCallFunc, failCallFunc, showClose, isShowAds) {
    this._infoLabel.visible = true;
    this._infoLabel.setString(info);
    this._infoLabel.setAlignment(cc.TEXT_ALIGNMENT_CENTER);
    this._okCallFunc = okCallFunc;
    this._failCallFunc = failCallFunc;
    if (this._confirmItem) {
        this._confirmItem.visible = false;
    }
    this._okItem.visible = true;
    this._cancelItem.visible = true;
    this._okLabel.visible = true;
    this._cancelLabel.visible = true;
    if (this._confirmLabel) {
        this._confirmLabel.visible = false;
    }
    this._okLabel.setString(yesInfo);
    this._cancelLabel.setString(cancelInfo);
    this._okLabel.setAlignment(cc.TEXT_ALIGNMENT_CENTER);
    this._cancelLabel.setAlignment(cc.TEXT_ALIGNMENT_CENTER);
    this._closeItem.visible = showClose;
    this.sprAd.visible = !!isShowAds;
    if (isShowAds) {
        this.rootNode.scheduleOnce(function () {
            game.utils.playCCBAnimation(this.rootNode, "loop");
        }.bind(this), 1);
    }
};

NoticeController.prototype.initWithRewardYes = function (info, okCallFunc, reward1Sprite, reward1Count,
                                                      reward2Sprite, reward2Count) {
    this._infoLabel.visible = false;
    var spriteFrame;
    if (reward1Sprite && reward2Sprite) {
        this.ndReward2.visible = true;
        this.lbReward2Info.setString(info);
        this.lbReward2Info.setAlignment(cc.TEXT_ALIGNMENT_CENTER);
        spriteFrame = cc.spriteFrameCache.getSpriteFrame(reward1Sprite);
        if (spriteFrame) {
            this.spReward1.setSpriteFrame(spriteFrame);
        }
        this.lbReward1.setString("x" + reward1Count);
        spriteFrame = cc.spriteFrameCache.getSpriteFrame(reward2Sprite);
        if (spriteFrame) {
            this.spReward2.setSpriteFrame(spriteFrame);
        }
        this.lbReward2.setString("x" + reward2Count);
    } else {
        this.ndReward1.visible = true;
        this.lbRewardInfo.setString(info);
        this.lbRewardInfo.setAlignment(cc.TEXT_ALIGNMENT_CENTER);
        spriteFrame = cc.spriteFrameCache.getSpriteFrame(reward1Sprite);
        if (spriteFrame) {
            this.spReward.setSpriteFrame(spriteFrame);
        }
        this.lbReward.setString("x" + reward1Count);
    }

    this._okCallFunc = okCallFunc;
    this._confirmItem.visible = true;
    this._okItem.visible = false;
    this._cancelItem.visible = false;
    this._okLabel.visible = false;
    this._cancelLabel.visible = false;
    this._closeItem.visible = false;
    this._confirmLabel.visible = true;
    this._confirmLabel.setString(game.local.getValue("confirm_info"));
    this._confirmLabel.setAlignment(cc.TEXT_ALIGNMENT_CENTER);
};

NoticeController.prototype.okClicked = function (sender) {
    AudioHelper.playBtnSound();
    if (this._okCallFunc) {
        this._okCallFunc();
    }
    this.close();
};

NoticeController.prototype.cancelClicked = function (sender) {
    AudioHelper.playBtnSound();
    if (this._failCallFunc) {
        this._failCallFunc();
    }
    this.close();
};

NoticeController.prototype.closeClicked = function (sender) {
    AudioHelper.playBtnSound();
    this.close();
};

NoticeController.prototype.confirmClicked = function (sender) {
    AudioHelper.playBtnSound();
    if (this._okCallFunc) {
        this._okCallFunc();
    }
    this.close();
};

NoticeController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {popupAnim: true});
};

NoticeController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};


NoticeController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/notice_view.ccbi", null, "NoticeController", new NoticeController());
    return node;
};

NoticeController.createGuideFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/new_tip_view.ccbi", null, "NoticeController", new NoticeController());
    return node;
};

module.exports = NoticeController;
},{}],102:[function(require,module,exports){
var GameScene = require("../scene/GameScene");
var StoreHelper = require("../model/StoreHelper");
var MultiColTableView = require("../../common/ext/MultiColTableView");
var PackageItemController = require("./PackageItemController");
var LevelConfigMan = require("../config/ConfigMan");
var LockStatus = require("../enum/LockStatus");
var GameMan = require("../model/GameMan");
var LevelScene = require("../scene/LevelScene");
var TitleController = require("./TitleController");

//var CELL_WIDTH = 520;

var PackageItemCellView = cc.TableViewCell.extend({
    packageEntity: null,
    packageItemNode: null,

    ctor: function () {
        this._super();
        this.packageItemNode = PackageItemController.createFromCCB();
        this.addChild(this.packageItemNode);
        var size = this.packageItemNode.controller.getContentSize();
        this.packageItemNode.setPosition(cc.p(cc.winSize.width * 0.5, size.height * 0.5));
    },

    initWith: function (packageEntity, idx) {
        cc.log("PackageItemCellView initWith:idx:" + idx);
        this.packageEntity = packageEntity;
        this.packageItemNode.controller.initWith(packageEntity, idx);
    },

    refresh: function () {
        this.packageItemNode.controller.refresh();
    },

    showAppearAnim: function () {
        this.packageItemNode.controller.showAppearAnim(false);
    },

    showDisappearAnim: function () {
        this.packageItemNode.controller.showDisappearAnim();
    }
});

var PackageController = function () {
    BaseCCBController.call(this);
    this.lbChapterName = null;
    this.ndContainer = null;
    this.lbLevelName = null;
    this._tableView = null;

    //user data.
    this.packageConfigs = null;
};

game.utils.inherits(PackageController, BaseCCBController);

PackageController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);

    this.packageConfigs = LevelConfigMan.getInstance().getPackageList();

    this.showLevelTableView();

    var packageId = 1;
    var packageInfo = GameMan.getInstance().getMinUnCompletedPackage();
    if (!packageInfo || (packageInfo.id > this.packageConfigs.length)) {
        packageId = 1;
    } else {
        packageId = packageInfo.id;
    }
    cc.log("packageId:" + packageId);
    var curRow = 0;
    if (packageId % this.numberOfGridsInCell() === 0) {
        curRow = Math.floor(packageId / this.numberOfGridsInCell());
    } else {
        curRow = Math.floor(packageId / this.numberOfGridsInCell()) + 1;
    }

    var yOffset = -(this.numberOfCellsInTableView() - curRow + 1) * this.gridSizeForTable().height +
        this._tableView.getViewSize().height;

    if (yOffset < this._tableView.minContainerOffset().y) {
        yOffset = this._tableView.minContainerOffset().y;
    } else if (yOffset >= this._tableView.maxContainerOffset().y) {
        yOffset = this._tableView.maxContainerOffset().y;
    }

    this._tableView.setContentOffset(cc.p(0, yOffset));

    for (var i = 0; i < this.numberOfCellsInTableView(); ++i) {
        var cell = this._tableView.getGridAtIndex(i);
        if (cell) {
            cell.showAppearAnim();
        }
    }

    this.lbLevelName.setString(game.local.getValue("package_title"));
};

PackageController.prototype.showLevelTableView = function () {
    this._tableView = new MultiColTableView(this, this.ndContainer.getContentSize(), null);
    this._tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL);
    this._tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN);
    this._tableView.setMultiTableViewDelegate(this);
    this._tableView.ignoreAnchorPointForPosition(false);
    this._tableView.setAnchorPoint(cc.p(0, 0));
    this.ndContainer.addChild(this._tableView);
    this._tableView.reloadData();
};

PackageController.prototype.scrollViewDidScroll = function (view) {
};

PackageController.prototype.scrollViewDidZoom = function (view) {
};

PackageController.prototype.gridAtIndex = function(multiTable,  idx) {
    var cell = multiTable.dequeueGrid();
    if (!cell) {
        cell = new PackageItemCellView();
    }

    if (idx < this.packageConfigs.length) {
        var packageConfig = this.packageConfigs[idx];
        cell.initWith(packageConfig, idx, this.inited);
        cell.visible = true;
    } else {
        cell.visible = false;
    }

    return cell;
};

PackageController.prototype.numberOfCellsInTableView = function(multiTable) {
    return this.packageConfigs.length;
};

PackageController.prototype.numberOfGridsInCell = function(multiTable, colIdx) {
    return 1;
};

PackageController.prototype.gridSizeForTable = function(table, colIdx) {
    return cc.size(cc.winSize.width, 143);
};

PackageController.prototype.gridTouched = function(table, grid) {
    cc.log("grid touched at index: " + grid.getIdx());
    var packageEntity = grid.packageEntity;
    AudioHelper.playBtnSound();
    if (packageEntity.isLocked()) {
        game.popupMan.popupYesNoCommonDlg(game.utils.sprintf(game.local.getValue("unlock_info"), packageEntity.unlockCount),
            game.local.getValue("unlock_title"),
            game.local.getValue("cancel_title"),
            function () {
            if (game.playerMan.player.coins >= packageEntity.unlockCount) {
                game.playerMan.addCoins(-packageEntity.unlockCount);
                game.playerMan.setPackageUnlocked(packageEntity.id);
                grid.refresh();
            } else {
                game.popupMan.popupStoreDlg();
            }
        });
    } else {
        this.showCloseAnim(function () {
            GameMan.getInstance().setPackageEntity(packageEntity);
            game.sceneMan.switchScene(game.sceneType.LEVEL);
        });
    }
};

PackageController.prototype.backClicked = function (sender) {
    AudioHelper.playBtnSound();
    this.showCloseAnim(function () {
        game.sceneMan.switchScene(game.sceneType.MENU);
    });
};

PackageController.prototype.showCloseAnim = function (callback) {
    for (var i = 0; i < this.numberOfCellsInTableView(); ++i) {
        var cell = this._tableView.getGridAtIndex(i);
        if (cell) {
            cell.showDisappearAnim();
        }
    }
    this.rootNode.scheduleOnce(function () {
        if (callback) {
            callback();
        }
    }.bind(this), 0.8);
};

PackageController.createFromCCB = function() {
    cc.BuilderReader.registerController("TitleController", new TitleController());
    var node = game.utils.loadNodeFromCCB("res/menu/package_view.ccbi", null, "PackageController", new PackageController());
    cc.BuilderReader._controllerClassCache["TitleController"] = undefined;
    return node;
};

module.exports = PackageController;
},{"../../common/ext/MultiColTableView":16,"../config/ConfigMan":52,"../enum/LockStatus":161,"../model/GameMan":173,"../model/StoreHelper":178,"../scene/GameScene":181,"../scene/LevelScene":182,"./PackageItemController":103,"./TitleController":130}],103:[function(require,module,exports){
var LockStatus = require("../enum/LockStatus");

var PackageItemController = function () {
    BaseCCBController.call(this);
    this.lbName = null;
    this.lbCount = null;

    this.spBg = null;

    this.spCompleted = null;
    this.spUnCompleted = null;

    this.ndLock = null;
    this.lbUnlockCount = null;

    this.packageEntity = null;

    this.idx = 0;
};

game.utils.inherits(PackageItemController, BaseCCBController);

PackageItemController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
};

PackageItemController.prototype.showAppearAnim = function (inited) {
    //if (!inited) {
        this.rootNode.stopAllActions();
        game.utils.playCCBAnimation(this.rootNode, "left");
        this.rootNode.scheduleOnce(function () {
            game.utils.playCCBAnimation(this.rootNode, "normal");
        }.bind(this), this.idx * 0.05);
    //} else {
    //    game.utils.playCCBAnimation(this.rootNode, "none");
    //}
};

PackageItemController.prototype.showDisappearAnim = function () {
    this.rootNode.stopAllActions();
    this.rootNode.scheduleOnce(function () {
        game.utils.playCCBAnimation(this.rootNode, "disappear");
    }.bind(this), this.idx * 0.05);
};

/**
 * @param {PackageConfig} data
 * @param {number} idx
 */
PackageItemController.prototype.initWith = function (data, idx) {
    this.packageEntity = data;
    this.idx = idx;
    this.refresh();
    game.utils.playCCBAnimation(this.rootNode, "none");
};

PackageItemController.prototype.refresh = function () {
    this.lbName.setString(game.local.getValue(game.utils.sprintf("package_%d", this.idx + 1)));
    var maxLevel = game.playerMan.getPackageUnlockLevel(this.packageEntity.id) + 1;
    if (maxLevel > this.packageEntity.count) {
        maxLevel = this.packageEntity.count;
    }
    this.lbCount.setString(maxLevel + "/" + this.packageEntity.count);
    this.spBg.setSpriteFrame(cc.spriteFrameCache.getSpriteFrame(this.packageEntity.image));
    this.spCompleted.visible = false;
    this.spUnCompleted.visible = false;
    if (maxLevel === this.packageEntity.count) {
        this.spCompleted.visible = true;
    } else {
        this.spUnCompleted.visible = true;
    }
    if (this.packageEntity.isLocked()) {
        this.ndLock.visible = true;
        this.lbUnlockCount.setString(this.packageEntity.unlockCount);
    } else {
        this.ndLock.visible = false;
    }

    if (!game.local.isChinese()) {
        this.lbName.setScale(1.0);
    }
};

PackageItemController.prototype.getContentSize = function () {
    return this.spBg.getContentSize();
};

PackageItemController.createFromCCB = function() {
    return game.utils.loadNodeFromCCB("res/menu/package_item_view.ccbi", null, "PackageItemController", new PackageItemController());
};

module.exports = PackageItemController;
},{"../enum/LockStatus":161}],104:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */
var GameMan = require("../model/GameMan");
var EventsName = require("../events/EventsName");
var RemoveAdsController = require("./RemoveAdsController");

var PassCnController = function () {
    BaseCCBController.call(this);
    this._replayCallback = null;
    this._nextCallback = null;

    //this.spWinCn = null;
    //this.spWinEn = null;

    this.ndWheel = null;
    this.ndClaimDiamonds = null;
    this.ndDiamonds = null;
    this.lblDiamondReward = null;
    this.spRewardDiamonds = null;

    this.lblReward = null;
    this.lblMultiDiamonds = null;
    // this.lblWheel = null;

    this.spYellow1 = null;
    this.spYellow2 = null;
    this.spYellow3 = null;

    this.spBlack1 = null;
    this.spBlack2 = null;
    this.spBlack3 = null;

    this.ndRefresh = null;

    this.ndContinueB = null;
    this.ndContinueS = null;

    this.ndNormal = null;
    this.ndChallenge = null;

    this.lbChallenge = null;

    this.lblBaseReward = null;
    this.lblMulti = null;

    this.ndChallengeBtn = null;

    this.spYellows = [];

    this.spChallengeLines = [];
    this.spChallengeIcons = [];

    //this.spBlacks = [];
};

game.utils.inherits(PassCnController, BaseCCBController);

PassCnController.prototype.onExit = function () {
    this._replayCallback = null;
    this._nextCallback = null;
    cc.director.getScheduler().unscheduleCallbackForTarget(this, this.onUpdate);
    if (this.numberAnimation) {
        this.numberAnimation.destroy();
    }
    // game.eventDispatcher.removeEventListener("dialog_poped", this.onDialogPoped, this);
    // game.eventDispatcher.removeEventListener("dialog_closed", this.onDialogClosed, this);
    // this.removeNativeAd();
};

PassCnController.prototype.onEnter = function () {
    // game.eventDispatcher.addEventListener("dialog_poped", this.onDialogPoped, this);
    // game.eventDispatcher.addEventListener("dialog_closed", this.onDialogClosed, this);
    cc.director.getScheduler().scheduleCallbackForTarget(this, this.onUpdate, 0.05, cc.REPEAT_FOREVER, 0, false);
    if (game.adsManager.showTopBanner) {
        game.adsManager.removeBannerAds("top");
    }
};
//
// PassCnController.prototype.onDialogPoped = function () {
//     this.updateNativeAd();
// };
//
// PassCnController.prototype.onDialogClosed = function () {
//     this.updateNativeAd();
// };
//
// PassCnController.prototype.updateNativeAd = function () {
//     if (game.dialogManager.isTopestDialog(this.rootNode)) {
//         this.showNativeAd();
//     } else {
//         this.removeNativeAd();
//     }
// };
//
// PassCnController.prototype.showNativeAd = function () {
//     game.adsManager.showNativeAd("pass", 0, 0);
// };
//
// PassCnController.prototype.removeNativeAd = function () {
//     game.adsManager.removeNativeAd("pass");
// };

PassCnController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);

    // this.lblReward.setString(_("watch_ads_get_boosts"));
    // this.lblWheel.setString(_("lucky_wheel_title"));

    if (!game.gameMan.isChallengeLevel) {

        this.spYellows = [this.spYellow1, this.spYellow2, this.spYellow3];

        var star = GameMan.getInstance().currentStar;
        for (var i = 0; i < 3; ++i) {
            this.spYellows[i].visible = (star >= i + 1);
        }

        for (i = 0; i < star; ++i) {
            setTimeout(function (index) {
                return function () {
                    game.audioPlayer.playEffectByKey("star_" + (index + 1));
                    game.audioPlayer.vibrateShort();
                };
            }(i), 250 * (i + 1));
        }

        this.ndClaimDiamonds.visible = true;
        if (game.gameMan.getCurrentRewardDiamonds() > 0) {
            this.lblBaseReward.setString("+" + game.gameMan.getCurrentRewardDiamonds());
            this.lblDiamondReward.setString("+" + game.gameMan.getCurrentRewardDiamonds());
            // setTimeout(this.doClaimDiamonds.bind(this), 900);
        } else {
            this.ndClaimDiamonds.visible = false;
        }

        setTimeout(this.doAddActivityTask.bind(this), 600);

        this.lblMulti.setString(game.utils.sprintf(_("multi_claim_title"),
            game.config.multiClaimRange[0],
            game.config.multiClaimRange[1]));

        if (game.challengeMan.isAllChallengeUnlocked()) {
            this.ndChallengeBtn.visible = true;
        } else {
            this.ndChallengeBtn.visible = false;
        }
    } else {
        this.ndChallengeBtn.visible = false;
        game.audioPlayer.playEffectByKey("challenge_success");
        this.spChallengeLines = [this.spLine1, this.spLine2, this.spLine3, this.spLine4];
        this.spChallengeIcons = [this.spLevel1, this.spLevel2, this.spLevel3, this.spLevel4];

        var level = (game.challengeMan.getChallengeLevel() - 2) % 5;

        for (var i = 0; i < this.spChallengeIcons.length; ++i) {
            var icon = this.spChallengeIcons[i];
            var line = this.spChallengeLines[i];
            if (i <= level) {
                icon.setSpriteFrame("icon_completed_3.png");
            } else {
                icon.setSpriteFrame("icon_locked_3.png");

            }
            if (i < level) {
                line && line.setSpriteFrame("icon_line_yellow.png");
            } else {
                line && line.setSpriteFrame("icon_line_white.png");
            }
        }

        game.utils.playCCBAnimation(this.rootNode, "challenge");

        this.lblMultiDiamonds.setString(game.utils.sprintf(_("multi_diamonds_title"),
            game.config.multiDiamondsRange[0],
            game.config.multiDiamondsRange[1]));
    }

    if (!game.utils.isPad()) {
        var node = RemoveAdsController.createFromCCB();
        this.rootNode.addChild(node);
        if (game.utils.isIOSNotchScreen()) {
            node.y += 40;
        }
    }

    this.ndNormal.visible = false;
    this.ndChallenge.visible = false;
    if (game.gameMan.isChallengeLevel) {
        this.ndChallenge.visible = true;
        this.lbChallenge.setString(game.utils.sprintf(_("challenge_title"), game.gameMan.levelId - 1));
    } else {
        this.ndNormal.visible = true;
    }

    var RewardRemoveAdController = require("./RewardRemoveAdController");
    this.ndRewardRemoveAds.addChild(RewardRemoveAdController.createFromCCB());

    var DailyTaskPos = require("../enum/DailyTaskPos");
    this.ndActivity.controller.initWith(DailyTaskPos.PassCn);
};

PassCnController.prototype.doAddActivityTask = function () {
    if (!game.gameMan.isHardMode()) {
        game.activityMan.addActivityTaskCount(game.activityTaskType.Level);
    }
};

PassCnController.prototype.activityClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.analyseManager.trackEvent("DailyTaskPassClick");
    game.popupMan.popupActivityTask();
};

PassCnController.prototype.doClaimDiamonds = function (rewardDiamonds, endCallback) {
    if (this.claiming)
    {
        return;
    }
    this.claiming = true;

    //game.audioPlayer.playEffectByKey("coins_fly");
    var diamondPos = this.spRewardDiamonds.parent.convertToWorldSpace(this.spRewardDiamonds.getPosition());
    var diamndEndPos = this.ndDiamonds.parent.convertToWorldSpace(this.ndDiamonds.getPosition());
    game.effectMan.playFlyCoins(diamondPos, diamndEndPos, 10, 800, function () {
        game.playerMan.addDiamonds(rewardDiamonds, "pass_level");
    }, function () {
        //this.ndClaimDiamonds.runAction(cc.sequence(cc.delayTime(1), cc.fadeOut(0.3)));
        endCallback && endCallback();
    }.bind(this));
};

PassCnController.prototype.initWith = function (replayCallback, nextCallback) {
    this._replayCallback = replayCallback;
    this._nextCallback = nextCallback;
};

PassCnController.prototype.onAnimEnd = function () {
    if (!game.challengeMan.checkAndShowChallenge()) {
        if (!game.gameMan.checkAndShowBox()) {
            var showedRate = GameMan.getInstance().showRate();
            if (!showedRate) {
                if (!game.gameMan.tryShowPassPopup()) {
                    game.adsHelper.showPassAds();
                }
            }
        }
    }
};

PassCnController.prototype.onUpdateDiamonds = function () {
    this.lbDiamonds.setString(game.playerMan.getDiamonds());
};

PassCnController.prototype.onUpdate = function (dt) {
    if (this.numberAnimation) {
        this.numberAnimation.update(dt);
    }
};

PassCnController.prototype.nextClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    this.showClaimDiamondsAndEnterNextLevel(game.gameMan.getCurrentRewardDiamonds());
};

PassCnController.prototype.challengeNextClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    if (this._nextCallback) {
        this._nextCallback();
    }
    this.close();
};

PassCnController.prototype.pkClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    game.sceneMan.switchScene(game.sceneType.CHALLENGE_LIST);
};

PassCnController.prototype.skinClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    var StoreType = require("../enum/StoreType");
    game.popupMan.popupStoreDlg(StoreType.SKIN);
};

PassCnController.prototype.showClaimDiamondsAndEnterNextLevel = function (diamonds) {
    this.doClaimDiamonds(diamonds, function () {
        if (this._nextCallback) {
            this._nextCallback();
        }
        if (!game.gameMan.isChallengeLevel) {
            game.adsHelper.showPassAds();
            GameMan.getInstance().showRegisterNotification();
        }
        this.close();
    }.bind(this));
};

// PassCnController.prototype.restartClicked = function (sender) {
//     game.audioPlayer.playEffectByKey("enter");
//     game.adsHelper.showPassAds();
//     if (this._replayCallback) {
//         this._replayCallback();
//     }
//     this.close();
// };

PassCnController.prototype.homeClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    if (game.gameMan.isChallengeLevel) {
        game.sceneMan.switchScene(game.sceneType.CHALLENGE);
    } else {
        game.sceneMan.switchScene(game.sceneType.MENU);
    }
    game.adsHelper.showBackHomeAds();
};

PassCnController.prototype.watchAdsMultiClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    var winMulti = game.gameMan.getPassWinMulti();
    var StoreHelper = require("../model/StoreHelper");
    var self = this;
    StoreHelper.getInstance().checkAndShowRewardVideo("win_multi", function (watched) {
        if (watched) {
            game.popupMan.popupLuckySpin(winMulti, game.config.multiClaimRange, function () {
                self.onGetWinMultiDiamonds(winMulti);
            });
        }
    });
};

PassCnController.prototype.watchAdsMultiDiamondsClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    var StoreHelper = require("../model/StoreHelper");
    StoreHelper.getInstance().checkAndGetRandomDiamonds("diamonds_random_pause");
};

PassCnController.prototype.onGetWinMultiDiamonds = function (multi) {
    var NumberAnimation = require("../../common/entity/NumberAnimation");
    this.numberAnimation = new NumberAnimation(this.lblDiamondReward, "+");
    var self = this;
    this.numberAnimation.playNumAnim(game.gameMan.getCurrentRewardDiamonds(), game.gameMan.getCurrentRewardDiamonds() * multi, function () {
        self.showClaimDiamondsAndEnterNextLevel(game.gameMan.getCurrentRewardDiamonds() * multi);
    });
};

// PassCnController.prototype.wheelClicked = function (sender) {
//     AudioHelper.playBtnSound();
//     game.analyseManager.trackEvent("PassWheel");
//     var WheelType = require("../enum/WheelType");
//     game.popupMan.popupWheelDlg(WheelType.DailyBonus);
// };

PassCnController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode);
};

PassCnController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

PassCnController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/pass_view_1.ccbi", null, "PassCnController", new PassCnController());
    return node;
};

module.exports = PassCnController;
},{"../../common/entity/NumberAnimation":9,"../enum/DailyTaskPos":156,"../enum/StoreType":167,"../events/EventsName":169,"../model/GameMan":173,"../model/StoreHelper":178,"./RemoveAdsController":109,"./RewardRemoveAdController":116}],105:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */
var GameMan = require("../model/GameMan");
var EventsName = require("../events/EventsName");
var RemoveAdsController = require("./RemoveAdsController");

var PassController = function () {
    BaseCCBController.call(this);
    this._replayCallback = null;
    this._nextCallback = null;

    //this.spWinCn = null;
    //this.spWinEn = null;

    this.ndWheel = null;
    this.ndClaimDiamonds = null;
    this.ndDiamonds = null;
    this.lblDiamondReward = null;
    this.spRewardDiamonds = null;

    this.lblReward = null;
    // this.lblWheel = null;

    this.spYellow1 = null;
    this.spYellow2 = null;
    this.spYellow3 = null;

    this.spBlack1 = null;
    this.spBlack2 = null;
    this.spBlack3 = null;

    this.ndRefresh = null;

    // this.ndContinueB = null;
    // this.ndContinueS = null;

    this.ndStar = null;
    this.ndChallenge = null;

    this.lbChallenge = null;

    this.spYellows = [];

    this.spChallengeLines = [];
    this.spChallengeIcons = [];

    this.ndFreeDiamondShort = null;
    this.ndFreeDiamondLong = null;

    // this.skinMask = null;
    this.ndSkin = null;
    this.spSkin = null;
    this.spTopSkin = null;
    this.lblProgress = null;
    // this.spSkin2 = null;

    //this.spBlacks = [];

    this.claiming = false;
};

game.utils.inherits(PassController, BaseCCBController);

PassController.prototype.onExit = function () {
    this._replayCallback = null;
    this._nextCallback = null;
};

PassController.prototype.onEnter = function () {
    if (game.adsManager.showTopBanner) {
        game.adsManager.removeBannerAds("top");
    }
};

PassController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);

    this.lblReward.setString(_("watch_ads_get_boosts"));
    // this.lblWheel.setString(_("lucky_wheel_title"));

    if (!game.gameMan.isChallengeLevel) {

        this.spYellows = [this.spYellow1, this.spYellow2, this.spYellow3];

        var star = GameMan.getInstance().currentStar;
        for (var i = 0; i < 3; ++i) {
            this.spYellows[i].visible = (star >= i + 1);
        }

        for (i = 0; i < star; ++i) {
            setTimeout(function (index) {
                return function () {
                    game.audioPlayer.playEffectByKey("star_" + (index + 1));
                    game.audioPlayer.vibrateShort();
                };
            }(i), 250 * (i + 1));
        }

        if (game.gameMan.getCurrentRewardDiamonds() > 0) {
            this.ndClaimDiamonds.visible = true;
            this.lblDiamondReward.setString(game.gameMan.getCurrentRewardDiamonds());
            if (!game.gameMan.isNewPopup()) {
                setTimeout(this.doClaimDiamonds.bind(this), 900);
            }
        } else {
            this.ndClaimDiamonds.visible = false;
        }

        setTimeout(this.doAddActivityTask.bind(this), 1000);

        if (game.gameMan.isNewPopup()) {
            this.ndSkin.visible = true;
            var skinId = game.gameMan.getOrGenerateSkinId();
            if (skinId > 0) {
                var skinCfg = game.configMan.getSkinCfg(skinId);
                var spriteFrame = cc.spriteFrameCache.getSpriteFrame(skinCfg.image + "_l.png");
                if (spriteFrame != null) {
                    this.spSkin.setSpriteFrame(spriteFrame);
                    this.spTopSkin.setSpriteFrame(spriteFrame);
                }
                this.updateSkinProgress(0.3);
            }
            else {
                this.ndSkin.visible = false;
            }
        }
        else {
            this.ndSkin.visible = false;
        }

    } else {
        game.audioPlayer.playEffectByKey("challenge_success");
        this.spChallengeLines = [this.spLine1, this.spLine2, this.spLine3, this.spLine4];
        this.spChallengeIcons = [this.spLevel1, this.spLevel2, this.spLevel3, this.spLevel4];

        var level = (game.challengeMan.getChallengeLevel() - 2) % 5;

        for (var i = 0; i < this.spChallengeIcons.length; ++i) {
            var icon = this.spChallengeIcons[i];
            var line = this.spChallengeLines[i];
            if (i <= level) {
                icon.setSpriteFrame("icon_completed_3.png");
            } else {
                icon.setSpriteFrame("icon_locked_3.png");

            }
            if (i < level) {
                line && line.setSpriteFrame("icon_line_yellow.png");
            } else {
                line && line.setSpriteFrame("icon_line_white.png");
            }
        }

        game.utils.playCCBAnimation(this.rootNode, "challenge");
        this.ndSkin.visible = false;
    }

    if (!game.utils.isPad()) {
        var node = RemoveAdsController.createFromCCB();
        this.rootNode.addChild(node);
        if (game.utils.isIOSNotchScreen()) {
            node.y += 40;
        }
    }

    if (game.gameMan.isChallengeLevel) {
        this.ndRefresh.visible = false;
        this.ndContinueB.visible = true;
        this.ndContinueS.visible = false;
        this.ndStar.visible = false;
        this.ndClaimDiamonds.visible = false;
        this.ndChallenge.visible = true;
        this.lbChallenge.setString(game.utils.sprintf(_("challenge_title"), game.gameMan.levelId - 1));
    } else {
        this.ndRefresh.visible = true;
        this.ndContinueB.visible = false;
        this.ndContinueS.visible = true;
        this.ndStar.visible = true;
        this.ndChallenge.visible = false;
    }

    var DailyTaskPos = require("../enum/DailyTaskPos");
    this.ndActivity.controller.initWith(DailyTaskPos.PassEn);

    this.ndFreeDiamondShort.visible = false;
    this.ndFreeDiamondLong.visible = false;
    if (game.activityMan.isOpen()) {
        this.ndFreeDiamondShort.visible = true;
    } else {
        this.ndFreeDiamondLong.visible = true;
    }
};

PassController.prototype.updateSkinProgress = function (percent) {
    var lastPercent = game.playerMan.player.skinPercent;
    var nowPercent = Math.min(lastPercent + percent, 1);
    // var numAnim = lblProgress.GetComponent<NumberAnimation>();
    // numAnim.Init("", "%");
    this.spTopSkin = game.utils.createProgressTimer(this.spTopSkin, false, false);
    this.spTopSkin.setPercentage(lastPercent * 100);
    this.spTopSkin.runAction(cc.progressTo(0.8, nowPercent * 100));
    this.lblProgress.setString("" + Math.round(nowPercent * 100) + "%");
    // numAnim.PlayNumAnim((int)(lastPercent * 100), (int)(nowPercent * 100), () => {});
    game.playerMan.setSkinPercent(nowPercent);
};

PassController.prototype.doAddActivityTask = function () {
    if (!game.gameMan.isHardMode()) {
        game.activityMan.addActivityTaskCount(game.activityTaskType.Level);
    }
};

PassController.prototype.activityClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.analyseManager.trackEvent("DailyTaskPassClick");
    game.popupMan.popupActivityTask();
};

PassController.prototype.doClaimDiamonds = function (cb) {
    //game.audioPlayer.playEffectByKey("coins_fly");
    var diamondPos = this.spRewardDiamonds.parent.convertToWorldSpace(this.spRewardDiamonds.getPosition());
    var diamndEndPos = this.ndDiamonds.parent.convertToWorldSpace(this.ndDiamonds.getPosition());
    game.effectMan.playFlyCoins(diamondPos, diamndEndPos, 10, 500, function () {
        game.playerMan.addDiamonds(game.gameMan.getCurrentRewardDiamonds(), "pass_level");
    }, function () {
        //this.ndClaimDiamonds.runAction(cc.sequence(cc.delayTime(1), cc.fadeOut(0.3)));
        cb && cb();
    }.bind(this));
};

PassController.prototype.initWith = function (replayCallback, nextCallback) {
    this._replayCallback = replayCallback;
    this._nextCallback = nextCallback;
};

PassController.prototype.onAnimEnd = function () {
    return;
    if (!game.gameMan.isNewPopup()) {
        if (!game.challengeMan.checkAndShowChallenge()) {
            if (!game.gameMan.checkAndShowBox()) {
                var showedRate = GameMan.getInstance().showRate();
                if (!showedRate) {
                    if (!game.gameMan.tryShowPassPopup()) {
                        if (!game.gameMan.isNewResult()) {
                            game.adsHelper.showPassAds();
                        }
                    }
                }
            }
        }
    } else {
        if (!game.gameMan.isNewResult()) {
            var showedRate = GameMan.getInstance().showRate();
            if (!showedRate) {
                game.adsHelper.showPassAds();
            }
        }
        else {
            GameMan.getInstance().showRate();
        }
    }
};

PassController.prototype.onUpdateDiamonds = function () {
    this.lbDiamonds.setString(game.playerMan.getDiamonds());
};

PassController.prototype.nextClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    if (game.gameMan.isNewPopup() && !game.gameMan.isChallengeLevel) {
        if (this.claiming) {
            return;
        }
        this.claiming = true;
        this.doClaimDiamonds(this.afterClaimDiamond.bind(this));
    }
    else {
        if (this._nextCallback) {
            this._nextCallback();
        }
        if (!game.gameMan.isChallengeLevel) {
            game.adsHelper.showPassAds();
            GameMan.getInstance().showRegisterNotification();
        }
        this.close();
    }
};

PassController.prototype.afterClaimDiamond = function () {
    var self = this;
    if (game.playerMan.player.skinPercent >= 1) {
        game.popupMan.popupSkinUnlock(function () {
            game.playerMan.setSkinPercent(0);
            game.playerMan.setWaitSkinId(0);
            self.afterGetSkin();
        });
    }
    else {
        self.afterGetSkin();
    }
};

PassController.prototype.afterGetSkin = function () {
    game.challengeMan.checkAndShowChallenge(null, this.afterCheckChallenge.bind(this));
};

PassController.prototype.afterCheckChallenge = function () {
    if (game.playerMan.player.currentKeyCount >= 3) {
        game.popupMan.popupBox(this.afterClaimBox.bind(this));
    }
    else {
        this.afterClaimBox();
    }
};

PassController.prototype.afterClaimBox = function () {
    if (this._nextCallback) {
        this._nextCallback();
    }
    this.close();
};

PassController.prototype.restartClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    game.adsHelper.showPassAds();
    if (this._replayCallback) {
        this._replayCallback();
    }
    this.close();
};

PassController.prototype.homeClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    if (game.gameMan.isChallengeLevel) {
        game.sceneMan.switchScene(game.sceneType.CHALLENGE);
    } else {
        game.sceneMan.switchScene(game.sceneType.MENU);
    }
    game.adsHelper.showBackHomeAds();
};

PassController.prototype.pkClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    game.sceneMan.switchScene(game.sceneType.CHALLENGE_LIST);
};

PassController.prototype.skinClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    var StoreType = require("../enum/StoreType");
    game.popupMan.popupStoreDlg(StoreType.SKIN);
};

PassController.prototype.watchAdsClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    game.analyseManager.trackEvent("PassFreeDiamonds");
    var StoreHelper = require("../model/StoreHelper");
    StoreHelper.getInstance().checkAndShowRewardVideo(game.utils.isIOS() ? "wingift" : "jili05", null, "WinAndWatchDiamondsAds");
};

PassController.prototype.wheelClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.analyseManager.trackEvent("PassWheel");
    var WheelType = require("../enum/WheelType");
    game.popupMan.popupWheelDlg(WheelType.DailyBonus);
};

PassController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode);
};

PassController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

PassController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/pass_view.ccbi", null, "PassController", new PassController());
    return node;
};

module.exports = PassController;
},{"../enum/DailyTaskPos":156,"../enum/StoreType":167,"../enum/WheelType":168,"../events/EventsName":169,"../model/GameMan":173,"../model/StoreHelper":178,"./RemoveAdsController":109}],106:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */
var AdsPlace = require("../../common/enum/AdsPlace");
var DiamondsController = require("../controller/DiamondsController");
var AdsReminderController = require("../controller/AdsReminderController");

var PauseCnController = function () {
    BaseCCBController.call(this);
    // this.lblReward = null;

    // this.ndAdReminder = null;
    this.ndDiamonds = null;

    this.ndRefresh = null;

    this.ndContinueB = null;
    this.ndContinueS = null;

    this.lblMulti = null;

    this._replayCallback = null;
    this._nextCallback = null;
};

game.utils.inherits(PauseCnController, BaseCCBController);

PauseCnController.prototype.onExit = function () {
    this._resumeCallback = null;
    // game.eventDispatcher.removeEventListener("dialog_poped", this.onDialogPoped, this);
    // game.eventDispatcher.removeEventListener("dialog_closed", this.onDialogClosed, this);
    // this.removeNativeAd();
};

PauseCnController.prototype.onEnter = function () {
    // game.eventDispatcher.addEventListener("dialog_poped", this.onDialogPoped, this);
    // game.eventDispatcher.addEventListener("dialog_closed", this.onDialogClosed, this);
    //this.showNativeAd();
};
//
// PauseCnController.prototype.onDialogPoped = function () {
//     this.updateNativeAd();
// };
//
// PauseCnController.prototype.onDialogClosed = function () {
//     this.updateNativeAd();
// };
//
// PauseCnController.prototype.updateNativeAd = function () {
//     if (game.dialogManager.isTopestDialog(this.rootNode)) {
//         this.showNativeAd();
//     } else {
//         this.removeNativeAd();
//     }
// };
//
// PauseCnController.prototype.showNativeAd = function () {
//     game.adsManager.showNativeAd("pause", 0, 99);
//     // game.crossPromMan.showCrossPromAd(cc.p(cc.winSize.width * 0.5, cc.winSize.height * 0.5 + 99), cc.size(300, 300));
// };
//
// PauseCnController.prototype.removeNativeAd = function () {
//     game.adsManager.removeNativeAd("pause");
//     // game.crossPromMan.removeCrossPromAd();
// };

PauseCnController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    // this.lblReward.setString(_("watch_ads_get_boosts"));
    // this.ndAdReminder.addChild(AdsReminderController.createFromCCB());
    this.ndDiamonds.addChild(DiamondsController.createFromCCB());

    this.lblMulti.setString(game.utils.sprintf(_("multi_diamonds_title"),
        game.config.multiDiamondsRange[0],
        game.config.multiDiamondsRange[1]));

    if (game.gameMan.isChallengeLevel) {
        this.ndRefresh.visible = false;
        this.ndContinueB.visible = true;
        this.ndContinueS.visible = false;
    } else {
        this.ndRefresh.visible = true;
        this.ndContinueB.visible = false;
        this.ndContinueS.visible = true;
    }
    var RewardRemoveAdController = require("./RewardRemoveAdController");
    this.ndRewardRemoveAds.addChild(RewardRemoveAdController.createFromCCB());
};

PauseCnController.prototype.initWith = function (resumeCallback) {
    this._resumeCallback = resumeCallback;
};

PauseCnController.prototype.resumeClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    if (this._resumeCallback) {
        this._resumeCallback();
    }
    this.close();
};

PauseCnController.prototype.homeClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    game.analyseManager.trackEvent("PauseHome");
    if (game.gameMan.isChallengeLevel) {
        game.popupMan.popupYesNoCommonDlg(_("challenge_leave_tips"), _("yes_title"), _("no_title"), function () {
            game.adsHelper.showBackHomeAds();
            game.challengeMan.rollBackProgress();
            game.sceneMan.switchScene(game.sceneType.CHALLENGE);
        });
    } else {
        game.popupMan.popupYesNoCommonDlg(_("exit_game_confirm"), _("yes_title"), _("no_title"), function () {
            game.adsHelper.showBackHomeAds();
            game.sceneMan.switchScene(game.sceneType.MENU);
        });
    }
};

PauseCnController.prototype.restartClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    game.gameMan.addFailCount();
    game.sceneMan.switchScene(game.sceneType.GAME);
    game.adsHelper.showRefreshAds();
    game.analyseManager.trackEvent("PauseRetry");
};

PauseCnController.prototype.watchAdsMultiClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    var StoreHelper = require("../model/StoreHelper");
    StoreHelper.getInstance().checkAndGetRandomDiamonds("diamonds_random_pause");
};

PauseCnController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode);
};

PauseCnController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

PauseCnController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/pause_view_1.ccbi", null, "PauseCnController", new PauseCnController());
    return node;
};

module.exports = PauseCnController;
},{"../../common/enum/AdsPlace":13,"../controller/AdsReminderController":67,"../controller/DiamondsController":87,"../model/StoreHelper":178,"./RewardRemoveAdController":116}],107:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */
var AdsPlace = require("../../common/enum/AdsPlace");
var DiamondsController = require("../controller/DiamondsController");
var AdsReminderController = require("../controller/AdsReminderController");

var PauseController = function () {
    BaseCCBController.call(this);
    this.lblReward = null;

    this.ndAdReminder = null;
    this.ndDiamonds = null;

    this.ndRefresh = null;

    this.ndContinueB = null;
    this.ndContinueS = null;

    this._replayCallback = null;
    this._nextCallback = null;
};

game.utils.inherits(PauseController, BaseCCBController);

PauseController.prototype.onExit = function () {
    this._resumeCallback = null;
};

PauseController.prototype.onEnter = function () {
};

PauseController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.lblReward.setString(_("watch_ads_get_boosts"));
    this.ndAdReminder.addChild(AdsReminderController.createFromCCB());
    this.ndDiamonds.addChild(DiamondsController.createFromCCB());

    if (game.gameMan.isChallengeLevel) {
        this.ndRefresh.visible = false;
        this.ndContinueB.visible = true;
        this.ndContinueS.visible = false;
    } else {
        this.ndRefresh.visible = true;
        this.ndContinueB.visible = false;
        this.ndContinueS.visible = true;
    }
};

PauseController.prototype.initWith = function (resumeCallback) {
    this._resumeCallback = resumeCallback;
};

PauseController.prototype.resumeClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    if (this._resumeCallback) {
        this._resumeCallback();
    }
    this.close();
};

PauseController.prototype.homeClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    game.analyseManager.trackEvent("PauseHome");
    if (game.gameMan.isChallengeLevel) {
        game.popupMan.popupYesNoCommonDlg(_("challenge_leave_tips"), _("yes_title"), _("no_title"), function () {
            game.adsHelper.showBackHomeAds();
            game.challengeMan.rollBackProgress();
            game.sceneMan.switchScene(game.sceneType.CHALLENGE);
        });
    } else {
        game.popupMan.popupYesNoCommonDlg(_("exit_game_confirm"), _("yes_title"), _("no_title"), function () {
            game.adsHelper.showBackHomeAds();
            game.sceneMan.switchScene(game.sceneType.MENU);
        });
    }
};

PauseController.prototype.restartClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    game.gameMan.addFailCount();
    game.sceneMan.switchScene(game.sceneType.GAME);
    game.adsHelper.showRefreshAds();
    game.analyseManager.trackEvent("PauseRetry");
};

PauseController.prototype.watchAdsClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    var StoreHelper = require("../model/StoreHelper");
    StoreHelper.getInstance().checkAndShowRewardVideo(game.utils.isIOS() ? "pause" : "pause");
};

PauseController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode);
};

PauseController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

PauseController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/pause_view.ccbi", null, "PauseController", new PauseController());
    return node;
};

module.exports = PauseController;
},{"../../common/enum/AdsPlace":13,"../controller/AdsReminderController":67,"../controller/DiamondsController":87,"../model/StoreHelper":178}],108:[function(require,module,exports){
//var SkinItemController = require("./SkinItemController");
//var ConfigMan = require("../config/ConfigMan");
//var EventsName = require("../events/EventsName");
//
//var GRID_SIZE = cc.size(350, 500);
//
//var StoreItemCellView = cc.TableViewCell.extend({
//    entity: null,
//    itemNode: null,
//    ctor: function () {
//        this._super();
//        this.itemNode = SkinItemController.createFromCCB();
//        this.addChild(this.itemNode);
//        this.itemNode.setPosition(cc.p(GRID_SIZE.width * 0.5, GRID_SIZE.height * 0.5));
//    },
//
//    initWith: function (entity, idx, inited) {
//        this.entity = entity;
//        this.itemNode.controller.initWith(entity, idx);
//    }
//});
var RankType = require("../enum/RankType");

var RankController = function () {
    BaseCCBController.call(this);
    this.ndContainer = null;
    this.lblTitle = null;

    this.rankType = 0;

    this.updateCount = 0;
};

game.utils.inherits(RankController, BaseCCBController);

RankController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
    //this.rootNode.schedule(this.onUpdate.bind(this));
    this.intervalKey = setInterval(this.onUpdate.bind(this), 500);
};

RankController.prototype.onExit = function () {
    //this.rootNode.unschedule(this.onUpdate.bind(this));
    clearInterval(this.intervalKey);
    if (this.closeCallback) {
        this.closeCallback();
    }
    this.closeCallback = null;
    BaseCCBController.prototype.onExit.call(this);
};

RankController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    ////onewx.social.loadShareCanvas(this.ndContainer);
    //this.onUpdate(0);
};

RankController.prototype.init = function (rankType, closeCallback) {
    this.rankType = rankType;
    this.closeCallback = closeCallback;
    if (rankType === RankType.Friends) {
        this.lblTitle.setString(game.local.getValue("friends_rank_title"));
    } else {
        this.lblTitle.setString(game.local.getValue("group_rank_title"));
    }
    if (this.rankType === RankType.Friends) {
        onewx.social.initFriend();
    } else {
        onewx.social.initGroup();
    }
    this.refreshRank();
};

RankController.prototype.refreshRank = function () {
    this.updateCount = 0;
    this.onUpdate(0);
};

RankController.prototype.onUpdate = function () {
    if (this.updateCount <= 10) {
        onewx.social.loadShareCanvas(this.ndContainer);
        this.updateCount++;
    }
};

RankController.prototype.prevClicked = function (sender) {
    AudioHelper.playBtnSound();
    onewx.social.onPageChange(this.ndContainer, -1);
    this.refreshRank();
};

RankController.prototype.nextClicked = function (sender) {
    AudioHelper.playBtnSound();
    onewx.social.onPageChange(this.ndContainer, 1);
    this.refreshRank();
};

RankController.prototype.backClicked = function (sender) {
    AudioHelper.playBtnSound();

    this.close();
};

RankController.prototype.challengeClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.sceneMan.switchScene(game.sceneType.GAME);
};

RankController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode);
};

RankController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

RankController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/rank_view.ccbi", null, "RankController", new RankController());
    return node;
};

module.exports = RankController;
},{"../enum/RankType":162}],109:[function(require,module,exports){
var EventsName = require("../events/EventsName");

var RemoveAdsController = function () {
    BaseCCBController.call(this);
};

game.utils.inherits(RemoveAdsController, BaseCCBController);

RemoveAdsController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.rootNode.visible = false;
};

RemoveAdsController.prototype.removeAdsClicked = function () {
    AudioHelper.playBtnSound();
    var StoreType = require("../enum/StoreType");
    var StoreHelper = require("../model/StoreHelper");
    var removeAdEntity = StoreHelper.getInstance().getStoreEntityByType(StoreType.REMOVE_ADS);
    StoreHelper.getInstance().buyProduct(removeAdEntity);
};

RemoveAdsController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/remove_ads_view.ccbi", null, "RemoveAdsController", new RemoveAdsController(), true);
    return node;
};

module.exports = RemoveAdsController;
},{"../enum/StoreType":167,"../events/EventsName":169,"../model/StoreHelper":178}],110:[function(require,module,exports){
var StoreHelper = require("../model/StoreHelper");

var RewardDoubleController = function () {
    BaseCCBController.call(this);

    this._titleLabel = null;

    this.lbReward = null;
    this.spReward = null;
    this.spRewardBg = null;

    //this.btnCloseCn = null;
    //this.btnCloseEn = null;

    this.lbDouble = null;

    this.closeCallback = null;

    this.doubled = false;
    this.rewardName = "";
};

game.utils.inherits(RewardDoubleController, BaseCCBController);

RewardDoubleController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    //this.btnCloseCn.visible = false;
    //this.btnCloseEn.visible = false;
    //this.spTitleCn.visible = false;
    //this.spTitleEn.visible = false;
    //if (game.local.isChinese()) {
    //    this.btnCloseCn.visible = true;
    //    //this.spTitleCn.visible = true;
    //} else {
    //    this.btnCloseEn.visible = true;
    //    //this.spTitleEn.visible = true;
    //}
    this.lbDouble.setString(_("double_rewards"));

    game.audioPlayer.playEffectByKey("get_diamonds");
};

RewardDoubleController.prototype.init = function (image, count, rewardName, closeCallback) {
    console.log("RewardDoubleController.prototype.init");
    this.spReward.setSpriteFrame(image);
    this.lbReward.setString("X" + count);
    this.closeCallback = closeCallback;
    this.rewardName = rewardName;

    this.spRewardBg.runAction(cc.rotateBy(2, 360).repeatForever());
};

RewardDoubleController.prototype.closeClicked = function (sender) {
    AudioHelper.playBtnSound();
    this.close();
};

RewardDoubleController.prototype.watchAdsClicked = function (sender) {
    AudioHelper.playBtnSound();
    var self = this;
    StoreHelper.getInstance().checkAndShowRewardVideo(this.rewardName, function (rewarded) {
        if (rewarded) {
            self.doubled = true;
            self.close();
        }
    });
};

RewardDoubleController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {overlayOpacity: 210});
};

RewardDoubleController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
    if (this.closeCallback) {
        this.closeCallback(this.doubled);
        this.closeCallback = null;
    }
};

RewardDoubleController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/reward_double_view.ccbi", null, "RewardDoubleController", new RewardDoubleController());
    return node;
};

module.exports = RewardDoubleController;
},{"../model/StoreHelper":178}],111:[function(require,module,exports){
var Wheel = require("../../common/wheel/Wheel");
var ConfigMan = require("../config/ConfigMan");
var BoostType = require("../enum/BoostType");
var StoreHelper = require("../model/StoreHelper");
var GameMan = require("../model/GameMan");
var WheelType = require("../enum/WheelType");
var CardItemController = require("./CardItemController");
var RewardView = require("../view/RewardView");
var RewardItemController = require("./RewardItemController");

var RewardGetController = function () {
    BaseCCBController.call(this);
    this.ndReward = null;
};

game.utils.inherits(RewardGetController, BaseCCBController);

RewardGetController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
};

RewardGetController.prototype.onExit = function () {
    BaseCCBController.prototype.onExit.call(this);
    if (this.closeCallback) {
        this.closeCallback();
    }
};

RewardGetController.prototype.onDidLoadFromCCB = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    game.audioPlayer.playEffectByKey("get_diamonds");
};

RewardGetController.prototype.initWithRewards = function (rewards, closeCallback) {
    this.rewards = rewards;
    var view = new RewardView(rewards, 100, function () {
        return RewardItemController.createFromReceiveCCB();
    });
    this.ndReward.addChild(view);
    this.closeCallback = closeCallback;
};

RewardGetController.prototype.okClicked = function () {
    AudioHelper.playBtnSound();
    this.close();
};

RewardGetController.prototype.closeClicked = function () {
    AudioHelper.playBtnSound();
    this.close();
};

RewardGetController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {popupAnim: true});
};

RewardGetController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

RewardGetController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/activity/reward_get_view.ccbi", null, "RewardGetController", new RewardGetController());
    return node;
};

module.exports = RewardGetController;
},{"../../common/wheel/Wheel":39,"../config/ConfigMan":52,"../enum/BoostType":154,"../enum/WheelType":168,"../model/GameMan":173,"../model/StoreHelper":178,"../view/RewardView":187,"./CardItemController":77,"./RewardItemController":113}],112:[function(require,module,exports){
var StoreHelper = require("../model/StoreHelper");
var GameMan = require("../model/GameMan");
var BoostType = require("../enum/BoostType");

var RewardGiftController = function () {
    BaseCCBController.call(this);

    this.lbTitle = null;

    this.lbTips = null;
    this.lbButton = null;

    this.closeCallback = null;
};

game.utils.inherits(RewardGiftController, BaseCCBController);

RewardGiftController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.lbTitle.setString(_("gift_title"));
    this.lbTips.setString(_("gift_tips"));
    this.lbButton.setString(_("gift_button"));

    //this.lbTips.setAlignment(cc.TEXT_ALIGNMENT_CENTER);
};

RewardGiftController.prototype.init = function (closeCallback) {
    this.closeCallback = closeCallback;
};

RewardGiftController.prototype.closeClicked = function (sender) {
    AudioHelper.playBtnSound();
    this.close();
};

RewardGiftController.prototype.giftClicked = function (sender) {
    AudioHelper.playBtnSound();
    var self = this;
    var share = GameMan.getInstance().getShareConfig();
    game.shareManager.wxGroupShare(share, "gift_share", function (shared) {
        if (shared) {
            var splitCount = game.utils.randomNextIntInRange(2, 3);
            var threeBallCount = game.utils.randomNextIntInRange(2, 3);
            StoreHelper.getInstance().popupBoostRewardDlg(splitCount, threeBallCount, function () {
                self.close();
            });
        } else {
            game.utils.showWXToast("需要分享到群");
        }
    });
};

RewardGiftController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {overlayOpacity: 210});
};

RewardGiftController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
    if (this.closeCallback) {
        this.closeCallback();
        this.closeCallback = null;
    }
};

RewardGiftController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/reward_gift_view.ccbi", null, "RewardGiftController", new RewardGiftController());
    return node;
};

module.exports = RewardGiftController;
},{"../enum/BoostType":154,"../model/GameMan":173,"../model/StoreHelper":178}],113:[function(require,module,exports){


var RewardItemController = function () {
    BaseCCBController.call(this);
    this.sprReward = null;
    this.lbCount = null;
};

game.utils.inherits(RewardItemController, BaseCCBController);

RewardItemController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
};

RewardItemController.prototype.initReward = function (reward) {
    this.reward = reward;
    cc.log("reward.image:" + reward.image);
    game.utils.scaleSpriteFrame(this.sprReward, reward.image);
    // this.sprReward.setSpriteFrame(reward.image);
    this.lbCount.setString("x" + reward.count);
};

RewardItemController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/activity/reward_item_view.ccbi", null, "RewardItemController", new RewardItemController());
    return node;
};

RewardItemController.createFromReceiveCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/activity/reward_receive_view.ccbi", null, "RewardItemController", new RewardItemController());
    return node;
};

module.exports = RewardItemController;
},{}],114:[function(require,module,exports){


var RewardNoticeController = function () {
    BaseCCBController.call(this);
    this.ndReward1 = null;
    this.ndReward2 = null;

    this.spReward1 = null;
    this.lbReward1 = null;
    this.spReward2 = null;
    this.lbReward2 = null;

    this.spReward = null;
    this.lbReward = null;

    this.lblOk = null;

    this._okCallFunc = null;
};

game.utils.inherits(RewardNoticeController, BaseCCBController);

RewardNoticeController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.ndReward1.visible = false;
    this.ndReward2.visible = false;

    game.audioPlayer.playEffectByKey("get_diamonds");

    //this.spBg.runAction(cc.rotateBy(2, 360).repeatForever());
};

RewardNoticeController.prototype.initWithRewardYes = function (info, okCallFunc, reward1Sprite, reward1Count,
                                                      reward2Sprite, reward2Count) {
    var spriteFrame;
    if (reward1Sprite && reward2Sprite) {
        this.ndReward2.visible = true;
        //this.lbReward2Info.setString(info);
        //this.lbReward2Info.setAlignment(cc.TEXT_ALIGNMENT_CENTER);
        spriteFrame = cc.spriteFrameCache.getSpriteFrame(reward1Sprite);
        if (spriteFrame) {
            this.spReward1.setSpriteFrame(spriteFrame);
        }
        this.lbReward1.setString("x" + reward1Count);
        spriteFrame = cc.spriteFrameCache.getSpriteFrame(reward2Sprite);
        if (spriteFrame) {
            this.spReward2.setSpriteFrame(spriteFrame);
        }
        this.lbReward2.setString("x" + reward2Count);
    } else {
        this.ndReward1.visible = true;
        //this.lbRewardInfo.setString(info);
        //this.lbRewardInfo.setAlignment(cc.TEXT_ALIGNMENT_CENTER);
        spriteFrame = cc.spriteFrameCache.getSpriteFrame(reward1Sprite);
        if (spriteFrame) {
            this.spReward.setSpriteFrame(spriteFrame);
        }
        this.lbReward.setString("x" + reward1Count);
    }

    this.lblOk.setString(game.local.getValue("confirm_info"));
    this._okCallFunc = okCallFunc;
};

RewardNoticeController.prototype.okClicked = function (sender) {
    AudioHelper.playBtnSound();
    if (this._okCallFunc) {
        this._okCallFunc();
    }
    this.close();
};

RewardNoticeController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode);
};

RewardNoticeController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

RewardNoticeController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/reward_notice_view.ccbi", null, "RewardNoticeController", new RewardNoticeController());
    return node;
};

module.exports = RewardNoticeController;
},{}],115:[function(require,module,exports){
var RewardView = require("../view/RewardView");
var RewardItemController = require("../controller/RewardItemController");

var RewardPopupController = function () {
    BaseCCBController.call(this);
    this.ndReward = null;
};

game.utils.inherits(RewardPopupController, BaseCCBController);

RewardPopupController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
};

RewardPopupController.prototype.initRewards = function (rewards) {
    var view = new RewardView(rewards, 50, function () {
        return RewardItemController.createFromCCB();
    });
    this.ndReward.addChild(view);
};

RewardPopupController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/activity/reward_popup_view.ccbi", null, "RewardPopupController", new RewardPopupController());
    return node;
};

RewardPopupController.createAndPop = function (rewards, parent, pos) {
    var node = RewardPopupController.createFromCCB();
    node.controller.initRewards(rewards);
    parent.addChild(node);
    node.setPosition(pos);
    node.runAction(cc.sequence(cc.delayTime(3), cc.removeSelf()));
};

module.exports = RewardPopupController;
},{"../controller/RewardItemController":113,"../view/RewardView":187}],116:[function(require,module,exports){
var EventsName = require("../events/EventsName");

var RewardRemoveAdController = function () {
    BaseCCBController.call(this);

    this.spReminder = null;
    this.lbReminder = null;
};

game.utils.inherits(RewardRemoveAdController, BaseCCBController);

RewardRemoveAdController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
    game.eventDispatcher.addEventListener(EventsName.REWARD_REMOVE_AD, this.onUpdateReminder, this);
};

RewardRemoveAdController.prototype.onExit = function () {
    game.eventDispatcher.removeEventListener(EventsName.REWARD_REMOVE_AD, this.onUpdateReminder, this);
    BaseCCBController.prototype.onExit.call(this);
};

RewardRemoveAdController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.onUpdateReminder();
};

RewardRemoveAdController.prototype.onUpdateReminder = function () {
    this.rootNode.visible = false;

    if (game.adsManager.isRemovedAds()) {
        // this.rootNode.visible = false;
        return;
    }
    if (game.adsManager.isInterstitialDisabled()) {
        // this.rootNode.visible = false;
        return;
    }

    if (game.gameMan.getPlayerLevel() < game.adsManager.rewardRemoveAdsLevelLimit) {
        // this.rootNode.visible = false;
        return;
    }

    this.rootNode.visible = true;
};

RewardRemoveAdController.prototype.rewardRemoveAdsClicked = function (sender) {
    game.audioPlayer.playEffectByKey("enter");
    game.popupMan.popupRewardRemoveAds();
};

RewardRemoveAdController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/reward_remove_ads.ccbi", null, "RewardRemoveAdController", new RewardRemoveAdController(), true);
    return node;
};

module.exports = RewardRemoveAdController;
},{"../events/EventsName":169}],117:[function(require,module,exports){
var StoreHelper = require("../model/StoreHelper");

var RewardRemoveAdsController = function () {
    BaseCCBController.call(this);

    this.lbInfo = null;
    this.lbReward1 = null;
    this.lbReward2 = null;

    this.removed = false;
};

game.utils.inherits(RewardRemoveAdsController, BaseCCBController);

RewardRemoveAdsController.prototype.onExit = function () {
    BaseCCBController.prototype.onExit.call(this);
    if (this.closeCallback) {
        this.closeCallback(this.removed);
        this.closeCallback = null;
    }
};

RewardRemoveAdsController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.lbInfo.setString(game.utils.sprintf(_("reward_video_remove_ads"), game.config.rewardRemoveAdsCfg.timeInMinute));
    this.lbReward1.setString("x" + game.config.rewardRemoveAdsCfg.multi);
    this.lbReward2.setString("x" + game.config.rewardRemoveAdsCfg.add);
};

RewardRemoveAdsController.prototype.usingClicked = function () {
    AudioHelper.playBtnSound();
    var self = this;
    StoreHelper.getInstance().checkAndShowRewardVideo("reward_remove_ads", function (watched) {
        if (watched) {
            self.removed = true;
            self.close();
            game.adsManager.disableInterstitialWithTime(game.config.rewardRemoveAdsCfg.timeInMinute * 60);
            var EventsName = require("../events/EventsName");
            game.eventDispatcher.dispatchEvent(EventsName.REWARD_REMOVE_AD);
            StoreHelper.getInstance().popupBoostRewardDlg(game.config.rewardRemoveAdsCfg.multi, game.config.rewardRemoveAdsCfg.add);
        }
    });
};

RewardRemoveAdsController.prototype.closeClicked = function () {
    AudioHelper.playBtnSound();
    this.close();
};

RewardRemoveAdsController.prototype.initWith = function (callback) {
    this.closeCallback = callback;
};

RewardRemoveAdsController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {popupAnim: true});
};

RewardRemoveAdsController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

RewardRemoveAdsController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/notice_view_ad.ccbi", null, "RewardRemoveAdsController", new RewardRemoveAdsController());
    return node;
};

module.exports = RewardRemoveAdsController;
},{"../events/EventsName":169,"../model/StoreHelper":178}],118:[function(require,module,exports){
var StoreHelper = require("../model/StoreHelper");

var RewardVideoController = function () {
    BaseCCBController.call(this);

    this._titleLabel = null;

    this.spReward1 = null;
    this.lbReward1 = null;
    this.spReward2 = null;
    this.lbReward2 = null;
    this.lbReward2Info = null;
    this.lblFree = null;

    this.closeCallback = null;
};

game.utils.inherits(RewardVideoController, BaseCCBController);

RewardVideoController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.lbReward1.setString("X1");
    this.lbReward2.setString("X1");
    this.lbReward2Info.setString(game.local.getValue("watch_ads_tips"));
    this._titleLabel.setString(game.local.getValue("watch_ads_title"));
    this.lblFree.setString(_("free_coins_title"));
};

RewardVideoController.prototype.init = function (closeCallback) {
    this.closeCallback = closeCallback;
};

RewardVideoController.prototype.closeClicked = function (sender) {
    AudioHelper.playBtnSound();
    this.close();
};

RewardVideoController.prototype.watchAdsClicked = function (sender) {
    AudioHelper.playBtnSound();
    StoreHelper.getInstance().checkAndShowRewardVideo(game.utils.isIOS() ? "jili03-IOS" : "jili03");
};

RewardVideoController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode);
};

RewardVideoController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
    if (this.closeCallback) {
        this.closeCallback();
        this.closeCallback = null;
    }
};

RewardVideoController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/reward_video_view.ccbi", null, "RewardVideoController", new RewardVideoController());
    return node;
};

module.exports = RewardVideoController;
},{"../model/StoreHelper":178}],119:[function(require,module,exports){
var SkinItemController = require("./SkinItemController");
var ConfigMan = require("../config/ConfigMan");
var EventsName = require("../events/EventsName");


var SettingController = function () {
    BaseCCBController.call(this);
    this.spAudioOff = null;
    this.spAudioOn = null;
    this.lbAudio = null;
    this.lbVersion = null;
    this.ndRank = null;
    this.ndVibrate = null;

    this.spVibrateOn = null;
    this.spVibrateOff = null;
    this.lblVibrate = null;
};

game.utils.inherits(SettingController, BaseCCBController);

SettingController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.updateSoundItem();
    this.updateVibrateItem();
    var version = "web";
    if (cc.sys.isNative) {
        version = jsb_dp.oneSdkBridge.getVersion();
    }
    this.lbVersion.setString(game.utils.sprintf(_("version_title"), version));
    if (cc.sys.os === cc.sys.OS_ANDROID) {
        this.ndRank.visible = false;
        this.ndVibrate.visible = false;
    }
};

SettingController.prototype.updateSoundItem = function () {
    var isSoundOn = game.audioPlayer.isEffectOn();
    this.spAudioOff.visible = false;
    this.spAudioOn.visible = false;
    if (isSoundOn) {
        this.spAudioOn.visible = true;
        this.lbAudio.setString(_("audio_on_title"));
    } else {
        this.spAudioOff.visible = true;
        this.lbAudio.setString(_("audio_off_title"));
    }
};

SettingController.prototype.updateVibrateItem = function () {
    var isSoundOn = game.audioPlayer.isVibrateOn();
    this.spVibrateOff.visible = false;
    this.spVibrateOn.visible = false;
    if (isSoundOn) {
        this.spVibrateOn.visible = true;
        this.lblVibrate.setString(_("vibrate_on_title"));
    } else {
        this.spVibrateOff.visible = true;
        this.lblVibrate.setString(_("vibrate_off_title"));
    }
};

SettingController.prototype.soundClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.audioPlayer.setEffectOn(!game.audioPlayer.isEffectOn());
    game.audioPlayer.setMusicOn(!game.audioPlayer.isMusicOn());
    this.updateSoundItem();
};

SettingController.prototype.shareClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.analyseManager.trackEvent("SettingShare");
    game.shareManager.shareWithSystem(game.utils.sprintf(game.local.getValue("share_tips"),
        game.playerMan.getLevel(), game.config.getShortPlatformDownloadUrl()), game.config.getShareUrl());
};

SettingController.prototype.rankClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.gcManager.showLeaderboard(game.config.getLeaderBoardKey());
};

SettingController.prototype.supportClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.shareManager.sendEmail(game.config.getEmail(),
        game.local.getValue("feed_back_title"), game.local.getValue("feed_back_content"));
};

SettingController.prototype.rateClicked = function (sender) {
    AudioHelper.playBtnSound();
    cc.sys.openURL(game.config.getPlatformDownloadUrl());
};

SettingController.prototype.fanPageClicked = function (sender) {
    AudioHelper.playBtnSound();
    cc.sys.openURL(game.config.getFansUrl());
};

SettingController.prototype.likeUsClicked = function (sender) {
    AudioHelper.playBtnSound();
    cc.sys.openURL(game.config.getPlatformDownloadUrl());
};

SettingController.prototype.vibrateClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.audioPlayer.setVibrateOn(!game.audioPlayer.isVibrateOn());
    this.updateVibrateItem();
};

SettingController.prototype.backClicked = function (sender) {
    AudioHelper.playBtnSound();

    this.close();
};

SettingController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {popupAnim: true});
};

SettingController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

SettingController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/setting_view.ccbi", null, "SettingController", new SettingController());
    return node;
};

module.exports = SettingController;
},{"../config/ConfigMan":52,"../events/EventsName":169,"./SkinItemController":121}],120:[function(require,module,exports){
var SkinItemController = require("./SkinItemController");
var ConfigMan = require("../config/ConfigMan");
var EventsName = require("../events/EventsName");
var MultiColTableView = require("../../common/ext/MultiColTableView");

var GRID_SIZE = cc.size(270, 200);

var StoreItemCellView = cc.TableViewCell.extend({
    entity: null,
    itemNode: null,
    ctor: function () {
        this._super();
        this.itemNode = SkinItemController.createFromCCB();
        this.addChild(this.itemNode);
        this.itemNode.setPosition(cc.p(GRID_SIZE.width * 0.5, GRID_SIZE.height * 0.5));
    },

    initWith: function (entity, idx) {
        this.entity = entity;
        this.itemNode.controller.initWith(entity, idx);
    }
});

var SkinController = function () {
    BaseCCBController.call(this);
    this.ndContainer = null;

    this.lblTitle = null;

    this._tableView = null;

    //user data.
    this.configs = null;
};

game.utils.inherits(SkinController, BaseCCBController);

SkinController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
    game.eventDispatcher.addEventListener(EventsName.UPDATE_SKIN, this.onUpdateSkin, this);
};

SkinController.prototype.onExit = function () {
    game.eventDispatcher.removeEventListener(EventsName.UPDATE_SKIN, this.onUpdateSkin, this);
    BaseCCBController.prototype.onExit.call(this);
};

SkinController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.lblTitle.setString(_("skin_title"));

    this.configs = ConfigMan.getInstance().getSkinList();
    this.showTableView();
};

SkinController.prototype.onUpdateSkin = function (event) {
    this.showTableView();
};

SkinController.prototype.showTableView = function () {
    if (!this._tableView) {
        var size = this.ndContainer.getContentSize();
        this._tableView = new MultiColTableView(this, size, null);
        this._tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL);
        this._tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN);
        this._tableView.setMultiTableViewDelegate(this);
        this._tableView.ignoreAnchorPointForPosition(false);
        this._tableView.setAnchorPoint(cc.p(0, 0));
        this.ndContainer.addChild(this._tableView);
    } else {
        this._offset = this._tableView.getContentOffset();
    }
    this._tableView.reloadData();
    if (this._offset) {
        this._tableView.setContentOffset(this._offset);
        this._offset = null;
    }
};

SkinController.prototype.scrollViewDidScroll = function (view) {
};

SkinController.prototype.scrollViewDidZoom = function (view) {
};

SkinController.prototype.gridAtIndex = function(multiTable,  idx) {
    var cell = multiTable.dequeueGrid();
    if (!cell) {
        cell = new StoreItemCellView();
    }

    if (idx < this.configs.length) {
        var skinCfg = this.configs[idx];
        cell.initWith(skinCfg, idx);
        cell.visible = true;
    } else {
        cell.visible = false;
    }

    return cell;
};

SkinController.prototype.numberOfCellsInTableView = function(multiTable) {
    var gridsInCell = this.numberOfGridsInCell(multiTable);
    return Math.ceil(this.configs.length / gridsInCell);
};

SkinController.prototype.numberOfGridsInCell = function(multiTable, colIdx) {
    return 2;
};

SkinController.prototype.gridSizeForTable = function(table, colIdx) {
    return cc.size(270, 220);
};

SkinController.prototype.gridTouched = function(table, grid) {
};

SkinController.prototype.backClicked = function (sender) {
    AudioHelper.playBtnSound();

    this.close();
};

SkinController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode);
};

SkinController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

SkinController.prototype.onExit = function () {
    //if (this.closeCallback) {
    //    this.closeCallback();
    //    this.closeCallback = null;
    //}
};

SkinController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/skin_view.ccbi", null, "SkinController", new SkinController());
    return node;
};

module.exports = SkinController;
},{"../../common/ext/MultiColTableView":16,"../config/ConfigMan":52,"../events/EventsName":169,"./SkinItemController":121}],121:[function(require,module,exports){
var SkinRewardType = require("../enum/SkinRewardType");
var EventsName = require("../events/EventsName");
var SkinType = require("../enum/SkinType");

var SkinItemController = function () {
    BaseCCBController.call(this);

    this.ndPurchase = null;
    this.ndOwned = null;
    this.ndWatchAds = null;
    this.ndChallenge = null;
    this.ndKeyActivity = null;
    this.ndChristmas = null;

    this.lbDiamondPrice = null;
    this.lbUsing = null;
    this.lbRewardAdsCount = null;

    this.spSkin = null;

    this.idx = 0;
    this.skinCfg = null;
};

game.utils.inherits(SkinItemController, BaseCCBController);

SkinItemController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
};

SkinItemController.prototype.onEnter = function() {
    BaseCCBController.prototype.onEnter.call(this);
    game.eventDispatcher.addEventListener(EventsName.UPDATE_SKIN, this.onUpdateSkin, this);
};

SkinItemController.prototype.onExit = function() {
    game.eventDispatcher.removeEventListener(EventsName.UPDATE_SKIN, this.onUpdateSkin, this);
    BaseCCBController.prototype.onExit.call(this);
};
/**
 * @param {SkinConfig} data
 * @param {number} idx
 */
SkinItemController.prototype.initWith = function (data, idx) {
    this.idx = idx;
    this.skinCfg = data;
    try {
        var spriteFrame = cc.spriteFrameCache.getSpriteFrame(data.image + ".png");
        this.spSkin.setSpriteFrame(spriteFrame);

        this.ndPurchase.visible = false;
        this.ndOwned.visible = false;
        this.ndWatchAds.visible = false;
        this.ndChallenge.visible = false;
        this.ndKeyActivity.visible = false;
        this.ndChristmas.visible = false;

        var owned = game.playerMan.hasSkin(this.skinCfg.id);
        if (owned) {
            this.ndOwned.visible = true;
            if (data.id === game.playerMan.getCurrentSkinId()) {
                this.lbUsing.setString(_("selected_title"));
            } else {
                this.lbUsing.setString(_("select_title"));
            }
        } else {
            switch (data.type) {
                case SkinType.WatchAds:
                    var skinRewardCount = game.playerMan.getSkinAdsCount(data.id);
                    this.ndWatchAds.visible = true;
                    this.lbRewardAdsCount.setString(game.utils.sprintf("%d/%d", skinRewardCount, data.count));
                    break;
                case SkinType.Diamonds:
                    this.ndPurchase.visible = true;
                    this.lbDiamondPrice.setString(this.skinCfg.count);
                    break;
                case SkinType.Challenge:
                    this.ndChallenge.visible = true;
                    break;
                case SkinType.KeyActivity:
                    this.ndKeyActivity.visible = true;
                    break;
                case SkinType.Christmas:
                    this.ndChristmas.visible = true;
                    break;
            }
        }
    } catch (ex) {
        cc.error(ex);
    }
};

SkinItemController.prototype.onUpdateSkin = function () {
    this.initWith(this.skinCfg, this.idx);
};

SkinItemController.prototype.getContentSize = function () {
    return this.spBgSelected.getContentSize();
};

SkinItemController.prototype.purchaseClicked = function () {
    AudioHelper.playBtnSound();
    var StoreHelper = require("../model/StoreHelper");
    StoreHelper.getInstance().buySkin(this.skinCfg, "buy_skin_in_store");
};

SkinItemController.prototype.selectClicked = function () {
    AudioHelper.playBtnSound();
    game.playerMan.setCurrentSkinId(this.skinCfg.id);
    game.eventDispatcher.dispatchEvent(EventsName.UPDATE_SKIN);
};

SkinItemController.createFromCCB = function() {
    return game.utils.loadNodeFromCCB("res/menu/skin_item_view.ccbi", null, "SkinItemController", new SkinItemController());
};

module.exports = SkinItemController;
},{"../enum/SkinRewardType":165,"../enum/SkinType":166,"../events/EventsName":169,"../model/StoreHelper":178}],122:[function(require,module,exports){
var SkinRewardType = require("../enum/SkinRewardType");
var EventsName = require("../events/EventsName");
var SkinType = require("../enum/SkinType");

var SkinItemTitleController = function () {
    BaseCCBController.call(this);

    this.lbSkinTitle = null;
};

game.utils.inherits(SkinItemTitleController, BaseCCBController);

SkinItemTitleController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
};

/**
 * @param {string} content
 */
SkinItemTitleController.prototype.initWith = function (content) {
    this.lbSkinTitle.setString(content);
};

SkinItemTitleController.createFromCCB = function() {
    return game.utils.loadNodeFromCCB("res/menu/skin_item_title_view.ccbi", null, "SkinItemTitleController", new SkinItemTitleController());
};

module.exports = SkinItemTitleController;
},{"../enum/SkinRewardType":165,"../enum/SkinType":166,"../events/EventsName":169}],123:[function(require,module,exports){
var StoreHelper = require("../model/StoreHelper");

var SkinUnlockController = function () {
    BaseCCBController.call(this);

    this.spSkin = null;
    this.lbGetSkin = null;
    this.lbTitle = null;
    this.spRewardBg = null;

    this.closeCallback = null;
    this.skinCfg = null;
};

game.utils.inherits(SkinUnlockController, BaseCCBController);

SkinUnlockController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
};

SkinUnlockController.prototype.initWith = function (callback) {
    var skinId = game.playerMan.player.waitSkinId;
    var skinCfg = game.configMan.getSkinCfg(skinId);
    var spriteFrame = cc.spriteFrameCache.getSpriteFrame(skinCfg.image + "_l.png");
    if (spriteFrame != null) {
        this.spSkin.setSpriteFrame(spriteFrame);
    }
    this.lbGetSkin.setString(_("claim_title"));
    this.lbTitle.setString(_("unlock_skin_title"));
    this.closeCallback = callback;
    this.spRewardBg.runAction(cc.rotateBy(2, 360).repeatForever());
};

SkinUnlockController.prototype.closeClicked = function (sender) {
    AudioHelper.playBtnSound();
    this.close();
};

SkinUnlockController.prototype.watchAdsClicked = function (sender) {
    AudioHelper.playBtnSound();
    StoreHelper.getInstance().checkAndShowRewardVideo("watch_get_skins", function (purchased) {
        if (purchased) {
            var skinId = game.playerMan.player.waitSkinId;
            var skinCfg = game.configMan.getSkinCfg(skinId);
            var self = this;
            game.storeMan.onSkinWatchAdsOwned(skinCfg, function () {
                self.close();
            });
            game.playerMan.setSkinPercent(0);
            game.playerMan.setWaitSkinId(0);
        }
    }.bind(this));
};

SkinUnlockController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {overlayOpacity: 225, popupAnim: true});
};

SkinUnlockController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
    if (this.closeCallback) {
        this.closeCallback();
        this.closeCallback = null;
    }
};

SkinUnlockController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/watch_ads_skin_unlock_view.ccbi", null, "SkinUnlockController", new SkinUnlockController());
    return node;
};

module.exports = SkinUnlockController;
},{"../model/StoreHelper":178}],124:[function(require,module,exports){
var StoreHelper = require("../model/StoreHelper");
var ConfigMan = require("../config/ConfigMan");
var EventsName = require("../events/EventsName");

var SpecialOfferController = function () {
    BaseCCBController.call(this);

    this.lbTitle = null;

    this.spReward1 = null;
    this.lbReward1 = null;
    this.lbReward2 = null;
    this.lbReward3 = null;
    //this.spReward2 = null;
    //this.lbReward2 = null;
    //this.lbLeftTime = null;

    this.lblOriginalPrice = null;
    this.lbPrice = null;
    this.lblDiscount = null;

    this.btnPurchase = null;

    /**
     * @type {StoreConfig}
     */
    this.specialOfferCfg = null;
};

game.utils.inherits(SpecialOfferController, BaseCCBController);

SpecialOfferController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
    game.eventDispatcher.addEventListener(EventsName.PURCHASE_END, this.onPurchaseEnd, this);
};

SpecialOfferController.prototype.onExit = function () {
    game.eventDispatcher.removeEventListener(EventsName.PURCHASE_END, this.onPurchaseEnd, this);
    BaseCCBController.prototype.onExit.call(this);
};

SpecialOfferController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.specialOfferCfg = ConfigMan.getInstance().getSpecialOfferCfg();
    this.lbTitle.setString(_("special_offer_title"));
    this.lbReward1.setString("x" + this.specialOfferCfg.data.diamonds);
    //this.lbReward2.setString("x" + this.specialOfferCfg.data.multiple_3);
    //this.lbReward3.setString("x" + this.specialOfferCfg.data.new_3);


    this.lbPrice.setString(this.specialOfferCfg.price);
    this.lblOriginalPrice.setString(this.specialOfferCfg.original_price);
    this.lblDiscount.setString(game.utils.sprintf(_("more_title"), "" + (this.specialOfferCfg.discount_multi * 100)));
};

SpecialOfferController.prototype.init = function (closeCallback) {
    this.closeCallback = closeCallback;
};

SpecialOfferController.prototype.closeClicked = function (sender) {
    AudioHelper.playBtnSound();
    this.close();
};

SpecialOfferController.prototype.onPurchaseEnd = function (event) {
    var success = event.getUserData();
    if (success) {
        this.close();
    } else {
        this.btnPurchase.enabled = true;
    }
};

SpecialOfferController.prototype.onPurchase = function (sender) {
    AudioHelper.playBtnSound();
    this.btnPurchase.enabled = false;
    StoreHelper.getInstance().buyProduct(this.specialOfferCfg);
};

SpecialOfferController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {popupAnim: true});
};

SpecialOfferController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
    if (this.closeCallback) {
        this.closeCallback();
        this.closeCallback = null;
    }
};

SpecialOfferController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/store/special_offer_view.ccbi", null, "SpecialOfferController", new SpecialOfferController());
    return node;
};

module.exports = SpecialOfferController;
},{"../config/ConfigMan":52,"../events/EventsName":169,"../model/StoreHelper":178}],125:[function(require,module,exports){
var MultiColTableView = require("../../common/ext/MultiColTableView");
var StoreItemController = require("./StoreItemController");
var StoreHelper = require("../model/StoreHelper");
var SkinItemController = require("./SkinItemController");
var BoardItemController = require("./BoardItemController");
var SkinItemTitleController = require("./SkinItemTitleController");
var ConfigMan = require("../config/ConfigMan");
var StoreType = require("../enum/StoreType");
var EventsName = require("../events/EventsName");

var StoreTab = {
    DIAMONDS: 0,
    SKINS: 1,
    BOARD: 2
};

var TabVisualConfig = {};
TabVisualConfig[StoreTab.DIAMONDS] = {
    tabNode: "tabDiamondsLight",
    unselectNode: "tabDiamondsDark",
    contentNode:"diamondsContentNode"
};
TabVisualConfig[StoreTab.SKINS] = {
    tabNode:"tabSkinLight",
    unselectNode:"tabSkinDark",
    contentNode:"skinContentNode"
};
TabVisualConfig[StoreTab.BOARD] = {
    tabNode:"tabBoardLight",
    unselectNode:"tabBoardDark",
    contentNode:"boardContentNode"
};
var StoreSize = cc.size(571, 110);
var SkinSize = cc.size(285, 200);
var SkinTitleSize = cc.size(571, 58);

var StoreItemCellView = cc.TableViewCell.extend({
    entity: null,
    itemNode: null,
    ctor: function () {
        this._super();
        this.itemNode = StoreItemController.createFromCCB();
        this.addChild(this.itemNode);
        this.itemNode.setPosition(cc.p(StoreSize.width * 0.5, StoreSize.height * 0.5));
    },

    initWith: function (entity, idx) {
        this.entity = entity;
        this.itemNode.controller.initWith(entity, idx);
    }
});

var SkinItemCellView = cc.TableViewCell.extend({
    entity: null,
    itemNode: null,
    ctor: function () {
        this._super();
        this.itemNode = SkinItemController.createFromCCB();
        this.addChild(this.itemNode);
        this.itemNode.setPosition(cc.p(SkinSize.width * 0.5, SkinSize.height * 0.5));
    },

    initWith: function (entity, idx) {
        this.entity = entity;
        this.itemNode.controller.initWith(entity, idx);
    }
});

var BoardItemCellView = cc.TableViewCell.extend({
    entity: null,
    itemNode: null,
    ctor: function () {
        this._super();
        this.itemNode = BoardItemController.createFromCCB();
        this.addChild(this.itemNode);
        this.itemNode.setPosition(cc.p(SkinSize.width * 0.5, SkinSize.height * 0.5));
    },

    initWith: function (entity, idx) {
        this.entity = entity;
        this.itemNode.controller.initWith(entity, idx);
    }
});

var SkinItemTitleCellView = cc.TableViewCell.extend({
    //entity: null,
    itemNode: null,
    ctor: function () {
        this._super();
        this.itemNode = SkinItemTitleController.createFromCCB();
        this.addChild(this.itemNode);
        this.itemNode.setPosition(cc.p(SkinTitleSize.width * 0.5, SkinTitleSize.height * 0.5));
    },

    initWith: function (content) {
        //this.entity = entity;
        this.itemNode.controller.initWith(content);
    }
});

var SKIN_TITLE_COL_INDEX = 12;

var StoreController = function () {
    BaseCCBController.call(this);
    //this.lbChapterName = null;
    this.ndContainer = null;

    this.ndTitle = null;
    this.lbStoreName = null;

    this.lbDiamonds = null;

    //user data.
    this.configs = null;
    this.closeCallback = null;
};

game.utils.inherits(StoreController, BaseCCBController);

StoreController.prototype.onExit = function () {
    game.eventDispatcher.removeEventListener(EventsName.DIAMONDS_UPDATE, this.onUpdateDiamonds, this);
    game.eventDispatcher.removeEventListener(EventsName.UPDATE_AIM_ITEM, this.onUpdateAimItem, this);
    if (this.closeCallback) {
        this.closeCallback();
        this.closeCallback = null;
    }
};

StoreController.prototype.onEnter = function () {
    game.eventDispatcher.addEventListener(EventsName.UPDATE_AIM_ITEM, this.onUpdateAimItem, this);
    game.eventDispatcher.addEventListener(EventsName.DIAMONDS_UPDATE, this.onUpdateDiamonds, this);
    //this.refreshUI();
    this.onUpdateDiamonds();
};

StoreController.prototype.onUpdateDiamonds = function () {
    this.lbDiamonds.setString(game.playerMan.getDiamonds());
};

StoreController.prototype.onUpdateAimItem = function () {
    var diamondsTableView = this[TabVisualConfig[StoreTab.DIAMONDS].contentNode];
    if (diamondsTableView) {
        diamondsTableView.reloadData();
    }
};

StoreController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.lbStoreName.setString(game.local.getValue("store_title"));
    this.initStoreUI();
};

StoreController.prototype.initStoreUI = function () {
    //var originalTab = this.currentTab;
    var skinConfigs = ConfigMan.getInstance().getSkinList();
    cc.log("skinConfigs length:" + skinConfigs.length);
    //this.currentTab = StoreTab.SKINS;
    this[TabVisualConfig[StoreTab.SKINS].contentNode] = this.getTableView({
        gridAtIndex: function (multiTable, idx) {
            //var cell = multiTable.dequeueGrid();
            //if (!cell) {
            //    cell = new SkinItemCellView();
            //}
            var skinCell;
            var skinTitleCell;
            if (idx === 0) {
                skinTitleCell = new SkinItemTitleCellView();
                skinTitleCell.initWith(_("watch_ads_get_skin_title"));
            } else if (idx === 1) {
                skinTitleCell = new SkinItemTitleCellView();
                skinTitleCell.visible = false;
            } else if (idx === SKIN_TITLE_COL_INDEX * 2) {
                skinTitleCell = new SkinItemTitleCellView();
                skinTitleCell.initWith(_("cost_diamonds_get_skin_title"));
            } else if (idx === SKIN_TITLE_COL_INDEX * 2 + 1) {
                skinTitleCell = new SkinItemTitleCellView();
                skinTitleCell.visible = false;
            } else {
                skinCell = new SkinItemCellView();
            }

            if (skinCell) {
                var config;
                if (idx > 1 && idx < SKIN_TITLE_COL_INDEX * 2) {
                    config = skinConfigs[idx - 2];
                } else {
                    config = skinConfigs[idx - 4];
                }
                if (config) {
                    skinCell.initWith(config, idx);
                    skinCell.visible = true;
                } else {
                    skinCell.visible = false;
                }
            }

            if (skinCell) {
                return skinCell;
            }
            return skinTitleCell;
        },

        numberOfCellsInTableView: function (multiTable) {
            var gridsInCell = this.numberOfGridsInCell(multiTable);
            return Math.ceil(skinConfigs.length / gridsInCell) + 2;
        },

        numberOfGridsInCell: function (multiTable, colIdx) {
            return 2;
        },

        gridSizeForTable: function (table, colIdx) {
            //return cc.size(200, 200);
            if (colIdx === 0) {
                return cc.size(SkinTitleSize.width, SkinTitleSize.height + 15);
            } else if (colIdx === SKIN_TITLE_COL_INDEX) {
                return cc.size(SkinTitleSize.width, SkinTitleSize.height);
            } else {
                return cc.size(SkinSize.width, SkinSize.height);
            }
        }
    }, {
        gridTouched: function (table, grid) {
        }
    });

    var boardConfigs = ConfigMan.getInstance().getBoardList();

    this[TabVisualConfig[StoreTab.BOARD].contentNode] = this.getTableView({
        gridAtIndex: function (multiTable, idx) {
            var cell = multiTable.dequeueGrid();
            if (!cell) {
               cell = new BoardItemCellView();
            }
            var config = boardConfigs[idx];
            if (config) {
                cell.initWith(config);
                cell.visible = true;
            } else {
                cell.visible = false;
            }

            return cell;
        },

        numberOfCellsInTableView: function (multiTable) {
            var gridsInCell = this.numberOfGridsInCell(multiTable);
            return Math.ceil(boardConfigs.length / gridsInCell);
        },

        numberOfGridsInCell: function (multiTable, colIdx) {
            return 2;
        },

        gridSizeForTable: function (table, colIdx) {
            return cc.size(SkinSize.width, SkinSize.height);
        }
    }, {
        gridTouched: function (table, grid) {
        }
    });

    var diamondConfigs;
    if (game.playerMan.player.isAimVersion) {
        diamondConfigs = ConfigMan.getInstance().getStoreListWithoutFirstPurchaseAndAimItem();
    } else {
        diamondConfigs = ConfigMan.getInstance().getStoreListWithoutFirstPurchase();
    }
    //this.currentTab = StoreTab.DIAMONDS;
    this[TabVisualConfig[StoreTab.DIAMONDS].contentNode] = this.getTableView({
        gridAtIndex: function (multiTable, idx) {
            var cell = multiTable.dequeueGrid();
            if (!cell) {
                cell = new StoreItemCellView();
            }

            if (idx < diamondConfigs.length) {
                var config = diamondConfigs[idx];
                cell.initWith(config, idx);
                cell.visible = true;
            } else {
                cell.visible = false;
            }

            return cell;
        },

        numberOfCellsInTableView: function (multiTable) {
            return diamondConfigs.length;
        },

        numberOfGridsInCell: function (multiTable, colIdx) {
            return 1;
        },

        gridSizeForTable: function (table, colIdx) {
            return StoreSize;
        }
    }, {
        gridTouched: function (table, grid) {
            //cc.log("grid touched at index: " + grid.getIdx());
            //var entity = grid.entity;
            //AudioHelper.playBtnSound();
            //StoreHelper.getInstance().buyProduct(entity);
        }
    });

    //this.currentTab = originalTab;
};

StoreController.prototype.refreshUI = function() {
    this.currentTab = this.currentTab || StoreTab.DIAMONDS;
    cc.log("StoreController.prototype.refreshUI:" + this.currentTab);
    //this.currentTab = StoreTab.SKINS;
    for(var i in TabVisualConfig) {
        //var tabNode = this[TabVisualConfig[i].tabNode];
        var unSelectNode = this[TabVisualConfig[i].unselectNode];
        var contentNode = this[TabVisualConfig[i].contentNode];
        //tabNode && tabNode.setVisible(Number(i) === this.currentTab);
        contentNode && contentNode.setVisible(Number(i) === this.currentTab);
        unSelectNode && unSelectNode.setVisible(Number(i) !== this.currentTab);
    }
};

StoreController.prototype.initWith = function (type, callback) {
    cc.log("StoreController.prototype.initWith:" + type);
    if (type === StoreType.SKIN) {
        this.currentTab = StoreTab.SKINS;
    } else if (type === StoreType.DIAMOND) {
        this.currentTab = StoreTab.DIAMONDS;
    } else if (type === StoreType.BOARD_SKIN) {
        this.currentTab = StoreTab.BOARD;
    }
    this.refreshUI();
    this.closeCallback = callback;
};

StoreController.prototype.getTableView = function (dataSource, delegate) {
    var tableView = new MultiColTableView(dataSource, this.ndContainer.getContentSize(), null);
    tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL);
    tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN);
    tableView.setMultiTableViewDelegate(delegate);
    tableView.ignoreAnchorPointForPosition(false);
    tableView.setAnchorPoint(cc.p(0, 0));
    tableView.reloadData();
    this.ndContainer.addChild(tableView);
    return tableView;
};

StoreController.prototype.onClickSkin = function () {
    AudioHelper.playBtnSound();
    this.currentTab = StoreTab.SKINS;
    this.refreshUI();
};

StoreController.prototype.onClickDiamonds = function () {
    AudioHelper.playBtnSound();
    this.currentTab = StoreTab.DIAMONDS;
    this.refreshUI();
};

StoreController.prototype.onClickBoard = function () {
    AudioHelper.playBtnSound();
    this.currentTab = StoreTab.BOARD;
    this.refreshUI();
};

StoreController.prototype.backClicked = function (sender) {
    AudioHelper.playBtnSound();

    this.close();
};

StoreController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {popupAnim: true});
};

StoreController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

StoreController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/store/store_view.ccbi", null, "StoreController", new StoreController());
    return node;
};

module.exports = StoreController;
},{"../../common/ext/MultiColTableView":16,"../config/ConfigMan":52,"../enum/StoreType":167,"../events/EventsName":169,"../model/StoreHelper":178,"./BoardItemController":73,"./SkinItemController":121,"./SkinItemTitleController":122,"./StoreItemController":126}],126:[function(require,module,exports){
var StoreType = require("../enum/StoreType");
var EventsName = require("../events/EventsName");

var StoreItemController = function () {
    BaseCCBController.call(this);

    //price
    this.lbPrice = null;
    this.spRewardedVideo = null;
    this.ndDiamondPrice = null;
    this.lbDiamondPrice = null;

    //node
    this.ndRestore = null;
    this.ndBoosts = null;
    this.ndDiamond = null;
    this.ndPurchase = null;
    this.ndOwned = null;

    //
    this.lbSplit = null;
    this.lbNewThree = null;
    this.lbDiamond = null;
    this.spDiamond = null;

    //tag
    this.spHotTag = null;
    this.spFreeTag = null;
    this.spPercentTag = null;

    this.spRedBg = null;

    this.lbTag = null;

    this.btnClaim = null;

    this.ndReminder = null;

    this.idx = 0;
};

game.utils.inherits(StoreItemController, BaseCCBController);

StoreItemController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
};

/**
 * @param {StoreConfig} data
 * @param {number} idx
 */
StoreItemController.prototype.initWith = function (data, idx) {
    this.storeEntity = data;
    this.idx = idx;
    this.lbPrice.setString(data.price);

    try {

        this.ndRestore.visible = false;
        this.ndBoosts.visible = false;
        this.ndDiamond.visible = false;
        this.ndPurchase.visible = true;
        this.ndOwned.visible = false;

        this.lbPrice.visible = false;
        this.ndDiamondPrice.visible = false;
        this.spRewardedVideo.visible = false;

        this.spHotTag.visible = false;
        this.spFreeTag.visible = false;
        this.spPercentTag.visible = false;

        this.lbTag.visible = false;

        this.spRedBg.visible = false;

        this.btnClaim.enabled = true;

        this.ndReminder.visible = false;

        var spriteFrame;
        switch (data.type) {
            case StoreType.FREE:
                this.ndDiamond.visible = true;
                this.lbDiamond.setString(data.count);
                this.spRewardedVideo.visible = true;
                spriteFrame = cc.spriteFrameCache.getSpriteFrame(data.image);
                if (spriteFrame) {
                    this.spDiamond.setSpriteFrame(spriteFrame);
                }
                //tag
                this.spFreeTag.visible = true;
                this.lbTag.visible = true;
                this.lbTag.setString(_("free_coins_title"));
                this.ndReminder.visible = true;
                break;
            case StoreType.REMOVE_ADS:
                this.ndDiamond.visible = true;
                this.lbDiamond.setString(game.local.getValue("remove_ads_title"));
                spriteFrame = cc.spriteFrameCache.getSpriteFrame(data.image);
                if (spriteFrame) {
                    this.spDiamond.setSpriteFrame(spriteFrame);
                }
                this.lbPrice.visible = true;
                this.spHotTag.visible = true;
                this.lbTag.visible = true;
                this.lbTag.setString(_("hot_title"));
                break;
            case StoreType.AIM_ITEM:
                this.ndDiamond.visible = true;
                this.lbDiamond.setString(game.local.getValue("aim_item_title"));
                spriteFrame = cc.spriteFrameCache.getSpriteFrame(data.image);
                if (spriteFrame) {
                    this.spDiamond.setSpriteFrame(spriteFrame);
                }
                //this.lbPrice.visible = true;

                if (game.playerMan.player.hasAimItem) {
                    this.ndOwned.visible = true;
                    this.ndPurchase.visible = false;
                } else {
                    this.ndPurchase.visible = true;
                    this.lbPrice.visible = true;
                }
                // this.spHotTag.visible = true;
                // this.lbTag.visible = true;
                // this.lbTag.setString(_("hot_title"));
                break;
            case StoreType.RESTORE:
                this.ndRestore.visible = true;
                this.ndPurchase.visible = false;
                this.spRedBg.visible = true;
                break;
            case StoreType.NEW_AND_SPLIT:
                this.ndBoosts.visible = true;
                this.lbSplit.setString("x" + data.data.multiple_3);
                this.lbNewThree.setString("x" + data.data.multiple_3);
                this.ndDiamondPrice.visible = true;
                this.lbDiamondPrice.setString(data.count);
                break;
            case StoreType.DIAMOND:
                this.ndDiamond.visible = true;
                this.lbDiamond.setString(data.count);
                this.lbPrice.visible = true;
                spriteFrame = cc.spriteFrameCache.getSpriteFrame(data.image);
                if (spriteFrame) {
                    this.spDiamond.setSpriteFrame(spriteFrame);
                }
                //tag
                if (data.extra > 0) {
                    this.spPercentTag.visible = true;
                    this.lbTag.visible = true;
                    this.lbTag.setString("+" + (data.extra * 100) + "%");
                }
                break;
        }
    } catch (ex) {
        cc.error(ex);
    }
};

StoreItemController.prototype.getContentSize = function () {
    return this.spBg.getContentSize();
};

StoreItemController.prototype.purchaseClicked = function () {
    AudioHelper.playBtnSound();
    var StoreHelper = require("../model/StoreHelper");
    StoreHelper.getInstance().buyProduct(this.storeEntity);
};

StoreItemController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/store/store_item_view.ccbi", null, "StoreItemController", new StoreItemController());
    return node;
};

module.exports = StoreItemController;
},{"../enum/StoreType":167,"../events/EventsName":169,"../model/StoreHelper":178}],127:[function(require,module,exports){
var StoreHelper = require("../model/StoreHelper");

var SuperBoardController = function () {
    BaseCCBController.call(this);

    this._titleLabel = null;

    this.spRewardBg = null;

    this.closeCallback = null;

    this.rewarded = false;
    this.rewardName = "";
};

game.utils.inherits(SuperBoardController, BaseCCBController);

SuperBoardController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
};

SuperBoardController.prototype.initWith = function (rewardName, closeCallback) {
    console.log("SuperBoardController.prototype.init");
    this.closeCallback = closeCallback;
    this.rewardName = rewardName;

    this.spRewardBg.runAction(cc.rotateBy(2, 360).repeatForever());
};

SuperBoardController.prototype.closeClicked = function (sender) {
    AudioHelper.playBtnSound();
    this.close();
};

SuperBoardController.prototype.watchAdsClicked = function (sender) {
    AudioHelper.playBtnSound();
    var self = this;
    StoreHelper.getInstance().checkAndShowRewardVideo(this.rewardName, function (rewarded) {
        if (rewarded) {
            self.rewarded = true;
            self.close();
        }
    });
};

SuperBoardController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {overlayOpacity: 210});
};

SuperBoardController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
    if (this.closeCallback) {
        this.closeCallback(this.rewarded);
        this.closeCallback = null;
    }
};

SuperBoardController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/reward_baffle_view.ccbi", null, "SuperBoardController", new SuperBoardController());
    return node;
};

module.exports = SuperBoardController;
},{"../model/StoreHelper":178}],128:[function(require,module,exports){
var TaskItemController = require("./TaskItemController");
var ConfigMan = require("../config/ConfigMan");
var EventsName = require("../events/EventsName");
var MultiColTableView = require("../../common/ext/MultiColTableView");

var GRID_SIZE = cc.size(270, 200);

var StoreItemCellView = cc.TableViewCell.extend({
    entity: null,
    itemNode: null,
    ctor: function () {
        this._super();
        this.itemNode = TaskItemController.createFromCCB();
        this.addChild(this.itemNode);
        this.itemNode.setPosition(cc.p(GRID_SIZE.width * 0.5, GRID_SIZE.height * 0.5));
    },

    initWith: function (entity, idx) {
        this.entity = entity;
        this.itemNode.controller.initWith(entity, idx);
    }
});

var TaskController = function () {
    BaseCCBController.call(this);
    this.ndContainer = null;

    this.lblTitle = null;

    this._tableView = null;

    //user data.
    this.configs = null;
};

game.utils.inherits(TaskController, BaseCCBController);

TaskController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
    //game.eventDispatcher.addEventListener(EventsName.UPDATE_SKIN, this.onUpdateSkin, this);
};

TaskController.prototype.onExit = function () {
    //game.eventDispatcher.removeEventListener(EventsName.UPDATE_SKIN, this.onUpdateSkin, this);
    BaseCCBController.prototype.onExit.call(this);
};

TaskController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.lblTitle.setString(_("task_title"));

    this.configs = ConfigMan.getInstance().getTaskList();
    this.showTableView();
};

TaskController.prototype.onUpdateSkin = function (event) {
    this.showTableView();
};

TaskController.prototype.showTableView = function () {
    if (!this._tableView) {
        var size = this.ndContainer.getContentSize();
        this._tableView = new MultiColTableView(this, size, null);
        this._tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL);
        this._tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN);
        this._tableView.setMultiTableViewDelegate(this);
        this._tableView.ignoreAnchorPointForPosition(false);
        this._tableView.setAnchorPoint(cc.p(0, 0));
        this.ndContainer.addChild(this._tableView);
    } else {
        this._offset = this._tableView.getContentOffset();
    }
    this._tableView.reloadData();
    if (this._offset) {
        this._tableView.setContentOffset(this._offset);
        this._offset = null;
    }
};

TaskController.prototype.scrollViewDidScroll = function (view) {
};

TaskController.prototype.scrollViewDidZoom = function (view) {
};

TaskController.prototype.gridAtIndex = function(multiTable,  idx) {
    var cell = multiTable.dequeueGrid();
    if (!cell) {
        cell = new StoreItemCellView();
    }

    if (idx < this.configs.length) {
        var skinCfg = this.configs[idx];
        cell.initWith(skinCfg, idx);
        cell.visible = true;
    } else {
        cell.visible = false;
    }

    return cell;
};

TaskController.prototype.numberOfCellsInTableView = function(multiTable) {
    var gridsInCell = this.numberOfGridsInCell(multiTable);
    return Math.ceil(this.configs.length / gridsInCell);
};

TaskController.prototype.numberOfGridsInCell = function(multiTable, colIdx) {
    return 2;
};

TaskController.prototype.gridSizeForTable = function(table, colIdx) {
    return cc.size(270, 220);
};

TaskController.prototype.gridTouched = function(table, grid) {
};

TaskController.prototype.backClicked = function (sender) {
    AudioHelper.playBtnSound();

    this.close();
};

TaskController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {popupAnim: true});
};

TaskController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
};

TaskController.prototype.onExit = function () {
    //if (this.closeCallback) {
    //    this.closeCallback();
    //    this.closeCallback = null;
    //}
};

TaskController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/task_view.ccbi", null, "TaskController", new TaskController());
    return node;
};

module.exports = TaskController;
},{"../../common/ext/MultiColTableView":16,"../config/ConfigMan":52,"../events/EventsName":169,"./TaskItemController":129}],129:[function(require,module,exports){
var SkinRewardType = require("../enum/SkinRewardType");
var EventsName = require("../events/EventsName");
var BoostType = require("../enum/BoostType");
var StoreHelper = require("../model/StoreHelper");

var TaskItemController = function () {
    BaseCCBController.call(this);

    this.lblGoal = null;
    this.lblGoalInfo = null;
    //this.spSkin = null;
    this.spBgSelected = null;

    this.lblSelect = null;
    this.btnSelect = null;
    this.ndSelect = null;

    this.lblDiamonds = null;

    //this.lblUsing = null;

    this.idx = 0;
    this.taskCfg = null;
};

game.utils.inherits(TaskItemController, BaseCCBController);

TaskItemController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
};
/**
 * @param {TaskConfig} data
 * @param {number} idx
 */
TaskItemController.prototype.initWith = function (data, idx) {
    this.idx = idx;
    this.taskCfg = data;
    this.refresh();
};

TaskItemController.prototype.refresh = function () {
    var data = this.taskCfg;
    var completed = false;
    switch (data.type) {
        case SkinRewardType.None:
            this.lblGoal.visible = false;
            this.lblGoalInfo.visible = false;
            completed = true;
            break;
        case SkinRewardType.LevelCount:
            this.lblGoal.visible = true;
            this.lblGoalInfo.visible = true;
            this.lblGoal.setString(game.utils.sprintf(game.local.getValue("level_count_title"), data.count));
            if (game.playerMan.getLevel() >= data.count) {
                this.lblGoalInfo.setString(game.local.getValue("completed_title"));
                completed = true;
            } else {
                this.lblGoalInfo.setString(game.utils.sprintf("%d/%d", game.playerMan.getLevel(), data.count));
            }
            break;
        case SkinRewardType.WatchAdCount:
            this.lblGoal.visible = true;
            this.lblGoalInfo.visible = true;
            this.lblGoal.setString(game.utils.sprintf(game.local.getValue("watch_ad_count_title"), data.count));
            if (game.playerMan.player.interstitialAdCount >= data.count) {
                this.lblGoalInfo.setString(game.local.getValue("completed_title"));
                completed = true;
            } else {
                this.lblGoalInfo.setString(game.utils.sprintf("%d/%d", game.playerMan.player.interstitialAdCount, data.count));
            }
            break;
        case SkinRewardType.WatchRewardAdCount:
            this.lblGoal.visible = true;
            this.lblGoalInfo.visible = true;
            this.lblGoal.setString(game.utils.sprintf(game.local.getValue("watch_reward_ad_count_title"), data.count));
            if (game.playerMan.player.rewardedAdCount >= data.count) {
                this.lblGoalInfo.setString(game.local.getValue("completed_title"));
                completed = true;
            } else {
                this.lblGoalInfo.setString(game.utils.sprintf("%d/%d", game.playerMan.player.rewardedAdCount, data.count));
            }
            break;
        case SkinRewardType.Claimed:
            if (game.playerMan.hasSkin(data.id)) {
                this.lblGoal.visible = false;
                this.lblGoalInfo.visible = false;
                completed = true;
            } else {
                this.lblGoal.setString(_("skin_gift_title"));
                this.lblGoalInfo.setString("--");
            }
            break;
        case SkinRewardType.Purchase:
            if (game.playerMan.hasSkin(data.id)) {
                this.lblGoal.visible = false;
                this.lblGoalInfo.visible = false;
                completed = true;
            } else {
                this.lblGoal.setString(_("skin_purchase_title"));
                this.lblGoalInfo.setString("--");
            }
            break;
    }

    this.lblDiamonds.setString("x" + data.rewardCount);

    //var spriteFrame = cc.spriteFrameCache.getSpriteFrame(data.image + ".png");
    //this.spSkin.setSpriteFrame(spriteFrame);
    //this.lblUsing.setString(_("selected_title"));

    //this.lblUsing.visible = false;
    //this.ndSelect.visible = false;
    this.btnSelect.enabled = false;

    var claimed = game.playerMan.isTaskClaimed(this.taskCfg.id);
    this.ndSelect.visible = true;

    if (completed) {
        if (!claimed) {
            this.btnSelect.enabled = true;
            this.lblSelect.setString(game.local.getValue("claim_title"));
        } else {
            this.lblSelect.setString(game.local.getValue("claimed_title"));
        }
    } else {
        this.lblSelect.setString(_("uncompleted_title"));
    }
};

TaskItemController.prototype.getContentSize = function () {
    return this.spBgSelected.getContentSize();
};

TaskItemController.prototype.selectClicked = function () {
    AudioHelper.playBtnSound();
    cc.log("task claimed:" + game.playerMan.isTaskClaimed(this.taskCfg.id));
    if (!game.playerMan.isTaskClaimed(this.taskCfg.id)) {
        cc.log("task set claimed:" + this.taskCfg.id);
        game.playerMan.setTaskClaimed(this.taskCfg.id);
        var rewardCount = this.taskCfg.rewardCount;
        StoreHelper.getInstance().popupRewardDoubleDlg(rewardCount, BoostType.DIAMOND,  game.utils.isIOS() ? "tasks" : "tasks", function () {
        }.bind(this));
        this.refresh();
        game.eventDispatcher.dispatchEvent(EventsName.TASK_UPDATE);
    }
};

TaskItemController.createFromCCB = function() {
    return game.utils.loadNodeFromCCB("res/menu/task_item_view.ccbi", null, "TaskItemController", new TaskItemController());
};

module.exports = TaskItemController;
},{"../enum/BoostType":154,"../enum/SkinRewardType":165,"../events/EventsName":169,"../model/StoreHelper":178}],130:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/15.
 */
var EventsName = require("../events/EventsName");

var ColorList = [
    cc.color(255, 106, 107),
    cc.color(90, 181, 110),
    cc.color(83, 183, 209),
    cc.color(243, 77, 151),
    cc.color(153, 95, 206),
    cc.color(57, 103, 249),
    cc.color(249, 112, 49),
    cc.color(232, 59, 20),
    cc.color(84, 235, 43),
    cc.color(50, 84, 117),
    cc.color(127, 127, 127)
];


var TitleController = function () {
    BaseCCBController.call(this);
    this.lbCoins = null;

    this.spCoinsAdd = null;
    this.btnAdd = null;

    this.bgNode = null;
};

game.utils.inherits(TitleController, BaseCCBController);

TitleController.prototype.onEnter = function () {
    game.eventDispatcher.addEventListener(EventsName.COINS_UPDATE, this.refresh, this);
};

TitleController.prototype.onExit = function () {
    game.eventDispatcher.removeEventListener(EventsName.COINS_UPDATE, this.refresh, this);
};

TitleController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.refresh();
    this.randomSquares();

    if (TitleController.time > 0) {
        game.utils.playCCBAnimation(this.rootNode, "Default Timeline");
    }
    TitleController.time ++;
};

TitleController.prototype.randomSquares = function () {
    for (var i = 0; i < 20; ++i) {
        var square = new cc.Sprite("#square_circle.png");

        square.setPosition(this.getRandomPos());
        square.setColor(ColorList[game.utils.randomNextInt(ColorList.length - 1)]);
        square.setOpacity(15);
        square.setScale(1.4);

        var pos1 = this.getRandomPos();
        square.setPosition(pos1);
        var pos2 = this.getRandomPos();
        var t = this.getTime(pos1, pos2);
        var moveTo1 = cc.moveTo(t, pos2);
        var moveTo2 = cc.moveTo(t, pos1);
        var action = cc.sequence(moveTo1, moveTo2).repeatForever();
        square.runAction(action);
        square.runAction(cc.rotateBy(20, 360).repeatForever());
        this.bgNode.addChild(square);
    }
};

TitleController.prototype.getTime = function (pos1, pos2) {
    return cc.pDistance(pos1, pos2) / 20;
};

TitleController.prototype.getRandomPos = function () {
    return cc.p(game.utils.randomNextInt(cc.winSize.width * 1.5) - cc.winSize.width * 0.25,
        game.utils.randomNextInt(cc.winSize.height * 1.5) - cc.winSize.height * 0.25);
};

TitleController.prototype.initWith = function (replayCallback, nextCallback) {
    this._replayCallback = replayCallback;
    this._nextCallback = nextCallback;
};

TitleController.prototype.refresh = function () {
    this.lbCoins.setString(game.playerMan.player.coins);
};

TitleController.prototype.disableAddCoins = function () {
    this.spCoinsAdd.visible = false;
    this.btnAdd.enabled = false;
    game.utils.playCCBAnimation(this.rootNode, "none");
};

TitleController.prototype.storeClicked = function (sender) {
    AudioHelper.playBtnSound();
    game.popupMan.popupStoreDlg();
};

TitleController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/menu/title_view.ccbi", null, "TitleController", new TitleController());
    return node;
};

TitleController.time = 0;

module.exports = TitleController;
},{"../events/EventsName":169}],131:[function(require,module,exports){
var StoreHelper = require("../model/StoreHelper");

var WatchAdsGet3StarController = function () {
    BaseCCBController.call(this);

    //this.btnCloseCn = null;
    //this.btnCloseEn = null;

    this.spYellow1 = null;
    this.spYellow2 = null;
    this.spYellow3 = null;

    this.spBlack1 = null;
    this.spBlack2 = null;
    this.spBlack3 = null;

    this.lbCollectTips = null;

    this.closeCallback = null;
    this.rewardName = null;
    this.watched = false;
};

game.utils.inherits(WatchAdsGet3StarController, BaseCCBController);

WatchAdsGet3StarController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    //this.btnCloseCn.visible = false;
    //this.btnCloseEn.visible = false;
    //if (game.local.isChinese()) {
    //    this.btnCloseCn.visible = true;
    //} else {
    //    this.btnCloseEn.visible = true;
    //}
    //game.audioPlayer.playEffectByKey("open_box");

    this.lbCollectTips.setAlignment(cc.TEXT_ALIGNMENT_CENTER);

    this.spYellows = [this.spYellow1, this.spYellow2, this.spYellow3];

    var star = game.gameMan.currentStar;
    for (var i = 0; i < 3; ++i) {
        this.spYellows[i].visible = (star >= i + 1);
    }
};

WatchAdsGet3StarController.prototype.initWith = function (rewardName, closeCallback) {
    this.closeCallback = closeCallback;
    this.rewardName = rewardName;
};

WatchAdsGet3StarController.prototype.closeClicked = function (sender) {
    AudioHelper.playBtnSound();
    this.close();
};

WatchAdsGet3StarController.prototype.watchAdsClicked = function (sender) {
    AudioHelper.playBtnSound();
    StoreHelper.getInstance().checkAndShowRewardVideo(this.rewardName, function (watched) {
        if (watched) {
            this.watched = true;
            this.close();
        }
    }.bind(this));
};

WatchAdsGet3StarController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {popupAnim: true});
};

WatchAdsGet3StarController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
    if (this.closeCallback) {
        this.closeCallback(this.watched);
        this.closeCallback = null;
    }
};

WatchAdsGet3StarController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/watch_ads_get_3star_view.ccbi", null, "WatchAdsGet3StarController", new WatchAdsGet3StarController());
    return node;
};

module.exports = WatchAdsGet3StarController;
},{"../model/StoreHelper":178}],132:[function(require,module,exports){
var StoreHelper = require("../model/StoreHelper");

var WatchAdsGetDiamondsController = function () {
    BaseCCBController.call(this);

    //this.btnCloseCn = null;
    //this.btnCloseEn = null;

    //this.spItem = null;
    //this.lbBtnTitle = null;
    this.spDiamondBg = null;

    this.lbDiamondsCount = null;

    this.closeCallback = null;
    this.rewardName = null;
    this.watched = false;
};

game.utils.inherits(WatchAdsGetDiamondsController, BaseCCBController);

WatchAdsGetDiamondsController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    //this.btnCloseCn.visible = false;
    //this.btnCloseEn.visible = false;
    //if (game.local.isChinese()) {
    //    this.btnCloseCn.visible = true;
    //} else {
    //    this.btnCloseEn.visible = true;
    //}
    this.spDiamondBg.runAction(cc.rotateBy(3, 360).repeatForever());
    game.audioPlayer.playEffectByKey("open_box");
};

WatchAdsGetDiamondsController.prototype.initWith = function (rewardName, closeCallback) {
    this.closeCallback = closeCallback;
    this.rewardName = rewardName;
    this.lbDiamondsCount.setString("x" + game.config.dailyDiamonds);
};

WatchAdsGetDiamondsController.prototype.closeClicked = function (sender) {
    AudioHelper.playBtnSound();
    this.close();
};

WatchAdsGetDiamondsController.prototype.watchAdsClicked = function (sender) {
    AudioHelper.playBtnSound();
    StoreHelper.getInstance().checkAndShowRewardVideo(this.rewardName, function (watched) {
        if (watched) {
            this.watched = true;
            this.close();
        }
    }.bind(this));
};

WatchAdsGetDiamondsController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {overlayOpacity: 225, popupAnim: true});
};

WatchAdsGetDiamondsController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
    if (this.closeCallback) {
        this.closeCallback(this.watched);
        this.closeCallback = null;
    }
};

WatchAdsGetDiamondsController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/watch_ads_get_diamonds_view.ccbi", null, "WatchAdsGetDiamondsController", new WatchAdsGetDiamondsController());
    return node;
};

module.exports = WatchAdsGetDiamondsController;
},{"../model/StoreHelper":178}],133:[function(require,module,exports){
var StoreHelper = require("../model/StoreHelper");

var WatchAdsGetItemController = function () {
    BaseCCBController.call(this);

    //this.btnCloseCn = null;
    //this.btnCloseEn = null;

    this.spItem = null;
    this.lbBtnTitle = null;

    this.closeCallback = null;
    this.rewardName = null;
    this.watched = false;
};

game.utils.inherits(WatchAdsGetItemController, BaseCCBController);

WatchAdsGetItemController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    //this.btnCloseCn.visible = false;
    //this.btnCloseEn.visible = false;
    //if (game.local.isChinese()) {
    //    this.btnCloseCn.visible = true;
    //} else {
    //    this.btnCloseEn.visible = true;
    //}
    game.audioPlayer.playEffectByKey("open_box");
};

WatchAdsGetItemController.prototype.initWith = function (title, spriteName, rewardName, closeCallback) {
    this.closeCallback = closeCallback;
    this.rewardName = rewardName;
    this.lbBtnTitle.setString(title);
    var spriteFrame = cc.spriteFrameCache.getSpriteFrame(spriteName);
    if (spriteFrame) {
        this.spItem.setSpriteFrame(spriteFrame);
    } else {
        cc.error("sprite frame is null:" + spriteName);
    }
};

WatchAdsGetItemController.prototype.closeClicked = function (sender) {
    AudioHelper.playBtnSound();
    this.close();
};

WatchAdsGetItemController.prototype.watchAdsItemClicked = function (sender) {
    this.watchAdsClicked(sender);
};

WatchAdsGetItemController.prototype.watchAdsClicked = function (sender) {
    AudioHelper.playBtnSound();
    StoreHelper.getInstance().checkAndShowRewardVideo(this.rewardName, function (watched) {
        if (watched) {
            this.watched = true;
            this.close();
        }
    }.bind(this));
};

WatchAdsGetItemController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {overlayOpacity: 225, popupAnim: true});
};

WatchAdsGetItemController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
    if (this.closeCallback) {
        this.closeCallback(this.watched);
        this.closeCallback = null;
    }
};

WatchAdsGetItemController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/watch_ads_get_item_view.ccbi", null, "WatchAdsGetItemController", new WatchAdsGetItemController());
    return node;
};

module.exports = WatchAdsGetItemController;
},{"../model/StoreHelper":178}],134:[function(require,module,exports){
var StoreHelper = require("../model/StoreHelper");

var WatchAdsGetSkinController = function () {
    BaseCCBController.call(this);

    //this.btnCloseCn = null;
    //this.btnCloseEn = null;

    this.spSkin = null;
    this.lbGetSkin = null;

    this.closeCallback = null;
    this.skinCfg = null;
};

game.utils.inherits(WatchAdsGetSkinController, BaseCCBController);

WatchAdsGetSkinController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    //this.btnCloseCn.visible = false;
    //this.btnCloseEn.visible = false;
    //if (game.local.isChinese()) {.btnCloseCn
    //    this.btnCloseCn.visible = true;
    //} else {
    //    this.btnCloseEn.visible = true;
    //}
    this.lbGetSkin.setString(_("reward_video_skin"));

    game.audioPlayer.playEffectByKey("open_box");
};

WatchAdsGetSkinController.prototype.initWith = function (skinCfg, callback) {
    this.skinCfg = skinCfg;
    var spriteFrame = cc.spriteFrameCache.getSpriteFrame(skinCfg.image + "_l.png");
    this.spSkin.setSpriteFrame(spriteFrame);
    this.closeCallback = callback;
};

WatchAdsGetSkinController.prototype.closeClicked = function (sender) {
    AudioHelper.playBtnSound();
    this.close();
};

WatchAdsGetSkinController.prototype.watchAdsClicked = function (sender) {
    AudioHelper.playBtnSound();
    StoreHelper.getInstance().buySkin(this.skinCfg, "buy_skin_in_pass", function (purchased) {
        if (purchased) {
            this.close();
        }
    }.bind(this));
};

WatchAdsGetSkinController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {overlayOpacity: 225, popupAnim: true});
};

WatchAdsGetSkinController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
    if (this.closeCallback) {
        this.closeCallback();
        this.closeCallback = null;
    }
};

WatchAdsGetSkinController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/watch_ads_get_skin_view.ccbi", null, "WatchAdsGetSkinController", new WatchAdsGetSkinController());
    return node;
};

module.exports = WatchAdsGetSkinController;
},{"../model/StoreHelper":178}],135:[function(require,module,exports){
var StoreHelper = require("../model/StoreHelper");

var WatchAdsRelifeController = function () {
    BaseCCBController.call(this);

    this.spCircle = null;

    this.closeCallback = null;
    //this.skinCfg = null;
    this.relife = false;
};

game.utils.inherits(WatchAdsRelifeController, BaseCCBController);

WatchAdsRelifeController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
};

WatchAdsRelifeController.prototype.initWith = function (callback) {
    this.closeCallback = callback;
    this.spCircle = game.utils.createProgressTimer(this.spCircle, false, true);
    this.spCircle.setPercentage(100);
    this.spCircle.runAction(cc.sequence(cc.progressTo(5, 0), cc.callFunc(this.close, this)));
};

WatchAdsRelifeController.prototype.closeClicked = function (sender) {
    AudioHelper.playBtnSound();
    this.close();
};

WatchAdsRelifeController.prototype.watchAdsClicked = function (sender) {
    AudioHelper.playBtnSound();
    this.relife = true;
    this.close();
};

WatchAdsRelifeController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {overlayOpacity: 225, popupAnim: true});
};

WatchAdsRelifeController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
    if (this.closeCallback) {
        this.closeCallback(this.relife);
        this.closeCallback = null;
    }
};

WatchAdsRelifeController.createFromCCB = function() {
    var node = game.utils.loadNodeFromCCB("res/notice/watch_ads_relife_view.ccbi", null, "WatchAdsRelifeController", new WatchAdsRelifeController());
    return node;
};

module.exports = WatchAdsRelifeController;
},{"../model/StoreHelper":178}],136:[function(require,module,exports){
var Wheel = require("../../common/wheel/Wheel");
var ConfigMan = require("../config/ConfigMan");
var BoostType = require("../enum/BoostType");
var StoreHelper = require("../model/StoreHelper");
var GameMan = require("../model/GameMan");
var WheelType = require("../enum/WheelType");
var WheelItemController = require("./WheelItemController");

var WheelController = function () {
    BaseCCBController.call(this);
    this.WHEEL_TIME = 5;
    this.WHEEL_ITEM_TAG = 100;

    this.WHEEL_COUNT = 6;

    this.WHEEL_ITEM_ANGLE = 360 / this.WHEEL_COUNT;

    this.ndWheel = null;

    this.ndDailyWheel = null;
    this.ndBox = null;

    this.btnSpinAgain = null;

    this.btnClose = null;

    this.spTitleCn = null;
    this.spTitleEn = null;

    this.ndFree = null;
    this.ndWatchAds = null;
    this.btnFree = null;
    this.btnWatchAds = null;
    this.lbFree = null;
    this.lbWatchAds = null;

    this.lblTips = null;

    /**
     * @type {Wheel}
     */
    this.wheel = null;

    this.wheelNodes = null;

    this.wheelList = null;
};

game.utils.inherits(WheelController, BaseCCBController);

WheelController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
    this.intervalKey = setInterval(this.onUpdate.bind(this), 1000);
};

WheelController.prototype.onExit = function () {
    clearInterval(this.intervalKey);
    BaseCCBController.prototype.onExit.call(this);
};

WheelController.prototype.onDidLoadFromCCB = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);

    //this.btnCloseCn.visible = false;
    //this.btnCloseEn.visible = false;
    this.spTitleCn.visible = false;
    this.spTitleEn.visible = false;
    if (game.local.isChinese()) {
        //this.btnCloseCn.visible = true;
        this.spTitleCn.visible = true;
    } else {
        //this.btnCloseEn.visible = true;
        this.spTitleEn.visible = true;
    }

    this.wheelNodes = [];
    for (var i = 0; i < this.WHEEL_COUNT; ++i) {
        var wheelNode = game.utils.seekNodeByTag(this.ndWheel, this.WHEEL_ITEM_TAG + i);
        this.wheelNodes.push(wheelNode);
    }

};

WheelController.prototype.isDailyWheel = function () {
    return (this.wheelType === WheelType.DailyBonus);
};

WheelController.prototype.initWith = function (wheelType, callback) {
    this.wheelType = wheelType;
    this.closeCallback = callback;
    this.ndBox.visible = false;
    this.ndDailyWheel.visible = false;
    switch (wheelType) {
        case WheelType.DailyBonus:
            this.ndDailyWheel.visible = true;
            this.wheelList = ConfigMan.getInstance().getWheelList();
            break;
        case WheelType.Box:
            this.ndBox.visible = true;
            this.wheelList = ConfigMan.getInstance().getBoxWheelList();
            break;
    }

    if (this.isDailyWheel()) {
        if (this.isFreeWheel()) {
            game.playerMan.resetWheelLocked();
        }
        // replace
        //replace skin config.
        for (var i = 0; i < this.wheelList.length; ++i) {
            var wheel = this.wheelList[i];
            if (wheel.type === BoostType.SKIN) {
                var skinCfg = game.gameMan.getWheelRandomSkin();
                if (skinCfg) {
                    wheel.extra = {
                        type: BoostType.SKIN,
                        cfg: skinCfg,
                        image: skinCfg.image + ".png",
                        count: 1
                    };
                } else {
                    wheel.type = BoostType.DIAMOND;
                    wheel.image = "icon_diamond_1.png";
                    wheel.count = 100;
                    wheel.scale = 1.2;
                    wheel.probability = 5;
                }
            }
        }
    }

    this.initWheelUI();
    this.updateWheelItems();
    this.wheel = new Wheel(this.ndWheel, game.utils.getCurrentFPS());
    if (wheelType === WheelType.Box) {
        this.startWheel();
    }
};

WheelController.prototype.initWheelUI = function () {
    var wheels = this.wheelList;
    for (var i = 0; i < wheels.length; ++i) {
        this.wheelNodes[i].controller.initWith(wheels[i], this.wheelType);
    }
};

WheelController.prototype.isShowRewardedVideo = function () {
    return game.adsManager.isRewardVideoReady();
};

WheelController.prototype.onUpdate = function () {
    // this.updateWheelItems();
};

WheelController.prototype.isFreeWheel = function () {
    var leftTime = GameMan.getInstance().getWheelLeftTime();
    if (leftTime <= 0) {
        return true;
    }
    return false;
};

WheelController.prototype.getLeftHour = function () {
    var leftTime = GameMan.getInstance().getWheelLeftTime();
    return Math.ceil(leftTime / (60 * 60 * 1000));
};

WheelController.prototype.updateWheelItems = function () {
    //this.lblLeft.setString(_("wheel_reward_video_btn"));
    //this.lblLeftTips.setString(_("wheel_reward_video_tips"));

    //this.lblRight.setString(_("wheel_free_btn"));
    if (!this.isDailyWheel()) {
        return;
    }
    var freeWheel = this.isFreeWheel();
    this.ndFree.visible = false;
    this.ndWatchAds.visible = false;
    var leftCount = game.config.dailyWheelMaxCount - game.playerMan.getWheeledCount();
    var totalCount = game.config.dailyWheelMaxCount;
    var tips = _("free_coins_title") + "(" + leftCount + "/" + totalCount + ")";
    this.lblTips.setString("");
    if (freeWheel) {
        this.ndFree.visible = true;
        this.lbFree.setString(tips);
    } else {
        this.ndWatchAds.visible = true;
        this.lbWatchAds.setString(tips);
        if (leftCount <= 0) {
            this.btnWatchAds.enabled = false;
            this.lblTips.setString(game.utils.sprintf(_("wheel_free_tips"), this.getLeftHour()));
        } else {
            this.btnWatchAds.enabled = true;
        }
    }
};

WheelController.prototype.showWheelSoldOutAnim = function (id) {
    var wheelNode = this.wheelNodes[id - 1];
    wheelNode.controller.playSoldOutAnim();
};

WheelController.prototype.getRandomWheel = function () {
    var wheels = this.wheelList;
    var count = 0;
    for (var i = 0; i < wheels.length; ++i) {
        if (!this.isWheelLocked(wheels[i].id)) {
            count += wheels[i].probability;
        }
    }
    cc.log("count:" + count);
    var randomNum = game.utils.randomNextInt(count);
    cc.log("randomNum:" + randomNum);
    var sumProbability = 0;
    for (var i = 0; i < wheels.length; ++i) {
        if (this.isWheelLocked(wheels[i].id)) {
            continue;
        }
        if (sumProbability + wheels[i].probability > randomNum) {
            return wheels[i];
        } else {
            sumProbability += wheels[i].probability;
        }
    }
    return null;
};

WheelController.prototype.isWheelLocked = function (id) {
    if (!this.isDailyWheel()) {
        return false;
    }
    if (game.playerMan.isWheelLocked(id)) {
        return true;
    }
    return false;
};

WheelController.prototype.startWheel = function () {
    this.wheelConfig = this.getRandomWheel();
    var wheelId = this.wheelConfig.id;
    console.log("random wheel id:" + wheelId);
    this.wheel.rotate(this.WHEEL_TIME, 360 * 3 + (wheelId - 1) * this.WHEEL_ITEM_ANGLE, this.WHEEL_ITEM_ANGLE, this.onRotateEnd.bind(this));
    this.btnClose.enabled = false;
    this.btnSpinAgain.enabled = false;
    this.wheelInterval = setInterval(function () {
        game.audioPlayer.playEffectByKey("wheel_pin");
    }, 100);
    game.audioPlayer.playMusicByKey("wheel_bg");
    game.activityMan.addActivityTaskCount(game.activityTaskType.Wheel);
};

WheelController.prototype.onRotateEnd = function () {
    clearInterval(this.wheelInterval);
    game.audioPlayer.stopMusic();
    game.audioPlayer.playEffectByKey("wheel_stop");
    setTimeout(this.onShowReward.bind(this), 1000);
};

WheelController.prototype.onShowReward = function () {
    var wheel = this.wheelConfig;
    if (!this.isDailyWheel()) {
        StoreHelper.getInstance().popupRewardDoubleDlg(wheel.count, wheel.type, game.utils.isIOS() ? "zhuanpan02" : "jili02", function () {
            this.btnClose.enabled = true;
            this.btnSpinAgain.enabled = true;
            this.updateWheelItems();
        }.bind(this));
        return;
    }

    game.playerMan.setWheelLocked(wheel.id);
    var count = wheel.count;
    var type = wheel.type;
    var isSkinReward = false;
    if (wheel.type === BoostType.SKIN) {
        isSkinReward = true;
    }
    if (isSkinReward) {
        StoreHelper.getInstance().claimSkinReward(wheel.extra.cfg, true, function () {
            this.onWheelRewardClaimed(wheel.id);
        }.bind(this));
    } else {
        StoreHelper.getInstance().popupRewardDoubleDlg(count, type, game.utils.isIOS() ? "zhuanpan02" : "jili02", function () {
            this.onWheelRewardClaimed(wheel.id);
        }.bind(this));
    }
};

WheelController.prototype.onWheelRewardClaimed = function (id) {
    this.btnClose.enabled = true;
    this.updateWheelItems();
    this.showWheelSoldOutAnim(id);
};

WheelController.prototype.watchAdsWheelClicked = function () {
    AudioHelper.playBtnSound();
    var self = this;
    if (this.isShowRewardedVideo()) {
        StoreHelper.getInstance().checkAndShowRewardVideo(game.utils.isIOS() ? "zhuanpan01" : "jili01", function (rewarded) {
            if (rewarded) {
                self.startWheel();
            }
            // self.updateWheelItems();
        });
    }
    this.btnWatchAds.enabled = false;
};

WheelController.prototype.spinAgainClicked = function () {
    AudioHelper.playBtnSound();
    var self = this;
    if (this.isShowRewardedVideo()) {
        StoreHelper.getInstance().checkAndShowRewardVideo("spin_again", function (rewarded) {
            if (rewarded) {
                self.startWheel();
            }
        });
    }
};

WheelController.prototype.freeWheelClicked = function () {
    AudioHelper.playBtnSound();
    game.playerMan.setLastWheelTime(Date.now());
    this.btnFree.enabled = false;
    this.startWheel();
};

WheelController.prototype.closeClicked = function () {
    AudioHelper.playBtnSound();
    this.close();
};

WheelController.prototype.popup = function () {
    game.dialogManager.popup(this.rootNode, {popupAnim: true});
};

WheelController.prototype.close = function () {
    game.dialogManager.close(this.rootNode);
    if (this.closeCallback) {
        this.closeCallback();
        this.closeCallback = null;
    }
    window.lastWheelNode = null;
};

WheelController.createFromCCB = function() {
    if (window.lastWheelNode) {
        window.lastWheelNode.controller.close();
        window.lastWheelNode = null;
    }
    game.utils.registerController("WheelItemController", new WheelItemController());
    var node = game.utils.loadNodeFromCCB("res/wheel/wheel_view.ccbi", null, "WheelController", new WheelController());
    game.utils.unRegisterController("WheelItemController");
    window.lastWheelNode = node;
    return node;
};

module.exports = WheelController;
},{"../../common/wheel/Wheel":39,"../config/ConfigMan":52,"../enum/BoostType":154,"../enum/WheelType":168,"../model/GameMan":173,"../model/StoreHelper":178,"./WheelItemController":137}],137:[function(require,module,exports){
var BoostType = require("../enum/BoostType");
var WheelType = require("../enum/WheelType");

var WheelItemController = function () {
    BaseCCBController.call(this);
    this.ndSoldOut = null;
    this.spSoldOutCn = null;
    this.spSoldOutEn = null;
    this.sprIcon = null;
    this.lbCount = null;
};

game.utils.inherits(WheelItemController, BaseCCBController);

WheelItemController.prototype.onEnter = function () {
    BaseCCBController.prototype.onEnter.call(this);
};

WheelItemController.prototype.onExit = function () {
    BaseCCBController.prototype.onExit.call(this);
};

WheelItemController.prototype.onDidLoadFromCCB  = function() {
    BaseCCBController.prototype.onDidLoadFromCCB.call(this);
    this.spSoldOutCn.visible = false;
    this.spSoldOutEn.visible = false;
    if (game.local.isChinese()) {
        this.spSoldOutCn.visible = true;
    } else {
        this.spSoldOutEn.visible = true;
    }
};

WheelItemController.prototype.initWith = function (data, wheelType) {
    this.sprIcon.scale *= data.scale;
    if (wheelType === WheelType.DailyBonus && game.playerMan.isWheelLocked(data.id)) {
        this.ndSoldOut.visible = true;
    } else {
        this.ndSoldOut.visible = false;
    }
    if (data.type === BoostType.SKIN) {
        if (data.extra.type === BoostType.SKIN) {
            this.sprIcon.setSpriteFrame(data.extra.image);
            this.lbCount.setString("x" + data.extra.count);
            this.sprIcon.scale *= 1.6;
        } else {
            this.sprIcon.setSpriteFrame(data.extra.image);
            this.lbCount.setString("x" + data.extra.count);
            this.sprIcon.scale *= 1.2;
        }
    } else {
        this.sprIcon.setSpriteFrame(data.image);
        this.lbCount.setString("x" + data.count);
    }
};

WheelItemController.prototype.playSoldOutAnim = function () {
    this.ndSoldOut.visible = true;
    game.utils.playCCBAnimation(this.rootNode, "sold");
    game.audioPlayer.playEffectByKey("sold_out");
};

module.exports = WheelItemController;
},{"../enum/BoostType":154,"../enum/WheelType":168}],138:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/2.
 */

var Grid = cc.LayerColor.extend({

    col: 0,
    row: 0,

    editing: false,
    used: false,

    ctor: function (color, width, height, col, row) {
        this._super(color, width, height);
        this.ignoreAnchor = false;
        //this.type = type;
        this.col = col;
        this.row = row;
    },

    setColor: function (color) {
        this._super(color);
    }
});

module.exports = Grid;
},{}],139:[function(require,module,exports){
/**
 * Created by qinning on 2018/9/26
 **/
var ConfigMan = require("../../config/ConfigMan");

var EditorHelper = {
    /**
     * @type {CommonEvent}
     */
    CommonEvent: null,
    /**
     * @type {MapDisplayType}
     */
    MapDisplayType: null,
    /**
     * @type {EditorHttpConst}
     */
    EditorHttpConst: null,
    localServerPath: "http://localhost:8888",

    postData: function (url, callback, para) {
        url = this.localServerPath + url;
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = callback(xhttp);
        xhttp.open("POST", url, true);
        if (typeof para != "undifined") {
            xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xhttp.send(para);
        }
        else {
            xhttp.send();
        }
    },

    saveLevelConfig: function (levelCfg) {
        var levelConfigs = ConfigMan.getInstance().originalLevelList;
        if (levelCfg.id > 0) {
            levelConfigs[levelCfg.id - 1] = levelCfg;
        } else {
            levelConfigs.push(levelCfg);
        }

        var results = '{"levels": [\n';
        for (var i = 0; i < levelConfigs.length; ++i) {
            results += JSON.stringify(levelConfigs[i]);
            if (i !== levelConfigs.length - 1) {
                results += ",\n";
            } else {
                results += "\n";
            }
        }
        results += ']}';

        this.postData("/save_level_configs", function(xhttp) {
            return function() {
                if (xhttp.readyState == 4 && xhttp.status == 200) {
                    alert("save level config success");
                }
            };
        }, results);
    }
};

module.exports = EditorHelper;
},{"../../config/ConfigMan":52}],140:[function(require,module,exports){
var ConfigMan = require("../../config/ConfigMan");
var PlayerMan = require("../../model/PlayerMan");
var LevelConfig = require("../../config/LevelConfig");
var EditorHelper = require("../helper/EditorHelper");
var HttpClient = require("../../../common/net/HttpClient")
//var AdsReminderController = require("../../controller/AdsReminderController");

var ColorConfigs = [
    cc.color(252, 178, 0),
    cc.color(74, 233, 0),
    cc.color(27, 226, 255),
    cc.color(255, 252, 29),
    cc.color(255, 56, 56),
    cc.color(248, 70, 255),
    cc.color(255, 129, 17),
    cc.color(57, 103, 249),
    cc.color(90, 181, 110),

    cc.color(255, 90, 141),
    cc.color(242, 86, 9),
    cc.color(89, 59, 255),
    cc.color(157, 83, 255),
    cc.color(45, 232, 150),
    cc.color(176, 72, 206),
    cc.color(168, 246, 32),
    cc.color(46, 76, 255),
    cc.color(239, 221, 201),
    cc.color(253, 209, 133),
    cc.color(249, 74, 155),
    cc.color(29, 60, 94)
];

var GridType = {
    None: 0,
    Grid: 1,
    Wall: 2
}

var GrayColor = cc.color.GRAY;
var LightGrayColor = cc.color(130, 130, 130);
var StatusList = ["brick", "obstacle", "delete"];

var EditorScene = cc.Scene.extend({

    CONTENT_WIDTH: 600,
    CONTENT_HEIGHT: 600,

    COL: 50,
    ROW: 50,

    GRID_WIDTH: 9,
    GRID_HEIGHT: 9,

    GAP_WIDTH: 3,
    GAP_HEIGHT: 3,

    brickRects: null,

    obstacleRects: null,

    //_isBrick: true,
    _status: "brick",

    _brickItem: null,

    _levelEditBox: null,

    ctor: function () {
        game.playerMan = PlayerMan.getInstance();
        game.playerMan.initData();

        game.playerMan.setBoost(2, 400);
        game.playerMan.setBoost(3, 400);

        //var LogicMan = require("../../../common/model/LogicMan");
        //LogicMan.getInstance().startGame(true);
        //cc.BuilderReader.registerController("AdsReminderController", new AdsReminderController());

        this._super();

        var scale = 1.5;
        this.xOffset = (cc.winSize.width - this.CONTENT_WIDTH * scale) * 0.5;
        this.yOffset = (cc.winSize.height - this.CONTENT_HEIGHT * scale) * 0.5;

        this.brickRects = [];
        this.obstacleRects = [];

        this.currentRects = this.brickRects;
        this.selectColor = ColorConfigs[0];
        this.selectColorIndex = 0;

        this.gridNode = new cc.Node();
        this.addChild(this.gridNode);
        this.gridNode.x = this.xOffset;
        this.gridNode.y = this.yOffset;
        this.gridNode.scale = scale;

        this.initGrids();
        this.initButtons();
        this.initColorButtons();
        this.initEditBox();

        if (game.gameMan.levelCfg) {
            this.loadConfig(game.gameMan.levelCfg.originalConfig);
        }
    },

    initEditBox: function () {
        var xOffset = 200;
        this._levelEditBox = this.createEditBox("", "Input LevelId", cc.p(cc.winSize.width * 0.5 - xOffset, 100));
        this._boostEditBox = this.createEditBox("1", "Input Boost Probability", cc.p(cc.winSize.width * 0.5, 100));
        this._star3EditBox = this.createEditBox("90", "Input 3Star Time", cc.p(cc.winSize.width * 0.5 + xOffset, 100));
    },

    createEditBox: function (content, placeHolder, position) {
        var editBox = new cc.EditBox(cc.size(270, 100), new cc.Scale9Sprite("res/common/blank.png"),
            new cc.Scale9Sprite("res/common/blank.png"));
        editBox.setString(content);
        editBox.setPosition(position);
        editBox.setFontColor(cc.color(255, 255, 255));
        //editBox.setHintCo
        editBox.setPlaceholderFontColor(cc.color(255, 0, 0));
        editBox.setPlaceHolder(placeHolder);
        editBox.setDelegate(this);
        this.addChild(editBox);
        return editBox;
    },

    initButtons: function () {
        // Bugs Item
        var brickItem = new cc.MenuItemFont("Brick", this.onBrickTypeChange, this);
        // var saveItem = new cc.MenuItemFont("Save", this.onSave, this);
        var deleteItem = new cc.MenuItemFont("Undo", this.onDelete, this);
        //var refreshItem = new cc.MenuItemFont("Refresh", this.onRefresh, this);
        var addItem = new cc.MenuItemFont("Add", this.onAdd, this);
        var reduceItem = new cc.MenuItemFont("Reduce", this.onReduce, this);
        // var loadItem = new cc.MenuItemFont("Load", this.onLoad, this);
        // var previewItem = new cc.MenuItemFont("Preview", this.onPreview, this);
        // var duplicateItem = new cc.MenuItemFont("Duplicate", this.onDuplicateCheck, this);
        // var reachItem = new cc.MenuItemFont("Reach", this.onReachTest, this);
        // var nextItem = new cc.MenuItemFont("Next", this.onNext, this);
        var uploadItem = new cc.MenuItemFont("Upload", this.onUpload, this);
        var menu = new cc.Menu(brickItem, deleteItem, addItem, reduceItem, uploadItem);


        menu.alignItemsHorizontally();
        this.addChild(menu);
        menu.setPosition(cc.p(cc.winSize.width * 0.5, cc.winSize.height - 20));
        this._brickItem = brickItem;

        this._gridLabel = new cc.LabelTTF("", "Arial", 40);
        this.addChild(this._gridLabel);

        this._gridLabel.setAnchorPoint(cc.p(0, 0.5));

        this._gridLabel.setPosition(cc.p(100, cc.winSize.height - 80));

        this._gridLabel.setString(this.COL + "x" + this.ROW);
    },

    initColorButtons: function () {

        var items = [];
        for (var i = 0; i < ColorConfigs.length; ++i) {
            var colorItem = new cc.MenuItemFont(" O ", this.onSelectColor, this);
            colorItem.setColor(ColorConfigs[i]);
            colorItem.setTag(i);
            items.push(colorItem);
        }
        var menu = new cc.Menu(items.slice(0, items.length / 2 + 1));
        menu.alignItemsHorizontally();
        menu.setPosition(cc.p(cc.winSize.width * 0.5, cc.winSize.height - 55));
        this.addChild(menu);

        var bottomMenu = new cc.Menu(items.slice(items.length / 2 + 1));
        bottomMenu.alignItemsHorizontally();
        bottomMenu.setPosition(cc.p(cc.winSize.width * 0.5, cc.winSize.height - 90));
        this.addChild(bottomMenu);
    },

    onLoad: function (sender) {
        var levelString = this._levelEditBox.getString();
        var levelId = parseInt(levelString);
        if (isNaN(levelId)) {
            alert("level id not found:" + levelString);
        } else {
            var levelConfig = ConfigMan.getInstance().getOriginalLevelConfig(levelId);
            if (!levelConfig) {
                alert("level id not found:" + levelString);
            } else {
                this.loadConfig(levelConfig);
            }
        }
    },

    onPreview: function (sender) {
        var obj = this.generateLevelObj();
        var levelConfig = new LevelConfig();
        levelConfig.unmarshal(obj);
        levelConfig.originalConfig = obj;
        game.gameMan.levelCfg = levelConfig;
        game.gameMan.status = this._status;
        //var scene = new GameScene();
        var GameScene = require("./GameScene");
        //cc.winSize.width = cc.winSize.height * 0.5;
        cc.director.runScene(new GameScene());
    },

    onDuplicateCheck: function (sender) {
        var originalLevelList = ConfigMan.getInstance().originalLevelList;
        var foundDuplicate = false;
        for (var i = 0; i < originalLevelList.length - 1; ++i) {
            for (var j = i + 1; j < originalLevelList.length; ++j) {
                var levelCfg1 = originalLevelList[i];
                var levelCfg2 = originalLevelList[j];
                if (this.isEqualLevelCfgs(levelCfg1, levelCfg2)) {
                    alert("found duplicate level:" + (i + 1) + " and " + (j + 1));
                    foundDuplicate = true;
                    break;
                }
            }
            if (foundDuplicate) {
                break;
            }
        }
        if (!foundDuplicate) {
            alert("all is ok");
        }
    },

    onReachTest: function (sender) {
        var levelList = ConfigMan.getInstance().levelList;
        //if (this.isLevelReachable(levelList[23])) {
        //    alert("all is ok");
        //} else {
        //    alert("unreachable level");
        //}
        var findUnReachable = false;
        for (var i = 0; i < levelList.length; ++i) {
            if (!this.isLevelReachable(levelList[i])) {
                findUnReachable = true;
                alert("find unreachable level:" + (i + 1));
                break;
            }
        }
        if (!findUnReachable) {
            alert("all is ok");
        }
    },

    onNext: function (sender) {
        var levelString = this._levelEditBox.getString();
        var levelId = parseInt(levelString);
        if (isNaN(levelId)) {
            alert("level id not found:" + levelString);
        } else {
            var levelConfig = ConfigMan.getInstance().getOriginalLevelConfig(levelId + 1);
            if (!levelConfig) {
                alert("level id not found:" + levelString);
            } else {
                this._levelEditBox.setString(levelId + 1);
                this.loadConfig(levelConfig);
            }
        }
    },

    isLevelReachable: function (levelCfg) {
        var grids = [];
        var i, j, brickCfg, x, y;
        for (i = 0; i < levelCfg.width; ++i) {
            grids[i] = [];
            for (j = 0; j < levelCfg.height; ++j) {
                grids[i][j] = {
                    type: GridType.None,
                    find: false
                };
            }
        }
        for (i = 0; i < levelCfg.bricks.length; ++i) {
            brickCfg = levelCfg.bricks[i];
            for (x = 0; x < brickCfg.width; ++x) {
                for (y = 0; y < brickCfg.height; ++y) {
                    grids[brickCfg.x + x][brickCfg.y + y] = {
                        type: GridType.Grid,
                        find: false
                    };
                }
            }
        }
        for (i = 0; i < levelCfg.obstacles.length; ++i) {
            brickCfg = levelCfg.obstacles[i];
            for (x = 0; x < brickCfg.width; ++x) {
                for (y = 0; y < brickCfg.height; ++y) {
                    grids[brickCfg.x + x][brickCfg.y + y] = {
                        type: GridType.Wall,
                        find: false
                    };
                }
            }
        }

        var findFirstGridPoss = this.findFirstGrids(levelCfg, grids);
        if (findFirstGridPoss.length === 0) {
            return false;
        }
        for (x = 0; x < findFirstGridPoss.length; ++x) {
            var firstGridPos = findFirstGridPoss[x];
            this.searchGrid(grids, levelCfg, firstGridPos.x, firstGridPos.y);
        }
        var findGrid = false;
        for (i = 0; i < grids.length; ++i) {
            for (j = 0; j < grids[i].length; ++j) {
                if (grids[i][j].type === GridType.Grid) {
                    findGrid = true;
                    break;
                }
            }
            if (findGrid) {
                break;
            }
        }
        if (findGrid) {
            return false;
        }
        return true;
    },

    findFirstGrids: function (levelCfg, grids) {
        var i;
        var results = [];
        for (i = 0; i < levelCfg.width; ++i) {
            if (grids[i][0].type !== GridType.Wall) {
                results.push(cc.p(i, 0));
            }
        }
        return results;
    },

    searchGrid: function (grids, levelCfg, x, y) {
        if (x >= 0 && x < levelCfg.width && y >= 0 && y < levelCfg.height) {
            var grid = grids[x][y];
            if (grid.type === GridType.Wall) {
                return;
            }
            if (grid.find) {
                return;
            }
            grid.find = true;
            if (grid.type === GridType.Grid) {
                grid.type = GridType.None;
            }
            this.searchGrid(grids, levelCfg, x - 1, y);
            this.searchGrid(grids, levelCfg, x + 1, y);
            this.searchGrid(grids, levelCfg, x, y + 1);
            this.searchGrid(grids, levelCfg, x, y - 1);
        }
    },

    isEqualLevelCfgs: function (levelCfg1, levelCfg2) {
        if (JSON.stringify(levelCfg1.bricks) === JSON.stringify(levelCfg2.bricks) &&
            JSON.stringify(levelCfg1.obstacles) === JSON.stringify(levelCfg2.obstacles)) {
            return true;
        }
        return false;
    },

    generateLevelObj: function () {
        var boostProbability = Number(this._boostEditBox.getString());
        if (isNaN(boostProbability)) {
            boostProbability = 1;
        }

        var starTime = Number(this._star3EditBox.getString());
        if (isNaN(starTime)) {
            starTime = 90;
        }

        var id = parseInt(this._levelEditBox.getString());
        if (isNaN(id)) {
            id = undefined;
        }

        var obj = {
            id: id,
            b: boostProbability,
            starTime: starTime,
            pixelWidth: this.CONTENT_WIDTH,
            pixelHeight: this.CONTENT_HEIGHT,
            width: this.COL,
            height: this.ROW,
            bricks: this.brickRects,
            obstacles: this.obstacleRects
        };
        return obj;
    },

    loadConfig: function (config) {
        this.resetOldView();

        this.CONTENT_WIDTH = config.pixelWidth;
        this.CONTENT_HEIGHT = config.pixelHeight;
        this.COL = config.width;
        this.ROW = config.height;
        this.brickRects = config.bricks;
        this.obstacleRects = config.obstacles;

        //this.updateView();
        var width = this.CONTENT_WIDTH / this.COL;
        var height = this.CONTENT_HEIGHT / this.ROW;
        this.GRID_WIDTH = width * 0.75;
        this.GRID_HEIGHT = height * 0.75;
        this.GAP_WIDTH = width - this.GRID_WIDTH;
        this.GAP_HEIGHT = height - this.GRID_HEIGHT;

        this.initGrids();

        //this.brickRects = [];
        //this.obstacleRects = [];
        //this.currentRects = this.brickRects;
        //this._isBrick = true;
        //this._status = "brick";
        //this._brickItem.setString("Brick");
        if (game.gameMan.status) {
            this._status = game.gameMan.status;
        }
        this.updateBrickType();
        this._gridLabel.setString(this.COL + "x" + this.ROW);

        for (var i = 0; i < this.brickRects.length; ++i) {
            var brickRect = this.brickRects[i];
            this.markOccupiedWithRect(brickRect, ColorConfigs[brickRect[4] - 1]);
        }
        for (var i = 0; i < this.obstacleRects.length; ++i) {
            var brickRect = this.obstacleRects[i];
            this.markOccupiedWithRect(brickRect,  cc.color.WHITE);
        }
        this._levelEditBox.setString(config.id);
        this._boostEditBox.setString(config.b);
        this._star3EditBox.setString(config.starTime);
        //this.currentRects =
    },

    onSelectColor: function (sender) {
        this.selectColor = ColorConfigs[sender.getTag()];
        this.selectColorIndex = sender.getTag();
    },

    resetOldView: function () {
        this.forEachGrids(function (grid) {
            grid.removeFromParent();
        });
        this.grids = [];
    },

    updateView: function () {
        var width = this.CONTENT_WIDTH / this.COL;
        var height = this.CONTENT_HEIGHT / this.ROW;
        this.GRID_WIDTH = width * 0.75;
        this.GRID_HEIGHT = height * 0.75;
        this.GAP_WIDTH = width - this.GRID_WIDTH;
        this.GAP_HEIGHT = height - this.GRID_HEIGHT;

        this.initGrids();

        this.brickRects = [];
        this.obstacleRects = [];
        this.currentRects = this.brickRects;
        //this._isBrick = true;
        this._status = "brick";
        this._brickItem.setString("Brick");

        this._gridLabel.setString(this.COL + "x" + this.ROW);
    },

    onAdd: function () {
        this.resetOldView();
        this.COL += 4;
        this.ROW += 4;
        this.updateView();
    },

    onReduce: function () {
        this.resetOldView();
        this.COL -= 4;
        this.ROW -= 4;
        this.updateView();
    },

    onUpload: function () {
        var dict = {"Content-type": "application/json"};
        var obj = this.generateLevelObj();
        var content = {"content": JSON.stringify(obj)};
        HttpClient.doPost("http://server.minigame.io:7000/tools/upload_level", JSON.stringify(content), dict, function (error, text) {
            if (!error) {
                alert("upload success:" + text);
            } else {
                alert("upload failed:" + text);
            }
        });
    },

    onSave: function () {
        var obj = this.generateLevelObj();

        cc.log("results:" + JSON.stringify(obj));

        EditorHelper.saveLevelConfig(obj);
    },

    onDelete: function () {
        if (this._status !== "delete") {
            this.deleteLatestRect();
        }
    },

    onRefresh: function () {
        this.reset();
    },

    onBrickTypeChange: function () {
        this._status = StatusList[(StatusList.indexOf(this._status) + 1) % StatusList.length];
        //this._isBrick = !this._isBrick;
        this.updateBrickType();
    },

    updateBrickType: function () {
        this._brickItem.setString(this._status);
        if (this._status === "obstacle") {
            this.currentRects = this.obstacleRects;
        } else if (this._status === "brick") {
            this.currentRects = this.brickRects;
        } else {
            this.currentRects = null;
        }
    },

    initGrids: function () {
        this.grids = [];
        var Grid = require("../entity/Grid");
        for (var localCol = 0; localCol < this.COL; ++localCol) {
            this.grids.push([]);
            for (var localRow = 0; localRow < this.ROW; ++localRow) {
                var grid = new Grid(LightGrayColor, this.GRID_WIDTH, this.GRID_HEIGHT, localCol, localRow);
                this.gridNode.addChild(grid);
                grid.setPosition(this.getGridPos(localCol, localRow));
                this.grids[localCol].push(grid);
                this.markGrayHint(grid, localCol, localRow);
                grid._color = grid.color;
            }
        }
    },

    markGrayHint: function (grid, localCol, localRow) {
        var grayColor = GrayColor;
        var isLeft = (this.COL / localCol) > 2;
        var isBottom = (this.ROW / localRow) > 2;
        if (localCol === Math.floor(this.COL / 2) ||
            localCol === Math.floor(this.COL / 2) - 1 ||
            localRow === Math.floor(this.ROW / 2) ||
            localRow === Math.floor(this.ROW / 2) - 1
        ) {
            grid.setColor(grayColor);
        }

        var iii = isLeft ? 4 : 0;

        if (localCol % 5 === iii) {
            grid.setColor(grayColor);
        }

        var jjj = isBottom ? 4 : 0;

        if (localRow % 5 === jjj) {
            grid.setColor(grayColor);
        }

        //iii = isLeft ? 9 : 0;
        //jjj = isBottom ? 9 : 0;
        //
        //if (localCol % 10 === iii && localRow % 10 === jjj) {
        //    grid.setColor(cc.color.YELLOW);
        //}
    },

    reset: function () {
        for (var localCol = 0; localCol < this.COL; ++localCol) {
            for (var localRow = 0; localRow < this.ROW; ++localRow) {
                this.grids[localCol][localRow].editing = false;
                this.grids[localCol][localRow].setColor(LightGrayColor);
                this.grids[localCol][localRow].used = false;

                this.markGrayHint(this.grids[localCol][localRow], localCol, localRow);
            }
        }
        this.brickRects = [];
        this.obstacleRects = [];
        this.currentRects = this.brickRects;
        //this._isBrick = true;
        this._status = "brick";
        this._brickItem.setString("Brick");
    },

    onEnter:function () {
        this._super();
        cc.eventManager.addListener({
            event: cc.EventListener.TOUCH_ONE_BY_ONE,
            swallowTouches: true,
            onTouchBegan: this.onTouchBegan.bind(this),
            onTouchMoved: this.onTouchMoved.bind(this),
            onTouchEnded: this.onTouchEnded.bind(this),
            onTouchCancelled: this.onTouchCancelled.bind(this)
        }, this.gridNode);

        //cc.eventManager.addListener({
        //    event: cc.EventListener.KEYBOARD,
        //    onKeyReleased: function (keyCode, event) {
        //        if (keyCode === cc.KEY.backspace) {
        //            //cc.director.end();
        //            this.deleteLatestRect();
        //        }
        //    }.bind(this)
        //}, this);
    },

    onExit: function () {
        this._super();
    },

    getGridPos: function (localCol, localRow) {
        var gridSize = this.getGridSize();
        return cc.p((gridSize.width + this.GAP_WIDTH) * (localCol + 0.5),
            (gridSize.height + this.GAP_HEIGHT) * (localRow + 0.5));
    },

    getGridSize: function () {
        return cc.size(this.GRID_WIDTH, this.GRID_HEIGHT);
    },

    getFullGridSize: function () {
        return cc.size(this.GRID_WIDTH + this.GAP_WIDTH, this.GRID_HEIGHT + this.GAP_HEIGHT);
    },

    onTouchBegan:function(touch, event) {
        var grid = this.getClosestGrid(touch);
        if (!grid) {
            return false;
        }
        if (this._status === "delete") {
            this.firstGrid = grid;
            // grid.setColor(grid._color);
        } else {
            if (grid.used) {
                return false;
            }
            this.firstGrid = grid;
            grid.setColor(this.getCurrentColor());
        }
        return true;
    },

    onTouchMoved:function(touch, event) {
        if (this._status === "delete") {
            this.touchDelete(touch);
        } else {
            this.touchDraw(touch);
        }
        return true;
    },

    onTouchEnded:function(touch, event) {
        if (this._status === "delete") {
            this.touchDelete(touch);
        } else {
            this.touchDraw(touch);
        }

        if (this.firstGrid && this.lastGrid) {
            var region = this.getRegion(this.firstGrid, this.lastGrid);
            var index = this.selectColorIndex + 1;
            if (this._status !== "brick") {
                index = 0;
            }
            var rect = [region.minCol, region.minRow,
                region.maxCol - region.minCol + 1, region.maxRow - region.minRow + 1, index];
            var ccRect = cc.rect(rect[0], rect[1], rect[2], rect[3]);
            if (this._status === "delete") {
                this.deleteRectFromRects(ccRect, this.brickRects);
                this.deleteRectFromRects(ccRect, this.obstacleRects);
                this.forEachGrids(function (grid) {
                    grid.deleted = false;
                });
            } else {
                this.currentRects.push(rect);
                this.markOccupiedWithRect(rect, null);
                this.forEachGrids(function (grid) {
                    grid.editing = false;
                });
            }
        }

        this.firstGrid = null;
        this.lastGrid = null;
    },

    deleteRectFromRects: function (ccRect, rects) {
        for (var i = rects.length - 1; i >= 0; --i) {
            var brickRect = rects[i];
            var ccBrickRect = cc.rect(brickRect[0], brickRect[1], brickRect[2], brickRect[3]);
            var overlapsRect = cc.rectIntersection(ccRect, ccBrickRect);
            if (overlapsRect.width <= 0 || overlapsRect.height <= 0) {
                continue;
            }
            var resultRects = this.getOverlapsRects(overlapsRect, ccBrickRect);
            rects.splice(i, 1);
            for (var j = 0; j < resultRects.length; ++j) {
                rects.push(this.convertToJsonList(resultRects[j], brickRect[4]));
            }
        }
    },

    convertToJsonList: function (rect, color) {
        return [rect.x, rect.y, rect.width, rect.height, color];
    },

    getOverlapsRects: function (overlapsRect, brickRect) {
        var results = [
            cc.rect(brickRect.x, brickRect.y, brickRect.width, overlapsRect.y - brickRect.y),
            cc.rect(brickRect.x, cc.rectGetMaxY(overlapsRect), brickRect.width, cc.rectGetMaxY(brickRect) - cc.rectGetMaxY(overlapsRect)),
            cc.rect(brickRect.x, overlapsRect.y, overlapsRect.x - brickRect.x, overlapsRect.height),
            cc.rect(cc.rectGetMaxX(overlapsRect), overlapsRect.y, cc.rectGetMaxX(brickRect) - cc.rectGetMaxX(overlapsRect), overlapsRect.height)
        ];
        console.log("results:" + JSON.stringify(results));
        var rects = [];
        for (var i = results.length - 1; i >= 0; --i) {
            var rect = results[i];
            if (rect.width <= 0 || rect.height <= 0) {
                continue;
            }
            rects.push(rect);
        }
        return rects;
    },

    //markOccupied: function () {
    //    var region = this.getRegion(this.firstGrid, this.lastGrid);
    //
    //    for (var localCol = region.minCol; localCol <= region.maxCol; ++localCol) {
    //        for (var localRow = region.minRow; localRow <= region.maxRow; ++localRow) {
    //            this.grids[localCol][localRow].used = true;
    //        }
    //    }
    //},

    markOccupiedWithRect: function (rect, color) {
        for (var localCol = rect[0]; localCol < rect[0] + rect[2]; ++localCol) {
            for (var localRow = rect[1]; localRow < rect[1] + rect[3]; ++localRow) {
                if (this.grids[localCol]) {
                    this.grids[localCol][localRow].editing = false;
                    this.grids[localCol][localRow].used = true;
                    if (color) {
                        this.grids[localCol][localRow].setColor(color);
                    }
                } else {
                    console.log("error");
                }
            }
        }
    },

    isOccupied: function (grid) {
        var region = this.getRegion(this.firstGrid, grid);
        for (var localCol = region.minCol; localCol <= region.maxCol; ++localCol) {
            for (var localRow = region.minRow; localRow <= region.maxRow; ++localRow) {
                if (this.grids[localCol][localRow].used) {
                    return true;
                }
            }
        }
        return false;
    },

    touchDraw: function (touch) {
        if (!this.firstGrid) {
            return false;
        }
        var grid = this.getClosestGrid(touch);

        if (!grid) {
            return false;
        }

        if (grid === this.lastGrid) {
            return false;
        }

        if (this.isOccupied(grid)) {
            return false;
        }
        this.lastGrid = grid;
        this.clearRect();
        this.drawRect(grid);
        return true;
    },

    touchDelete: function (touch) {
       if (!this.firstGrid) {
           return false;
       }
       var grid = this.getClosestGrid(touch);

       if (!grid) {
           return false;
       }

       if (grid === this.lastGrid) {
           return false;
       }

       // if (this.isOccupied(grid)) {
       //     return false;
       // }
       this.lastGrid = grid;
       // this.clearRect();
       // this.drawRect(grid);
        this.drawDeleteRect(grid);
    },

    deleteLatestRect: function () {
        var rect = this.currentRects.pop();
        if (rect) {
            for (var localCol = rect[0]; localCol < rect[0] + rect[2]; ++localCol) {
                for (var localRow = rect[1]; localRow < rect[1] + rect[3]; ++localRow) {
                    var grid = this.grids[localCol][localRow];
                    grid.setColor(grid._color);
                    grid.used = false;
                }
            }
        }
    },

    clearRect: function () {
        this.forEachGrids(function (grid) {
            if (grid.editing && !grid.used) {
                grid.setColor(grid._color);
                grid.editing = false;
            }
        });
    },

    drawRect: function (grid) {
        var region = this.getRegion(this.firstGrid, grid);

        for (var localCol = region.minCol; localCol <= region.maxCol; ++localCol) {
            for (var localRow = region.minRow; localRow <= region.maxRow; ++localRow) {
                this.grids[localCol][localRow].editing = true;
                this.grids[localCol][localRow].setColor(this.getCurrentColor());
            }
        }
    },

    forEachGrids: function (cb) {
        for (var localCol = 0; localCol < this.COL; ++localCol) {
            for (var localRow = 0; localRow < this.ROW; ++localRow) {
                var grid = this.grids[localCol][localRow];
                cb(grid);
            }
        }
    },

    drawDeleteRect: function (grid) {
        var region = this.getRegion(this.firstGrid, grid);

        this.forEachGrids(function (grid) {
            if (grid.deleted) {
                grid.setColor(grid._showColor);
                grid.deleted = false;
            }
        });

        for (var localCol = region.minCol; localCol <= region.maxCol; ++localCol) {
            for (var localRow = region.minRow; localRow <= region.maxRow; ++localRow) {
                var grid = this.grids[localCol][localRow];
                // grid.editing = false;
                grid.used = false;
                grid.deleted = true;
                grid._showColor = grid.getColor();
                grid.setColor(grid._color);
            }
        }
    },

    getRegion: function (grid1, grid2) {
        var minRow = Math.min(grid1.row, grid2.row);
        var maxRow = Math.max(grid1.row, grid2.row);
        var minCol = Math.min(grid1.col, grid2.col);
        var maxCol = Math.max(grid1.col, grid2.col);
        return {
            minRow: minRow,
            maxRow: maxRow,
            minCol: minCol,
            maxCol: maxCol
        };
    },

    onTouchCancelled:function(touch, event) {
    },

    getClosestGrid: function (touch) {
        var localPos = this.gridNode.convertToNodeSpace(touch.getLocation());
        var gridSize = this.getFullGridSize();

        cc.log("localPos:" + JSON.stringify(localPos));

        var row = Math.floor(localPos.x / gridSize.width);
        var col = Math.floor(localPos.y / gridSize.height);

        cc.log("row:" + row + ",col:" + col);

        if (this.grids[row]) {
            return this.grids[row][col];
        }
        return null;
    },

    getCurrentColor: function () {
        if (this._status === "brick") {
            return this.selectColor;
        } else {
            return cc.color.WHITE;
        }
    }
    //
    //drawRect: function(region, color, clear) {
    //    if (clear){
    //        this._drawNode.clear();
    //    }
    //    if (region == null) {
    //        return;
    //    }
    //    var min = region.getMin();
    //    var max = region.getMax();
    //    max.x += 1;
    //    max.y += 1;
    //    this._drawNode.drawSegment(cc.p(min.x, min.y),
    //        cc.p(min.x, max.y), 1, color);
    //    this._drawNode.drawSegment(cc.p(min.x, max.y),
    //        cc.p(max.x, max.y), 1, color);
    //    this._drawNode.drawSegment(cc.p(max.x, max.y),
    //        cc.p(max.x, min.y), 1, color);
    //    this._drawNode.drawSegment(cc.p(max.x, min.y),
    //        cc.p(min.x, min.y), 1, color);
    //},
    //
    //drawRectFill: function (region, color) {
    //    if (region == null) {
    //        return;
    //    }
    //    this._drawNode.drawRect(region.getMin(), region.getMax(), color, 1, color);
    //}
});

module.exports = EditorScene;
},{"../../../common/net/HttpClient":32,"../../config/ConfigMan":52,"../../config/LevelConfig":54,"../../model/PlayerMan":174,"../entity/Grid":138,"../helper/EditorHelper":139,"./GameScene":141}],141:[function(require,module,exports){
var GameController = require("../../controller/GameController");

var GameScene = cc.Scene.extend({

    ctor: function () {
        this._super();
        var gameNode = GameController.createFromCCB();
        this.addChild(gameNode);
    }
});

module.exports = GameScene;

},{"../../controller/GameController":90}],142:[function(require,module,exports){
var GridType = require("../enum/GridType");
var ShapeType = require("../enum/ShapeType");
var GameMan = require("../model/GameMan");
var ItemCategory = require("../enum/ItemCategory");

var Ball = cc.Node.extend({

    type: GridType.BALL,
    body: null,
    sprite: null,
    addScale: 1,
    breaking: false,
    ctor: function (width) {
        this._super();
        this.bodyWidth = width;
        var skinCfg = GameMan.getInstance().getCurrentSkinCfg();
        var image = skinCfg.image + ".png";
        var sprite = new cc.PhysicsSprite("#" + image);
        this.addScale = skinCfg.scale;
        this.addChild(sprite);
        this.sprite = sprite;
        this.reset(width);
    },

    reset: function (width) {
        this.sprite.scaleX = width / this.sprite.width * this.addScale;
        this.sprite.scaleY = width / this.sprite.width * this.addScale;
        this.breaking = false;
    },

    updateSkin: function () {
        var skinCfg = GameMan.getInstance().getCurrentSkinCfg();
        var image = skinCfg.image + ".png";
        this.sprite.setSpriteFrame(cc.spriteFrameCache.getSpriteFrame(image));
        this.addScale = skinCfg.scale;
        this.reset(this.bodyWidth);
    },

    onExit: function () {
        this._super();
        this.removeBody();
    },

    update: function (dt) {
    },

    setAngleVel: function (w) {
        this.body.setAngVel(-cc.radiansToDegrees(w));
    },

    getBodyAngle: function () {
        return -cc.radiansToDegrees(this.body.a);
    },

    initBody: function (space, pos) {
        this.space = space;
        var bodyWidth = this.bodyWidth - 2;
        var body = new cp.Body(1, cp.momentForCircle(1, 0, bodyWidth, cp.v(0, 0)));
        var shape = new cp.CircleShape(body, bodyWidth / 2, cp.v(0, 0));
        shape.setElasticity(1);
        shape.setFriction(0);
        this.space.addShape(shape);
        this.space.addBody(body);
        shape.setCollisionType(ShapeType.BALL);
        body.userData = this;
        this.body = body;
        this.shape = shape;
        this.body.setPos(pos);
        body.setAngVel(3);

        //this.update(0);
        if (cc.sys.isNative) {
            shape.setFilter({
                group: cp.NO_GROUP,
                categories: ItemCategory.Ball,
                mask: ItemCategory.Obstacle
            });
        } else {
            shape.group = 1;
        }
        this.sprite.setBody(body);
    },

    getPosition: function () {
        return this.sprite.getPosition();
    },

    removeBody: function () {
        //console.log("Ball removeBody");
        if (this.body) {
            this.space.removeBody(this.body);
            this.space.removeShape(this.shape);
            //this.sprite.setBody(null);
            this.body = null;
            this.shape = null;
        }
    },

    setVel: function (directionPos) {
        this.body.setVel(directionPos);
    },

    getVel: function () {
        return this.body.getVel();
    }
});

module.exports = Ball;
},{"../enum/GridType":159,"../enum/ItemCategory":160,"../enum/ShapeType":164,"../model/GameMan":173}],143:[function(require,module,exports){
/**
 * Created by qinning on 2017/11/8.
 */
var Utils = require("../../common/util/Utils");

var BallPool = {
    MAX_POOL_SIZE: 300,
    _poolSize: {},
    _pool: {},

    setMaxPoolSize: function (name, count) {
        this._poolSize[name] = count;
    },

    getMaxPoolSize: function (name) {
        return this._poolSize[name] || this.MAX_POOL_SIZE;
    },

    putInPool: function (name, obj) {
        if (!this._pool[name]) {
            this._pool[name] = [];
        }
        if (this._pool[name].length < this.getMaxPoolSize(name)) {
            obj.retain && obj.retain();
            this._pool[name].push(obj);
        } else {
            cc.log("Symbol pool is full, throw away this symbol:" + name + ",max pool size:" + this.getMaxPoolSize(name));
        }
    },

    hasObject: function (name) {
        return (this._pool[name] && this._pool[name].length > 0);
    },

    removeObject: function (name, obj) {
        var list = this._pool[name];
        if (list) {
            for (var i = 0; i < list.length; i++) {
                if (obj === list[i]) {
                    // JSB release to avoid memory leak
                    obj.release && obj.release();
                    list.splice(i, 1);
                }
            }
        }
    },

    getFromPool: function (name) {
        if (this.hasObject(name)) {
            var obj = this._pool[name].pop();
            cc.sys.isNative && obj.release && Utils.autoRelease(obj);
            return obj;
        }
    },

    drainAllPools: function () {
        for (var i in this._pool) {
            if (this._pool.hasOwnProperty(i)) {
                for (var j = 0; j < this._pool[i].length; j++) {
                    var obj = this._pool[i][j];
                    // JSB release to avoid memory leak
                    obj.release && obj.release();
                }
            }
        }
        this._pool = {};
    }
};

module.exports = BallPool;
},{"../../common/util/Utils":38}],144:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/2.
 */

var GridType = require("../enum/GridType");
var BoardController = require("../controller/BoardController");
var ShapeType = require("../enum/ShapeType");
var ItemCategory = require("../enum/ItemCategory");

var Board = cc.Node.extend({

    type: GridType.BOARD,

    node: null,

    shape: null,

    ctor: function (width) {
        this._super();
        this.node = BoardController.createFromCCB(width);
        this.addChild(this.node);

        this.width = this.node.controller.ndBoard.width + 16;
        this.height = this.node.controller.ndBoard.height;
    },

    onExit: function () {
        this._super();
        this.removeBody();
    },

    removeBody: function () {
        //console.log("Board removeBody");
        if (this.body) {
            //this.space.removeBody(this.body);
            if (cc.sys.isNative) {
                this.space.removeShape(this.shape);
            } else {
                this.space.removeStaticShape(this.shape);
            }
            this.body = null;
            this.shape = null;
        }
    },

    initBody: function (space, pos) {
        this.setPosition(pos);
        this.space = space;

        var body;
        if (cc.sys.isNative) {
            body = new cp.Body(0, Infinity);
        } else {
            body = new cp.Body(Infinity, Infinity);
        }
        var shape = new cp.BoxShape(body, this.width, this.height);
        shape.setElasticity(1);
        shape.setFriction(0);
        shape.setCollisionType(ShapeType.BOARD);
        //shape.layers = 1;
        this.space.addStaticShape(shape);
        body.setPos(pos);
        body.userData = this;
        this.body = body;
        this.shape = shape;
        if (cc.sys.isNative) {
            shape.setFilter({
                group: cp.NO_GROUP,
                categories: ItemCategory.Obstacle,
                mask: ItemCategory.Ball
            });
        } else {
            this.space.reindexShape(this.shape);
        }
    },

    setPosX: function (posX) {
        this.x = posX;
        this.body.setPos(cc.p(this.x, this.y));
        if (!cc.sys.isNative) {
            this.space.reindexShape(this.shape);
        }
    },

    getBoundingBox: function () {
        return this.node.controller.ndBoard.getBoundingBoxToWorld();
    },

    hideBall: function () {
        this.node.controller.hideBall();
    },

    showBall: function () {
        this.node.controller.showBall();
    }
});

module.exports = Board;
},{"../controller/BoardController":71,"../enum/GridType":159,"../enum/ItemCategory":160,"../enum/ShapeType":164}],145:[function(require,module,exports){
var BoostType = require("../enum/BoostType");

var Boost = cc.Sprite.extend({

    type: 0,
    ctor: function (type) {
        this.type = type;
        switch (type) {
            case BoostType.LIFE:
                this._super("#icon_new_life.png");
                //this.setColor(cc.color.RED);
                break;
            case BoostType.SPLIT:
                this._super("#icon_3_multiple.png");
                //this.setColor(cc.color.BLUE);
                break;
            case BoostType.THREE_BALL:
                this._super("#icon_3_new.png");
                //this.setColor(cc.color.GREEN);
                break;
            case BoostType.BOMB:
                this._super("#icon_bomb.png");
                break;
            case BoostType.SUPER_BOARD:
                this._super("#icon_3_baffle.png");
                break;
        }
    }
});

module.exports = Boost;
},{"../enum/BoostType":154}],146:[function(require,module,exports){

var ChallengeData = function () {
    this.challengeLevel = 1;
    this.challengeMilestoneClaimId = 0;
    this.challengeReviveCount = 0;
    // this.challengeUnlockTips = false;
    this.challengeLevelMap = {};
    this.challengePlaying = false;
    // this.challengeEntered = false;
};

ChallengeData.prototype.unmarshal = function (json) {
    this.challengeLevel = json["challengeLevel"] || 1;
    this.challengeMilestoneClaimId = json["challengeMilestoneClaimId"] || 0;
    this.challengeReviveCount = json["challengeReviveCount"] || 0;
    // this.challengeUnlockTips = json["challengeUnlockTips"] || false;
    this.challengeLevelMap = json["challengeLevelMap"] || {};
    this.challengePlaying = json["challengePlaying"] || false;
    // this.challengeEntered = json["challengeEntered"] || false;
};

module.exports = ChallengeData;
},{}],147:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/2.
 */

var ShapeType = require("../enum/ShapeType");
var ItemCategory = require("../enum/ItemCategory");

var Grid = cc.Node.extend({

    isGift: false,
    type: 0,
    removeable: false,

    sprite: null,

    ball: null,

    ctor: function (color, width, height, type) {
        this._super();
        this.ignoreAnchor = false;
        this.sprite = new cc.Sprite("#grid.png");
        this.addChild(this.sprite);
        this.reset(color, width, height, type);
    },

    reset: function (color, width, height, type) {
        this.type = type;
        this.sprite.scaleX = width / this.sprite.width;
        this.sprite.scaleY = height / this.sprite.height;
        this.sprite.setColor(color);
        this.width = width;
        this.height = height;
    },

    onExit: function () {
        this._super();
        this.removeBody();
    },

    setGift: function () {
        this.isGift = true;
        var spriteFrame = cc.spriteFrameCache.getSpriteFrame("grid_gift.png");
        this.sprite.setSpriteFrame(spriteFrame);
        this.sprite.setColor(cc.color.WHITE);
        this.sprite.scaleX = (this.width + 4) / this.sprite.width;
        this.sprite.scaleY = (this.height + 4) / this.sprite.height;
    },

    setColor: function (color) {
        this._super();
        if (!this.isGift) {
            this.sprite.setColor(color);
        }
    },

    initBody: function (space, pos, gridWidth, gridHeight) {
        this.setPosition(pos);
        this.space = space;

        var body = new cp.Body(Infinity, Infinity);
        var shape = new cp.BoxShape(body, gridWidth, gridHeight);
        shape.setElasticity(1);
        shape.setFriction(0);
        //shape.layers = 1;
        this.space.addStaticShape(shape);
        shape.setCollisionType(ShapeType.BRICK);
        body.setPos(pos);
        this.body = body;
        body.userData = this;
        this.shape = shape;
        this.space.reindexShape(shape);
        if (cc.sys.isNative) {
            shape.setFilter({
                group: cp.NO_GROUP,
                categories: ItemCategory.Obstacle,
                mask: ItemCategory.Ball
            });
        }
    },

    removeBody: function () {
        //console.log("Grid removeBody");
        if (this.shape) {
            if (cc.sys.isNative) {
                this.space.removeShape(this.shape);
            } else {
                this.space.removeStaticShape(this.shape);
            }
            this.shape = null;
            this.body = null;
            this.removeable = false;
        }
        if (this.ball) {
            this.ball.breaking = false;
        }
    }
});

module.exports = Grid;
},{"../enum/ItemCategory":160,"../enum/ShapeType":164}],148:[function(require,module,exports){
var BoostType = require("../enum/BoostType");
var ShapeType = require("../enum/ShapeType");
var ItemCategory = require("../enum/ItemCategory");

var Key = cc.Sprite.extend({

    ctor: function () {
        this._super("#icon_key.png");
    }

    // initBody: function (space, pos) {
    //     this.setPosition(pos);
    //     this.space = space;
    //
    //     var body = new cp.Body(Infinity, Infinity);
    //     var shape = new cp.BoxShape(body, this.width, this.height);
    //     shape.setElasticity(1);
    //     shape.setFriction(0);
    //     //shape.layers = 1;
    //     this.space.addStaticShape(shape);
    //     shape.setCollisionType(ShapeType.KEY);
    //     body.setPos(pos);
    //     this.body = body;
    //     body.userData = this;
    //     this.shape = shape;
    //     this.space.reindexShape(shape);
    //     if (cc.sys.isNative) {
    //         shape.setFilter({
    //             group: cp.NO_GROUP,
    //             categories: ItemCategory.Key,
    //             mask: ItemCategory.Ball
    //         });
    //     }
    // },
    //
    // removeBody: function () {
    //     //console.log("Grid removeBody");
    //     if (this.shape) {
    //         if (cc.sys.isNative) {
    //             this.space.removeShape(this.shape);
    //         } else {
    //             this.space.removeStaticShape(this.shape);
    //         }
    //         this.shape = null;
    //         this.body = null;
    //     }
    // }
});

module.exports = Key;
},{"../enum/BoostType":154,"../enum/ItemCategory":160,"../enum/ShapeType":164}],149:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/2.
 */

var Obstacle = cc.Node.extend({

    ctor: function (color, width, height) {
        this._super(color, width, height);
        this.ignoreAnchor = false;
        this.sprite = new cc.Sprite("#grid.png");
        this.addChild(this.sprite);
        this.reset(color, width, height);
    },

    reset: function (color, width, height) {
        this.sprite.scaleX = width / this.sprite.width;
        this.sprite.scaleY = height / this.sprite.height;
        this.width = width;
        this.height = height;
        this.sprite.setColor(color);
    },

    setColor: function (color) {
        this._super();
        this.sprite.setColor(color);
    }
});

module.exports = Obstacle;
},{}],150:[function(require,module,exports){
/**
 * Created by oye on 15-5-17.
 */
var BoostType = require("../enum/BoostType");
var ChallengeData = require("../entity/ChallengeData");

var PlayerInfo = function(){
    this.playerId = "";
    this.bestScore = 0;
    this.removedAds = false;
    this.level = 0;
    this.progress = 0;
    this.levelMap = null;
    this.rated = false;

    this.boostMap = null;
    this.coins = 0;
    this.guided = false;

    this.hardLevel = 0;
    this.lastWheelTime = 0;
    this.currentSkinId = 0;
    this.interstitialAdCount = 0;
    this.rewardedAdCount = 0;

    this.createDt = 0;

    this.levelsMap = {};

    this.lastLoginDay = 0;
    this.consecutiveLoginDays = 1;
    this.lastClaimDailyBonusDay = 0;
    this.nextDayTips = false;

    this.skinMap = {};
    this.skinAdsCountMap = {};
    this.specialOfferMap = {};

    this.diamonds = 0;

    this.taskMap = {};
    this.skinAdjusted = false;
    this.lastShowRateTime = 0;

    this.rewardAdCountPerDay = {};
    this.rewardAdRecordDay = 0;
    this.iapCount = 0;
    this.failCountMap = {};
    this.lastLoginTime = 0;
    this.hasAimItem = false;
    this.lastDailyDiamondTime = 0;
    this.isAimVersion = false;

    this.challengeUnlockTips = false;
    this.challengeEntered = false;

    this.challengeDataMap = {};

    this.wheelLockIds = [];
    this.unlockedSuperBoard = false;
    this.boardMap = {};
    this.currentBoardId = 0;
    this.boardAdsCountMap = {};
    this.currentKeyCount = 0;

    this.activityTaskScoreMap = {};
    this.activityTaskClaimMap = {};

    this.activityStartTime = 0;

    this.dailyTaskCountMap = {};
    this.dailyTaskClaimMap = {};
    this.currentDay = 0;
    this.dailyTaskPoped = false;

    this.abTestGroup = {};
    this.skinPercent = 0;
    this.waitSkinId = 0;

    this.newHardLevel = 0;
};

PlayerInfo.prototype.unmarshall = function (json) {
    this.playerId = json["playerId"];
    this.bestScore = json["bestScore"] || 0;
    this.removedAds = json["removedAds"] || false;
    this.level = json["level"] || 1;
    this.progress = json["progress"] || 0;
    this.levelMap = json["levelMap"] || {};
    this.rated = json["rated"] || false;
    this.coins = json["coins"] || 0;
    this.guided = json["guided"] || false;
    this.boostMap = json["boostMap"] || {};
    this.hardLevel = json["hardLevel"] || 1;
    this.lastWheelTime = json["lastWheelTime"] || 0;
    this.currentSkinId = json["currentSkinId"] || 0;
    this.interstitialAdCount = json["interstitialAdCount"] || 0;
    this.rewardedAdCount = json["rewardedAdCount"] || 0;
    this.createDt = json["createDt"] || Date.now();
    this.levelsMap = json["levelsMap"] || {};
    this.lastLoginDay = json["lastLoginDay"] || 0;
    this.consecutiveLoginDays = json["consecutiveLoginDays"] || 1;
    this.lastClaimDailyBonusDay = json["lastClaimDailyBonusDay"] || 0;
    this.nextDayTips = json["nextDayTips"] || false;
    this.skinMap = json["skinMap"] || {
        "0": true
    };
    this.skinAdsCountMap = json["skinAdsCountMap"] || {};
    this.specialOfferMap = json["specialOfferMap"] || {};
    this.diamonds = json["diamonds"] || 50;
    this.taskMap = json["taskMap"] || {};
    this.skinAdjusted = json["skinAdjusted"] || false;
    this.lastShowRateTime = json["lastShowRateTime"] || 0;
    this.rewardAdCountPerDay = json["rewardAdCountPerDay"] || 0;
    this.rewardAdRecordDay = json["rewardAdRecordDay"] || 0;
    this.iapCount = json["iapCount"] || 0;
    this.failCountMap = json["failCountMap"] || {};
    this.lastLoginTime = json["lastLoginTime"] || Date.now();
    this.hasAimItem = json["hasAimItem"] || false;
    this.lastDailyDiamondTime = json["lastDailyDiamondTime"] || 0;
    this.isAimVersion = json["isAimVersion"] || false;

    this.challengeUnlockTips = json["challengeUnlockTips"] || false;
    this.challengeEntered = json["challengeEntered"] || false;

    this.challengeDataMap = json["challengeDataMap"] || {};
    if (json["challengeLevel"]) {
        var challenge1Data = new ChallengeData();
        challenge1Data.unmarshal(json);
        this.challengeDataMap["1"] = challenge1Data;
    }
    this.wheelLockIds = json["wheelLockIds"] || [];
    this.unlockedSuperBoard = json["unlockedSuperBoard"] || false;
    this.boardMap = json["boardMap"] || {
        "0": true
    };
    this.currentBoardId = json["currentBoardId"] || 0;
    this.boardAdsCountMap = json["boardAdsCountMap"] || {};
    this.currentKeyCount = json["currentKeyCount"] || 0;
    this.activityTaskScoreMap = json["activityTaskScoreMap"] || {};
    this.activityTaskClaimMap = json["activityTaskClaimMap"] || {};
    this.activityStartTime = json["activityStartTime"] || 0;

    this.dailyTaskCountMap = json["dailyTaskCountMap"] || {};
    this.dailyTaskClaimMap = json["dailyTaskClaimMap"] || {};
    this.dailyTaskPoped = json["dailyTaskPoped"] || false;
    this.currentDay = json["currentDay"] || game.utils.getCurrentDay();
    this.abTestGroup = json["abTestGroup"] || {};
    this.skinPercent = json["skinPercent"] || 0;
    this.waitSkinId = json["waitSkinId"] || 0;
    this.newHardLevel = json["newHardLevel"] || 0;
};

PlayerInfo.createDefault = function () {
    var playerInfo = new PlayerInfo();
    playerInfo.hintsCount = 5;
    playerInfo.bestScore = 0;
    playerInfo.removedAds = false;
    playerInfo.level = 730;
    playerInfo.progress = 0;
    playerInfo.levelMap = {};
    playerInfo.rated = false;
    playerInfo.coins = 0;
    playerInfo.guided = false;
    playerInfo.boostMap = {};
    playerInfo.boostMap[BoostType.SPLIT] = 500;
    playerInfo.boostMap[BoostType.THREE_BALL] = 500;
    playerInfo.hardLevel = 730;
    playerInfo.lastWheelTime = 0;
    playerInfo.currentSkinId = 0;
    playerInfo.interstitialAdCount = 0;
    playerInfo.rewardedAdCount = 0;
    playerInfo.createDt = Date.now();
    playerInfo.levelsMap = {};
    playerInfo.dailyBonusDt = Date.now();
    playerInfo.lastLoginDay = 0;
    playerInfo.consecutiveLoginDays = 1;
    playerInfo.lastClaimDailyBonusDay = 0;
    playerInfo.nextDayTips = false;
    playerInfo.skinMap = {
        "0": true
    };
    for (var i = 0; i <= 100; ++i) {
        playerInfo.skinMap[i] = true;
    }
    playerInfo.skinAdsCountMap = {};
    playerInfo.specialOfferMap = {};
    playerInfo.diamonds = 50;
    playerInfo.taskMap = {};
    playerInfo.skinAdjusted = false;
    playerInfo.lastShowRateTime = 0;
    playerInfo.rewardAdCountPerDay = 0;
    playerInfo.rewardAdRecordDay = 0;
    playerInfo.iapCount = 0;
    playerInfo.failCountMap = {};
    playerInfo.lastLoginTime = Date.now();
    playerInfo.hasAimItem = false;
    playerInfo.lastDailyDiamondTime = 0;
    playerInfo.isAimVersion = false;
    // playerInfo.challengeLevel = 1;
    // playerInfo.challengeMilestoneClaimId = 0;
    // playerInfo.challengeReviveCount = 0;
    playerInfo.challengeUnlockTips = false;
    // playerInfo.challengeLevelMap = {};
    // playerInfo.challengePlaying = false;
    playerInfo.challengeEntered = false;
    // playerInfo.challenge2Data = new ChallengeData();
    playerInfo.challengeDataMap = {};
    playerInfo.wheelLockIds = [];
    playerInfo.unlockedSuperBoard = false;
    playerInfo.boardMap = {
        "0": true
    };
    for (var i = 0; i <= 100; ++i) {
        playerInfo.boardMap[i] = true;
    }
    playerInfo.currentBoardId = 0;
    playerInfo.boardAdsCountMap = {};
    playerInfo.currentKeyCount = 0;
    playerInfo.activityTaskScoreMap = {};
    playerInfo.activityTaskClaimMap = {};
    playerInfo.activityStartTime = 0;
    playerInfo.dailyTaskCountMap = {};
    playerInfo.dailyTaskClaimMap = {};
    playerInfo.dailyTaskPoped = false;
    playerInfo.currentDay = game.utils.getCurrentDay();
    playerInfo.abTestGroup = {};
    playerInfo.skinPercent = 0;
    playerInfo.waitSkinId = 0;
    playerInfo.newHardLevel = 55;
    return playerInfo;
};

module.exports = PlayerInfo;

},{"../entity/ChallengeData":146,"../enum/BoostType":154}],151:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/2.
 */

var ShapeType = require("../enum/ShapeType");
var ItemCategory = require("../enum/ItemCategory");

var Wall = cc.Node.extend({

    body: null,
    shape: null,
    initBody: function (space, pos) {
        this.setPosition(pos);
        this.space = space;

        var body = new cp.Body(Infinity, Infinity);
        var shape = new cp.BoxShape(body, this.width, this.height);
        shape.setElasticity(1);
        shape.setFriction(0);
        //shape.layers = 1;
        this.space.addShape(shape);
        shape.setCollisionType(ShapeType.WALL);
        body.setPos(cc.pAdd(pos, cc.p(this.width * 0.5, this.height * 0.5)));
        body.userData = this;
        this.space.reindexShape(shape);
        if (cc.sys.isNative) {
            shape.setFilter({
                group: cp.NO_GROUP,
                categories: ItemCategory.Obstacle,
                mask: ItemCategory.Ball
            });
        }
        this.body = body;
        this.shape = shape;
    },

    removeBody: function () {
        //console.log("Ball removeBody");
        if (this.body) {
            this.space.removeShape(this.shape);
            this.body = null;
            this.shape = null;
        }
    }
});

module.exports = Wall;
},{"../enum/ItemCategory":160,"../enum/ShapeType":164}],152:[function(require,module,exports){
var ABTestType = {
    // Popup: 3,
    // DailyTask: 14,
    // Life: 5,
    // AdsInterval: 6,
    // Probability: 17,
    // AdsPlacement: 18,
    Level: 29,
    // Result: 10,
    // Challenge: 11,
    NUM: 8
};

module.exports = ABTestType;
},{}],153:[function(require,module,exports){
var ActivityTaskType = {
    Level: 1,
    ChallengeLevel: 2,
    OpenBox: 3,
    Wheel: 4,
    UseBoost: 5,
    ChestOpen: 6
};

ActivityTaskType.getName = function (type) {
    switch (type) {
        case ActivityTaskType.Level:
            return "Level";
        case ActivityTaskType.ChallengeLevel:
            return "ChallengeLevel";
        case ActivityTaskType.OpenBox:
            return "OpenBox";
        case ActivityTaskType.UseBoost:
            return "UseBoost";
        case ActivityTaskType.Wheel:
            return "Wheel";
        case ActivityTaskType.ChestOpen:
            return "ChestOpen";
    }
};

module.exports = ActivityTaskType;
},{}],154:[function(require,module,exports){

var BoostType = {
    LIFE: 1,
    THREE_BALL: 2,
    SPLIT: 3,
    GIFT: 4,
    SKIN: 5,
    DIAMOND: 6,
    BOMB: 7,
    AIM_ITEM: 8,
    SUPER_BOARD: 9,
    BOARD_SKIN: 10,
    CHRISTMAS_SKIN: 11,
    OPEN_BOX: 12,
    NUM: 12
};

module.exports = BoostType;
},{}],155:[function(require,module,exports){

var ChallengeId = {
    Normal: 1,
    Bomb: 2,
    TimeLimit: 3,
    LessGrid: 4,
    Laser: 5
};

module.exports = ChallengeId;
},{}],156:[function(require,module,exports){

var DailyTaskPos = {
    Menu: 1,
    PassCn: 2,
    PassEn: 3
};

DailyTaskPos.getName = function (pos) {
    switch (pos) {
        case DailyTaskPos.Menu:
            return "Menu";
        case DailyTaskPos.PassEn:
            return "Pass";
        case DailyTaskPos.PassCn:
            return "Pass";
    }
    return "None";
}

module.exports = DailyTaskPos;
},{}],157:[function(require,module,exports){
var FailReason = {
    Timeout: 1,
    Bomb: 2,
    Normal: 3,
    Laser: 4
};

module.exports = FailReason;
},{}],158:[function(require,module,exports){
/**
 * Created by qinning on 2017/5/7.
 */

var GameMode = {
    GAME_MODE_ENDLESS: 0,
    GAME_MODE_LEVEL: 1
};

module.exports = GameMode;
},{}],159:[function(require,module,exports){

var GridType = {
    OBSTACLE: 0,
    BRICK: 1,
    BALL: 2,
    BOARD: 3
};

module.exports = GridType;
},{}],160:[function(require,module,exports){
/**
 * Created by qinning on 2019/2/25
 **/

var ItemCategory = {
    Ball: 1 << 0,
    Obstacle: 1 << 1,
    Wall: 1 << 2,
    Key: 1 << 3
};

module.exports = ItemCategory;
},{}],161:[function(require,module,exports){
/**
 * Created by qinning on 2017/3/25.
 */

var LockStatus = {
    LOCK_STATUS_LOCK: 0,
    LOCK_STATUS_UNLOCK: 1,
    LOCK_STATUS_DOING: 2
};

module.exports = LockStatus;
},{}],162:[function(require,module,exports){

var RankType = {
    Friends: 0,
    Group: 1,
    Global:2
};

module.exports = RankType;
},{}],163:[function(require,module,exports){
/**
 * Created by qinning on 2018/1/1.
 */


var SceneType = {
    NONE: -1,
    LOADING: 0,
    MENU: 1,
    PACKAGE: 2,
    LEVEL: 3,
    GAME: 4,
    CHALLENGE: 5,
    CHALLENGE_LIST: 6
};

module.exports = SceneType;
},{}],164:[function(require,module,exports){

var ShapeType = {
    BALL: 1,
    BRICK: 2,
    BOARD: 3,
    WALL: 4,
    KEY: 5
};

module.exports = ShapeType;
},{}],165:[function(require,module,exports){

var SkinRewardType = {
    None: 0,
    LevelCount: 1,
    WatchAdCount: 2,
    WatchRewardAdCount: 3,
    Claimed: 4,
    Purchase: 5
};

module.exports = SkinRewardType;
},{}],166:[function(require,module,exports){
/**
 * Created by qinning on 2019/2/21
 **/

var SkinType = {
    WatchAds: 1,
    Diamonds: 2,
    Challenge: 3,
    KeyActivity: 4,
    Christmas: 5
};

module.exports = SkinType;
},{}],167:[function(require,module,exports){
/**
 * Created by qinning on 2017/12/16.
 */

var StoreType = {
    FREE: 1,
    NEW_3: 2,
    SPLIT: 3,
    REMOVE_ADS: 4,
    RESTORE: 5,
    FIRST_PURCHASE: 6,
    NEW_AND_SPLIT: 7,
    DIAMOND: 8,
    SKIN: 9,
    AIM_ITEM: 10,
    BOARD_SKIN: 11
};

module.exports = StoreType;
},{}],168:[function(require,module,exports){

var WheelType = {
    DailyBonus: 0,
    Box: 1
};

module.exports = WheelType;
},{}],169:[function(require,module,exports){
/**
 * Created by oye on 15/11/21.
 */

var EventsName = {
    EVENT_NAME_GAME_START: "event_name_start",
    EVENT_NAME_GAME_OVER: "event_name_game_over",
    EVENT_NAME_UPDATE_SCORE: "event_name_update_score",
    EVENT_NAME_UPDATE_LEFT_BULLET: "event_name_update_left_bullet",
    EVENT_NAME_UPDATE_BEST_SCORE: "event_name_update_best_score",
    EVENT_NAME_UPDATE_AUDIO: "event_name_update_audio",
    UPDATE_LEVEL: "update_level",
    COINS_UPDATE: "coins_update",
    REFRESH_BOOST: "refresh_boost",
    UPDATE_SKIN: "update_skin",
    UPDATE_SPECIAL_OFFER: "update_special_offer",
    PURCHASE_END: "purchase_end",
    DIALOG_POPED: "dialog_poped",
    DIALOG_CLOSED: "dialog_closed",
    DIAMONDS_UPDATE: "diamonds_update",
    TASK_UPDATE: "task_update",
    REWARDED_VIDEO_COUNT: "rewarded_video_count",
    UPDATE_AIM_ITEM: "update_aim_item",
    SHOW_AIM_GUIDE: "show_aim_guide",
    REWARD_REMOVE_AD: "reward_remove_ad",
    UPDATE_BOARD: "update_board",
    OPEN_KEY_BOX: "open_key_box",
    UPDATE_BOARD_SKIN_ITEM: "update_board_skin_item",
    UPDATE_ACTIVITY_TASK_SCORE: "update_activity_task_score",
    CLOSE_ACTIVITY_TASK: "close_activity_task"
};

module.exports = EventsName;
},{}],170:[function(require,module,exports){
var ConfigMan = require("../config/ConfigMan");
var BoostType = require("../enum/BoostType");
var StoreHelper = require("../model/StoreHelper");
var SkinType = require("../enum/SkinType");
var EventsName = require("../events/EventsName");

var ActivityMan = cc.Class.extend({

    addActivityTaskCount: function (type) {
        if (!this.isOpen()) {
            return;
        }
        // var config = ConfigMan.getInstance().getActivityTaskConfig(type);
        // var lastScore = game.playerMan.getActivityTaskScore(type);
        // var newScore = lastScore + config.score;
        // if (newScore > config.limit) {
        //     newScore = config.limit;
        // }
        game.analyseManager.trackEvent("DailyTaskCount", {"type": game.activityTaskType.getName(type)});

        // game.playerMan.setActivityTaskScore(type, newScore);
        game.playerMan.addActivityTaskCount(type);

        game.eventDispatcher.dispatchEvent(EventsName.UPDATE_ACTIVITY_TASK_SCORE);
    },

    getTotalActivityTaskPercent: function () {
        return Math.min(1, (this.getTotalActivityTaskCount() / this.getTotalActivityTaskLimitCount()));
    },

    getTotalActivityTaskCount: function () {
        var activityTaskList = ConfigMan.getInstance().getActivityTaskList();
        var currentScore = 0;
        for (var i = 0; i < activityTaskList.length; ++i) {
            var config = activityTaskList[i];
            var currentCount = game.activityMan.getActivityTaskCount(config.type);
            if (currentCount >= config.limit) {
                currentScore++;
            }
        }
        return currentScore;
    },

    getActivityTaskCount: function (type) {
        if (type === game.activityTaskType.ChallengeLevel) {
            if (game.challengeMan.isAllChallengeFinished()) {
                return 1;
            }
        }
        return game.playerMan.getActivityTaskCount(type);
    },

    getTotalActivityTaskLimitCount: function () {
        var configs = ConfigMan.getInstance().getActivityTaskRewards();
        return configs[configs.length - 1].score;
    },

    getActivityLeftTime: function () {
        var now = new Date();
        return (24 * 3600 - now.getHours() * 3600 - now.getMinutes() * 60 - now.getSeconds());
    },

    isActivityTaskCompleted: function (activityRewardCfg) {
        return this.getTotalActivityTaskCount() >= activityRewardCfg.score;
    },

    claimActivityTaskReward: function (activityTaskReward) {
        switch (activityTaskReward.type) {
            case BoostType.DIAMOND:
                StoreHelper.getInstance().popupAddDiamondsDlg(activityTaskReward.count, "activity_task_reward", null);
                break;
            case BoostType.SKIN:
                var skinCfg = game.gameMan.getWheelRandomSkin();
                if (skinCfg !== null) {
                    StoreHelper.getInstance().claimSkinReward(skinCfg, true);
                }
                break;
            case BoostType.CHRISTMAS_SKIN:
                var skinCfgs = ConfigMan.getInstance().getSkinListByType(SkinType.Christmas);
                if (skinCfgs && skinCfgs.length > 0) {
                    StoreHelper.getInstance().claimSkinReward(skinCfgs[0], true);
                }
                var boardCfgs = ConfigMan.getInstance().getBoardListByType(SkinType.Christmas);
                if (boardCfgs && boardCfgs.length > 0) {
                    StoreHelper.getInstance().claimBoardReward(boardCfgs[0], true);
                }
                break;
            case BoostType.OPEN_BOX:
                var lastKeyCount = game.playerMan.player.currentKeyCount;
                game.playerMan.setCurrentKeyCount(3);
                game.popupMan.popupBox(function () {
                    game.playerMan.setCurrentKeyCount(lastKeyCount);
                });
                break;
        }
        game.playerMan.setActivityTaskClaimed(activityTaskReward.id);
        game.analyseManager.trackEvent("DailyTaskRewardClaim", {"id": activityTaskReward.id});
        game.eventDispatcher.dispatchEvent(EventsName.UPDATE_ACTIVITY_TASK_SCORE);
    },

    isAllRewardClaimed: function () {
        var configs = ConfigMan.getInstance().getActivityTaskRewards();
        for (var i = 0; i < configs.length; ++i) {
            if (!game.playerMan.isActivityTaskClaimed(configs[i].id)) {
                return false;
            }
        }
        return true;
    },

    getUnCompletedTask: function () {
        var activityTaskList = ConfigMan.getInstance().getActivityTaskList();
        var currentScore = 0;
        for (var i = 0; i < activityTaskList.length; ++i) {
            var config = activityTaskList[i];
            var currentCount = game.activityMan.getActivityTaskCount(config.type);
            if (currentCount < config.limit) {
                currentScore++;
            }
        }
        return currentScore;
    },

    canShowActivityEntrance: function () {
        return this.isOpen() && !this.isAllRewardClaimed();
    },

    getNextStageRewardCfg: function () {
        var currentScore = this.getTotalActivityTaskCount();
        var configs = ConfigMan.getInstance().getActivityTaskRewards();
        for (var i = 0; i < configs.length; ++i) {
            var config = configs[i];
            if (currentScore < config.score) {
                return config;
            }
        }
        return configs[configs.length - 1];
    },

    getCurrentStageRewardCfg: function () {
        var currentScore = this.getTotalActivityTaskCount();
        var configs = ConfigMan.getInstance().getActivityTaskRewards();
        var index = 0;
        for (var i = 0; i < configs.length; ++i) {
            var config = configs[i];
            if (currentScore < config.score) {
                index = i;
                break;
            }
        }
        return configs[index - 1];
    },

    isOpen: function () {
        return game.gameMan.getMaxLevel() > this.getDailyTaskUnlockLevel();
    },

    getDailyTaskUnlockLevel: function () {
        return 20;
    },

    canClaimReward: function (data) {
        if (game.activityMan.isActivityTaskCompleted(data) && !game.playerMan.isActivityTaskClaimed(data.id)) {
            return true;
        }
        return false;
    },

    isRewardClaimed: function (data) {
        return game.playerMan.isActivityTaskClaimed(data.id);
    },

    hasUnClaimedReward: function () {
        var configs = ConfigMan.getInstance().getActivityTaskRewards();
        for (var i = 0; i < configs.length; ++i) {
            if (this.canClaimReward(configs[i])) {
                return true;
            }
        }
        return false;
    }
});

ActivityMan._instance = null;
ActivityMan._firstUseInstance = true;

/**
 *
 * @returns {ActivityMan}
 */
ActivityMan.getInstance = function () {
    if (ActivityMan._firstUseInstance) {
        ActivityMan._firstUseInstance = false;
        ActivityMan._instance = new ActivityMan();
    }
    return ActivityMan._instance;
};

module.exports = ActivityMan;
},{"../config/ConfigMan":52,"../enum/BoostType":154,"../enum/SkinType":166,"../events/EventsName":169,"../model/StoreHelper":178}],171:[function(require,module,exports){
var AdsPlace = require("../../common/enum/AdsPlace");

var AdsHelper = cc.Class.extend({

    ctor: function () {
    },

    showPassAds: function () {
        if (game.gameMan.getMaxLevel() >= game.adsManager.startLevelLimit) {
            game.adsManager.showInterstitial(AdsPlace.Pass);
        }
    },

    showBackgroundAds: function () {
        if (game.gameMan.getMaxLevel() >= game.adsManager.startLevelLimit) {
            game.adsManager.showInterstitial(AdsPlace.BackGround);
        }
    },

    showBackHomeAds: function () {
        if (game.gameMan.getMaxLevel() >= game.adsManager.startLevelLimit) {
            game.adsManager.showInterstitial(AdsPlace.Home);
        }
    },

    showRefreshAds: function () {
        if (game.gameMan.getMaxLevel() >= game.adsManager.startLevelLimit) {
            game.adsManager.showInterstitial(AdsPlace.Refresh);
        }
    }

    // onEnterBackground: function () {
    //     game.adsManager.setInterstitialShowed(AdsPlace.BackGround);
    // }
});

AdsHelper.sharedDirector = null;
AdsHelper.firstUseDirector = true;

AdsHelper.getInstance = function () {
    if (AdsHelper.firstUseDirector) {
        AdsHelper.firstUseDirector = false;
        AdsHelper.sharedDirector = new AdsHelper();
    }
    return AdsHelper.sharedDirector;
};

module.exports = AdsHelper;
},{"../../common/enum/AdsPlace":13}],172:[function(require,module,exports){
var ConfigMan = require("../config/ConfigMan");
var BoostType = require("../enum/BoostType");
var ChallengeId = require("../enum/ChallengeId");

var ChallengeMan = cc.Class.extend({

    TOTAL_LIFE_COUNT: 3,

    currentChallengeId: -1,

    ctor: function () {
    },

    checkAndShowChallenge: function (goCB, cancelCB) {
        if (game.playerMan.player.challengeUnlockTips) {
            cancelCB && cancelCB();
            return false;
        }
        if (game.gameMan.getMaxLevel() > this.getUnlockLevel(ChallengeId.Normal) && game.playerMan.getRegisterDay() > game.adsManager.challengeTipsDay) {
            game.playerMan.setChallengeUnlockTipsShowed();
            game.popupMan.popupYesNoCommonDlg(_("challenge_tips"), _("confirm_info"), _("no_title"), function () {
                game.gameMan.isChallengeLevel = true;
                game.challengeMan.currentChallengeId = ChallengeId.Normal;
                game.sceneMan.switchScene(game.sceneType.CHALLENGE);
                game.analyseManager.trackEvent("ChallengeEnter", {"source": "recommend"});
                goCB && goCB();
            }, function () {
                cancelCB && cancelCB();
            });
            return true;
        }
        else {
            cancelCB && cancelCB();
        }
    },

    getChallengeInfoCfg: function (challengeId) {
        return ConfigMan.getInstance().getChallenge().getChallengeInfoCfg(challengeId);
    },

    getUnlockLevel: function (challengeId) {
        var challengeInfoCfg = ConfigMan.getInstance().getChallenge().getChallengeInfoCfg(challengeId);
        return challengeInfoCfg.levelLimit;
    },

    isChallengeUnlocked: function (challengeId) {
        if (game.gameMan.getMaxLevel() > this.getUnlockLevel(challengeId)) {
            return true;
        }
        return false;
    },

    isAllChallengeUnlocked: function () {
        var challenges = ConfigMan.getInstance().getChallenge().challenges;
        for (var i = 0; i < challenges.length; ++i) {
            if (this.isChallengeUnlocked(challenges[i].id)) {
                return true;
            }
        }
        return false;
    },

    isAllChallengeFinished: function () {
        var challenges = ConfigMan.getInstance().getChallenge().challenges;
        for (var i = 0; i < challenges.length; ++i) {
            var challengeLevel = game.playerMan.getOrCreateChallenge(challenges[i].id).challengeLevel;
            var challengeLevelList = ConfigMan.getInstance().getChallengeLevelList(challenges[i].id);
            if (challengeLevel <= challengeLevelList.length) {
                return false;
            }
        }
        return true;
    },

    // isChallengeAllFinished: function () {
    //     var levelCfg = this.getLevelConfig(game.playerMan.player.challengeLevel);
    //     if (!levelCfg) {
    //         return true;
    //     }
    //     return false;
    // },

    getLevelConfig: function (levelId) {
        var challengeLevelList = ConfigMan.getInstance().getChallengeLevelList(this.currentChallengeId);
        return challengeLevelList[levelId - 1];
    },

    getChallenge: function (milestoneId) {
        var challenges = ConfigMan.getInstance().getChallenge().getChallengeList(this.currentChallengeId);
        cc.log("ccc---challenges count:" + challenges.length);
        cc.log("ccc---milestoneId:" + milestoneId);
        for (var i = 0; i < challenges.length; ++i) {
            var challege = challenges[i];
            if (challege.id === milestoneId) {
                return challege;
            }
        }
        return null;
    },

    isMilestonePassed: function (milestoneId) {
        var challenge = this.getChallenge(milestoneId);
        if (this.getChallengeLevel() > challenge.level) {
            return true;
        }
        return false;
    },

    getCurrentMilestoneId: function () {
        var currentLevel = this.getChallengeLevel();
        return Math.floor((currentLevel - 1) / 5) + 1;
    },

    isMilestoneRewardClaimed: function (milestoneId) {
        if (game.playerMan.getOrCreateChallenge(this.currentChallengeId).challengeMilestoneClaimId >= milestoneId) {
            return true;
        }
        return false;
    },

    checkAndShowRollback: function (callback) {
        var playing = game.playerMan.getOrCreateChallenge(game.challengeMan.currentChallengeId).challengePlaying;
        cc.log("challengePlaying:" + playing);
        if (playing) {
            game.popupMan.popupCommonDlg(game.utils.sprintf(_("challenge_restart_tips"), game.challengeMan.getRollbackLevel()), callback);
            game.challengeMan.rollBackProgress();
        } else {
            callback && callback();
        }
    },

    checkAndShowRewards: function () {
        var challenges = ConfigMan.getInstance().getChallenge().getChallengeList(this.currentChallengeId);
        var waitingClaimChallenge = null;
        for (var i = 0; i < challenges.length; ++i) {
            var challege = challenges[i];
            if (this.isMilestonePassed(challege.id) && !this.isMilestoneRewardClaimed(challege.id)) {
                waitingClaimChallenge = challege;
                break;
            }
        }

        if (waitingClaimChallenge) {
            var self = this;
            var challengeId = this.currentChallengeId;
            game.popupMan.popupGetRewards(waitingClaimChallenge.rewards, function () {
                for (var i = 0; i < waitingClaimChallenge.rewards.length; ++i) {
                    self.claimReward(waitingClaimChallenge.rewards[i]);
                }
                game.playerMan.setChallengeMilestoneRewardClaimed(waitingClaimChallenge.id, challengeId);
            });
        }
    },

    claimReward: function (rewardCfg) {
        switch (rewardCfg.type) {
            case BoostType.SKIN:
                game.playerMan.setClaimedSkin(rewardCfg.param1);
                game.playerMan.setCurrentSkinId(rewardCfg.param1);
                break;
            case BoostType.DIAMOND:
                game.playerMan.addDiamonds(rewardCfg.count, "challenge");
                break;
            case BoostType.THREE_BALL:
                game.playerMan.addBoost(BoostType.THREE_BALL, rewardCfg.count);
                break;
            case BoostType.SPLIT:
                game.playerMan.addBoost(BoostType.SPLIT, rewardCfg.count);
                break;
            case BoostType.BOARD_SKIN:
                game.playerMan.setClaimedBoard(rewardCfg.param1);
                game.playerMan.setCurrentBoardId(rewardCfg.param1);
                break;
        }
    },

    popupQuitTips: function (quitCallback, cancelCallback) {
        game.popupMan.popupYesNoCommonDlg(game.utils.sprintf(_("challenge_restart_tips"), this.getRollbackLevel()),
            _("restart_title"), _("relife_title"), function () {
            quitCallback && quitCallback();
        }, function () {
            cancelCallback && cancelCallback();
        });
    },

    getRollbackLevel: function () {
        var currentLevel = this.getChallengeLevel();
        var rollBackLevel = Math.floor((currentLevel - 1) / 5) * 5 + 1;
        return rollBackLevel;
    },

    rollBackProgress: function () {
        game.playerMan.setChallengeLevel(this.getRollbackLevel(), this.currentChallengeId);
        game.playerMan.rollbackChallengeReviveCount(this.currentChallengeId);
        game.playerMan.setChallengePlaying(false, game.challengeMan.currentChallengeId);
    },

    canRevive: function () {
        return game.playerMan.getOrCreateChallenge(game.challengeMan.currentChallengeId).challengeReviveCount < this.TOTAL_LIFE_COUNT;
    },

    getChallengeLevel: function () {
        return game.playerMan.getOrCreateChallenge(game.challengeMan.currentChallengeId).challengeLevel;
    }
});

ChallengeMan._instance = null;
ChallengeMan._firstUseInstance = true;

/**
 *
 * @returns {ChallengeMan}
 */
ChallengeMan.getInstance = function () {
    if (ChallengeMan._firstUseInstance) {
        ChallengeMan._firstUseInstance = false;
        ChallengeMan._instance = new ChallengeMan();
    }
    return ChallengeMan._instance;
};

module.exports = ChallengeMan;
},{"../config/ConfigMan":52,"../enum/BoostType":154,"../enum/ChallengeId":155}],173:[function(require,module,exports){
/**
 * Created by qinning on 15/5/12.
 */
var EventsName = require("../events/EventsName");
var ConfigMan = require("../config/ConfigMan");
var AdsPlace = require("../../common/enum/AdsPlace");
var StoreHelper = require("../model/StoreHelper");
var ChallengeId = require("../enum/ChallengeId");
var BoostType = require("../enum/BoostType");
var SkinType = require("../enum/SkinType");
//var ShareConfig = require("../config/ShareConfig");
//var ConfigMan = require("../config/ConfigMan");

//var BoostProbabilityMap = {
//
//};

var GameMan = cc.Class.extend({
    FREE_WHEEL_HOURS: 12,

    ONE_HOUR_SECONDS: 60 * 60 * 1000,
    startTime: 0,
    resultCount: 0,
    rated: false,
    endTime: 0,
    canReLife: true,
    distance: 0,
    levelId: 1,
    hardMode: false,
    newHardMode: false,
    giftCount: 0,
    lastShowLevel: 0,

    totalFailCount: 0,
    poped3StarTips: false,
    firstEnterAdShowed: false,

    isTryAimItem: false,
    watchAdsMap: null,

    isChallengeLevel: false,

    flyGiftAppearCount: 0,

    canUseAimItem: function () {
        var purchasedAimItem = game.playerMan.player.hasAimItem;
        var tryAimItem = this.isTryAimItem;
        return purchasedAimItem || tryAimItem;
    },

    canTryAimItem: function () {
        var isLevelOK = game.playerMan.getLevel() >= 10;
        var purchasedAimItem = game.playerMan.player.hasAimItem;
        return isLevelOK && !purchasedAimItem;
    },

    tryAimItem: function () {
        this.isTryAimItem = true;
        game.eventDispatcher.dispatchEvent(EventsName.SHOW_AIM_GUIDE);
    },

    resetTryAnimItem: function () {
        this.isTryAimItem = false;
    },

    getBoostProbability: function (config) {
        var failCount = game.playerMan.getFailCount(config.levelId);
        var boostProbability = config.boostProbability;
        if (!this.isLessGridChallenge()) {
            if (failCount === 4) {
                return boostProbability + 0.2;
            } else if (failCount === 5) {
                return boostProbability + 0.4;
            } else if (failCount > 5) {
                return boostProbability + 0.5;
            }
        }
        return boostProbability;
    },

    isLessGridChallenge: function () {
        if (this.isChallengeLevel && game.challengeMan.currentChallengeId === ChallengeId.LessGrid) {
            return true;
        }
        return false;
    },

    setHardMode: function (hardMode) {
        this.hardMode = hardMode;
    },

    setNewHardMode: function (newHardMode) {
        this.newHardMode = newHardMode;
    },

    canPop3StarTips: function () {
        return !this.poped3StarTips;
    },

    setPop3StarTips: function () {
        this.poped3StarTips = true;
    },

    isHardMode: function () {
        return this.hardMode;
    },

    isNewHardMode: function () {
        return this.newHardMode;
    },

    getPlayerLevel: function () {
        if (this.isNewHardMode()) {
            return game.playerMan.getNewHardLevel();
        }
        if (this.isHardMode()) {
            return game.playerMan.getHardLevel();
        } else {
            return game.playerMan.getLevel();
        }
    },

    ctor: function () {
        this.watchAdsMap = {
            skin: {
                count: 0,
                callback: this.checkWatchAdsGetSkin.bind(this)
            },
            card: {
                count: 0,
                callback: this.checkWatchAdsFlipCard.bind(this)
            },
            box: {
                count: 0,
                callback: this.checkWatchAdsOpenBox.bind(this)
            }
        };
        this.watchAdsList = [];
        for (var key in this.watchAdsMap) {
            if (this.watchAdsMap.hasOwnProperty(key)) {
                this.watchAdsList.push(this.watchAdsMap[key]);
            }
        }
    },

    init: function () {
        this.rated = game.playerMan.player.rated;
        this.chooseLatestLevel();
    },

    chooseLatestLevel: function () {
        if (this.isNewHardMode()) {
            if (game.playerMan.getNewHardLevel() <= this.getLevelList().length) {
                this.levelId = game.playerMan.getNewHardLevel();
                return true;
            }
        } else
        if (this.isHardMode()) {
            if (game.playerMan.getHardLevel() <= this.getLevelList().length) {
                this.levelId = game.playerMan.getHardLevel();
                return true;
            }
        } else {
            if (game.playerMan.getLevel() <= this.getLevelList().length) {
                this.levelId = game.playerMan.getLevel();
                return true;
            } else {
                this.setHardMode(true);
                if (game.playerMan.getHardLevel() <= this.getLevelList().length) {
                    this.levelId = game.playerMan.getHardLevel();
                    return true;
                }
            }
        }
        return false;
    },

    getLevelList: function () {
        if (this.isChallengeLevel) {
            return ConfigMan.getInstance().getChallengeLevelList(game.challengeMan.currentChallengeId);
        } else {
            if (this.isNewHardMode()) {
                return ConfigMan.getInstance().getNewHardLevelList();
            }
            return ConfigMan.getInstance().getLevelList();
        }
    },

    updateScore: function () {
        game.eventDispatcher.dispatchEvent(EventsName.EVENT_NAME_UPDATE_SCORE);
    },

    //gameOver: function () {
    //    //game.analyseManager.trackFailedProgressionEvent("level", game.playerMan.getLevel());
    //    this.resultCount++;
    //},

    getMissionKey: function () {
        if (this.isNewHardMode()) {
            return "new_hard_level_" + this.levelId;
        }
        if (!this.isHardMode()) {
            return "normal_level_" + this.levelId;
        } else {
            return "hard_level_" + this.levelId;
        }
    },

    onGameStart: function () {
        game.analyseManager.missionBegan(this.getMissionKey());
    },

    getCurrentStar: function (costTime) {
        //cc.log("costTime:" + costTime);
        var levelCfg = this.getCurConfig();
        var star = 1;
        if (costTime <= levelCfg.starTime) {
            star = 3;
        } else if (costTime <= levelCfg.starTime * 2) {
            star = 2;
        }
        return star;
    },

    getProgressPercent: function (costTime) {
        var levelCfg = this.getCurConfig();
        return Math.max(0, 1 - (costTime / levelCfg.starTime / 3)) * 100;
    },

    getCurrentRewardDiamonds: function () {
        if (this.isNewStarData || this.lastStar === 0) {
            var lastRewardDiamonds = game.config.rewardDiamondMap[this.lastStar] || 0;
            var currentRewardDiamonds = game.config.rewardDiamondMap[this.currentStar] || 0;
            return Math.max(currentRewardDiamonds - lastRewardDiamonds, 1);
        }
        return 1;
    },

    hasStarTag: function () {
        var hasStarTag = false;
        if (this.isNewHardMode()) {
            hasStarTag = game.playerMan.getLevelData(this.levelId, "newHardStarTag") || false;
        } else
        if (!this.isHardMode()) {
            hasStarTag = game.playerMan.getLevelData(this.levelId, "starTag") || false;
        } else {
            hasStarTag = game.playerMan.getLevelData(this.levelId, "hardStarTag") || false;
        }
        return hasStarTag;
    },

    onWatchAdsGet3Star: function (levelId) {
        var star = 3;
        if (this.isNewHardMode()) {
            this.updateNewHardLevelStar(levelId, star);
        } else
        if (!this.isHardMode()) {
            this.updateLevelStar(levelId, star);
        } else {
            this.updateHardLevelStar(levelId, star);
        }
        this.currentStar = 3;
    },

    gameWin: function (costTime) {
        if (this.isChallengeLevel) {
            if (!game.playerMan.isChallengeLevelSuccessed(this.levelId, game.challengeMan.currentChallengeId)) {
                game.analyseManager.trackEvent("challenge_level_pass_" + game.challengeMan.currentChallengeId, {
                    "level": this.levelId
                });
            }
            game.playerMan.setChallengeLevelSuccessed(this.levelId, game.challengeMan.currentChallengeId);
            if (this.levelId % 5 === 0) {
                game.playerMan.rollbackChallengeReviveCount(game.challengeMan.currentChallengeId);
            }
            this.resultCount++;
            this.levelId++;
            game.playerMan.setChallengeLevel(this.levelId, game.challengeMan.currentChallengeId);
            game.playerMan.setChallengePlaying(false, game.challengeMan.currentChallengeId);
            game.activityMan.addActivityTaskCount(game.activityTaskType.ChallengeLevel);
            return;
        }

        if (this.isNewHardMode()) {
            this.lastStar = game.playerMan.getNewHardLevelStar(this.levelId);
        } else
        if (!this.isHardMode()) {
            this.lastStar = game.playerMan.getLevelStar(this.levelId);
        } else {
            this.lastStar = game.playerMan.getHardLevelStar(this.levelId);
        }

        game.analyseManager.missionCompleted(this.getMissionKey());

        this.isNewStarData = this.hasStarTag();

        var star = this.getCurrentStar(costTime);

        //this.onGameWin(star);
        this.currentStar = star;
        var hasPssed = false;
        var levelIdAndStar = this.levelId + "-" + star;
        if (this.isNewHardMode()) {
            if (game.playerMan.getNewHardLevelStar(this.levelId) > 0) {
                hasPssed = true;
            }
            this.updateNewHardLevelStar(this.levelId, star);
            if (!hasPssed) {
                game.analyseManager.trackEvent("level_pass_new_hard", {
                    "level": this.levelId
                });
                game.analyseManager.trackEvent("level_pass_new_hard_star", {
                    levelStarKey: levelIdAndStar
                });
                var levelGroup = game.playerMan.getRealGroup(game.abTestType.Level);
                if (levelGroup && levelGroup.length > 0) {
                    game.analyseManager.trackEvent("level_pass_new_hard_" + levelGroup, {
                        "level": this.levelId
                    });
                }
                cc.log("track event level_pass_hard:" + this.levelId);
            }
            this.resultCount++;
            this.levelId++;
            if (this.levelId <= this.getLevelList().length) {
                game.gcManager.reportScore(this.levelId, game.config.getHardBoardKey());
            }
            game.playerMan.setNewHardLevel(this.levelId);
        } else
        if (!this.isHardMode()) {
            if (game.playerMan.getLevelStar(this.levelId) > 0) {
                hasPssed = true;
            }
            this.updateLevelStar(this.levelId, star);
            if (!hasPssed) {
                game.analyseManager.trackEvent("level_pass", {
                    "level": this.levelId
                });
                game.analyseManager.trackEvent("level_pass_star", {
                    "level": levelIdAndStar
                });
                var levelGroup = game.playerMan.getRealGroup(game.abTestType.Level);
                if (levelGroup && levelGroup.length > 0) {
                    game.analyseManager.trackEvent("level_pass_" + levelGroup, {
                        "level": this.levelId
                    });
                }
                cc.log("track event level_pass:" + this.levelId);
            }
            this.resultCount++;
            this.levelId++;
            if (this.levelId <= this.getLevelList().length) {
                game.gcManager.reportScore(this.levelId, game.config.getLeaderBoardKey());
            }
            game.playerMan.setLevel(this.levelId);
        } else {
            if (game.playerMan.getHardLevelStar(this.levelId) > 0) {
                hasPssed = true;
            }
            this.updateHardLevelStar(this.levelId, star);
            if (!hasPssed) {
                game.analyseManager.trackEvent("level_pass_hard", {
                    "level": this.levelId
                });
                game.analyseManager.trackEvent("level_pass_hard_star", {
                    levelStarKey: levelIdAndStar
                });
                var levelGroup = game.playerMan.getRealGroup(game.abTestType.Level);
                if (levelGroup && levelGroup.length > 0) {
                    game.analyseManager.trackEvent("level_pass_hard_" + levelGroup, {
                        "level": this.levelId
                    });
                }
                cc.log("track event level_pass_hard:" + this.levelId);
            }
            this.resultCount++;
            this.levelId++;
            if (this.levelId <= this.getLevelList().length) {
                game.gcManager.reportScore(this.levelId, game.config.getHardBoardKey());
            }
            game.playerMan.setHardLevel(this.levelId);
        }
        game.gcManager.reportScore(this.getTotalStarCount(), game.config.getStarLeaderBoardKey());
        this.hasPassed = hasPssed;
    },

    skipLevel: function () {
        if (this.isNewHardMode()) {
            this.levelId++;
            if (this.levelId <= this.getLevelList().length) {
                game.playerMan.setNewHardLevel(this.levelId);
            }
        } else
        if (!this.isHardMode()) {
            this.levelId++;
            if (this.levelId <= this.getLevelList().length) {
                game.playerMan.setLevel(this.levelId);
            }
        } else {
            this.levelId++;
            if (this.levelId <= this.getLevelList().length) {
                game.playerMan.setHardLevel(this.levelId);
            }
        }
    },

    updateLevelStar: function (level, star) {
        var oldStar = game.playerMan.getLevelData(this.levelId, "star") || 0;
        if (star > oldStar) {
            cc.log("updateLevelStar:oldStar:" + oldStar + ",star:" + star);
            game.playerMan.updateLevelData(level, "star", star);
            game.playerMan.updateLevelData(level, "starTag", true);
        }
    },

    updateHardLevelStar: function (level, star) {
        var oldStar = game.playerMan.getLevelData(this.levelId, "hardStar") || 0;
        if (star > oldStar) {
            cc.log("updateHardLevelStar:oldStar:" + oldStar + ",star:" + star);
            game.playerMan.updateLevelData(level, "hardStar", star);
            game.playerMan.updateLevelData(level, "hardStarTag", true);
        }
    },

    updateNewHardLevelStar: function (level, star) {
        var oldStar = game.playerMan.getLevelData(this.levelId, "newHardStar") || 0;
        if (star > oldStar) {
            cc.log("updateNewHardLevelStar:oldStar:" + oldStar + ",star:" + star);
            game.playerMan.updateLevelData(level, "newHardStar", star);
            game.playerMan.updateLevelData(level, "newHardStarTag", true);
        }
    },

    resumeGame: function () {
        this.levelId--;
    },

    chooseLevel: function (levelId) {
        this.levelId = levelId;
    },

    getDisplayLevel: function () {
        return this.levelId;
    },

    getCurConfig: function () {
        if (this.isChallengeLevel) {
            return ConfigMan.getInstance().getChallengeConfig(game.challengeMan.currentChallengeId, this.levelId);
        } else {
            if (this.isNewHardMode()) {
                return ConfigMan.getInstance().getNewHardLevelConfig(this.levelId);
            }
            return ConfigMan.getInstance().getLevelConfig(this.levelId);
        }
    },

    hasNextLevel: function () {
        var levelList = this.getLevelList();
        if (this.levelId > levelList.length) {
            return false;
        }
        return true;
    },

    onGameFail: function () {
        this.totalFailCount++;

        if (this.isChallengeLevel) {
            game.analyseManager.trackEvent("challenge_level_fail", {
                "level": this.levelId
            });
            return;
        }

        this.addFailCount();
        game.analyseManager.trackEvent("level_fail", {
            "level": this.levelId
        });
        var levelGroup = game.playerMan.getRealGroup(game.abTestType.Level);
        if (levelGroup && levelGroup.length > 0) {
            game.analyseManager.trackEvent("level_fail_" + levelGroup, {
                "level": this.levelId
            });
        }
        game.analyseManager.missionFailed(this.getMissionKey(), "normal_fail");
    },

    addFailCount: function () {
        game.playerMan.addFailCount(this.levelId);
    },

    showRegisterNotification: function () {
        if (this.resultCount > 0 && this.resultCount % 3 === 0) {
            game.logicMan.registerNotification();
        }
    },

    showRate: function () {
        var count = 4;
        var canShowRate = false;
        var lastShowedRateDay = Math.floor((Date.now() - game.playerMan.player.lastShowRateTime) / (3600 * 1000));
        canShowRate = lastShowedRateDay >= 6;
        if (!this.rated && (this.resultCount > 0 && this.resultCount % count === 0) && canShowRate) {
            if (!game.rateManager.launchAppReview()) {
                // game.popupMan.popupRateDlg(function () {
                //     this.rated = true;
                //     game.playerMan.setRated(true);
                // }.bind(this), function () {
                //     this.rated = true;
                //     //this.showAds(success);
                // }.bind(this));
                return false;
            } else {
                this.rated = true;
            }
            game.playerMan.setLastShowRateTime();
            return true;
        } else {
            return false;
        }
    },

    restartGame: function () {
        game.logicMan.registerNotification();
        this.startGame();
        game.eventDispatcher.dispatchEvent(EventsName.EVENT_NAME_UPDATE_SCORE);
        game.eventDispatcher.dispatchEvent(EventsName.EVENT_NAME_UPDATE_BG_SPRITE);
    },

    startGame: function () {
        //game.analyseManager.trackStartProgressionEvent("level", game.playerMan.getLevel());
    },

    enterGame: function () {
        //game.analyseManager.trackStartProgressionEvent("level", game.playerMan.getLevel());
    },

    leaveGame: function () {
        this.startTime = 0;
        this.distance = 0;
    },

    canShowRewardedVideo: function () {
        return (this.canReLife && game.adsManager.isRewardVideoReady());
    },

    getShareConfig: function () {
        var shareList = ConfigMan.getInstance().getShareList();
        var randomNum = game.utils.randomNextInt(shareList.length);
        return shareList[randomNum];
    },

    getFriendHelpShare: function () {
        var desc = game.utils.sprintf("砖块破坏者我已经%d关了，帮我继续玩，让我冲上榜首。", game.playerMan.getLevel());
        var shareConfig = this.getShareConfig();
        var share = shareConfig.copy();
        share.desc = desc;
        return share;
    },

    getFriendChallengeShare: function () {
        var desc = game.utils.sprintf("砖块破坏者我已经%d关了，你能超越我吗？", game.playerMan.getLevel());
        var shareConfig = this.getShareConfig();
        var share = shareConfig.copy();
        share.desc = desc;
        return share;
    },

    getWheelLeftTime: function () {
        var lastWheelTime = game.playerMan.getLastWheelTime();
        return (lastWheelTime + this.FREE_WHEEL_HOURS * this.ONE_HOUR_SECONDS - Date.now());
    },

    isFreeWheel: function () {
        var leftTime = this.getWheelLeftTime();
        if (leftTime <= 0) {
            return true;
        }
        return false;
    },

    // addGiftCount: function () {
    //     this.giftCount++;
    // },
    //
    // canShowGift: function () {
    //     return false;
    //     if (this.levelId >= 9) {
    //         if (this.levelId % 3 === 0) {
    //             if (this.giftCount < 3) {
    //                 this.lastShowLevel = this.levelId;
    //                 return true;
    //             }
    //         }
    //     }
    //     return false;
    // },

    getCurrentSkinCfg: function () {
        var currentSkinId = game.playerMan.getCurrentSkinId();
        var skinCfg = ConfigMan.getInstance().getSkinCfg(currentSkinId);
        return skinCfg;
    },

    getCurrentBoardCfg: function () {
        var currentBoardId = game.playerMan.getCurrentBoardId();
        var skinCfg = ConfigMan.getInstance().getBoardCfg(currentBoardId);
        return skinCfg;
    },

    updateSkin: function (sprite) {
        var skinCfg = this.getCurrentSkinCfg();
        var spriteFrame = cc.spriteFrameCache.getSpriteFrame(skinCfg.image + ".png");
        if (spriteFrame) {
            sprite.setSpriteFrame(spriteFrame);
        } else {
            var defaultSpriteFrame = cc.spriteFrameCache.getSpriteFrame("skin_0.png");
            sprite.setSpriteFrame(defaultSpriteFrame);
        }
    },

    checkAutoPopup: function (firstEnter) {
        // if (!this.checkDailyBonus()) {
        //     if (!this.checkWheel()) {
        //         if (!this.checkWatchAdsGetDiamonds()) {
        //             if (!this.checkActivityTask()) {
        //                 if (!this.checkSpecialOffer()) {
        //                     if (!firstEnter) {
                                //第二天奖励tips
                                if (!this.checkNextDayTip()) {
                                    //看广告获得钻石
                                    if (!this.checkWatchAdsGetDiamonds()) {
                                        //看广告获得皮肤
                                        if (!this.checkWatchAdsGetSkin()) {
                                            //看广告打开宝箱
                                            this.checkWatchAdsOpenBox();
                                        }
                                    }
                                }
                            // }
                        // }
                    // }
                // }
            // }
        // }
    },

    addCheck: function () {
        this.currentCheckIndex = -1;

        this.checkArray = [];
        this.checkArray.push(this.checkDailyBonus.bind(this));
        this.checkArray.push(this.checkWheel.bind(this));
        this.checkArray.push(this.checkActivityTask.bind(this));
        // this.checkArray.push(this.checkWatchAdsGetDiamonds.bind(this));
    },

    onCheckNext: function () {
        if (!this.checkArray) {
            return;
        }
        this.currentCheckIndex++;
        if (this.currentCheckIndex < this.checkArray.length) {
            this.checkArray[this.currentCheckIndex](this);
        }
    },

    checkNextDayTip: function () {
        if (this.resultCount >= 3) {
            if (!game.playerMan.player.nextDayTips) {
                game.popupMan.popupRewardDlg(_("next_day_tips"),
                    function () {
                    }, "icon_gifts.png", 1);
                game.playerMan.setNextDayTips();
                return true;
            }
        }
        return false;
    },

    checkDailyBonus: function () {
        cc.log("game.gameMan.checkDailyBonus");
        var lastClaimDay = game.playerMan.player.lastClaimDailyBonusDay;
        var currentDayClaimed = lastClaimDay >= game.utils.getDayByTs(Date.now());
        if (!currentDayClaimed) {
            game.popupMan.popupDailyBonus(function () {
                this.onCheckNext();
            }.bind(this));
            return true;
        }
        this.onCheckNext();
        return false;
    },

    checkActivityTask: function () {
        cc.log("game.gameMan.checkActivityTask");
        if (game.activityMan.canShowActivityEntrance() && !game.playerMan.player.dailyTaskPoped) {
            game.playerMan.setDailyTaskPoped();
            game.popupMan.popupActivityTask(function () {
                this.onCheckNext();
            }.bind(this));
            return true;
        }
        this.onCheckNext();
        return false;
    },

    checkSpecialOffer: function () {
        if (this.isSpecialOfferPurchased()) {
            return false;
        }
        if (!this.showedSpecialOffer) {
            this.showedSpecialOffer = true;
            game.popupMan.popupSpeicialOffer();
            return true;
        }
        return false;
    },

    checkWheel: function () {
        cc.log("game.gameMan.checkWheel");
        if (!this.showedWheel) {
            this.showedWheel = true;
            var leftTime = GameMan.getInstance().getWheelLeftTime();
            if (leftTime <= 0) {
                var WheelType = require("../enum/WheelType");
                game.popupMan.popupWheelDlg(WheelType.DailyBonus, function () {
                    this.onCheckNext();
                }.bind(this));
                return true;
            }
        }
        this.onCheckNext();
        return false;
    },

    isSpecialOfferPurchased: function () {
        var specialOffer = ConfigMan.getInstance().getSpecialOfferCfg();
        if (!specialOffer) {
            return true;
        }
        var purchased = game.playerMan.isSpecialOfferPurchased(specialOffer.pid);
        cc.log("isSpecialOfferPurchased:" + purchased);
        return purchased;
    },

    adjustSkinConfigs: function () {
        //if (game.playerMan.player.skinAdjusted) {
        //    return;
        //}
        //game.playerMan.setSkinAdjusted();
        //var oldTaskConfigs = ConfigMan.getInstance().getOldTaskList();
        //for (var i = 0; i < oldTaskConfigs.length; ++i) {
        //    var oldTaskConfig = oldTaskConfigs[i];
        //    this.adjustOldTaskConfig(oldTaskConfig);
        //}
    },

    adjustOldTaskConfig: function (data) {
        var SkinRewardType = require("../enum/SkinRewardType");
        var completed = false;
        switch (data.type) {
            case SkinRewardType.None:
                completed = true;
                break;
            case SkinRewardType.LevelCount:
                if (game.playerMan.getLevel() >= data.count) {
                    completed = true;
                }
                break;
            case SkinRewardType.WatchAdCount:
                if (game.playerMan.player.interstitialAdCount >= data.count) {
                    completed = true;
                }
                break;
            case SkinRewardType.WatchRewardAdCount:
                if (game.playerMan.player.rewardedAdCount >= data.count) {
                    completed = true;
                }
                break;
            case SkinRewardType.Claimed:
                if (game.playerMan.hasSkin(data.id)) {
                    completed = true;
                }
                break;
            case SkinRewardType.Purchase:
                if (game.playerMan.hasSkin(data.id)) {
                    completed = true;
                }
                break;
        }

        if (completed) {
            game.playerMan.setClaimedSkin(data.id);
            game.playerMan.setTaskClaimed(data.id);
        }
    },

    hasCompletedTask: function () {
        var taskConfigs = ConfigMan.getInstance().getTaskList();
        for (var i = 0; i < taskConfigs.length; ++i) {
            var taskConfig = taskConfigs[i];
            if (game.playerMan.isTaskClaimed(taskConfig.id)) {
                continue;
            }
            if (this.isTaskCompleted(taskConfig)) {
                return true;
            }
        }
        return false;
    },

    isTaskCompleted: function (data) {
        var SkinRewardType = require("../enum/SkinRewardType");
        var completed = false;
        switch (data.type) {
            case SkinRewardType.None:
                completed = true;
                break;
            case SkinRewardType.LevelCount:
                if (game.playerMan.getLevel() >= data.count) {
                    completed = true;
                }
                break;
            case SkinRewardType.WatchAdCount:
                if (game.playerMan.player.interstitialAdCount >= data.count) {
                    completed = true;
                }
                break;
            case SkinRewardType.WatchRewardAdCount:
                if (game.playerMan.player.rewardedAdCount >= data.count) {
                    completed = true;
                }
                break;
            case SkinRewardType.Claimed:
                if (game.playerMan.hasSkin(data.id)) {
                    completed = true;
                }
                break;
            case SkinRewardType.Purchase:
                if (game.playerMan.hasSkin(data.id)) {
                    completed = true;
                }
                break;
        }
        return completed;
    },

    canSkip: function () {
        var failCount = game.playerMan.getFailCount(this.levelId);
        cc.log("skip fail count:" + failCount);
        if (failCount <= 3) {
            return false;
        } else {
            return true;
        }
    },

    showFirstEnterHomeAd: function () {
        if (this.firstEnterAdShowed) {
            return;
        }
        this.firstEnterAdShowed = true;
        //cc.log("first enter ads 1");
        if (game.playerMan.getLevel() >= 4) {
            //cc.log("first enter ads 2");
            if (game.adsManager.showFirstEnterAd) {
                //cc.log("first enter ads 3: register day:" + game.adsManager.getRegisterDay());
                if (game.adsManager.getRegisterDay() >= game.adsManager.firstEnterShowAdDay) {
                    //cc.log("first enter ads 4");
                    var lastLoginDay = game.utils.getDayByTs(game.playerMan.player.lastLoginTime);
                    var currentDay = game.utils.getDayByTs(Date.now());
                    if (lastLoginDay === currentDay) {
                        //cc.log("first enter ads 5");
                        if (currentDay - lastLoginDay >= 5 * 1000) {
                            //cc.log("first enter ads 6");
                            game.adsManager.showInterstitial(AdsPlace.FirstEnter);
                        }
                    }
                }
            }
        }
        game.playerMan.setLastLoginTime();
    },

    checkWatchAdsGetSkin: function () {
        if (this.watchAdsMap.skin.count >= game.adsManager.skinMaxPopCount) {
            return false;
        }
        var SkinType = require("../enum/SkinType");
        var skinList = ConfigMan.getInstance().getSkinListByType(SkinType.WatchAds);
        var suitableSkinList = [];
        var skinCfg;
        var leftWatchAdsCountEqual1;
        for (var i = 0; i < skinList.length; ++i) {
            skinCfg = skinList[i];
            var owned = game.playerMan.hasSkin(skinCfg.id);
            var isWatchAdsType = (skinCfg.type === SkinType.WatchAds);
            if (isWatchAdsType) {
                leftWatchAdsCountEqual1 = (skinCfg.count - game.playerMan.getSkinAdsCount(skinCfg.id)) === 1;
            }
            if (!owned && isWatchAdsType && leftWatchAdsCountEqual1) {
                suitableSkinList.push(skinCfg);
            }
        }
        if (suitableSkinList.length <= 0) {
            return false;
        }
        var randomIndex = game.utils.randomNextInt(suitableSkinList.length);
        skinCfg = suitableSkinList[randomIndex];
        if (skinCfg) {
            game.popupMan.popupWatchAdsGetSkin(skinCfg);
            this.watchAdsMap.skin.count++;
            return true;
        }
        return false;
    },

    getWheelRandomSkin: function () {
        var SkinType = require("../enum/SkinType");
        var skinList = ConfigMan.getInstance().getSkinListByType(SkinType.WatchAds);
        skinList = skinList.concat(ConfigMan.getInstance().getSkinListByType(SkinType.Diamonds));
        var suitableSkinList = [];
        for (var i = 0; i < skinList.length; ++i) {
            var skinCfg = skinList[i];
            var owned = game.playerMan.hasSkin(skinCfg.id);
            if (!owned) {
                suitableSkinList.push(skinCfg);
            }
        }
        if (suitableSkinList.length <= 0) {
            return null;
        }
        return suitableSkinList[game.utils.randomNextInt(suitableSkinList.length)];
    },



    lastPopCount: 0,
    currentStep: 2,
    //0 mean still can pop, >0 mean stop pop.
    allPopedResult: 0,

    tryShowPassPopup: function () {
        var poped = false;
        if (this.levelId > game.adsManager.popupLevelLimit && this.resultCount > 0) {
            if (this.resultCount - this.lastPopCount >= this.currentStep) {
                this.lastPopCount = this.resultCount;
                poped = this.checkMinPopDialog();
            }
            this.tryResetPopCount();
        }
        return poped;
    },

    tryShowRewardRemoveAds: function (callback) {
        // if (game.adsManager.isRemovedAds()) {
        //     return false;
        // }
        //
        // if (game.adsManager.isInterstitialDisabled()) {
        //     return false;
        // }
        //
        // if (!this.disableInterstitialPopup && this.levelId > game.adsManager.rewardRemoveAdsLevelLimit) {
        //     var self = this;
        //     game.popupMan.popupRewardRemoveAds(function (removed) {
        //         if (!removed) {
        //             self.disableInterstitialPopup = true;
        //         }
        //     });
        //     return true;
        // }
        return false;
    },

    tryResetPopCount: function () {
        if (this.allPopedResult > 0 && this.resultCount - this.allPopedResult > game.adsManager.popupResetLimit) {
            this.allPopedResult = 0;
            for (var i = 0; i < this.watchAdsList.length; ++i) {
                var item = this.watchAdsList[i];
                item.count = 0;
            }
        }
    },

    checkMinPopDialog: function () {
        this.watchAdsList.sort(function (a, b) {
           return (a.count - b.count);
        });
        for (var i = 0; i < this.watchAdsList.length; ++i) {
            var item = this.watchAdsList[i];
            if (item.callback()) {
                return true;
            }
        }

        if (this.allPopedResult === 0) {
            this.allPopedResult = this.resultCount;
        }
        return false;
    },

    tryShowFailPopup: function () {
        if (this.levelId > game.adsManager.popupLevelLimit && this.totalFailCount > 0 && this.totalFailCount % 2 === 0) {
            if (!this.checkWatchAdsGetDiamonds()) {
                if (!this.checkWatchAdsOpenBox()) {
                    return this.checkWatchAdsFlipCard();
                } else {
                    return true;
                }
            } else {
                return true;
            }
        }
        return false;
    },

    checkWatchAdsOpenBox: function () {
        if (this.watchAdsMap.box.count >= game.adsManager.boxMaxPopCount) {
            return false;
        }
        game.popupMan.popupWatchAdsGetItem(_("reward_video_open_box"), "icon_gift_box.png", "open_box", function (watched) {
            if (watched) {
                StoreHelper.getInstance().onOpenBox();
            }
        });
        this.watchAdsMap.box.count++;
        return true;
    },

    checkWatchAdsFlipCard: function () {
        if (this.watchAdsMap.card.count >= game.adsManager.cardMaxPopCount) {
            return false;
        }
        game.popupMan.popupWatchAdsGetItem(_("open_title"), "icon_card.png", "flip_card", function (watched) {
            if (watched) {
                game.popupMan.popupCard();
            }
        });
        this.watchAdsMap.card.count++;
        return true;
    },

    checkWatchAdsGetDiamonds: function () {
        cc.log("game.gameMan.checkWatchAdsGetDiamonds");
        var lastDailyDiamondTime = game.playerMan.player.lastDailyDiamondTime;
        var lastPopDay = game.utils.getDayByTs(lastDailyDiamondTime);
        var currentDay = game.utils.getDayByTs(Date.now());
        if (currentDay <= lastPopDay) {
            this.onCheckNext();
            return false;
        }
        game.playerMan.setLastDailyDiamondsTime();
        game.popupMan.popupWatchAdsGetDiamonds("daily_diamonds", function (watched) {
            if (watched) {
                StoreHelper.getInstance().popupAddDiamondsDlg(game.config.dailyDiamonds, "daily_diamonds");
            }
            this.onCheckNext();
        }.bind(this));
        return true;
    },

    getTotalStarCount: function () {
        var levelList = ConfigMan.getInstance().getLevelList();
        var starCount = 0;
        for (var i = 0; i < levelList.length; ++i) {
            var levelStarCount = game.playerMan.getLevelStar(i + 1);
            var hardLevelStarCount = game.playerMan.getHardLevelStar(i + 1);
            starCount += levelStarCount;
            starCount += hardLevelStarCount;
        }
        return starCount;
    },

    getMaxLevel: function () {
        var normalLevel = game.playerMan.getLevel();
        var hardLevel = game.playerMan.getHardLevel();
        return Math.max(normalLevel, hardLevel);
    },

    canShowGiftBox: function () {
        var adsReady = game.adsManager.isRewardVideoReady();
        var isLevelOk = this.levelId >= 3 && this.levelId % 2 === 0;
        var giftCountOk = this.giftCount <= 5;
        return (adsReady && giftCountOk && isLevelOk);
    },

    addGiftCount: function () {
        this.giftCount++;
    },

    onGiftBoxOpened: function (callback) {
        var randomNum = game.utils.randomNextInt(100);
        if (randomNum < 50) {
            StoreHelper.getInstance().onOpenBox(callback);
        } else {
            game.popupMan.popupCard(callback);
        }
    },

    getRandomCfg: function (possibilityCfg) {
        var randomNum = game.utils.randomNextInt(100);
        cc.log("random number:" + randomNum);
        var sumProbability = 0;
        var resultItem = possibilityCfg[0];
        for (var i = 0; i < possibilityCfg.length; ++i) {
            if (sumProbability + possibilityCfg[i].p > randomNum) {
                resultItem = possibilityCfg[i];
                break;
            } else {
                sumProbability += possibilityCfg[i].p;
            }
        }
        cc.log("random item:" + JSON.stringify(resultItem));
        return game.utils.randomNextIntInRange(resultItem.start, resultItem.end + 1);
    },

    getPassWinMulti: function () {
        return this.getRandomCfg(game.config.multiClaimPossibility);
    },

    getDiamondsMulti: function () {
        return this.getRandomCfg(game.config.multiDiamondsPossibility);
    },

    isCountDownChallenge: function () {
        var ChallengeId = require("../enum/ChallengeId");
        return this.isChallengeLevel && game.challengeMan.currentChallengeId === ChallengeId.TimeLimit;
    },

    isSuperBoardUnlocked: function () {
        if (!this.isChallengeLevel && game.playerMan.player.unlockedSuperBoard) {
            return true;
        }
        return false;
    },

    getRandomSkin: function (skinType) {
        // var SkinType = require("../enum/SkinType");
        var skinList = ConfigMan.getInstance().getSkinListByType(skinType);
        // skinList = skinList.concat(ConfigMan.getInstance().getSkinListByType(SkinType.Diamonds));
        var suitableSkinList = [];
        for (var i = 0; i < skinList.length; ++i) {
            var skinCfg = skinList[i];
            var owned = game.playerMan.hasSkin(skinCfg.id);
            if (!owned) {
                suitableSkinList.push(skinCfg);
            }
        }
        if (suitableSkinList.length <= 0) {
            return null;
        }
        return suitableSkinList[game.utils.randomNextInt(suitableSkinList.length)];
    },

    getRandomBoard: function (skinType) {
        var boardList = ConfigMan.getInstance().getBoardListByType(skinType);
        var suitableBoardList = [];
        for (var i = 0; i < boardList.length; ++i) {
            var skinCfg = boardList[i];
            var owned = game.playerMan.hasBoard(skinCfg.id);
            if (!owned) {
                suitableBoardList.push(skinCfg);
            }
        }
        if (suitableBoardList.length <= 0) {
            return null;
        }
        return suitableBoardList[game.utils.randomNextInt(suitableBoardList.length)];
    },

    getBoxRewards: function () {
        var boxRewardConfig = ConfigMan.getInstance().boxRewardConfig;
        var boxReward1 = boxRewardConfig.boxReward1;
        var boxReward2 = boxRewardConfig.boxReward2;
        var boxReward3 = boxRewardConfig.boxReward3;

        var results = [];
        var config = boxReward1[game.utils.randomNextInt(boxReward1.length)];
        switch (config.type) {
            case BoostType.SKIN:
                config.extra = this.getRandomSkin(SkinType.KeyActivity);
                if (!config.extra) {
                    config = boxReward1[1];
                    config.extra = this.getRandomBoard(SkinType.KeyActivity);
                }
                break;
            case BoostType.BOARD_SKIN:
                config.extra = this.getRandomBoard(SkinType.KeyActivity);
                if (!config.extra) {
                    config = boxReward1[0];
                    config.extra = this.getRandomSkin(SkinType.KeyActivity);
                }
                break;
            default:
                cc.log("error:reward type:" + config.type);
        }
        if (!config.extra) {
            config = {
                type: BoostType.DIAMOND,
                image: "icon_diamond.png",
                count: 100
            };
        }
        results.push(config);
        game.utils.shuffle(boxReward2);
        for (var i = 0; i < 2; ++i) {
            results.push(boxReward2[i]);
        }
        game.utils.shuffle(boxReward3);
        for (var i = 0; i < 6; ++i) {
            results.push(boxReward3[i]);
        }
        return results;
    },

    checkAndShowBox: function () {
        if (game.playerMan.player.currentKeyCount >= 3) {
            game.popupMan.popupBox();
            return true;
        }
        return false;
    },

    randomBox: function () {
        var configs = this.boxConfigs;
        var count = this.unlockBoxCount;
        var randomIndex = game.utils.randomNextInt(configs.length);
        if (count < 3) {
            if (randomIndex === 0) {
                randomIndex = game.utils.randomNextInt(configs.length);
            }
        } else if (count < 6) {
            if (randomIndex === 0 && game.utils.randomNextInt(100) < 50) {
                randomIndex = game.utils.randomNextInt(configs.length);
            }
        }
        var config = configs[randomIndex];
        configs.splice(randomIndex, 1);
        return config;
    },

    registerRemoteConfig: function () {
        var self = this;
        game.remoteConfig.setRemoteConfigReceivedCallback(function () {
            self.flushGroup();
        });
        self.flushGroup();
    },

    flushGroup: function () {
        if (game.remoteConfig.isRemoteConfigReady()) {
            var group = game.remoteConfig.getRemoteConfig("lv4_group");
            if (group != null && group.length > 0) {
                if (game.playerMan.getGroup(game.abTestType.Level) !== group) {
                    game.playerMan.setGroup(game.abTestType.Level, group);
                }
            }
        }
    },

    isNewResult: function () {
        return true;
    },

    isNewPopup: function () {
        return false;
    },

    isNewAdsShowType: function () {
        return true;
    },

    getAdsInterval: function () {
        return 40;
    },

    getLifeCount: function () {
        return 3;
    },

    getInitBoostProbability: function () {
        return game.config.boostProbability;
    },

    getOrGenerateSkinId: function () {
        var skinId = game.playerMan.player.waitSkinId;
        if (game.playerMan.hasSkin(skinId)) {
            skinId = 0;
            game.playerMan.setSkinPercent(0);
            game.playerMan.setWaitSkinId(0);
        }
        if (skinId === 0) {
            var skinCfg = this.getRandomSkin(SkinType.WatchAds);
            if (skinCfg != null) {
                game.playerMan.setWaitSkinId(skinCfg.id);
                skinId = skinCfg.id;
            }
        }
        return skinId;
    }
});

GameMan._instance = null;
GameMan._firstUseInstance = true;

/**
 *
 * @returns {GameMan}
 */
GameMan.getInstance = function () {
    if (GameMan._firstUseInstance) {
        GameMan._firstUseInstance = false;
        GameMan._instance = new GameMan();
    }
    return GameMan._instance;
};

module.exports = GameMan;
},{"../../common/enum/AdsPlace":13,"../config/ConfigMan":52,"../enum/BoostType":154,"../enum/ChallengeId":155,"../enum/SkinRewardType":165,"../enum/SkinType":166,"../enum/WheelType":168,"../events/EventsName":169,"../model/StoreHelper":178}],174:[function(require,module,exports){
/**
 * Created by qinning on 15/5/12.
 */
var PlayerInfo = require("../entity/PlayerInfo");
var EventsName = require("../events/EventsName");
var BoostType = require("../enum/BoostType");

var PLAYER_KEY = "player_key";

var PlayerMan = cc.Class.extend({
    player: null,
    bestScoreKey: null,
    levelBoardKey: null,

    inited: false,
    ctor: function () {
    },

    initData: function () {
        if (this.inited) {
            return;
        }
        this.inited = false;
        var playerInfoStr = game.storageController.getItem(PLAYER_KEY, null);
        var player;
        if (playerInfoStr == null || playerInfoStr == "") {
            player = PlayerInfo.createDefault();
            game.storageController.setItem(PLAYER_KEY, JSON.stringify(player));
            game.analyseManager.addVirtualCurrency("init_player", player.diamonds);
        } else {
            player = new PlayerInfo();
            player.unmarshall(JSON.parse(playerInfoStr));
        }
        this.player = player;
    },

    removedAds: function () {
        this.player.removedAds = true;
        game.adsManager.removeBannerAds("top");
        game.adsManager.removeBannerAds("bottom");
        game.adsManager.removeNativeAd("pass");
        this._flushToStorage();
    },

    setRated: function () {
        this.player.rated = true;
        this._flushToStorage();
    },

    getLevel: function () {
        if (cc.isUndefined(this.player.level)) {
            return 1;
        } else {
            return this.player.level;
        }
    },

    setLevel: function (level) {
        if (this.player.level < level) {
            this.player.level = level;
            game.analyseManager.trackPlayerLevel(level);
            this._flushToStorage();
        }
    },

    updateLevelData: function (level, name, data) {
        if (cc.isUndefined(this.player.levelsMap[level])) {
            this.player.levelsMap[level] = {};
        }
        this.player.levelsMap[level][name] = data;
        this._flushToStorage();
    },

    getLevelData: function (level, name) {
        return (this.player.levelsMap[level] || {})[name];
    },

    getLevelStar: function (level) {
        return this.getLevelData(level, "star") || 0;
    },

    getHardLevelStar: function (level) {
        return this.getLevelData(level, "hardStar") || 0;
    },

    getNewHardLevelStar: function (level) {
        return this.getLevelData(level, "newHardStar") || 0;
    },

    addInterstitialAdCount: function () {
        this.player.interstitialAdCount++;
        this._flushToStorage();
    },

    addRewardedAdCount: function () {
        this.player.rewardedAdCount++;
        this._flushToStorage();
    },

    setHardLevel: function (level) {
        if (this.player.hardLevel < level) {
            this.player.hardLevel = level;
            this._flushToStorage();
        }
    },



    getHardLevel: function () {
        if (cc.isUndefined(this.player.hardLevel)) {
            return 1;
        } else {
            return this.player.hardLevel;
        }
    },

    setNewHardLevel: function (level) {
        if (this.player.newHardLevel < level) {
            this.player.newHardLevel = level;
            this._flushToStorage();
        }
    },

    getNewHardLevel: function () {
        if (cc.isUndefined(this.player.newHardLevel)) {
            return 1;
        } else {
            return this.player.newHardLevel;
        }
    },

    getBoostCount: function (boostType) {
        return this.player.boostMap[boostType] || 0;
    },

    useBoost: function (boostType) {
        if (this.getBoostCount(boostType) > 0) {
            this.player.boostMap[boostType]--;
            if (boostType === BoostType.SPLIT) {
                game.analyseManager.consumeItem("boost_split", 1);
            } else if (boostType === BoostType.THREE_BALL) {
                game.analyseManager.consumeItem("boost_new_3", 1);
            }
            game.activityMan.addActivityTaskCount(game.activityTaskType.UseBoost);
            this._flushToStorage();
            return true;
        }
        return false;
    },

    addBoost: function (boostType, count) {
        this.player.boostMap[boostType] += count;
        this._flushToStorage();
        game.eventDispatcher.dispatchEvent(EventsName.REFRESH_BOOST);
    },

    setBoost: function (boostType, count) {
        this.player.boostMap[boostType] = count;
        this._flushToStorage();
        game.eventDispatcher.dispatchEvent(EventsName.REFRESH_BOOST);
    },

    addDiamonds: function (diamonds, reason, buyItemName, buyItemCount, isUSDPurchased) {
        if (isNaN(diamonds)) {
            cc.error("diamonds is NAN");
            return;
        }
        if (diamonds > 0) {
            game.audioPlayer.playEffectByKey("diamond_add");
            if (!isUSDPurchased) {
                if (reason) {
                    game.analyseManager.addVirtualCurrency(reason, diamonds);
                } else {
                    game.analyseManager.addVirtualCurrency("unkonw_reason", diamonds);
                    cc.error("error addDiamonds unknown reason:" + reason);
                }
            }
        } else if (diamonds < 0) {
            if (buyItemName && buyItemCount) {
                game.analyseManager.consumeVirtualCurrency(buyItemName, buyItemCount, -diamonds);
            } else {
                cc.error("error addDiamonds unknown buyItemName:" + buyItemName + ",buyItemCount:" + buyItemCount);
                game.analyseManager.consumeVirtualCurrency("unknown_reason", 0, -diamonds);
            }
        }
        this.player.diamonds += diamonds;
        this._flushToStorage();
        game.eventDispatcher.dispatchEvent(EventsName.DIAMONDS_UPDATE, {
            "diamonds": this.player.diamonds,
            "delta": diamonds
        });
    },

    getDiamonds: function () {
        return this.player.diamonds;
    },

    setTaskClaimed: function (taskId) {
        cc.log("PlayerMan setTaskClaimed:" + taskId);
        this.player.taskMap[taskId] = true;
        this._flushToStorage();
    },

    isTaskClaimed: function (taskId) {
        cc.log("PlayerMan isTaskClaimed:" + taskId);
        return !!this.player.taskMap[taskId];
    },

    setGuided: function (guided) {
        this.player.guided = guided;
        this._flushToStorage();
    },

    setLastWheelTime: function (wheelTime) {
        this.player.lastWheelTime = wheelTime;
        this._flushToStorage();
    },

    getLastWheelTime: function () {
        return this.player.lastWheelTime;
    },

    setCurrentSkinId: function (skinId) {
        if (skinId === this.player.currentSkinId) {
            return;
        }
        var BallPool = require("../entity/BallPool");
        BallPool.drainAllPools();
        this.player.currentSkinId = skinId;
        this._flushToStorage();
    },

    getCurrentSkinId: function () {
        return this.player.currentSkinId;
    },

    setCurrentBoardId: function (boardId) {
        if (boardId === this.player.currentBoardId) {
            return;
        }
        this.player.currentBoardId = boardId;
        this._flushToStorage();
    },

    getCurrentBoardId: function () {
        return this.player.currentBoardId;
    },

    setClaimedSkin: function (skinId) {
        this.player.skinMap[skinId] = true;
        this._flushToStorage();
    },

    hasSkin: function (skinId) {
        return !!this.player.skinMap[skinId];
    },

    setClaimedBoard: function (boardId) {
        if (this.player.boardMap[boardId]) {
            return;
        }
        // game.activityMan.addActivityTaskCount(game.activityTaskType.BoardSkin);
        this.player.boardMap[boardId] = true;
        this._flushToStorage();
    },

    hasBoard: function (boardId) {
        return !!this.player.boardMap[boardId];
    },

    isNewPlayer: function () {
        return (Date.now() - this.player.createDt < 24 * 3600 * 1000);
    },

    getRegisterDay: function () {
        return Math.floor((Date.now() - this.player.createDt) / (24 * 3600 * 1000)) + 1;
    },

    currentDay: function(){
        return game.utils.getDayByTs(Date.now());
    },

    checkConsecutiveLoginDay: function() {
        var today = this.currentDay();
        var days = today - this.player.lastLoginDay;
        if (days < 0) {
            cc.error("consecutive login day error, today is smaller than lastLoginDay, maybe you have adjust the time.");
            days = 0;
        }
        if (days <= 1){
            this.player.consecutiveLoginDays += days;
        }
        else{
            this.player.consecutiveLoginDays = 1;
        }

        this.player.lastLoginDay = today;
        if (this.player.consecutiveLoginDays < 1) {
            this.player.consecutiveLoginDays = 1;
        }
        return this.player.consecutiveLoginDays;
    },

    setLastClaimDailyBonusDay: function (day) {
        this.player.lastClaimDailyBonusDay = day;
        this._flushToStorage();
    },

    setNextDayTips: function () {
        this.player.nextDayTips = true;
        this._flushToStorage();
    },

    isSpecialOfferPurchased: function (pid) {
        return this.player.specialOfferMap[pid] || false;
    },

    setSpecialOfferPurchased: function (pid) {
        this.player.specialOfferMap[pid] = true;
        this._flushToStorage();
        game.eventDispatcher.dispatchEvent(EventsName.UPDATE_SPECIAL_OFFER);
    },

    setSkinAdjusted: function () {
        this.player.skinAdjusted = true;
        this._flushToStorage();
    },

    setLastShowRateTime: function () {
        this.player.lastShowRateTime = Date.now();
        this._flushToStorage();
    },

    addRewardAdCountPerDay: function () {
        this.tryClearPreviousAdCountPerDay();
        if (cc.isUndefined(this.player.rewardAdCountPerDay)) {
            this.player.rewardAdCountPerDay = 0;
        }
        this.player.rewardAdCountPerDay++;
        this._flushToStorage();
        game.eventDispatcher.dispatchEvent(EventsName.REWARDED_VIDEO_COUNT);
    },

    getRewardAdPlaceCountPerDay: function () {
        this.tryClearPreviousAdCountPerDay();
        return this.player.rewardAdCountPerDay || 0;
    },

    tryClearPreviousAdCountPerDay: function () {
        if (this.player.rewardAdRecordDay !== this.getRegisterDay()) {
            this.player.rewardAdCountPerDay = 0;
            this.player.rewardAdRecordDay = this.getRegisterDay();
        }
    },

    addIapCount: function () {
        this.player.iapCount++;
        this._flushToStorage();
    },

    addFailCount: function (levelId) {
        this.player.failCountMap[levelId] = this.getFailCount(levelId) + 1;
        this._flushToStorage();
    },

    getFailCount: function (levelId) {
        cc.log("skip fail count map:" + JSON.stringify(this.player.failCountMap));
        return this.player.failCountMap[levelId] || 0;
    },

    addSkinAdsCount: function (skinId) {
        this.player.skinAdsCountMap[skinId] = this.getSkinAdsCount(skinId) + 1;
        this._flushToStorage();
    },

    getSkinAdsCount: function (skinId) {
        return this.player.skinAdsCountMap[skinId] || 0;
    },

    addBoardAdsCount: function (boardId) {
       this.player.boardAdsCountMap[boardId] = this.getBoardAdsCount(boardId) + 1;
       this._flushToStorage();
    },

    getBoardAdsCount: function (boardId) {
        return this.player.boardAdsCountMap[boardId] || 0;
    },

    setLastLoginTime: function () {
        this.player.lastLoginTime = Date.now();
        this._flushToStorage();
    },

    setLastDailyDiamondsTime: function () {
        this.player.lastDailyDiamondTime = Date.now();
        this._flushToStorage();
    },

    purchasedAimItem: function () {
        this.player.hasAimItem = true;
        this._flushToStorage();
    },

    _flushToStorage: function () {
        game.storageController.setItem(PLAYER_KEY, JSON.stringify(this.player));
    },

    setChallengeLevel: function (level, challengeId) {
        // if (this.player.challengeLevel < level) {
            this.getOrCreateChallenge(challengeId).challengeLevel = level;
            // game.analyseManager.trackPlayerLevel(level);
            this._flushToStorage();
        // }
    },

    setChallengeMilestoneRewardClaimed: function (milestoneId, challengeId) {
        if (this.getOrCreateChallenge(challengeId).challengeMilestoneClaimId < milestoneId) {
            this.getOrCreateChallenge(challengeId).challengeMilestoneClaimId = milestoneId;
            this._flushToStorage();
        }
    },

    getOrCreateChallenge: function (challengeId) {
        if (!this.player.challengeDataMap[challengeId]) {
            var ChallengeData = require("../entity/ChallengeData");
            this.player.challengeDataMap[challengeId] = new ChallengeData();
        }
        return this.player.challengeDataMap[challengeId];
    },

    addChallengeReviveCount: function (challengeId) {
        this.getOrCreateChallenge(challengeId).challengeReviveCount ++;
        this._flushToStorage();
    },

    rollbackChallengeReviveCount: function (challengeId) {
        this.getOrCreateChallenge(challengeId).challengeReviveCount = 0;
        this._flushToStorage();
    },

    setChallengeUnlockTipsShowed: function () {
        if (this.player.challengeUnlockTips) {
            return;
        }
        this.player.challengeUnlockTips = true;
        this._flushToStorage();
    },

    setChallengeLevelSuccessed: function (level, challengeId) {
        var challenge = this.getOrCreateChallenge(challengeId);
        if (!challenge.challengeLevelMap) {
            challenge.challengeLevelMap = {};
        }
        challenge.challengeLevelMap[level] = true;
        this._flushToStorage();
    },

    isChallengeLevelSuccessed: function (level, challengeId) {
        var challenge = this.getOrCreateChallenge(challengeId);
        if (!challenge.challengeLevelMap) {
            challenge.challengeLevelMap = {};
        }
        return !!challenge.challengeLevelMap[level];
    },

    setChallengePlaying: function (playing, challengeId) {
        this.getOrCreateChallenge(challengeId).challengePlaying = playing;
        this._flushToStorage();
    },

    setChallengeEntered: function () {
        if (this.player.challengeEntered) {
            return;
        }
        this.player.challengeEntered = true;
        this._flushToStorage();
    },

    setWheelLocked: function (id) {
        this.player.wheelLockIds.push(id);
        this._flushToStorage();
    },

    isWheelLocked: function (id) {
        return this.player.wheelLockIds.indexOf(id) !== -1;
    },

    getWheeledCount: function () {
        return this.player.wheelLockIds.length;
    },

    resetWheelLocked: function () {
        this.player.wheelLockIds = [];
        this._flushToStorage();
    },

    setSuperBoardUnlocked: function () {
        this.player.unlockedSuperBoard = true;
        this._flushToStorage();
    },

    addCurrentKeyCount: function () {
        this.player.currentKeyCount++;
        this._flushToStorage();
    },

    setCurrentKeyCount: function (count) {
        this.player.currentKeyCount = count;
        this._flushToStorage();
    },

    reduceCurrentKeyCount: function () {
        this.player.currentKeyCount--;
        this._flushToStorage();
    },

    getActivityTaskCount: function (type) {
        return this.player.dailyTaskCountMap[type] || 0;
    },

    addActivityTaskCount: function (type) {
        this.player.dailyTaskCountMap[type] = this.getActivityTaskCount(type) + 1;
        this._flushToStorage();
    },

    setActivityTaskClaimed: function (id) {
        this.player.dailyTaskClaimMap[id] = true;
        this._flushToStorage();
    },

    isActivityTaskClaimed: function (id) {
        return this.player.dailyTaskClaimMap[id];
    },

    setDailyTaskPoped: function () {
        this.player.dailyTaskPoped = true;
        this._flushToStorage();
    },

    resetDailyTaskData: function () {
        this.player.dailyTaskCountMap = {};
        this.player.dailyTaskClaimMap = {};
        this.player.dailyTaskPoped = false;
        this._flushToStorage();
    },

    resetCurrentDay: function () {
        this.player.currentDay = game.utils.getCurrentDay();
        this._flushToStorage();
    },

    getGroup: function (type) {
        return this.player.abTestGroup[type] || "a";
    },

    getRealGroup: function (type) {
        return this.player.abTestGroup[type] || "";
    },

    setGroup: function (type, group) {
        if (group != null) {
            this.player.abTestGroup[type] = group;
        }
    },

    setSkinPercent: function (percent) {
        this.player.skinPercent = percent;
        this._flushToStorage();
    },

    setWaitSkinId: function (skinId) {
        this.player.waitSkinId = skinId;
        this._flushToStorage();
    }

});

PlayerMan._instance = null;
PlayerMan._firstUseInstance = true;

/**
 *
 * @returns {PlayerMan}
 */
PlayerMan.getInstance = function () {
    if (PlayerMan._firstUseInstance) {
        PlayerMan._firstUseInstance = false;
        PlayerMan._instance = new PlayerMan();
    }
    return PlayerMan._instance;
};

module.exports = PlayerMan;
},{"../entity/BallPool":143,"../entity/ChallengeData":146,"../entity/PlayerInfo":150,"../enum/BoostType":154,"../events/EventsName":169}],175:[function(require,module,exports){
/**
 * Created by oye on 15/11/21.
 */

var NoticeController = require("../controller/NoticeController");
var GameOverController = require("../controller/GameOverController");
var HelpController = require("../controller/HelpController");
var GameWinController = require("../controller/GameWinController");
var PassController = require("../controller/PassController");
var StoreController = require("../controller/StoreController");
var PauseController = require("../controller/PauseController");
var FailController = require("../controller/FailController");
var RankController = require("../controller/RankController");
var RewardVideoController = require("../controller/RewardVideoController");
var WheelController = require("../controller/WheelController");
var RewardDoubleController = require("../controller/RewardDoubleController");
var BagController = require("../controller/BagController");
var RewardGiftController = require("../controller/RewardGiftController");
var SkinController = require("../controller/SkinController");
var DailyBonusController = require("../controller/DailyBonusController");
var SpecialOfferController = require("../controller/SpecialOfferController");
var RewardNoticeController = require("../controller/RewardNoticeController");
var TaskController = require("../controller/TaskController");
var SettingController = require("../controller/SettingController");
var ReliveController = require("../controller/ChallengeReliveController");
var WatchAdsGetSkinController = require("../controller/WatchAdsGetSkinController");
var WatchAdsGetItemController = require("../controller/WatchAdsGetItemController");
var WatchAdsGetDiamondsController = require("../controller/WatchAdsGetDiamondsController");
var WatchAdsGet3StarController = require("../controller/WatchAdsGet3StarController");
var WatchAdsRelifeController = require("../controller/WatchAdsRelifeController");
var CardController = require("../controller/CardController");
var PassCnController = require("../controller/PassCnController");
var FailCnController = require("../controller/FailCnController");
var PauseCnController = require("../controller/PauseCnController");
var RewardRemoveAdsController = require("../controller/RewardRemoveAdsController");
var SuperBoardController = require("../controller/SuperBoardController");
var BoxController = require("../controller/BoxController");
var ActivityTaskController = require("../controller/ActivityTaskController");
var ActivityTaskEntranceController = require("../controller/ActivityTaskEntranceController");
var ActivityTaskTipsController = require("../controller/ActivityTaskTipsController");
var SkinUnlockController = require("../controller/SkinUnlockController");

var PopupMan = {

    popupCommonDlg: function (info, yesCallback) {
        var noticeNode = NoticeController.createFromCCB();
        noticeNode.controller.initWithYes(info, yesCallback, null);
        noticeNode.controller.popup();
    },

    popupYesNoCommonDlg: function (info, yesInfo, cancelInfo, yesCallback, noCallback, isShowClose, isShowAds) {
        var noticeNode = NoticeController.createFromCCB();
        noticeNode.controller.initWithYesNo(info, yesInfo, cancelInfo, yesCallback, noCallback, isShowClose, isShowAds);
        noticeNode.controller.popup();
    },

    popupRewardDlg: function (info, yesCallback, reward1Sprite, reward1Count, reward2Sprite, reward2Count) {
        var noticeNode = NoticeController.createFromCCB();
        noticeNode.controller.initWithRewardYes(info, yesCallback, reward1Sprite, reward1Count, reward2Sprite, reward2Count);
        noticeNode.controller.popup();
    },

    popupNewTipCommonDlg: function (info, yesInfo, cancelInfo, yesCallback, noCallback, isShowClose) {
        var noticeNode = NoticeController.createGuideFromCCB();
        noticeNode.controller.initWithYesNo(info, yesInfo, cancelInfo, yesCallback, noCallback, isShowClose);
        noticeNode.controller.popup();
    },

    popupGameOverDlg: function (percent, replayCallback) {
        var gameOverNode = GameOverController.createFromCCB();
        gameOverNode.controller.initWith(percent, replayCallback);
        gameOverNode.controller.popup();
    },

    popupRateDlg: function (ratedCallback, closeCallback) {
        var rateInfo = game.local.getValue("rate_info");
        this.popupYesNoCommonDlg(rateInfo,
            game.local.getValue("rate_confirm"), game.local.getValue("rate_cancel"), function () {
                //cc.sys.openURL(game.config.getPlatformDownloadUrl());
                if (game.utils.isIOS()) {
                    cc.sys.openURL(game.config.getPlatformDownloadUrl());
                } else {
                    jsb_dp.oneSdkBridge.openApplicationMarket(game.config.getPackageName());
                }
                game.adsManager.rateTime = Date.now();
                if (ratedCallback) {
                    ratedCallback();
                }
            },
            function () {
                if (closeCallback) {
                    closeCallback();
                }
            }, false);
    },

    popupHelpDlg: function () {
        var helpNode = HelpController.createFromCCB();
        helpNode.controller.popup();
    },

    popupGameWinDlg: function (replayCallback, nextCallback) {
        var gameOverNode = GameWinController.createFromCCB();
        gameOverNode.controller.initWith(replayCallback, nextCallback);
        gameOverNode.controller.popup();
    },

    popupPassDlg: function (replayCallback, nextCallback) {
        if (game.utils.isSelfGame()) {
            game.popupMan.popupPassCnDlg(replayCallback, nextCallback);
            return;
        }
        var node = PassController.createFromCCB();
        node.controller.initWith(replayCallback, nextCallback);
        node.controller.popup();
    },

    popupPassCnDlg: function (replayCallback, nextCallback) {
        var node = PassCnController.createFromCCB();
        node.controller.initWith(replayCallback, nextCallback);
        node.controller.popup();
    },

    popupFailDlg: function (replayCallback, skipCallback) {
        if (game.utils.isSelfGame()) {
            game.popupMan.popupFailCnDlg(replayCallback, skipCallback);
            return;
        }
        var node = FailController.createFromCCB();
        node.controller.initWith(replayCallback, skipCallback);
        node.controller.popup();
    },

    popupFailCnDlg: function (replayCallback, skipCallback) {
        var node = FailCnController.createFromCCB();
        node.controller.initWith(replayCallback, skipCallback);
        node.controller.popup();
    },

    popupStoreDlg: function (type, callback) {
        var node = StoreController.createFromCCB();
        node.controller.initWith(type, callback);
        node.controller.popup();
    },

    popupPauseDlg: function (resuemCallback) {
        if (game.utils.isSelfGame()) {
            game.popupMan.popupPauseCnDlg(resuemCallback);
            return;
        }
        var node = PauseController.createFromCCB();
        node.controller.initWith(resuemCallback);
        node.controller.popup();
    },

    popupPauseCnDlg: function (resuemCallback) {
        var node = PauseCnController.createFromCCB();
        node.controller.initWith(resuemCallback);
        node.controller.popup();
    },

    popupRankDlg: function (rankType, closeCallback) {
        var node = RankController.createFromCCB();
        node.controller.init(rankType, closeCallback);
        node.controller.popup();
        return node;
    },
    popupGroupRankDlg: function () {
        if (this.lastGroupRankNode) {
            this.lastGroupRankNode.controller.closeCallback = null;
            this.lastGroupRankNode.controller.close();
        }
        var RankType = require("../enum/RankType");
        var self = this;
        this.lastGroupRankNode = this.popupRankDlg(RankType.Group, function () {
            self.lastGroupRankNode = null;
        });

    },
    popupRewardVideo: function (closeCallback) {
        var node = RewardVideoController.createFromCCB();
        node.controller.init(closeCallback);
        node.controller.popup();
    },

    popupWheelDlg: function (wheelType, callback) {
        var node = WheelController.createFromCCB();
        node.controller.initWith(wheelType, callback);
        node.controller.popup();
    },

    popupRewardDoubleTipDlg: function (image, count, rewardName, callback) {
        var node = RewardDoubleController.createFromCCB();
        node.controller.init(image, count, rewardName, callback);
        node.controller.popup();
    },

    popupBagDlg: function () {
        var node = BagController.createFromCCB();
        node.controller.popup();
    },

    popupRewardGift: function (closeCallback) {
        var node = RewardGiftController.createFromCCB();
        node.controller.init(closeCallback);
        node.controller.popup();
    },

    popupSkinDlg: function () {
        var node = SkinController.createFromCCB();
        node.controller.popup();
    },

    popupDailyBonus: function (callback) {
        var node = DailyBonusController.createFromCCB();
        node.controller.initWith(callback);
        node.controller.popup();
    },

    popupSpeicialOffer: function () {
        var node = SpecialOfferController.createFromCCB();
        node.controller.popup();
    },

    popupRewardNoticeDlg: function (info, yesCallback, reward1Sprite, reward1Count, reward2Sprite, reward2Count) {
        var noticeNode = RewardNoticeController.createFromCCB();
        noticeNode.controller.initWithRewardYes(info, yesCallback, reward1Sprite, reward1Count, reward2Sprite, reward2Count);
        noticeNode.controller.popup();
    },

    popupTaskDlg: function () {
        var node = TaskController.createFromCCB();
        node.controller.popup();
    },

    popupSettingDlg: function () {
        var node = SettingController.createFromCCB();
        node.controller.popup();
    },

    popupReliveDlg: function (reason, reliveCallback, cancelCallback) {
        var node = ReliveController.createFromCCB();
        node.controller.initWith(reason, reliveCallback, cancelCallback);
        node.controller.popup();
    },

    popupWatchAdsGetSkin: function (skinCfg, callback) {
        var node = WatchAdsGetSkinController.createFromCCB();
        node.controller.initWith(skinCfg, callback);
        node.controller.popup();
    },

    popupSkinUnlock: function (callback) {
        var node = SkinUnlockController.createFromCCB();
        node.controller.initWith(callback);
        node.controller.popup();
    },

    popupWatchAdsGetItem: function (title, spriteName, rewardName, closeCallback) {
        var node = WatchAdsGetItemController.createFromCCB();
        node.controller.initWith(title, spriteName, rewardName, closeCallback);
        node.controller.popup();
    },

    popupWatchAdsGetDiamonds: function (rewardName, closeCallback) {
        var node = WatchAdsGetDiamondsController.createFromCCB();
        node.controller.initWith(rewardName, closeCallback);
        node.controller.popup();
    },

    popupGet3Star: function (rewardName, closeCallback) {
        var node = WatchAdsGet3StarController.createFromCCB();
        node.controller.initWith(rewardName, closeCallback);
        node.controller.popup();
    },
    
    popupRelife: function (callback) {
        var node = WatchAdsRelifeController.createFromCCB();
        node.controller.initWith(callback);
        node.controller.popup();
    },

    popupCard: function (callback) {
        var node = CardController.createFromCCB();
        node.controller.initWith(callback);
        node.controller.popup();
    },

    popupGetRewards: function (rewards, callback) {
        var RewardGetController = require("../controller/RewardGetController");
        var node = RewardGetController.createFromCCB();
        node.controller.initWithRewards(rewards, callback);
        node.controller.popup();
    },

    popupLuckySpin: function (multi, range, callback) {
        var LuckySpinController = require("../controller/LuckySpinController");
        var node = LuckySpinController.createFromCCB();
        node.controller.initWith(multi, range, callback);
        node.controller.popup();
    },

    popupRewardRemoveAds: function (callback) {
        var node = RewardRemoveAdsController.createFromCCB();
        node.controller.initWith(callback);
        node.controller.popup();
    },

    popupSuperBoard: function (rewardName, callback) {
        var node = SuperBoardController.createFromCCB();
        node.controller.initWith(rewardName, callback);
        node.controller.popup();
    },

    popupBox: function (callback) {
        var node = BoxController.createFromCCB();
        node.controller.initWith(callback);
        node.controller.popup();
    },

    popupActivityTask: function (callback) {
        var node = ActivityTaskController.createFromCCB();
        node.controller.initWith(callback);
        node.controller.popup();
    },

    popupActivityTaskEntrance: function (callback) {
        var node = ActivityTaskEntranceController.createFromCCB();
        node.controller.initWith(callback);
        node.controller.popup();
    },

    popupActivityTaskTips: function () {
        var node = ActivityTaskTipsController.createFromCCB();
        node.controller.popup();
    }
};

module.exports = PopupMan;
},{"../controller/ActivityTaskController":62,"../controller/ActivityTaskEntranceController":63,"../controller/ActivityTaskTipsController":66,"../controller/BagController":70,"../controller/BoxController":74,"../controller/CardController":76,"../controller/ChallengeReliveController":83,"../controller/DailyBonusController":84,"../controller/FailCnController":88,"../controller/FailController":89,"../controller/GameOverController":91,"../controller/GameWinController":92,"../controller/HelpController":94,"../controller/LuckySpinController":99,"../controller/NoticeController":101,"../controller/PassCnController":104,"../controller/PassController":105,"../controller/PauseCnController":106,"../controller/PauseController":107,"../controller/RankController":108,"../controller/RewardDoubleController":110,"../controller/RewardGetController":111,"../controller/RewardGiftController":112,"../controller/RewardNoticeController":114,"../controller/RewardRemoveAdsController":117,"../controller/RewardVideoController":118,"../controller/SettingController":119,"../controller/SkinController":120,"../controller/SkinUnlockController":123,"../controller/SpecialOfferController":124,"../controller/StoreController":125,"../controller/SuperBoardController":127,"../controller/TaskController":128,"../controller/WatchAdsGet3StarController":131,"../controller/WatchAdsGetDiamondsController":132,"../controller/WatchAdsGetItemController":133,"../controller/WatchAdsGetSkinController":134,"../controller/WatchAdsRelifeController":135,"../controller/WheelController":136,"../enum/RankType":162}],176:[function(require,module,exports){
var FileCacheStub = require("../../common/util/FileCacheStub");

var ResourcesMan = cc.Class.extend({

    fileCacheStub: null,

    ctor: function () {
        this.fileCacheStub = new FileCacheStub();
    },

    preload: function (callback) {
        //cc.log("preload 111");
        var results = game.utils.loadJson("res/resource_list/resource_list.json");
        var audios = game.utils.loadJson("res/resource_list/audio_list.json");
        var fileCacheStub = this.fileCacheStub;

        var picList = [];
        var plistList = [];
        var cacheList = [];
        results.forEach(function (fileName) {
            var extName = cc.path.extname(fileName);
            if (extName === ".png" || extName === ".jpg") {
                picList.push(fileName);
            } else if (extName === ".plist") {
                plistList.push(fileName);
            } else if (extName === ".ccbi" || extName === ".json" || extName === ".atlas" || extName === ".ogg") {
                cacheList.push(fileName);
            }
        });

        var loadPicFuncs = [];
        for (var i = 0; i < picList.length; ++i) {
            //cc.log("preload 222");
            var loadPicFunc = function (fileName) {
                return function () {
                    cc.textureCache.addImage(fileName);
                };
            }
            loadPicFuncs.push(loadPicFunc(picList[i]));
        }

        var loadListFuc = function () {
            //cc.log("preload 333");
            plistList.forEach(function (fileName) {
                var index = fileName.indexOf(".");
                if (index >= 0) {
                    var plistName = fileName.substr(0, index);
                    cc.spriteFrameCache.addSpriteFrames(game.utils.sprintf("%s.plist", plistName),
                        game.utils.sprintf("%s.png", plistName));
                }
            });
        };

        var cacheFunc = function () {
            //cc.log("preload 444");
            cacheList.forEach(function (fileName) {
                fileCacheStub.cacheFile(fileName);
            });
        };

        var preloadAudio = function () {
            //cc.log("preload 555");
            audios.forEach(function (fileName) {
                game.audioPlayer.preloadEffect(fileName);
            });
        };

        var funcList = loadPicFuncs.concat([loadListFuc, cacheFunc, preloadAudio]);

        game.utils.loadIterator(funcList, function () {
            if (callback) {
                callback();
            }
        });
    }
});

ResourcesMan._instance = null;
ResourcesMan._firstUseInstance = true;

/**
 *
 * @returns {ResourcesMan}
 */
ResourcesMan.getInstance = function () {
    if (ResourcesMan._firstUseInstance) {
        ResourcesMan._firstUseInstance = false;
        ResourcesMan._instance = new ResourcesMan();
    }
    return ResourcesMan._instance;
};

module.exports = ResourcesMan;
},{"../../common/util/FileCacheStub":37}],177:[function(require,module,exports){
/**
 * Created by qinning on 2018/1/1.
 */

var SceneType = require("../enum/SceneType");
var MenuScene = require("../scene/MenuScene");
var LevelScene = require("../scene/LevelScene");
var PackageScene = require("../scene/PackageScene");
var GameScene = require("../scene/GameScene");
var GameBridge = require("../../common/bridge/GameBridge");
var ChallengeScene = require("../scene/ChallengeScene");
var ChallengeListScene = require("../scene/ChallengeListScene");

var SceneMan = cc.Class.extend({

    sceneMap: null,

    lastScene: null,
    curScene: null,

    ctor: function () {
        this.sceneMap = {};
        this.register();
        this.lastScene = SceneType.NONE;
        this.curScene = SceneType.MENU;
    },

    setCurScene: function (scene) {
        this.curScene = scene;
    },

    register: function () {
        this.sceneMap[SceneType.MENU] = GameBridge.getMenuScene;
        this.sceneMap[SceneType.PACKAGE] = function () {
            return new PackageScene();
        };
        this.sceneMap[SceneType.LEVEL] = function () {
            return new LevelScene();
        };
        this.sceneMap[SceneType.GAME] = function () {
            return new GameScene();
        };
        this.sceneMap[SceneType.CHALLENGE] = function () {
            return new ChallengeScene();
        };
        this.sceneMap[SceneType.CHALLENGE_LIST] = function () {
            return new ChallengeListScene();
        };
    },

    switchScene: function (sceneType) {
        this.lastScene = this.curScene;
        this.curScene = sceneType;
        var scene = this.sceneMap[this.curScene];
        if (scene) {
            cc.director.runScene(scene());
        }
    },

    switchLastScene: function () {
        this.switchScene(this.lastScene);
    }
});

SceneMan._instance = null;
SceneMan._firstUseInstance = true;

/**
 *
 * @returns {SceneMan}
 */
SceneMan.getInstance = function () {
    if (SceneMan._firstUseInstance) {
        SceneMan._firstUseInstance = false;
        SceneMan._instance = new SceneMan();
    }
    return SceneMan._instance;
};

module.exports = SceneMan;
},{"../../common/bridge/GameBridge":5,"../enum/SceneType":163,"../scene/ChallengeListScene":179,"../scene/ChallengeScene":180,"../scene/GameScene":181,"../scene/LevelScene":182,"../scene/MenuScene":184,"../scene/PackageScene":185}],178:[function(require,module,exports){
/**
 * Created by qinning on 2017/1/23.
 */

var PaymentInfo = require("../../common/entity/PaymentInfo");
var PaymentCode = require("../../common/enum/PaymentCode");
var ProductInfo = require("../../common/entity/ProductInfo");
var StoreType = require("../enum/StoreType");
var ConfigMan = require("../config/ConfigMan");
var BoostType = require("../enum/BoostType");
var EventsName = require("../events/EventsName");
var SkinType = require("../enum/SkinType");

var StoreHelper = cc.Class.extend({

    /**
     * @type {Array.<ProductInfo>}
     */
    productList: null,
    /**
     * @type {Array.<StoreConfig>}
     */
    storeList: null,

    inited: false,

    _rewardCB: null,

    ctor: function () {
        game.storeManager.setPaymentDelegate(this);
        game.adsManager.setAdListener(this);
    },

    init: function () {
        if (this.inited) {
            return;
        }
        this.inited = true;
        this.storeList = ConfigMan.getInstance().getStoreList();
        // this.requestProducts();
        // this.getUnverifiedReceiptList();
    },

    clear: function () {
        game.adsManager.setAdListener(null);
    },

    onRewardedVideoFinished: function (isRewarded, channelName) {
        cc.log("StoreHelper onRewardedVideoFinished:" + isRewarded);
        this._isRewarded = isRewarded;
        this._channelName = channelName;
    },

    onShowVideoAdBegin: function () {
        cc.log("StoreHelper onShowVideoAdBegin");
        this._isRewarded = false;
    },

    onShowVideoAdEnd: function () {
        cc.log("StoreHelper onShowVideoAdEnd");
        var time = 500;
        setTimeout(function () {
            if (this._isRewarded) {
                this.onRewardedVideoReward();
                this._isRewarded = false;
            } else {
                if (this._rewardCB) {
                    this._rewardCB(false);
                    this._rewardCB = null;
                }
            }
        }.bind(this), time);
    },

    onRewardedVideoReward: function () {
        game.analyseManager.trackEvent("WatchRVSource", {name: this._adName, channel: this._channelName});
        if (this._rewardCB) {
            this._rewardCB(true);
            this._rewardCB = null;
            return;
        }
        if (game.playerMan.getRewardAdPlaceCountPerDay() >= game.config.rewardAdMaxCountPerDay) {
            cc.log("StoreHelper onRewardedVideoReward has reached max count:" + game.playerMan.getRewardAdPlaceCountPerDay());
            return;
        }
        var name = "";
        if (this._adParam1) {
            game.analyseManager.trackEvent(this._adParam1);
            name = this._adParam1;
        } else {
            name = "unknown";
            cc.error("StoreHelper adParam is null:" + this._adParam1);
        }
        this._adParam1 = null;
        game.playerMan.addRewardAdCountPerDay();
        var freeEntity = this.getStoreEntityByType(StoreType.FREE);
        game.popupMan.popupRewardNoticeDlg(game.local.getValue("reward_video_diamonds"),
            function () {
                game.playerMan.addDiamonds(freeEntity.count, "reward_video_" + name);
            }, this.getBoostImage(BoostType.DIAMOND), freeEntity.count);
    },

    /**
     * @param pid
     * @returns {StoreConfig | null}
     */
    getStoreEntity: function (pid) {
        for (var i = 0; i < this.storeList.length; ++i) {
            if (this.storeList[i].pid === pid) {
                return this.storeList[i];
            }
        }
        return null;
    },

    getStoreEntityByType: function (type) {
        for (var i = 0; i < this.storeList.length; ++i) {
            if (this.storeList[i].type === type) {
                return this.storeList[i];
            }
        }
        return null;
    },

    getBoostImage: function (boostType) {
        switch (boostType) {
            case BoostType.SPLIT:
                return "store_3_multiple.png";
            case BoostType.THREE_BALL:
                return "store_3_new.png";
            case BoostType.DIAMOND:
                return "icon_diamond_1.png";
            case BoostType.AIM_ITEM:
                return "store_aim.png";
        }
    },

    _getNumFromString: function (text) {
        return text.replace(/[^0-9.]/ig, "");
    },

    updatePrice: function (product) {
        var storeProduct = this.getStoreEntity(product.productId);
        if (storeProduct) {
            storeProduct.price = product.price;
            try {
                if (storeProduct.original_price) {
                    var priceStr = this._getNumFromString(product.price);
                    var priceNum = Number(priceStr);
                    storeProduct.original_price = product.price.replace(priceStr,
                        (priceNum * (storeProduct.discount_multi + 1)).toFixed(2));
                }
            } catch (ex) {
                cc.error("update price:" + ex);
            }
        }
    },

    checkAndShowRewardVideo: function (name, cb, param1) {
        this._adParam1 = param1;
        this._adName = name;
        if (game.adsManager.isRewardVideoReady()) {
            this._rewardCB = cb;
            game.adsManager.showRewardVideoAd(name);
        } else {
            game.analyseManager.trackEvent("WatchRVNotReady", {name: name});
            cb && cb(false);
            cc.log("reward video not ready");
        }
    },

    /**
     * @param {StoreConfig} storeEntity
     */
    buyProduct: function (storeEntity) {
        switch (storeEntity.type) {
            case StoreType.NEW_3:
            case StoreType.SPLIT:
            case StoreType.FIRST_PURCHASE:
                game.storeManager.payForProduct(storeEntity.pid);
                break;
            case StoreType.DIAMOND:
                //game.analyseManager.trackEvent("PurchaseDiamonds", {"pid": storeEntity.pid});
                game.storeManager.payForProduct(storeEntity.pid);
                break;
            case StoreType.FREE:
                this.checkAndShowRewardVideo(game.utils.isIOS() ? "daoju01" : "jili03");
                break;
            case StoreType.REMOVE_ADS:
                this.buyRemoveAds(storeEntity.pid);
                break;
            case StoreType.RESTORE:
                game.storeManager.restoreCompletedTransactions();
                break;
            case StoreType.NEW_AND_SPLIT:
                this.buyBoosts(storeEntity);
                break;
            case StoreType.AIM_ITEM:
                game.storeManager.payForProduct(storeEntity.pid);
                break;
        }
    },

    buyRemoveAds: function (pid) {
        if (game.playerMan.player.removedAds) {
            game.popupMan.popupCommonDlg(game.local.getValue("removed_all_ads_tips"));
        } else {
            if (cc.sys.os === cc.sys.OS_ANDROID) {
                game.popupMan.popupYesNoCommonDlg(game.local.getValue("purchase_no_ad_tips"),
                    game.local.getValue("buy_title"), game.local.getValue("cancel_title"), function () {
                        game.storeManager.payForProduct(pid);
                    }, null, false);
            } else {
                game.popupMan.popupYesNoCommonDlg(game.local.getValue("purchase_no_ad_tips"),
                    game.local.getValue("buy_title"), game.local.getValue("restore_title"), function () {
                    game.storeManager.payForProduct(pid);
                }, function () {
                    game.storeManager.restoreCompletedTransactions();
                }, true);
            }
        }
    },

    buySkin: function (skinCfg, rewardName, cb) {
        if (!game.playerMan.hasSkin(skinCfg.id)) {
            switch (skinCfg.type) {
                case SkinType.Diamonds:
                    if (game.playerMan.getDiamonds() >= skinCfg.count) {
                        game.playerMan.setClaimedSkin(skinCfg.id);
                        game.playerMan.setCurrentSkinId(skinCfg.id);
                        game.playerMan.addDiamonds(-skinCfg.count, "purchase_skin", "skin", 1);
                        game.eventDispatcher.dispatchEvent(EventsName.UPDATE_SKIN);
                        game.analyseManager.trackEvent("DiamondPurchaseSkin", {"skinId": skinCfg.id});
                        cb && cb(true);
                    } else {
                        this.popupLackDiamonds();
                    }
                    break;
                case SkinType.WatchAds:
                    this.checkAndShowRewardVideo(rewardName, function (rewarded) {
                        if (rewarded) {
                            game.playerMan.addSkinAdsCount(skinCfg.id);
                            if (game.playerMan.getSkinAdsCount(skinCfg.id) >= skinCfg.count) {
                                game.playerMan.setClaimedSkin(skinCfg.id);
                                game.playerMan.setCurrentSkinId(skinCfg.id);

                                game.popupMan.popupRewardNoticeDlg(game.local.getValue("skin_claimed"),
                                    function () {
                                    }, skinCfg.image + "_l.png", 1);
                                cb && cb(true);
                            }
                            game.analyseManager.trackEvent("RewardVideoPurchaseSkin", {"skinId": skinCfg.id});
                            game.eventDispatcher.dispatchEvent(EventsName.UPDATE_SKIN);
                        }
                    });
                    break;
                default:
                    cc.error("undefined skin type:" + skinCfg.type);
                    break;
            }
        }
    },

    onSkinWatchAdsOwned: function (skinCfg, cb) {
        game.playerMan.addSkinAdsCount(skinCfg.id);
        // if (game.playerMan.getSkinAdsCount(skinCfg.id) >= skinCfg.count) {
            game.playerMan.setClaimedSkin(skinCfg.id);
            game.playerMan.setCurrentSkinId(skinCfg.id);

            game.popupMan.popupRewardNoticeDlg(game.local.getValue("skin_claimed"),
                function () {
                    cb && cb();
                }, skinCfg.image + "_l.png", 1);

        // }
        game.analyseManager.trackEvent("RewardVideoPurchaseSkin", {"skinId": skinCfg.id});
        game.eventDispatcher.dispatchEvent(EventsName.UPDATE_SKIN);
    },

    buyBoard: function (boardCfg, rewardName, cb) {
        if (!game.playerMan.hasBoard(boardCfg.id)) {
            switch (boardCfg.type) {
                // case SkinType.Diamonds:
                //     if (game.playerMan.getDiamonds() >= skinCfg.count) {
                //         game.playerMan.setClaimedSkin(skinCfg.id);
                //         game.playerMan.setCurrentSkinId(skinCfg.id);
                //         game.playerMan.addDiamonds(-skinCfg.count, "purchase_skin", "skin", 1);
                //         game.eventDispatcher.dispatchEvent(EventsName.UPDATE_SKIN);
                //         game.analyseManager.trackEvent("DiamondPurchaseSkin", {"skinId": skinCfg.id});
                //         cb && cb(true);
                //     } else {
                //         this.popupLackDiamonds();
                //     }
                //     break;
                case SkinType.WatchAds:
                    this.checkAndShowRewardVideo(rewardName, function (rewarded) {
                        if (rewarded) {
                            game.playerMan.addBoardAdsCount(boardCfg.id);
                            if (game.playerMan.getBoardAdsCount(boardCfg.id) >= boardCfg.count) {
                                game.playerMan.setClaimedBoard(boardCfg.id);
                                game.playerMan.setCurrentBoardId(boardCfg.id);

                                game.popupMan.popupRewardNoticeDlg(game.local.getValue("board_claimed"),
                                    function () {
                                    }, boardCfg.image + ".png", 1);
                                cb && cb(true);
                            }
                            game.analyseManager.trackEvent("RewardVideoPurchaseBoard", {"boardId": boardCfg.id});
                            game.eventDispatcher.dispatchEvent(EventsName.UPDATE_BOARD);
                        }
                    });
                    break;
                default:
                    cc.error("undefined skin type:" + boardCfg.type);
                    break;
            }
        }
    },

    getClaimedSkinCount: function (skinType) {
        var count = 0;
        var skinList = ConfigMan.getInstance().getSkinListByType(skinType);
        for (var i = 0; i < skinList.length; ++i) {
            var skinCfg = skinList[i];
            var owned = game.playerMan.hasSkin(skinCfg.id);
            if (owned) {
                count++;
            }
        }
        return count;
    },

    getClaimedBoardSkinCount: function (skinType) {
        var count = 0;
        var skinList = ConfigMan.getInstance().getBoardListByType(skinType);
        for (var i = 0; i < skinList.length; ++i) {
            var skinCfg = skinList[i];
            var owned = game.playerMan.hasBoard(skinCfg.id);
            if (owned) {
                count++;
            }
        }
        return count;
    },

    claimSkinReward: function (skinCfg, notify, callback) {
        game.playerMan.setClaimedSkin(skinCfg.id);
        game.playerMan.setCurrentSkinId(skinCfg.id);
        game.eventDispatcher.dispatchEvent(EventsName.UPDATE_SKIN);

        if (skinCfg.type === SkinType.KeyActivity) {
            var claimedCount = this.getClaimedSkinCount(SkinType.KeyActivity);
            game.analyseManager.trackEvent("ClaimedChestSkinCount", {"count": claimedCount});

            game.analyseManager.trackEvent("ClaimedChestTotalSkinCount", {"count": this.getClaimedBoardSkinCount(SkinType.KeyActivity) + claimedCount});
        }

        if (!notify) {
            return;
        }
        var image = skinCfg.image + "_l.png";
        if (!cc.spriteFrameCache.getSpriteFrame(image)) {
            image = skinCfg.image + ".png";
        }
        game.popupMan.popupRewardNoticeDlg(game.local.getValue("skin_claimed"),
            function () {
                callback && callback();
            }, image, 1);
    },

    claimBoardReward: function (boardCfg, notify, callback) {
        game.playerMan.setClaimedBoard(boardCfg.id);
        game.playerMan.setCurrentBoardId(boardCfg.id);

        if (boardCfg.type === SkinType.KeyActivity) {
            var claimedCount = this.getClaimedBoardSkinCount(SkinType.KeyActivity);
            game.analyseManager.trackEvent("ClaimedChestBoardSkinCount", {"count": claimedCount});

            game.analyseManager.trackEvent("ClaimedChestTotalSkinCount", {"count": this.getClaimedSkinCount(SkinType.KeyActivity) + claimedCount});
        }

        if (!notify) {
            return;
        }
        game.popupMan.popupRewardNoticeDlg(game.local.getValue("board_claimed"),
            function () {
                callback && callback();
            }, boardCfg.image + ".png", 1);
    },

    useSkin: function (skinCfg) {
        game.playerMan.setCurrentSkinId(skinCfg.id);
        game.eventDispatcher.dispatchEvent(EventsName.UPDATE_SKIN);
    },

    buyBoosts: function (storeEntity) {
        if (game.playerMan.getDiamonds() >= storeEntity.count) {
            var splitCount = storeEntity.data.multiple_3;
            var threeBallCount = storeEntity.data.new_3;
            var splitImage = this.getBoostImage(BoostType.SPLIT);
            var new3Image = this.getBoostImage(BoostType.THREE_BALL);
            game.playerMan.addDiamonds(-storeEntity.count / 2, "buy_boosts", "boost_split", splitCount);
            game.playerMan.addDiamonds(-storeEntity.count / 2, "buy_boosts", "boost_new_3", threeBallCount);
            game.playerMan.addBoost(BoostType.SPLIT, splitCount);
            game.playerMan.addBoost(BoostType.THREE_BALL, threeBallCount);
            game.analyseManager.trackEvent("DiamondPurchaseBoosts", {"diamonds": storeEntity.count});
            game.popupMan.popupRewardDlg(game.local.getValue("purchase_boost_success"),
                function () {
                }, splitImage, splitCount, new3Image, threeBallCount);
        } else {
            this.popupLackDiamonds();
        }
    },

    buyOneBoost: function () {
        var storeEntity = {
            "count": 20,
            "data": {
                "new_3": 1,
                "multiple_3": 1
            }
        };
        if (game.playerMan.getDiamonds() >= storeEntity.count) {
            var splitCount = storeEntity.data.multiple_3;
            var threeBallCount = storeEntity.data.new_3;
            game.playerMan.addDiamonds(-storeEntity.count / 2, "buy_boosts", "boost_split", splitCount);
            game.playerMan.addDiamonds(-storeEntity.count / 2, "buy_boosts", "boost_new_3", threeBallCount);
            game.analyseManager.trackEvent("DiamondPurchaseBoostsInGame", {"diamonds": storeEntity.count});
            game.playerMan.addBoost(BoostType.SPLIT, splitCount);
            game.playerMan.addBoost(BoostType.THREE_BALL, threeBallCount);
            return true;
        } else {
            //this.popupLackDiamonds();
            return false;
        }
    },

    skipLevel: function (levelId) {
        if (game.playerMan.getDiamonds() >= game.config.skipDiamonds) {
            game.playerMan.addDiamonds(-game.config.skipDiamonds, "skip_level", "skip_level", 1);
            game.analyseManager.consumeItem("skip_level", 1);
            game.analyseManager.trackEvent("DiamondPurchaseSkipLevel", {"level": levelId});
            return true;
        } else {
            this.popupLackDiamonds();
            return false;
        }
    },

    reliveLevel: function (levelId) {
        if (game.playerMan.getDiamonds() >= game.config.relifeDiamonds) {
            game.playerMan.addDiamonds(-game.config.relifeDiamonds, "revive", "revive", 1);
            game.analyseManager.consumeItem("revive", 1);
            game.analyseManager.trackEvent("DiamondPurchaseReliveLevel", {"level": levelId});
            return true;
        } else {
            this.popupLackDiamonds();
            return false;
        }
    },

    tryAimItem: function (levelId, callback) {
        this.checkAndShowRewardVideo("try_aim_item", function (rewarded) {
            if (rewarded) {
                game.analyseManager.trackEvent("RewardedVideoTryAimItem", {"level": levelId});
                callback && callback();
            }
        }.bind(this));
    },

    onOpenBox: function (callback) {
        //open the wheel.
        var WheelType = require("../enum/WheelType");
        game.popupMan.popupWheelDlg(WheelType.Box, callback);
    },

    popupLackDiamonds: function () {
        //game.popupMan.popupCommonDlg(_("diamond_not_enough"));
        if (!game.gameMan.isSpecialOfferPurchased()) {
            game.popupMan.popupSpeicialOffer();
        } else {
            var StoreType = require("../enum/StoreType");
            game.popupMan.popupStoreDlg(StoreType.DIAMOND);
        }
    },

    requestProducts: function () {
        var productIds = [];
        for (var i = 0; i < this.storeList.length; ++i) {
            var entity = this.storeList[i];
            if (entity && entity.pid) {
                productIds.push(entity.pid);
            }
        }
        cc.log("requestproducts:" + JSON.stringify(productIds));
        game.storeManager.requestProduct(productIds);
    },

    getUnverifiedReceiptList: function () {
        game.storeManager.getUnverifiedReceiptList();
    },

    /**
     * @param {PaymentCode} error
     * @param {PaymentInfo} paymentInfo
     */
    onPaymentCompleted: function (error, paymentInfo) {
        var paymentSuccess = false;
        if (error === PaymentCode.PAYMENT_CODE_SUCCESS) {
            this._onPaymentSuccess(paymentInfo, true);
            paymentSuccess = true;
        } else {
            game.popupMan.popupCommonDlg(game.local.getValue("purchase_fail"));
        }
        game.eventDispatcher.dispatchEvent(EventsName.PURCHASE_END, paymentSuccess);
    },

    /**
     * @param {Array.<PaymentInfo>} paymentInfoList
     */
    onGetUnverifiedReceiptList: function (paymentInfoList) {
        for (var i = 0; i < paymentInfoList.length; ++i) {
            this._onPaymentSuccess(paymentInfoList[i], false);
        }
    },

    /**
     * on get product list.
     * @param {Array.<ProductInfo>} productList
     */
    onGetProductList: function (productList) {
        this.productList = productList;
        for (var i = 0; i < productList.length; ++i) {
            var product = productList[i];
            this.updatePrice(product);
        }
    },

    /**
     * @param {PaymentInfo} paymentInfo
     * @param hasNotice
     * @private
     */
    _onPaymentSuccess: function (paymentInfo, hasNotice) {
        // var storeEntity = this.getStoreEntity()
        // var product = this._getProductById(paymentInfo.productId);
        // if (product) {
        //     // var price = this._getNumFromString(product.price) * 100;
        //     game.analyseManager.trackPurchaseEvent(price, product.title, paymentInfo.productId,
        //         paymentInfo.receipt);
        // }
        var storeEntity = this.getStoreEntity(paymentInfo.productId);
        var splitImage = this.getBoostImage(BoostType.SPLIT);
        var new3Image = this.getBoostImage(BoostType.THREE_BALL);
        var self = this;
        switch (storeEntity.type) {
            case StoreType.REMOVE_ADS:
                game.playerMan.removedAds();
                if (hasNotice) {
                    game.popupMan.popupCommonDlg(game.local.getValue("purchase_no_ad_success"));
                }
                if (cc.sys.os === cc.sys.OS_IOS) {
                    game.storeManager.consume(paymentInfo.purchaseId);
                }
                self.addIapCount(storeEntity);
                game.analyseManager.trackChargeRequest(paymentInfo.purchaseId, paymentInfo.productId, storeEntity.priceUS, "USD", 0, "IAP");
                game.analyseManager.trackChargeSuccess(paymentInfo.purchaseId);
                break;
            case StoreType.NEW_3:
            case StoreType.SPLIT:
                game.popupMan.popupRewardDlg(game.local.getValue("purchase_boost_success"), function () {
                    game.playerMan.addBoost(storeEntity.type, storeEntity.count);
                    game.storeManager.consume(paymentInfo.purchaseId);
                    self.addIapCount(storeEntity);
                }, storeEntity.image, storeEntity.count);
                break;
            case StoreType.FIRST_PURCHASE:
                var diamondCount = storeEntity.data.diamonds;
                game.popupMan.popupRewardDlg(game.local.getValue("purchase_success"),
                    function () {
                        game.playerMan.addDiamonds(diamondCount, "first_purchase", undefined, undefined, true);
                        game.storeManager.consume(paymentInfo.purchaseId);
                        game.playerMan.setSpecialOfferPurchased(paymentInfo.productId);
                        game.analyseManager.trackEvent("PurchaseSpecialOffer");
                        self.addIapCount(storeEntity);
                        //var splitCount = storeEntity.data.multiple_3;
                        //var threeBallCount = storeEntity.data.new_3;
                        //game.popupMan.popupRewardDlg(game.local.getValue("purchase_boost_success"),
                        //    function () {
                        //        game.playerMan.addBoost(BoostType.SPLIT, splitCount);
                        //        game.playerMan.addBoost(BoostType.THREE_BALL, threeBallCount);
                        //    }, splitImage, splitCount, new3Image, threeBallCount);
                        game.analyseManager.trackChargeRequest(paymentInfo.purchaseId, paymentInfo.productId, storeEntity.priceUS, "USD", diamondCount, "IAP");
                        game.analyseManager.trackChargeSuccess(paymentInfo.purchaseId);
                    }, this.getBoostImage(BoostType.DIAMOND), diamondCount);
                break;
            case StoreType.NEW_AND_SPLIT:
                var splitCount = storeEntity.data.multiple_3;
                var threeBallCount = storeEntity.data.new_3;
                game.popupMan.popupRewardDlg(game.local.getValue("purchase_boost_success"),
                    function () {
                        game.playerMan.addBoost(BoostType.SPLIT, splitCount);
                        game.playerMan.addBoost(BoostType.THREE_BALL, threeBallCount);
                        game.storeManager.consume(paymentInfo.purchaseId);
                        self.addIapCount(storeEntity);
                    }, splitImage, splitCount, new3Image, threeBallCount);
                break;
            case StoreType.DIAMOND:
                var count = storeEntity.count;
                game.popupMan.popupRewardDlg(game.local.getValue("purchase_success"),
                    function () {
                        game.playerMan.addDiamonds(count, "purchase", undefined, undefined, true);
                        game.storeManager.consume(paymentInfo.purchaseId);
                        self.addIapCount(storeEntity);
                        game.analyseManager.trackChargeRequest(paymentInfo.purchaseId, paymentInfo.productId, storeEntity.priceUS, "USD", count, "IAP");
                        game.analyseManager.trackChargeSuccess(paymentInfo.purchaseId);
                    }, storeEntity.image, count);
                break;
            case StoreType.AIM_ITEM:
                game.popupMan.popupRewardDlg(game.local.getValue("purchase_success"),
                    function () {
                        game.playerMan.purchasedAimItem();
                        game.storeManager.consume(paymentInfo.purchaseId);
                        game.analyseManager.trackEvent("PurchaseAimItem");
                        self.addIapCount(storeEntity);
                        game.analyseManager.trackChargeRequest(paymentInfo.purchaseId, paymentInfo.productId, storeEntity.priceUS, "USD", 0, "IAP");
                        game.analyseManager.trackChargeSuccess(paymentInfo.purchaseId);
                        game.eventDispatcher.dispatchEvent(EventsName.UPDATE_AIM_ITEM);
                    }, this.getBoostImage(BoostType.AIM_ITEM), 1);
                break;
        }
    },

    addIapCount: function (storeEntity) {
        game.playerMan.addIapCount();
        var iapCount = game.playerMan.player.iapCount;
        if (iapCount === 1) {
            game.analyseManager.trackEvent("FirstPurchase", {"pid": storeEntity.pid});
        } else if (iapCount === 2) {
            game.analyseManager.trackEvent("SecondPurchase", {"pid": storeEntity.pid});
        }
        if (iapCount >= 2) {
            game.analyseManager.trackEvent("MultiPurchase", {"pid": storeEntity.pid});
        }
        game.analyseManager.trackEvent("PurchaseLevel", {"levelId": game.gameMan.levelId, "pid": storeEntity.pid});
    },

    popupBoostRewardDlg: function (splitCount, threeBallCount, callback) {
        var new3Image = this.getBoostImage(BoostType.THREE_BALL);
        var splitImage = this.getBoostImage(BoostType.SPLIT);

        var image1 = undefined;
        var count1 = 0;
        var image2 = undefined;
        var count2 = 0;
        if (threeBallCount > 0) {
            image1 = new3Image;
            count1 = threeBallCount;
            if (splitCount > 0) {
                image2 = splitImage;
                count2 = splitCount;
            }
        } else {
            image1 = splitImage;
            count1 = splitCount;
        }

        game.popupMan.popupRewardNoticeDlg(game.local.getValue("reward_video_boosts"),
            function () {
                game.playerMan.addBoost(BoostType.SPLIT, splitCount);
                game.playerMan.addBoost(BoostType.THREE_BALL, threeBallCount);
                if (callback) {
                    callback();
                }
            }, image1, count1, image2, count2);
    },

    popupAddDiamondsDlg: function (count, rewardName, cb) {
        game.popupMan.popupRewardNoticeDlg(game.local.getValue("reward_video_diamonds"),
            function () {
                game.playerMan.addDiamonds(count, rewardName);
                cb && cb();
            }, this.getBoostImage(BoostType.DIAMOND), count);
    },

    popupRewardDoubleDlg: function (itemCount, type, rewardName, cb) {
        game.popupMan.popupRewardDoubleTipDlg(this.getBoostImage(type), itemCount, rewardName, function (double) {
            var count = double ? itemCount * 2 : itemCount;
            var splitCount = 0;
            var threeBallCount = 0;
            var diamondCount = 0;
            if (type === BoostType.SPLIT) {
                splitCount = count;
            } else if (type === BoostType.THREE_BALL) {
                threeBallCount = count;
            } else if (type === BoostType.DIAMOND) {
                diamondCount = count;
            }
            if (double) {
                if (splitCount > 0 || threeBallCount > 0) {
                    var self = this;
                    self.popupBoostRewardDlg(splitCount, threeBallCount, function () {
                        if (diamondCount > 0) {
                            self.popupAddDiamondsDlg(diamondCount, rewardName, cb);
                        } else {
                            cb && cb();
                        }
                    });
                } else {
                    if (diamondCount > 0) {
                        this.popupAddDiamondsDlg(diamondCount, rewardName, cb);
                    } else {
                        cb && cb();
                    }
                }
            } else {
                game.playerMan.addBoost(BoostType.SPLIT, splitCount);
                game.playerMan.addBoost(BoostType.THREE_BALL, threeBallCount);
                game.playerMan.addDiamonds(diamondCount, rewardName);
                cb && cb();
            }
        }.bind(this));
    },

    checkAndGetRandomDiamonds: function (name, callback) {
        var diamondsCount = game.gameMan.getDiamondsMulti();
        var self = this;
        this.checkAndShowRewardVideo(name, function (watched) {
            if (watched) {
                game.popupMan.popupLuckySpin(diamondsCount, game.config.multiDiamondsRange, function () {
                    self.popupAddDiamondsDlg(diamondsCount, name, callback);
                });
            } else {
                callback && callback();
            }
        });
    },

    claimBoxReward: function (reward) {
        switch (reward.type) {
            case BoostType.SKIN:
                this.claimSkinReward(reward.extra, false);
                break;
            case BoostType.BOARD_SKIN:
                this.claimBoardReward(reward.extra, false);
                break;
            case BoostType.DIAMOND:
                game.playerMan.addDiamonds(reward.count, "box_reward");
                break;
            case BoostType.SPLIT:
                game.playerMan.addBoost(BoostType.SPLIT, reward.count);
                break;
            case BoostType.THREE_BALL:
                game.playerMan.addBoost(BoostType.THREE_BALL, reward.count);
                break;
        }
    }
});

StoreHelper._instance = null;
StoreHelper._firstUseInstance = true;

/**
 *
 * @returns {StoreHelper}
 */
StoreHelper.getInstance = function () {
    if (StoreHelper._firstUseInstance) {
        StoreHelper._firstUseInstance = false;
        StoreHelper._instance = new StoreHelper();
    }
    return StoreHelper._instance;
};

module.exports = StoreHelper;
},{"../../common/entity/PaymentInfo":10,"../../common/entity/ProductInfo":12,"../../common/enum/PaymentCode":14,"../config/ConfigMan":52,"../enum/BoostType":154,"../enum/SkinType":166,"../enum/StoreType":167,"../enum/WheelType":168,"../events/EventsName":169}],179:[function(require,module,exports){
var MenuController = require("../controller/MenuController");
var StoreHelper = require("../model/StoreHelper");
var ChallengeListController = require("../controller/ChallengeListController");

var LevelScene = cc.Scene.extend({

    ctor: function () {
        this._super();
        var layer = ChallengeListController.createFromCCB();
        this.addChild(layer);
    },

    onEnter:function () {
        this._super();

        cc.eventManager.addListener({
            event: cc.EventListener.KEYBOARD,
            onKeyReleased: function (keyCode, event) {
                if (keyCode === cc.KEY.back) {
                    if (!this._isBackClicked) {
                        this._isBackClicked = true;
                        game.sceneMan.switchScene(game.sceneType.MENU);
                    }
                }
            }.bind(this)
        }, this);

        game.adsManager.removeBannerAds("bottom");
        game.adsManager.removeBannerAds("top");
    },

    onExit: function () {
        game.dialogManager.closeAll();
        this._super();
    }
});

module.exports = LevelScene;
},{"../controller/ChallengeListController":81,"../controller/MenuController":100,"../model/StoreHelper":178}],180:[function(require,module,exports){
var MenuController = require("../controller/MenuController");
var StoreHelper = require("../model/StoreHelper");
var ChallengeParentController = require("../controller/ChallengeParentController");

var LevelScene = cc.Scene.extend({

    ctor: function () {
        this._super();
        var layer = ChallengeParentController.createFromCCB();
        this.addChild(layer);
    },

    onEnter:function () {
        this._super();

        cc.eventManager.addListener({
            event: cc.EventListener.KEYBOARD,
            onKeyReleased: function (keyCode, event) {
                if (keyCode === cc.KEY.back) {
                    if (!this._isBackClicked) {
                        this._isBackClicked = true;
                        game.sceneMan.switchScene(game.sceneType.CHALLENGE_LIST);
                    }
                }
            }.bind(this)
        }, this);

        game.adsManager.removeBannerAds("bottom");
        game.adsManager.removeBannerAds("top");
    },

    onExit: function () {
        game.dialogManager.closeAll();
        this._super();
    }
});

module.exports = LevelScene;
},{"../controller/ChallengeParentController":82,"../controller/MenuController":100,"../model/StoreHelper":178}],181:[function(require,module,exports){
var GameController = require("../controller/GameController");
var GameMan = require("../model/GameMan");
var StoreHelper = require("../model/StoreHelper");

var GameScene = cc.Scene.extend({
    _gameType: 0,
    _isBackClicked: false,

    ctor: function () {
        this._super();
        game.adsManager.removeBannerAds("bottom");
        game.gameMan.resetTryAnimItem();
        var gameNode = GameController.createFromCCB();
        this.addChild(gameNode);
    },

    onEnter:function () {
        this._super();
        StoreHelper.getInstance().init();
    },

    onExit: function () {
        game.dialogManager.closeAll();
        this._super();
    }
});

module.exports = GameScene;

},{"../controller/GameController":90,"../model/GameMan":173,"../model/StoreHelper":178}],182:[function(require,module,exports){
var MenuController = require("../controller/MenuController");
var StoreHelper = require("../model/StoreHelper");
var LevelController = require("../controller/LevelController");

var LevelScene = cc.Scene.extend({

    ctor: function () {
        this._super();
        var layer = LevelController.createFromCCB();
        this.addChild(layer);
    },

    onEnter:function () {
        this._super();

        cc.eventManager.addListener({
            event: cc.EventListener.KEYBOARD,
            onKeyReleased: function (keyCode, event) {
                if (keyCode === cc.KEY.back) {
                    if (!this._isBackClicked) {
                        this._isBackClicked = true;
                        game.sceneMan.switchScene(game.sceneType.MENU);
                    }
                }
            }.bind(this)
        }, this);

        if (game.gameMan.getMaxLevel() >= 3) {
            game.adsManager.showBannerAds("bottom");
        }
    },

    onExit: function () {
        game.dialogManager.closeAll();
        this._super();
    }
});

module.exports = LevelScene;
},{"../controller/LevelController":96,"../controller/MenuController":100,"../model/StoreHelper":178}],183:[function(require,module,exports){
/**
 * Created by oye on 15-4-19.
 */
var LoadingController = require("../controller/LoadingController");

var LoadingScene = cc.Scene.extend({
    ctor:function () {
        this._super();
        var layer = LoadingController.createFromCCB();
        this.addChild(layer);
    }
});

module.exports = LoadingScene;
},{"../controller/LoadingController":98}],184:[function(require,module,exports){
var MenuController = require("../controller/MenuController");
var StoreHelper = require("../model/StoreHelper");
var GameMan = require("../model/GameMan");
var PlayerMan = require("../model/PlayerMan");
var SceneMan = require("../model/SceneMan");
var SceneType = require("../enum/SceneType");
//var BricksView = require("../view/BricksView");

window.isFirstEnter = true;

var MenuScene = cc.Scene.extend({

    ctor: function () {
        this._super();

        var layer = MenuController.createFromCCB();
        this.addChild(layer);
    },

    onEnter:function () {
        this._super();

        StoreHelper.getInstance().init();

        var self = this;
        cc.eventManager.addListener({
            event: cc.EventListener.KEYBOARD,
            onKeyReleased: function (keyCode, event) {
                if (keyCode === cc.KEY.back) {
                    if (!self._isBackClicked) {
                        self._isBackClicked = true;
                        game.popupMan.popupYesNoCommonDlg(_("exit_game_confirm"), _("yes_title"), _("no_title"), function () {
                            game.logicMan.scheduleLocalNotification();
                            cc.director.end();
                        }, function () {
                            self._isBackClicked = false;
                        });
                    }
                }
            }
        }, this);

        if (game.gameMan.getMaxLevel() >= 3) {
            game.adsManager.showBannerAds("bottom");
        }

        if (game.adsManager.showTopBanner) {
            game.adsManager.removeBannerAds("top");
        }

        this.scheduleOnce(function () {
            game.gcManager.reportScore(0, game.config.getLeaderBoardKey());
            if (!window.isFirstEnter) {
                game.crossPromMan.tryToPopupCrossPromDlg();
            } else {
                window.isFirstEnter = false;
            }
        }, 1);
    },

    onExit: function () {
        game.dialogManager.closeAll();
        this._super();
    }
});

module.exports = MenuScene;
},{"../controller/MenuController":100,"../enum/SceneType":163,"../model/GameMan":173,"../model/PlayerMan":174,"../model/SceneMan":177,"../model/StoreHelper":178}],185:[function(require,module,exports){
var MenuController = require("../controller/MenuController");
var StoreHelper = require("../model/StoreHelper");
var PackageController = require("../controller/PackageController");

var PackageScene = cc.Scene.extend({
    ctor: function () {
        this._super();
        var layer = PackageController.createFromCCB();
        this.addChild(layer);
    },

    onEnter:function () {
        this._super();

        cc.eventManager.addListener({
            event: cc.EventListener.KEYBOARD,
            onKeyReleased: function (keyCode, event) {
                if (keyCode === cc.KEY.back) {
                    if (!this._isBackClicked) {
                        this._isBackClicked = true;
                        game.sceneMan.switchScene(game.sceneType.MENU);
                    }
                }
            }.bind(this)
        }, this);
    },

    onExit: function () {
        game.dialogManager.closeAll();
        this._super();
    }
});

module.exports = PackageScene;
},{"../controller/MenuController":100,"../controller/PackageController":102,"../model/StoreHelper":178}],186:[function(require,module,exports){
var Grid = require("../entity/Grid");
var Ball = require("../entity/Ball");
var BoardController = require("../controller/BoardController");
var BallPool = require("../entity/BallPool");
var Utils = require("../../common/util/Utils");
var GridType = require("../enum/GridType");
var Board = require("../entity/Board");
var ShapeType = require("../enum/ShapeType");
var Boost = require("../entity/Boost");
var BoostType = require("../enum/BoostType");
var Obstacle = require("../entity/Obstacle");
var Wall = require("../entity/Wall");
var GameMan = require("../model/GameMan");
var StoreHelper = require("../model/StoreHelper");
var EventsName = require("../events/EventsName");
var ItemCategory = require("../enum/ItemCategory");
var FailReason = require("../enum/FailReason");
var Key = require("../entity/Key");
var ChallengeId = require("../enum/ChallengeId");

var ColorConfigs = [
    cc.color(252, 178, 0),
    cc.color(74, 233, 0),
    cc.color(27, 226, 255),
    cc.color(255, 252, 29),
    cc.color(255, 56, 56),
    cc.color(248, 70, 255),
    cc.color(255, 129, 17),
    cc.color(57, 103, 249),
    cc.color(90, 181, 110),

    cc.color(255, 90, 141),
    cc.color(242, 86, 9),
    cc.color(89, 59, 255),
    cc.color(157, 83, 255),
    cc.color(45, 232, 150),
    cc.color(176, 72, 206),
    cc.color(168, 246, 32),
    cc.color(46, 76, 255),
    cc.color(239, 221, 201),
    cc.color(253, 209, 133),
    cc.color(249, 74, 155),
    cc.color(29, 60, 94)
];

var GrayColor = cc.color(82, 82, 82);

var getColor = function (type) {
    return ColorConfigs[(type - 1) % ColorConfigs.length];
};

var GameStep = {
    PRE_START: 1,
    AIM_GUIDE: 2,
    SLIDE_GUIDE: 3,
    START: 4,
    RELIFE: 5,
    BOMB: 6,
    LASER: 7,
    FAIL_AND_WAIT_RELIFE: 8,
    END: 9
};

var GridType = {
    None: 0,
    Brick: 1,
    Wall: 2
};

var BricksView = cc.Node.extend({
    SPACE_STEP: 1 / 60,
    // LIFE_POSIBILITY: 0.005,
    SUPER_BOARD_POSIBILITY: 0.02,
    BOMB_POSIBILITY: 0.15,
    BOOST_POSIBILITY: 0.12,
    MAX_SPEED: 238,
    MAX_LIFE: 3,
    BOOST_SPEED: 80,
    BOMB_SPEED: 100,
    MAX_BALL: 800,
    TOP_INNER_WALL: 60,
    MAX_SPLIT_COUNT: 100,
    TOP_AD_WALL: 100,
    HINT_BALL: 200,
    HINT_GRAY_BALL: 150,
    SPLIT_BALL_ANGLE: [45, 90, 135],
    MUST_GEN_BOOST_TIME: 35,

    /**
     * @type {LevelConfig}
     */
    config: null,

    row: 0,
    col: 0,

    ballList: null,

    gameStep: -1,

    lifeCount: 2,

    gameController: null,

    //startTime: 0,

    stoped: false,

    lastTime: 0,

    totalTime: 0,
    lastAdjustTime: 0,

    hardMode: false,

    accumulator: 0,
    boostTypeMap: null,
    lastGetBoostTime: 0,
    _curTouchId: -1,

    lastRemoveTime: 0,

    currentFPS: 60,

    isLowIOS: false,

    showedFlyGift: false,

    superBoardNode: null,

    keySprite: null,

    ctor: function (config, gameController) {
        this._super();
        if (game.utils.isLowAndroid()) {
            this.currentFPS = game.config.lowAndroidFPS;
        }
        this.isLowIOS = game.utils.isLowIOS();
        if (game.gameMan.levelId >= 30) {
            this.MAX_LIFE = Math.max(0, game.gameMan.getLifeCount() - 1);
            this.lifeCount = this.MAX_LIFE;
        } else {
            this.lifeCount = game.gameMan.getLifeCount();
            this.MAX_LIFE = this.lifeCount;
        }
        cc.log("max life count:" + this.MAX_LIFE);
        if (game.gameMan.isChallengeLevel) {
            this.MAX_LIFE = 0;
            this.lifeCount = 0;
            game.playerMan.setChallengePlaying(true, game.challengeMan.currentChallengeId);
            this.BOMB_POSIBILITY = this.BOMB_POSIBILITY * config.bombProbability;
        } else {
            this.hardMode = GameMan.getInstance().isHardMode();
            if (this.hardMode) {
                config = config.getHardCfg();
            }
        }
        this.WIN_WIDTH = cc.winSize.width;
        this.WIN_HEIGHT = cc.winSize.height;
        this.lastGetBoostTime = Date.now();
        this.boostTypeMap = {};
        this.boostTypeList = [BoostType.SPLIT, BoostType.THREE_BALL];
        if (cc.sys.os === cc.sys.OS_IOS && !this.isLowIOS) {
            this.MAX_BALL = 1000;
        }
        if (game.gameMan.isLessGridChallenge()) {
            this.MAX_SPEED *= 1.3;
        }
        BallPool.setMaxPoolSize("ball", this.MAX_BALL);
        BallPool.setMaxPoolSize("brick", 2000);
        if (game.utils.isIOSNotchScreen()) {
            this.TOP_AD_WALL += 70;
        } else if (game.utils.isPad()) {
            this.TOP_AD_WALL -= 40;
        }
        if (game.gameMan.isChallengeLevel && game.challengeMan.currentChallengeId === ChallengeId.Laser) {
            this.TOP_AD_WALL += 42;
        }

        this.BOOST_POSIBILITY = game.gameMan.getInitBoostProbability();
        cc.log("this.BOOST_POSIBILITY 1:" + this.BOOST_POSIBILITY)
        // this.BOOST_POSIBILITY *= GameMan.getInstance().getBoostProbability(config);
        this.BOOST_POSIBILITY = 0.08;
        cc.log("this.BOOST_POSIBILITY 2:" + this.BOOST_POSIBILITY);
        this.gameController = gameController;
        this.config = config;
        this.row = config.width;
        this.col = config.height;

        this.GRID_WIDTH = config.pixelWidth / config.width * 0.7;
        this.GRID_HEIGHT = config.pixelHeight / config.height * 0.7;

        this.GAP_WIDTH = config.pixelWidth / config.width - this.GRID_WIDTH;
        this.GAP_HEIGHT = config.pixelHeight / config.height - this.GRID_HEIGHT;

        this.GRID_AND_GAP_WIDTH = this.GRID_WIDTH + this.GAP_WIDTH;
        this.GRID_AND_GAP_HEIGHT = this.GRID_HEIGHT + this.GAP_HEIGHT;

        //顶部最小的能容纳整个球盘的空间
        var minBrickHeight = 600 + this.TOP_INNER_WALL + this.TOP_AD_WALL + 10;
        var maxBrickHeight = this.WIN_HEIGHT - minBrickHeight;

        if (game.utils.isIOSNotchScreen()) {
            this.BRICK_Y = Math.min(this.WIN_HEIGHT * 0.35, maxBrickHeight);
        } else {
            if (game.utils.isAndroidNotchScreen()) {
                this.BRICK_Y = Math.min(this.WIN_HEIGHT * 0.36, maxBrickHeight);
            } else {
                this.BRICK_Y = Math.min(this.WIN_HEIGHT * 0.3, maxBrickHeight);
            }
        }

        this.BOARD_Y = this.BRICK_Y - this.WIN_HEIGHT * 0.16;

        this.setContentSize(cc.winSize);

        this.superBoardNode = new cc.Node();
        this.addChild(this.superBoardNode);
        this.init();
    },

    onEnter: function () {
        this._super();
        cc.eventManager.addListener({
            event: cc.EventListener.TOUCH_ONE_BY_ONE,
            swallowTouches: true,
            onTouchBegan: this.onTouchBegan.bind(this),
            onTouchMoved: this.onTouchMoved.bind(this),
            onTouchEnded: this.onTouchEnded.bind(this),
            onTouchCancelled: this.onTouchCancelled.bind(this)
        }, this);

        this.scheduleUpdate();

        this.space.setDefaultCollisionHandler(
            this.collisionBegin.bind(this),
            this.collisionPre.bind(this),
            this.collisionPost.bind(this),
            this.collisionSeparate.bind(this)
        );
        game.eventDispatcher.addCustomEventListener(cc.game.EVENT_HIDE, this.gameOnHide, this);
        game.eventDispatcher.addEventListener(EventsName.UPDATE_SKIN, this.onUpdateSkin, this);
        game.eventDispatcher.addEventListener(EventsName.SHOW_AIM_GUIDE, this.onShowAimGuide, this);

        this.showTopBannerAds();

        cc.eventManager.addListener({
            event: cc.EventListener.KEYBOARD,
            onKeyReleased: function (keyCode, event) {
                if (keyCode === cc.KEY.back) {
                    this.tryShowPause();
                }
            }.bind(this)
        }, this);

        game.gameMan.onGameStart();
    },

    onExit: function () {
        game.eventDispatcher.removeEventListener(EventsName.SHOW_AIM_GUIDE, this.onShowAimGuide, this);
        game.eventDispatcher.removeCustomEventListener(cc.game.EVENT_HIDE, this.gameOnHide, this);
        game.eventDispatcher.removeEventListener(EventsName.UPDATE_SKIN, this.onUpdateSkin, this);
        //this.space.removeCollisionHandler(ShapeType.BALL,
        //    ShapeType.BRICK);
        this.unscheduleUpdate();
        this.removeTopBannerAds();
        //BallPool.drainAllPools();
        this.space = null;
        this.ballList = null;
        this.boosts = null;
        this.obstacles = null;
        this.walls = null;
        this.bricks = null;
        this._super();
    },

    onUpdateSkin: function () {
        for (var i = 0; i < this.ballList.length; ++i) {
            this.ballList[i].updateSkin();
        }
    },

    gameOnHide: function () {
        if (this.gameStep === GameStep.START) {
            this.tryShowPause();
        }
    },

    tryShowPause: function () {
        if (!this.stoped) {
            if (this.gameController) {
                this.gameController.showPause();
            }
        }
    },

    init: function () {
        this.initWorld();
        this.initObstacles();
        this.initBricks();
        this.initBoard();
        this.initHintLines();
        this.updateCountDownChallenge();
        this.initKey();

        this.ballList = [];
        this.boosts = [];

        this.lastAdjustTime = Date.now();
        this.lastRemoveTime = Date.now();
        this.gameStep = GameStep.PRE_START;
    },
    
    createDotNode: function () {
        var dot = new cc.Sprite("#skin_0.png");
        dot.scale = 0.2;
        dot.opacity = 150;
        dot.setColor(cc.color.GRAY);
        return dot;
    },

    initHintLines: function () {
        this.drawNode = new cc.Node();
        this.addChild(this.drawNode, this.HINT_GRAY_BALL);

        var skinCfg = GameMan.getInstance().getCurrentSkinCfg();
        this.hintSprite = new cc.Sprite("#" + skinCfg.image + ".png");
        this.addChild(this.hintSprite, this.HINT_BALL);
        this.hintSprite.visible = false;
        this.hintSprite.scale = this.getBallWidth() / this.hintSprite.width * skinCfg.scale;
	    this.dots = [];
        for (var i = 0; i < 40; i++) {
            var dot = this.createDotNode();
            this.dots.push(dot);
            dot.visible = false;
            this.drawNode.addChild(dot);
        }
    },

    initObstacles: function () {
        this.obstacles = [];
        this.walls = [];
        for (var i = 0; i < this.config.obstacles.length; ++i) {
            this.initObstacle(this.config.obstacles[i], this, this.obstacles, this.walls);
        }
    },

    initObstacle: function (obstacleCfg, container, obstacles, walls) {
        for (var x = 0; x < obstacleCfg.width; ++x) {
            for (var y = 0; y < obstacleCfg.height; ++y) {
                var localCol = x + obstacleCfg.x;
                var localRow = y + obstacleCfg.y;
                var obstacle = BallPool.getFromPool("obstacle");
                if (!obstacle) {
                    obstacle = new Obstacle(GrayColor, this.GRID_WIDTH, this.GRID_HEIGHT);
                } else {
                    obstacle.reset(GrayColor, this.GRID_WIDTH, this.GRID_HEIGHT);
                }
                container.addChild(obstacle);
                // cc.log("localRow:" + localRow);
                var pos = this.getGridPos(localRow, localCol);
                // cc.log("pos:" + JSON.stringify(pos));
                obstacle.setPosition(pos);
                obstacles.push(obstacle);
                // this.grids[localCol][localRow] = GridType.Wall;
            }
        }
        var WALL_FILL_SIZE = cc.size(6, 6);
        var wall = new Wall();
        wall.setContentSize(cc.size(
            this.GRID_WIDTH * obstacleCfg.width + this.GAP_WIDTH * (obstacleCfg.width - 1) + WALL_FILL_SIZE.width,
            this.GRID_HEIGHT * obstacleCfg.height + this.GAP_HEIGHT * (obstacleCfg.height - 1) + WALL_FILL_SIZE.height));
        walls.push(wall);
        container.addChild(wall);
        var pos = cc.pAdd(this.getGridPos(obstacleCfg.y, obstacleCfg.x),
            cc.p(-0.5 * this.GRID_WIDTH, -0.5 * this.GRID_HEIGHT));
        pos = cc.pAdd(pos, cc.p(-WALL_FILL_SIZE.width * 0.5, -WALL_FILL_SIZE.height * 0.5));
        wall.initBody(this.space, pos);
    },

    initBricks: function () {
        this.bricks = [];
        for (var i = 0; i < this.config.bricks.length; ++i) {
            var brickCfg = this.config.bricks[i];
            for (var x = 0; x < brickCfg.width; ++x) {
                for (var y = 0; y < brickCfg.height; ++y) {
                    var brick = this.createBrick(x, y, brickCfg);
                    this.bricks.push(brick);
                }
            }
        }
    },

    createBrick: function (x, y, brickCfg) {
        var localCol = x + brickCfg.x;
        var localRow = y + brickCfg.y;
        var brick = BallPool.getFromPool("brick");
        if (!brick) {
            brick = new Grid(getColor(brickCfg.type), this.GRID_WIDTH, this.GRID_HEIGHT, GridType.BRICK);
        } else {
            brick.reset(getColor(brickCfg.type), this.GRID_WIDTH, this.GRID_HEIGHT, GridType.BRICK);
        }
        // this.grids[localCol][localRow] = GridType.Brick;
        this.addChild(brick);
        brick.initBody(this.space, this.getGridPos(localRow, localCol), this.GRID_AND_GAP_WIDTH - 2, this.GRID_AND_GAP_HEIGHT - 2);
        return brick;
    },

    initBoard: function () {
        this.boardNode = new Board(this.getBallWidth());
        this.addChild(this.boardNode);
        this.boardNode.initBody(this.space, cc.p(this.WIN_WIDTH * 0.5, this.BOARD_Y));
    },

    getBallWidth: function () {
        return Math.max(this.GRID_WIDTH, 8);
    },

    initWorld: function () {
        this.WALL_THICK = 50;
        this.INNER_WALL = 20;
        //this.TOP_INNER_WALL = 50;
        this.space = new cp.Space();
        var xOffset = 0;
        if (window.isEditor) {
            xOffset = cc.winSize.width - 640;
        }
        var walls = [
            {
                "shape": cc.size(this.WIN_WIDTH + this.WALL_THICK, this.WALL_THICK), //top
                "pos": cp.v(this.WIN_WIDTH * 0.5 - this.WALL_THICK * 0.5, this.WIN_HEIGHT + this.WALL_THICK * 0.5 - this.TOP_INNER_WALL - this.TOP_AD_WALL)
            },
            {
                "shape": cc.size(this.WALL_THICK, this.WIN_HEIGHT + this.WALL_THICK), //left
                "pos": cp.v(xOffset * 0.5 - this.WALL_THICK * 0.5 + this.INNER_WALL, this.WIN_HEIGHT * 0.5 - this.WALL_THICK * 0.5)
            },
            {
                "shape": cc.size(this.WALL_THICK, this.WIN_HEIGHT + this.WALL_THICK), //right
                "pos": cp.v(-xOffset * 0.5 + this.WIN_WIDTH + this.WALL_THICK * 0.5 - this.INNER_WALL, this.WIN_HEIGHT * 0.5 - this.WALL_THICK * 0.5)
            }
        ];

        for (var i = 0; i < walls.length; i++) {
            var body = new cp.Body(Infinity, Infinity);
            var wall = walls[i];
            var shape = new cp.BoxShape(body, wall.shape.width, wall.shape.height);
            shape.setElasticity(1);
            shape.setFriction(0);
            //shape.layers = 1;
            body.setPos(wall.pos);
            this.space.addStaticShape(shape);
        }

        //for (var i = 0; i < walls.length; i++) {
        //    var body = new cp.Body(Infinity, Infinity);
        //    var wall = walls[i];
        //    var shape = new cp.BoxShape(body, wall.shape.width, wall.shape.height);
        //    shape.setElasticity(1);
        //    shape.setFriction(0);
        //    shape.layers = HINT_WALL_GROUP;
        //    body.setPos(wall.pos);
        //    this.space.addStaticShape(shape);
        //}

        // Gravity
        this.space.gravity = cp.v(0, 0);
        this.space.sleepTimeThreshold = 0.5;
        this.space.collisionSlop = 0.5;
        this.space.iterations = 5;
        if (cc.sys.isNative) {
            this.space.useSpatialHash(this.getBallWidth(), this.MAX_BALL * 10);
        }

        //this.initDebugMode();
    },

    initDebugMode: function () {
        this._debugNode = cc.PhysicsDebugNode.create(this.space);
        this.addChild(this._debugNode);
    },

    initKey: function () {
        return;
        if (game.gameMan.levelId < 3) {
            return;
        }
        if (game.gameMan.isChallengeLevel) {
            return;
        }
        if (game.playerMan.player.currentKeyCount >= 3) {
            return;
        }
        var randomNum = game.utils.randomNextInt(100);
        if (randomNum < 65) {
            var pos = this.getKeyPos();
            if (!pos) {
                return;
            }
            var keySprite = new Key();
            keySprite.setPosition(pos);
            this.addChild(keySprite);
            this.keySprite = keySprite;
        }
    },

    flyKey: function () {
        if (this.keySprite) {
            this.keySprite.stopAllActions();
            this.keySprite.opacity = 255;
            game.playerMan.addCurrentKeyCount();
            var worldPosition = this.gameController.ndKeyNode.convertToWorldSpace(cc.p(0, 0));
            var currentPosition = this.keySprite.getPosition();
            var distance = cc.pLength(cc.pSub(currentPosition, worldPosition));
            this.keySprite.runAction(cc.sequence(cc.moveTo(distance * 0.0014, worldPosition), cc.callFunc(this.updateKeyCount, this), cc.removeSelf()));
            this.keySprite = null;
        }
    },

    removeKey: function () {
        if (this.keySprite) {
            // this.keySprite.removeBody();
            this.keySprite.removeFromParent();
            this.keySprite = null;
        }
    },

    updateKeyCount: function () {
        this.gameController.updateKeyCount();
    },

    getKeyPos: function () {
        this.keyPositions = [];
        this.getGenerateKeyPos();
        if (this.keyPositions.length === 0) {
            return null;
        }
        var pos = this.keyPositions[game.utils.randomNextInt(this.keyPositions.length)];
        return this.getGridPos(pos.y + 1.5, pos.x + 0.5);
    },

    getGenerateKeyPos: function () {
        var grids = [];
        var i, j, brickCfg, x, y;
        for (i = 0; i < this.config.width; ++i) {
            grids[i] = [];
            for (j = 0; j < this.config.height; ++j) {
                grids[i][j] = {
                    type: GridType.None,
                    find: false
                };
            }
        }
        for (i = 0; i < this.config.bricks.length; ++i) {
            brickCfg = this.config.bricks[i];
            for (x = 0; x < brickCfg.width; ++x) {
                for (y = 0; y < brickCfg.height; ++y) {
                    grids[brickCfg.x + x][brickCfg.y + y] = {
                        type: GridType.Grid,
                        find: false
                    };
                }
            }
        }
        for (i = 0; i < this.config.obstacles.length; ++i) {
            brickCfg = this.config.obstacles[i];
            for (x = 0; x < brickCfg.width; ++x) {
                for (y = 0; y < brickCfg.height; ++y) {
                    grids[brickCfg.x + x][brickCfg.y + y] = {
                        type: GridType.Wall,
                        find: false
                    };
                }
            }
        }

        var findFirstGridPoss = this.findFirstGrids(this.config, grids);
        if (findFirstGridPoss.length === 0) {
            return false;
        }
        this.grids = grids;
        while (findFirstGridPoss.length > 0) {
            var index = game.utils.randomNextInt(findFirstGridPoss.length);
            var firstGridPos = findFirstGridPoss[index];
            findFirstGridPoss.splice(index, 1);
            this.searchGrid(firstGridPos.x, firstGridPos.y, 0);

            if (this.keyPositions.length > 50) {
                break;
            }
        }
    },

    findFirstGrids: function (levelCfg, grids) {
        var i;
        var results = [];
        for (i = 0; i < levelCfg.width; ++i) {
            if (grids[i][0].type !== GridType.Wall) {
                results.push(cc.p(i, 0));
            }
        }
        return results;
    },

    searchGrid: function (x, y, depth) {
        if (x >= 0 && x < this.config.width && y >= 0 && y < this.config.height) {
            var grid = this.grids[x][y];
            if (grid.type === GridType.Wall) {
                return;
            }
            if (grid.find) {
                return;
            }
            grid.find = true;
            var find = true;
            for (var i = x; i < x + 2; ++i) {
                for (var j = y; j < y + 4; ++j) {
                    if (!this.grids[i] || !this.grids[i][j] || this.grids[i][j].type !== GridType.None) {
                        find = false;
                        break;
                    }
                }
                if (!find) {
                    break;
                }
            }
            if (find) {
                this.keyPositions.push(cc.p(x, y));
            }
            depth++;
            if (depth > 500) {
                return;
            }
            this.searchGrid(x - 1, y, depth);
            this.searchGrid(x + 1, y, depth);
            this.searchGrid(x, y + 1, depth);
            this.searchGrid(x, y - 1, depth);
        }
    },

    getGridPos: function (localRow, localCol) {
        var gridSize = this.getGridSize();
        return cc.p((this.WIN_WIDTH - this.config.pixelWidth) * 0.5 + (gridSize.width + this.GAP_WIDTH) * (localCol + 0.5),
            (gridSize.height + this.GAP_HEIGHT) * (localRow + 0.5) + this.BRICK_Y);
    },

    getGridSize: function () {
        if (!this.lastGridSize) {
            this.lastGridSize = cc.size(this.GRID_WIDTH, this.GRID_HEIGHT);
        }
        return this.lastGridSize;
    },

    update: function (dt) {
        if (this.stoped) {
            return;
        }
        switch (this.gameStep) {
            case GameStep.PRE_START:

                break;
            case GameStep.START:
                this.updateTime(dt);
                //var t2 = Date.now();
                //cc.log("update start t2:" + (t2 - t1));
                this.updateGrids(dt);
                //var t3 = Date.now();
                //cc.log("update start t3:" + (t3 - t2));
                this.updateChipmunk(dt);
                //var t4 = Date.now();
                //cc.log("update start t4:" + (t4 - t3));
                this.updateBoost(dt);
                this.updateKey(dt);
                //var t5 = Date.now();
                //cc.log("update start t5:" + (t5 - t4));
                this.checkGameOver();
                //var t6 = Date.now();
                //cc.log("update start t6:" + (t6 - t5));
                this.checkAndShowFlyGift();
                this.updateLaser(dt);
                break;
            case GameStep.RELIFE:
                 if (this.gameController) {
                     this.gameController.updateLifeCount();
                 }
                this.removeAllBoosts();
                 if (this.ballList.length > 0) {
                     this.gameStep = GameStep.START;
                 } else {
                     this.boardNode.showBall();
                     this.gameStep = GameStep.PRE_START;
                 }
                break;
            case GameStep.END:
                this.updateChipmunk(dt);
                break;

            case GameStep.AIM_GUIDE:
                var worldPosition = this.gameController.ndAimHelp.controller.getHandWorldPosition();
                if (!this.lastAimHelpPosition) {
                    this.lastAimHelpPosition = worldPosition;
                }
                var offset = (worldPosition.x - this.lastAimHelpPosition.x);
                if (Math.abs(offset) > 10) {
                    this.clearHintNode();
                    this.drawAimLine(worldPosition);
                }
                break;
        }
    },

    laserFired: true,

    updateLaser: function (dt) {
        if (!game.gameMan.isChallengeLevel) {
            return;
        }
        if (game.challengeMan.currentChallengeId !== ChallengeId.Laser) {
            return;
        }

        if (!this.lastShowLaserTime) {
            this.lastShowLaserTime = 0;
        }
        if (this.eclipsedTime - this.lastShowLaserTime > 3000 + this.config.lazerInterval * 1000) {
            if (this.gameController) {
                game.audioPlayer.playEffectByKey("laser_prepare");
                this.gameController.showLaser();
                this.laserFired = false;
            }
            this.lastShowLaserTime = this.eclipsedTime;
        }
        else {
            if (!this.laserFired && this.eclipsedTime - this.lastShowLaserTime > 2000) {
                this.laserFired = true;
                game.audioPlayer.playEffectByKey("laser_fire");
            }
        }

        if (this.gameController) {
            if (this.gameController.isCollisionWithLaser(this.boardNode)) {
                this.playLaserBombAnim(this.boardNode.getPosition());
            }
        }
    },

    updateTime: function (dt) {
        if (!this.eclipsedTime) {
            this.eclipsedTime = 0;
        }
        this.eclipsedTime += dt * 1000;
        if (this.gameController) {
            this.gameController.updateTime();
            this.updateCountDownChallenge();
        }
    },

    updateCountDownChallenge: function () {
        if (game.gameMan.isCountDownChallenge()) {
            var leftTime = this.getCountDownLeftTime();
            if (leftTime < 0) {
                this.gameController.updateCountDownTime(0);
                this.popupChallengeRevive(FailReason.Timeout);
                game.audioPlayer.stopEffect("count_down");
            } else {
                if (this.lastLeftTime >= 10 && leftTime < 10) {
                    game.audioPlayer.playEffectByKey("count_down", true);
                }
                this.gameController.updateCountDownTime(leftTime);
            }
            this.lastLeftTime = leftTime;
        }
    },

    addedCountDownTime: 0,

    getCountDownLeftTime: function () {
        if (!this.eclipsedTime) {
            this.eclipsedTime = 0;
        }
        return Math.floor(this.addedCountDownTime * 1000 + this.config.starTime * 1000 - this.eclipsedTime) / 1000;
    },

    updateBalls: function (dt) {
        var removeCount = 0;
        var canRemove = (Date.now() - this.lastRemoveTime) > 200;
        if (!canRemove) {
            if (this.ballList.length <= 2) {
                canRemove = true;
            }
        }
        var i, ball;
        if (canRemove) {
            this.lastRemoveTime = Date.now();
            //cc.log("update balls :" + canRemove + ", ball count:" + this.ballList.length);
            for (i = this.ballList.length - 1; i >= 0; --i) {
                ball = this.ballList[i];
                var position = ball.getPosition();
                if (position.y < this.BOARD_Y - 40 || !this.isInView(position)) {
                    this.removeBall(ball);
                    removeCount++;
                }
            }
        }
        if (Date.now() - this.lastAdjustTime > 1000) {
            this.lastAdjustTime = Date.now();
            for (i = this.ballList.length - 1; i >= 0; --i) {
                ball = this.ballList[i];
                this.adjustBallSpeed(ball);
            }
        }
    },

    adjustBallSpeed: function (ball) {
        var vel = ball.getVel();
        var distance = cc.pLength(vel);
        if (distance < this.MAX_SPEED * 0.9 || distance > this.MAX_SPEED * 1.1) {
            var radian;
            if (vel.x > 0) {
                radian = Math.atan(vel.y / vel.x);
            } else {
                radian = Math.atan(vel.y / vel.x) + Math.PI;
            }
            ball.setVel(cc.p(this.MAX_SPEED * Math.cos(radian), this.MAX_SPEED * Math.sin(radian)));
        }
    },

    randomBallSpeed: function (ball) {
        this.adjustBallSpeed(ball);
        if (!ball._lastRandomTime) {
            ball._lastRandomTime = Date.now();
        }
        //more than 5 seconds,then try to adjust ball speed.
        if (Date.now() - ball._lastRandomTime >= 5000) {
            //cc.log("brick view:adjust ball speed:" + (Date.now() - ball._lastRandomTime));
            ball._lastRandomTime = Date.now();
            this.randomAdjustBallSpeed(ball);
        }
    },

    updateGrids: function (dt) {
        for (var i = this.bricks.length - 1; i >= 0; --i) {
            var brick = this.bricks[i];
            if (brick.removeable) {
                this.removeBrick(brick);
            }
        }
    },

    updateChipmunk: function (dt) {
        //var t1 = Date.now();
        var delta = this.currentFPS;
        if (cc.sys.os === cc.sys.OS_ANDROID || this.isLowIOS) {
            if (this.ballList.length > 20) {
                this.space.step(1 / delta);
            } else {
                for (var i = 0; i < 2; ++i) {
                    this.space.step(1 / delta / 2);
                }
            }
        } else {
            if (this.ballList.length > 50) {
                this.space.step(1 / delta);
            } else if (this.ballList.length > 20) {
                for (var i = 0; i < 2; ++i) {
                    this.space.step(1 / delta / 2);
                }
            } else {
                for (var i = 0; i < 3; ++i) {
                    this.space.step(1 / delta / 3);
                }
            }
        }
        //var t2 = Date.now();
        //cc.log("update t2:" + (t2 - t1));
        this.updateBalls(dt);
        //var t3 = Date.now();
        //cc.log("update t3:" + (t3 - t2));
    },

    randomAdjustBallSpeed: function (ball) {
        var RANDOM_MAX_COUNT = 60;
        var random1 = game.utils.rangeNextNumber(-RANDOM_MAX_COUNT * 0.5, RANDOM_MAX_COUNT * 0.5);
        var random2 = game.utils.rangeNextNumber(-RANDOM_MAX_COUNT * 0.5, RANDOM_MAX_COUNT * 0.5);
        ball.setVel(cc.pAdd(ball.getVel(), cc.p(random1, random2)));
    },

    updateBoost: function (dt) {
        for (var i = this.boosts.length - 1; i >= 0; --i) {
            var boost = this.boosts[i];
            if (boost.type === BoostType.BOMB) {
                boost.y -= dt * this.BOMB_SPEED;
            } else {
                boost.y -= dt * this.BOOST_SPEED;
            }
            if (cc.rectIntersectsRect(boost.getBoundingBox(), this.boardNode.getBoundingBox())) {
                switch (boost.type) {
                    case BoostType.LIFE:
                        this.onAddLife();
                        break;
                    case BoostType.SPLIT:
                        this.useSplitBallBoost();
                        break;
                    case BoostType.THREE_BALL:
                        this.useNew3BallBoost();
                        break;
                    case BoostType.BOMB:
                        this.useBombBoost(boost.getPosition());
                        break;
                    case BoostType.SUPER_BOARD:
                        this.useSuperBoard();
                        break;
                }
                this.boosts.splice(i, 1);
                boost.removeFromParent();
            } else if (boost.y < 0) {
                this.boosts.splice(i, 1);
                boost.removeFromParent();
            }
        }
    },

    updateKey: function (dt) {
        if (this.keySprite) {
            if (!this.showedKeyRemoveAnim && this.eclipsedTime >= 15000) {
                this.showedKeyRemoveAnim = true;
                this.keySprite.runAction(
                    cc.sequence(
                        cc.sequence(
                            cc.fadeIn(0.5),
                            cc.fadeOut(0.5)
                        ).repeat(5), cc.callFunc(this.removeKey, this)));
            }
            var spriteBoundingBox = this.keySprite.getBoundingBox();
            for (var i = 0; i < this.ballList.length; ++i) {
                var ball = this.ballList[i];
                if ( cc.rectContainsPoint(spriteBoundingBox, ball.getPosition())) {
                    game.audioPlayer.playEffectByKey("get_key");
                    this.flyKey();
                    break;
                }
            }
        }
    },

    useSplitBallBoost: function () {
        this.tryShootFirstBall(cc.p(0, 1));
        game.audioPlayer.playEffectByKey("boost_add");
        game.audioPlayer.vibrateShort();
        // var t1 = Date.now();
        for (var j = this.ballList.length - 1; j >= 0; --j) {
            var ball = this.ballList[j];
            this.onSplitBall(ball.getPosition());
            if (this.ballList.length > this.MAX_BALL) {
                break;
            }
        }
        // var t2 = Date.now();
        //cc.log("split ball time:" + (t2 - t1));
    },

    useNew3BallBoost: function () {
        this.tryShootFirstBall(cc.p(0, 1));
        game.audioPlayer.playEffectByKey("boost_add");
        this.onShoot3Ball();
        game.audioPlayer.vibrateShort();
    },

    useSuperBoard: function () {
        this.superBoardWalls = [];
        this.superBoardObstacles = [];

        game.audioPlayer.playEffectByKey("super_board");

        var y = -Math.floor((this.BRICK_Y - this.BOARD_Y) / this.GRID_AND_GAP_HEIGHT) - 3;

        this.initObstacle({
            x: 0,
            y: y,
            width: this.config.width,
            height: 2
        }, this.superBoardNode, this.superBoardObstacles, this.superBoardWalls);
        var self = this;
        var seq = cc.sequence(
            cc.sequence(cc.fadeOut(0.2), cc.fadeIn(0.2)).repeat(3),
            cc.delayTime(4.6),
            cc.sequence(cc.fadeIn(0.2), cc.fadeOut(0.2)).repeat(3));
        for (var i = 0; i < this.superBoardObstacles.length; ++i) {
            this.superBoardObstacles[i].sprite.runAction(seq.clone());
        }
        this.superBoardNode.runAction(cc.sequence(
            cc.delayTime(7.2),
            cc.callFunc(function () {
                self.superBoardNode.removeAllChildren();
                for (var i = 0; i < self.superBoardWalls.length; ++i) {
                    var superBoardWall = self.superBoardWalls[i];
                    superBoardWall.removeBody();
                }
            })
        ));
    },

    canUseBoost: function () {
        return (this.gameStep === GameStep.START);
    },

    useBombBoost: function (pos) {
        this.gameStep = GameStep.BOMB;
        var p1 = new cc.ParticleSystem("res/menu/bomb.plist");
        game.audioPlayer.playEffectByKey("bomb");
        p1.setPosition(pos);
        p1.scale = 2;
        this.addChild(p1, 1000);
        this.runAction(cc.sequence(cc.delayTime(1), cc.callFunc(function () {
            this.popupChallengeRevive(FailReason.Bomb);
        }.bind(this), this)));
    },

    playLaserBombAnim: function (pos) {
        this.gameStep = GameStep.LASER;
        var p1 = new cc.ParticleSystem("res/menu/bomb.plist");
        game.audioPlayer.playEffectByKey("bomb");
        p1.setPosition(pos);
        p1.scale = 2;
        this.addChild(p1, 1000);
        this.runAction(cc.sequence(cc.delayTime(1), cc.callFunc(function () {
            this.popupChallengeRevive(FailReason.Laser);
        }.bind(this), this)));
    },

    onAddLife: function () {
        this.lifeCount++;
        if (this.gameController) {
            this.gameController.updateLifeCount();
        }
        game.audioPlayer.playEffectByKey("life_add");
        game.audioPlayer.vibrateShort();
    },

    onSplitBall: function (position) {
        var vel = this.MAX_SPEED;
        for (var i = 0; i < 3; ++i) {
            var angle = game.utils.randomNextInt(90);
            var symbol1 = (game.utils.randomNextInt(2) === 1 ? 1 : -1);
            var symbol2 = (game.utils.randomNextInt(2) === 1 ? 1 : -1);
            var x = 10,y = 10;
            var randomPos = cc.pAdd(position, cc.p(-x / 2 + x * game.utils.randomNextNumber(1),
                -y / 2 + y * game.utils.randomNextNumber(1)));
            this.shootBall(randomPos, cc.p(symbol1 * vel * Math.sin(Math.PI / 180 * angle),
                    symbol2 * vel * Math.cos(Math.PI / 180 * angle)));
        }
    },

    onShoot3Ball: function () {
        var vel = this.MAX_SPEED;
        for (var i = 0; i < 3; ++i) {
            var speed = cc.p(vel * Math.cos(Math.PI / 180 * this.SPLIT_BALL_ANGLE[i]),
                vel * Math.sin(Math.PI / 180 * this.SPLIT_BALL_ANGLE[i]));
            this.shootBall(this.getInitBallPos(), speed);
        }
    },

    showedWin: false,
    switchPassDlg: function () {
        game.audioPlayer.playEffectByKey("victory");
        var self = this;
        setTimeout(function () {
            if (game.gameMan.isNewResult()) {
                self.showedWin = false;
                var showed = game.adsManager.showInterstitial(game.adsPlace.Pass, function () {
                    if (!self.showedWin) {
                        self.showedWin = true;
                        self.showPass();
                    }
                });
                if (!showed) {
                    self.showPass();
                } else {
                    setTimeout(function () {
                        if (!self.showedWin) {
                            self.showedWin = true;
                            self.showPass();
                        }
                    }, 10000);
                }
            } else {
                self.showPass();
            }
        }, 500);
    },

    showPass: function () {
        setTimeout(function () {
            game.popupMan.popupPassDlg(function () {
                GameMan.getInstance().resumeGame();
                game.sceneMan.switchScene(game.sceneType.GAME);
            }, function () {
                cc.log("game.gameMan.levelId:" + game.gameMan.levelId);
                if (game.gameMan.isChallengeLevel && (game.gameMan.levelId - 1) % 5 === 0) {
                    game.sceneMan.switchScene(game.sceneType.CHALLENGE);
                    return;
                }

                if (GameMan.getInstance().hasNextLevel()) {
                    game.sceneMan.switchScene(game.sceneType.GAME);
                } else {
                    game.popupMan.popupCommonDlg(game.local.getValue("all_completed"), function () {
                        game.sceneMan.switchScene(game.sceneType.LEVEL);
                    });
                }
            });
        }, 200);
    },

    checkGameOver: function () {
        var self = this;
        if (this.bricks.length === 0) {
            if (window.isEditor) {
                return;
            }
            //return;
            this.gameStep = GameStep.END;
            game.audioPlayer.stopEffect("count_down");
            this.showBannerAds();
            var levelId = GameMan.getInstance().levelId;
            GameMan.getInstance().gameWin(this.eclipsedTime / 1000);
            if (game.gameMan.isChallengeLevel) {
                this.switchPassDlg();
            } else {
                var star = GameMan.getInstance().currentStar;
                if (star < 3) {
                    game.popupMan.popupGet3Star("3_star", function (watched) {
                        if (watched) {
                            game.gameMan.onWatchAdsGet3Star(levelId);
                            self.switchPassDlg();
                        } else {
                            self.switchPassDlg();
                        }
                    });
                } else {
                    this.switchPassDlg();
                }
            }
        } else if (this.ballList.length === 0) {
            if (this.lifeCount > 0) {
                this.lifeCount--;
                this.gameStep = GameStep.RELIFE;
            } else {
                if (game.gameMan.isChallengeLevel) {
                    this.popupChallengeRevive(FailReason.Normal);
                } else {
                    if (game.adsManager.isRewardVideoReady()) {
                        this.gameStep = GameStep.FAIL_AND_WAIT_RELIFE;
                        game.popupMan.popupRelife(function (relife) {
                            if (relife) {
                                self.watchAdAndRelife();
                            } else {
                                self.switchToFail();
                            }
                        });
                    } else {
                        self.switchToFail();
                    }
                }
            }
        }
    },

    popupChallengeRevive: function (reason) {
        this.gameStep = GameStep.FAIL_AND_WAIT_RELIFE;
        var self = this;
        if (!game.challengeMan.canRevive()) {
            game.challengeMan.rollBackProgress();
            game.popupMan.popupCommonDlg(game.utils.sprintf(_("challenge_reset_tips"), game.challengeMan.getRollbackLevel()),
                function () {
                self.switchChallengeFail();
            });
            return;
        }
        game.popupMan.popupReliveDlg(reason, function () {
            self.switchToChallengeRelife();
        }, function () {
            game.challengeMan.popupQuitTips(function () {
                game.challengeMan.rollBackProgress();
                self.switchChallengeFail();
            }, function () {
                self.popupChallengeRevive(FailReason.Normal);
            });
        });
    },

    switchChallengeFail : function () {
        game.gameMan.onGameFail();
        this.gameStep = GameStep.END;
        game.audioPlayer.stopEffect("count_down");
        game.sceneMan.switchScene(game.sceneType.CHALLENGE);
    },

    watchAdAndRelife: function () {
        var self = this;
        StoreHelper.getInstance().checkAndShowRewardVideo(game.utils.isIOS() ? "fuhuo01" : "fuhuo01", function (rewarded) {
            if (rewarded) {
                game.analyseManager.trackEvent("WatchAdsToRelife");
                self.switchToRelife();
            } else {
                self.switchToFail();
            }
        });
    },

    //switchToWaitFail: function () {
    //    var self = this;
    //    this.gameStep = GameStep.FAIL_AND_WAIT_RELIFE;
    //    game.popupMan.popupReliveDlg(function () {
    //        self.switchToRelife();
    //    }, function () {
    //        self.switchToFail();
    //    });
    //},

    switchToRelife: function () {
        this.lifeCount = 2;
        this.gameStep = GameStep.RELIFE;
    },

    switchToChallengeRelife: function () {
        if (game.gameMan.isCountDownChallenge()) {
            if (this.getCountDownLeftTime() < 1) {
                this.addedCountDownTime += this.config.starTime;
            }
        }
        game.analyseManager.trackEvent("ChallengeReviveLevel", {"level": GameMan.getInstance().levelId});
        game.playerMan.addChallengeReviveCount(game.challengeMan.currentChallengeId);
        this.lifeCount = 0;
        this.gameStep = GameStep.RELIFE;
    },

    switchToFail: function () {
        if (window.isEditor) {
            this.switchToRelife();
        } else {
            GameMan.getInstance().onGameFail();
            this.gameStep = GameStep.END;
            game.audioPlayer.stopEffect("count_down");
            game.popupMan.popupFailDlg(function () {
                game.sceneMan.switchScene(game.sceneType.GAME);
            }, function () {
                GameMan.getInstance().skipLevel();
                game.sceneMan.switchScene(game.sceneType.GAME);
            });
        }
    },

    isInView: function (worldPos) {
        if (worldPos.x < 0 || worldPos.x > this.WIN_WIDTH || worldPos.y < 0 || worldPos.y > this.WIN_HEIGHT) {
            return false;
        }
        return true;
    },

    onShowAimGuide: function (event) {
        if (!game.playerMan.player.isAimVersion) {
            this.showAimGuideAnimation();
        }
    },

    showAimGuideAnimation: function () {
        this.gameController.ndAimHelp.visible = true;
        this.gameStep = GameStep.AIM_GUIDE;
    },

    tryShootFirstBall: function (direction) {
        if (this.gameStep === GameStep.PRE_START && direction) {
            this.gameStep = GameStep.START;
            this.shootBall(this.getInitBallPos(), cc.p(direction.x * this.MAX_SPEED, direction.y * this.MAX_SPEED));
            this.boardNode.hideBall();
            if (game.playerMan.player.isAimVersion) {
                if (this.hintGuide) {
                    this.scheduleOnce(function () {
                        this.stop();
                        this.gameController.ndHelp.visible = true;
                    }.bind(this), 1);
                }
            }
        }
    },

    getReflectionNormal: function (start, hitPoint, n) {
        var ao = cc.pSub(hitPoint, start);
        var dot = cc.pDot(ao, n);
        var ob = cc.pSub(ao, cc.pMult(n, 2 * dot));
        var normalOb = cc.pNormalize(ob);
        // cc.log("reflection normal:" + JSON.stringify(normalOb));
        return normalOb;
    },

    canShoot: function (touchLocation) {
        var start = this.getInitBallPos();
        if (touchLocation.y < start.y + 15) {
            return false;
        }
        return true;
    },

    drawDashNode: function (start, end, startCount) {
        var count = startCount;
        game.utils.getDashPointsNode(this.drawNode, [start, end], [20], 20, function (x1, y1) {
            if (!this.dots[count]) {
                var node = this.createDotNode();
                this.dots.push(node);
                this.drawNode.addChild(node);
            }
            this.dots[count].visible = true;
            this.dots[count++].setPosition(cc.p(x1, y1));
        }.bind(this));
        return count;
    },

    onTouchBegan:function(touch, event) {
        //cc.log("brick view onTouchBegan:" + touch.getID());
        if (this._curTouchId > 0) {
            return false;
        }
        this._curTouchId = touch.getID();
        if (game.playerMan.player.isAimVersion) {
            if (this.gameController && this.gameController.ndHelp.visible) {
                this.resume();
                this.gameController.ndHelp.visible = false;
                game.storageController.setItem("first_enter", "false");
            }

            if (this.gameController && this.gameController.ndAimHelp.visible) {
                this.gameController.ndAimHelp.visible = false;
                this.clearHintNode();
                this.hintGuide = true;
                this.gameStep = GameStep.PRE_START;
            }

            if (this.gameStep === GameStep.PRE_START || this.gameStep === GameStep.START) {
                this.lastTouchPos = this.getParent().convertToNodeSpace(touch.getLocation());
                this.lastDirection = null;
                this.gameController.ndGetBoardSkin.controller.playHideAnim();
                return true;
            }
        } else {
            if (this.gameController && this.gameController.ndHelp.visible) {
                this.gameController.ndHelp.visible = false;
                game.storageController.setItem("first_enter", "false");
                return false;
            }

            if (this.gameController && this.gameController.ndAimHelp.visible) {
                this.gameController.ndAimHelp.visible = false;
                this.clearHintNode();
                this.gameStep = GameStep.PRE_START;
            }

            this.lastTouchPos = this.getParent().convertToNodeSpace(touch.getLocation());
            this.lastDirection = cc.p(0, 1);
            this.gameController.ndAnimItem.controller.playHideAnim();
            this.gameController.ndGetBoardSkin.controller.playHideAnim();
            return true;
        }
        return false;
    },

    onTouchMoved:function(touch, event) {
        if (touch.getID() !== this._curTouchId) {
            return false;
        }
        // var t1 = Date.now();
        var touchLocation = this.getParent().convertToNodeSpace(touch.getLocation());
        if (this.lastTouchPos) {
            var offset = (touchLocation.x - this.lastTouchPos.x);
            var canMove = false;
            if (Math.abs(offset) > 0.5) {
                canMove = true;
            }
            if (this.gameStep === GameStep.LASER) {
                canMove = false;
            }
            if (game.gameMan.canUseAimItem()) {
                if (this.gameStep === GameStep.PRE_START) {
                    this.clearHintNode();
                    this.lastDirection = this.drawAimLine(touchLocation);
                    this.lastTouchPos = touchLocation;
                } else {
                    if (canMove) {
                        this.moveBoard(offset);
                        this.lastTouchPos = touchLocation;
                    }
                }
            } else {
                if (canMove) {
                    this.moveBoard(offset);
                    this.lastTouchPos = touchLocation;
                }
            }
        }
        // cc.log("onTouchMoved time:" + (Date.now() - t1));
        return true;
    },

    drawAimLine: function (touchLocation) {
        // var t1 = Date.now();

        var start = this.getInitBallPos();
        if (!this.canShoot(touchLocation)) {
            //touchLocation = cc.p(start.x, cc.winSize.height);
            return null;
        }
        // var t2 = Date.now();
        // cc.log("drawAimLine 1:" + (t2 - t1));
        var direction = cc.pNormalize(cc.pSub(touchLocation, start));
        var end = cc.pAdd(start, cc.pMult(direction, cc.winSize.height + cc.winSize.width));
        var radius = 10;
        var info = this.space.segmentQueryFirst(start, end, radius, {
            group: cp.NO_GROUP,
            categories: cp.ALL_CATEGORIES,
            mask: ItemCategory.Wall
        });
        // var t3 = Date.now();
        // cc.log("drawAimLine 2:" + (t3 - t2));
        if (info) {
            var hintPoint = info.point;
            var nextStartCount = this.drawDashNode(start, hintPoint, 0);
            // var t4 = Date.now();
            // cc.log("drawAimLine 3:" + (t4 - t3));
            var reflectionNormal = this.getReflectionNormal(start, hintPoint, info.normal);
            var reflectionPoint = cc.pAdd(hintPoint, cc.pMult(reflectionNormal, 80));
            // var t5 = Date.now();
            // cc.log("drawAimLine 4:" + (t5 - t4));
            this.drawDashNode(hintPoint, reflectionPoint, nextStartCount);
            // var t6 = Date.now();
            // cc.log("drawAimLine 5:" + (t6 - t5));
            this.hintSprite.visible = true;
            this.hintSprite.setPosition(hintPoint);
            // cc.log("drawAimLine total:" + (t6 - t1));
            return direction;
        } else {
            //return cc.p(0, 1);
            return null;
        }
    },

    moveBoard: function (offset) {
        var X_OFFSET = this.INNER_WALL + this.getBallWidth() * 0.5 + 2;
        var x = this.boardNode.x + offset * 1.6;
        if (x < X_OFFSET) {
            x = X_OFFSET;
        } else if (x > cc.winSize.width - X_OFFSET) {
            x = cc.winSize.width - X_OFFSET;
        }
        this.boardNode.setPosX(x);
    },

    onTouchEnded:function(touch, event) {
        //cc.log("brick view onTouchEnded:" + touch.getID());
        if (touch.getID() !== this._curTouchId) {
            return false;
        }
        if (game.gameMan.canUseAimItem()) {
            if (this.gameStep === GameStep.PRE_START) {
                this.tryShootFirstBall(this.lastDirection);
                this.clearHintNode();
            }
        } else {
            if (game.playerMan.player.isAimVersion) {
                this.tryShootFirstBall();
            } else {
                this.tryShootFirstBall(cc.p(0, 1));
            }
        }
        this.lastSelectGrid = null;
        this.lastTouchPos = null;
        this._curTouchId = -1;
        this.lastDirection = null;
    },

    onTouchCancelled:function(touch, event) {
        //cc.log("brick view onTouchCancelled:" + touch.getID());
        this.onTouchEnded(touch, event);
    },

    clearHintNode: function () {
        for (var i = 0; i < this.dots.length; ++i) {
            this.dots[i].visible = false;
        }
        this.hintSprite.visible = false;
    },

    collisionBegin : function ( arbiter, space ) {
        //cc.log('collision begin');
        return true;
    },

    collisionPre : function ( arbiter, space ) {
        //cc.log('collision pre');
        var shapes = arbiter.getShapes();
        for (var i = 0; i < shapes.length; ++i) {
            var shape = shapes[i];
            //cc.log("collision pre shape collision type:" + shape.collision_type);
            if (shape.collision_type == ShapeType.BRICK) {
                var body = shape.getBody();
                if (body.userData) {
                    var grid = body.userData;
                    var otherShape = this.getAnotherShape(shapes, i);
                    var otherShapeBody = otherShape.getBody();
                    if (otherShapeBody.userData) {
                        var ball = otherShapeBody.userData;
                        if (ball.breaking) {
                            continue;
                        }
                        ball.breaking = true;
                        grid.removeable = true;
                        grid.ball = ball;
                        this.generateBoost(grid.getPosition());
                    }
                }
            } else if (shape.collision_type == ShapeType.BALL) {
                if (this.gameStep === GameStep.START) {
                    this.playKnockAudio();
                }
            } else if (shape.collision_type == ShapeType.KEY) {
                cc.log("brick view: collision pre key");
            }
        }
        return true;
    },

    getAnotherShape: function (shapes, index) {
        if (index === 0) {
            return shapes[1];
        }
        return shapes[0];
    },

    collisionPost : function ( arbiter, space ) {
        //cc.log('collision post');
    },

    collisionSeparate : function ( arbiter, space ) {
        //cc.log('collision separate');
        var shapes = arbiter.getShapes();
        var ballShape = null;
        var boardShape = null;
        for (var i = 0; i < shapes.length; ++i) {
            //cc.log("collision separate shape collision type:" + shapes[i].collision_type);
            var shape = shapes[i];
            if (shape.collision_type == ShapeType.BALL) {
                var body = shape.getBody();
                if (body && body.userData) {
                    this.randomBallSpeed(body.userData);
                }
                ballShape = shape;
            } else if (shape.collision_type == ShapeType.BOARD) {
                boardShape = shape;
            } else if (shape.collision_type == ShapeType.KEY) {
                cc.log("brick view: collision separate key");
                var body = shape.getBody();
                if (body.userData) {
                    //cc.log("body.userData:" + body.userData.name);
                    body.userData.removeable = true;
                }
            }
        }
        if (ballShape && boardShape) {
            //cc.log("board collision 1");
            if (ballShape.body && ballShape.body.userData && boardShape.body && boardShape.body.userData) {
                //cc.log("board collision 2");
                var ball = ballShape.body.userData;
                var board = boardShape.body.userData;
                //cc.log("board collision 2 ball.getPosition().y:" + ball.getPosition().y);
                //cc.log("board collision 2 board.y + board.height * 0.5:" + (board.y + board.height * 0.5 - 10));
                if (ball.getPosition().y < board.y + board.height * 0.5 - 10) {
                    return;
                }
                //cc.log("board collision 3");
                var boardShapeX1 = ball.getPosition().x - (board.x - board.width / 2);
                var x = boardShapeX1 / boardShape.body.userData.width * 100 / 50 - 1;
                x = Math.max(Math.min(0.9, x), -0.9);
                //cc.log("board collision 4:" + x);
                var y = Math.sqrt(1 - x * x);
                ball.setVel(cc.p(this.MAX_SPEED * x, this.MAX_SPEED * y));
            }
        }
    },

    playKnockAudio: function () {
        if (Date.now() - this.lastTime > 80) {
            this.lastTime = Date.now();
            game.audioPlayer.playEffectByKey("knock");
        }
    },

    getInitBallPos: function () {
        return cc.pAdd(this.boardNode.getPosition(), cc.p(0, 20));
    },

    shootBall: function (position, vel) {
        if (this.ballList.length > this.MAX_BALL) {
            return;
        }
        var ball = BallPool.getFromPool("ball");
        if (!ball) {
            ball = new Ball(this.getBallWidth());
        } else {
            ball.reset(this.getBallWidth());
        }
        this.addChild(ball);
        this.ballList.push(ball);
        ball.initBody(this.space, position);
        ball.setVel(vel);
    },

    removeBall: function (ball) {
        var index = this.ballList.indexOf(ball);
        if (index > -1) {
            this.ballList.splice(index, 1);
        }
        ball.removeBody();
        BallPool.putInPool("ball", ball);
        ball.removeFromParent();
    },

    removeBrick: function (brick) {
        var index = this.bricks.indexOf(brick);
        if (index > -1) {
            this.bricks.splice(index, 1);
        }
        brick.removeBody();
        //if (brick.isGift) {
        //    this.stop();
        //    game.popupMan.popupRewardGift(function () {
        //        this.resume();
        //    }.bind(this));
        //} else {
        BallPool.putInPool("brick", brick);
        //}
        brick.removeFromParent();
    },

    getMinGenerateBoostType: function () {
        var boostCountSplit = this.boostTypeMap[BoostType.SPLIT] || 0;
        var boostCountThree = this.boostTypeMap[BoostType.THREE_BALL] || 0;
        if (boostCountSplit > boostCountThree * 2) {
            return BoostType.THREE_BALL;
        }
        return BoostType.SPLIT;
    },

    getEstimatedBallCount: function () {
        var ballCount = this.ballList.length;
        for (var i = 0; i < this.boosts.length; ++i) {
            if (this.boosts[i].y < this.boardNode.y - 30) {
                continue;
            }
            if (this.boosts[i].type === BoostType.SPLIT) {
                ballCount = ballCount * 4;
            } else if (this.boosts[i].type === BoostType.THREE_BALL) {
                ballCount += 3;
            }
        }
        return ballCount;
    },

    getBoostPosibility: function () {
        var posibility = this.BOOST_POSIBILITY / this.ballList.length;
        if (this.ballList.length < 50) {
            if (posibility < 0.015) {
                posibility = 0.015;
            }
        } else if (this.ballList.length < 200) {
            if (posibility < 0.01) {
                posibility = 0.01;
            }
        } else if (this.ballList.length < 400) {
            if (posibility < 0.005) {
                posibility = 0.005;
            }
        }
        return posibility;
    },

    checkHasBoost: function () {
        var posibility = this.getBoostPosibility();
        var hasBoost = game.utils.randomNextNumber(500) < 500 * posibility;
        if (!hasBoost) {
            if (this.tryGenerateBoostCount > (1.0 / posibility * (1 + this.ballList.length * 0.2))) {
                hasBoost = true;
            }
        }
        return hasBoost;
    },

    tryGenerateBoostCount: 0,

    generateBoost: function (pos) {
        var boostType;
        this.tryGenerateBoostCount++;
        var hasBomb = false;

        if (game.gameMan.isChallengeLevel && game.challengeMan.currentChallengeId === ChallengeId.Bomb) {
            hasBomb = game.utils.randomNextNumber(100) < (100 * this.BOMB_POSIBILITY / this.ballList.length);
            if (hasBomb) {
                boostType = BoostType.BOMB;
            }
        }

        if (hasBomb) {
            if (this.getDroppingBoostCount(boostType) >= 3) {
                hasBomb = false;
            }
        }

        var hasBoost = false;
        var hasSuperBoard = false;

        if (!hasBomb) {
            hasBoost = this.checkHasBoost();
            // if (!game.gameMan.isChallengeLevel) {
            //     if (GameMan.getInstance().levelId <= 3) {
            //         if (cc.isUndefined(this.generateBoostCount)) {
            //             this.generateBoostCount = 0;
            //         }
            //         if (this.generateBoostCount < 3) {
            //             hasBoost = true;
            //             this.generateBoostCount++;
            //         }
            //     }
            // }

            // protect gen boost.
            if (!hasBoost && (Date.now() - this.lastGetBoostTime > this.MUST_GEN_BOOST_TIME * 1000)) {
                if (!game.gameMan.isLessGridChallenge()) {
                    hasBoost = true;
                }
                cc.log("bricks-view must gen boost time");
            }

            if (hasBoost) {
                this.lastGetBoostTime = Date.now();
                boostType = this.getMinGenerateBoostType();
                this.boostTypeMap[boostType] = (this.boostTypeMap[boostType] || 0) + 1;
                if (this.getDroppingBoostCount(boostType) >= 5) {
                    hasBoost = false;
                }
            }

            if (!hasBoost) {
                if (game.gameMan.isSuperBoardUnlocked()) {
                    hasSuperBoard = game.utils.randomNextNumber(1000) < (1000 * this.SUPER_BOARD_POSIBILITY / this.ballList.length);
                    if (hasSuperBoard) {
                        var superBoardBoostCount = 0;
                        for (var i = 0; i < this.boosts.length; ++i) {
                            if (this.boosts[i].type === BoostType.SUPER_BOARD) {
                                superBoardBoostCount++;
                            }
                        }
                        if (superBoardBoostCount === 0 && this.ballList.length < 100 && this.superBoardNode.getChildren().length <= 0) {
                            boostType = BoostType.SUPER_BOARD;
                        } else {
                            hasSuperBoard = false;
                        }
                    }
                }
            }
        }

        if (hasBoost) {
            this.tryGenerateBoostCount = 0;
        }

        if (hasBomb || hasSuperBoard || hasBoost) {
            var boost = new Boost(boostType);
            boost.setPosition(pos);
            this.addChild(boost);
            this.boosts.push(boost);
            this.boosts.sort(function (a, b) {
                return (a.y - b.y);
            });
        }
    },

    getDroppingBoostCount: function (type) {
        var count = 0;
        for (var i = 0; i < this.boosts.length; ++i) {
            if (this.boosts[i].type === type) {
                count++;
            }
        }
        return count;
    },

    onRemoveBoost: function (boost) {
        var index = this.boosts.indexOf(boost);
        if (index > -1) {
            this.boosts.splice(index, 1);
            boost.removeFromParent();
        }
    },

    removeAllBoosts: function () {
        for (var i = 0; i < this.boosts.length; ++i) {
            var boost = this.boosts[i];
            if (boost) {
                boost.removeFromParent();
            }
        }
        this.boosts = [];
    },

    stop: function () {
        this.stoped = true;
        //this.showBannerAds();
        if (game.adsManager.showTopBanner) {
            game.adsManager.removeBannerAds("top");
        }
    },

    resume: function () {
        this.stoped = false;
        //game.adsManager.removeBannerAds("bottom");
        if (game.adsManager.showTopBanner) {
            game.adsManager.showBannerAds("top");
        }
    },

    showBannerAds: function () {
        //if (game.playerMan.getLevel() >= 3) {
        //    game.adsManager.showBannerAds("bottom");
        //}
    },

    showTopBannerAds: function () {
        if (game.gameMan.getMaxLevel() >= 3) {
            if (game.adsManager.showTopBanner) {
                //if 1 > 0
                if (game.playerMan.getRegisterDay() > game.adsManager.topBannerDay) {
                    game.adsManager.showBannerAds("top");
                }
            }
        }
    },

    removeTopBannerAds: function () {
        //if (game.adsManager.showTopBanner) {
        //    game.adsManager.removeBannerAds("top");
        //}
    },

    FLY_GIFT_MIN_X: 50,

    lastCheckTime: -3000,

    checkAndShowFlyGift: function () {
        return;
        if (this.showedFlyGift) {
            return;
        }
        if (this.eclipsedTime < 10 * 1000) {
            return;
        }
        if (game.gameMan.flyGiftAppearCount > game.adsManager.flyGiftCount) {
            return;
        }
        if (game.gameMan.getPlayerLevel() <= game.adsManager.flyGiftOpenLevel) {
            return;
        }

        if (this.eclipsedTime - this.lastCheckTime < 2000) {
            return;
        }
        this.lastCheckTime = this.eclipsedTime;

        if (!game.adsManager.isRewardVideoReady()) {
            return;
        }
        game.gameMan.flyGiftAppearCount++;
        this.showedFlyGift = true;
        this.startFlyGiftTime = this.eclipsedTime;
        this.gameController.ndFlyGift.visible = true;

        this.gameController.ndFlyGift.x = -10 - this.FLY_GIFT_MIN_X;
        this.gameController.ndFlyGift.y = game.utils.randomNextIntInRange(cc.winSize.height * 0.5, cc.winSize.height * 0.8);
        this.onFlyGiftEnd();
    },

    onFlyGiftEnd: function () {
        if (this.eclipsedTime - this.startFlyGiftTime > 15 * 1000) {
            // this.flyGiftEnded = true;
            // this.gameController.ndFlyGift.stopAllActions();
            // this.gameController.ndFlyGift.visible = false;
            var pos = this.gameController.ndFlyGift.getPosition();
            if (pos.x < cc.winSize.width * 0.5) {
                this.gameController.ndFlyGift.runAction(cc.sequence(
                    cc.moveTo(1, cc.p(-this.FLY_GIFT_MIN_X, pos.y)),
                    cc.hide()
                ));
            } else {
                this.gameController.ndFlyGift.runAction(cc.sequence(
                    cc.moveTo(1, cc.p(cc.winSize.width + this.FLY_GIFT_MIN_X, pos.y)),
                    cc.hide()
                ));
            }
            return;
        }

        var randomY;
        if (this.gameController.ndFlyGift.x < this.FLY_GIFT_MIN_X) {
            randomY = game.utils.randomNextIntInRange(cc.winSize.height * 0.5, cc.winSize.height * 0.8);
            this.gameController.ndFlyGift.runAction(
                cc.sequence(
                    cc.moveTo(5, cc.p(cc.winSize.width - this.FLY_GIFT_MIN_X + 10, randomY)),
                    cc.callFunc(this.onFlyGiftEnd, this)
                ));
        } else if (this.gameController.ndFlyGift.x > cc.winSize.width - this.FLY_GIFT_MIN_X) {
            randomY = game.utils.randomNextIntInRange(cc.winSize.height * 0.5, cc.winSize.height * 0.8);
            this.gameController.ndFlyGift.runAction(cc.sequence(
                cc.moveTo(5, cc.p(-10 + this.FLY_GIFT_MIN_X, randomY)),
                cc.callFunc(this.onFlyGiftEnd, this)
            ));
        }
    }
});

module.exports = BricksView;
},{"../../common/util/Utils":38,"../controller/BoardController":71,"../entity/Ball":142,"../entity/BallPool":143,"../entity/Board":144,"../entity/Boost":145,"../entity/Grid":147,"../entity/Key":148,"../entity/Obstacle":149,"../entity/Wall":151,"../enum/BoostType":154,"../enum/ChallengeId":155,"../enum/FailReason":157,"../enum/GridType":159,"../enum/ItemCategory":160,"../enum/ShapeType":164,"../events/EventsName":169,"../model/GameMan":173,"../model/StoreHelper":178}],187:[function(require,module,exports){


var RewardView = cc.Node.extend({

    configs: null,

    ctor: function (configs, offsetX, getNodeFunc) {
        this._super();
        this.configs = configs;
        // scale = scale || 1;

        var count = this.configs.length;
        for (var i = 0; i < this.configs.length; ++i) {
            var pos = cc.p(-0.5 * (count - i * 2 - 1) * offsetX, 0);
            this.createItem(this.configs[i], pos, getNodeFunc);
        }
    },

    createItem: function (config, pos, getNodeFunc) {
        // var node = RewardItemController.createFromCCB();
        var node = getNodeFunc();
        this.addChild(node);
        node.controller.initReward(config);
        node.setPosition(pos);
        // node.scale = scale;
    }

});

module.exports = RewardView;
},{}]},{},[40])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Vzci9sb2NhbC9saWIvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIi4uL25vZGVfbW9kdWxlcy90aW1lc3Bhbi9saWIvdGltZS1zcGFuLmpzIiwiY29tbW9uL2Fzc2V0cy9Bc3NldHNNYW5hZ2VyLmpzIiwiY29tbW9uL2Fzc2V0cy9Eb3dubG9hZGVyLmpzIiwiY29tbW9uL2F1ZGlvL0F1ZGlvUGxheWVyLmpzIiwiY29tbW9uL2JyaWRnZS9HYW1lQnJpZGdlLmpzIiwiY29tbW9uL2NvbnRyb2xsZXIvQmFzZUNDQkNvbnRyb2xsZXIuanMiLCJjb21tb24vY29udHJvbGxlci9Dcm9zc0Fkc0NvbnRyb2xsZXIuanMiLCJjb21tb24vY29udHJvbGxlci9Dcm9zc1Byb21Db250cm9sbGVyLmpzIiwiY29tbW9uL2VudGl0eS9OdW1iZXJBbmltYXRpb24uanMiLCJjb21tb24vZW50aXR5L1BheW1lbnRJbmZvLmpzIiwiY29tbW9uL2VudGl0eS9QbGF5ZXJJbmZvLmpzIiwiY29tbW9uL2VudGl0eS9Qcm9kdWN0SW5mby5qcyIsImNvbW1vbi9lbnVtL0Fkc1BsYWNlLmpzIiwiY29tbW9uL2VudW0vUGF5bWVudENvZGUuanMiLCJjb21tb24vZXZlbnRzL0V2ZW50RGlzcGF0Y2hlci5qcyIsImNvbW1vbi9leHQvTXVsdGlDb2xUYWJsZVZpZXcuanMiLCJjb21tb24vZXh0L1RvdWNoZWROb2RlLmpzIiwiY29tbW9uL21hbmFnZXIvQWRzTWFuYWdlci5qcyIsImNvbW1vbi9tYW5hZ2VyL0FuYWx5c2VNYW5hZ2VyLmpzIiwiY29tbW9uL21hbmFnZXIvQ2FwdHVyZU1hbmFnZXIuanMiLCJjb21tb24vbWFuYWdlci9Dcm9zc1Byb21NYW5hZ2VyLmpzIiwiY29tbW9uL21hbmFnZXIvR0NNYW5hZ2VyLmpzIiwiY29tbW9uL21hbmFnZXIvTG9jYWxpemF0aW9uTWFuYWdlci5qcyIsImNvbW1vbi9tYW5hZ2VyL05vdGlmaWNhdGlvbk1hbmFnZXIuanMiLCJjb21tb24vbWFuYWdlci9SYXRlTWFuYWdlci5qcyIsImNvbW1vbi9tYW5hZ2VyL1JlbW90ZUNvbmZpZ01hbmFnZXIuanMiLCJjb21tb24vbWFuYWdlci9TaGFyZU1hbmFnZXIuanMiLCJjb21tb24vbWFuYWdlci9TdG9yZU1hbmFnZXIuanMiLCJjb21tb24vbW9kZWwvRWZmZWN0TWFuLmpzIiwiY29tbW9uL21vZGVsL0xvZ2ljTWFuLmpzIiwiY29tbW9uL21vZGVsL1BsYXllck1hbi5qcyIsImNvbW1vbi9uZXQvSHR0cENsaWVudC5qcyIsImNvbW1vbi9wb3B1cC9EaWFsb2dNYW5hZ2VyLmpzIiwiY29tbW9uL3BvcHVwL01vZGFsTGF5ZXIuanMiLCJjb21tb24vc3RvcmFnZS9TdG9yYWdlQ29udHJvbGxlci5qcyIsImNvbW1vbi91dGlsL0F1ZGlvSGVscGVyLmpzIiwiY29tbW9uL3V0aWwvRmlsZUNhY2hlU3R1Yi5qcyIsImNvbW1vbi91dGlsL1V0aWxzLmpzIiwiY29tbW9uL3doZWVsL1doZWVsLmpzIiwiZWRpdG9yTG9hZGVyLmpzIiwibWFueV9icmlja3MvY29uZmlnL0FjdGl2aXR5VGFza0NvbmZpZy5qcyIsIm1hbnlfYnJpY2tzL2NvbmZpZy9BY3Rpdml0eVRhc2tSZXdhcmRDb25maWcuanMiLCJtYW55X2JyaWNrcy9jb25maWcvQm9hcmRDb25maWcuanMiLCJtYW55X2JyaWNrcy9jb25maWcvQm94Q29uZmlnLmpzIiwibWFueV9icmlja3MvY29uZmlnL0JveFJld2FyZENvbmZpZy5qcyIsIm1hbnlfYnJpY2tzL2NvbmZpZy9Ccmlja0NvbmZpZy5qcyIsIm1hbnlfYnJpY2tzL2NvbmZpZy9DYXJkQ29uZmlnLmpzIiwibWFueV9icmlja3MvY29uZmlnL0NoYWxsZW5nZUNvbmZpZy5qcyIsIm1hbnlfYnJpY2tzL2NvbmZpZy9DaGFsbGVuZ2VJbmZvQ29uZmlnLmpzIiwibWFueV9icmlja3MvY29uZmlnL0NoYWxsZW5nZVJld2FyZENvbmZpZy5qcyIsIm1hbnlfYnJpY2tzL2NvbmZpZy9Db25maWcuanMiLCJtYW55X2JyaWNrcy9jb25maWcvQ29uZmlnTWFuLmpzIiwibWFueV9icmlja3MvY29uZmlnL0RhaWx5Qm9udXNDb25maWcuanMiLCJtYW55X2JyaWNrcy9jb25maWcvTGV2ZWxDb25maWcuanMiLCJtYW55X2JyaWNrcy9jb25maWcvUmV3YXJkQ29uZmlnLmpzIiwibWFueV9icmlja3MvY29uZmlnL1NoYXJlQ29uZmlnLmpzIiwibWFueV9icmlja3MvY29uZmlnL1NraW5Db25maWcuanMiLCJtYW55X2JyaWNrcy9jb25maWcvU3RvcmVDb25maWcuanMiLCJtYW55X2JyaWNrcy9jb25maWcvVGFza0NvbmZpZy5qcyIsIm1hbnlfYnJpY2tzL2NvbmZpZy9UYXNrT2xkQ29uZmlnLmpzIiwibWFueV9icmlja3MvY29uZmlnL1doZWVsQ29uZmlnLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9BY3Rpdml0eVRhc2tDb250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9BY3Rpdml0eVRhc2tFbnRyYW5jZUNvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL0FjdGl2aXR5VGFza0l0ZW1Db250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9BY3Rpdml0eVRhc2tSZXdhcmRJdGVtQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvQWN0aXZpdHlUYXNrVGlwc0NvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL0Fkc1JlbWluZGVyQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvQWltSGVscENvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL0FpbUl0ZW1Db250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9CYWdDb250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9Cb2FyZENvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL0JvYXJkR2V0Q29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvQm9hcmRJdGVtQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvQm94Q29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvQm94SXRlbUNvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL0NhcmRDb250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9DYXJkSXRlbUNvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL0NoYWxsZW5nZUNvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL0NoYWxsZW5nZUl0ZW1Db250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9DaGFsbGVuZ2VMZXZlbENvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL0NoYWxsZW5nZUxpc3RDb250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9DaGFsbGVuZ2VQYXJlbnRDb250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9DaGFsbGVuZ2VSZWxpdmVDb250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9EYWlseUJvbnVzQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvRGFpbHlCb251c0l0ZW1Db250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9EYWlseVRhc2tFbnRyYW5jZUNvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL0RpYW1vbmRzQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvRmFpbENuQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvRmFpbENvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL0dhbWVDb250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9HYW1lT3ZlckNvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL0dhbWVXaW5Db250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9HaWZ0Qm94Q29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvSGVscENvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL0xhc2VyQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvTGV2ZWxDb250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9MZXZlbEl0ZW1Db250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9Mb2FkaW5nQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvTHVja3lTcGluQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvTWVudUNvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL05vdGljZUNvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL1BhY2thZ2VDb250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9QYWNrYWdlSXRlbUNvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL1Bhc3NDbkNvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL1Bhc3NDb250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9QYXVzZUNuQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvUGF1c2VDb250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9SYW5rQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvUmVtb3ZlQWRzQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvUmV3YXJkRG91YmxlQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvUmV3YXJkR2V0Q29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvUmV3YXJkR2lmdENvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL1Jld2FyZEl0ZW1Db250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9SZXdhcmROb3RpY2VDb250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9SZXdhcmRQb3B1cENvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL1Jld2FyZFJlbW92ZUFkQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvUmV3YXJkUmVtb3ZlQWRzQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvUmV3YXJkVmlkZW9Db250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9TZXR0aW5nQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvU2tpbkNvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL1NraW5JdGVtQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvU2tpbkl0ZW1UaXRsZUNvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL1NraW5VbmxvY2tDb250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9TcGVjaWFsT2ZmZXJDb250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9TdG9yZUNvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL1N0b3JlSXRlbUNvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL1N1cGVyQm9hcmRDb250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9UYXNrQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvVGFza0l0ZW1Db250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9UaXRsZUNvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL1dhdGNoQWRzR2V0M1N0YXJDb250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9XYXRjaEFkc0dldERpYW1vbmRzQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvV2F0Y2hBZHNHZXRJdGVtQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvV2F0Y2hBZHNHZXRTa2luQ29udHJvbGxlci5qcyIsIm1hbnlfYnJpY2tzL2NvbnRyb2xsZXIvV2F0Y2hBZHNSZWxpZmVDb250cm9sbGVyLmpzIiwibWFueV9icmlja3MvY29udHJvbGxlci9XaGVlbENvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9jb250cm9sbGVyL1doZWVsSXRlbUNvbnRyb2xsZXIuanMiLCJtYW55X2JyaWNrcy9lZGl0b3IvZW50aXR5L0dyaWQuanMiLCJtYW55X2JyaWNrcy9lZGl0b3IvaGVscGVyL0VkaXRvckhlbHBlci5qcyIsIm1hbnlfYnJpY2tzL2VkaXRvci9zY2VuZS9FZGl0b3JTY2VuZS5qcyIsIm1hbnlfYnJpY2tzL2VkaXRvci9zY2VuZS9HYW1lU2NlbmUuanMiLCJtYW55X2JyaWNrcy9lbnRpdHkvQmFsbC5qcyIsIm1hbnlfYnJpY2tzL2VudGl0eS9CYWxsUG9vbC5qcyIsIm1hbnlfYnJpY2tzL2VudGl0eS9Cb2FyZC5qcyIsIm1hbnlfYnJpY2tzL2VudGl0eS9Cb29zdC5qcyIsIm1hbnlfYnJpY2tzL2VudGl0eS9DaGFsbGVuZ2VEYXRhLmpzIiwibWFueV9icmlja3MvZW50aXR5L0dyaWQuanMiLCJtYW55X2JyaWNrcy9lbnRpdHkvS2V5LmpzIiwibWFueV9icmlja3MvZW50aXR5L09ic3RhY2xlLmpzIiwibWFueV9icmlja3MvZW50aXR5L1BsYXllckluZm8uanMiLCJtYW55X2JyaWNrcy9lbnRpdHkvV2FsbC5qcyIsIm1hbnlfYnJpY2tzL2VudW0vQUJUZXN0VHlwZS5qcyIsIm1hbnlfYnJpY2tzL2VudW0vQWN0aXZpdHlUYXNrVHlwZS5qcyIsIm1hbnlfYnJpY2tzL2VudW0vQm9vc3RUeXBlLmpzIiwibWFueV9icmlja3MvZW51bS9DaGFsbGVuZ2VJZC5qcyIsIm1hbnlfYnJpY2tzL2VudW0vRGFpbHlUYXNrUG9zLmpzIiwibWFueV9icmlja3MvZW51bS9GYWlsUmVhc29uLmpzIiwibWFueV9icmlja3MvZW51bS9HYW1lTW9kZS5qcyIsIm1hbnlfYnJpY2tzL2VudW0vR3JpZFR5cGUuanMiLCJtYW55X2JyaWNrcy9lbnVtL0l0ZW1DYXRlZ29yeS5qcyIsIm1hbnlfYnJpY2tzL2VudW0vTG9ja1N0YXR1cy5qcyIsIm1hbnlfYnJpY2tzL2VudW0vUmFua1R5cGUuanMiLCJtYW55X2JyaWNrcy9lbnVtL1NjZW5lVHlwZS5qcyIsIm1hbnlfYnJpY2tzL2VudW0vU2hhcGVUeXBlLmpzIiwibWFueV9icmlja3MvZW51bS9Ta2luUmV3YXJkVHlwZS5qcyIsIm1hbnlfYnJpY2tzL2VudW0vU2tpblR5cGUuanMiLCJtYW55X2JyaWNrcy9lbnVtL1N0b3JlVHlwZS5qcyIsIm1hbnlfYnJpY2tzL2VudW0vV2hlZWxUeXBlLmpzIiwibWFueV9icmlja3MvZXZlbnRzL0V2ZW50c05hbWUuanMiLCJtYW55X2JyaWNrcy9tb2RlbC9BY3Rpdml0eU1hbi5qcyIsIm1hbnlfYnJpY2tzL21vZGVsL0Fkc0hlbHBlci5qcyIsIm1hbnlfYnJpY2tzL21vZGVsL0NoYWxsZW5nZU1hbi5qcyIsIm1hbnlfYnJpY2tzL21vZGVsL0dhbWVNYW4uanMiLCJtYW55X2JyaWNrcy9tb2RlbC9QbGF5ZXJNYW4uanMiLCJtYW55X2JyaWNrcy9tb2RlbC9Qb3B1cE1hbi5qcyIsIm1hbnlfYnJpY2tzL21vZGVsL1Jlc291cmNlc01hbi5qcyIsIm1hbnlfYnJpY2tzL21vZGVsL1NjZW5lTWFuLmpzIiwibWFueV9icmlja3MvbW9kZWwvU3RvcmVIZWxwZXIuanMiLCJtYW55X2JyaWNrcy9zY2VuZS9DaGFsbGVuZ2VMaXN0U2NlbmUuanMiLCJtYW55X2JyaWNrcy9zY2VuZS9DaGFsbGVuZ2VTY2VuZS5qcyIsIm1hbnlfYnJpY2tzL3NjZW5lL0dhbWVTY2VuZS5qcyIsIm1hbnlfYnJpY2tzL3NjZW5lL0xldmVsU2NlbmUuanMiLCJtYW55X2JyaWNrcy9zY2VuZS9Mb2FkaW5nU2NlbmUuanMiLCJtYW55X2JyaWNrcy9zY2VuZS9NZW51U2NlbmUuanMiLCJtYW55X2JyaWNrcy9zY2VuZS9QYWNrYWdlU2NlbmUuanMiLCJtYW55X2JyaWNrcy92aWV3L0JyaWNrc1ZpZXcuanMiLCJtYW55X2JyaWNrcy92aWV3L1Jld2FyZFZpZXcuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1ekJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hkQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN2VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0SUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4TkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25DQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyd0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9NQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOWJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeE1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25IQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3TUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL05BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakxBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzloQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdjQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNUxBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN1dBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1WEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcEhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbFlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25GQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqOEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNiQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDVkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3TkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3Z5Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNobEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsVkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9FQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0d0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNiQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyNERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsIi8qXG4qIEphdmFTY3JpcHQgVGltZVNwYW4gTGlicmFyeVxuKlxuKiBDb3B5cmlnaHQgKGMpIDIwMTAgTWljaGFlbCBTdHVtLCBDaGFybGllIFJvYmJpbnNcbiogXG4qIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZ1xuKiBhIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGVcbiogXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nXG4qIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCxcbiogZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvXG4qIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0b1xuKiB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4qIFxuKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZVxuKiBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cbiogXG4qIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsXG4qIEVYUFJFU1MgT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRlxuKiBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORFxuKiBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFXG4qIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT05cbiogT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OXG4qIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLlxuKi9cblxuLy9cbi8vICMjIyBUaW1lIGNvbnN0YW50c1xuLy9cbnZhciBtc2VjUGVyU2Vjb25kID0gMTAwMCxcbiAgICBtc2VjUGVyTWludXRlID0gNjAwMDAsXG4gICAgbXNlY1BlckhvdXIgPSAzNjAwMDAwLFxuICAgIG1zZWNQZXJEYXkgPSA4NjQwMDAwMDtcblxuLy9cbi8vICMjIyBUaW1lc3BhbiBQYXJzZXJzXG4vL1xudmFyIHRpbWVTcGFuV2l0aERheXMgPSAvXihcXGQrKTooXFxkKyk6KFxcZCspOihcXGQrKShcXC5cXGQrKT8vLFxuICAgIHRpbWVTcGFuTm9EYXlzID0gL14oXFxkKyk6KFxcZCspOihcXGQrKShcXC5cXGQrKT8vO1xuXG4vL1xuLy8gIyMjIGZ1bmN0aW9uIFRpbWVTcGFuIChtaWxsaXNlY29uZHMsIHNlY29uZHMsIG1pbnV0ZXMsIGhvdXJzLCBkYXlzKVxuLy8gIyMjIyBAbWlsbGlzZWNvbmRzIHtOdW1iZXJ9IE51bWJlciBvZiBtaWxsaXNlY29uZHMgZm9yIHRoaXMgaW5zdGFuY2UuXG4vLyAjIyMjIEBzZWNvbmRzIHtOdW1iZXJ9IE51bWJlciBvZiBzZWNvbmRzIGZvciB0aGlzIGluc3RhbmNlLlxuLy8gIyMjIyBAbWludXRlcyB7TnVtYmVyfSBOdW1iZXIgb2YgbWludXRlcyBmb3IgdGhpcyBpbnN0YW5jZS5cbi8vICMjIyMgQGhvdXJzIHtOdW1iZXJ9IE51bWJlciBvZiBob3VycyBmb3IgdGhpcyBpbnN0YW5jZS5cbi8vICMjIyMgQGRheXMge051bWJlcn0gTnVtYmVyIG9mIGRheXMgZm9yIHRoaXMgaW5zdGFuY2UuXG4vLyBDb25zdHJ1Y3RvciBmdW5jdGlvbiBmb3IgdGhlIGBUaW1lU3BhbmAgb2JqZWN0IHdoaWNoIHJlcHJlc2VudHMgYSBsZW5ndGhcbi8vIG9mIHBvc2l0aXZlIG9yIG5lZ2F0aXZlIG1pbGxpc2Vjb25kcyBjb21wb25lbnRpemVkIGludG8gbWlsbGlzZWNvbmRzLCBcbi8vIHNlY29uZHMsIGhvdXJzLCBhbmQgZGF5cy5cbi8vXG52YXIgVGltZVNwYW4gPSBleHBvcnRzLlRpbWVTcGFuID0gZnVuY3Rpb24gKG1pbGxpc2Vjb25kcywgc2Vjb25kcywgbWludXRlcywgaG91cnMsIGRheXMpIHtcbiAgdGhpcy5tc2VjcyA9IDA7XG4gIFxuICBpZiAoaXNOdW1lcmljKGRheXMpKSB7XG4gICAgdGhpcy5tc2VjcyArPSAoZGF5cyAqIG1zZWNQZXJEYXkpO1xuICB9XG4gIFxuICBpZiAoaXNOdW1lcmljKGhvdXJzKSkge1xuICAgIHRoaXMubXNlY3MgKz0gKGhvdXJzICogbXNlY1BlckhvdXIpO1xuICB9XG4gIFxuICBpZiAoaXNOdW1lcmljKG1pbnV0ZXMpKSB7XG4gICAgdGhpcy5tc2VjcyArPSAobWludXRlcyAqIG1zZWNQZXJNaW51dGUpO1xuICB9XG4gIFxuICBpZiAoaXNOdW1lcmljKHNlY29uZHMpKSB7XG4gICAgdGhpcy5tc2VjcyArPSAoc2Vjb25kcyAqIG1zZWNQZXJTZWNvbmQpO1xuICB9XG4gIFxuICBpZiAoaXNOdW1lcmljKG1pbGxpc2Vjb25kcykpIHtcbiAgICB0aGlzLm1zZWNzICs9IG1pbGxpc2Vjb25kcztcbiAgfVxufTtcblxuLy9cbi8vICMjIEZhY3RvcnkgbWV0aG9kc1xuLy8gSGVscGVyIG1ldGhvZHMgZm9yIGNyZWF0aW5nIG5ldyBUaW1lU3BhbiBvYmplY3RzXG4vLyBmcm9tIHZhcmlvdXMgY3JpdGVyaWE6IG1pbGxpc2Vjb25kcywgc2Vjb25kcywgbWludXRlcyxcbi8vIGhvdXJzLCBkYXlzLCBzdHJpbmdzIGFuZCBvdGhlciBgVGltZVNwYW5gIGluc3RhbmNlcy5cbi8vXG5cbi8vXG4vLyAjIyMgZnVuY3Rpb24gZnJvbU1pbGxpc2Vjb25kcyAobWlsbGlzZWNvbmRzKVxuLy8gIyMjIyBAbWlsbGlzZWNvbmRzIHtOdW1iZXJ9IEFtb3VudCBvZiBtaWxsaXNlY29uZHMgZm9yIHRoZSBuZXcgVGltZVNwYW4gaW5zdGFuY2UuXG4vLyBDcmVhdGVzIGEgbmV3IGBUaW1lU3BhbmAgaW5zdGFuY2Ugd2l0aCB0aGUgc3BlY2lmaWVkIGBtaWxsaXNlY29uZHNgLlxuLy9cbmV4cG9ydHMuZnJvbU1pbGxpc2Vjb25kcyA9IGZ1bmN0aW9uIChtaWxsaXNlY29uZHMpIHtcbiAgaWYgKCFpc051bWVyaWMobWlsbGlzZWNvbmRzKSkgeyByZXR1cm4gfVxuICByZXR1cm4gbmV3IFRpbWVTcGFuKG1pbGxpc2Vjb25kcywgMCwgMCwgMCwgMCk7XG59XG5cbi8vXG4vLyAjIyMgZnVuY3Rpb24gZnJvbVNlY29uZHMgKHNlY29uZHMpXG4vLyAjIyMjIEBtaWxsaXNlY29uZHMge051bWJlcn0gQW1vdW50IG9mIHNlY29uZHMgZm9yIHRoZSBuZXcgVGltZVNwYW4gaW5zdGFuY2UuXG4vLyBDcmVhdGVzIGEgbmV3IGBUaW1lU3BhbmAgaW5zdGFuY2Ugd2l0aCB0aGUgc3BlY2lmaWVkIGBzZWNvbmRzYC5cbi8vXG5leHBvcnRzLmZyb21TZWNvbmRzID0gZnVuY3Rpb24gKHNlY29uZHMpIHtcbiAgaWYgKCFpc051bWVyaWMoc2Vjb25kcykpIHsgcmV0dXJuIH1cbiAgcmV0dXJuIG5ldyBUaW1lU3BhbigwLCBzZWNvbmRzLCAwLCAwLCAwKTtcbn07XG5cbi8vXG4vLyAjIyMgZnVuY3Rpb24gZnJvbU1pbnV0ZXMgKG1pbGxpc2Vjb25kcylcbi8vICMjIyMgQG1pbGxpc2Vjb25kcyB7TnVtYmVyfSBBbW91bnQgb2YgbWludXRlcyBmb3IgdGhlIG5ldyBUaW1lU3BhbiBpbnN0YW5jZS5cbi8vIENyZWF0ZXMgYSBuZXcgYFRpbWVTcGFuYCBpbnN0YW5jZSB3aXRoIHRoZSBzcGVjaWZpZWQgYG1pbnV0ZXNgLlxuLy9cbmV4cG9ydHMuZnJvbU1pbnV0ZXMgPSBmdW5jdGlvbiAobWludXRlcykge1xuICBpZiAoIWlzTnVtZXJpYyhtaW51dGVzKSkgeyByZXR1cm4gfVxuICByZXR1cm4gbmV3IFRpbWVTcGFuKDAsIDAsIG1pbnV0ZXMsIDAsIDApO1xufTtcblxuLy9cbi8vICMjIyBmdW5jdGlvbiBmcm9tSG91cnMgKGhvdXJzKVxuLy8gIyMjIyBAbWlsbGlzZWNvbmRzIHtOdW1iZXJ9IEFtb3VudCBvZiBob3VycyBmb3IgdGhlIG5ldyBUaW1lU3BhbiBpbnN0YW5jZS5cbi8vIENyZWF0ZXMgYSBuZXcgYFRpbWVTcGFuYCBpbnN0YW5jZSB3aXRoIHRoZSBzcGVjaWZpZWQgYGhvdXJzYC5cbi8vXG5leHBvcnRzLmZyb21Ib3VycyA9IGZ1bmN0aW9uIChob3Vycykge1xuICBpZiAoIWlzTnVtZXJpYyhob3VycykpIHsgcmV0dXJuIH1cbiAgcmV0dXJuIG5ldyBUaW1lU3BhbigwLCAwLCAwLCBob3VycywgMCk7XG59O1xuXG4vL1xuLy8gIyMjIGZ1bmN0aW9uIGZyb21EYXlzIChkYXlzKVxuLy8gIyMjIyBAbWlsbGlzZWNvbmRzIHtOdW1iZXJ9IEFtb3VudCBvZiBkYXlzIGZvciB0aGUgbmV3IFRpbWVTcGFuIGluc3RhbmNlLlxuLy8gQ3JlYXRlcyBhIG5ldyBgVGltZVNwYW5gIGluc3RhbmNlIHdpdGggdGhlIHNwZWNpZmllZCBgZGF5c2AuXG4vL1xuZXhwb3J0cy5mcm9tRGF5cyA9IGZ1bmN0aW9uIChkYXlzKSB7XG4gIGlmICghaXNOdW1lcmljKGRheXMpKSB7IHJldHVybiB9XG4gIHJldHVybiBuZXcgVGltZVNwYW4oMCwgMCwgMCwgMCwgZGF5cyk7XG59O1xuXG4vL1xuLy8gIyMjIGZ1bmN0aW9uIHBhcnNlIChzdHIpXG4vLyAjIyMjIEBzdHIge3N0cmluZ30gVGltZXNwYW4gc3RyaW5nIHRvIHBhcnNlLlxuLy8gQ3JlYXRlcyBhIG5ldyBgVGltZVNwYW5gIGluc3RhbmNlIGZyb20gdGhlIHNwZWNpZmllZFxuLy8gc3RyaW5nLCBgc3RyYC5cbi8vXG5leHBvcnRzLnBhcnNlID0gZnVuY3Rpb24gKHN0cikge1xuICB2YXIgbWF0Y2gsIG1pbGxpc2Vjb25kcztcbiAgXG4gIGZ1bmN0aW9uIHBhcnNlTWlsbGlzZWNvbmRzICh2YWx1ZSkge1xuICAgIHJldHVybiB2YWx1ZSA/IHBhcnNlRmxvYXQoJzAnICsgdmFsdWUpICogMTAwMCA6IDA7XG4gIH1cbiAgXG4gIC8vIElmIHdlIG1hdGNoIGFnYWluc3QgYSBmdWxsIFRpbWVTcGFuOiBcbiAgLy8gICBbZGF5c106W2hvdXJzXTpbbWludXRlc106W3NlY29uZHNdLlttaWxsaXNlY29uZHNdP1xuICBpZiAoKG1hdGNoID0gc3RyLm1hdGNoKHRpbWVTcGFuV2l0aERheXMpKSkge1xuICAgIHJldHVybiBuZXcgVGltZVNwYW4ocGFyc2VNaWxsaXNlY29uZHMobWF0Y2hbNV0pLCBtYXRjaFs0XSwgbWF0Y2hbM10sIG1hdGNoWzJdLCBtYXRjaFsxXSk7XG4gIH1cbiAgXG4gIC8vIElmIHdlIG1hdGNoIGFnYWluc3QgYSBwYXJ0aWFsIFRpbWVTcGFuOlxuICAvLyAgIFtob3Vyc106W21pbnV0ZXNdOltzZWNvbmRzXS5bbWlsbGlzZWNvbmRzXT9cbiAgaWYgKChtYXRjaCA9IHN0ci5tYXRjaCh0aW1lU3Bhbk5vRGF5cykpKSB7XG4gICAgcmV0dXJuIG5ldyBUaW1lU3BhbihwYXJzZU1pbGxpc2Vjb25kcyhtYXRjaFs0XSksIG1hdGNoWzNdLCBtYXRjaFsyXSwgbWF0Y2hbMV0sIDApO1xuICB9XG4gIFxuICByZXR1cm4gbnVsbDtcbn07XG5cbi8vXG4vLyBMaXN0IG9mIGRlZmF1bHQgc2luZ3VsYXIgdGltZSBtb2RpZmllcnMgYW5kIGFzc29jaWF0ZWRcbi8vIGNvbXB1dGF0aW9uIGFsZ29yaXRtLiBBc3N1bWVzIGluIG9yZGVyLCBzbWFsbGVzdCB0byBncmVhdGVzdFxuLy8gcGVyZm9ybWluZyBjYXJyeSBmb3J3YXJkIGFkZGl0aW9uYSAvIHN1YnRyYWN0aW9uIGZvciBlYWNoXG4vLyBEYXRlLVRpbWUgY29tcG9uZW50LlxuLy9cbnZhciBwYXJzZXJzID0ge1xuICAnbWlsbGlzZWNvbmRzJzoge1xuICAgIGV4cDogLyhcXGQrKW1pbGxpKD86c2Vjb25kKT9bc10/L2ksXG4gICAgY29tcHV0ZTogZnVuY3Rpb24gKGRlbHRhLCBjb21wdXRlZCkge1xuICAgICAgcmV0dXJuIF9jb21wdXRlKGRlbHRhLCBjb21wdXRlZCwge1xuICAgICAgICBjdXJyZW50OiAnbWlsbGlzZWNvbmRzJyxcbiAgICAgICAgbmV4dDogJ3NlY29uZHMnLCBcbiAgICAgICAgbWF4OiAxMDAwXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG4gICdzZWNvbmRzJzoge1xuICAgIGV4cDogLyhcXGQrKXNlY29uZFtzXT8vaSxcbiAgICBjb21wdXRlOiBmdW5jdGlvbiAoZGVsdGEsIGNvbXB1dGVkKSB7XG4gICAgICByZXR1cm4gX2NvbXB1dGUoZGVsdGEsIGNvbXB1dGVkLCB7XG4gICAgICAgIGN1cnJlbnQ6ICdzZWNvbmRzJyxcbiAgICAgICAgbmV4dDogJ21pbnV0ZXMnLCBcbiAgICAgICAgbWF4OiA2MFxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuICAnbWludXRlcyc6IHtcbiAgICBleHA6IC8oXFxkKyltaW51dGVbc10/L2ksXG4gICAgY29tcHV0ZTogZnVuY3Rpb24gKGRlbHRhLCBjb21wdXRlZCkge1xuICAgICAgcmV0dXJuIF9jb21wdXRlKGRlbHRhLCBjb21wdXRlZCwge1xuICAgICAgICBjdXJyZW50OiAnbWludXRlcycsXG4gICAgICAgIG5leHQ6ICdob3VycycsIFxuICAgICAgICBtYXg6IDYwXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG4gICdob3Vycyc6IHtcbiAgICBleHA6IC8oXFxkKylob3VyW3NdPy9pLFxuICAgIGNvbXB1dGU6IGZ1bmN0aW9uIChkZWx0YSwgY29tcHV0ZWQpIHtcbiAgICAgIHJldHVybiBfY29tcHV0ZShkZWx0YSwgY29tcHV0ZWQsIHtcbiAgICAgICAgY3VycmVudDogJ2hvdXJzJyxcbiAgICAgICAgbmV4dDogJ2RheXMnLCBcbiAgICAgICAgbWF4OiAyNFxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuICAnZGF5cyc6IHtcbiAgICBleHA6IC8oXFxkKylkYXlbc10/L2ksXG4gICAgY29tcHV0ZTogZnVuY3Rpb24gKGRlbHRhLCBjb21wdXRlZCkge1xuICAgICAgdmFyIGRheXMgICAgID0gbW9udGhEYXlzKGNvbXB1dGVkLm1vbnRocywgY29tcHV0ZWQueWVhcnMpLFxuICAgICAgICAgIHNpZ24gICAgID0gZGVsdGEgPj0gMCA/IDEgOiAtMSxcbiAgICAgICAgICBvcHNpZ24gICA9IGRlbHRhID49IDAgPyAtMSA6IDEsXG4gICAgICAgICAgY2xlYW4gICAgPSAwO1xuICAgICAgXG4gICAgICBmdW5jdGlvbiB1cGRhdGUgKG1vbnRocykge1xuICAgICAgICBpZiAobW9udGhzIDwgMCkgeyBcbiAgICAgICAgICBjb21wdXRlZC55ZWFycyAtPSAxO1xuICAgICAgICAgIHJldHVybiAxMTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChtb250aHMgPiAxMSkgeyBcbiAgICAgICAgICBjb21wdXRlZC55ZWFycyArPSAxO1xuICAgICAgICAgIHJldHVybiAwIFxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gbW9udGhzO1xuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAoZGVsdGEpIHsgICAgICAgICAgXG4gICAgICAgIHdoaWxlIChNYXRoLmFicyhkZWx0YSkgPj0gZGF5cykge1xuICAgICAgICAgIGNvbXB1dGVkLm1vbnRocyArPSBzaWduICogMTtcbiAgICAgICAgICBjb21wdXRlZC5tb250aHMgPSB1cGRhdGUoY29tcHV0ZWQubW9udGhzKTtcbiAgICAgICAgICBkZWx0YSArPSBvcHNpZ24gKiBkYXlzO1xuICAgICAgICAgIGRheXMgPSBtb250aERheXMoY29tcHV0ZWQubW9udGhzLCBjb21wdXRlZC55ZWFycyk7XG4gICAgICAgIH1cbiAgICAgIFxuICAgICAgICBjb21wdXRlZC5kYXlzICs9IChvcHNpZ24gKiBkZWx0YSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmIChjb21wdXRlZC5kYXlzIDwgMCkgeyBjbGVhbiA9IC0xIH1cbiAgICAgIGVsc2UgaWYgKGNvbXB1dGVkLmRheXMgPiBtb250aHNbY29tcHV0ZWQubW9udGhzXSkgeyBjbGVhbiA9IDEgfVxuICAgICAgXG4gICAgICBpZiAoY2xlYW4gPT09IC0xIHx8IGNsZWFuID09PSAxKSB7XG4gICAgICAgIGNvbXB1dGVkLm1vbnRocyArPSBjbGVhbjtcbiAgICAgICAgY29tcHV0ZWQubW9udGhzID0gdXBkYXRlKGNvbXB1dGVkLm1vbnRocyk7XG4gICAgICAgIGNvbXB1dGVkLmRheXMgPSBtb250aHNbY29tcHV0ZWQubW9udGhzXSArIGNvbXB1dGVkLmRheXM7XG4gICAgICB9XG4gICAgICAgICAgICBcbiAgICAgIHJldHVybiBjb21wdXRlZDtcbiAgICB9XG4gIH0sXG4gICdtb250aHMnOiB7XG4gICAgZXhwOiAvKFxcZCspbW9udGhbc10/L2ksXG4gICAgY29tcHV0ZTogZnVuY3Rpb24gKGRlbHRhLCBjb21wdXRlZCkge1xuICAgICAgdmFyIHJvdW5kID0gZGVsdGEgPiAwID8gTWF0aC5mbG9vciA6IE1hdGguY2VpbDtcbiAgICAgIGlmIChkZWx0YSkgeyBcbiAgICAgICAgY29tcHV0ZWQueWVhcnMgKz0gcm91bmQuY2FsbChudWxsLCBkZWx0YSAvIDEyKTtcbiAgICAgICAgY29tcHV0ZWQubW9udGhzICs9IGRlbHRhICUgMTI7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmIChjb21wdXRlZC5tb250aHMgPiAxMSkge1xuICAgICAgICBjb21wdXRlZC55ZWFycyArPSBNYXRoLmZsb29yKChjb21wdXRlZC5tb250aHMgKyAxKSAvIDEyKTtcbiAgICAgICAgY29tcHV0ZWQubW9udGhzID0gKChjb21wdXRlZC5tb250aHMgKyAxKSAlIDEyKSAtIDE7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiBjb21wdXRlZDtcbiAgICB9XG4gIH0sXG4gICd5ZWFycyc6IHtcbiAgICBleHA6IC8oXFxkKyl5ZWFyW3NdPy9pLFxuICAgIGNvbXB1dGU6IGZ1bmN0aW9uIChkZWx0YSwgY29tcHV0ZWQpIHtcbiAgICAgIGlmIChkZWx0YSkgeyBjb21wdXRlZC55ZWFycyArPSBkZWx0YTsgfVxuICAgICAgcmV0dXJuIGNvbXB1dGVkO1xuICAgIH1cbiAgfVxufTtcblxuLy9cbi8vIENvbXB1dGUgdGhlIGxpc3Qgb2YgcGFyc2VyIG5hbWVzIGZvclxuLy8gbGF0ZXIgdXNlLlxuLy9cbnZhciBwYXJzZXJOYW1lcyA9IE9iamVjdC5rZXlzKHBhcnNlcnMpO1xuXG4vL1xuLy8gIyMjIGZ1bmN0aW9uIHBhcnNlRGF0ZSAoc3RyKVxuLy8gIyMjIyBAc3RyIHtzdHJpbmd9IFN0cmluZyB0byBwYXJzZSBpbnRvIGEgZGF0ZVxuLy8gUGFyc2VzIHRoZSBzcGVjaWZpZWQgbGliZXJhbCBEYXRlLVRpbWUgc3RyaW5nIGFjY29yZGluZyB0b1xuLy8gSVNPODYwMSAqKmFuZCoqOlxuLy9cbi8vIDEuIGAyMDEwLTA0LTAzVDEyOjM0OjE1WisxMk1JTlVURVNgXG4vLyAyLiBgTk9XLTRIT1VSU2Bcbi8vXG4vLyBWYWxpZCBtb2RpZmllcnMgZm9yIHRoZSBtb3JlIGxpYmVyYWwgRGF0ZS1UaW1lIHN0cmluZyhzKTpcbi8vXG4vLyAgICAgWUVBUiwgWUVBUlNcbi8vICAgICBNT05USCwgTU9OVEhTXG4vLyAgICAgREFZLCBEQVlTXG4vLyAgICAgSE9VUiwgSE9VUlNcbi8vICAgICBNSU5VVEUsIE1JTlVURVNcbi8vICAgICBTRUNPTkQsIFNFQ09ORFNcbi8vICAgICBNSUxMSSwgTUlMTElTLCBNSUxMSVNFQ09ORCwgTUlMTElTRUNPTkRTXG4vL1xuZXhwb3J0cy5wYXJzZURhdGUgPSBmdW5jdGlvbiAoc3RyKSB7XG4gIHZhciBkYXRlVGltZSA9IERhdGUucGFyc2Uoc3RyKSxcbiAgICAgIGlzbyA9ICdeKFteWl0rKScsXG4gICAgICB6dWx1ID0gJ1ooW1xcXFwrfFxcXFwtXSk/JyxcbiAgICAgIGRpZmYgPSB7fSxcbiAgICAgIGNvbXB1dGVkLFxuICAgICAgbW9kaWZpZXJzLFxuICAgICAgc2lnbjtcblxuICAvL1xuICAvLyBJZiBEYXRlIHN0cmluZyBzdXBwbGllZCBhY3R1YWxseSBjb25mb3JtcyBcbiAgLy8gdG8gVVRDIFRpbWUgKElTTzg2MDEpLCByZXR1cm4gYSBuZXcgRGF0ZS5cbiAgLy9cbiAgaWYgKCFpc05hTihkYXRlVGltZSkpIHtcbiAgICByZXR1cm4gbmV3IERhdGUoZGF0ZVRpbWUpO1xuICB9XG4gIFxuICAvL1xuICAvLyBDcmVhdGUgdGhlIGBSZWdFeHBgIGZvciB0aGUgZW5kIGNvbXBvbmVudFxuICAvLyBvZiB0aGUgdGFyZ2V0IGBzdHJgIHRvIHBhcnNlLlxuICAvL1xuICBwYXJzZXJOYW1lcy5mb3JFYWNoKGZ1bmN0aW9uIChncm91cCkge1xuICAgIHp1bHUgKz0gJyhcXFxcZCtbYS16QS1aXSspPyc7XG4gIH0pO1xuICBcbiAgaWYgKC9eTk9XL2kudGVzdChzdHIpKSB7XG4gICAgLy9cbiAgICAvLyBJZiB0aGUgdGFyZ2V0IGBzdHJgIGlzIGEgbGliZXJhbCBgTk9XLSpgLFxuICAgIC8vIHRoZW4gc2V0IHRoZSBiYXNlIGBkYXRlVGltZWAgYXBwcm9wcmlhdGVseS5cbiAgICAvL1xuICAgIGRhdGVUaW1lID0gRGF0ZS5ub3coKTtcbiAgICB6dWx1ID0genVsdS5yZXBsYWNlKC9aLywgJ05PVycpO1xuICB9XG4gIGVsc2UgaWYgKC9eXFwtLy50ZXN0KHN0cikgfHwgL15cXCsvLnRlc3Qoc3RyKSkge1xuICAgIGRhdGVUaW1lID0gRGF0ZS5ub3coKTtcbiAgICB6dWx1ID0genVsdS5yZXBsYWNlKC9aLywgJycpO1xuICB9XG4gIGVsc2Uge1xuICAgIC8vXG4gICAgLy8gUGFyc2UgdGhlIGBJU084NjAxYCBjb21wb25lbnQsIGFuZCB0aGUgZW5kXG4gICAgLy8gY29tcG9uZW50IGZyb20gdGhlIHRhcmdldCBgc3RyYC5cbiAgICAvL1xuICAgIGRhdGVUaW1lID0gc3RyLm1hdGNoKG5ldyBSZWdFeHAoaXNvLCAnaScpKTtcbiAgICBkYXRlVGltZSA9IERhdGUucGFyc2UoZGF0ZVRpbWVbMV0pO1xuICB9XG4gIFxuICAvL1xuICAvLyBJZiB0aGVyZSB3YXMgbm8gbWF0Y2ggb24gZWl0aGVyIHBhcnQgdGhlbiBcbiAgLy8gaXQgbXVzdCBiZSBhIGJhZCB2YWx1ZS5cbiAgLy9cbiAgaWYgKCFkYXRlVGltZSB8fCAhKG1vZGlmaWVycyA9IHN0ci5tYXRjaChuZXcgUmVnRXhwKHp1bHUsICdpJykpKSkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gICAgXG4gIC8vXG4gIC8vIENyZWF0ZSBhIG5ldyBgRGF0ZWAgb2JqZWN0IGZyb20gdGhlIGBJU084NjAxYFxuICAvLyBjb21wb25lbnQgb2YgdGhlIHRhcmdldCBgc3RyYC5cbiAgLy9cbiAgZGF0ZVRpbWUgPSBuZXcgRGF0ZShkYXRlVGltZSk7XG4gIHNpZ24gPSBtb2RpZmllcnNbMV0gPT09ICcrJyA/IDEgOiAtMTtcbiAgXG4gIC8vXG4gIC8vIENyZWF0ZSBhbiBPYmplY3QtbGl0ZXJhbCBmb3IgY29uc2lzdGVudGx5IGFjY2Vzc2luZ1xuICAvLyB0aGUgdmFyaW91cyBjb21wb25lbnRzIG9mIHRoZSBjb21wdXRlZCBEYXRlLlxuICAvL1xuICB2YXIgY29tcHV0ZWQgPSB7XG4gICAgbWlsbGlzZWNvbmRzOiBkYXRlVGltZS5nZXRNaWxsaXNlY29uZHMoKSxcbiAgICBzZWNvbmRzOiBkYXRlVGltZS5nZXRTZWNvbmRzKCksXG4gICAgbWludXRlczogZGF0ZVRpbWUuZ2V0TWludXRlcygpLFxuICAgIGhvdXJzOiBkYXRlVGltZS5nZXRIb3VycygpLFxuICAgIGRheXM6IGRhdGVUaW1lLmdldERhdGUoKSxcbiAgICBtb250aHM6IGRhdGVUaW1lLmdldE1vbnRoKCksXG4gICAgeWVhcnM6IGRhdGVUaW1lLmdldEZ1bGxZZWFyKClcbiAgfTtcbiAgXG4gIC8vXG4gIC8vIFBhcnNlIHRoZSBpbmRpdmlkdWFsIGNvbXBvbmVudCBzcGFucyAobW9udGhzLCB5ZWFycywgZXRjKVxuICAvLyBmcm9tIHRoZSBtb2RpZmllciBzdHJpbmdzIHRoYXQgd2UgcGFyc2VkIGZyb20gdGhlIGVuZCBcbiAgLy8gb2YgdGhlIHRhcmdldCBgc3RyYC5cbiAgLy9cbiAgbW9kaWZpZXJzLnNsaWNlKDIpLmZpbHRlcihCb29sZWFuKS5mb3JFYWNoKGZ1bmN0aW9uIChtb2RpZmllcikge1xuICAgIHBhcnNlck5hbWVzLmZvckVhY2goZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgIHZhciBtYXRjaDtcbiAgICAgIGlmICghKG1hdGNoID0gbW9kaWZpZXIubWF0Y2gocGFyc2Vyc1tuYW1lXS5leHApKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBcbiAgICAgIGRpZmZbbmFtZV0gPSBzaWduICogcGFyc2VJbnQobWF0Y2hbMV0sIDEwKTtcbiAgICB9KVxuICB9KTtcbiAgXG4gIC8vXG4gIC8vIENvbXB1dGUgdGhlIHRvdGFsIGBkaWZmYCBieSBpdGVyYXRpdmVseSBjb21wdXRpbmcgXG4gIC8vIHRoZSBwYXJ0aWFsIGNvbXBvbmVudHMgZnJvbSBzbWFsbGVzdCB0byBsYXJnZXN0LlxuICAvL1xuICBwYXJzZXJOYW1lcy5mb3JFYWNoKGZ1bmN0aW9uIChuYW1lKSB7ICAgIFxuICAgIGNvbXB1dGVkID0gcGFyc2Vyc1tuYW1lXS5jb21wdXRlKGRpZmZbbmFtZV0sIGNvbXB1dGVkKTtcbiAgfSk7XG4gIFxuICByZXR1cm4gbmV3IERhdGUoXG4gICAgY29tcHV0ZWQueWVhcnMsXG4gICAgY29tcHV0ZWQubW9udGhzLFxuICAgIGNvbXB1dGVkLmRheXMsXG4gICAgY29tcHV0ZWQuaG91cnMsXG4gICAgY29tcHV0ZWQubWludXRlcyxcbiAgICBjb21wdXRlZC5zZWNvbmRzLFxuICAgIGNvbXB1dGVkLm1pbGxpc2Vjb25kc1xuICApO1xufTtcblxuLy9cbi8vICMjIyBmdW5jdGlvbiBmcm9tRGF0ZXMgKHN0YXJ0LCBlbmQsIGFicylcbi8vICMjIyMgQHN0YXJ0IHtEYXRlfSBTdGFydCBkYXRlIG9mIHRoZSBgVGltZVNwYW5gIGluc3RhbmNlIHRvIHJldHVyblxuLy8gIyMjIyBAZW5kIHtEYXRlfSBFbmQgZGF0ZSBvZiB0aGUgYFRpbWVTcGFuYCBpbnN0YW5jZSB0byByZXR1cm5cbi8vICMjIyMgQGFicyB7Ym9vbGVhbn0gVmFsdWUgaW5kaWNhdGluZyB0byByZXR1cm4gYW4gYWJzb2x1dGUgdmFsdWVcbi8vIFJldHVybnMgYSBuZXcgYFRpbWVTcGFuYCBpbnN0YW5jZSByZXByZXNlbnRpbmcgdGhlIGRpZmZlcmVuY2UgYmV0d2VlblxuLy8gdGhlIGBzdGFydGAgYW5kIGBlbmRgIERhdGVzLlxuLy9cbmV4cG9ydHMuZnJvbURhdGVzID0gZnVuY3Rpb24gKHN0YXJ0LCBlbmQsIGFicykge1xuICBpZiAodHlwZW9mIHN0YXJ0ID09PSAnc3RyaW5nJykge1xuICAgIHN0YXJ0ID0gZXhwb3J0cy5wYXJzZURhdGUoc3RhcnQpO1xuICB9XG4gIFxuICBpZiAodHlwZW9mIGVuZCA9PT0gJ3N0cmluZycpIHtcbiAgICBlbmQgPSBleHBvcnRzLnBhcnNlRGF0ZShlbmQpO1xuICB9XG4gIFxuICBpZiAoIShzdGFydCBpbnN0YW5jZW9mIERhdGUgJiYgZW5kIGluc3RhbmNlb2YgRGF0ZSkpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICBcbiAgdmFyIGRpZmZlcmVuY2VNc2VjcyA9IGVuZC52YWx1ZU9mKCkgLSBzdGFydC52YWx1ZU9mKCk7XG4gIGlmIChhYnMpIHtcbiAgICBkaWZmZXJlbmNlTXNlY3MgPSBNYXRoLmFicyhkaWZmZXJlbmNlTXNlY3MpO1xuICB9XG5cbiAgcmV0dXJuIG5ldyBUaW1lU3BhbihkaWZmZXJlbmNlTXNlY3MsIDAsIDAsIDAsIDApO1xufTtcblxuLy9cbi8vICMjIE1vZHVsZSBIZWxwZXJzXG4vLyBNb2R1bGUtbGV2ZWwgaGVscGVycyBmb3IgdmFyaW91cyB1dGlsaXRpZXMgc3VjaCBhczpcbi8vIGluc3RhbmNlT2YsIHBhcnNhYmlsaXR5LCBhbmQgY2xvbmluZy5cbi8vXG5cbi8vXG4vLyAjIyMgZnVuY3Rpb24gdGVzdCAoc3RyKVxuLy8gIyMjIyBAc3RyIHtzdHJpbmd9IFN0cmluZyB2YWx1ZSB0byB0ZXN0IGlmIGl0IGlzIGEgVGltZVNwYW5cbi8vIFJldHVybnMgYSB2YWx1ZSBpbmRpY2F0aW5nIGlmIHRoZSBzcGVjaWZpZWQgc3RyaW5nLCBgc3RyYCxcbi8vIGlzIGEgcGFyc2FibGUgYFRpbWVTcGFuYCB2YWx1ZS5cbi8vXG5leHBvcnRzLnRlc3QgPSBmdW5jdGlvbiAoc3RyKSB7XG4gIHJldHVybiB0aW1lU3BhbldpdGhEYXlzLnRlc3Qoc3RyKSB8fCB0aW1lU3Bhbk5vRGF5cy50ZXN0KHN0cik7XG59O1xuXG4vL1xuLy8gIyMjIGZ1bmN0aW9uIGluc3RhbmNlT2YgKHRpbWVTcGFuKVxuLy8gIyMjIyBAdGltZVNwYW4ge09iamVjdH0gT2JqZWN0IHRvIGNoZWNrIFRpbWVTcGFuIHF1YWxpdHkuXG4vLyBSZXR1cm5zIGEgdmFsdWUgaW5kaWNhdGluZyBpZiB0aGUgc3BlY2lmaWVkIGB0aW1lU3BhbmAgaXNcbi8vIGluIGZhY3QgYSBgVGltZVNwYW5gIGluc3RhbmNlLlxuLy9cbmV4cG9ydHMuaW5zdGFuY2VPZiA9IGZ1bmN0aW9uICh0aW1lU3Bhbikge1xuICByZXR1cm4gdGltZVNwYW4gaW5zdGFuY2VvZiBUaW1lU3Bhbjtcbn07XG5cbi8vXG4vLyAjIyMgZnVuY3Rpb24gY2xvbmUgKHRpbWVTcGFuKVxuLy8gIyMjIyBAdGltZVNwYW4ge1RpbWVTcGFufSBUaW1lU3BhbiBvYmplY3QgdG8gY2xvbmUuXG4vLyBSZXR1cm5zIGEgbmV3IGBUaW1lU3BhbmAgaW5zdGFuY2Ugd2l0aCB0aGUgc2FtZSB2YWx1ZVxuLy8gYXMgdGhlIGB0aW1lU3BhbmAgb2JqZWN0IHN1cHBsaWVkLlxuLy9cbmV4cG9ydHMuY2xvbmUgPSBmdW5jdGlvbiAodGltZVNwYW4pIHtcbiAgaWYgKCEodGltZVNwYW4gaW5zdGFuY2VvZiBUaW1lU3BhbikpIHsgcmV0dXJuIH1cbiAgcmV0dXJuIGV4cG9ydHMuZnJvbU1pbGxpc2Vjb25kcyh0aW1lU3Bhbi50b3RhbE1pbGxpc2Vjb25kcygpKTtcbn07XG5cbi8vXG4vLyAjIyBBZGRpdGlvblxuLy8gTWV0aG9kcyBmb3IgYWRkaW5nIGBUaW1lU3BhbmAgaW5zdGFuY2VzLCBcbi8vIG1pbGxpc2Vjb25kcywgc2Vjb25kcywgaG91cnMsIGFuZCBkYXlzIHRvIG90aGVyXG4vLyBgVGltZVNwYW5gIGluc3RhbmNlcy5cbi8vXG5cbi8vXG4vLyAjIyMgZnVuY3Rpb24gYWRkICh0aW1lU3Bhbilcbi8vICMjIyMgQHRpbWVTcGFuIHtUaW1lU3Bhbn0gVGltZVNwYW4gdG8gYWRkIHRvIHRoaXMgaW5zdGFuY2Vcbi8vIEFkZHMgdGhlIHNwZWNpZmllZCBgdGltZVNwYW5gIHRvIHRoaXMgaW5zdGFuY2UuXG4vL1xuVGltZVNwYW4ucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uICh0aW1lU3Bhbikge1xuICBpZiAoISh0aW1lU3BhbiBpbnN0YW5jZW9mIFRpbWVTcGFuKSkgeyByZXR1cm4gfVxuICB0aGlzLm1zZWNzICs9IHRpbWVTcGFuLnRvdGFsTWlsbGlzZWNvbmRzKCk7XG59O1xuXG4vL1xuLy8gIyMjIGZ1bmN0aW9uIGFkZE1pbGxpc2Vjb25kcyAobWlsbGlzZWNvbmRzKVxuLy8gIyMjIyBAbWlsbGlzZWNvbmRzIHtOdW1iZXJ9IE51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gYWRkLlxuLy8gQWRkcyB0aGUgc3BlY2lmaWVkIGBtaWxsaXNlY29uZHNgIHRvIHRoaXMgaW5zdGFuY2UuXG4vL1xuVGltZVNwYW4ucHJvdG90eXBlLmFkZE1pbGxpc2Vjb25kcyA9IGZ1bmN0aW9uIChtaWxsaXNlY29uZHMpIHtcbiAgaWYgKCFpc051bWVyaWMobWlsbGlzZWNvbmRzKSkgeyByZXR1cm4gfVxuICB0aGlzLm1zZWNzICs9IG1pbGxpc2Vjb25kcztcbn07XG5cbi8vXG4vLyAjIyMgZnVuY3Rpb24gYWRkU2Vjb25kcyAoc2Vjb25kcylcbi8vICMjIyMgQHNlY29uZHMge051bWJlcn0gTnVtYmVyIG9mIHNlY29uZHMgdG8gYWRkLlxuLy8gQWRkcyB0aGUgc3BlY2lmaWVkIGBzZWNvbmRzYCB0byB0aGlzIGluc3RhbmNlLlxuLy9cblRpbWVTcGFuLnByb3RvdHlwZS5hZGRTZWNvbmRzID0gZnVuY3Rpb24gKHNlY29uZHMpIHtcbiAgaWYgKCFpc051bWVyaWMoc2Vjb25kcykpIHsgcmV0dXJuIH1cbiAgXG4gIHRoaXMubXNlY3MgKz0gKHNlY29uZHMgKiBtc2VjUGVyU2Vjb25kKTtcbn07XG5cbi8vXG4vLyAjIyMgZnVuY3Rpb24gYWRkTWludXRlcyAobWludXRlcylcbi8vICMjIyMgQG1pbnV0ZXMge051bWJlcn0gTnVtYmVyIG9mIG1pbnV0ZXMgdG8gYWRkLlxuLy8gQWRkcyB0aGUgc3BlY2lmaWVkIGBtaW51dGVzYCB0byB0aGlzIGluc3RhbmNlLlxuLy9cblRpbWVTcGFuLnByb3RvdHlwZS5hZGRNaW51dGVzID0gZnVuY3Rpb24gKG1pbnV0ZXMpIHtcbiAgaWYgKCFpc051bWVyaWMobWludXRlcykpIHsgcmV0dXJuIH1cbiAgdGhpcy5tc2VjcyArPSAobWludXRlcyAqIG1zZWNQZXJNaW51dGUpO1xufTtcblxuLy9cbi8vICMjIyBmdW5jdGlvbiBhZGRIb3VycyAoaG91cnMpXG4vLyAjIyMjIEBob3VycyB7TnVtYmVyfSBOdW1iZXIgb2YgaG91cnMgdG8gYWRkLlxuLy8gQWRkcyB0aGUgc3BlY2lmaWVkIGBob3Vyc2AgdG8gdGhpcyBpbnN0YW5jZS5cbi8vXG5UaW1lU3Bhbi5wcm90b3R5cGUuYWRkSG91cnMgPSBmdW5jdGlvbiAoaG91cnMpIHtcbiAgaWYgKCFpc051bWVyaWMoaG91cnMpKSB7IHJldHVybiB9XG4gIHRoaXMubXNlY3MgKz0gKGhvdXJzICogbXNlY1BlckhvdXIpO1xufTtcblxuLy9cbi8vICMjIyBmdW5jdGlvbiBhZGREYXlzIChkYXlzKVxuLy8gIyMjIyBAZGF5cyB7TnVtYmVyfSBOdW1iZXIgb2YgZGF5cyB0byBhZGQuXG4vLyBBZGRzIHRoZSBzcGVjaWZpZWQgYGRheXNgIHRvIHRoaXMgaW5zdGFuY2UuXG4vL1xuVGltZVNwYW4ucHJvdG90eXBlLmFkZERheXMgPSBmdW5jdGlvbiAoZGF5cykge1xuICBpZiAoIWlzTnVtZXJpYyhkYXlzKSkgeyByZXR1cm4gfVxuICB0aGlzLm1zZWNzICs9IChkYXlzICogbXNlY1BlckRheSk7XG59O1xuXG4vL1xuLy8gIyMgU3VidHJhY3Rpb25cbi8vIE1ldGhvZHMgZm9yIHN1YnRyYWN0aW5nIGBUaW1lU3BhbmAgaW5zdGFuY2VzLCBcbi8vIG1pbGxpc2Vjb25kcywgc2Vjb25kcywgaG91cnMsIGFuZCBkYXlzIGZyb20gb3RoZXJcbi8vIGBUaW1lU3BhbmAgaW5zdGFuY2VzLlxuLy9cblxuLy9cbi8vICMjIyBmdW5jdGlvbiBzdWJ0cmFjdCAodGltZVNwYW4pXG4vLyAjIyMjIEB0aW1lU3BhbiB7VGltZVNwYW59IFRpbWVTcGFuIHRvIHN1YnRyYWN0IGZyb20gdGhpcyBpbnN0YW5jZS5cbi8vIFN1YnRyYWN0cyB0aGUgc3BlY2lmaWVkIGB0aW1lU3BhbmAgZnJvbSB0aGlzIGluc3RhbmNlLlxuLy9cblRpbWVTcGFuLnByb3RvdHlwZS5zdWJ0cmFjdCA9IGZ1bmN0aW9uICh0aW1lU3Bhbikge1xuICBpZiAoISh0aW1lU3BhbiBpbnN0YW5jZW9mIFRpbWVTcGFuKSkgeyByZXR1cm4gfVxuICB0aGlzLm1zZWNzIC09IHRpbWVTcGFuLnRvdGFsTWlsbGlzZWNvbmRzKCk7XG59O1xuXG4vL1xuLy8gIyMjIGZ1bmN0aW9uIHN1YnRyYWN0TWlsbGlzZWNvbmRzIChtaWxsaXNlY29uZHMpXG4vLyAjIyMjIEBtaWxsaXNlY29uZHMge051bWJlcn0gTnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byBzdWJ0cmFjdC5cbi8vIFN1YnRyYWN0cyB0aGUgc3BlY2lmaWVkIGBtaWxsaXNlY29uZHNgIGZyb20gdGhpcyBpbnN0YW5jZS5cbi8vXG5UaW1lU3Bhbi5wcm90b3R5cGUuc3VidHJhY3RNaWxsaXNlY29uZHMgPSBmdW5jdGlvbiAobWlsbGlzZWNvbmRzKSB7XG4gIGlmICghaXNOdW1lcmljKG1pbGxpc2Vjb25kcykpIHsgcmV0dXJuIH1cbiAgdGhpcy5tc2VjcyAtPSBtaWxsaXNlY29uZHM7XG59O1xuXG4vL1xuLy8gIyMjIGZ1bmN0aW9uIHN1YnRyYWN0U2Vjb25kcyAoc2Vjb25kcylcbi8vICMjIyMgQHNlY29uZHMge051bWJlcn0gTnVtYmVyIG9mIHNlY29uZHMgdG8gc3VidHJhY3QuXG4vLyBTdWJ0cmFjdHMgdGhlIHNwZWNpZmllZCBgc2Vjb25kc2AgZnJvbSB0aGlzIGluc3RhbmNlLlxuLy9cblRpbWVTcGFuLnByb3RvdHlwZS5zdWJ0cmFjdFNlY29uZHMgPSBmdW5jdGlvbiAoc2Vjb25kcykge1xuICBpZiAoIWlzTnVtZXJpYyhzZWNvbmRzKSkgeyByZXR1cm4gfVxuICB0aGlzLm1zZWNzIC09IChzZWNvbmRzICogbXNlY1BlclNlY29uZCk7XG59O1xuXG4vL1xuLy8gIyMjIGZ1bmN0aW9uIHN1YnRyYWN0TWludXRlcyAobWludXRlcylcbi8vICMjIyMgQG1pbnV0ZXMge051bWJlcn0gTnVtYmVyIG9mIG1pbnV0ZXMgdG8gc3VidHJhY3QuXG4vLyBTdWJ0cmFjdHMgdGhlIHNwZWNpZmllZCBgbWludXRlc2AgZnJvbSB0aGlzIGluc3RhbmNlLlxuLy9cblRpbWVTcGFuLnByb3RvdHlwZS5zdWJ0cmFjdE1pbnV0ZXMgPSBmdW5jdGlvbiAobWludXRlcykge1xuICBpZiAoIWlzTnVtZXJpYyhtaW51dGVzKSkgeyByZXR1cm4gfVxuICB0aGlzLm1zZWNzIC09IChtaW51dGVzICogbXNlY1Blck1pbnV0ZSk7XG59O1xuXG4vL1xuLy8gIyMjIGZ1bmN0aW9uIHN1YnRyYWN0SG91cnMgKGhvdXJzKVxuLy8gIyMjIyBAaG91cnMge051bWJlcn0gTnVtYmVyIG9mIGhvdXJzIHRvIHN1YnRyYWN0LlxuLy8gU3VidHJhY3RzIHRoZSBzcGVjaWZpZWQgYGhvdXJzYCBmcm9tIHRoaXMgaW5zdGFuY2UuXG4vL1xuVGltZVNwYW4ucHJvdG90eXBlLnN1YnRyYWN0SG91cnMgPSBmdW5jdGlvbiAoaG91cnMpIHtcbiAgaWYgKCFpc051bWVyaWMoaG91cnMpKSB7IHJldHVybiB9XG4gIHRoaXMubXNlY3MgLT0gKGhvdXJzICogbXNlY1BlckhvdXIpO1xufTtcblxuLy9cbi8vICMjIyBmdW5jdGlvbiBzdWJ0cmFjdERheXMgKGRheXMpXG4vLyAjIyMjIEBkYXlzIHtOdW1iZXJ9IE51bWJlciBvZiBkYXlzIHRvIHN1YnRyYWN0LlxuLy8gU3VidHJhY3RzIHRoZSBzcGVjaWZpZWQgYGRheXNgIGZyb20gdGhpcyBpbnN0YW5jZS5cbi8vXG5UaW1lU3Bhbi5wcm90b3R5cGUuc3VidHJhY3REYXlzID0gZnVuY3Rpb24gKGRheXMpIHtcbiAgaWYgKCFpc051bWVyaWMoZGF5cykpIHsgcmV0dXJuIH1cbiAgdGhpcy5tc2VjcyAtPSAoZGF5cyAqIG1zZWNQZXJEYXkpO1xufTtcblxuLy9cbi8vICMjIEdldHRlcnNcbi8vIE1ldGhvZHMgZm9yIHJldHJpZXZpbmcgY29tcG9uZW50cyBvZiBhIGBUaW1lU3BhbmBcbi8vIGluc3RhbmNlOiBtaWxsaXNlY29uZHMsIHNlY29uZHMsIG1pbnV0ZXMsIGhvdXJzLCBhbmQgZGF5cy5cbi8vXG5cbi8vXG4vLyAjIyMgZnVuY3Rpb24gdG90YWxNaWxsaXNlY29uZHMgKHJvdW5kRG93bilcbi8vICMjIyMgQHJvdW5kRG93biB7Ym9vbGVhbn0gVmFsdWUgaW5kaWNhdGluZyBpZiB0aGUgdmFsdWUgc2hvdWxkIGJlIHJvdW5kZWQgZG93bi5cbi8vIFJldHVybnMgdGhlIHRvdGFsIG51bWJlciBvZiBtaWxsaXNlY29uZHMgZm9yIHRoaXMgaW5zdGFuY2UsIHJvdW5kaW5nIGRvd25cbi8vIHRvIHRoZSBuZWFyZXN0IGludGVnZXIgaWYgYHJvdW5kRG93bmAgaXMgc2V0LlxuLy9cblRpbWVTcGFuLnByb3RvdHlwZS50b3RhbE1pbGxpc2Vjb25kcyA9IGZ1bmN0aW9uIChyb3VuZERvd24pIHtcbiAgdmFyIHJlc3VsdCA9IHRoaXMubXNlY3M7XG4gIGlmIChyb3VuZERvd24gPT09IHRydWUpIHtcbiAgICByZXN1bHQgPSBNYXRoLmZsb29yKHJlc3VsdCk7XG4gIH1cbiAgXG4gIHJldHVybiByZXN1bHQ7XG59O1xuXG4vL1xuLy8gIyMjIGZ1bmN0aW9uIHRvdGFsU2Vjb25kcyAocm91bmREb3duKVxuLy8gIyMjIyBAcm91bmREb3duIHtib29sZWFufSBWYWx1ZSBpbmRpY2F0aW5nIGlmIHRoZSB2YWx1ZSBzaG91bGQgYmUgcm91bmRlZCBkb3duLlxuLy8gUmV0dXJucyB0aGUgdG90YWwgbnVtYmVyIG9mIHNlY29uZHMgZm9yIHRoaXMgaW5zdGFuY2UsIHJvdW5kaW5nIGRvd25cbi8vIHRvIHRoZSBuZWFyZXN0IGludGVnZXIgaWYgYHJvdW5kRG93bmAgaXMgc2V0LlxuLy9cblRpbWVTcGFuLnByb3RvdHlwZS50b3RhbFNlY29uZHMgPSBmdW5jdGlvbiAocm91bmREb3duKSB7XG4gIHZhciByZXN1bHQgPSB0aGlzLm1zZWNzIC8gbXNlY1BlclNlY29uZDtcbiAgaWYgKHJvdW5kRG93biA9PT0gdHJ1ZSkge1xuICAgIHJlc3VsdCA9IE1hdGguZmxvb3IocmVzdWx0KTtcbiAgfVxuICBcbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5cbi8vXG4vLyAjIyMgZnVuY3Rpb24gdG90YWxNaW51dGVzIChyb3VuZERvd24pXG4vLyAjIyMjIEByb3VuZERvd24ge2Jvb2xlYW59IFZhbHVlIGluZGljYXRpbmcgaWYgdGhlIHZhbHVlIHNob3VsZCBiZSByb3VuZGVkIGRvd24uXG4vLyBSZXR1cm5zIHRoZSB0b3RhbCBudW1iZXIgb2YgbWludXRlcyBmb3IgdGhpcyBpbnN0YW5jZSwgcm91bmRpbmcgZG93blxuLy8gdG8gdGhlIG5lYXJlc3QgaW50ZWdlciBpZiBgcm91bmREb3duYCBpcyBzZXQuXG4vL1xuVGltZVNwYW4ucHJvdG90eXBlLnRvdGFsTWludXRlcyA9IGZ1bmN0aW9uIChyb3VuZERvd24pIHtcbiAgdmFyIHJlc3VsdCA9IHRoaXMubXNlY3MgLyBtc2VjUGVyTWludXRlO1xuICBpZiAocm91bmREb3duID09PSB0cnVlKSB7XG4gICAgcmVzdWx0ID0gTWF0aC5mbG9vcihyZXN1bHQpO1xuICB9XG4gIFxuICByZXR1cm4gcmVzdWx0O1xufTtcblxuLy9cbi8vICMjIyBmdW5jdGlvbiB0b3RhbEhvdXJzIChyb3VuZERvd24pXG4vLyAjIyMjIEByb3VuZERvd24ge2Jvb2xlYW59IFZhbHVlIGluZGljYXRpbmcgaWYgdGhlIHZhbHVlIHNob3VsZCBiZSByb3VuZGVkIGRvd24uXG4vLyBSZXR1cm5zIHRoZSB0b3RhbCBudW1iZXIgb2YgaG91cnMgZm9yIHRoaXMgaW5zdGFuY2UsIHJvdW5kaW5nIGRvd25cbi8vIHRvIHRoZSBuZWFyZXN0IGludGVnZXIgaWYgYHJvdW5kRG93bmAgaXMgc2V0LlxuLy9cblRpbWVTcGFuLnByb3RvdHlwZS50b3RhbEhvdXJzID0gZnVuY3Rpb24gKHJvdW5kRG93bikge1xuICB2YXIgcmVzdWx0ID0gdGhpcy5tc2VjcyAvIG1zZWNQZXJIb3VyO1xuICBpZiAocm91bmREb3duID09PSB0cnVlKSB7XG4gICAgcmVzdWx0ID0gTWF0aC5mbG9vcihyZXN1bHQpO1xuICB9XG4gIFxuICByZXR1cm4gcmVzdWx0O1xufTtcblxuLy9cbi8vICMjIyBmdW5jdGlvbiB0b3RhbERheXMgKHJvdW5kRG93bilcbi8vICMjIyMgQHJvdW5kRG93biB7Ym9vbGVhbn0gVmFsdWUgaW5kaWNhdGluZyBpZiB0aGUgdmFsdWUgc2hvdWxkIGJlIHJvdW5kZWQgZG93bi5cbi8vIFJldHVybnMgdGhlIHRvdGFsIG51bWJlciBvZiBkYXlzIGZvciB0aGlzIGluc3RhbmNlLCByb3VuZGluZyBkb3duXG4vLyB0byB0aGUgbmVhcmVzdCBpbnRlZ2VyIGlmIGByb3VuZERvd25gIGlzIHNldC5cbi8vXG5UaW1lU3Bhbi5wcm90b3R5cGUudG90YWxEYXlzID0gZnVuY3Rpb24gKHJvdW5kRG93bikge1xuICB2YXIgcmVzdWx0ID0gdGhpcy5tc2VjcyAvIG1zZWNQZXJEYXk7XG4gIGlmIChyb3VuZERvd24gPT09IHRydWUpIHtcbiAgICByZXN1bHQgPSBNYXRoLmZsb29yKHJlc3VsdCk7XG4gIH1cbiAgXG4gIHJldHVybiByZXN1bHQ7XG59O1xuXG4vL1xuLy8gIyMjIEBtaWxsaXNlY29uZHNcbi8vIFJldHVybnMgdGhlIGxlbmd0aCBvZiB0aGlzIGBUaW1lU3BhbmAgaW5zdGFuY2UgaW4gbWlsbGlzZWNvbmRzLlxuLy9cblRpbWVTcGFuLnByb3RvdHlwZS5fX2RlZmluZUdldHRlcl9fKCdtaWxsaXNlY29uZHMnLCBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiB0aGlzLm1zZWNzICUgMTAwMDtcbn0pO1xuXG4vL1xuLy8gIyMjIEBzZWNvbmRzXG4vLyBSZXR1cm5zIHRoZSBsZW5ndGggb2YgdGhpcyBgVGltZVNwYW5gIGluc3RhbmNlIGluIHNlY29uZHMuXG4vL1xuVGltZVNwYW4ucHJvdG90eXBlLl9fZGVmaW5lR2V0dGVyX18oJ3NlY29uZHMnLCBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiBNYXRoLmZsb29yKHRoaXMubXNlY3MgLyBtc2VjUGVyU2Vjb25kKSAlIDYwO1xufSk7XG5cbi8vXG4vLyAjIyMgQG1pbnV0ZXNcbi8vIFJldHVybnMgdGhlIGxlbmd0aCBvZiB0aGlzIGBUaW1lU3BhbmAgaW5zdGFuY2UgaW4gbWludXRlcy5cbi8vXG5UaW1lU3Bhbi5wcm90b3R5cGUuX19kZWZpbmVHZXR0ZXJfXygnbWludXRlcycsIGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIE1hdGguZmxvb3IodGhpcy5tc2VjcyAvIG1zZWNQZXJNaW51dGUpICUgNjA7XG59KTtcblxuLy9cbi8vICMjIyBAaG91cnNcbi8vIFJldHVybnMgdGhlIGxlbmd0aCBvZiB0aGlzIGBUaW1lU3BhbmAgaW5zdGFuY2UgaW4gaG91cnMuXG4vL1xuVGltZVNwYW4ucHJvdG90eXBlLl9fZGVmaW5lR2V0dGVyX18oJ2hvdXJzJywgZnVuY3Rpb24gKCkge1xuICByZXR1cm4gTWF0aC5mbG9vcih0aGlzLm1zZWNzIC8gbXNlY1BlckhvdXIpICUgMjQ7XG59KTtcblxuLy9cbi8vICMjIyBAZGF5c1xuLy8gUmV0dXJucyB0aGUgbGVuZ3RoIG9mIHRoaXMgYFRpbWVTcGFuYCBpbnN0YW5jZSBpbiBkYXlzLlxuLy9cblRpbWVTcGFuLnByb3RvdHlwZS5fX2RlZmluZUdldHRlcl9fKCdkYXlzJywgZnVuY3Rpb24gKCkge1xuICByZXR1cm4gTWF0aC5mbG9vcih0aGlzLm1zZWNzIC8gbXNlY1BlckRheSk7XG59KTtcblxuLy9cbi8vICMjIEluc3RhbmNlIEhlbHBlcnNcbi8vIFZhcmlvdXMgaGVscCBtZXRob2RzIGZvciBwZXJmb3JtaW5nIHV0aWxpdGllc1xuLy8gc3VjaCBhcyBlcXVhbGl0eSBhbmQgc2VyaWFsaXphdGlvblxuLy9cblxuLy9cbi8vICMjIyBmdW5jdGlvbiBlcXVhbHMgKHRpbWVTcGFuKVxuLy8gIyMjIyBAdGltZVNwYW4ge1RpbWVTcGFufSBUaW1lU3BhbiBpbnN0YW5jZSB0byBhc3NlcnQgZXF1YWxcbi8vIFJldHVybnMgYSB2YWx1ZSBpbmRpY2F0aW5nIGlmIHRoZSBzcGVjaWZpZWQgYHRpbWVTcGFuYCBpcyBlcXVhbFxuLy8gaW4gbWlsbGlzZWNvbmRzIHRvIHRoaXMgaW5zdGFuY2UuXG4vL1xuVGltZVNwYW4ucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uICh0aW1lU3Bhbikge1xuICBpZiAoISh0aW1lU3BhbiBpbnN0YW5jZW9mIFRpbWVTcGFuKSkgeyByZXR1cm4gfVxuICByZXR1cm4gdGhpcy5tc2VjcyA9PT0gdGltZVNwYW4udG90YWxNaWxsaXNlY29uZHMoKTtcbn07XG5cbi8vXG4vLyAjIyMgZnVuY3Rpb24gdG9TdHJpbmcgKCkgXG4vLyBSZXR1cm5zIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgYFRpbWVTcGFuYFxuLy8gaW5zdGFuY2UgYWNjb3JkaW5nIHRvIGN1cnJlbnQgYGZvcm1hdGAuXG4vL1xuVGltZVNwYW4ucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkge1xuICBpZiAoIXRoaXMuZm9ybWF0KSB7IHJldHVybiB0aGlzLl9mb3JtYXQoKSB9XG4gIHJldHVybiB0aGlzLmZvcm1hdCh0aGlzKTtcbn07XG5cbi8vXG4vLyAjIyMgQHByaXZhdGUgZnVuY3Rpb24gX2Zvcm1hdCAoKSBcbi8vIFJldHVybnMgdGhlIGRlZmF1bHQgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgaW5zdGFuY2UuXG4vL1xuVGltZVNwYW4ucHJvdG90eXBlLl9mb3JtYXQgPSBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiBbXG4gICAgdGhpcy5kYXlzLFxuICAgIHRoaXMuaG91cnMsXG4gICAgdGhpcy5taW51dGVzLFxuICAgIHRoaXMuc2Vjb25kcyArICcuJyArIHRoaXMubWlsbGlzZWNvbmRzXG4gIF0uam9pbignOicpXG59O1xuXG4vL1xuLy8gIyMjIEBwcml2YXRlIGZ1bmN0aW9uIGlzTnVtZXJpYyAoaW5wdXQpIFxuLy8gIyMjIyBAaW5wdXQge051bWJlcn0gVmFsdWUgdG8gY2hlY2sgbnVtZXJpYyBxdWFsaXR5IG9mLlxuLy8gUmV0dXJucyBhIHZhbHVlIGluZGljYXRpbmcgdGhlIG51bWVyaWMgcXVhbGl0eSBvZiB0aGUgXG4vLyBzcGVjaWZpZWQgYGlucHV0YC5cbi8vXG5mdW5jdGlvbiBpc051bWVyaWMgKGlucHV0KSB7XG4gIHJldHVybiBpbnB1dCAmJiAhaXNOYU4ocGFyc2VGbG9hdChpbnB1dCkpICYmIGlzRmluaXRlKGlucHV0KTtcbn07XG5cbi8vXG4vLyAjIyMgQHByaXZhdGUgZnVuY3Rpb24gX2NvbXB1dGUgKGRlbHRhLCBkYXRlLCBjb21wdXRlZCwgb3B0aW9ucylcbi8vICMjIyMgQGRlbHRhIHtOdW1iZXJ9IENoYW5uZ2UgaW4gdGhpcyBjb21wb25lbnQgb2YgdGhlIGRhdGVcbi8vICMjIyMgQGNvbXB1dGVkIHtPYmplY3R9IEN1cnJlbnRseSBjb21wdXRlZCBkYXRlLlxuLy8gIyMjIyBAb3B0aW9ucyB7T2JqZWN0fSBPcHRpb25zIGZvciB0aGUgY29tcHV0YXRpb25cbi8vIFBlcmZvcm1zIGNhcnJ5IGZvcndhcmQgYWRkaXRpb24gb3Igc3VidHJhY3Rpb24gZm9yIHRoZVxuLy8gYG9wdGlvbnMuY3VycmVudGAgY29tcG9uZW50IG9mIHRoZSBgY29tcHV0ZWRgIGRhdGUsIGNhcnJ5aW5nIFxuLy8gaXQgZm9yd2FyZCB0byBgb3B0aW9ucy5uZXh0YCBkZXBlbmRpbmcgb24gdGhlIG1heGltdW0gdmFsdWUsXG4vLyBgb3B0aW9ucy5tYXhgLlxuLy9cbmZ1bmN0aW9uIF9jb21wdXRlIChkZWx0YSwgY29tcHV0ZWQsIG9wdGlvbnMpIHtcbiAgdmFyIGN1cnJlbnQgPSBvcHRpb25zLmN1cnJlbnQsXG4gICAgICBuZXh0ICAgID0gb3B0aW9ucy5uZXh0LFxuICAgICAgbWF4ICAgICA9IG9wdGlvbnMubWF4LFxuICAgICAgcm91bmQgID0gZGVsdGEgPiAwID8gTWF0aC5mbG9vciA6IE1hdGguY2VpbDtcbiAgICAgIFxuICBpZiAoZGVsdGEpIHtcbiAgICBjb21wdXRlZFtuZXh0XSArPSByb3VuZC5jYWxsKG51bGwsIGRlbHRhIC8gbWF4KTtcbiAgICBjb21wdXRlZFtjdXJyZW50XSArPSBkZWx0YSAlIG1heDtcbiAgfVxuICBcbiAgaWYgKE1hdGguYWJzKGNvbXB1dGVkW2N1cnJlbnRdKSA+PSBtYXgpIHtcbiAgICBjb21wdXRlZFtuZXh0XSArPSByb3VuZC5jYWxsKG51bGwsIGNvbXB1dGVkW2N1cnJlbnRdIC8gbWF4KVxuICAgIGNvbXB1dGVkW2N1cnJlbnRdID0gY29tcHV0ZWRbY3VycmVudF0gJSBtYXg7XG4gIH1cblxuICByZXR1cm4gY29tcHV0ZWQ7XG59XG5cblxuLy9cbi8vICMjIyBAcHJpdmF0ZSBtb250aERheXMgKG1vbnRoLCB5ZWFyKVxuLy8gIyMjIyBAbW9udGgge051bWJlcn0gTW9udGggdG8gZ2V0IGRheXMgZm9yLlxuLy8gIyMjIyBAeWVhciB7TnVtYmVyfSBZZWFyIG9mIHRoZSBtb250aCB0byBnZXQgZGF5cyBmb3IuXG4vLyBSZXR1cm5zIHRoZSBudW1iZXIgb2YgZGF5cyBpbiB0aGUgc3BlY2lmaWVkIGBtb250aGAgb2JzZXJ2aW5nXG4vLyBsZWFwIHllYXJzLlxuLy9cbnZhciBtb250aHMgPSBbMzEsIDI4LCAzMSwgMzAsIDMxLCAzMCwgMzEsIDMxLCAzMCwgMzEsIDMwLCAzMV07XG5mdW5jdGlvbiBtb250aERheXMgKG1vbnRoLCB5ZWFyKSB7ICAgIFxuICBpZiAoKCh5ZWFyICUgMTAwICE9PSAwICYmIHllYXIgJSA0ID09PSAwKSBcbiAgICB8fCB5ZWFyICUgNDAwID09PSAwKSAmJiBtb250aCA9PT0gMSkge1xuICAgIHJldHVybiAyOTtcbiAgfVxuICBcbiAgcmV0dXJuIG1vbnRoc1ttb250aF07XG59IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMTUvNC8xNC5cbiAqL1xudmFyIFZFUlNJT05fQVNTRVRfSUQgPSBcIkB2ZXJzaW9uXCI7XG52YXIgTUFOSUZFU1RfQVNTRVRfSUQgPSBcIkBtYW5pZmVzdFwiO1xudmFyIEFzc2V0c01hbmFnZXIgPSBjYy5DbGFzcy5leHRlbmQoe1xuICAgIC8qKlxuICAgICAqIHtqc2IuQXNzZXRzTWFuYWdlcn1cbiAgICAgKi9cbiAgICBfYW0gOiBudWxsLFxuICAgIC8qKlxuICAgICAqIHtudW1iZXJ95aSx6LSl5qyh5pWwXG4gICAgICovXG4gICAgX2ZhaWxDb3VudCA6IDAsXG4gICAgLyoqXG4gICAgICoge251bWJlcn3mnIDlpKfplJnor6/ph43or5XmrKHmlbBcbiAgICAgKi9cbiAgICBfbWF4RmFpbENvdW50IDogMSxcbiAgICBjdG9yOmZ1bmN0aW9uKCl7XG5cbiAgICB9LFxuICAgIHB1cmdlOmZ1bmN0aW9uKCkge1xuICAgICAgICBpZih0aGlzLl9hbSl7XG4gICAgICAgICAgICB0aGlzLl9hbS5yZWxlYXNlKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fYW0gPSBudWxsO1xuICAgIH0sXG5cbiAgICByZXRyeURvd25Bc3NldHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fZmFpbENvdW50ID0gMDtcbiAgICAgICAgdGhpcy5fbWF4RmFpbENvdW50ID0gNTtcbiAgICAgICAgaWYodGhpcy5fYW0pIHtcbiAgICAgICAgICAgIHRoaXMuX2FtLmRvd25sb2FkRmFpbGVkQXNzZXRzKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZG93bkxvYWRBc3NldHMgOiBmdW5jdGlvbihwcm9qZWN0TWFuaWZlc3RQYXRoLHN0b3JhZ2VQYXRoLHVwZGF0ZUNhbGxCYWNrLGVuZENhbGxCYWNrKSB7XG4gICAgICAgIHRoaXMuX2ZhaWxDb3VudCA9IDA7XG4gICAgICAgIHRoaXMuX21heEZhaWxDb3VudCA9IDU7XG4gICAgICAgIHRoaXMuX2FtID0gbmV3IGpzYi5Bc3NldHNNYW5hZ2VyKHByb2plY3RNYW5pZmVzdFBhdGgsIHN0b3JhZ2VQYXRoKTtcbiAgICAgICAgdGhpcy5fYW0ucmV0YWluKCk7XG4gICAgICAgIGlmICghdGhpcy5fYW0uZ2V0TG9jYWxNYW5pZmVzdCgpLmlzTG9hZGVkKCkpIHtcbiAgICAgICAgICAgIGVuZENhbGxCYWNrKFwiZXJyb3JfbG9jYWxfbWFuaWZlc3Rfbm90X2xvYWRlZFwiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHZhciBsaXN0ZW5lciA9IG5ldyBqc2IuRXZlbnRMaXN0ZW5lckFzc2V0c01hbmFnZXIodGhpcy5fYW0sIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgc3dpdGNoIChldmVudC5nZXRFdmVudENvZGUoKSkge1xuICAgICAgICAgICAgICAgIGNhc2UganNiLkV2ZW50QXNzZXRzTWFuYWdlci5VUERBVEVfUFJPR1JFU1NJT046XG4gICAgICAgICAgICAgICAgICAgIHZhciBtc2cgPSBldmVudC5nZXRNZXNzYWdlKCk7XG4gICAgICAgICAgICAgICAgICAgIGNjLmxvZyhcIlVQREFURV9QUk9HUkVTU0lPTjpcIiArIG1zZyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhc3NldElkID0gZXZlbnQuZ2V0QXNzZXRJZCgpO1xuICAgICAgICAgICAgICAgICAgICBjYy5sb2coXCJhc3NldElkOlwiK2Fzc2V0SWQpO1xuICAgICAgICAgICAgICAgICAgICBpZihhc3NldElkID09IFZFUlNJT05fQVNTRVRfSUQgfHwgYXNzZXRJZCA9PSBNQU5JRkVTVF9BU1NFVF9JRCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlQ2FsbEJhY2soMSwgXCJ1cGRhdGUgbWFuaWZlc3RcIik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVDYWxsQmFjayhldmVudC5nZXRQZXJjZW50KCksIG1zZyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBqc2IuRXZlbnRBc3NldHNNYW5hZ2VyLlVQREFURV9GQUlMRUQ6XG4gICAgICAgICAgICAgICAgICAgIGNjLmxvZyhcIlVwZGF0ZSBmYWlsZWQuIFwiICsgZXZlbnQuZ2V0TWVzc2FnZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmFpbENvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGF0Ll9mYWlsQ291bnQgPCB0aGF0Ll9tYXhGYWlsQ291bnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2FtLmRvd25sb2FkRmFpbGVkQXNzZXRzKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYy5sb2coXCJSZWFjaCBtYXhpbXVtIGZhaWwgY291bnQsIGV4aXQgdXBkYXRlIHByb2Nlc3NcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9mYWlsQ291bnQgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgZW5kQ2FsbEJhY2soZXZlbnQuZ2V0RXZlbnRDb2RlKCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UganNiLkV2ZW50QXNzZXRzTWFuYWdlci5VUERBVEVfRklOSVNIRUQ6XG4gICAgICAgICAgICAgICAgY2FzZSBqc2IuRXZlbnRBc3NldHNNYW5hZ2VyLkFMUkVBRFlfVVBfVE9fREFURTpcbiAgICAgICAgICAgICAgICAgICAgZW5kQ2FsbEJhY2sobnVsbCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSBqc2IuRXZlbnRBc3NldHNNYW5hZ2VyLkVSUk9SX05PX0xPQ0FMX01BTklGRVNUOlxuICAgICAgICAgICAgICAgICAgICBjYy5sb2coXCJObyBsb2NhbCBtYW5pZmVzdCBmaWxlIGZvdW5kLCBza2lwIGFzc2V0cyB1cGRhdGUuXCIpO1xuICAgICAgICAgICAgICAgICAgICBlbmRDYWxsQmFjayhldmVudC5nZXRFdmVudENvZGUoKSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UganNiLkV2ZW50QXNzZXRzTWFuYWdlci5FUlJPUl9ET1dOTE9BRF9NQU5JRkVTVDpcbiAgICAgICAgICAgICAgICAgICAgZW5kQ2FsbEJhY2soZXZlbnQuZ2V0RXZlbnRDb2RlKCkpO1xuICAgICAgICAgICAgICAgICAgICBjYy5sb2coXCJGYWlsIHRvIGRvd25sb2FkIG1hbmlmZXN0IGZpbGUsIHVwZGF0ZSBza2lwcGVkLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBqc2IuRXZlbnRBc3NldHNNYW5hZ2VyLkVSUk9SX1BBUlNFX01BTklGRVNUOlxuICAgICAgICAgICAgICAgICAgICBlbmRDYWxsQmFjayhldmVudC5nZXRFdmVudENvZGUoKSk7XG4gICAgICAgICAgICAgICAgICAgIGNjLmxvZyhcIkZhaWwgdG8gcGFyc2UgbWFuaWZlc3QgZmlsZSwgdXBkYXRlIHNraXBwZWQuXCIpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIGpzYi5FdmVudEFzc2V0c01hbmFnZXIuRVJST1JfVVBEQVRJTkc6XG4gICAgICAgICAgICAgICAgICAgIGNjLmxvZyhcIkFzc2V0IHVwZGF0ZSBlcnJvcjogXCIgKyBldmVudC5nZXRNZXNzYWdlKCkpO1xuICAgICAgICAgICAgICAgICAgICBlbmRDYWxsQmFjayhldmVudC5nZXRFdmVudENvZGUoKSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UganNiLkV2ZW50QXNzZXRzTWFuYWdlci5FUlJPUl9ERUNPTVBSRVNTOlxuICAgICAgICAgICAgICAgICAgICBjYy5sb2coZXZlbnQuZ2V0TWVzc2FnZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgZW5kQ2FsbEJhY2soZXZlbnQuZ2V0RXZlbnRDb2RlKCkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBjYy5sb2coXCJkZWZhdWx0OiBcIiArIGV2ZW50LmdldEV2ZW50Q29kZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNjLmV2ZW50TWFuYWdlci5hZGRMaXN0ZW5lcihsaXN0ZW5lciwgMSk7XG4gICAgICAgIHRoaXMuX2FtLnVwZGF0ZSgpO1xuICAgIH1cbn0pO1xuXG5Bc3NldHNNYW5hZ2VyLl9pbnN0YW5jZSA9IG51bGw7XG5Bc3NldHNNYW5hZ2VyLl9maXJzdFVzZUluc3RhbmNlID0gdHJ1ZTtcblxuLyoqXG4gKlxuICogQHJldHVybnMge0Fzc2V0c01hbmFnZXJ9XG4gKi9cbkFzc2V0c01hbmFnZXIuZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKEFzc2V0c01hbmFnZXIuX2ZpcnN0VXNlSW5zdGFuY2UpIHtcbiAgICAgICAgQXNzZXRzTWFuYWdlci5fZmlyc3RVc2VJbnN0YW5jZSA9IGZhbHNlO1xuICAgICAgICBBc3NldHNNYW5hZ2VyLl9pbnN0YW5jZSA9IG5ldyBBc3NldHNNYW5hZ2VyKCk7XG4gICAgfVxuICAgIHJldHVybiBBc3NldHNNYW5hZ2VyLl9pbnN0YW5jZTtcbn07XG5cblxubW9kdWxlLmV4cG9ydHMgPSBBc3NldHNNYW5hZ2VyOyIsIlxudmFyIERvd25sYW9kZXIgPSBjYy5DbGFzcy5leHRlbmQoe1xuICAgIFxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICB9LFxuXG4gICAgZG93bmxvYWQ6IGZ1bmN0aW9uICh1cmwsIGxvY2FsU3RvcmFnZVBhdGgsIHBhcmFtLCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgZG93bmxvYWRlciA9IG5ldyBqc2IuRG93bmxvYWRlcigpO1xuICAgICAgICBjYy5sb2coXCJEb3dubGFvZGVyIHVybDpcIiArIHVybCk7XG4gICAgICAgIGNjLmxvZyhcIkRvd25sYW9kZXIgbG9jYWxTdG9yYWdlUGF0aDpcIiArIGxvY2FsU3RvcmFnZVBhdGgpO1xuICAgICAgICBkb3dubG9hZGVyLmNyZWF0ZURvd25sb2FkRmlsZVRhc2sodXJsLCBsb2NhbFN0b3JhZ2VQYXRoKTtcbiAgICAgICAgZG93bmxvYWRlci5zZXRPblRhc2tFcnJvcihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjYy5sb2coXCJEb3dubGFvZGVyIHNldE9uVGFza0Vycm9yXCIpO1xuICAgICAgICAgICAgdGhpcy5kZWxheURvd25sb2FkKGRvd25sb2FkZXIsIHVybCwgbG9jYWxTdG9yYWdlUGF0aCk7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIGRvd25sb2FkZXIuc2V0T25UYXNrUHJvZ3Jlc3MoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY2MubG9nKFwiRG93bmxhb2RlciBzZXRPblRhc2tQcm9ncmVzc1wiKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGRvd25sb2FkZXIuc2V0T25GaWxlVGFza1N1Y2Nlc3MoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY2MubG9nKFwiRG93bmxhb2RlciBzZXRPbkZpbGVUYXNrU3VjY2Vzc1wiKTtcbiAgICAgICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKHBhcmFtKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGRlbGF5RG93bmxvYWQ6IGZ1bmN0aW9uIChkb3dubG9hZGVyLCB1cmwsIGxvY2FsU3RvcmFnZVBhdGgpIHtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBkb3dubG9hZGVyLmNyZWF0ZURvd25sb2FkRmlsZVRhc2sodXJsLCBsb2NhbFN0b3JhZ2VQYXRoKTtcbiAgICAgICAgfS5iaW5kKHRoaXMpLCAzMDAwKTtcbiAgICB9XG59KTtcblxuRG93bmxhb2Rlci5faW5zdGFuY2UgPSBudWxsO1xuRG93bmxhb2Rlci5fZmlyc3RVc2VJbnN0YW5jZSA9IHRydWU7XG5cbi8qKlxuICpcbiAqIEByZXR1cm5zIHtEb3dubGFvZGVyfVxuICovXG5Eb3dubGFvZGVyLmdldEluc3RhbmNlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChEb3dubGFvZGVyLl9maXJzdFVzZUluc3RhbmNlKSB7XG4gICAgICAgIERvd25sYW9kZXIuX2ZpcnN0VXNlSW5zdGFuY2UgPSBmYWxzZTtcbiAgICAgICAgRG93bmxhb2Rlci5faW5zdGFuY2UgPSBuZXcgRG93bmxhb2RlcigpO1xuICAgIH1cbiAgICByZXR1cm4gRG93bmxhb2Rlci5faW5zdGFuY2U7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IERvd25sYW9kZXI7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMTUvNC8yNy5cbiAqL1xuXG5cbnZhciBBdWRpb0VuZ2luZVdyYXBwZXIgPSB7XG4gICAgLy9Vc2VkIGZvciBuYXRpdmVcbiAgICBfbXVzaWNJZDogLTEsXG4gICAgX211c2ljVm9sdW1lOiAxLjAsXG4gICAgX2VmZmVjdFZvbHVtZTogMS4wLFxuICAgIF9hdWRpb0lkTWFwOiB7fSxcblxuICAgIHVzZUpzYkF1ZGlvRW5naW5lOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIChjYy5zeXMuaXNOYXRpdmUpO1xuICAgIH0sXG5cbiAgICBnZXRNdXNpY1ZvbHVtZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdm9sdW1lID0gMDtcbiAgICAgICAgaWYgKHRoaXMudXNlSnNiQXVkaW9FbmdpbmUoKSkge1xuICAgICAgICAgICAgdm9sdW1lID0gdGhpcy5fbXVzaWNWb2x1bWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2b2x1bWUgPSBjYy5hdWRpb0VuZ2luZS5nZXRNdXNpY1ZvbHVtZSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2b2x1bWU7XG4gICAgfSxcblxuICAgIHNldE11c2ljVm9sdW1lOiBmdW5jdGlvbiAodm9sdW1lKSB7XG4gICAgICAgIGlmICh0aGlzLnVzZUpzYkF1ZGlvRW5naW5lKCkpIHtcbiAgICAgICAgICAgIHRoaXMuX211c2ljVm9sdW1lID0gdm9sdW1lO1xuICAgICAgICAgICAganNiLkF1ZGlvRW5naW5lLnNldFZvbHVtZSh0aGlzLl9tdXNpY0lkLCB2b2x1bWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2MuYXVkaW9FbmdpbmUuc2V0TXVzaWNWb2x1bWUodm9sdW1lKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRFZmZlY3RzVm9sdW1lOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB2b2x1bWU7XG4gICAgICAgIGlmICh0aGlzLnVzZUpzYkF1ZGlvRW5naW5lKCkpIHtcbiAgICAgICAgICAgIHZvbHVtZSA9IHRoaXMuX2VmZmVjdFZvbHVtZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZvbHVtZSA9IGNjLmF1ZGlvRW5naW5lLmdldEVmZmVjdHNWb2x1bWUoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdm9sdW1lO1xuICAgIH0sXG5cbiAgICBzZXRFZmZlY3RzVm9sdW1lOiBmdW5jdGlvbiAodm9sdW1lKSB7XG4gICAgICAgIGlmICh0aGlzLnVzZUpzYkF1ZGlvRW5naW5lKCkpIHtcbiAgICAgICAgICAgIHRoaXMuX2VmZmVjdFZvbHVtZSA9IHZvbHVtZTtcbiAgICAgICAgICAgIHZhciBhdWRpb0lkcyA9IE9iamVjdC5rZXlzKHRoaXMuX2F1ZGlvSWRNYXApO1xuICAgICAgICAgICAgYXVkaW9JZHMuZm9yRWFjaCAoZnVuY3Rpb24gKGF1ZGlvSWQpIHtcbiAgICAgICAgICAgICAgICBqc2IuQXVkaW9FbmdpbmUuc2V0Vm9sdW1lKHBhcnNlSW50KGF1ZGlvSWQpLCB2b2x1bWUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYy5hdWRpb0VuZ2luZS5zZXRFZmZlY3RzVm9sdW1lKHZvbHVtZSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcGxheUVmZmVjdDogZnVuY3Rpb24gKHVybCwgbG9vcCkge1xuICAgICAgICB2YXIgYXVkaW9JZDtcbiAgICAgICAgaWYgKHRoaXMudXNlSnNiQXVkaW9FbmdpbmUoKSkge1xuICAgICAgICAgICAgYXVkaW9JZCA9IGpzYi5BdWRpb0VuZ2luZS5wbGF5MmQodXJsLCBsb29wLCB0aGlzLl9lZmZlY3RWb2x1bWUpO1xuICAgICAgICAgICAgdGhpcy5fYXVkaW9JZE1hcFthdWRpb0lkXSA9IGF1ZGlvSWQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhdWRpb0lkID0gY2MuYXVkaW9FbmdpbmUucGxheUVmZmVjdCh1cmwsIGxvb3ApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhdWRpb0lkO1xuICAgIH0sXG5cbiAgICBzdG9wRWZmZWN0OiBmdW5jdGlvbiAoYXVkaW9JZCkge1xuICAgICAgICBpZiAodGhpcy51c2VKc2JBdWRpb0VuZ2luZSgpKSB7XG4gICAgICAgICAgICB0aGlzLl9uYXRpdmVTdG9wQXVkaW8oYXVkaW9JZCk7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5fYXVkaW9JZE1hcFthdWRpb0lkXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNjLmF1ZGlvRW5naW5lLnN0b3BFZmZlY3QoYXVkaW9JZCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc3RvcEFsbEVmZmVjdHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMudXNlSnNiQXVkaW9FbmdpbmUoKSkge1xuICAgICAgICAgICAgdmFyIGF1ZGlvSWRzID0gT2JqZWN0LmtleXModGhpcy5fYXVkaW9JZE1hcCk7XG4gICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICBhdWRpb0lkcy5mb3JFYWNoKGZ1bmN0aW9uIChhdWRpb0lkKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5fbmF0aXZlU3RvcEF1ZGlvKGF1ZGlvSWQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLl9hdWRpb0lkTWFwID0ge307XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYy5hdWRpb0VuZ2luZS5zdG9wQWxsRWZmZWN0cygpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHBsYXlNdXNpYzogZnVuY3Rpb24gKHVybCwgbG9vcCkge1xuICAgICAgICBpZiAodGhpcy51c2VKc2JBdWRpb0VuZ2luZSgpKSB7XG4gICAgICAgICAgICBpZiAoLTEgIT09IHRoaXMuX211c2ljSWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9uYXRpdmVTdG9wQXVkaW8odGhpcy5fbXVzaWNJZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9tdXNpY0lkID0ganNiLkF1ZGlvRW5naW5lLnBsYXkyZCh1cmwsIGxvb3AsIHRoaXMuX211c2ljVm9sdW1lKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNjLmF1ZGlvRW5naW5lLnBsYXlNdXNpYyh1cmwsIGxvb3ApO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGlzTXVzaWNQbGF5aW5nOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciByZXN1bHQ7XG4gICAgICAgIGlmICh0aGlzLnVzZUpzYkF1ZGlvRW5naW5lKCkpIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IChqc2IuQXVkaW9FbmdpbmUuZ2V0U3RhdGUodGhpcy5fbXVzaWNJZCkgPT09IDEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0ID0gY2MuYXVkaW9FbmdpbmUuaXNNdXNpY1BsYXlpbmcoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0sXG5cbiAgICByZXN1bWVNdXNpYzogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy51c2VKc2JBdWRpb0VuZ2luZSgpKSB7XG4gICAgICAgICAgICBqc2IuQXVkaW9FbmdpbmUucmVzdW1lKHRoaXMuX211c2ljSWQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2MuYXVkaW9FbmdpbmUucmVzdW1lTXVzaWMoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBwYXVzZU11c2ljOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLnVzZUpzYkF1ZGlvRW5naW5lKCkpIHtcbiAgICAgICAgICAgIGpzYi5BdWRpb0VuZ2luZS5wYXVzZSh0aGlzLl9tdXNpY0lkKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNjLmF1ZGlvRW5naW5lLnBhdXNlTXVzaWMoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBfbmF0aXZlU3RvcEF1ZGlvOiBmdW5jdGlvbiAoYXVkaW9JZCkge1xuICAgICAgICBqc2IuQXVkaW9FbmdpbmUuc3RvcChhdWRpb0lkKTtcbiAgICB9LFxuXG4gICAgc3RvcE11c2ljOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLnVzZUpzYkF1ZGlvRW5naW5lKCkpIHtcbiAgICAgICAgICAgIHRoaXMuX25hdGl2ZVN0b3BBdWRpbyh0aGlzLl9tdXNpY0lkKTtcbiAgICAgICAgICAgIHRoaXMuX211c2ljSWQgPSAtMTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNjLmF1ZGlvRW5naW5lLnN0b3BNdXNpYygpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHByZWxvYWRFZmZlY3Q6IGZ1bmN0aW9uIChlZmZlY3ROYW1lKSB7XG4gICAgICAgIGlmICh0aGlzLnVzZUpzYkF1ZGlvRW5naW5lKCkpIHtcbiAgICAgICAgICAgIGpzYi5BdWRpb0VuZ2luZS5wcmVsb2FkKGVmZmVjdE5hbWUpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHVubG9hZEVmZmVjdDogZnVuY3Rpb24gKGVmZmVjdE5hbWUpIHtcbiAgICAgICAgaWYgKHRoaXMudXNlSnNiQXVkaW9FbmdpbmUoKSkge1xuICAgICAgICAgICAganNiLkF1ZGlvRW5naW5lLnVuY2FjaGUoZWZmZWN0TmFtZSk7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG52YXIgQUNUSU9OX1RZUEUgPSB7XG4gICAgQUNUSU9OX05VTEw6IDAsXG4gICAgQUNUSU9OX1BBVVNFOiAxLFxuICAgIEFDVElPTl9SRVNVTUU6IDJcbn07XG5cbnZhciBQTEFZX1RZUEUgPSB7XG4gICAgUExBWV9UWVBFX05PUk1BTDogMCxcbiAgICBQTEFZX1RZUEVfRkFERV9PVVRfRkFERV9JTjogMVxufTtcblxudmFyIEF1ZGlvUGxheWVyID0gY2MuQ2xhc3MuZXh0ZW5kKHtcbiAgICBsYXN0TXVzaWNWb2x1bWU6IDAsXG4gICAgc3VmZml4OiBudWxsLFxuICAgIGVmZmVjdE1hcDogbnVsbCxcbiAgICBwbGF5VHlwZTogUExBWV9UWVBFLlBMQVlfVFlQRV9OT1JNQUwsXG4gICAgYWN0aW9uVHlwZTogQUNUSU9OX1RZUEUuQUNUSU9OX05VTEwsXG4gICAgbXVzaWNOYW1lOiBudWxsLFxuICAgIGxvb3A6IGZhbHNlLFxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5vcyA9PT0gY2Muc3lzLk9TX0FORFJPSUQpIHtcbiAgICAgICAgICAgIHRoaXMuc3VmZml4ID0gXCJyZXMvYXVkaW9fb2dnLyVzLm9nZ1wiO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zdWZmaXggPSBcInJlcy9hdWRpb19tcDMvJXMubXAzXCI7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5lZmZlY3RNYXAgPSB7fTtcbiAgICAgICAgdmFyIGlzTXVzaWNPbiA9IHRoaXMuaXNNdXNpY09uKCk7XG4gICAgICAgIHRoaXMubGFzdE11c2ljVm9sdW1lID0gMTtcbiAgICAgICAgdGhpcy5zZXRNdXNpY09uKGlzTXVzaWNPbik7XG4gICAgfSxcblxuICAgIGJlZ2luU2NoZWR1bGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2MuZGlyZWN0b3IuZ2V0U2NoZWR1bGVyKCkuc2NoZWR1bGVDYWxsYmFja0ZvclRhcmdldCh0aGlzLCB0aGlzLnVwZGF0ZSwgMC4xLCBjYy5SRVBFQVRfRk9SRVZFUiwgMCwgZmFsc2UpO1xuICAgIH0sXG5cbiAgICBzdG9wU2NoZWR1bGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2MuZGlyZWN0b3IuZ2V0U2NoZWR1bGVyKCkudW5zY2hlZHVsZUNhbGxiYWNrRm9yVGFyZ2V0KHRoaXMsIHRoaXMudXBkYXRlKTtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbiAoZHQpIHtcbiAgICAgICAgZHQgKj0gMC41O1xuICAgICAgICB2YXIgaXNGaW5pc2ggPSBmYWxzZTtcbiAgICAgICAgdmFyIHZvbHVtZSA9IGNjLmF1ZGlvRW5naW5lLmdldE11c2ljVm9sdW1lKCk7XG4gICAgICAgIGlmICh0aGlzLnBsYXlUeXBlID09IFBMQVlfVFlQRS5QTEFZX1RZUEVfRkFERV9PVVRfRkFERV9JTikge1xuICAgICAgICAgICAgaWYgKHZvbHVtZSA+IDAuMDAxKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aW9uVHlwZSA9PSBBQ1RJT05fVFlQRS5BQ1RJT05fUEFVU0UpIHtcbiAgICAgICAgICAgICAgICAgICAgdm9sdW1lIC09IGR0O1xuICAgICAgICAgICAgICAgICAgICBpZiAodm9sdW1lIDwgMC4wMDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZvbHVtZSA9IDAuMDE7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYXlNdXNpY0J5S2V5KHRoaXMubXVzaWNOYW1lLCB0aGlzLmxvb3ApO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3Rpb25UeXBlID0gQUNUSU9OX1RZUEUuQUNUSU9OX1JFU1VNRTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYy5hdWRpb0VuZ2luZS5zZXRNdXNpY1ZvbHVtZSh2b2x1bWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5hY3Rpb25UeXBlID09IEFDVElPTl9UWVBFLkFDVElPTl9SRVNVTUUpIHtcbiAgICAgICAgICAgICAgICAgICAgdm9sdW1lICs9IGR0O1xuICAgICAgICAgICAgICAgICAgICBpZiAodm9sdW1lID4gMC45OSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm9sdW1lID0gMC45OTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzRmluaXNoID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYy5hdWRpb0VuZ2luZS5zZXRNdXNpY1ZvbHVtZSh2b2x1bWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5TXVzaWNCeUtleSh0aGlzLm11c2ljTmFtZSwgdGhpcy5sb29wKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpc0ZpbmlzaCkge1xuICAgICAgICAgICAgICAgIHRoaXMuYWN0aW9uVHlwZSA9IEFDVElPTl9UWVBFLkFDVElPTl9OVUxMO1xuICAgICAgICAgICAgICAgIHRoaXMucGxheVR5cGUgPSBQTEFZX1RZUEUuUExBWV9UWVBFX05PUk1BTDtcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3BTY2hlZHVsZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHZvbHVtZSA+IDAuMDAxKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aW9uVHlwZSA9PSBBQ1RJT05fVFlQRS5BQ1RJT05fUEFVU0UpIHtcbiAgICAgICAgICAgICAgICAgICAgdm9sdW1lIC09IGR0O1xuICAgICAgICAgICAgICAgICAgICBpZiAodm9sdW1lIDwgMC4wMDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZvbHVtZSA9IDAuMDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBpc0ZpbmlzaCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhdXNlTXVzaWMoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYy5hdWRpb0VuZ2luZS5zZXRNdXNpY1ZvbHVtZSh2b2x1bWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5hY3Rpb25UeXBlID09IEFDVElPTl9UWVBFLkFDVElPTl9SRVNVTUUpIHtcbiAgICAgICAgICAgICAgICAgICAgdm9sdW1lICs9IGR0O1xuICAgICAgICAgICAgICAgICAgICBpZiAodm9sdW1lID4gMC45OSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm9sdW1lID0gMC45OTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzRmluaXNoID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYy5hdWRpb0VuZ2luZS5zZXRNdXNpY1ZvbHVtZSh2b2x1bWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaXNGaW5pc2ggPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzRmluaXNoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hY3Rpb25UeXBlID0gQUNUSU9OX1RZUEUuQUNUSU9OX05VTEw7XG4gICAgICAgICAgICAgICAgdGhpcy5zdG9wU2NoZWR1bGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBwbGF5RWZmZWN0QnlLZXk6IGZ1bmN0aW9uIChlZmZlY3ROYW1lLCBsb29wKSB7XG4gICAgICAgIGlmICghdGhpcy5pc0VmZmVjdE9uKCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgZmlsZU5hbWUgPSBnYW1lLnV0aWxzLnNwcmludGYodGhpcy5zdWZmaXgsIGVmZmVjdE5hbWUpO1xuICAgICAgICB2YXIga2V5ID0gXCJcIjtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAgaWYgKGpzYi5maWxlVXRpbHMuaXNGaWxlRXhpc3QoZmlsZU5hbWUpKSB7XG4gICAgICAgICAgICAgICAga2V5ID0gQXVkaW9FbmdpbmVXcmFwcGVyLnBsYXlFZmZlY3QoZmlsZU5hbWUsIGxvb3ApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjYy5sb2coZ2FtZS51dGlscy5zcHJpbnRmKFwiZWZmZWN0IGZpbGUgJXMgbm90IGZvdW5kXCIsIGZpbGVOYW1lKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoY2MubG9hZGVyLmdldFJlcyhmaWxlTmFtZSkpIHtcbiAgICAgICAgICAgICAgICBrZXkgPSBBdWRpb0VuZ2luZVdyYXBwZXIucGxheUVmZmVjdChmaWxlTmFtZSwgbG9vcCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleSkge1xuICAgICAgICAgICAgdGhpcy5lZmZlY3RNYXBbZmlsZU5hbWVdID0ga2V5O1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHBsYXlNdXNpY0J5S2V5OiBmdW5jdGlvbiAobXVzaWNOYW1lLCBsb29wKSB7XG4gICAgICAgIHRoaXMuYWN0aW9uVHlwZSA9IEFDVElPTl9UWVBFLkFDVElPTl9OVUxMO1xuICAgICAgICB0aGlzLnBsYXlUeXBlID0gUExBWV9UWVBFLlBMQVlfVFlQRV9OT1JNQUw7XG4gICAgICAgIGlmICh0aGlzLmlzTXVzaWNPbigpKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5sYXN0TXVzaWNWb2x1bWUgIT0gMCkge1xuICAgICAgICAgICAgICAgIEF1ZGlvRW5naW5lV3JhcHBlci5zZXRNdXNpY1ZvbHVtZSh0aGlzLmxhc3RNdXNpY1ZvbHVtZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIEF1ZGlvRW5naW5lV3JhcHBlci5zZXRNdXNpY1ZvbHVtZSgxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB2YXIgZmlsZU5hbWUgPSBnYW1lLnV0aWxzLnNwcmludGYodGhpcy5zdWZmaXgsIG11c2ljTmFtZSk7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGlmIChqc2IuZmlsZVV0aWxzLmlzRmlsZUV4aXN0KGZpbGVOYW1lKSkge1xuICAgICAgICAgICAgICAgIEF1ZGlvRW5naW5lV3JhcHBlci5wbGF5TXVzaWMoZmlsZU5hbWUsIGxvb3ApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjYy5sb2coZ2FtZS51dGlscy5zcHJpbnRmKFwibXVzaWMgZmlsZSAlcyBub3QgZm91bmRcIiwgZmlsZU5hbWUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChjYy5sb2FkZXIuZ2V0UmVzKGZpbGVOYW1lKSkge1xuICAgICAgICAgICAgICAgIEF1ZGlvRW5naW5lV3JhcHBlci5wbGF5TXVzaWMoZmlsZU5hbWUsIGxvb3ApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGlzUGxheWluZ011c2ljOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBBdWRpb0VuZ2luZVdyYXBwZXIuaXNNdXNpY1BsYXlpbmcoKTtcbiAgICB9LFxuXG4gICAgcmVzdW1lTXVzaWM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgQXVkaW9FbmdpbmVXcmFwcGVyLnJlc3VtZU11c2ljKCk7XG4gICAgfSxcblxuICAgIHJlc3VtZU11c2ljU2xvd2x5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB2b2x1bWUgPSBBdWRpb0VuZ2luZVdyYXBwZXIuZ2V0TXVzaWNWb2x1bWUoKTtcbiAgICAgICAgaWYgKHZvbHVtZSA8IDAuMDAwMSB8fCB2b2x1bWUgPj0gMC45OSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmFjdGlvblR5cGUgPT0gQUNUSU9OX1RZUEUuQUNUSU9OX05VTEwpIHtcbiAgICAgICAgICAgIHRoaXMuYmVnaW5TY2hlZHVsZSgpO1xuICAgICAgICB9XG4gICAgICAgIEF1ZGlvRW5naW5lV3JhcHBlci5zZXRNdXNpY1ZvbHVtZSgwLjAxKTtcbiAgICAgICAgdGhpcy5yZXN1bWVNdXNpYygpO1xuICAgICAgICB0aGlzLmFjdGlvblR5cGUgPSBBQ1RJT05fVFlQRS5BQ1RJT05fUkVTVU1FO1xuICAgIH0sXG5cbiAgICBzdG9wTXVzaWM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgQXVkaW9FbmdpbmVXcmFwcGVyLnN0b3BNdXNpYygpO1xuICAgIH0sXG5cbiAgICBzdG9wRWZmZWN0OiBmdW5jdGlvbiAoZWZmZWN0TmFtZSkge1xuICAgICAgICB2YXIgZmlsZU5hbWUgPSBnYW1lLnV0aWxzLnNwcmludGYodGhpcy5zdWZmaXgsIGVmZmVjdE5hbWUpO1xuICAgICAgICB2YXIgZWZmZWN0S2V5ID0gdGhpcy5lZmZlY3RNYXBbZmlsZU5hbWVdO1xuICAgICAgICBpZiAoZWZmZWN0S2V5KSB7XG4gICAgICAgICAgICBBdWRpb0VuZ2luZVdyYXBwZXIuc3RvcEVmZmVjdChlZmZlY3RLZXkpO1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMuZWZmZWN0TWFwW2ZpbGVOYW1lXTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzdG9wQWxsRWZmZWN0czogZnVuY3Rpb24gKCkge1xuICAgICAgICBBdWRpb0VuZ2luZVdyYXBwZXIuc3RvcEFsbEVmZmVjdHMoKTtcbiAgICB9LFxuXG4gICAgaXNFZmZlY3RPbjogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaXNPbiA9IGdhbWUuc3RvcmFnZUNvbnRyb2xsZXIuZ2V0SXRlbShcImVmZmVjdF9vblwiLCBcInRydWVcIik7XG4gICAgICAgIGlmIChpc09uID09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIGlzTXVzaWNPbjogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaXNPbiA9IGdhbWUuc3RvcmFnZUNvbnRyb2xsZXIuZ2V0SXRlbShcIm11c2ljX29uXCIsIFwidHJ1ZVwiKTtcbiAgICAgICAgaWYgKGlzT24gPT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgaXNWaWJyYXRlT246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGlzT24gPSBnYW1lLnN0b3JhZ2VDb250cm9sbGVyLmdldEl0ZW0oXCJ2aWJyYXRlX29uXCIsIFwidHJ1ZVwiKTtcbiAgICAgICAgaWYgKGlzT24gPT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgcGF1c2VNdXNpYzogZnVuY3Rpb24gKCkge1xuICAgICAgICBBdWRpb0VuZ2luZVdyYXBwZXIucGF1c2VNdXNpYygpO1xuICAgIH0sXG5cbiAgICBwYXVzZU11c2ljU2xvd2x5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5pc1BsYXlpbmdNdXNpYygpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKEF1ZGlvRW5naW5lV3JhcHBlci5nZXRNdXNpY1ZvbHVtZSgpIDwgMC4wMDAxKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuYWN0aW9uVHlwZSA9PSBBQ1RJT05fVFlQRS5BQ1RJT05fTlVMTCkge1xuICAgICAgICAgICAgdGhpcy5iZWdpblNjaGVkdWxlKCk7XG4gICAgICAgIH1cbiAgICAgICAgLy9BdWRpb0VuZ2luZVdyYXBwZXIuc2V0TXVzaWNWb2x1bWUoMC45OSk7XG4gICAgICAgIHRoaXMuYWN0aW9uVHlwZSA9IEFDVElPTl9UWVBFLkFDVElPTl9QQVVTRTtcbiAgICB9LFxuXG4gICAgcGxheU11c2ljU2xvd2x5QnlLZXk6IGZ1bmN0aW9uIChtdXNpY05hbWUsIGxvb3ApIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzUGxheWluZ011c2ljKCkpIHtcbiAgICAgICAgICAgIHRoaXMucGxheU11c2ljQnlLZXkobXVzaWNOYW1lLCBsb29wKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucGxheVR5cGUgPSBQTEFZX1RZUEUuUExBWV9UWVBFX0ZBREVfT1VUX0ZBREVfSU47XG4gICAgICAgIHRoaXMubXVzaWNOYW1lID0gbXVzaWNOYW1lO1xuICAgICAgICB0aGlzLmxvb3AgPSBsb29wO1xuXG4gICAgICAgIGlmICh0aGlzLmFjdGlvblR5cGUgPT0gQUNUSU9OX1RZUEUuQUNUSU9OX05VTEwpIHtcbiAgICAgICAgICAgIHRoaXMuYmVnaW5TY2hlZHVsZSgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYWN0aW9uVHlwZSA9IEFDVElPTl9UWVBFLkFDVElPTl9QQVVTRTtcbiAgICB9LFxuICAgIFxuICAgIHNldEVmZmVjdE9uOiBmdW5jdGlvbiAoaXNPbikge1xuICAgICAgICBnYW1lLnN0b3JhZ2VDb250cm9sbGVyLnNldEl0ZW0oXCJlZmZlY3Rfb25cIiwgXCJcIiArIGlzT24pO1xuICAgIH0sXG5cbiAgICBzZXRWaWJyYXRlT246IGZ1bmN0aW9uIChpc09uKSB7XG4gICAgICAgIGdhbWUuc3RvcmFnZUNvbnRyb2xsZXIuc2V0SXRlbShcInZpYnJhdGVfb25cIiwgXCJcIiArIGlzT24pO1xuICAgIH0sXG5cbiAgICBzZXRNdXNpY09uOiBmdW5jdGlvbiAoaXNPbikge1xuICAgICAgICBpZiAoaXNPbikge1xuICAgICAgICAgICAgaWYgKHRoaXMubGFzdE11c2ljVm9sdW1lICE9IDApIHtcbiAgICAgICAgICAgICAgICBBdWRpb0VuZ2luZVdyYXBwZXIuc2V0TXVzaWNWb2x1bWUodGhpcy5sYXN0TXVzaWNWb2x1bWUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBBdWRpb0VuZ2luZVdyYXBwZXIuc2V0TXVzaWNWb2x1bWUoMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmxhc3RNdXNpY1ZvbHVtZSA9IEF1ZGlvRW5naW5lV3JhcHBlci5nZXRNdXNpY1ZvbHVtZSgpO1xuICAgICAgICAgICAgQXVkaW9FbmdpbmVXcmFwcGVyLnNldE11c2ljVm9sdW1lKDApO1xuICAgICAgICB9XG4gICAgICAgIGdhbWUuc3RvcmFnZUNvbnRyb2xsZXIuc2V0SXRlbShcIm11c2ljX29uXCIsIFwiXCIgKyBpc09uKTtcbiAgICB9LFxuXG4gICAgc2V0TXVzaWNWb2x1bWU6IGZ1bmN0aW9uICh2b2x1bWUpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNNdXNpY09uKCkpIHtcbiAgICAgICAgICAgIEF1ZGlvRW5naW5lV3JhcHBlci5zZXRNdXNpY1ZvbHVtZSh2b2x1bWUpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHByZWxvYWRFZmZlY3Q6IGZ1bmN0aW9uIChlZmZlY3ROYW1lKSB7XG4gICAgICAgIHZhciBmaWxlTmFtZSA9IGdhbWUudXRpbHMuc3ByaW50Zih0aGlzLnN1ZmZpeCwgZWZmZWN0TmFtZSk7XG4gICAgICAgIGNjLmxvZyhcInByZWxvYWQgZWZmZWN0OlwiICsgZmlsZU5hbWUpO1xuICAgICAgICBBdWRpb0VuZ2luZVdyYXBwZXIucHJlbG9hZEVmZmVjdChmaWxlTmFtZSk7XG4gICAgfSxcblxuICAgIHVubG9hZEVmZmVjdDogZnVuY3Rpb24gKGVmZmVjdE5hbWUpIHtcbiAgICAgICAgdmFyIGZpbGVOYW1lID0gZ2FtZS51dGlscy5zcHJpbnRmKHRoaXMuc3VmZml4LCBlZmZlY3ROYW1lKTtcbiAgICAgICAgY2MubG9nKFwidW5sb2FkIGVmZmVjdDpcIiArIGZpbGVOYW1lKTtcbiAgICAgICAgQXVkaW9FbmdpbmVXcmFwcGVyLnVubG9hZEVmZmVjdChmaWxlTmFtZSk7XG4gICAgfSxcblxuICAgIHZpYnJhdGVTaG9ydDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNWaWJyYXRlT24oKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGlmIChjYy5zeXMub3MgPT09IGNjLnN5cy5PU19BTkRST0lEKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS52aWJyYXRlU2hvcnQoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICB2aWJyYXRlTG9uZzogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNWaWJyYXRlT24oKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGlmIChjYy5zeXMub3MgPT09IGNjLnN5cy5PU19BTkRST0lEKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS52aWJyYXRlTG9uZygpO1xuICAgICAgICB9XG4gICAgfVxufSk7XG5cbkF1ZGlvUGxheWVyLl9pbnN0YW5jZSA9IG51bGw7XG5BdWRpb1BsYXllci5fZmlyc3RVc2VJbnN0YW5jZSA9IHRydWU7XG5cbi8qKlxuICpcbiAqIEByZXR1cm5zIHtBdWRpb1BsYXllcn1cbiAqL1xuQXVkaW9QbGF5ZXIuZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKEF1ZGlvUGxheWVyLl9maXJzdFVzZUluc3RhbmNlKSB7XG4gICAgICAgIEF1ZGlvUGxheWVyLl9maXJzdFVzZUluc3RhbmNlID0gZmFsc2U7XG4gICAgICAgIEF1ZGlvUGxheWVyLl9pbnN0YW5jZSA9IG5ldyBBdWRpb1BsYXllcigpO1xuICAgIH1cbiAgICByZXR1cm4gQXVkaW9QbGF5ZXIuX2luc3RhbmNlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBBdWRpb1BsYXllcjsiLCJ2YXIgR2FtZUJyaWRnZSA9IHtcbiAgICBnZXRNZW51U2NlbmU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIE1lbnVTY2VuZSA9IHJlcXVpcmUoXCIuLi8uLi9tYW55X2JyaWNrcy9zY2VuZS9NZW51U2NlbmVcIik7XG4gICAgICAgIHJldHVybiBuZXcgTWVudVNjZW5lKCk7XG4gICAgfSxcblxuICAgIGdldENvbmZpZzogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gcmVxdWlyZShcIi4uLy4uL21hbnlfYnJpY2tzL2NvbmZpZy9Db25maWdcIik7XG4gICAgfSxcblxuICAgIGdldFBvcHVwTWFuOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiByZXF1aXJlKFwiLi4vLi4vbWFueV9icmlja3MvbW9kZWwvUG9wdXBNYW5cIik7XG4gICAgfSxcblxuICAgIGdldENvbmZpZ01hbjogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gcmVxdWlyZShcIi4uLy4uL21hbnlfYnJpY2tzL2NvbmZpZy9Db25maWdNYW5cIikuZ2V0SW5zdGFuY2UoKTtcbiAgICB9LFxuXG4gICAgZ2V0TG9hZGluZ1NjZW5lOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBMb2FkaW5nU2NlbmUgPSByZXF1aXJlKFwiLi4vLi4vbWFueV9icmlja3Mvc2NlbmUvTG9hZGluZ1NjZW5lXCIpO1xuICAgICAgICByZXR1cm4gbmV3IExvYWRpbmdTY2VuZSgpO1xuICAgIH0sXG5cbiAgICBnZXRHYW1lTWFuOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBHYW1lTWFuID0gcmVxdWlyZShcIi4uLy4uL21hbnlfYnJpY2tzL21vZGVsL0dhbWVNYW5cIik7XG4gICAgICAgIHJldHVybiBHYW1lTWFuLmdldEluc3RhbmNlKCk7XG4gICAgfSxcblxuICAgIGdldEFkc0hlbHBlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgQWRzSGVscGVyID0gcmVxdWlyZShcIi4uLy4uL21hbnlfYnJpY2tzL21vZGVsL0Fkc0hlbHBlclwiKTtcbiAgICAgICAgcmV0dXJuIEFkc0hlbHBlci5nZXRJbnN0YW5jZSgpO1xuICAgIH0sXG5cbiAgICBnZXRDaGFsbGVuZ2VNYW46IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIENoYWxsZW5nZU1hbiA9IHJlcXVpcmUoXCIuLi8uLi9tYW55X2JyaWNrcy9tb2RlbC9DaGFsbGVuZ2VNYW5cIik7XG4gICAgICAgIHJldHVybiBDaGFsbGVuZ2VNYW4uZ2V0SW5zdGFuY2UoKTtcbiAgICB9LFxuXG4gICAgZ2V0QWN0aXZpdHlUYXNrVHlwZTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gcmVxdWlyZShcIi4uLy4uL21hbnlfYnJpY2tzL2VudW0vQWN0aXZpdHlUYXNrVHlwZVwiKTtcbiAgICB9LFxuXG4gICAgZ2V0QWN0aXZpdHlNYW46IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIEFjdGl2aXR5TWFuID0gcmVxdWlyZShcIi4uLy4uL21hbnlfYnJpY2tzL21vZGVsL0FjdGl2aXR5TWFuXCIpO1xuICAgICAgICByZXR1cm4gQWN0aXZpdHlNYW4uZ2V0SW5zdGFuY2UoKTtcbiAgICB9LFxuXG4gICAgZ2V0QUJUZXN0VHlwZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgQUJUZXN0VHlwZSA9IHJlcXVpcmUoXCIuLi8uLi9tYW55X2JyaWNrcy9lbnVtL0FCVGVzdFR5cGVcIik7XG4gICAgICAgIHJldHVybiBBQlRlc3RUeXBlO1xuICAgIH0sXG5cbiAgICBnZXRTdG9yZU1hbjogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgU3RvcmVIZWxwZXIgPSByZXF1aXJlKFwiLi4vLi4vbWFueV9icmlja3MvbW9kZWwvU3RvcmVIZWxwZXJcIik7XG4gICAgICAgIHJldHVybiBTdG9yZUhlbHBlci5nZXRJbnN0YW5jZSgpO1xuICAgIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gR2FtZUJyaWRnZTsiLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAxNS80LzIzLlxuICovXG52YXIgVXRpbHMgPSByZXF1aXJlKFwiLi4vdXRpbC9VdGlsc1wiKTtcblxudmFyIEJhc2VDQ0JDb250cm9sbGVyID0gZnVuY3Rpb24oKSB7XG59O1xuXG5CYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgb2xkT25FbnRlciA9IHRoaXMucm9vdE5vZGVbXCJvbkVudGVyXCJdO1xuICAgIHRoaXMucm9vdE5vZGVbXCJvbkVudGVyXCJdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmKGNjLmlzRnVuY3Rpb24ob2xkT25FbnRlcikpe1xuICAgICAgICAgICAgb2xkT25FbnRlci5hcHBseShzZWxmLnJvb3ROb2RlLCBhcmd1bWVudHMpO1xuICAgICAgICB9XG4gICAgICAgIHNlbGYub25FbnRlcigpO1xuICAgIH07XG4gICAgdmFyIG9sZE9uRXhpdCA9IHRoaXMucm9vdE5vZGVbXCJvbkV4aXRcIl07XG4gICAgdGhpcy5yb290Tm9kZVtcIm9uRXhpdFwiXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoY2MuaXNGdW5jdGlvbihvbGRPbkV4aXQpKSB7XG4gICAgICAgICAgICBvbGRPbkV4aXQuYXBwbHkoc2VsZi5yb290Tm9kZSwgYXJndW1lbnRzKTtcbiAgICAgICAgfVxuICAgICAgICBzZWxmLm9uRXhpdCgpO1xuICAgIH07XG4gICAgdGhpcy5fdmlzaXROb2RlcygpO1xufTtcblxuQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIgPSBmdW5jdGlvbigpIHtcbn07XG5cbkJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQgPSBmdW5jdGlvbigpIHtcbn07XG5cbmZ1bmN0aW9uIHNldFNjYWxlV2l0aFBhcmVudFNpemUobGFiZWwpIHtcbiAgICBjYy5sb2coXCJzZXRTY2FsZVdpdGhQYXJlbnRTaXplXCIpO1xuICAgIHZhciBwYXJlbnQgPSBsYWJlbC5nZXRQYXJlbnQoKTtcbiAgICB2YXIgcGFyZW50U2l6ZSA9IHBhcmVudC5nZXRDb250ZW50U2l6ZSgpO1xuICAgIHZhciBmb250U2l6ZSA9IGxhYmVsLmdldENvbnRlbnRTaXplKCk7XG5cbiAgICBpZiAoIWxhYmVsLl9fb3JpZ2luX3NjYWxlKSB7XG4gICAgICAgIGxhYmVsLl9fb3JpZ2luX3NjYWxlID0ge1xuICAgICAgICAgICAgeDogbGFiZWwuZ2V0U2NhbGVYKCksXG4gICAgICAgICAgICB5OiBsYWJlbC5nZXRTY2FsZVkoKVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHZhciBzaXplID0ge1xuICAgICAgICB3aWR0aCA6IGZvbnRTaXplLndpZHRoICogbGFiZWwuX19vcmlnaW5fc2NhbGUueCxcbiAgICAgICAgaGVpZ2h0IDogZm9udFNpemUuaGVpZ2h0ICogbGFiZWwuX19vcmlnaW5fc2NhbGUueVxuICAgIH07XG5cbiAgICAvLyBhIGNsZWFuIGhhY2tpbmcsIHNhdmUgdXMgdG8gY2FsYyB0aGUgbGFiZWwgaGVpZ2h0IG1hbnVhbGx5LiA6XVxuICAgIC8vIHBhcmVudFNpemUuaGVpZ2h0ICo9IGxhYmVsLl9fb3JpZ2luX3NjYWxlLnk7XG5cbiAgICBpZiAoc2l6ZS53aWR0aCA+IHBhcmVudFNpemUud2lkdGggfHwgc2l6ZS5oZWlnaHQgPiBwYXJlbnRTaXplLmhlaWdodCkge1xuICAgICAgICB2YXIgeCA9IE1hdGgubWluKHBhcmVudFNpemUud2lkdGggLyBzaXplLndpZHRoLCAxKSAqIGxhYmVsLl9fb3JpZ2luX3NjYWxlLng7XG4gICAgICAgIHZhciB5ID0gTWF0aC5taW4ocGFyZW50U2l6ZS5oZWlnaHQgLyBzaXplLmhlaWdodCwgMSkgKiBsYWJlbC5fX29yaWdpbl9zY2FsZS55O1xuXG4gICAgICAgIHZhciBzY2FsZSA9IE1hdGgubWluKHgsIHkpO1xuICAgICAgICBsYWJlbC5zZXRTY2FsZShzY2FsZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy9tYXliZSByZXVzZWQsIHJlc2V0IG9yaWdpbiBzaXplXG4gICAgICAgIGxhYmVsLnNldFNjYWxlKGxhYmVsLl9fb3JpZ2luX3NjYWxlLngpO1xuICAgIH1cbn1cblxuQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLl92aXNpdE5vZGVzID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBUb3VjaGVkTm9kZSA9IHJlcXVpcmUoXCIuLi9leHQvVG91Y2hlZE5vZGVcIik7XG4gICAgVXRpbHMud2Fsa05vZGUodGhpcy5yb290Tm9kZSwgZnVuY3Rpb24obmQpIHtcbiAgICAgICAgaWYgKG5kLl9fX3Zpc2l0ZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIG5kLl9fX3Zpc2l0ZWQgPSB0cnVlO1xuICAgICAgICBpZiAoIWdhbWUuY29uZmlnLm1lbnVOb1NjYWxlKSB7XG4gICAgICAgICAgICB2YXIgaXNNZW51SXRlbSA9IFV0aWxzLmlzTm9kZU1lbnVJdGVtKG5kKTtcbiAgICAgICAgICAgIGlmIChpc01lbnVJdGVtIHx8IChVdGlscy5pc05vZGVCdXR0b24obmQpICYmIG5kLnpvb21PblRvdWNoRG93bikpIHtcbiAgICAgICAgICAgICAgICBpZiAobmQuem9vbU9uVG91Y2hEb3duKSB7XG4gICAgICAgICAgICAgICAgICAgIG5kLnpvb21PblRvdWNoRG93biA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBUb3VjaGVkTm9kZShpc01lbnVJdGVtKTtcbiAgICAgICAgICAgICAgICBuZC5hZGRDaGlsZChub2RlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChuZC5nZXRTdHJpbmcgIT0gbnVsbCAmJiBuZC5zZXRTdHJpbmcgIT0gbnVsbCkge1xuICAgICAgICAgICAgdmFyIHBhcmVudCA9IG5kLmdldFBhcmVudCgpO1xuICAgICAgICAgICAgLy9jYy5sb2coXCJfdmlzaXROb2RlcyB0YWc6XCIgKyBwYXJlbnQuZ2V0VGFnKCkpO1xuICAgICAgICAgICAgaWYgKHBhcmVudCAmJiBwYXJlbnQuZ2V0VGFnKCkgPT09IDc5KSB7XG4gICAgICAgICAgICAgICAgdmFyIGlzQk1Gb250ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgaWYoVXRpbHMuaXNMYWJlbEJNRm9udChuZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaXNCTUZvbnQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvL2NjLmxvZyhcIl92aXNpdE5vZGVzIG5kLl9jbGFzc05hbWU6XCIgKyBuZC5fY2xhc3NOYW1lKTtcbiAgICAgICAgICAgICAgICAvL2NjLmxvZyhcIl92aXNpdE5vZGVzIGlzQk1Gb250OlwiICsgaXNCTUZvbnQpO1xuICAgICAgICAgICAgICAgIGlmKGlzQk1Gb250KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vY2MubG9nKFwiX3Zpc2l0Tm9kZXMgMlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1heWJlIHJlcGVhdCBjYWxsIGluIG9uRW50ZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbmQuX19vcmlnaW5fc2V0c3RyaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmQuX19vcmlnaW5fc2V0c3RyaW5nID0gbmQuc2V0U3RyaW5nO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5kLnNldFN0cmluZyA9IGZ1bmN0aW9uKG5ld1N0cmluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9fb3JpZ2luX3NldHN0cmluZyhuZXdTdHJpbmcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBoZXJlIHdlIHN0YXJ0IHRvIGhhY2tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0U2NhbGVXaXRoUGFyZW50U2l6ZSh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQobmQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmQuc2V0U3RyaW5nID0gZnVuY3Rpb24obmV3U3RyaW5nLCBuZWVkVXBkYXRlTGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBvcmlnaW4gY29kZSBjb3BpZWQgZnJvbSBDQ0xhYmVsQk1Gb250LmpzIHNldFN0cmluZ1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3U3RyaW5nID0gU3RyaW5nKG5ld1N0cmluZyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5lZWRVcGRhdGVMYWJlbCA9PSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZWVkVXBkYXRlTGFiZWwgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdTdHJpbmcgPT0gbnVsbCB8fCAhY2MuaXNTdHJpbmcobmV3U3RyaW5nKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3U3RyaW5nID0gbmV3U3RyaW5nICsgXCJcIjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vdGhpcy5faW5pdGlhbFN0cmluZyA9IG5ld1N0cmluZztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXRTdHJpbmcobmV3U3RyaW5nLCBuZWVkVXBkYXRlTGFiZWwpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaGVyZSB3ZSBzdGFydCB0byBoYWNrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2V0IHRoZSBkaW1lbnNpb24gYWNjb3JkaW5nIHRvIGl0J3MgcGFyZW50IHdobyBoYXMgYSB0YWcgNzlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBuZWVkVXBkYXRlTGFiZWwgPT0gdHJ1ZSwgaXQgcHJldmVudHMgdGhlIGxvb3AgYmVlbiBjYWxsZWQgcmVjdXJzaXZlbHkuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5lZWRVcGRhdGVMYWJlbCA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFNjYWxlV2l0aFBhcmVudFNpemUodGhpcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQobmQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgc3RyID0gbmQuZ2V0U3RyaW5nKCk7XG4gICAgICAgICAgICB2YXIgc2VhcmNoU3RyID0gXCIma2V5LlwiO1xuICAgICAgICAgICAgaWYgKHN0ci5zdWJzdHIoMCwgc2VhcmNoU3RyLmxlbmd0aCkgPT0gc2VhcmNoU3RyKSB7XG4gICAgICAgICAgICAgICAgdmFyIGtleSA9IHN0ci5zdWJzdHIoc2VhcmNoU3RyLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gXyhrZXkpO1xuICAgICAgICAgICAgICAgIG5kLnNldFN0cmluZyh2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9KTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQmFzZUNDQkNvbnRyb2xsZXI7IiwidmFyIEV2ZW50c05hbWUgPSByZXF1aXJlKFwiLi4vLi4vbWFueV9icmlja3MvZXZlbnRzL0V2ZW50c05hbWVcIik7XG5cbnZhciBDcm9zc0Fkc0NvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcblxuICAgIHRoaXMubGJBZHNUaXRsZSA9IG51bGw7XG4gICAgdGhpcy5sYkFkc0NvbnRlbnQgPSBudWxsO1xuICAgIHRoaXMubGJJbnN0YWxsID0gbnVsbDtcblxuICAgIHRoaXMuYnRuQWQgPSBudWxsO1xuXG4gICAgdGhpcy5jb25maWcgPSBudWxsO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhDcm9zc0Fkc0NvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuQ3Jvc3NBZHNDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG59O1xuXG5Dcm9zc0Fkc0NvbnRyb2xsZXIucHJvdG90eXBlLmluaXRXaXRoID0gZnVuY3Rpb24gKGNvbmZpZywgc2l6ZSkge1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgIHRoaXMuc2l6ZSA9IHNpemU7XG4gICAgLy8gdmFyIGxvY2FsUGF0aCA9IGpzYi5maWxlVXRpbHMuZ2V0V3JpdGFibGVQYXRoKCkgKyBcIi9jcm9zcy12aWRlby1cIiArIGNvbmZpZy5pZCArIFwiLm1wNFwiO1xuICAgIC8vIGNjLmxvZyhcIkNyb3NzQWRzQ29udHJvbGxlcjpsb2NhbFBhdGg6XCIgKyBsb2NhbFBhdGgpO1xuICAgIC8vIHZhciB2aWRlbyA9IGdhbWUudXRpbHMuY3JlYXRlVmlkZW9BZChzaXplLCBjYy5wKDAsIDApLCBjYy5wKDAuNSwgMC41KSwgbG9jYWxQYXRoKTtcbiAgICAvLyB0aGlzLnJvb3ROb2RlLmFkZENoaWxkKHZpZGVvKTtcbiAgICAvLyB0aGlzLmxiQWRzVGl0bGUuc2V0U3RyaW5nKGNvbmZpZy5uYW1lKTtcbiAgICAvLyB0aGlzLmxiQWRzQ29udGVudC5zZXRTdHJpbmcoY29uZmlnLmRlc2MpO1xuICAgIC8vIHRoaXMudmlkZW8gPSB2aWRlbztcblxuICAgIHRoaXMucmVmcmVzaCgpO1xufTtcblxuQ3Jvc3NBZHNDb250cm9sbGVyLnByb3RvdHlwZS5yZWZyZXNoID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBsb2NhbFBhdGggPSBqc2IuZmlsZVV0aWxzLmdldFdyaXRhYmxlUGF0aCgpICsgXCIvY3Jvc3MtdmlkZW8tXCIgKyB0aGlzLmNvbmZpZy5pZCArIFwiLm1wNFwiO1xuICAgIGlmICghdGhpcy52aWRlbykge1xuICAgICAgICB0aGlzLnZpZGVvID0gZ2FtZS51dGlscy5jcmVhdGVWaWRlb0FkKHRoaXMuc2l6ZSwgY2MucCgwLCAwKSwgY2MucCgwLjUsIDAuNSksIGxvY2FsUGF0aCk7XG4gICAgICAgIHRoaXMucm9vdE5vZGUuYWRkQ2hpbGQodGhpcy52aWRlbyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGxvY2FsUGF0aCAhPT0gdGhpcy52aWRlby5nZXRVUkwoKSkge1xuICAgICAgICAgICAgdGhpcy52aWRlby5zZXRVUkwobG9jYWxQYXRoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNjLmxvZyhcInVybCBpcyBzYW1lIHdpdGggYmVmb3JlXCIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHRoaXMubGJBZHNUaXRsZS5zZXRTdHJpbmcodGhpcy5jb25maWcubmFtZSk7XG4gICAgdGhpcy5sYkFkc0NvbnRlbnQuc2V0U3RyaW5nKHRoaXMuY29uZmlnLmRlc2MpO1xuICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcIkNyb3NzUHJvbUFkU2hvd1wiLCB7XCJpZFwiOiB0aGlzLmNvbmZpZy5pZH0pO1xufTtcblxuQ3Jvc3NBZHNDb250cm9sbGVyLnByb3RvdHlwZS5vbkFkc0NsaWNrZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiQ3Jvc3NQcm9tQWRDbGlja1wiLCB7XCJpZFwiOiB0aGlzLmNvbmZpZy5pZH0pO1xuICAgIGNjLnN5cy5vcGVuVVJMKHRoaXMuY29uZmlnLmdldERvd25sb2FkVXJsKCkpO1xufTtcblxuQ3Jvc3NBZHNDb250cm9sbGVyLnByb3RvdHlwZS5oaWRlVmlkZW8gPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHRoaXMudmlkZW8pIHtcbiAgICAgICAgdGhpcy52aWRlby52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMudmlkZW8uc3RvcCgpO1xuICAgIH1cbn07XG5cbkNyb3NzQWRzQ29udHJvbGxlci5wcm90b3R5cGUuc2hvd1ZpZGVvID0gZnVuY3Rpb24gKGNvbmZpZykge1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgIHRoaXMucmVmcmVzaCgpO1xuICAgIHRoaXMudmlkZW8udmlzaWJsZSA9IHRydWU7XG4gICAgdGhpcy52aWRlby5zZWVrVG8oMCk7XG4gICAgdGhpcy52aWRlby5wbGF5KCk7XG59O1xuXG5Dcm9zc0Fkc0NvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBub2RlID0gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvbWVudS9jcm9zc19hZHNfdmlldy5jY2JpXCIsIG51bGwsIFwiQ3Jvc3NBZHNDb250cm9sbGVyXCIsIG5ldyBDcm9zc0Fkc0NvbnRyb2xsZXIoKSwgdHJ1ZSk7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IENyb3NzQWRzQ29udHJvbGxlcjsiLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAyMDE3LzgvMjkuXG4gKi9cblxuXG52YXIgQ3Jvc3NQcm9tQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuICAgIHRoaXMuX2Nyb3NzUHJvbVBpYyA9IG51bGw7XG5cbiAgICB0aGlzLl9jb3Jzc1Byb21Db25maWcgPSBudWxsO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhDcm9zc1Byb21Db250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbkNyb3NzUHJvbUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcblxuICAgIGlmICh0aGlzLl9pbmZvTGFiZWwpIHtcbiAgICAgICAgaWYgKGdhbWUubG9jYWwuaXNDaGluZXNlKCkpIHtcbiAgICAgICAgICAgIHRoaXMuX2luZm9MYWJlbC5zZXRTdHJpbmcoXCLpqazkuIrnjqlcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9pbmZvTGFiZWwuc2V0U3RyaW5nKFwiUGxheVwiKTtcbiAgICAgICAgfVxuICAgIH1cbn07XG5cbkNyb3NzUHJvbUNvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB0aGlzLmNsb3NlKCk7XG59O1xuXG5Dcm9zc1Byb21Db250cm9sbGVyLnByb3RvdHlwZS5kb3dubG9hZENsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgY2Muc3lzLm9wZW5VUkwodGhpcy5fY29yc3NQcm9tQ29uZmlnLmRvd25sb2FkVXJsKTtcbiAgICB0aGlzLmNsb3NlKCk7XG59O1xuXG5Dcm9zc1Byb21Db250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aCA9IGZ1bmN0aW9uIChjb25maWcsIHRleHR1cmUpIHtcbiAgICB0aGlzLl9jb3Jzc1Byb21Db25maWcgPSBjb25maWc7XG4gICAgdGhpcy5fY3Jvc3NQcm9tUGljLnNldFRleHR1cmUodGV4dHVyZSk7XG59O1xuXG5Dcm9zc1Byb21Db250cm9sbGVyLnByb3RvdHlwZS5wb3B1cCA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIucG9wdXAodGhpcy5yb290Tm9kZSk7XG59O1xuXG5Dcm9zc1Byb21Db250cm9sbGVyLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIuY2xvc2UodGhpcy5yb290Tm9kZSk7XG59O1xuXG5Dcm9zc1Byb21Db250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbihjY2JOYW1lKSB7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihjY2JOYW1lLCBudWxsLCBcIkNyb3NzUHJvbUNvbnRyb2xsZXJcIiwgbmV3IENyb3NzUHJvbUNvbnRyb2xsZXIoKSk7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IENyb3NzUHJvbUNvbnRyb2xsZXI7IiwiXG52YXIgTnVtYmVyQW5pbWF0aW9uID0gY2MuQ2xhc3MuZXh0ZW5kKHtcbiAgICBhbmltaW5nOiBmYWxzZSxcbiAgICBzdGFydE51bTogMCxcbiAgICBlbmROdW06IDAsXG4gICAgc3RlcDogMCxcbiAgICB0aW1lOiAwLjgsXG4gICAgbGFiZWw6IG51bGwsXG4gICAgZW5kQ2FsbGJhY2s6IG51bGwsXG4gICAgcHJlZml4OiBcIlwiLFxuXG4gICAgY3RvcjogZnVuY3Rpb24gKGxhYmVsLCBwcmVmaXgpIHtcbiAgICAgICAgdGhpcy5sYWJlbCA9IGxhYmVsO1xuICAgICAgICBpZiAocHJlZml4KSB7XG4gICAgICAgICAgICB0aGlzLnByZWZpeCA9IHByZWZpeDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBwbGF5TnVtQW5pbTogZnVuY3Rpb24gKHN0YXJ0TnVtLCBlbmROdW0sIGVuZENhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuYW5pbWluZyA9IHRydWU7XG4gICAgICAgIHRoaXMuc3RhcnROdW0gPSBzdGFydE51bTtcbiAgICAgICAgdGhpcy5lbmROdW0gPSBlbmROdW07XG4gICAgICAgIHRoaXMuZWxhcHNlZFRpbWUgPSAwO1xuICAgICAgICB0aGlzLnN0ZXAgPSAodGhpcy5lbmROdW0gLSB0aGlzLnN0YXJ0TnVtKSAvIHRoaXMudGltZTtcbiAgICAgICAgdGhpcy5lbmRDYWxsYmFjayA9IGVuZENhbGxiYWNrO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uIChkdCkge1xuICAgICAgICBpZiAodGhpcy5hbmltaW5nKSB7XG4gICAgICAgICAgICB0aGlzLmVsYXBzZWRUaW1lICs9IGR0O1xuICAgICAgICAgICAgY2MubG9nKFwibnVtYmVyOlwiICsgKHRoaXMuc3RhcnROdW0gKyB0aGlzLnN0ZXAgKiB0aGlzLmVsYXBzZWRUaW1lKSk7XG4gICAgICAgICAgICB0aGlzLmxhYmVsLnNldFN0cmluZyh0aGlzLnByZWZpeCArIE1hdGguZmxvb3IodGhpcy5zdGFydE51bSArIHRoaXMuc3RlcCAqIHRoaXMuZWxhcHNlZFRpbWUpKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmVsYXBzZWRUaW1lID49IHRoaXMudGltZSkge1xuICAgICAgICAgICAgICAgIHRoaXMubGFiZWwuc2V0U3RyaW5nKHRoaXMucHJlZml4ICsgdGhpcy5lbmROdW0pO1xuICAgICAgICAgICAgICAgIHRoaXMuYW5pbWluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuZW5kQ2FsbGJhY2sgJiYgdGhpcy5lbmRDYWxsYmFjaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGRlc3Ryb3k6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5sYWJlbCA9IG51bGw7XG4gICAgfVxuXG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBOdW1iZXJBbmltYXRpb247IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMjAxNy8xLzIzLlxuICovXG5cbnZhciBQYXltZW50SW5mbyA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMucHVyY2hhc2VJZCA9IG51bGw7XG4gICAgdGhpcy5wcm9kdWN0SWQgPSBudWxsO1xuICAgIHRoaXMucmVjZWlwdCA9IG51bGw7XG4gICAgdGhpcy5zaWduYXR1cmUgPSBudWxsO1xuXG4gICAgdGhpcy5pbmZvID0gXCJcIjtcbn07XG5cblBheW1lbnRJbmZvLnByb3RvdHlwZS51bm1hcnNoYWwgPSBmdW5jdGlvbihqc29uT2JqKSB7XG4gICAgdGhpcy5wdXJjaGFzZUlkID0ganNvbk9ialtcInB1cmNoYXNlSWRcIl0gfHwgXCJcIjtcbiAgICB0aGlzLnByb2R1Y3RJZCA9IGpzb25PYmpbXCJwcm9kdWN0SWRcIl0gfHwgXCJcIjtcbiAgICB0aGlzLnJlY2VpcHQgPSBqc29uT2JqW1wicmVjZWlwdFwiXSB8fCBcIlwiO1xuICAgIHRoaXMuc2lnbmF0dXJlID0ganNvbk9ialtcInNpZ25hdHVyZVwiXSB8fCBcIlwiO1xuICAgIHRoaXMuaW5mbyA9IGpzb25PYmpbXCJpbmZvXCJdIHx8IFwiXCI7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFBheW1lbnRJbmZvOyIsIi8qKlxuICogQ3JlYXRlZCBieSBveWUgb24gMTUtNS0xNy5cbiAqL1xudmFyIFBsYXllckluZm8gPSBmdW5jdGlvbigpe1xuICAgIHRoaXMucGxheWVySWQgPSBcIlwiO1xuICAgIHRoaXMuYmVzdFNjb3JlID0gMDtcbiAgICB0aGlzLnJlbW92ZWRBZHMgPSBmYWxzZTtcbiAgICB0aGlzLmxldmVsID0gMDtcbiAgICB0aGlzLnByb2dyZXNzID0gMDtcbiAgICB0aGlzLmxldmVsTWFwID0gbnVsbDtcbiAgICB0aGlzLnJhdGVkID0gZmFsc2U7XG59O1xuXG5QbGF5ZXJJbmZvLnByb3RvdHlwZS51bm1hcnNoYWxsID0gZnVuY3Rpb24gKGpzb24pIHtcbiAgICB0aGlzLnBsYXllcklkID0ganNvbltcInBsYXllcklkXCJdO1xuICAgIHRoaXMuYmVzdFNjb3JlID0ganNvbltcImJlc3RTY29yZVwiXSB8fCAwO1xuICAgIHRoaXMucmVtb3ZlZEFkcyA9IGpzb25bXCJyZW1vdmVkQWRzXCJdIHx8IGZhbHNlO1xuICAgIHRoaXMubGV2ZWwgPSBqc29uW1wibGV2ZWxcIl0gfHwgMTtcbiAgICB0aGlzLnByb2dyZXNzID0ganNvbltcInByb2dyZXNzXCJdIHx8IDA7XG4gICAgdGhpcy5sZXZlbE1hcCA9IGpzb25bXCJsZXZlbE1hcFwiXSB8fCB7fTtcbiAgICB0aGlzLnJhdGVkID0ganNvbltcInJhdGVkXCJdIHx8IGZhbHNlO1xufTtcblxuUGxheWVySW5mby5jcmVhdGVEZWZhdWx0ID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBwbGF5ZXJJbmZvID0gbmV3IFBsYXllckluZm8oKTtcbiAgICBwbGF5ZXJJbmZvLmhpbnRzQ291bnQgPSA1O1xuICAgIHBsYXllckluZm8uYmVzdFNjb3JlID0gMDtcbiAgICBwbGF5ZXJJbmZvLnJlbW92ZWRBZHMgPSBmYWxzZTtcbiAgICBwbGF5ZXJJbmZvLmxldmVsID0gMTtcbiAgICBwbGF5ZXJJbmZvLnByb2dyZXNzID0gMDtcbiAgICBwbGF5ZXJJbmZvLmxldmVsTWFwID0ge307XG4gICAgcGxheWVySW5mby5yYXRlZCA9IGZhbHNlO1xuICAgIHJldHVybiBwbGF5ZXJJbmZvO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBQbGF5ZXJJbmZvO1xuIiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMjAxNy8xLzIzLlxuICovXG5cbnZhciBQcm9kdWN0SW5mbyA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnByb2R1Y3RJZCA9IDA7XG4gICAgdGhpcy5wcmljZSA9IDA7XG4gICAgdGhpcy5kZXNjcmlwdGlvbiA9IG51bGw7XG4gICAgdGhpcy50aXRsZSA9IG51bGw7XG59O1xuXG5Qcm9kdWN0SW5mby5wcm90b3R5cGUudW5tYXJzaGFsID0gZnVuY3Rpb24gKGpzb25PYmopIHtcbiAgICB0aGlzLnByb2R1Y3RJZCA9IGpzb25PYmpbXCJwcm9kdWN0SWRcIl07XG4gICAgdGhpcy5wcmljZSA9IGpzb25PYmpbXCJwcmljZVwiXTtcbiAgICB0aGlzLmRlc2NyaXB0aW9uID0ganNvbk9ialtcImRlc2NyaXB0aW9uXCJdO1xuICAgIHRoaXMudGl0bGUgPSBqc29uT2JqW1widGl0bGVcIl07XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFByb2R1Y3RJbmZvOyIsInZhciBBZHNQbGFjZSA9IHtcbiAgICBQYXNzOiAxLFxuICAgIEhvbWU6IDIsXG4gICAgQmFja0dyb3VuZDogMyxcbiAgICBSZWZyZXNoOiA0LFxuICAgIEZpcnN0RW50ZXI6IDUsXG4gICAgTnVtOiA1XG59O1xuXG5BZHNQbGFjZS5nZXROYW1lID0gZnVuY3Rpb24gKHBsYWNlKSB7XG4gICAgc3dpdGNoIChwbGFjZSkge1xuICAgICAgICBjYXNlIEFkc1BsYWNlLlBhc3M6XG4gICAgICAgICAgICByZXR1cm4gXCJwYXNzXCI7XG4gICAgICAgIGNhc2UgQWRzUGxhY2UuSG9tZTpcbiAgICAgICAgICAgIHJldHVybiBcImhvbWVcIjtcbiAgICAgICAgY2FzZSBBZHNQbGFjZS5CYWNrR3JvdW5kOlxuICAgICAgICAgICAgcmV0dXJuIFwiYmFja2dyb3VuZFwiO1xuICAgICAgICBjYXNlIEFkc1BsYWNlLlJlZnJlc2g6XG4gICAgICAgICAgICByZXR1cm4gXCJyZWZyZXNoXCI7XG4gICAgICAgIGNhc2UgQWRzUGxhY2UuRmlyc3RFbnRlcjpcbiAgICAgICAgICAgIHJldHVybiBcImZpcnN0X2VudGVyXCI7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gXCJ1bmtub3duXCI7XG4gICAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBBZHNQbGFjZTsiLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAyMDE3LzEvMjMuXG4gKi9cblxudmFyIFBheW1lbnRDb2RlID0ge1xuICAgIFBBWU1FTlRfQ09ERV9TVUNDRVNTOiAwLFxuICAgIFBBWU1FTlRfQ09ERV9GQUlMOiAxXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFBheW1lbnRDb2RlOyIsIi8qKlxuICogQ3JlYXRlZCBieSBhbGFubWFycyBvbiAxNS80LzE3LlxuICovXG52YXIgRXZlbnRQYWNrYWdlID0gY2MuQ2xhc3MuZXh0ZW5kKHtcbiAgICBjYWxsYmFjazogbnVsbCxcbiAgICB0YXJnZXQ6IG51bGwsXG4gICAgbGlzdGVuZXI6IG51bGwsXG5cbiAgICBjdG9yOiBmdW5jdGlvbiAoY2FsbGJhY2ssIHRhcmdldCwgbGlzdGVuZXIpIHtcbiAgICAgICAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgICAgICB0aGlzLnRhcmdldCA9IHRhcmdldDtcbiAgICAgICAgdGhpcy5saXN0ZW5lciA9IGxpc3RlbmVyO1xuICAgIH1cbn0pO1xuXG52YXIgRXZlbnRVc2VyRGF0YSA9IGNjLkNsYXNzLmV4dGVuZCh7XG4gICAgdXNlckRhdGE6IG51bGwsXG5cbiAgICBjdG9yOiBmdW5jdGlvbiAodXNlckRhdGEsIHRhcmdldCwgbGlzdGVuZXIpIHtcbiAgICAgICAgdGhpcy51c2VyRGF0YSA9IHVzZXJEYXRhO1xuICAgIH0sXG5cbiAgICBnZXRVc2VyRGF0YTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnVzZXJEYXRhO1xuICAgIH1cbn0pO1xudmFyIEV2ZW50RGlzcGF0Y2hlciA9IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGluc3RhbmNlO1xuXG4gICAgZnVuY3Rpb24gY3JlYXRlSW5zdGFuY2UoKSB7XG4gICAgICAgIHZhciBsaXN0ZW5lcnNNYXAgPSB7fTtcbiAgICAgICAgdmFyIGxpc3RlbmVyc0N1c3RvbU1hcCA9IHt9O1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gZXZlbnROYW1lXG4gICAgICAgICAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFja1xuICAgICAgICAgICAgICogQHBhcmFtIHtvYmplY3R9IHRhcmdldFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBhZGRFdmVudExpc3RlbmVyOiBmdW5jdGlvbiAoZXZlbnROYW1lLCBjYWxsYmFjaywgdGFyZ2V0KSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgc2hvdWxkQWRkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB2YXIgZXZlbnRQYWNrYWdlcyA9IGxpc3RlbmVyc01hcFtldmVudE5hbWVdO1xuICAgICAgICAgICAgICAgIGlmIChjYy5pc1VuZGVmaW5lZChldmVudFBhY2thZ2VzKSkge1xuICAgICAgICAgICAgICAgICAgICBldmVudFBhY2thZ2VzID0gW107XG4gICAgICAgICAgICAgICAgICAgIGxpc3RlbmVyc01hcFtldmVudE5hbWVdID0gZXZlbnRQYWNrYWdlcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZXZlbnRQYWNrYWdlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGV2ZW50UGFja2FnZSA9IGV2ZW50UGFja2FnZXNbaV07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnRQYWNrYWdlLmNhbGxiYWNrID09PSBjYWxsYmFjayAmJiBldmVudFBhY2thZ2UudGFyZ2V0ID09PSB0YXJnZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG91bGRBZGQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChzaG91bGRBZGQpIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnRQYWNrYWdlcy5wdXNoKG5ldyBFdmVudFBhY2thZ2UoY2FsbGJhY2ssIHRhcmdldCwgbnVsbCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGV2ZW50TmFtZVxuICAgICAgICAgICAgICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2tcbiAgICAgICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSB0YXJnZXRcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcjogZnVuY3Rpb24gKGV2ZW50TmFtZSwgY2FsbGJhY2ssIHRhcmdldCkge1xuICAgICAgICAgICAgICAgIGlmIChsaXN0ZW5lcnNNYXBbZXZlbnROYW1lXSkge1xuICAgICAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgICAgICogQHR5cGUge0FycmF5LjxFdmVudFBhY2thZ2U+fVxuICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgdmFyIGV2ZW50UGFja2FnZXMgPSBsaXN0ZW5lcnNNYXBbZXZlbnROYW1lXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjYy5pc1VuZGVmaW5lZChldmVudFBhY2thZ2VzKSAmJiBldmVudFBhY2thZ2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXdQYWNrYWdlcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBldmVudFBhY2thZ2VzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQHR5cGUge0V2ZW50UGFja2FnZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXZlbnRQYWNrYWdlID0gZXZlbnRQYWNrYWdlc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnRQYWNrYWdlLmNhbGxiYWNrID09PSBjYWxsYmFjayAmJiBldmVudFBhY2thZ2UudGFyZ2V0ID09PSB0YXJnZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jYy5ldmVudE1hbmFnZXIucmVtb3ZlTGlzdGVuZXIoZXZlbnRQYWNrYWdlLmxpc3RlbmVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1BhY2thZ2VzLnB1c2goZXZlbnRQYWNrYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBsaXN0ZW5lcnNNYXBbZXZlbnROYW1lXSA9IG5ld1BhY2thZ2VzO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gZXZlbnROYW1lXG4gICAgICAgICAgICAgKiBAcGFyYW0ge29iamVjdH0gdXNlckRhdGFcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgZGlzcGF0Y2hFdmVudDogZnVuY3Rpb24gKGV2ZW50TmFtZSwgdXNlckRhdGEpIHtcbiAgICAgICAgICAgICAgICBpZiAobGlzdGVuZXJzTWFwW2V2ZW50TmFtZV0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGV2ZW50UGFja2FnZXMgPSBsaXN0ZW5lcnNNYXBbZXZlbnROYW1lXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjYy5pc1VuZGVmaW5lZChldmVudFBhY2thZ2VzKSAmJiBldmVudFBhY2thZ2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBldmVudERhdGEgPSBuZXcgRXZlbnRVc2VyRGF0YSh1c2VyRGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50UGFja2FnZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXZlbnRQYWNrYWdlID0gZXZlbnRQYWNrYWdlc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnRQYWNrYWdlLmNhbGxiYWNrICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRQYWNrYWdlLmNhbGxiYWNrLmNhbGwoZXZlbnRQYWNrYWdlLnRhcmdldCwgZXZlbnREYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudE5hbWVcbiAgICAgICAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrXG4gICAgICAgICAgICAgKiBAcGFyYW0ge29iamVjdH0gdGFyZ2V0XG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGFkZEN1c3RvbUV2ZW50TGlzdGVuZXI6IGZ1bmN0aW9uIChldmVudE5hbWUsIGNhbGxiYWNrLCB0YXJnZXQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZXZlbnRMaXN0ZW5lciA9IGNjLmV2ZW50TWFuYWdlci5hZGRDdXN0b21MaXN0ZW5lcihldmVudE5hbWUsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5jYWxsKHRhcmdldCwgZXZlbnQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIHNob3VsZEFkZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdmFyIGV2ZW50UGFja2FnZXMgPSBsaXN0ZW5lcnNDdXN0b21NYXBbZXZlbnROYW1lXTtcbiAgICAgICAgICAgICAgICBpZiAoY2MuaXNVbmRlZmluZWQoZXZlbnRQYWNrYWdlcykpIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnRQYWNrYWdlcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBsaXN0ZW5lcnNDdXN0b21NYXBbZXZlbnROYW1lXSA9IGV2ZW50UGFja2FnZXM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50UGFja2FnZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBldmVudFBhY2thZ2UgPSBldmVudFBhY2thZ2VzW2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50UGFja2FnZS5jYWxsYmFjayA9PT0gY2FsbGJhY2sgJiYgZXZlbnRQYWNrYWdlLnRhcmdldCA9PT0gdGFyZ2V0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvdWxkQWRkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoc2hvdWxkQWRkKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50UGFja2FnZXMucHVzaChuZXcgRXZlbnRQYWNrYWdlKGNhbGxiYWNrLCB0YXJnZXQsIGV2ZW50TGlzdGVuZXIpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudE5hbWVcbiAgICAgICAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrXG4gICAgICAgICAgICAgKiBAcGFyYW0ge29iamVjdH0gdGFyZ2V0XG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHJlbW92ZUN1c3RvbUV2ZW50TGlzdGVuZXI6IGZ1bmN0aW9uIChldmVudE5hbWUsIGNhbGxiYWNrLCB0YXJnZXQpIHtcbiAgICAgICAgICAgICAgICBpZiAobGlzdGVuZXJzQ3VzdG9tTWFwW2V2ZW50TmFtZV0pIHtcbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAqIEB0eXBlIHtBcnJheS48RXZlbnRQYWNrYWdlPn1cbiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgIHZhciBldmVudFBhY2thZ2VzID0gbGlzdGVuZXJzQ3VzdG9tTWFwW2V2ZW50TmFtZV07XG4gICAgICAgICAgICAgICAgICAgIGlmICghY2MuaXNVbmRlZmluZWQoZXZlbnRQYWNrYWdlcykgJiYgZXZlbnRQYWNrYWdlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmV3UGFja2FnZXMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZXZlbnRQYWNrYWdlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIEB0eXBlIHtFdmVudFBhY2thZ2V9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGV2ZW50UGFja2FnZSA9IGV2ZW50UGFja2FnZXNbaV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50UGFja2FnZS5jYWxsYmFjayA9PT0gY2FsbGJhY2sgJiYgZXZlbnRQYWNrYWdlLnRhcmdldCA9PT0gdGFyZ2V0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNjLmV2ZW50TWFuYWdlci5yZW1vdmVMaXN0ZW5lcihldmVudFBhY2thZ2UubGlzdGVuZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3UGFja2FnZXMucHVzaChldmVudFBhY2thZ2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RlbmVyc0N1c3RvbU1hcFtldmVudE5hbWVdID0gbmV3UGFja2FnZXM7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudE5hbWVcbiAgICAgICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSB1c2VyRGF0YVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBkaXNwYXRjaEN1c3RvbUV2ZW50OiBmdW5jdGlvbiAoZXZlbnROYW1lLCB1c2VyRGF0YSkge1xuICAgICAgICAgICAgICAgIGNjLmV2ZW50TWFuYWdlci5kaXNwYXRjaEN1c3RvbUV2ZW50KGV2ZW50TmFtZSwgdXNlckRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIGdldEluc3RhbmNlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoIWluc3RhbmNlKSB7XG4gICAgICAgICAgICAgICAgaW5zdGFuY2UgPSBjcmVhdGVJbnN0YW5jZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGluc3RhbmNlO1xuICAgICAgICB9XG4gICAgfTtcbn0pKCk7XG5cbm1vZHVsZS5leHBvcnRzID0gRXZlbnREaXNwYXRjaGVyOyIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDE1LzcvMi5cbiAqL1xuY2MuVEFCTEVWSUVXX0ZJTExfTEVGVF9SSUdIVCA9IDA7XG5jYy5UQUJMRVZJRVdfRklMTF9SSUdIVF9MRUZUID0gMDtcblxuLyoqXG4gKiBTb2xlIHB1cnBvc2Ugb2YgdGhpcyBkZWxlZ2F0ZSBpcyB0byBzaW5nbGUgdG91Y2ggZXZlbnQgaW4gdGhpcyB2ZXJzaW9uLlxuICovXG5jYy5NdWx0aUNvbFRhYmxlVmlld0RlbGVnYXRlID0gY2MuQ2xhc3MuZXh0ZW5kKC8qKiBAbGVuZHMgY2MuTXVsdGlDb2xUYWJsZVZpZXdEZWxlZ2F0ZSMgKi97XG4gICAgZ3JpZFRvdWNoZWQ6ZnVuY3Rpb24odGFibGUsZ3JpZCl7XG4gICAgfVxufSk7XG5cbi8qKlxuICogRGF0YSBzb3VyY2UgdGhhdCBnb3Zlcm5zIHRhYmxlIGJhY2tlbmQgZGF0YS5cbiAqL1xuY2MuTXVsdGlDb2xUYWJsZVZpZXdEYXRhU291cmNlID0gY2MuQ2xhc3MuZXh0ZW5kKC8qKiBAbGVuZHMgY2MuVGFibGVWaWV3RGF0YVNvdXJjZSMgKi97XG4gICAgZ3JpZEF0SW5kZXg6ZnVuY3Rpb24odGFibGUsaWR4KXtcbiAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9LFxuICAgIG51bWJlck9mQ2VsbHNJblRhYmxlVmlldzpmdW5jdGlvbih0YWJsZSl7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH0sXG4gICAgbnVtYmVyT2ZHcmlkc0luQ2VsbDpmdW5jdGlvbih0YWJsZSwgaWR4KXtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfSxcbiAgICBncmlkU2l6ZUZvclRhYmxlOmZ1bmN0aW9uKHRhYmxlLCBpZHgpe1xuICAgICAgICByZXR1cm4gY2Muc2l6ZSgwLDApO1xuICAgIH1cbn0pO1xuXG5jYy5NdWx0aUNvbFRhYmxlVmlldyA9IGNjLkxheWVyQ29sb3IuZXh0ZW5kKHtcbiAgICBfbXVsdGlUYWJsZVZpZXdEYXRhU291cmNlOiBudWxsLFxuICAgIF9tdWx0aVRhYmxlVmlld0RlbGVnYXRlOiBudWxsLFxuICAgIF9ob3Jpem9udGFsT3JkZXI6IGNjLlRBQkxFVklFV19GSUxMX0xFRlRfUklHSFQsXG4gICAgX2dyaWRzRnJlZWQ6IG51bGwsXG4gICAgX2N1clRvdWNoTG9jYXRpb246IG51bGwsXG5cbiAgICBfdGFibGVWaWV3OiBudWxsLFxuICAgIF90b3VjaE5vZGU6IG51bGwsXG4gICAgX2dyaWRDZWxsczogbnVsbCxcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSBkYXRhU291cmNlXG4gICAgICogQHBhcmFtIHtjYy5TaXplfSBzaXplXG4gICAgICogQHBhcmFtIGNvbnRhaW5lclxuICAgICAqL1xuICAgIGN0b3I6IGZ1bmN0aW9uIChkYXRhU291cmNlLCBzaXplLCBjb250YWluZXIpIHtcbiAgICAgICAgdGhpcy5fc3VwZXIoY2MuY29sb3IoMCwgMCwgMjU1LCAwKSwgc2l6ZS53aWR0aCwgc2l6ZS5oZWlnaHQpO1xuICAgICAgICB0aGlzLl9ncmlkc0ZyZWVkID0gW107XG4gICAgICAgIHRoaXMuX2dyaWRDZWxscyA9IHt9O1xuICAgICAgICB0aGlzLnNldE11bHRpVGFibGVWaWV3RGF0YVNvdXJjZShkYXRhU291cmNlKTtcbiAgICAgICAgdGhpcy5fdGFibGVWaWV3ID0gbmV3IGNjLlRhYmxlVmlldyh0aGlzLCBzaXplLCBjb250YWluZXIpO1xuICAgICAgICB0aGlzLl90YWJsZVZpZXcuc2V0RGVsZWdhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuYWRkQ2hpbGQodGhpcy5fdGFibGVWaWV3KTtcbiAgICAgICAgdGhpcy5fdG91Y2hOb2RlID0gbmV3IGNjLk5vZGUoKTtcbiAgICAgICAgdGhpcy5fdGFibGVWaWV3LmFkZENoaWxkKHRoaXMuX3RvdWNoTm9kZSwxKTtcbiAgICB9LFxuXG4gICAgb25FbnRlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgICAgICBjYy5ldmVudE1hbmFnZXIuYWRkTGlzdGVuZXIoe1xuICAgICAgICAgICAgZXZlbnQ6IGNjLkV2ZW50TGlzdGVuZXIuVE9VQ0hfT05FX0JZX09ORSxcbiAgICAgICAgICAgIHN3YWxsb3dUb3VjaGVzOiBmYWxzZSxcbiAgICAgICAgICAgIG9uVG91Y2hCZWdhbjogdGhpcy5vblRvdWNoQmVnYW4uYmluZCh0aGlzKVxuICAgICAgICB9LCB0aGlzLl90b3VjaE5vZGUpO1xuICAgIH0sXG5cbiAgICBkZXF1ZXVlR3JpZDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fZ3JpZHNGcmVlZC5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgZ3JpZCA9IHRoaXMuX2dyaWRzRnJlZWQuc2hpZnQoKTtcbiAgICAgICAgICAgIHRoaXMuX2F1dG9SZWxlYXNlKGdyaWQpO1xuICAgICAgICAgICAgcmV0dXJuIGdyaWQ7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgX3JlbGVhc2VDQjogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnJlbGVhc2UoKTtcbiAgICB9LFxuXG4gICAgX2F1dG9SZWxlYXNlOiBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgIHZhciBydW5uaW5nID0gb2JqLl9ydW5uaW5nID09PSB1bmRlZmluZWQgPyBmYWxzZSA6ICFvYmouX3J1bm5pbmc7XG4gICAgICAgIGNjLmRpcmVjdG9yLmdldFNjaGVkdWxlcigpLnNjaGVkdWxlKHRoaXMuX3JlbGVhc2VDQiwgb2JqLCAwLCAwLCAwLCBydW5uaW5nLCBvYmouX19pbnN0YW5jZUlkKTtcbiAgICB9LFxuXG4gICAgdGFibGVDZWxsU2l6ZUZvckluZGV4OiBmdW5jdGlvbiAodGFibGUsIGlkeCkge1xuICAgICAgICB2YXIgc2l6ZSA9IHRoaXMuZ2V0TXVsdGlUYWJsZVZpZXdEYXRhU291cmNlKCkuZ3JpZFNpemVGb3JUYWJsZSh0aGlzLCBpZHgpO1xuICAgICAgICBpZiAodGFibGUuZ2V0RGlyZWN0aW9uKCkgPT09IGNjLlNDUk9MTFZJRVdfRElSRUNUSU9OX0hPUklaT05UQUwpIHtcbiAgICAgICAgICAgIHNpemUuaGVpZ2h0ICo9IHRoaXMuZ2V0TXVsdGlUYWJsZVZpZXdEYXRhU291cmNlKCkubnVtYmVyT2ZHcmlkc0luQ2VsbCh0aGlzLCBpZHgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2l6ZS53aWR0aCAqPSB0aGlzLmdldE11bHRpVGFibGVWaWV3RGF0YVNvdXJjZSgpLm51bWJlck9mR3JpZHNJbkNlbGwodGhpcywgaWR4KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc2l6ZTtcbiAgICB9LFxuXG4gICAgdGFibGVDZWxsQXRJbmRleDogZnVuY3Rpb24gKHRhYmxlLCBpZHgpIHtcbiAgICAgICAgdmFyIGdyaWQ7XG4gICAgICAgIHZhciBudW1iZXJPZkdyaWRzSW5DZWxsID0gdGhpcy5nZXRNdWx0aVRhYmxlVmlld0RhdGFTb3VyY2UoKS5udW1iZXJPZkdyaWRzSW5DZWxsKHRoaXMsIGlkeCk7XG4gICAgICAgIHZhciBjZWxsID0gdGFibGUuZGVxdWV1ZUNlbGwoKTtcbiAgICAgICAgaWYgKCFjZWxsKSB7XG4gICAgICAgICAgICBjZWxsID0gbmV3IGNjLlRhYmxlVmlld0NlbGwoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBjaGlsZHJlbiA9IGNlbGwuZ2V0Q2hpbGRyZW4oKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSBjaGlsZHJlbi5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICAgICAgICAgIGdyaWQgPSBjaGlsZHJlbltpXTtcbiAgICAgICAgICAgICAgICB0aGlzLl9ncmlkc0ZyZWVkLnB1c2goZ3JpZCk7XG4gICAgICAgICAgICAgICAgZ3JpZC5zZXRJZHgoY2MuSU5WQUxJRF9JTkRFWCk7XG4gICAgICAgICAgICAgICAgZ3JpZC5yZXRhaW4oKTtcbiAgICAgICAgICAgICAgICBncmlkLnJlbW92ZUZyb21QYXJlbnQoZmFsc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHZhciBzdGFydEluZGV4ID0gMDtcbiAgICAgICAgZm9yICh2YXIgbG9jYWxJZHggPSAwOyBsb2NhbElkeCA8IGlkeDsgKytsb2NhbElkeCkge1xuICAgICAgICAgICAgc3RhcnRJbmRleCArPSB0aGlzLmdldE11bHRpVGFibGVWaWV3RGF0YVNvdXJjZSgpLm51bWJlck9mR3JpZHNJbkNlbGwodGhpcywgbG9jYWxJZHgpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBncmlkU2l6ZSA9IHRoaXMuZ2V0TXVsdGlUYWJsZVZpZXdEYXRhU291cmNlKCkuZ3JpZFNpemVGb3JUYWJsZSh0aGlzLCBpZHgpO1xuICAgICAgICBmb3IgKHZhciBncmlkSWR4ID0gc3RhcnRJbmRleCwgY29sSWR4ID0gMDsgZ3JpZElkeCA8IChudW1iZXJPZkdyaWRzSW5DZWxsICsgc3RhcnRJbmRleCk7IGdyaWRJZHgrKywgY29sSWR4KyspIHtcbiAgICAgICAgICAgIGdyaWQgPSB0aGlzLmdldE11bHRpVGFibGVWaWV3RGF0YVNvdXJjZSgpLmdyaWRBdEluZGV4KHRoaXMsIGdyaWRJZHgpO1xuICAgICAgICAgICAgaWYgKGdyaWQpIHtcbiAgICAgICAgICAgICAgICBncmlkLnNldElkeChncmlkSWR4KTtcbiAgICAgICAgICAgICAgICB0aGlzLl9ncmlkQ2VsbHNbZ3JpZElkeF0gPSBncmlkO1xuICAgICAgICAgICAgICAgIGdyaWQuc2V0QW5jaG9yUG9pbnQoY2MucCgwLCAwKSk7XG4gICAgICAgICAgICAgICAgaWYgKHRhYmxlLmdldERpcmVjdGlvbigpID09PSBjYy5TQ1JPTExWSUVXX0RJUkVDVElPTl9IT1JJWk9OVEFMKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0YWJsZS5nZXRWZXJ0aWNhbEZpbGxPcmRlcigpID09PSBjYy5UQUJMRVZJRVdfRklMTF9UT1BET1dOKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBncmlkLnNldFBvc2l0aW9uKGNjLnAoMCwgZ3JpZFNpemUuaGVpZ2h0ICogKG51bWJlck9mR3JpZHNJbkNlbGwgLSBjb2xJZHggLSAxKSkpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZC5zZXRQb3NpdGlvbihjYy5wKDAsIGdyaWRTaXplLmhlaWdodCAqIGNvbElkeCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZ3JpZC5zZXRQb3NpdGlvbihjYy5wKGdyaWRTaXplLndpZHRoICogY29sSWR4LCAwKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNlbGwuYWRkQ2hpbGQoZ3JpZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNlbGw7XG4gICAgfSxcblxuICAgIG51bWJlck9mQ2VsbHNJblRhYmxlVmlldzogZnVuY3Rpb24gKHRhYmxlKSB7XG4gICAgICAgIHZhciBudW1iZXJPZkNlbGxzID0gdGhpcy5nZXRNdWx0aVRhYmxlVmlld0RhdGFTb3VyY2UoKS5udW1iZXJPZkNlbGxzSW5UYWJsZVZpZXcodGhpcyk7XG4gICAgICAgIHJldHVybiBudW1iZXJPZkNlbGxzO1xuICAgIH0sXG5cbiAgICB0YWJsZUNlbGxUb3VjaGVkOiBmdW5jdGlvbiAodGFibGUsIGNlbGwpIHtcbiAgICAgICAgaWYgKCF0aGlzLmdldE11bHRpVGFibGVWaWV3RGVsZWdhdGUoKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2VsbC5nZXRDaGlsZHJlbigpLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgZ3JpZCA9IGNlbGwuZ2V0Q2hpbGRyZW4oKVtpXTtcbiAgICAgICAgICAgIGdyaWQuc2V0Q29udGVudFNpemUodGhpcy5nZXRNdWx0aVRhYmxlVmlld0RhdGFTb3VyY2UoKS5ncmlkU2l6ZUZvclRhYmxlKHRoaXMsIGNlbGwuZ2V0SWR4KCkpKTtcbiAgICAgICAgICAgIGlmIChncmlkICE9IG51bGwgJiYgdGhpcy5pc1RvdWNoSW5zaWRlKGdyaWQsIHRoaXMuX2N1clRvdWNoTG9jYXRpb24pKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRNdWx0aVRhYmxlVmlld0RlbGVnYXRlKCkuZ3JpZFRvdWNoZWQodGhpcywgZ3JpZCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2Nyb2xsVmlld0RpZFNjcm9sbDogZnVuY3Rpb24gKHZpZXcpIHtcbiAgICAgICAgaWYgKHRoaXMuX211bHRpVGFibGVWaWV3RGVsZWdhdGUgJiYgdGhpcy5fbXVsdGlUYWJsZVZpZXdEZWxlZ2F0ZS5zY3JvbGxWaWV3RGlkU2Nyb2xsKSB7XG4gICAgICAgICAgICB0aGlzLl9tdWx0aVRhYmxlVmlld0RlbGVnYXRlLnNjcm9sbFZpZXdEaWRTY3JvbGwodGhpcyk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgdGFibGVDZWxsV2lsbFJlY3ljbGU6IGZ1bmN0aW9uICh0YWJsZSwgY2VsbCkge1xuICAgIH0sXG5cbiAgICB0YWJsZUNlbGxIaWdobGlnaHQ6ZnVuY3Rpb24odGFibGUsIGNlbGwpe1xuICAgIH0sXG5cbiAgICB0YWJsZUNlbGxVbmhpZ2hsaWdodDpmdW5jdGlvbih0YWJsZSwgY2VsbCl7XG4gICAgfSxcblxuICAgIG9uVG91Y2hCZWdhbjogZnVuY3Rpb24gKHRvdWNoLCBldmVudCkge1xuICAgICAgICB0aGlzLl9jdXJUb3VjaExvY2F0aW9uID0gdG91Y2guZ2V0TG9jYXRpb24oKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICBnZXRNdWx0aVRhYmxlVmlld0RhdGFTb3VyY2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX211bHRpVGFibGVWaWV3RGF0YVNvdXJjZTtcbiAgICB9LFxuICAgIHNldE11bHRpVGFibGVWaWV3RGF0YVNvdXJjZTogZnVuY3Rpb24gKGRhdGFTb3VyY2UpIHtcbiAgICAgICAgdGhpcy5fbXVsdGlUYWJsZVZpZXdEYXRhU291cmNlID0gZGF0YVNvdXJjZTtcbiAgICB9LFxuXG4gICAgZ2V0TXVsdGlUYWJsZVZpZXdEZWxlZ2F0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbXVsdGlUYWJsZVZpZXdEZWxlZ2F0ZTtcbiAgICB9LFxuXG4gICAgc2V0TXVsdGlUYWJsZVZpZXdEZWxlZ2F0ZTogZnVuY3Rpb24gKGRlbGVnYXRlKSB7XG4gICAgICAgIHRoaXMuX211bHRpVGFibGVWaWV3RGVsZWdhdGUgPSBkZWxlZ2F0ZTtcbiAgICB9LFxuXG4gICAgc2V0SG9yaXpvbnRhbE9yZGVyOiBmdW5jdGlvbiAob3JkZXIpIHtcbiAgICAgICAgdGhpcy5faG9yaXpvbnRhbE9yZGVyID0gb3JkZXI7XG4gICAgfSxcbiAgICBnZXRIb3Jpem9udGFsT3JkZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2hvcml6b250YWxPcmRlcjtcbiAgICB9LFxuXG4gICAgaXNUb3VjaEluc2lkZTogZnVuY3Rpb24gKG93bmVyLCB0b3VjaExvY2F0aW9uKSB7XG4gICAgICAgIGlmICghb3duZXIgfHwgIW93bmVyLmdldFBhcmVudCgpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdG91Y2hMb2NhdGlvbiA9IG93bmVyLmdldFBhcmVudCgpLmNvbnZlcnRUb05vZGVTcGFjZSh0b3VjaExvY2F0aW9uKTtcbiAgICAgICAgcmV0dXJuIGNjLnJlY3RDb250YWluc1BvaW50KG93bmVyLmdldEJvdW5kaW5nQm94KCksIHRvdWNoTG9jYXRpb24pO1xuICAgIH0sXG5cbiAgICByZWxvYWREYXRhOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5yZWxvYWREYXRhKCk7XG4gICAgfSxcblxuICAgIHNldENvbnRlbnRPZmZzZXQ6IGZ1bmN0aW9uIChvZmZzZXQsIGFuaW1hdGVkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90YWJsZVZpZXcuc2V0Q29udGVudE9mZnNldChvZmZzZXQsIGFuaW1hdGVkKTtcbiAgICB9LFxuXG4gICAgZ2V0Q29udGVudE9mZnNldDpmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90YWJsZVZpZXcuZ2V0Q29udGVudE9mZnNldCgpO1xuICAgIH0sXG5cbiAgICBtaW5Db250YWluZXJPZmZzZXQ6ZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdGFibGVWaWV3Lm1pbkNvbnRhaW5lck9mZnNldCgpO1xuICAgIH0sXG5cbiAgICBtYXhDb250YWluZXJPZmZzZXQ6ZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdGFibGVWaWV3Lm1heENvbnRhaW5lck9mZnNldCgpO1xuICAgIH0sXG5cbiAgICBzZXREaXJlY3Rpb246ZnVuY3Rpb24gKGRpcmVjdGlvbikge1xuICAgICAgICB0aGlzLl90YWJsZVZpZXcuc2V0RGlyZWN0aW9uKGRpcmVjdGlvbik7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIGRldGVybWluZXMgaG93IGNlbGwgaXMgb3JkZXJlZCBhbmQgZmlsbGVkIGluIHRoZSB2aWV3LlxuICAgICAqL1xuICAgIHNldFZlcnRpY2FsRmlsbE9yZGVyOiBmdW5jdGlvbiAoZmlsbE9yZGVyKSB7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5zZXRWZXJ0aWNhbEZpbGxPcmRlcihmaWxsT3JkZXIpO1xuICAgIH0sXG5cbiAgICBzZXRDb250ZW50T2Zmc2V0SW5EdXJhdGlvbjogZnVuY3Rpb24gKG9mZnNldCwgZHQpIHtcbiAgICAgICAgdGhpcy5fdGFibGVWaWV3LnNldENvbnRlbnRPZmZzZXRJbkR1cmF0aW9uKG9mZnNldCwgZHQpO1xuICAgIH0sXG5cbiAgICBnZXRWaWV3U2l6ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdGFibGVWaWV3LmdldFZpZXdTaXplKCk7XG4gICAgfSxcblxuICAgIGdldENvbnRlbnRTaXplOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90YWJsZVZpZXcuZ2V0Q29udGVudFNpemUoKTtcbiAgICB9LFxuXG4gICAgZ2V0R3JpZEF0SW5kZXg6ZnVuY3Rpb24gKGlkeCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZ3JpZENlbGxzW2lkeF07XG4gICAgfSxcblxuICAgIHNldFZpZXdTaXplOiBmdW5jdGlvbiAodmlld1NpemUpIHtcbiAgICAgICAgdGhpcy5zZXRDb250ZW50U2l6ZSh2aWV3U2l6ZSk7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5zZXRWaWV3U2l6ZSh2aWV3U2l6ZSk7XG4gICAgfSxcblxuICAgIHNldEJvdW5jZWFibGU6IGZ1bmN0aW9uIChib3VuY2VhYmxlKSB7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5zZXRCb3VuY2VhYmxlKGJvdW5jZWFibGUpO1xuICAgIH0sXG5cbiAgICBzZXRUb3VjaEVuYWJsZWQ6IGZ1bmN0aW9uICh0b3VjaGFibGUpIHtcbiAgICAgICAgdGhpcy5fdGFibGVWaWV3LnNldFRvdWNoRW5hYmxlZCh0b3VjaGFibGUpO1xuICAgIH0sXG5cbiAgICBpc0RyYWdnaW5nOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90YWJsZVZpZXcuaXNEcmFnZ2luZygpO1xuICAgIH0sXG5cbiAgICBnZXRDb250YWluZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RhYmxlVmlldy5nZXRDb250YWluZXIoKTtcbiAgICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBjYy5NdWx0aUNvbFRhYmxlVmlldzsiLCIvKipcbiAqIENyZWF0ZWQgYnkgemhhbmdtaW5neHUgb24gMjkvMTEvMjAxNi5cbiAqL1xuXG52YXIgVG91Y2hlZE5vZGUgPSBjYy5Ob2RlLmV4dGVuZCh7XG4gICAgb2Zmc2V0WDogMTAsXG4gICAgb2Zmc2V0WTogNSxcblxuICAgIGN0b3I6IGZ1bmN0aW9uIChpc01lbnVJdGVtKSB7XG4gICAgICAgIHRoaXMuX2lzTWVudUl0ZW0gPSBpc01lbnVJdGVtO1xuICAgICAgICB0aGlzLl9pc1RvdWNoZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5faXNIb3ZlciA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9pc0hvdmVyUGxheWluZyA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMuX2J1dHRvblRvdWNoZXIgPSBudWxsO1xuICAgICAgICB0aGlzLl9idXR0b25Nb3VzZXIgPSBudWxsO1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgICAgICB0aGlzLl9uYW1lID0gXCJUb3VjaGVkTm9kZVwiO1xuICAgIH0sXG5cbiAgICBvbkVudGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG5cbiAgICAgICAgLy8vVG91Y2ggRXZlbnRzXG4gICAgICAgIHRoaXMuX2J1dHRvblRvdWNoZXIgPSBjYy5FdmVudExpc3RlbmVyLmNyZWF0ZSh7XG4gICAgICAgICAgICBldmVudDogY2MuRXZlbnRMaXN0ZW5lci5UT1VDSF9PTkVfQllfT05FLFxuICAgICAgICAgICAgc3dhbGxvd1RvdWNoZXM6IGZhbHNlLFxuICAgICAgICAgICAgb25Ub3VjaEJlZ2FuOiB0aGlzLm9uVG91Y2hCZWdhbi5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgb25Ub3VjaE1vdmVkOiB0aGlzLm9uVG91Y2hNb3ZlZC5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgb25Ub3VjaEVuZGVkOiB0aGlzLm9uVG91Y2hFbmRlZC5iaW5kKHRoaXMpXG4gICAgICAgIH0sIHRoaXMpO1xuICAgICAgICBjYy5ldmVudE1hbmFnZXIuYWRkTGlzdGVuZXIodGhpcy5fYnV0dG9uVG91Y2hlciwgdGhpcyk7XG5cbiAgICAgICAgLy8vTW91c2UgRXZlbnRzXG4gICAgICAgIGlmKCEgY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICB0aGlzLl9idXR0b25Nb3VzZXIgPSBjYy5FdmVudExpc3RlbmVyLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgZXZlbnQ6IGNjLkV2ZW50TGlzdGVuZXIuTU9VU0UsXG4gICAgICAgICAgICAgICAgc3dhbGxvd1RvdWNoZXM6IHRydWUsXG4gICAgICAgICAgICAgICAgb25Nb3VzZU1vdmU6IHRoaXMub25Nb3VzZU1vdmUuYmluZCh0aGlzKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjYy5ldmVudE1hbmFnZXIuYWRkTGlzdGVuZXIodGhpcy5fYnV0dG9uTW91c2VyLCB0aGlzKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvbkV4aXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZih0aGlzLl9idXR0b25Ub3VjaGVyKSB7XG4gICAgICAgICAgICBjYy5ldmVudE1hbmFnZXIucmVtb3ZlTGlzdGVuZXIodGhpcy5fYnV0dG9uVG91Y2hlcik7XG4gICAgICAgICAgICB0aGlzLl9idXR0b25Ub3VjaGVyID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZighIGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAgaWYodGhpcy5fYnV0dG9uTW91c2VyKSB7XG4gICAgICAgICAgICAgICAgY2MuZXZlbnRNYW5hZ2VyLnJlbW92ZUxpc3RlbmVyKHRoaXMuX2J1dHRvbk1vdXNlcik7XG4gICAgICAgICAgICAgICAgdGhpcy5fYnV0dG9uTW91c2VyID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgfSxcblxuICAgIG9uVG91Y2hCZWdhbjpmdW5jdGlvbiAodG91Y2gsIGV2ZW50KSB7XG4gICAgICAgIHZhciBwb3MgPSB0b3VjaC5nZXRMb2NhdGlvbigpO1xuICAgICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5wYXJlbnQ7XG4gICAgICAgIGlmICh0YXJnZXQgJiYgY2MucmVjdENvbnRhaW5zUG9pbnQodGFyZ2V0LmdldEJvdW5kaW5nQm94VG9Xb3JsZCgpLCBwb3MpKSB7XG4gICAgICAgICAgICBpZih0YXJnZXQuZW5hYmxlZCAmJiB0YXJnZXQudmlzaWJsZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2lzVG91Y2hlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5faXNIb3ZlciA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuX3BsYXlCZWdpbih0YXJnZXQpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgb25Ub3VjaE1vdmVkOmZ1bmN0aW9uICh0b3VjaCwgZXZlbnQpIHtcblxuICAgIH0sXG5cbiAgICBvblRvdWNoRW5kZWQ6ZnVuY3Rpb24gKHRvdWNoLCBldmVudCkge1xuICAgICAgICBpZih0aGlzLl9pc1RvdWNoZWQpIHtcbiAgICAgICAgICAgIHRoaXMuX2lzVG91Y2hlZCA9IGZhbHNlO1xuICAgICAgICAgICAgdmFyIHRhcmdldCA9IHRoaXMucGFyZW50O1xuICAgICAgICAgICAgaWYgKHRhcmdldCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3BsYXlFbmQodGFyZ2V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvbk1vdXNlTW92ZTogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgdmFyIHBvcyA9IGV2ZW50LmdldExvY2F0aW9uKCk7XG4gICAgICAgIC8vL05PVEU6IHRhcmdldCdzIHBhcmVudCBpcyBCdXR0b25cbiAgICAgICAgdmFyIHRhcmdldCA9IHRoaXMucGFyZW50O1xuICAgICAgICBpZiAodGFyZ2V0KSB7XG4gICAgICAgICAgICBpZihjYy5yZWN0Q29udGFpbnNQb2ludCh0YXJnZXQuZ2V0Qm91bmRpbmdCb3hUb1dvcmxkKCksIHBvcykpIHtcbiAgICAgICAgICAgICAgICBpZighdGhpcy5faXNIb3ZlciAmJiAhdGhpcy5faXNUb3VjaGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKHRhcmdldC5lbmFibGVkICYmIHRhcmdldC52aXNpYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9pc0hvdmVyID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3BsYXlIb3Zlcih0YXJnZXQsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZih0aGlzLl9pc0hvdmVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzSG92ZXIgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGxheUhvdmVyKHRhcmdldCwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBfb25Ib3ZlckVuZGVkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5faXNIb3ZlclBsYXlpbmcgPSBmYWxzZTtcbiAgICB9LFxuXG4gICAgX3BsYXlCZWdpbkV4OiBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5PVEU6IENDQiBoYXMgYnVnLCBDQ0NvbnRyb2xCdXR0b24gY2FuIE5PVCBzZXQgY2hpbGQsIHNvIHVzZSBlbXB0eSBub2RlIGNvbnRhaW5zIGJ1dHRvbiBhbmQgbGFiZWxcbiAgICAgICAgICogQ0NOb2RlW2VtcHR5XVxuICAgICAgICAgKiAgICB8X0NDQ29udHJvbEJ1dHRvblxuICAgICAgICAgKiAgICAgICAgICB8X1RvdWNoZWROb2RlXG4gICAgICAgICAqL1xuICAgICAgICBpZih0YXJnZXQucGFyZW50KSB7XG4gICAgICAgICAgICB0YXJnZXQgPSB0YXJnZXQucGFyZW50O1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOT1RFOiBNZW51SXRlbSBpcyBtb3JlIHNwZWNpYWxseVxuICAgICAgICAgKiBDQ05vZGVbZW1wdHldXG4gICAgICAgICAqICAgIHxfQ0NNZW51XG4gICAgICAgICAqICAgICAgICAgIHxfQ0NNZW51SXRlbUltYWdlXG4gICAgICAgICAqICAgICAgICAgICAgICAgICAgfF9Ub3VjaGVkTm9kZVxuICAgICAgICAgKi9cbiAgICAgICAgaWYodGhpcy5faXNNZW51SXRlbSAmJiB0YXJnZXQucGFyZW50KSB7XG4gICAgICAgICAgICB0YXJnZXQgPSB0YXJnZXQucGFyZW50O1xuICAgICAgICB9XG4gICAgICAgIHRhcmdldC5zdG9wQWxsQWN0aW9ucygpO1xuICAgICAgICB0YXJnZXQucnVuQWN0aW9uKFxuICAgICAgICAgICAgY2Muc2VxdWVuY2UoXG4gICAgICAgICAgICAgICAgY2MuZGVsYXlUaW1lKDAuMDEpLFxuICAgICAgICAgICAgICAgIGNjLnNjYWxlVG8oMC4xLCAxLjEsIDAuOSksXG4gICAgICAgICAgICAgICAgY2MuZGVsYXlUaW1lKDAuMDEpXG4gICAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgfSxcblxuICAgIF9wbGF5RW5kRXg6IGZ1bmN0aW9uKHRhcmdldCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogTk9URTogQ0NCIGhhcyBidWcsIENDQ29udHJvbEJ1dHRvbiBjYW4gTk9UIHNldCBjaGlsZCwgc28gdXNlIGVtcHR5IG5vZGUgY29udGFpbnMgYnV0dG9uIGFuZCBsYWJlbFxuICAgICAgICAgKiBDQ05vZGVbZW1wdHldXG4gICAgICAgICAqICAgIHxfQ0NDb250cm9sQnV0dG9uXG4gICAgICAgICAqICAgICAgICAgIHxfVG91Y2hlZE5vZGVcbiAgICAgICAgICovXG4gICAgICAgIGlmKHRhcmdldC5wYXJlbnQpIHtcbiAgICAgICAgICAgIHRhcmdldCA9IHRhcmdldC5wYXJlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5PVEU6IE1lbnVJdGVtIGlzIG1vcmUgc3BlY2lhbGx5XG4gICAgICAgICAqIENDTm9kZVtlbXB0eV1cbiAgICAgICAgICogICAgfF9DQ01lbnVcbiAgICAgICAgICogICAgICAgICAgfF9DQ01lbnVJdGVtSW1hZ2VcbiAgICAgICAgICogICAgICAgICAgICAgICAgICB8X1RvdWNoZWROb2RlXG4gICAgICAgICAqL1xuICAgICAgICBpZih0aGlzLl9pc01lbnVJdGVtICYmIHRhcmdldC5wYXJlbnQpIHtcbiAgICAgICAgICAgIHRhcmdldCA9IHRhcmdldC5wYXJlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgdGFyZ2V0LnN0b3BBbGxBY3Rpb25zKCk7XG4gICAgICAgIHRhcmdldC5ydW5BY3Rpb24oXG4gICAgICAgICAgICBjYy5zZXF1ZW5jZShcbiAgICAgICAgICAgICAgICBjYy5kZWxheVRpbWUoMC4wMSksXG4gICAgICAgICAgICAgICAgY2Muc2NhbGVUbygwLjEsIDEsIDEpLFxuICAgICAgICAgICAgICAgIGNjLmRlbGF5VGltZSgwLjAxKVxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH0sXG5cbiAgICBfcGxheUJlZ2luOiBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5PVEU6IENDQiBoYXMgYnVnLCBDQ0NvbnRyb2xCdXR0b24gY2FuIE5PVCBzZXQgY2hpbGQsIHNvIHVzZSBlbXB0eSBub2RlIGNvbnRhaW5zIGJ1dHRvbiBhbmQgbGFiZWxcbiAgICAgICAgICogQ0NOb2RlW2VtcHR5XVxuICAgICAgICAgKiAgICB8X0NDQ29udHJvbEJ1dHRvblxuICAgICAgICAgKiAgICAgICAgICB8X1RvdWNoZWROb2RlXG4gICAgICAgICAqL1xuICAgICAgICBpZih0YXJnZXQucGFyZW50KSB7XG4gICAgICAgICAgICB0YXJnZXQgPSB0YXJnZXQucGFyZW50O1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOT1RFOiBNZW51SXRlbSBpcyBtb3JlIHNwZWNpYWxseVxuICAgICAgICAgKiBDQ05vZGVbZW1wdHldXG4gICAgICAgICAqICAgIHxfQ0NNZW51XG4gICAgICAgICAqICAgICAgICAgIHxfQ0NNZW51SXRlbUltYWdlXG4gICAgICAgICAqICAgICAgICAgICAgICAgICAgfF9Ub3VjaGVkTm9kZVxuICAgICAgICAgKi9cbiAgICAgICAgaWYodGhpcy5faXNNZW51SXRlbSAmJiB0YXJnZXQucGFyZW50KSB7XG4gICAgICAgICAgICB0YXJnZXQgPSB0YXJnZXQucGFyZW50O1xuICAgICAgICB9XG4gICAgICAgIHRhcmdldC5zdG9wQWxsQWN0aW9ucygpO1xuICAgICAgICB0YXJnZXQucnVuQWN0aW9uKFxuICAgICAgICAgICAgY2Muc2NhbGVUbygwLjIwLCAwLjg1LCAwLjg1KVxuICAgICAgICApO1xuICAgIH0sXG5cbiAgICBfcGxheUVuZDogZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOT1RFOiBDQ0IgaGFzIGJ1ZywgQ0NDb250cm9sQnV0dG9uIGNhbiBOT1Qgc2V0IGNoaWxkLCBzbyB1c2UgZW1wdHkgbm9kZSBjb250YWlucyBidXR0b24gYW5kIGxhYmVsXG4gICAgICAgICAqIENDTm9kZVtlbXB0eV1cbiAgICAgICAgICogICAgfF9DQ0NvbnRyb2xCdXR0b25cbiAgICAgICAgICogICAgICAgICAgfF9Ub3VjaGVkTm9kZVxuICAgICAgICAgKi9cbiAgICAgICAgaWYodGFyZ2V0LnBhcmVudCkge1xuICAgICAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0LnBhcmVudDtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogTk9URTogTWVudUl0ZW0gaXMgbW9yZSBzcGVjaWFsbHlcbiAgICAgICAgICogQ0NOb2RlW2VtcHR5XVxuICAgICAgICAgKiAgICB8X0NDTWVudVxuICAgICAgICAgKiAgICAgICAgICB8X0NDTWVudUl0ZW1JbWFnZVxuICAgICAgICAgKiAgICAgICAgICAgICAgICAgIHxfVG91Y2hlZE5vZGVcbiAgICAgICAgICovXG4gICAgICAgIGlmKHRoaXMuX2lzTWVudUl0ZW0gJiYgdGFyZ2V0LnBhcmVudCkge1xuICAgICAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0LnBhcmVudDtcbiAgICAgICAgfVxuICAgICAgICB0YXJnZXQuc3RvcEFsbEFjdGlvbnMoKTtcbiAgICAgICAgdGFyZ2V0LnJ1bkFjdGlvbihcbiAgICAgICAgICAgIGNjLnNjYWxlVG8oMC4yMCAsMSwgMSlcbiAgICAgICAgKTtcbiAgICB9LFxuXG4gICAgX3BsYXlIb3ZlckV4OiBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICAgICAgdmFyIGJvdW5kaW5nID0gdGFyZ2V0LmdldEJvdW5kaW5nQm94KCk7XG4gICAgICAgIGlmKGJvdW5kaW5nLndpZHRoIDwgdGhpcy5vZmZzZXRYKSB7XG4gICAgICAgICAgICBib3VuZGluZy53aWR0aCA9IHRoaXMub2Zmc2V0WDtcbiAgICAgICAgfVxuICAgICAgICBpZihib3VuZGluZy5oZWlnaHQgPCB0aGlzLm9mZnNldFkpIHtcbiAgICAgICAgICAgIGJvdW5kaW5nLmhlaWdodCA9IHRoaXMub2Zmc2V0WTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOT1RFOiBDQ0IgaGFzIGJ1ZywgQ0NDb250cm9sQnV0dG9uIGNhbiBOT1Qgc2V0IGNoaWxkLCBzbyB1c2UgZW1wdHkgbm9kZSBjb250YWlucyBidXR0b24gYW5kIGxhYmVsXG4gICAgICAgICAqIENDTm9kZVtlbXB0eV1cbiAgICAgICAgICogICAgfF9DQ0NvbnRyb2xCdXR0b25cbiAgICAgICAgICogICAgICAgICAgfF9Ub3VjaGVkTm9kZVxuICAgICAgICAgKi9cbiAgICAgICAgaWYodGFyZ2V0LnBhcmVudCkge1xuICAgICAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0LnBhcmVudDtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogTk9URTogTWVudUl0ZW0gaXMgbW9yZSBzcGVjaWFsbHlcbiAgICAgICAgICogQ0NOb2RlW2VtcHR5XVxuICAgICAgICAgKiAgICB8X0NDTWVudVxuICAgICAgICAgKiAgICAgICAgICB8X0NDTWVudUl0ZW1JbWFnZVxuICAgICAgICAgKiAgICAgICAgICAgICAgICAgIHxfVG91Y2hlZE5vZGVcbiAgICAgICAgICovXG4gICAgICAgIGlmKHRoaXMuX2lzTWVudUl0ZW0gJiYgdGFyZ2V0LnBhcmVudCkge1xuICAgICAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0LnBhcmVudDtcbiAgICAgICAgfVxuICAgICAgICB0YXJnZXQuc3RvcEFsbEFjdGlvbnMoKTtcbiAgICAgICAgdGFyZ2V0LnJ1bkFjdGlvbihcbiAgICAgICAgICAgIGNjLnNlcXVlbmNlKFxuICAgICAgICAgICAgICAgIGNjLnNjYWxlVG8oMC4wOCwgKGJvdW5kaW5nLndpZHRoLXRoaXMub2Zmc2V0WCkvYm91bmRpbmcud2lkdGgsIChib3VuZGluZy5oZWlnaHQrdGhpcy5vZmZzZXRZKS9ib3VuZGluZy5oZWlnaHQpLFxuICAgICAgICAgICAgICAgIGNjLnNjYWxlVG8oMC4xLCAoYm91bmRpbmcud2lkdGgrdGhpcy5vZmZzZXRYKS9ib3VuZGluZy53aWR0aCwgKGJvdW5kaW5nLmhlaWdodC10aGlzLm9mZnNldFkpL2JvdW5kaW5nLmhlaWdodCksXG4gICAgICAgICAgICAgICAgY2MuZGVsYXlUaW1lKDAuMDQpLFxuICAgICAgICAgICAgICAgIGNjLnNjYWxlVG8oMC4xLCAxLCAxKSxcbiAgICAgICAgICAgICAgICBjYy5jYWxsRnVuYyh0aGlzLl9vbkhvdmVyRW5kZWQsIHRoaXMpXG4gICAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgfSxcblxuICAgIF9wbGF5SG92ZXI6IGZ1bmN0aW9uKHRhcmdldCwgaXNIb3Zlcikge1xuICAgICAgICAvL2NjLmVycm9yKFwiaG92ZXI6IHRhcmdldCA9IFwiLCB0YXJnZXQsIERhdGUubm93KCkpO1xuICAgICAgICAvKipcbiAgICAgICAgICogTk9URTogQ0NCIGhhcyBidWcsIENDQ29udHJvbEJ1dHRvbiBjYW4gTk9UIHNldCBjaGlsZCwgc28gdXNlIGVtcHR5IG5vZGUgY29udGFpbnMgYnV0dG9uIGFuZCBsYWJlbFxuICAgICAgICAgKiBDQ05vZGVbZW1wdHldXG4gICAgICAgICAqICAgIHxfQ0NDb250cm9sQnV0dG9uXG4gICAgICAgICAqICAgICAgICAgIHxfVG91Y2hlZE5vZGVcbiAgICAgICAgICovXG4gICAgICAgIGlmKHRhcmdldC5wYXJlbnQpIHtcbiAgICAgICAgICAgIHRhcmdldCA9IHRhcmdldC5wYXJlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5PVEU6IE1lbnVJdGVtIGlzIG1vcmUgc3BlY2lhbGx5XG4gICAgICAgICAqIENDTm9kZVtlbXB0eV1cbiAgICAgICAgICogICAgfF9DQ01lbnVcbiAgICAgICAgICogICAgICAgICAgfF9DQ01lbnVJdGVtSW1hZ2VcbiAgICAgICAgICogICAgICAgICAgICAgICAgICB8X1RvdWNoZWROb2RlXG4gICAgICAgICAqL1xuICAgICAgICBpZih0aGlzLl9pc01lbnVJdGVtICYmIHRhcmdldC5wYXJlbnQpIHtcbiAgICAgICAgICAgIHRhcmdldCA9IHRhcmdldC5wYXJlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgdGFyZ2V0LnN0b3BBbGxBY3Rpb25zKCk7XG5cbiAgICAgICAgaWYoaXNIb3Zlcikge1xuICAgICAgICAgICAgdGFyZ2V0LnJ1bkFjdGlvbihcbiAgICAgICAgICAgICAgICBjYy5zZXF1ZW5jZShcbiAgICAgICAgICAgICAgICAgICAgY2Muc2NhbGVUbygwLjE2LCAxLjA4LCAxLjA4KSxcbiAgICAgICAgICAgICAgICAgICAgY2Muc2NhbGVUbygwLjEsIDEuMDYsIDEuMDYpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRhcmdldC5zZXRTY2FsZSgxLCAxKTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBUb3VjaGVkTm9kZTsiLCIvKipcbiAqIENyZWF0ZWQgYnkgb3llIG9uIDE1LTUtMTcuXG4gKi9cbnZhciBIdHRwQ2xpZW50ID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi9uZXQvSHR0cENsaWVudFwiKTtcbnZhciBBZHNQbGFjZSA9IHJlcXVpcmUoXCIuLi9lbnVtL0Fkc1BsYWNlXCIpO1xuXG52YXIgQURfQ09ORklHX1VSTCA9IFwiaHR0cHM6Ly9xaW5uaW5nMTk5LmdpdGh1Yi5pby9nYW1lLmh0bWxcIjtcblxuLy92YXIgT05FX01JTlVURSA9IDYwICogMTAwMDtcbnZhciBBZExpc3RlbmVyID0gY2MuQ2xhc3MuZXh0ZW5kKHtcbiAgICBvblJld2FyZGVkVmlkZW9GaW5pc2hlZDogZnVuY3Rpb24gKGlzUmV3YXJkZWQsIGNoYW5uZWxOYW1lKSB7XG4gICAgfSxcblxuICAgIG9uSW50ZXJzdGl0aWFsQWRFbmQ6IGZ1bmN0aW9uIChjaGFubmVsTmFtZSkge1xuICAgIH0sXG5cbiAgICBvblNob3dWaWRlb0FkQmVnaW46IGZ1bmN0aW9uICgpIHtcbiAgICB9LFxuXG4gICAgb25TaG93VmlkZW9BZEVuZDogZnVuY3Rpb24gKCkge1xuICAgIH1cbn0pO1xuXG52YXIgQWRQbGFjZUluZm8gPSBmdW5jdGlvbiAoaW50ZXJ2YWwpIHtcbiAgICB0aGlzLmludGVydmFsID0gaW50ZXJ2YWw7XG4gICAgdGhpcy5sYXN0U2hvd1RpbWUgPSBEYXRlLm5vdygpO1xufTtcblxuXG52YXIgQWRzTWFuYWdlciA9IGNjLkNsYXNzLmV4dGVuZCh7XG4gICAgREVGQVVMVF9BRF9JTlRFUlZBTDogNDAgKiAxMDAwLFxuXG4gICAgT05FX01JTlVURV9TRUNPTkQ6IDYwICogMTAwMCxcblxuICAgIGFkQ29uZmlnVXJsOiBcIlwiLFxuXG4gICAgcmF0ZVRpbWU6IDAsXG4gICAgcmF0ZWRUaW1lOiAwLFxuICAgIHJhdGVSZW1vdmVBZHM6IGZhbHNlLFxuXG4gICAgaXNOZXdQbGF5ZXI6IHRydWUsXG5cbiAgICBhZFBsYWNlTWFwOiB7fSxcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtBZExpc3RlbmVyfVxuICAgICAqL1xuICAgIGFkTGlzdGVuZXI6IG51bGwsXG5cbiAgICBzaG93VG9wQmFubmVyOiB0cnVlLFxuICAgIHRvcEJhbm5lckRheTogMCxcblxuICAgIHNob3dGaXJzdEVudGVyQWQ6IHRydWUsXG4gICAgZmlyc3RFbnRlclNob3dBZERheTogMixcblxuICAgIGxhc3RJbnRlcnN0aXRpYWxUaW1lOiAwLFxuICAgIGxhc3RSZXdhcmRlZFRpbWU6IDAsXG4gICAgZW5hYmxlZEludGVyc3RpdGlhbEFkOiB0cnVlLFxuXG4gICAgcG9wdXBMZXZlbExpbWl0OiA0LFxuICAgIHNraW5NYXhQb3BDb3VudDogMyxcbiAgICBib3hNYXhQb3BDb3VudDogMyxcbiAgICBjYXJkTWF4UG9wQ291bnQ6IDMsXG4gICAgc3RhcnRMZXZlbExpbWl0OiAyLFxuICAgIHBvcHVwUmVzZXRMaW1pdDogOCxcblxuICAgIGNyb3NzUHJvbVBlcmNlbnQ6IDAuNSxcblxuICAgIGNoYWxsZW5nZVRpcHNEYXk6IDEsXG5cbiAgICBjaGFsbGVuZ2VPcGVuTGV2ZWw6IDIwLFxuXG4gICAgZmx5R2lmdE9wZW5MZXZlbDogMyxcblxuICAgIGRpc2FibGVJbnRlcnN0aXRpYWxUaW1lOiAwLFxuXG4gICAgcmV3YXJkUmVtb3ZlQWRzTGV2ZWxMaW1pdDogNCxcblxuICAgIGZseUdpZnRDb3VudDogNSxcblxuICAgIGFkc0ludGVydmFsOiA0MCAqIDEwMDAsXG5cbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS5vbkludGVyc3RpdGlhbEFkRmluaXNoZWQgPSB0aGlzLm9uQWRGaW5pc2hlZEpzYi5iaW5kKHRoaXMpO1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS5vblZpZGVvQWRGaW5pc2hlZCA9IHRoaXMub25WaWRlb0FkRmluaXNoZWRKc2IuYmluZCh0aGlzKTtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2Uub25TaG93VmlkZW9BZEJlZ2luID0gdGhpcy5vblNob3dWaWRlb0FkQmVnaW5Kc2IuYmluZCh0aGlzKTtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2Uub25TaG93VmlkZW9BZEVuZCA9IHRoaXMub25TaG93VmlkZW9BZEVuZEpzYi5iaW5kKHRoaXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPD0gQWRzUGxhY2UuTnVtOyArK2kpIHtcbiAgICAgICAgICAgIHRoaXMuYWRQbGFjZU1hcFtpXSA9IG5ldyBBZFBsYWNlSW5mbyh0aGlzLkRFRkFVTFRfQURfSU5URVJWQUwpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uICgpIHtcbiAgICB9LFxuXG4gICAgc2V0QWRzSW50ZXJ2YWw6IGZ1bmN0aW9uIChzZWNUaW1lKSB7XG4gICAgICAgIHRoaXMuYWRzSW50ZXJ2YWwgPSBzZWNUaW1lICogMTAwMDtcbiAgICB9LFxuXG4gICAgbG9hZFJlbW90ZURhdGE6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGFkQ29uZmlnVXJsID0gZ2FtZS5jb25maWcuZ2V0QWRVcmwoKSB8fCBBRF9DT05GSUdfVVJMO1xuICAgICAgICBjYy5sb2coXCJBZHNNYW5hZ2VyIGxvYWRSZW1vdGVEYXRhOlwiICsgYWRDb25maWdVcmwpO1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIEh0dHBDbGllbnQuZG9HZXQoYWRDb25maWdVcmwsIGZ1bmN0aW9uIChlcnJvciwgdGV4dCkge1xuICAgICAgICAgICAgY2MubG9nKFwiQWRzTWFuYWdlciByZW1vdGUgcmVzcG9uc2U6XCIgKyBlcnJvciArIFwiLHRleHQ6XCIgKyB0ZXh0KTtcbiAgICAgICAgICAgIGlmICghZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYWRDb25maWcgPSBKU09OLnBhcnNlKHRleHQpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYy5zeXMub3MgPT09IGNjLnN5cy5PU19BTkRST0lEKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWRDb25maWcgJiYgYWRDb25maWcuYW5kcm9pZENvbmZpZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkQ29uZmlnID0gYWRDb25maWcuYW5kcm9pZENvbmZpZztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHZhciBzaG93VG9wQmFubmVyID0gYWRDb25maWcuc2hvd1RvcEJhbm5lcjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjYy5pc1VuZGVmaW5lZChzaG93VG9wQmFubmVyKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zaG93VG9wQmFubmVyID0gc2hvd1RvcEJhbm5lcjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHZhciBzaG93VG9wQmFubmVyTmV3ID0gYWRDb25maWcuc2hvd1RvcEJhbm5lck5ldztcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjYy5pc1VuZGVmaW5lZChzaG93VG9wQmFubmVyTmV3KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zaG93VG9wQmFubmVyID0gc2hvd1RvcEJhbm5lck5ldztcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHZhciB0b3BCYW5uZXJEYXkgPSBhZENvbmZpZy50b3BCYW5uZXJEYXk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghY2MuaXNVbmRlZmluZWQodG9wQmFubmVyRGF5KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50b3BCYW5uZXJEYXkgPSB0b3BCYW5uZXJEYXk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2YXIgc2hvd0ZpcnN0RW50ZXJBZCA9IGFkQ29uZmlnLnNob3dGaXJzdEVudGVyQWQ7XG4gICAgICAgICAgICAgICAgICAgIGlmICghY2MuaXNVbmRlZmluZWQoc2hvd0ZpcnN0RW50ZXJBZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2hvd0ZpcnN0RW50ZXJBZCA9IHNob3dGaXJzdEVudGVyQWQ7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2YXIgZmlyc3RFbnRlclNob3dBZERheSA9IGFkQ29uZmlnLmZpcnN0RW50ZXJTaG93QWREYXk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghY2MuaXNVbmRlZmluZWQoZmlyc3RFbnRlclNob3dBZERheSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZmlyc3RFbnRlclNob3dBZERheSA9IGZpcnN0RW50ZXJTaG93QWREYXk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2YXIgYmFja1RvR3JvdW5kSW50ZXJ2YWwgPSBhZENvbmZpZy5iYWNrVG9Hcm91bmRJbnRlcnZhbDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjYy5pc1VuZGVmaW5lZChiYWNrVG9Hcm91bmRJbnRlcnZhbCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWRQbGFjZU1hcFtBZHNQbGFjZS5CYWNrR3JvdW5kXS5pbnRlcnZhbCA9IGJhY2tUb0dyb3VuZEludGVydmFsICogMTAwMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHZhciBiYWNrVG9Ib21lSW50ZXJ2YWwgPSBhZENvbmZpZy5iYWNrVG9Ib21lSW50ZXJ2YWw7XG4gICAgICAgICAgICAgICAgICAgIGlmICghY2MuaXNVbmRlZmluZWQoYmFja1RvSG9tZUludGVydmFsKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hZFBsYWNlTWFwW0Fkc1BsYWNlLkhvbWVdLmludGVydmFsID0gYmFja1RvSG9tZUludGVydmFsICogMTAwMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHZhciByZWZyZXNoSW50ZXJ2YWwgPSBhZENvbmZpZy5yZWZyZXNoSW50ZXJ2YWw7XG4gICAgICAgICAgICAgICAgICAgIGlmICghY2MuaXNVbmRlZmluZWQocmVmcmVzaEludGVydmFsKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hZFBsYWNlTWFwW0Fkc1BsYWNlLlJlZnJlc2hdLmludGVydmFsID0gcmVmcmVzaEludGVydmFsICogMTAwMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHZhciBwb3B1cExldmVsTGltaXQgPSBhZENvbmZpZy5wb3B1cExldmVsTGltaXQ7XG4gICAgICAgICAgICAgICAgICAgIGlmICghY2MuaXNVbmRlZmluZWQocG9wdXBMZXZlbExpbWl0KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5wb3B1cExldmVsTGltaXQgPSBwb3B1cExldmVsTGltaXQ7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2YXIgc2tpbk1heFBvcENvdW50ID0gYWRDb25maWcuc2tpbk1heFBvcENvdW50O1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWNjLmlzVW5kZWZpbmVkKHNraW5NYXhQb3BDb3VudCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2tpbk1heFBvcENvdW50ID0gc2tpbk1heFBvcENvdW50O1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGJveE1heFBvcENvdW50ID0gYWRDb25maWcuYm94TWF4UG9wQ291bnQ7XG4gICAgICAgICAgICAgICAgICAgIGlmICghY2MuaXNVbmRlZmluZWQoYm94TWF4UG9wQ291bnQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmJveE1heFBvcENvdW50ID0gYm94TWF4UG9wQ291bnQ7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RhcnRMZXZlbExpbWl0ID0gYWRDb25maWcuc3RhcnRMZXZlbExpbWl0O1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWNjLmlzVW5kZWZpbmVkKHN0YXJ0TGV2ZWxMaW1pdCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc3RhcnRMZXZlbExpbWl0ID0gc3RhcnRMZXZlbExpbWl0O1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGNhcmRNYXhQb3BDb3VudCA9IGFkQ29uZmlnLmNhcmRNYXhQb3BDb3VudDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjYy5pc1VuZGVmaW5lZChjYXJkTWF4UG9wQ291bnQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmNhcmRNYXhQb3BDb3VudCA9IGNhcmRNYXhQb3BDb3VudDtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHZhciBwb3B1cFJlc2V0TGltaXQgPSBhZENvbmZpZy5wb3B1cFJlc2V0TGltaXQ7XG4gICAgICAgICAgICAgICAgICAgIGlmICghY2MuaXNVbmRlZmluZWQocG9wdXBSZXNldExpbWl0KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5wb3B1cFJlc2V0TGltaXQgPSBwb3B1cFJlc2V0TGltaXQ7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2YXIgY3Jvc3NQcm9tUGVyY2VudCA9IGFkQ29uZmlnLmNyb3NzUHJvbVBlcmNlbnQ7XG4gICAgICAgICAgICAgICAgICAgIGlmICghY2MuaXNVbmRlZmluZWQoY3Jvc3NQcm9tUGVyY2VudCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY3Jvc3NQcm9tUGVyY2VudCA9IGNyb3NzUHJvbVBlcmNlbnQ7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2YXIgY2hhbGxlbmdlVGlwc0RheSA9IGFkQ29uZmlnLmNoYWxsZW5nZVRpcHNEYXk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghY2MuaXNVbmRlZmluZWQoY2hhbGxlbmdlVGlwc0RheSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY2hhbGxlbmdlVGlwc0RheSA9IGNoYWxsZW5nZVRpcHNEYXk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2YXIgY2hhbGxlbmdlT3BlbkxldmVsID0gYWRDb25maWcuY2hhbGxlbmdlT3BlbkxldmVsO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWNjLmlzVW5kZWZpbmVkKGNoYWxsZW5nZU9wZW5MZXZlbCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY2hhbGxlbmdlT3BlbkxldmVsID0gY2hhbGxlbmdlT3BlbkxldmVsO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGZseUdpZnRPcGVuTGV2ZWwgPSBhZENvbmZpZy5mbHlHaWZ0T3BlbkxldmVsO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWNjLmlzVW5kZWZpbmVkKGZseUdpZnRPcGVuTGV2ZWwpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmZseUdpZnRPcGVuTGV2ZWwgPSBmbHlHaWZ0T3BlbkxldmVsO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHJld2FyZFJlbW92ZUFkc0xldmVsTGltaXQgPSBhZENvbmZpZy5yZXdhcmRSZW1vdmVBZHNMZXZlbExpbWl0O1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWNjLmlzVW5kZWZpbmVkKHJld2FyZFJlbW92ZUFkc0xldmVsTGltaXQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnJld2FyZFJlbW92ZUFkc0xldmVsTGltaXQgPSByZXdhcmRSZW1vdmVBZHNMZXZlbExpbWl0O1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGZseUdpZnRDb3VudCA9IGFkQ29uZmlnLmZseUdpZnRDb3VudDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjYy5pc1VuZGVmaW5lZChmbHlHaWZ0Q291bnQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmZseUdpZnRDb3VudCA9IGZseUdpZnRDb3VudDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2MubG9nKFwiQWRzTWFuYWdlciBlcnJvcjpcIiArIGUubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgZ2V0UmVnaXN0ZXJEYXk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGdhbWUucGxheWVyTWFuLmdldFJlZ2lzdGVyRGF5KCk7XG4gICAgfSxcblxuICAgIHNldElzTmV3UGxheWVyOiBmdW5jdGlvbiAoaXNOZXcpIHtcbiAgICAgICAgdGhpcy5pc05ld1BsYXllciA9IGlzTmV3O1xuICAgIH0sXG5cbiAgICBvbkdhbWVPblNob3c6IGZ1bmN0aW9uICgpIHtcbiAgICB9LFxuXG4gICAgc2V0QWRMaXN0ZW5lcjogZnVuY3Rpb24gKGFkTGlzdGVuZXIpIHtcbiAgICAgICAgdGhpcy5hZExpc3RlbmVyID0gYWRMaXN0ZW5lcjtcbiAgICB9LFxuXG4gICAgaXNSZW1vdmVkQWRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBnYW1lLnBsYXllck1hbi5wbGF5ZXIucmVtb3ZlZEFkcztcbiAgICB9LFxuXG4gICAgc2hvd0Jhbm5lckFkczogZnVuY3Rpb24gKHBsYWNlbWVudCkge1xuICAgICAgICBjYy5sb2coXCJBZHNNYW5hZ2VyIHNob3dCYW5uZXJBZHM6XCIgKyBwbGFjZW1lbnQpO1xuICAgICAgICBpZiAodGhpcy5pc1JlbW92ZWRBZHMoKSkgcmV0dXJuO1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNTaG93QmFubmVyQWRzKHBsYWNlbWVudCkpIHtcbiAgICAgICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLnNob3dCYW5uZXJBZChwbGFjZW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIHJlbW92ZUJhbm5lckFkczogZnVuY3Rpb24gKHBsYWNlbWVudCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLnJlbW92ZUJhbm5lckFkKHBsYWNlbWVudCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgaXNTaG93QmFubmVyQWRzOiBmdW5jdGlvbiAocGxhY2VtZW50KSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIHJldHVybiBqc2JfZHAub25lU2RrQnJpZGdlLmlzU2hvd0Jhbm5lckFkKHBsYWNlbWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICBpc1Nob3dOYXRpdmVBZDogZnVuY3Rpb24gKHBsYWNlbWVudCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICByZXR1cm4ganNiX2RwLm9uZVNka0JyaWRnZS5pc1Nob3dOYXRpdmVBZChwbGFjZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgaXNOYXRpdmVBZFJlYWR5OiBmdW5jdGlvbiAocGxhY2VtZW50KSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIHJldHVybiBqc2JfZHAub25lU2RrQnJpZGdlLmlzTmF0aXZlQWRSZWFkeShwbGFjZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgaW50ZXJzdGl0aWFsQ291bnQ6IDAsXG5cbiAgICBpc0ludGVyc3RpdGlhbERpc2FibGVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRpc2FibGVJbnRlcnN0aXRpYWxUaW1lIC0gRGF0ZS5ub3coKSA+IDA7XG4gICAgfSxcblxuICAgIGludGVyc3RpdGlhbEVuZENhbGxiYWNrOiBudWxsLFxuXG4gICAgc2hvd0ludGVyc3RpdGlhbDogZnVuY3Rpb24gKHBsYWNlLCBlbmRDYWxsYmFjaykge1xuICAgICAgICBjYy5sb2coXCJBZHNNYW5hZ2VyIHNob3cgaW50ZXJzdGl0aWFsIHN0YXJ0XCIpO1xuICAgICAgICBwbGFjZSA9IEFkc1BsYWNlLlBhc3M7XG4gICAgICAgIGlmICghdGhpcy5lbmFibGVkSW50ZXJzdGl0aWFsQWQpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5pc1JlbW92ZWRBZHMoKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgY2MubG9nKFwiQWRzTWFuYWdlciBzaG93IGludGVyc3RpdGlhbCB0aW1lOlwiICsgKHRoaXMuZGlzYWJsZUludGVyc3RpdGlhbFRpbWUgLSBEYXRlLm5vdygpKSk7XG4gICAgICAgIGlmICh0aGlzLmlzSW50ZXJzdGl0aWFsRGlzYWJsZWQoKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHBsYWNlbWVudCA9IFwiZGVmYXVsdFwiO1xuICAgICAgICBpZiAocGxhY2UgPT09IEFkc1BsYWNlLkhvbWUpIHtcbiAgICAgICAgICAgIHBsYWNlbWVudCA9IFwiaG9tZVwiO1xuICAgICAgICB9IGVsc2UgaWYgKHBsYWNlID09PSBBZHNQbGFjZS5SZWZyZXNoKSB7XG4gICAgICAgICAgICBwbGFjZW1lbnQgPSBcInJlZnJlc2hcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGlmICghanNiX2RwLm9uZVNka0JyaWRnZS5pc0ludGVyc3RpdGlhbEFkUmVhZHkocGxhY2VtZW50KSkge1xuICAgICAgICAgICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcIldhdGNoSVNOb3RSZWFkeVwiLCB7bmFtZTogQWRzUGxhY2UuZ2V0TmFtZShwbGFjZSl9KTtcbiAgICAgICAgICAgICAgICBjYy5sb2coXCJBZHNNYW5hZ2VyIHNob3dJbnRlcnN0aXRpYWwgYWRzIG5vdCByZWFkeVwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2MubG9nKFwiQWRzTWFuYWdlciBzaG93SW50ZXJzdGl0aWFsIHBsYWNlOlwiICsgcGxhY2UgKyBcIiwgaW50ZXJ2YWw6XCIgKyB0aGlzLmFkc0ludGVydmFsICsgXCIsY3VycmVudCBpbnRlcnZhbDpcIiArXG4gICAgICAgICAgICAoRGF0ZS5ub3coKSAtIHRoaXMuYWRQbGFjZU1hcFtwbGFjZV0ubGFzdFNob3dUaW1lKSk7XG4gICAgICAgIGlmIChEYXRlLm5vdygpIC0gdGhpcy5hZFBsYWNlTWFwW3BsYWNlXS5sYXN0U2hvd1RpbWUgPCB0aGlzLmFkc0ludGVydmFsKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoRGF0ZS5ub3coKSAtIHRoaXMubGFzdEludGVyc3RpdGlhbFRpbWUgPCA1ICogMTAwMCkge1xuICAgICAgICAgICAgY2MubG9nKFwiQWRzTWFuYWdlciBzaG93SW50ZXJzdGl0aWFsIGludGVydmFsIGxlc3MgdGhhbiA1IHNlY29uZHNcIik7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKERhdGUubm93KCkgLSB0aGlzLmxhc3RSZXdhcmRlZFRpbWUgPCA1ICogMTAwMCkge1xuICAgICAgICAgICAgY2MubG9nKFwiQWRzTWFuYWdlciBzaG93SW50ZXJzdGl0aWFsIHJld2FyZGVkIHZpZGVvIGRpc2FibGUgaW50ZXJzdGl0aWFsIDUgc2Vjb25kc1wiKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuYWRQbGFjZU1hcFtwbGFjZV0ubGFzdFNob3dUaW1lID0gRGF0ZS5ub3coKTtcblxuICAgICAgICBjYy5sb2coXCJBZHNNYW5hZ2VyIHNob3dJbnRlcnN0aXRpYWwgcGxhY2U6XCIgKyBwbGFjZSArIFwiIHNob3dlZFwiKTtcbiAgICAgICAgdGhpcy5sYXN0SW50ZXJzdGl0aWFsVGltZSA9IERhdGUubm93KCk7XG5cbiAgICAgICAgdGhpcy5pbnRlcnN0aXRpYWxDb3VudCsrO1xuXG4gICAgICAgIHRoaXMucGxhY2UgPSBwbGFjZTtcbiAgICAgICAgdGhpcy5pbnRlcnN0aXRpYWxFbmRDYWxsYmFjayA9IGVuZENhbGxiYWNrO1xuICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRXZlbnQoXCJXYXRjaElTU291cmNlU3RhcnRcIiwge25hbWU6IEFkc1BsYWNlLmdldE5hbWUodGhpcy5wbGFjZSl9KTtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS5zaG93SW50ZXJzdGl0YWxBZChwbGFjZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG5cbiAgICBzaG91bGRTaG93TmF0aXZlQWQ6IHRydWUsXG5cbiAgICBzaG93TmF0aXZlQWQ6IGZ1bmN0aW9uIChwbGFjZSwgcG9zWCwgcG9zWSkge1xuICAgICAgICBjYy5sb2coXCJzaG93TmF0aXZlQWQ6XCIgKyBwbGFjZSk7XG4gICAgICAgIGlmICh0aGlzLmlzUmVtb3ZlZEFkcygpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNTaG93TmF0aXZlQWQocGxhY2UpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2MubG9nKFwic2hvd05hdGl2ZUFkOlwiICsgcGxhY2UgKyBcIiwxXCIpO1xuICAgICAgICAgICAgdmFyIHNob3dOYXRpdmVBZCA9IGdhbWUudXRpbHMucmFuZG9tTmV4dEludCgxMDApID4gdGhpcy5jcm9zc1Byb21QZXJjZW50ICogMTAwO1xuICAgICAgICAgICAgdmFyIGlzTmF0aXZlQWRSZWFkeSA9IHRoaXMuaXNOYXRpdmVBZFJlYWR5KHBsYWNlKTtcbiAgICAgICAgICAgIHZhciBoYXNDcm9zc1Byb21BZCA9IGdhbWUuY3Jvc3NQcm9tTWFuLmhhc0Nyb3NzUHJvbUFkKCk7XG4gICAgICAgICAgICBjYy5sb2coXCJzaG93TmF0aXZlQWQ6IGhhc0Nyb3NzUHJvbUFkXCIgKyBoYXNDcm9zc1Byb21BZCk7XG4gICAgICAgICAgICBjYy5sb2coXCJzaG93TmF0aXZlQWQ6IHNob3dOYXRpdmVBZFwiICsgc2hvd05hdGl2ZUFkKTtcbiAgICAgICAgICAgIGlmICghaGFzQ3Jvc3NQcm9tQWQgfHwgdGhpcy5jcm9zc1Byb21QZXJjZW50IDw9IDAgfHwgKHNob3dOYXRpdmVBZCAmJiBpc05hdGl2ZUFkUmVhZHkpKSB7XG4gICAgICAgICAgICAgICAgY2MubG9nKFwic2hvd05hdGl2ZUFkOlwiICsgcGxhY2UgKyBcIiwyXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2hvdWxkU2hvd05hdGl2ZUFkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLnNob3dOYXRpdmVBZChwbGFjZSwgcG9zWCwgcG9zWSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNjLmxvZyhcInNob3dOYXRpdmVBZDpcIiArIHBsYWNlICsgXCIsM1wiKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNob3VsZFNob3dOYXRpdmVBZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGdhbWUuY3Jvc3NQcm9tTWFuLnNob3dDcm9zc1Byb21BZChjYy5wKGNjLndpblNpemUud2lkdGggKiAwLjUgKyBwb3NYLCBjYy53aW5TaXplLmhlaWdodCAqIDAuNSArIHBvc1kpLCBjYy5zaXplKDMzMCwgMzMwKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcmVtb3ZlTmF0aXZlQWQ6IGZ1bmN0aW9uIChwbGFjZSkge1xuICAgICAgICBpZiAodGhpcy5pc1JlbW92ZWRBZHMoKSkgcmV0dXJuO1xuICAgICAgICBjYy5sb2coXCJyZW1vdmVOYXRpdmVBZDpcIiArIHBsYWNlICsgXCIsMVwiKTtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc2hvdWxkU2hvd05hdGl2ZUFkKSB7XG4gICAgICAgICAgICAgICAgY2MubG9nKFwicmVtb3ZlTmF0aXZlQWQ6XCIgKyBwbGFjZSArIFwiLDJcIik7XG4gICAgICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS5yZW1vdmVOYXRpdmVBZChwbGFjZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNjLmxvZyhcInJlbW92ZU5hdGl2ZUFkOlwiICsgcGxhY2UgKyBcIiwzXCIpO1xuICAgICAgICAgICAgICAgIGdhbWUuY3Jvc3NQcm9tTWFuLnJlbW92ZUNyb3NzUHJvbUFkKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zaG91bGRTaG93TmF0aXZlQWQgPSB0cnVlO1xuICAgIH0sXG5cbiAgICBzZXRJbnRlcnN0aXRpYWxTaG93ZWQ6IGZ1bmN0aW9uIChwbGFjZSkge1xuICAgICAgICB0aGlzLmFkUGxhY2VNYXBbcGxhY2VdLmxhc3RTaG93VGltZSA9IERhdGUubm93KCk7XG4gICAgfSxcblxuICAgIHNob3dDcm9zc1Byb21vdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLnNob3dDcm9zc1Byb21vdGVBZCgpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGlzUmV3YXJkVmlkZW9SZWFkeTogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICByZXR1cm4ganNiX2RwLm9uZVNka0JyaWRnZS5pc1Jld2FyZFZpZGVvUmVhZHkoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIHNob3dSZXdhcmRWaWRlb0FkOiBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICBpZiAoIXRoaXMuaXNSZXdhcmRWaWRlb1JlYWR5KCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmVuYWJsZWRJbnRlcnN0aXRpYWwoZmFsc2UpO1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLnNob3dSZXdhcmRWaWRlb0FkKG5hbWUpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGVuYWJsZWRJbnRlcnN0aXRpYWw6IGZ1bmN0aW9uIChlbmFibGVkKSB7XG4gICAgICAgIHRoaXMuZW5hYmxlZEludGVyc3RpdGlhbEFkID0gZW5hYmxlZDtcbiAgICB9LFxuXG4gICAgZGlzYWJsZUludGVyc3RpdGlhbFdpdGhUaW1lOiBmdW5jdGlvbiAoc2Vjb25kcykge1xuICAgICAgICB0aGlzLmRpc2FibGVJbnRlcnN0aXRpYWxUaW1lID0gRGF0ZS5ub3coKSArIHNlY29uZHMgKiAxMDAwO1xuICAgIH0sXG5cbiAgICBvbkFkRmluaXNoZWRKc2I6IGZ1bmN0aW9uIChzdHIpIHtcbiAgICAgICAgY2MubG9nKFwib25BZEZpbmlzaGVkSnNiOlwiICsgc3RyKTtcbiAgICAgICAgdmFyIGFkc0ZpbmlzaGVkT2JqID0gSlNPTi5wYXJzZShzdHIpO1xuICAgICAgICB2YXIgY2hhbm5lbE5hbWUgPSBhZHNGaW5pc2hlZE9ialtcImNoYW5uZWxOYW1lXCJdO1xuICAgICAgICBjYy5sb2coXCJjaGFubmVsIDpcIiArIGNoYW5uZWxOYW1lICsgXCIgc2hvdyBpbnRlcnN0aXRpYWwgYWRzIGZpbmlzaGVkXCIpO1xuXG4gICAgICAgIGlmICh0aGlzLmFkTGlzdGVuZXIgJiYgdGhpcy5hZExpc3RlbmVyLm9uSW50ZXJzdGl0aWFsQWRFbmQpIHtcbiAgICAgICAgICAgIHRoaXMuYWRMaXN0ZW5lci5vbkludGVyc3RpdGlhbEFkRW5kKGNoYW5uZWxOYW1lKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZ2FtZS5nYW1lTWFuLmlzTmV3QWRzU2hvd1R5cGUoKSkge1xuICAgICAgICAgICAgdGhpcy5hZFBsYWNlTWFwW3RoaXMucGxhY2VdLmxhc3RTaG93VGltZSA9IERhdGUubm93KCk7XG4gICAgICAgIH1cbiAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiV2F0Y2hJU1NvdXJjZUVuZFwiLCB7bmFtZTogQWRzUGxhY2UuZ2V0TmFtZSh0aGlzLnBsYWNlKSwgY2hhbm5lbDogY2hhbm5lbE5hbWV9KTtcbiAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uYWRkSW50ZXJzdGl0aWFsQWRDb3VudCgpO1xuICAgICAgICB0aGlzLmRpc2FibGVJbnRlcnN0aXRpYWxXaXRoVGltZSg1KTtcbiAgICAgICAgaWYgKHRoaXMuaW50ZXJzdGl0aWFsRW5kQ2FsbGJhY2sgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5pbnRlcnN0aXRpYWxFbmRDYWxsYmFjaygpO1xuICAgICAgICAgICAgdGhpcy5pbnRlcnN0aXRpYWxFbmRDYWxsYmFjayA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgb25WaWRlb0FkRmluaXNoZWRKc2I6IGZ1bmN0aW9uIChzdHIpIHtcbiAgICAgICAgY2MubG9nKFwib25WaWRlb0FkRmluaXNoZWRKc2I6XCIgKyBzdHIpO1xuICAgICAgICB2YXIgYWRzRmluaXNoZWRPYmogPSBKU09OLnBhcnNlKHN0cik7XG4gICAgICAgIHZhciBpc1NraXBwZWQgPSBhZHNGaW5pc2hlZE9iai5pc1NraXBwZWQ7XG4gICAgICAgIHZhciBjaGFubmVsTmFtZSA9IGFkc0ZpbmlzaGVkT2JqLmNoYW5uZWxOYW1lO1xuICAgICAgICBpZiAoIWlzU2tpcHBlZCkge1xuICAgICAgICAgICAgY2MubG9nKFwicmV3YXJkIHZpZGVvIGFkcyBzaG93IHN1Y2Nlc3NcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYy5sb2coXCJyZXdhcmQgdmlkZW8gYWRzIHNraXBwZWRcIik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5hZExpc3RlbmVyICYmIHRoaXMuYWRMaXN0ZW5lci5vblJld2FyZGVkVmlkZW9GaW5pc2hlZCkge1xuICAgICAgICAgICAgdGhpcy5hZExpc3RlbmVyLm9uUmV3YXJkZWRWaWRlb0ZpbmlzaGVkKCFpc1NraXBwZWQsIGNoYW5uZWxOYW1lKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWlzU2tpcHBlZCkge1xuICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uYWRkUmV3YXJkZWRBZENvdW50KCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgb25TaG93VmlkZW9BZEJlZ2luSnNiOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLmFkTGlzdGVuZXIgJiYgdGhpcy5hZExpc3RlbmVyLm9uU2hvd1ZpZGVvQWRCZWdpbikge1xuICAgICAgICAgICAgdGhpcy5hZExpc3RlbmVyLm9uU2hvd1ZpZGVvQWRCZWdpbigpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uU2hvd1ZpZGVvQWRFbmRKc2I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuYWRMaXN0ZW5lciAmJiB0aGlzLmFkTGlzdGVuZXIub25TaG93VmlkZW9BZEVuZCkge1xuICAgICAgICAgICAgdGhpcy5hZExpc3RlbmVyLm9uU2hvd1ZpZGVvQWRFbmQoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmVuYWJsZWRJbnRlcnN0aXRpYWwodHJ1ZSk7XG4gICAgICAgIHRoaXMubGFzdFJld2FyZGVkVGltZSA9IERhdGUubm93KCk7XG4gICAgfVxufSk7XG5cbkFkc01hbmFnZXIuc2hhcmVkRGlyZWN0b3IgPSBudWxsO1xuQWRzTWFuYWdlci5maXJzdFVzZURpcmVjdG9yID0gdHJ1ZTtcblxuQWRzTWFuYWdlci5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoQWRzTWFuYWdlci5maXJzdFVzZURpcmVjdG9yKSB7XG4gICAgICAgIEFkc01hbmFnZXIuZmlyc3RVc2VEaXJlY3RvciA9IGZhbHNlO1xuICAgICAgICBBZHNNYW5hZ2VyLnNoYXJlZERpcmVjdG9yID0gbmV3IEFkc01hbmFnZXIoKTtcbiAgICB9XG4gICAgcmV0dXJuIEFkc01hbmFnZXIuc2hhcmVkRGlyZWN0b3I7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEFkc01hbmFnZXI7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IG95ZSBvbiAxNS01LTE3LlxuICovXG5cbnZhciBBbmFseXNlTWFuYWdlciA9IGNjLkNsYXNzLmV4dGVuZCh7XG4gICAgZ19wQW5hbHl0aWNzOiBudWxsLFxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICB9LFxuXG4gICAgaW5pdEFuYWx5dGljczogZnVuY3Rpb24gKCkge1xuICAgIH0sXG5cbiAgICB0cmFja0xvZ2luRXZlbnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS50cmFja0xvZ2luKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGFtb3VudE51bVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBpdGVtVHlwZVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBpdGVtSWRcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gcmVjZWlwdFxuICAgICAqL1xuICAgIHRyYWNrUHVyY2hhc2VFdmVudDogZnVuY3Rpb24gKGFtb3VudE51bSwgaXRlbVR5cGUsIGl0ZW1JZCwgcmVjZWlwdCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLnRyYWNrUHVyY2hhc2UoYW1vdW50TnVtLCBpdGVtVHlwZSwgaXRlbUlkLCByZWNlaXB0KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICB0cmFja1N0YXJ0UHJvZ3Jlc3Npb25FdmVudDogZnVuY3Rpb24gKG5hbWUsIHZhbHVlKSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2UudHJhY2tTdGFydFByb2dyZXNzaW9uKG5hbWUsIHZhbHVlKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICB0cmFja0NvbXBsZXRlZFByb2dyZXNzaW9uRXZlbnQ6IGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLnRyYWNrQ29tcGxldGVkUHJvZ3Jlc3Npb24obmFtZSwgdmFsdWUpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHRyYWNrRmFpbGVkUHJvZ3Jlc3Npb25FdmVudDogZnVuY3Rpb24gKG5hbWUsIHZhbHVlKSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2UudHJhY2tGYWlsUHJvZ3Jlc3Npb24obmFtZSwgdmFsdWUpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIHRyYWNrIGVycm9yIGV2ZW50XG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGVycm9yTXNnXG4gICAgICovXG4gICAgdHJhY2tFcnJvckV2ZW50OiBmdW5jdGlvbiAoZXJyb3JNc2cpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS50cmFja0Vycm9yKGVycm9yTXNnKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICB0cmFja0V2ZW50OiBmdW5jdGlvbiAobmFtZSwgb2JqKSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIHZhciBpbmZvID0gXCJcIjtcbiAgICAgICAgICAgIGlmIChvYmopIHtcbiAgICAgICAgICAgICAgICBpbmZvID0gSlNPTi5zdHJpbmdpZnkob2JqKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2UudHJhY2tFdmVudChuYW1lLCBpbmZvKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBhZGRWaXJ0dWFsQ3VycmVuY3k6IGZ1bmN0aW9uIChyZWFzb24sIHZhbHVlKSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2UuYWRkVmlydHVhbEN1cnJlbmN5KHJlYXNvbiwgdmFsdWUpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGNvbnN1bWVWaXJ0dWFsQ3VycmVuY3k6IGZ1bmN0aW9uIChpdGVtTmFtZSwgaXRlbUNvdW50LCB2aXJ1dGFsQ3VycmVuY3kpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS5jb25zdW1lVmlydHVhbEN1cnJlbmN5KGl0ZW1OYW1lLCBpdGVtQ291bnQsIHZpcnV0YWxDdXJyZW5jeSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgY29uc3VtZUl0ZW06IGZ1bmN0aW9uIChpdGVtTmFtZSwgaXRlbUNvdW50KSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2UuY29uc3VtZUl0ZW0oaXRlbU5hbWUsIGl0ZW1Db3VudCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgdHJhY2tDaGFyZ2VSZXF1ZXN0OiBmdW5jdGlvbiAob3JkZXJJZCwgaWFwSWQsIGN1cnJlbmN5QW1vdW50LCBjdXJyZW5jeVR5cGUsIHZpcnR1YWxDdXJyZW5jeUFtb3VudCwgcGF5bWVudFR5cGUpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS50cmFja0NoYXJnZVJlcXVlc3Qob3JkZXJJZCwgaWFwSWQsIGN1cnJlbmN5QW1vdW50LCBjdXJyZW5jeVR5cGUsIHZpcnR1YWxDdXJyZW5jeUFtb3VudCwgcGF5bWVudFR5cGUpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHRyYWNrQ2hhcmdlU3VjY2VzczogZnVuY3Rpb24gKG9yZGVySWQpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS50cmFja0NoYXJnZVN1Y2Nlc3Mob3JkZXJJZCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgbWlzc2lvbkJlZ2FuOiBmdW5jdGlvbiAobWlzc2lvbklkKSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2UubWlzc2lvbkJlZ2FuKG1pc3Npb25JZCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgbWlzc2lvbkNvbXBsZXRlZDogZnVuY3Rpb24gKG1pc3Npb25JZCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLm1pc3Npb25Db21wbGV0ZWQobWlzc2lvbklkKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBtaXNzaW9uRmFpbGVkOiBmdW5jdGlvbiAobWlzc2lvbklkLCByZWFzb24pIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS5taXNzaW9uRmFpbGVkKG1pc3Npb25JZCwgcmVhc29uKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICB0cmFja1BsYXllckxldmVsOiBmdW5jdGlvbiAobGV2ZWwpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS5zZXRQbGF5ZXJMZXZlbChsZXZlbCk7XG4gICAgICAgIH1cbiAgICB9XG59KTtcblxuQW5hbHlzZU1hbmFnZXIuc2hhcmVkRGlyZWN0b3IgPSBudWxsO1xuQW5hbHlzZU1hbmFnZXIuZmlyc3RVc2VEaXJlY3RvciA9IHRydWU7XG5cbkFuYWx5c2VNYW5hZ2VyLmdldEluc3RhbmNlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChBbmFseXNlTWFuYWdlci5maXJzdFVzZURpcmVjdG9yKSB7XG4gICAgICAgIEFuYWx5c2VNYW5hZ2VyLmZpcnN0VXNlRGlyZWN0b3IgPSBmYWxzZTtcbiAgICAgICAgQW5hbHlzZU1hbmFnZXIuc2hhcmVkRGlyZWN0b3IgPSBuZXcgQW5hbHlzZU1hbmFnZXIoKTtcbiAgICB9XG4gICAgcmV0dXJuIEFuYWx5c2VNYW5hZ2VyLnNoYXJlZERpcmVjdG9yO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBBbmFseXNlTWFuYWdlcjsiLCIvKipcbiAqIENyZWF0ZWQgYnkgb3llIG9uIDE1LTUtMTcuXG4gKi9cbnZhciBDYXB0dXJlTGlzdGVuZXIgPSBjYy5DbGFzcy5leHRlbmQoe1xuICAgIG9uQ2FwdHVyZUF1ZGlvOiBmdW5jdGlvbiAoYXVkaW9EZWNpYmxlKSB7XG4gICAgfVxufSk7XG5cblxudmFyIENhcHR1cmVNYW5hZ2VyID0gY2MuQ2xhc3MuZXh0ZW5kKHtcblxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS5vbkNhcHR1cmVBdWRpbyA9IHRoaXMub25DYXB0dXJlQXVkaW8uYmluZCh0aGlzKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXRDYXB0dXJlTGlzdGVuZXI6IGZ1bmN0aW9uIChsaXN0ZW5lcikge1xuICAgICAgICB0aGlzLmxpc3RlbmVyID0gbGlzdGVuZXI7XG4gICAgfSxcblxuICAgIGNhcHR1cmVBdWRpbzogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLmNhcHR1cmVBdWRpbygpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldEF1ZGlvRGVjaWJsZTogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICByZXR1cm4ganNiX2RwLm9uZVNka0JyaWRnZS5nZXRBdWRpb0RlY2libGUoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gMDtcbiAgICB9LFxuXG4gICAgb25DYXB0dXJlQXVkaW86IGZ1bmN0aW9uIChhdWRpb0RlY2libGVTdHJpbmcpIHtcbiAgICAgICAgdmFyIGF1ZGlvT2JqID0gSlNPTi5wYXJzZShhdWRpb0RlY2libGVTdHJpbmcpO1xuICAgICAgICB2YXIgYXVkaW9EZWNpYmxlID0gYXVkaW9PYmpbXCJhdWRpb0RlY2libGVcIl07XG4gICAgICAgIGlmICh0aGlzLmxpc3RlbmVyKSB7XG4gICAgICAgICAgICB0aGlzLmxpc3RlbmVyLm9uQ2FwdHVyZUF1ZGlvKGF1ZGlvRGVjaWJsZSk7XG4gICAgICAgIH1cbiAgICB9XG59KTtcblxuQ2FwdHVyZU1hbmFnZXIuc2hhcmVkRGlyZWN0b3IgPSBudWxsO1xuQ2FwdHVyZU1hbmFnZXIuZmlyc3RVc2VEaXJlY3RvciA9IHRydWU7XG5cbkNhcHR1cmVNYW5hZ2VyLmdldEluc3RhbmNlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChDYXB0dXJlTWFuYWdlci5maXJzdFVzZURpcmVjdG9yKSB7XG4gICAgICAgIENhcHR1cmVNYW5hZ2VyLmZpcnN0VXNlRGlyZWN0b3IgPSBmYWxzZTtcbiAgICAgICAgQ2FwdHVyZU1hbmFnZXIuc2hhcmVkRGlyZWN0b3IgPSBuZXcgQ2FwdHVyZU1hbmFnZXIoKTtcbiAgICB9XG4gICAgcmV0dXJuIENhcHR1cmVNYW5hZ2VyLnNoYXJlZERpcmVjdG9yO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBDYXB0dXJlTWFuYWdlcjsiLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAyMDE3LzgvMjkuXG4gKi9cblxudmFyIEh0dHBDbGllbnQgPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uL25ldC9IdHRwQ2xpZW50XCIpO1xudmFyIERvd25sb2FkZXIgPSByZXF1aXJlKFwiLi4vYXNzZXRzL0Rvd25sb2FkZXJcIik7XG5cbnZhciBDcm9zc1Byb21EYXRhID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuc2NvcmVMaW1pdCA9IDA7XG4gICAgdGhpcy5pbWFnZVVybCA9IFwiXCI7XG4gICAgdGhpcy5kb3dubG9hZFVybCA9IFwiXCI7XG4gICAgdGhpcy53ZWlnaHQgPSAwO1xuICAgIHRoaXMuYXBwSWQgPSBcIlwiO1xufTtcblxudmFyIENyb3NzQWRDb25maWcgPSBmdW5jdGlvbiAoanNvbk9iaikge1xuICAgIHRoaXMuaWQgPSBqc29uT2JqW1wiaWRcIl0gfHwgMTtcbiAgICB0aGlzLm5hbWUgPSBqc29uT2JqW1wibmFtZVwiXTtcbiAgICB0aGlzLmRlc2MgPSBqc29uT2JqW1wiZGVzY1wiXTtcbiAgICB0aGlzLndlaWdodCA9IGpzb25PYmpbXCJ3ZWlnaHRcIl0gfHwgMTtcbiAgICB0aGlzLnZpZGVvVXJsID0ganNvbk9ialtcInZpZGVvVXJsXCJdO1xuICAgIHRoaXMuaW9zVXJsID0ganNvbk9ialtcImlvc1VybFwiXTtcbiAgICB0aGlzLmFuZHJvaWRVcmwgPSBqc29uT2JqW1wiYW5kcm9pZFVybFwiXTtcbn07XG5cbkNyb3NzQWRDb25maWcucHJvdG90eXBlLmdldERvd25sb2FkVXJsID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChjYy5zeXMub3MgPT09IGNjLnN5cy5PU19BTkRST0lEKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFuZHJvaWRVcmw7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmlvc1VybDtcbn07XG5cbnZhciBDcm9zc1Byb21NYW5hZ2VyID0gY2MuQ2xhc3MuZXh0ZW5kKHtcbiAgICBjYWNoZWRUZXh0dXJlOiBudWxsLFxuICAgIGNhY2hlZENvbmZpZzogbnVsbCxcbiAgICBjcm9zc1Byb21zOiBudWxsLFxuXG4gICAgdmlkZW9Dcm9zc1Byb21zOiBudWxsLFxuXG4gICAgLy8gdmlkZW9Eb3dubG9hZGVkOiBmYWxzZSxcblxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICB9LFxuXG4gICAgdHJ5VG9Mb2FkRnJvbVJlbW90ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgY3Jvc3NQcm9tVXJsID0gZ2FtZS5jb25maWcuZ2V0Q3Jvc3NQcm9tVXJsKCk7XG5cbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICBIdHRwQ2xpZW50LmRvR2V0KGNyb3NzUHJvbVVybCwgZnVuY3Rpb24gKGVycm9yLCB0ZXh0KSB7XG4gICAgICAgICAgICBpZiAoIWVycm9yKSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgY2MubG9nKFwiY3Jvc3MgcHJvbW90aW9uIHRyeVRvTG9hZEZyb21SZW1vdGUgZG93bmxvYWRlZDpcIiArIHRleHQpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2UodGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvcGVuID0gZGF0YS5vcGVuIHx8IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIW9wZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2YXIgc2NvcmVMaW1pdCA9IGRhdGEuc2NvcmVMaW1pdCB8fCAwO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghY2MuaXNVbmRlZmluZWQoZ2FtZS5wbGF5ZXJNYW4ucGxheWVyLmxldmVsKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdhbWUucGxheWVyTWFuLnBsYXllci5sZXZlbCA8IHNjb3JlTGltaXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdmFyIG1heFBvcENvdW50ID0gZGF0YS5tYXhQb3BDb3VudCB8fCAzO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmRvd25sb2FkZWRTaG93ID0gZGF0YS5kb3dubG9hZGVkU2hvdyB8fCBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5jcm9zc1Byb21zID0gZGF0YVtcImNyb3NzUHJvbXNcIl07XG4gICAgICAgICAgICAgICAgICAgIHZhciB2aWRlb0Nyb3NzUHJvbXMgPSBkYXRhW1widmlkZW9Dcm9zc1Byb21zXCJdO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnZpZGVvQ3Jvc3NQcm9tcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZpZGVvQ3Jvc3NQcm9tcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNyb3NzUHJvbSA9IG5ldyBDcm9zc0FkQ29uZmlnKHZpZGVvQ3Jvc3NQcm9tc1tpXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnZpZGVvQ3Jvc3NQcm9tcy5wdXNoKGNyb3NzUHJvbSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBzZWxmLm1heFBvcENvdW50ID0gbWF4UG9wQ291bnQ7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYudHJ5VG9Eb3dubG9hZFByb21vSW1nKCk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYudHJ5VG9Eb3dubG9hZFByb21WaWRlbygpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICB0cnlUb0Rvd25sb2FkUHJvbVZpZGVvOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNjLmxvZyhcInRyeVRvRG93bmxvYWRQcm9tVmlkZW86MVwiKTtcbiAgICAgICAgaWYgKHRoaXMudmlkZW9Dcm9zc1Byb21zICYmIHRoaXMudmlkZW9Dcm9zc1Byb21zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNjLmxvZyhcInRyeVRvRG93bmxvYWRQcm9tVmlkZW86MixsZW5ndGg6XCIgKyB0aGlzLnZpZGVvQ3Jvc3NQcm9tcy5sZW5ndGgpO1xuICAgICAgICAgICAgdmFyIGRvd25sb2FkZXIgPSBEb3dubG9hZGVyLmdldEluc3RhbmNlKCk7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudmlkZW9Dcm9zc1Byb21zLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbmZpZyA9IHRoaXMudmlkZW9Dcm9zc1Byb21zW2ldO1xuICAgICAgICAgICAgICAgIGNjLmxvZyhcInRyeVRvRG93bmxvYWRQcm9tVmlkZW86Mi0xXCIpO1xuICAgICAgICAgICAgICAgIHZhciBzdG9yYWdlUGF0aCA9IGpzYi5maWxlVXRpbHMuZ2V0V3JpdGFibGVQYXRoKCkgKyBcIi9jcm9zcy12aWRlby1cIiArIGNvbmZpZy5pZCArIFwiLm1wNFwiO1xuICAgICAgICAgICAgICAgIGNjLmxvZyhcInRyeVRvRG93bmxvYWRQcm9tVmlkZW86Mi0zXCIpO1xuICAgICAgICAgICAgICAgIGlmIChnYW1lLnV0aWxzLmlzRmlsZUV4aXN0KHN0b3JhZ2VQYXRoKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25maWcudmlkZW9Eb3dubG9hZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgY2MubG9nKFwidHJ5VG9Eb3dubG9hZFByb21WaWRlbzozOmlkOlwiICsgY29uZmlnLmlkKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjYy5sb2coXCJ0cnlUb0Rvd25sb2FkUHJvbVZpZGVvOjRcIik7XG4gICAgICAgICAgICAgICAgICAgIGRvd25sb2FkZXIuZG93bmxvYWQoY29uZmlnLnZpZGVvVXJsLCBzdG9yYWdlUGF0aCwgY29uZmlnLCBmdW5jdGlvbiAocCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2MubG9nKFwidHJ5VG9Eb3dubG9hZFByb21WaWRlbzpkb3dubG9hZGVkOlwiICsgcC5pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBwLnZpZGVvRG93bmxvYWRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBjYy5sb2coXCJ0cnlUb0Rvd25sb2FkUHJvbVZpZGVvOjVcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIHRyeVRvRG93bmxvYWRQcm9tb0ltZzogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5tYXhQb3BDb3VudCA8PSAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY2FjaGVkQ29uZmlnIHx8IHRoaXMuY2FjaGVkVGV4dHVyZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubWF4UG9wQ291bnQtLTtcbiAgICAgICAgY2MubG9nKFwiY3Jvc3MgcHJvbW90aW9uIHRyeVRvRG93bmxvYWRQcm9tb0ltZyBjaGVja1wiKTtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICBpZiAoIWNjLmlzVW5kZWZpbmVkKHRoaXMuY3Jvc3NQcm9tcykgJiYgY2MuaXNBcnJheSh0aGlzLmNyb3NzUHJvbXMpICYmIHRoaXMuY3Jvc3NQcm9tcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB2YXIgcmFuZG9tQ29uZmlnID0gdGhpcy5nZXRSYW5kb21Db25maWcodGhpcy5jcm9zc1Byb21zKTtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlQ3Jvc3NQcm9tb0NmZyhyYW5kb21Db25maWcpO1xuICAgICAgICAgICAgLy9nYW1lLnV0aWxzLmRvd25sb2FkXG4gICAgICAgICAgICBjYy5sb2coXCJjcm9zcyBwcm9tb3Rpb24gdHJ5VG9Eb3dubG9hZFByb21vSW1nIHN0YXJ0IGRvd25sb2FkXCIpO1xuICAgICAgICAgICAgZ2FtZS51dGlscy5sb2FkUmVtb3RlSW1nKHJhbmRvbUNvbmZpZy5pbWFnZVVybCwgZnVuY3Rpb24gKGVycm9yLCB0ZXgsIGV4dHJhKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFlcnJvciAmJiB0ZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2MubG9nKFwiY3Jvc3MgcHJvbW90aW9uIHRyeVRvRG93bmxvYWRQcm9tb0ltZyBkb3dubG9hZGVkOlwiICsgc2VsZi5kb3dubG9hZGVkU2hvdyk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuY2FjaGVkVGV4dHVyZSA9IHRleDtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5jYWNoZWRUZXh0dXJlLnJldGFpbigpO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmNhY2hlZENvbmZpZyA9IHJhbmRvbUNvbmZpZztcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGYuZG93bmxvYWRlZFNob3cpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZG93bmxvYWRlZFNob3cgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudHJ5VG9Qb3B1cENyb3NzUHJvbURsZygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgbnVsbCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcmVtb3ZlQ3Jvc3NQcm9tb0NmZzogZnVuY3Rpb24gKGNyb3NzUHJvbUNmZykge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY3Jvc3NQcm9tcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuY3Jvc3NQcm9tc1tpXSA9PT0gY3Jvc3NQcm9tQ2ZnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jcm9zc1Byb21zLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cblxuICAgIGdldFJhbmRvbUNvbmZpZzogZnVuY3Rpb24gKGNyb3NzUHJvbXMpIHtcbiAgICAgICAgdmFyIHRvdGFsV2VpZ2h0ID0gMDtcbiAgICAgICAgdmFyIGk7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBjcm9zc1Byb21zLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB0b3RhbFdlaWdodCArPSBjcm9zc1Byb21zW2ldLndlaWdodDtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciByYW5kb21OdW0gPSBnYW1lLnV0aWxzLnJhbmRvbU5leHRJbnQodG90YWxXZWlnaHQpO1xuXG4gICAgICAgIHZhciBjdXJXZWlnaHQgPSAwO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY3Jvc3NQcm9tcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgY3VyV2VpZ2h0ICs9IGNyb3NzUHJvbXNbaV0ud2VpZ2h0O1xuICAgICAgICAgICAgaWYgKGN1cldlaWdodCA+IHJhbmRvbU51bSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjcm9zc1Byb21zW2ldO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGNyb3NzUHJvbXNbMF07XG4gICAgfSxcblxuICAgIHBvcHVwQ3Jvc3NQcm9tRGxnOiBmdW5jdGlvbiAoY3Jvc3NQcm9tc0NvbmZpZywgdGV4dHVyZSkge1xuICAgICAgICB2YXIgQ3Jvc3NQcm9tQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL0Nyb3NzUHJvbUNvbnRyb2xsZXJcIik7XG4gICAgICAgIHZhciBjcm9zc1Byb21Ob2RlID0gQ3Jvc3NQcm9tQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKFwicmVzL2Nyb3NzL2Nyb3NzX3Byb21fdmlldy5jY2JpXCIpO1xuICAgICAgICBjcm9zc1Byb21Ob2RlLmNvbnRyb2xsZXIuaW5pdFdpdGgoY3Jvc3NQcm9tc0NvbmZpZywgdGV4dHVyZSk7XG4gICAgICAgIGNyb3NzUHJvbU5vZGUuY29udHJvbGxlci5wb3B1cCgpO1xuICAgIH0sXG5cbiAgICB0cnlUb1BvcHVwQ3Jvc3NQcm9tRGxnOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNjLmxvZyhcImNyb3NzIHByb21vdGlvbiB0cnlUb1BvcHVwQ3Jvc3NQcm9tRGxnIHN0YXJ0XCIpO1xuICAgICAgICBpZiAodGhpcy5jYWNoZWRDb25maWcgJiYgdGhpcy5jYWNoZWRUZXh0dXJlKSB7XG4gICAgICAgICAgICBjYy5sb2coXCJjcm9zcyBwcm9tb3Rpb24gdHJ5VG9Qb3B1cENyb3NzUHJvbURsZyBwb3BlZFwiKTtcbiAgICAgICAgICAgIHRoaXMucG9wdXBDcm9zc1Byb21EbGcodGhpcy5jYWNoZWRDb25maWcsIHRoaXMuY2FjaGVkVGV4dHVyZSk7XG4gICAgICAgICAgICB0aGlzLmNhY2hlZFRleHR1cmUucmVsZWFzZSgpO1xuICAgICAgICAgICAgdGhpcy5jYWNoZWRDb25maWcgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5jYWNoZWRUZXh0dXJlID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMudHJ5VG9Eb3dubG9hZFByb21vSW1nKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgaGFzQ3Jvc3NQcm9tQWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMudmlkZW9Dcm9zc1Byb21zICYmIHRoaXMudmlkZW9Dcm9zc1Byb21zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy52aWRlb0Nyb3NzUHJvbXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy52aWRlb0Nyb3NzUHJvbXNbaV0udmlkZW9Eb3dubG9hZGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIHNlbGVjdFZpZGVvQ3Jvc3NQcm9tOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLmxhc3RDb25maWcgJiYgKERhdGUubm93KCkgLSB0aGlzLmxhc3RDb25maWcudGltZSkgPCAzMDAwMCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubGFzdENvbmZpZztcbiAgICAgICAgfVxuICAgICAgICB2YXIgY29uZmlncyA9IFtdO1xuICAgICAgICB2YXIgdG90YWxXZWlnaHQgPSAwO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudmlkZW9Dcm9zc1Byb21zLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB2YXIgY29uZmlnID0gdGhpcy52aWRlb0Nyb3NzUHJvbXNbaV07XG4gICAgICAgICAgICBpZiAoY29uZmlnLnZpZGVvRG93bmxvYWRlZCkge1xuICAgICAgICAgICAgICAgIGNvbmZpZ3MucHVzaChjb25maWcpO1xuICAgICAgICAgICAgICAgIHRvdGFsV2VpZ2h0ICs9IGNvbmZpZy53ZWlnaHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHJhbmRvbU51bSA9IGdhbWUudXRpbHMucmFuZG9tTmV4dEludCh0b3RhbFdlaWdodCk7XG4gICAgICAgIHZhciBjdXJyZW50V2VpZ2h0ID0gMDtcbiAgICAgICAgdmFyIHNlbGVjdENvbmZpZyA9IG51bGw7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY29uZmlncy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgY3VycmVudFdlaWdodCArPSBjb25maWdzW2ldLndlaWdodDtcbiAgICAgICAgICAgIGlmIChjdXJyZW50V2VpZ2h0ID4gcmFuZG9tTnVtKSB7XG4gICAgICAgICAgICAgICAgc2VsZWN0Q29uZmlnID0gY29uZmlnc1tpXTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxhc3RDb25maWcgPSBzZWxlY3RDb25maWc7XG4gICAgICAgIHRoaXMubGFzdENvbmZpZy50aW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgcmV0dXJuIHNlbGVjdENvbmZpZztcbiAgICB9LFxuXG4gICAgc2hvd0Nyb3NzUHJvbUFkOiBmdW5jdGlvbiAod29ybGRQb3MsIHNpemUpIHtcbiAgICAgICAgaWYgKHRoaXMuY3Jvc3NQcm9tTm9kZSkge1xuICAgICAgICAgICAgdGhpcy5jcm9zc1Byb21Ob2RlLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgdmFyIHJhbmRvbUNvbmZpZyA9IHRoaXMuc2VsZWN0VmlkZW9Dcm9zc1Byb20oKTtcbiAgICAgICAgICAgIHRoaXMuY3Jvc3NQcm9tTm9kZS5jb250cm9sbGVyLnNob3dWaWRlbyhyYW5kb21Db25maWcpO1xuICAgICAgICAgICAgY2MuZGlyZWN0b3IuZ2V0UnVubmluZ1NjZW5lKCkuYWRkQ2hpbGQodGhpcy5jcm9zc1Byb21Ob2RlLCAxMDAwMDApO1xuICAgICAgICAgICAgdGhpcy5jcm9zc1Byb21Ob2RlLnJlbGVhc2UoKTtcbiAgICAgICAgICAgIHRoaXMuY3Jvc3NQcm9tTm9kZS5zZXRQb3NpdGlvbih3b3JsZFBvcyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjYy5sb2coXCJzaG93Q3Jvc3NQcm9tQWQ6XCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnZpZGVvQ3Jvc3NQcm9tcykpO1xuICAgICAgICBpZiAodGhpcy52aWRlb0Nyb3NzUHJvbXMgJiYgdGhpcy52aWRlb0Nyb3NzUHJvbXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdmFyIHJhbmRvbUNvbmZpZyA9IHRoaXMuc2VsZWN0VmlkZW9Dcm9zc1Byb20oKTtcbiAgICAgICAgICAgIGNjLmxvZyhcInNob3dDcm9zc1Byb21BZDpcIiArIEpTT04uc3RyaW5naWZ5KHJhbmRvbUNvbmZpZykpO1xuICAgICAgICAgICAgdmFyIENyb3NzQWRzQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL0Nyb3NzQWRzQ29udHJvbGxlclwiKTtcbiAgICAgICAgICAgIHZhciBub2RlID0gQ3Jvc3NBZHNDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgICAgIGNjLmRpcmVjdG9yLmdldFJ1bm5pbmdTY2VuZSgpLmFkZENoaWxkKG5vZGUsIDEwMDAwMCk7XG4gICAgICAgICAgICBub2RlLmNvbnRyb2xsZXIuaW5pdFdpdGgocmFuZG9tQ29uZmlnLCBzaXplKTtcbiAgICAgICAgICAgIG5vZGUuc2V0UG9zaXRpb24od29ybGRQb3MpO1xuICAgICAgICAgICAgdGhpcy5jcm9zc1Byb21Ob2RlID0gbm9kZTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByZW1vdmVDcm9zc1Byb21BZDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5jcm9zc1Byb21Ob2RlKSB7XG4gICAgICAgICAgICB0aGlzLmNyb3NzUHJvbU5vZGUudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5jcm9zc1Byb21Ob2RlLmNvbnRyb2xsZXIuaGlkZVZpZGVvKCk7XG4gICAgICAgICAgICB0aGlzLmNyb3NzUHJvbU5vZGUucmV0YWluKCk7XG4gICAgICAgICAgICB0aGlzLmNyb3NzUHJvbU5vZGUucmVtb3ZlRnJvbVBhcmVudChmYWxzZSk7XG5cbiAgICAgICAgfVxuICAgIH1cbn0pO1xuXG5Dcm9zc1Byb21NYW5hZ2VyLnNoYXJlZERpcmVjdG9yID0gbnVsbDtcbkNyb3NzUHJvbU1hbmFnZXIuZmlyc3RVc2VEaXJlY3RvciA9IHRydWU7XG5cbkNyb3NzUHJvbU1hbmFnZXIuZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKENyb3NzUHJvbU1hbmFnZXIuZmlyc3RVc2VEaXJlY3Rvcikge1xuICAgICAgICBDcm9zc1Byb21NYW5hZ2VyLmZpcnN0VXNlRGlyZWN0b3IgPSBmYWxzZTtcbiAgICAgICAgQ3Jvc3NQcm9tTWFuYWdlci5zaGFyZWREaXJlY3RvciA9IG5ldyBDcm9zc1Byb21NYW5hZ2VyKCk7XG4gICAgfVxuICAgIHJldHVybiBDcm9zc1Byb21NYW5hZ2VyLnNoYXJlZERpcmVjdG9yO1xufTtcblxuXG5tb2R1bGUuZXhwb3J0cyA9IENyb3NzUHJvbU1hbmFnZXI7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IG95ZSBvbiAxNS01LTE3LlxuICovXG52YXIgR0NNYW5hZ2VyID0gY2MuQ2xhc3MuZXh0ZW5kKHtcblxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICB9LFxuXG4gICAgaXNHYW1lQ2VudGVyQXZhaWxhYmxlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIHJldHVybiBqc2JfZHAub25lU2RrQnJpZGdlLmlzR2FtZUNlbnRlckF2YWlsYWJsZSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgcmVwb3J0U2NvcmU6IGZ1bmN0aW9uIChzY29yZSwgbGVhZGVyQm9hcmRLZXkpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS5yZXBvcnRTY29yZShzY29yZSwgbGVhZGVyQm9hcmRLZXkpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNob3dMZWFkZXJib2FyZDogZnVuY3Rpb24gKGxlYWRlckJvYXJkS2V5KSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2Uuc2hvd0xlYWRlcmJvYXJkKGxlYWRlckJvYXJkS2V5KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByZXBvcnRBY2hpZXZlbWVudDogZnVuY3Rpb24gKHBlcmNlbnRDb21wbGV0ZWQsIGFyY2hpZXZlbWVudEtleSkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLnJlcG9ydEFjaGlldmVtZW50KHBlcmNlbnRDb21wbGV0ZWQsIGFyY2hpZXZlbWVudEtleSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2hvd0FjaGlldmVtZW50czogZnVuY3Rpb24gKGxlYWRlckJvYXJka2V5KSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2Uuc2hvd0FjaGlldmVtZW50cyhsZWFkZXJCb2FyZGtleSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgaGlnaFNjb3JlRm9yTGVhZGVyYm9hcmQ6IGZ1bmN0aW9uIChsZWFkZXJCb2FyZEtleSkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICByZXR1cm4ganNiX2RwLm9uZVNka0JyaWRnZS5oaWdoU2NvcmVGb3JMZWFkZXJib2FyZChsZWFkZXJCb2FyZEtleSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfSxcblxuICAgIHByb2dyZXNzRm9yQWNoaWV2ZW1lbnQ6IGZ1bmN0aW9uIChhcmNoaWV2ZW1lbnRLZXkpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAgcmV0dXJuIGpzYl9kcC5vbmVTZGtCcmlkZ2UucHJvZ3Jlc3NGb3JBY2hpZXZlbWVudChhcmNoaWV2ZW1lbnRLZXkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbn0pO1xuXG5HQ01hbmFnZXIuc2hhcmVkRGlyZWN0b3IgPSBudWxsO1xuR0NNYW5hZ2VyLmZpcnN0VXNlRGlyZWN0b3IgPSB0cnVlO1xuXG5HQ01hbmFnZXIuZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKEdDTWFuYWdlci5maXJzdFVzZURpcmVjdG9yKSB7XG4gICAgICAgIEdDTWFuYWdlci5maXJzdFVzZURpcmVjdG9yID0gZmFsc2U7XG4gICAgICAgIEdDTWFuYWdlci5zaGFyZWREaXJlY3RvciA9IG5ldyBHQ01hbmFnZXIoKTtcbiAgICB9XG4gICAgcmV0dXJuIEdDTWFuYWdlci5zaGFyZWREaXJlY3Rvcjtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gR0NNYW5hZ2VyOyIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDIwMTcvMy8xMS5cbiAqL1xuXG52YXIgTG9jYWxpemF0aW9uTWFuYWdlciA9IGNjLkNsYXNzLmV4dGVuZCh7XG5cbiAgICBfaXNMb2FkZWQ6IGZhbHNlLFxuICAgIGN1ckxhbmd1YWdlOiBudWxsLFxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5sYW5ndWFnZSA9PT0gY2Muc3lzLkxBTkdVQUdFX0FSQUJJQyB8fFxuICAgICAgICAgICAgY2Muc3lzLmxhbmd1YWdlID09PSBjYy5zeXMuTEFOR1VBR0VfUlVTU0lBTiB8fFxuICAgICAgICAgICAgY2Muc3lzLmxhbmd1YWdlID09PSBjYy5zeXMuTEFOR1VBR0VfRlJFTkNIIHx8XG4gICAgICAgICAgICBjYy5zeXMubGFuZ3VhZ2UgPT09IGNjLnN5cy5MQU5HVUFHRV9TUEFOSVNIIHx8XG4gICAgICAgICAgICBjYy5zeXMubGFuZ3VhZ2UgPT09IGNjLnN5cy5MQU5HVUFHRV9JVEFMSUFOIHx8XG4gICAgICAgICAgICBjYy5zeXMubGFuZ3VhZ2UgPT09IGNjLnN5cy5MQU5HVUFHRV9HRVJNQU5cbiAgICAgICAgKSB7XG4gICAgICAgICAgICB2YXIgc2VhcmNoUGF0aEFyciA9IGpzYi5maWxlVXRpbHMuZ2V0U2VhcmNoUGF0aHMoKTtcbiAgICAgICAgICAgIHNlYXJjaFBhdGhBcnIudW5zaGlmdChcInJlcy9ydVwiKTtcbiAgICAgICAgICAgIGNjLmxvZyhcInNlYXJjaCBwYXRoczpcIiArIEpTT04uc3RyaW5naWZ5KHNlYXJjaFBhdGhBcnIpKTtcbiAgICAgICAgICAgIGpzYi5maWxlVXRpbHMuc2V0U2VhcmNoUGF0aHMoc2VhcmNoUGF0aEFycik7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcmVsb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLl9pc0xvYWRlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChnYW1lLnV0aWxzLmlzU2VsZkdhbWUoKSkge1xuICAgICAgICAgICAgdGhpcy5jdXJMYW5ndWFnZSA9IGdhbWUudXRpbHMubG9hZEpzb24oXCJyZXMvY29uZmlnL2xhbmd1YWdlcy9zdHJpbmdzLXpocy5qc29uXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIGZpbGVOYW1lID0gXCJyZXMvY29uZmlnL2xhbmd1YWdlcy9zdHJpbmdzLVwiICsgY2Muc3lzLmxhbmd1YWdlICsgXCIuanNvblwiO1xuICAgICAgICAgICAgY2MubG9nKFwibG9jYWwgZmlsZTpcIiArIGZpbGVOYW1lKTtcbiAgICAgICAgICAgIGlmIChnYW1lLnV0aWxzLmlzRmlsZUV4aXN0KGZpbGVOYW1lKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuY3VyTGFuZ3VhZ2UgPSBnYW1lLnV0aWxzLmxvYWRKc29uKGZpbGVOYW1lKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJMYW5ndWFnZSA9IGdhbWUudXRpbHMubG9hZEpzb24oXCJyZXMvY29uZmlnL2xhbmd1YWdlcy9zdHJpbmdzLWVuLmpzb25cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5faXNMb2FkZWQgPSB0cnVlO1xuICAgIH0sXG5cbiAgICBnZXRWYWx1ZTogZnVuY3Rpb24gKGtleSkge1xuICAgICAgICB2YXIgdmFsdWUgPSB0aGlzLmN1ckxhbmd1YWdlW2tleV0gfHwga2V5O1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgfSxcblxuICAgIGlzQ2hpbmVzZTogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoZ2FtZS51dGlscy5pc1NlbGZHYW1lKCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59KTtcblxuTG9jYWxpemF0aW9uTWFuYWdlci5zaGFyZWREaXJlY3RvciA9IG51bGw7XG5Mb2NhbGl6YXRpb25NYW5hZ2VyLmZpcnN0VXNlRGlyZWN0b3IgPSB0cnVlO1xuXG5Mb2NhbGl6YXRpb25NYW5hZ2VyLmdldEluc3RhbmNlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChMb2NhbGl6YXRpb25NYW5hZ2VyLmZpcnN0VXNlRGlyZWN0b3IpIHtcbiAgICAgICAgTG9jYWxpemF0aW9uTWFuYWdlci5maXJzdFVzZURpcmVjdG9yID0gZmFsc2U7XG4gICAgICAgIExvY2FsaXphdGlvbk1hbmFnZXIuc2hhcmVkRGlyZWN0b3IgPSBuZXcgTG9jYWxpemF0aW9uTWFuYWdlcigpO1xuICAgIH1cbiAgICByZXR1cm4gTG9jYWxpemF0aW9uTWFuYWdlci5zaGFyZWREaXJlY3Rvcjtcbn07XG5cblxubW9kdWxlLmV4cG9ydHMgPSBMb2NhbGl6YXRpb25NYW5hZ2VyOyIsIi8qKlxuICogQ3JlYXRlZCBieSBveWUgb24gMTUtNS0xNy5cbiAqL1xudmFyIE5vdGlmaWNhdGlvbk1hbmFnZXIgPSBjYy5DbGFzcy5leHRlbmQoe1xuXG4gICAgY3RvcjogZnVuY3Rpb24gKCkge1xuICAgIH0sXG5cbiAgICByZWdpc3Rlck5vdGlmaWNhdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLnJlZ2lzdGVyTm90aWZpY2F0aW9uKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdGltZUZyb21Ob3dcbiAgICAgKiBAcGFyYW0gYWxlcnRUZXh0XG4gICAgICogQHBhcmFtIGFsZXJ0QWN0aW9uXG4gICAgICogQHBhcmFtIGJhZGdlTnVtYmVyXG4gICAgICogQHBhcmFtIHNvdW5kXG4gICAgICovXG4gICAgc2NoZWR1bGVOb3RpZmljYXRpb246IGZ1bmN0aW9uICh0aW1lRnJvbU5vdywgYWxlcnRUZXh0LCBhbGVydEFjdGlvbiwgYmFkZ2VOdW1iZXIpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS5zY2hlZHVsZU5vdGlmaWNhdGlvbih0aW1lRnJvbU5vdywgYWxlcnRUZXh0LCBhbGVydEFjdGlvbiwgYmFkZ2VOdW1iZXIpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHVuc2NoZWR1bGVOb3RpZmljYXRpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS51bnNjaGVkdWxlTm90aWZpY2F0aW9uKCk7XG4gICAgICAgIH1cbiAgICB9XG59KTtcblxuTm90aWZpY2F0aW9uTWFuYWdlci5zaGFyZWREaXJlY3RvciA9IG51bGw7XG5Ob3RpZmljYXRpb25NYW5hZ2VyLmZpcnN0VXNlRGlyZWN0b3IgPSB0cnVlO1xuXG5Ob3RpZmljYXRpb25NYW5hZ2VyLmdldEluc3RhbmNlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChOb3RpZmljYXRpb25NYW5hZ2VyLmZpcnN0VXNlRGlyZWN0b3IpIHtcbiAgICAgICAgTm90aWZpY2F0aW9uTWFuYWdlci5maXJzdFVzZURpcmVjdG9yID0gZmFsc2U7XG4gICAgICAgIE5vdGlmaWNhdGlvbk1hbmFnZXIuc2hhcmVkRGlyZWN0b3IgPSBuZXcgTm90aWZpY2F0aW9uTWFuYWdlcigpO1xuICAgIH1cbiAgICByZXR1cm4gTm90aWZpY2F0aW9uTWFuYWdlci5zaGFyZWREaXJlY3Rvcjtcbn07XG5cblxubW9kdWxlLmV4cG9ydHMgPSBOb3RpZmljYXRpb25NYW5hZ2VyOyIsIi8qKlxuICogQ3JlYXRlZCBieSBveWUgb24gMTUtNS0xNy5cbiAqL1xudmFyIFJhdGVNYW5hZ2VyID0gY2MuQ2xhc3MuZXh0ZW5kKHtcblxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICB9LFxuXG4gICAgaW5pdDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLmluaXRSYXRlUGFyYW1zKDMsIDEsIDAuNSwgMC41LCB0cnVlKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2UubGF1bmNoUmF0ZSgpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGxpa2VJbkZhY2Vib29rOiBmdW5jdGlvbiAodXJsKSB7XG4gICAgICAgIGNjLnN5cy5vcGVuVVJMKHVybCk7XG4gICAgfSxcblxuICAgIGxhdW5jaEFwcFJldmlldzogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICByZXR1cm4ganNiX2RwLm9uZVNka0JyaWRnZS5sYXVuY2hBcHBSZXZpZXcoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufSk7XG5cblJhdGVNYW5hZ2VyLnNoYXJlZERpcmVjdG9yID0gbnVsbDtcblJhdGVNYW5hZ2VyLmZpcnN0VXNlRGlyZWN0b3IgPSB0cnVlO1xuXG5SYXRlTWFuYWdlci5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoUmF0ZU1hbmFnZXIuZmlyc3RVc2VEaXJlY3Rvcikge1xuICAgICAgICBSYXRlTWFuYWdlci5maXJzdFVzZURpcmVjdG9yID0gZmFsc2U7XG4gICAgICAgIFJhdGVNYW5hZ2VyLnNoYXJlZERpcmVjdG9yID0gbmV3IFJhdGVNYW5hZ2VyKCk7XG4gICAgfVxuICAgIHJldHVybiBSYXRlTWFuYWdlci5zaGFyZWREaXJlY3Rvcjtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUmF0ZU1hbmFnZXI7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IG95ZSBvbiAxNS01LTE3LlxuICovXG52YXIgUmVtb3RlQ29uZmlnTWFuYWdlciA9IGNjLkNsYXNzLmV4dGVuZCh7XG5cbiAgICByZW1vdGVSZWNlaXZlZENCOiBudWxsLFxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS5vblJlbW90ZUNvbmZpZ1JlY2VpdmVkID0gdGhpcy5vblJlbW90ZUNvbmZpZ1JlY2VpdmVkLmJpbmQodGhpcyk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2V0UmVtb3RlQ29uZmlnUmVjZWl2ZWRDYWxsYmFjazogZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMucmVtb3RlUmVjZWl2ZWRDQiA9IGNhbGxiYWNrO1xuICAgIH0sXG5cbiAgICBvblJlbW90ZUNvbmZpZ1JlY2VpdmVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLnJlbW90ZVJlY2VpdmVkQ0IpIHtcbiAgICAgICAgICAgIHRoaXMucmVtb3RlUmVjZWl2ZWRDQigpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNldERlZmF1bHRSZW1vdGVDb25maWc6IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS5zZXREZWZhdWx0UmVtb3RlQ29uZmlnKEpTT04uc3RyaW5naWZ5KHBhcmFtcykpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGZldGNoUmVtb3RlQ29uZmlnOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2UuZmV0Y2hSZW1vdGVDb25maWcoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRSZW1vdGVDb25maWc6IGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAgcmV0dXJuIGpzYl9kcC5vbmVTZGtCcmlkZ2UuZ2V0UmVtb3RlQ29uZmlnKGtleSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfSxcblxuICAgIGFjdGl2YXRlUmVtb3RlRmV0Y2hlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLmFjdGl2YXRlUmVtb3RlRmV0Y2hlZCgpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGlzUmVtb3RlQ29uZmlnUmVhZHk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAgcmV0dXJuIGpzYl9kcC5vbmVTZGtCcmlkZ2UuaXNSZW1vdGVDb25maWdSZWFkeSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbn0pO1xuXG5SZW1vdGVDb25maWdNYW5hZ2VyLnNoYXJlZERpcmVjdG9yID0gbnVsbDtcblJlbW90ZUNvbmZpZ01hbmFnZXIuZmlyc3RVc2VEaXJlY3RvciA9IHRydWU7XG5cblJlbW90ZUNvbmZpZ01hbmFnZXIuZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKFJlbW90ZUNvbmZpZ01hbmFnZXIuZmlyc3RVc2VEaXJlY3Rvcikge1xuICAgICAgICBSZW1vdGVDb25maWdNYW5hZ2VyLmZpcnN0VXNlRGlyZWN0b3IgPSBmYWxzZTtcbiAgICAgICAgUmVtb3RlQ29uZmlnTWFuYWdlci5zaGFyZWREaXJlY3RvciA9IG5ldyBSZW1vdGVDb25maWdNYW5hZ2VyKCk7XG4gICAgfVxuICAgIHJldHVybiBSZW1vdGVDb25maWdNYW5hZ2VyLnNoYXJlZERpcmVjdG9yO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBSZW1vdGVDb25maWdNYW5hZ2VyOyIsIi8qKlxuICogQ3JlYXRlZCBieSBveWUgb24gMTUtNS0xNy5cbiAqL1xuXG52YXIgU2hhcmVNYW5hZ2VyID0gY2MuQ2xhc3MuZXh0ZW5kKHtcbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgfSxcblxuICAgIHNoYXJlV2l0aFN5c3RlbTogZnVuY3Rpb24gKHRpcHMsIHVybCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICB2YXIgZmlsZU5hbWUgPSBcIlwiO1xuICAgICAgICAgICAgaWYgKGNjLnN5cy5vcyA9PT0gY2Muc3lzLk9TX0lPUykge1xuICAgICAgICAgICAgICAgIGZpbGVOYW1lID0gdXJsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS5zeXN0ZW1TaGFyZShmaWxlTmFtZSwgdGlwcyk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgb3BlbkFwcFdpdGhJZGVudGlmaWVyOiBmdW5jdGlvbiAoYXBwSWQpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS5vcGVuQXBwV2l0aElkZW50aWZpZXIoYXBwSWQpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNlbmRFbWFpbDogZnVuY3Rpb24gKGFkZHJlc3MsIHRpdGxlLCBib2R5KSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2Uuc2VuZEVtYWlsKGFkZHJlc3MsIHRpdGxlLCBib2R5KTtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuXG5TaGFyZU1hbmFnZXIuc2hhcmVkRGlyZWN0b3IgPSBudWxsO1xuU2hhcmVNYW5hZ2VyLmZpcnN0VXNlRGlyZWN0b3IgPSB0cnVlO1xuXG5TaGFyZU1hbmFnZXIuZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKFNoYXJlTWFuYWdlci5maXJzdFVzZURpcmVjdG9yKSB7XG4gICAgICAgIFNoYXJlTWFuYWdlci5maXJzdFVzZURpcmVjdG9yID0gZmFsc2U7XG4gICAgICAgIFNoYXJlTWFuYWdlci5zaGFyZWREaXJlY3RvciA9IG5ldyBTaGFyZU1hbmFnZXIoKTtcbiAgICB9XG4gICAgcmV0dXJuIFNoYXJlTWFuYWdlci5zaGFyZWREaXJlY3Rvcjtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gU2hhcmVNYW5hZ2VyOyIsIi8qKlxuICogQ3JlYXRlZCBieSBveWUgb24gMTUtNS0xNy5cbiAqL1xudmFyIFBheW1lbnRJbmZvID0gcmVxdWlyZShcIi4uL2VudGl0eS9QYXltZW50SW5mb1wiKTtcbnZhciBQYXltZW50Q29kZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1BheW1lbnRDb2RlXCIpO1xudmFyIFByb2R1Y3RJbmZvID0gcmVxdWlyZShcIi4uL2VudGl0eS9Qcm9kdWN0SW5mb1wiKTtcblxudmFyIFBheW1lbnREZWxlZ2F0ZSA9IGNjLkNsYXNzLmV4dGVuZCh7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtQYXltZW50Q29kZX0gZXJyb3JcbiAgICAgKiBAcGFyYW0ge1BheW1lbnRJbmZvfSBwYXltZW50SW5mb1xuICAgICAqL1xuICAgIG9uUGF5bWVudENvbXBsZXRlZDogZnVuY3Rpb24gKGVycm9yLCBwYXltZW50SW5mbykge1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge0FycmF5LjxQYXltZW50SW5mbz59IHBheW1lbnRJbmZvTGlzdFxuICAgICAqL1xuICAgIG9uR2V0VW52ZXJpZmllZFJlY2VpcHRMaXN0OiBmdW5jdGlvbiAocGF5bWVudEluZm9MaXN0KSB7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIG9uIGdldCBwcm9kdWN0IGxpc3QuXG4gICAgICogQHBhcmFtIHtBcnJheS48UHJvZHVjdEluZm8+fSBwcm9kdWN0TGlzdFxuICAgICAqL1xuICAgIG9uR2V0UHJvZHVjdExpc3Q6IGZ1bmN0aW9uIChwcm9kdWN0TGlzdCkge1xuICAgIH1cbn0pO1xuXG52YXIgU3RvcmVNYW5hZ2VyID0gY2MuQ2xhc3MuZXh0ZW5kKHtcbiAgICAvKipcbiAgICAgKiBAdHlwZSB7UGF5bWVudERlbGVnYXRlfVxuICAgICAqL1xuICAgIHBheW1lbnREZWxlZ2F0ZTogbnVsbCxcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7QXJyYXkuPFBheW1lbnRJbmZvPn0gcGF5bWVudEluZm9MaXN0XG4gICAgICovXG4gICAgcHJvZHVjdExpc3Q6IG51bGwsXG5cbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2Uub25HZXRQcm9kdWN0TGlzdCA9IHRoaXMub25HZXRQcm9kdWN0TGlzdC5iaW5kKHRoaXMpO1xuICAgICAgICAgICAganNiX2RwLm9uZVNka0JyaWRnZS5vblB1cmNoYXNlID0gdGhpcy5vblB1cmNoYXNlLmJpbmQodGhpcyk7XG4gICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLm9uQ29uc3VtZSA9IHRoaXMub25Db25zdW1lLmJpbmQodGhpcyk7XG4gICAgICAgICAgICBqc2JfZHAub25lU2RrQnJpZGdlLm9uR2V0VW52ZXJpZmllZFJlY2VpcHRMaXN0ID0gdGhpcy5vbkdldFVudmVyaWZpZWRSZWNlaXB0TGlzdC5iaW5kKHRoaXMpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIHNldCBwYXltZW50IGRlbGVnYXRlLlxuICAgICAqIEBwYXJhbSB7UGF5bWVudERlbGVnYXRlfSBwYXltZW50RGVsZWdhdGVcbiAgICAgKi9cbiAgICBzZXRQYXltZW50RGVsZWdhdGU6IGZ1bmN0aW9uIChwYXltZW50RGVsZWdhdGUpIHtcbiAgICAgICAgdGhpcy5wYXltZW50RGVsZWdhdGUgPSBwYXltZW50RGVsZWdhdGU7XG4gICAgfSxcblxuICAgIG9uR2V0UHJvZHVjdExpc3Q6IGZ1bmN0aW9uIChqc29uUmVzdWx0KSB7XG4gICAgICAgIGNjLmxvZyhcIm9uR2V0UHJvZHVjdExpc3Q6IFwiICsganNvblJlc3VsdCk7XG4gICAgICAgIGlmIChqc29uUmVzdWx0KSB7XG4gICAgICAgICAgICB2YXIgcHJvZHVjdHMgPSBKU09OLnBhcnNlKGpzb25SZXN1bHQpO1xuICAgICAgICAgICAgaWYgKHByb2R1Y3RzICYmIHByb2R1Y3RzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB2YXIgcHJvZHVjdExpc3QgPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByb2R1Y3RzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwcm9kdWN0SW5mbyA9IG5ldyBQcm9kdWN0SW5mbygpO1xuICAgICAgICAgICAgICAgICAgICBwcm9kdWN0SW5mby51bm1hcnNoYWwocHJvZHVjdHNbaV0pO1xuICAgICAgICAgICAgICAgICAgICBwcm9kdWN0TGlzdC5wdXNoKHByb2R1Y3RJbmZvKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5wYXltZW50RGVsZWdhdGUgJiYgdGhpcy5wYXltZW50RGVsZWdhdGUub25HZXRQcm9kdWN0TGlzdChwcm9kdWN0TGlzdCk7XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9kdWN0TGlzdCA9IHByb2R1Y3RMaXN0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uUHVyY2hhc2U6IGZ1bmN0aW9uIChqc29uUmVzdWx0KSB7XG4gICAgICAgIGNjLmxvZyhcIm9uUHVyY2hhc2U6IFwiICsganNvblJlc3VsdCk7XG4gICAgICAgIHZhciBwdXJjaGFzZVJlc3VsdCA9IEpTT04ucGFyc2UoanNvblJlc3VsdCk7XG4gICAgICAgIHZhciBwdXJjaGFzZURhdGE7XG4gICAgICAgIGlmIChwdXJjaGFzZVJlc3VsdC5lcnJvckNvZGUgPT09IFBheW1lbnRDb2RlLlBBWU1FTlRfQ09ERV9TVUNDRVNTKSB7XG4gICAgICAgICAgICBwdXJjaGFzZURhdGEgPSBKU09OLnBhcnNlKGpzb25SZXN1bHQpO1xuICAgICAgICAgICAgdGhpcy5fcGF5bWVudENvbXBsZXRlZChQYXltZW50Q29kZS5QQVlNRU5UX0NPREVfU1VDQ0VTUywgcHVyY2hhc2VEYXRhKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHB1cmNoYXNlRGF0YSA9IEpTT04ucGFyc2UoanNvblJlc3VsdCk7XG4gICAgICAgICAgICB0aGlzLl9wYXltZW50Q29tcGxldGVkKFBheW1lbnRDb2RlLlBBWU1FTlRfQ09ERV9GQUlMLCBwdXJjaGFzZURhdGEpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uQ29uc3VtZTogZnVuY3Rpb24gKGpzb25JbmZvKSB7XG4gICAgICAgIGNjLmxvZyhcIm9uQ29uc3VtZTogXCIgKyBqc29uSW5mbyk7XG4gICAgfSxcblxuICAgIG9uR2V0VW52ZXJpZmllZFJlY2VpcHRMaXN0OiBmdW5jdGlvbiAocHVyY2hhc2VMaXN0U3RyaW5nKSB7XG4gICAgICAgIGNjLmxvZyhcIm9uR2V0VW52ZXJpZmllZFJlY2VpcHRMaXN0OiBcIiArIHB1cmNoYXNlTGlzdFN0cmluZyk7XG4gICAgICAgIGlmIChwdXJjaGFzZUxpc3RTdHJpbmcgJiYgcHVyY2hhc2VMaXN0U3RyaW5nLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHZhciBwdXJjaGFzZUpzb25MaXN0ID0gSlNPTi5wYXJzZShwdXJjaGFzZUxpc3RTdHJpbmcpO1xuICAgICAgICAgICAgaWYgKHB1cmNoYXNlSnNvbkxpc3QgJiYgcHVyY2hhc2VKc29uTGlzdC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIHB1cmNoYXNlSW5mb0xpc3QgPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHB1cmNoYXNlSnNvbkxpc3QubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBheW1lbnRNc2cgPSBwdXJjaGFzZUpzb25MaXN0W2ldO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcGF5bWVudEluZm8gPSBuZXcgUGF5bWVudEluZm8oKTtcbiAgICAgICAgICAgICAgICAgICAgcGF5bWVudEluZm8udW5tYXJzaGFsKHBheW1lbnRNc2cpO1xuICAgICAgICAgICAgICAgICAgICBwdXJjaGFzZUluZm9MaXN0LnB1c2gocGF5bWVudEluZm8pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnBheW1lbnREZWxlZ2F0ZSAmJiB0aGlzLnBheW1lbnREZWxlZ2F0ZS5vbkdldFVudmVyaWZpZWRSZWNlaXB0TGlzdChwdXJjaGFzZUluZm9MaXN0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgfSxcblxuICAgIF9wYXltZW50Q29tcGxldGVkOiBmdW5jdGlvbiAoZXJyb3IsIHBheW1lbnRNc2cpIHtcbiAgICAgICAgdmFyIHBheW1lbnRJbmZvID0gbmV3IFBheW1lbnRJbmZvKCk7XG4gICAgICAgIHBheW1lbnRJbmZvLnVubWFyc2hhbChwYXltZW50TXNnKTtcbiAgICAgICAgaWYgKGVycm9yID09PSBQYXltZW50Q29kZS5QQVlNRU5UX0NPREVfU1VDQ0VTUykge1xuICAgICAgICAgICAgaWYgKHBheW1lbnRNc2cpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBheW1lbnREZWxlZ2F0ZSAmJiB0aGlzLnBheW1lbnREZWxlZ2F0ZS5vblBheW1lbnRDb21wbGV0ZWQoUGF5bWVudENvZGUuUEFZTUVOVF9DT0RFX1NVQ0NFU1MsIHBheW1lbnRJbmZvKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXltZW50RGVsZWdhdGUgJiYgdGhpcy5wYXltZW50RGVsZWdhdGUub25QYXltZW50Q29tcGxldGVkKFBheW1lbnRDb2RlLlBBWU1FTlRfQ09ERV9GQUlMLCBwYXltZW50SW5mbyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnBheW1lbnREZWxlZ2F0ZSAmJiB0aGlzLnBheW1lbnREZWxlZ2F0ZS5vblBheW1lbnRDb21wbGV0ZWQoUGF5bWVudENvZGUuUEFZTUVOVF9DT0RFX0ZBSUwsIHBheW1lbnRJbmZvKTtcbiAgICAgICAgfVxuICAgICAgICAvL2lmIChjYy5zeXMub3MgIT09IGNjLnN5cy5PU19BTkRST0lEKSB7XG4gICAgICAgIC8vICAgIHRoaXMuY29uc3VtZShwYXltZW50SW5mby5wdXJjaGFzZUlkKTtcbiAgICAgICAgLy99XG4gICAgfSxcblxuICAgIF9nZXROdW1Gcm9tU3RyaW5nOiBmdW5jdGlvbiAodGV4dCkge1xuICAgICAgICByZXR1cm4gdGV4dC5yZXBsYWNlKC9bXjAtOS5dL2lnLCBcIlwiKTtcbiAgICB9LFxuXG4gICAgcmVxdWVzdFByb2R1Y3Q6IGZ1bmN0aW9uIChwcm9kdWN0SWRzKSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2UuZ2V0UHJvZHVjdHNJbmZvKHByb2R1Y3RJZHMpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHBheUZvclByb2R1Y3Q6IGZ1bmN0aW9uIChwcm9kdWN0SWQpIHtcbiAgICAgICAgY2MubG9nKFwicGF5Rm9yUHJvZHVjdDpcIiArIHByb2R1Y3RJZCk7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2UucHVyY2hhc2UocHJvZHVjdElkKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBjb25zdW1lOiBmdW5jdGlvbiAodHJhbnNhY3Rpb25JZCkge1xuICAgICAgICBjYy5sb2coXCJjb25zdW1lOlwiICsgdHJhbnNhY3Rpb25JZCk7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGlmICh0cmFuc2FjdGlvbklkICYmIHRyYW5zYWN0aW9uSWQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2UuY29uc3VtZSh0cmFuc2FjdGlvbklkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByZXN0b3JlQ29tcGxldGVkVHJhbnNhY3Rpb25zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNjLmxvZyhcInJlc3RvcmVDb21wbGV0ZWRUcmFuc2FjdGlvbnNcIik7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2UucmVzdG9yZVRyYW5zYWN0aW9ucygpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldFVudmVyaWZpZWRSZWNlaXB0TGlzdDogZnVuY3Rpb24gKCkge1xuICAgICAgICBjYy5sb2coXCJnZXRVbnZlcmlmaWVkUmVjZWlwdExpc3RcIik7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2UuZ2V0VW52ZXJpZmllZFJlY2VpcHRMaXN0KCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgX2dldFByb2R1Y3RCeUlkOiBmdW5jdGlvbiAocHJvZHVjdElkKSB7XG4gICAgICAgIGlmICh0aGlzLnByb2R1Y3RMaXN0ICYmIHRoaXMucHJvZHVjdExpc3QubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnByb2R1Y3RMaXN0Lmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgdmFyIHByb2R1Y3QgPSB0aGlzLnByb2R1Y3RMaXN0W2ldO1xuICAgICAgICAgICAgICAgIGlmIChwcm9kdWN0LnByb2R1Y3RJZCA9PT0gcHJvZHVjdElkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9kdWN0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG59KTtcblxuU3RvcmVNYW5hZ2VyLnNoYXJlZERpcmVjdG9yID0gbnVsbDtcblN0b3JlTWFuYWdlci5maXJzdFVzZURpcmVjdG9yID0gdHJ1ZTtcblxuU3RvcmVNYW5hZ2VyLmdldEluc3RhbmNlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChTdG9yZU1hbmFnZXIuZmlyc3RVc2VEaXJlY3Rvcikge1xuICAgICAgICBTdG9yZU1hbmFnZXIuZmlyc3RVc2VEaXJlY3RvciA9IGZhbHNlO1xuICAgICAgICBTdG9yZU1hbmFnZXIuc2hhcmVkRGlyZWN0b3IgPSBuZXcgU3RvcmVNYW5hZ2VyKCk7XG4gICAgfVxuICAgIHJldHVybiBTdG9yZU1hbmFnZXIuc2hhcmVkRGlyZWN0b3I7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFN0b3JlTWFuYWdlcjsiLCJ2YXIgRWZmZWN0TWFuID0gY2MuQ2xhc3MuZXh0ZW5kKHtcbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgfSxcblxuICAgIHBsYXlGbHlDb2luczogZnVuY3Rpb24gKHN0YXJ0V29ybGQsIGVuZFdvcmxkLCBjb2luTnVtLCBzcGVlZCwgc3RhcnRDYWxsYmFjaywgZW5kQ2FsbGJhY2spIHtcbiAgICAgICAgdmFyIHBhcmVudE5vZGUgPSBjYy5kaXJlY3Rvci5nZXRSdW5uaW5nU2NlbmUoKTtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICBjb2luTnVtID0gMTA7XG4gICAgICAgIC8vY2MubG9hZGVyLmxvYWRSZXMoXCJwcmVmYWJzL2NvaW5zX2FuaW1cIiwgZnVuY3Rpb24gKGVyciwgcHJlZmFiKSB7XG4gICAgICAgIHZhciBpID0gMDtcbiAgICAgICAgd2hpbGUgKGkgPCBjb2luTnVtKSB7XG4gICAgICAgICAgICB2YXIgZnVuYyA9IGZ1bmN0aW9uIChub2RlLCBpc1N0YXJ0LCBpc0VuZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjYiA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1N0YXJ0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYiA9IHN0YXJ0Q2FsbGJhY2s7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNFbmQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNiID0gZW5kQ2FsbGJhY2s7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zaG93Rmx5QW5pbShzdGFydFdvcmxkLCBlbmRXb3JsZCwgbm9kZSwgcGFyZW50Tm9kZSwgc3BlZWQsIGNiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdmFyIG5ld05vZGUgPSBuZXcgY2MuU3ByaXRlKFwiI2ljb25fZGlhbW9uZF9lZmZlY3QucG5nXCIpO1xuICAgICAgICAgICAgbmV3Tm9kZS5zY2FsZSA9IDAuODtcbiAgICAgICAgICAgIG5ld05vZGUucmV0YWluKCk7XG4gICAgICAgICAgICB2YXIgaXNTdGFydCA9IChpID09PSAwKTtcbiAgICAgICAgICAgIHZhciBpc0VuZCA9IChpID09PSBjb2luTnVtIC0gMSk7XG4gICAgICAgICAgICAvLyA1MDAgPT4gMTAwIDUwMHggPSAxMDAsIDEwMDB4ID0gNTAgNTAweCA9IC01MCwgeCA9IC0wLjJcbiAgICAgICAgICAgIC8vIDEwMDAgPT4gNTBcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuYyhuZXdOb2RlLCBpc1N0YXJ0LCBpc0VuZCksICgyMDAgLSBzcGVlZCAvIDEwKSAqIGkpO1xuICAgICAgICAgICAgaSsrO1xuICAgICAgICB9XG4gICAgICAgIC8vfSk7XG4gICAgfSxcblxuICAgIHNob3dGbHlBbmltOiBmdW5jdGlvbiAoc3RhcldvcmxkLCBlbmRXb3JsZCwgYW5pbU5vZGUsIHBhcmVudE5vZGUsIHNwZWVkLCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgc3RhcnQgPSBzdGFyV29ybGQ7XG4gICAgICAgIHZhciBlbmQgPSBlbmRXb3JsZDtcbiAgICAgICAgdmFyIGxlbmd0aCA9IE1hdGguc3FydCgoc3RhcnQueCAtIGVuZC54KSAqIChzdGFydC54IC0gZW5kLngpICsgKHN0YXJ0LnkgLSBlbmQueSkgKiAoc3RhcnQueSAtIGVuZC55KSk7XG4gICAgICAgIHZhciBkZWxheSA9IGxlbmd0aCAvIHNwZWVkO1xuICAgICAgICBwYXJlbnROb2RlLmFkZENoaWxkKGFuaW1Ob2RlLCAyMDAwKTtcbiAgICAgICAgYW5pbU5vZGUucmVsZWFzZSgpO1xuICAgICAgICBhbmltTm9kZS5zZXRQb3NpdGlvbihzdGFydCk7XG4gICAgICAgIHZhciBjb250cm9sUG9pbnRzID0gW1xuICAgICAgICAgICAgc3RhcnQsXG4gICAgICAgICAgICB0aGlzLmdldFBlcnBlbmRpY3VsYXJQb2ludChzdGFydCwgZW5kLCA1MCwgMC41KSxcbiAgICAgICAgICAgIGVuZFxuICAgICAgICBdO1xuICAgICAgICBhbmltTm9kZS5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoY2MuYmV6aWVyVG8oZGVsYXksIGNvbnRyb2xQb2ludHMpLCBjYy5jYWxsRnVuYyhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCB0aGlzKSwgY2MucmVtb3ZlU2VsZigpKSk7XG4gICAgfSxcblxuICAgIGdldFBlcnBlbmRpY3VsYXJQb2ludDogZnVuY3Rpb24oZnJvbSwgdG8sIGRpcywgZmFjdG9yKSB7XG4gICAgICAgIHZhciB2ZWMgPSB7eDogZnJvbS54IC0gdG8ueCwgeTogZnJvbS55IC0gdG8ueX07XG4gICAgICAgIHZhciBwZXJwZW5kaWN1bGFyVmVjID0ge3g6IHZlYy55LCB5OiAtdmVjLnh9O1xuICAgICAgICB2YXIgY2VudGVyUG9pbnQgPSB0aGlzLmxlcnBQb3NpdGlvbihmcm9tLCB0bywgZmFjdG9yKTtcbiAgICAgICAgdmFyIHBlcnBlbmRpY3VsYXJWZWNMZW4gPSBNYXRoLnNxcnQocGVycGVuZGljdWxhclZlYy54ICogcGVycGVuZGljdWxhclZlYy54ICsgcGVycGVuZGljdWxhclZlYy55ICogcGVycGVuZGljdWxhclZlYy55KTtcbiAgICAgICAgdmFyIHBlcnBlbmRpY3VsYXJWZWNOb3JhbWwgPSB7XG4gICAgICAgICAgICB4OiBwZXJwZW5kaWN1bGFyVmVjLnggLyBwZXJwZW5kaWN1bGFyVmVjTGVuLFxuICAgICAgICAgICAgeTogcGVycGVuZGljdWxhclZlYy55IC8gcGVycGVuZGljdWxhclZlY0xlblxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gbmV3IGNjLnAoY2VudGVyUG9pbnQueCArIHBlcnBlbmRpY3VsYXJWZWNOb3JhbWwueCAqIGRpcyxcbiAgICAgICAgICAgIGNlbnRlclBvaW50LnkgKyBNYXRoLmFicyhwZXJwZW5kaWN1bGFyVmVjTm9yYW1sLnkgKiBkaXMpKTtcbiAgICB9LFxuXG4gICAgbGVycFBvc2l0aW9uOiBmdW5jdGlvbihwb3MwLHBvczEsc3RlcCl7XG4gICAgICAgIHJldHVybiB7eDoocG9zMS54IC0gcG9zMC54KSpzdGVwICsgcG9zMC54LCB5Oihwb3MxLnkgLSBwb3MwLnkpKnN0ZXAgKyBwb3MwLnl9O1xuICAgIH1cbn0pO1xuXG5FZmZlY3RNYW4uX2luc3RhbmNlID0gbnVsbDtcblxuLyoqXG4gKiBAcmV0dXJucyB7RWZmZWN0TWFufVxuICovXG5FZmZlY3RNYW4uZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbigpIHtcbiAgICBpZighRWZmZWN0TWFuLl9pbnN0YW5jZSkge1xuICAgICAgICBFZmZlY3RNYW4uX2luc3RhbmNlID0gbmV3IEVmZmVjdE1hbigpO1xuICAgIH1cbiAgICByZXR1cm4gRWZmZWN0TWFuLl9pbnN0YW5jZTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBFZmZlY3RNYW47IiwidmFyIERBWV9JTl9TRUNPTkRTID0gMjQgKiA2MCAqIDYwO1xuXG52YXIgTk9USUZJQ0FUSU9OX0RBWVMgPSBbMSwgMywgNywgMTUsIDMwXTtcbnZhciBBZHNQbGFjZSA9IHJlcXVpcmUoXCIuLi9lbnVtL0Fkc1BsYWNlXCIpO1xuXG52YXIgTG9naWNNYW4gPSBjYy5DbGFzcy5leHRlbmQoe1xuICAgIF9pc1JlZ2lzdGVyR2FtZUV2ZW50TGlzdGVuZXI6IGZhbHNlLFxuICAgIF9zdGFydDogZmFsc2UsXG4gICAgY3RvcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2UgPSBqc2JfZHAuT25lU0RLSlNCcmlkZ2UuZ2V0SW5zdGFuY2UoKTtcbiAgICAgICAgICAgIGlmIChqc2JfZHAuTG9naWNKU0JyaWRnZSAmJiBqc2JfZHAuTG9naWNKU0JyaWRnZS5nZXRJbnN0YW5jZSkge1xuICAgICAgICAgICAgICAgIGpzYl9kcC5sb2dpY0JyaWRnZSA9IGpzYl9kcC5Mb2dpY0pTQnJpZGdlLmdldEluc3RhbmNlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgRXZlbnREaXNwYXRjaGVyID0gcmVxdWlyZShcIi4uL2V2ZW50cy9FdmVudERpc3BhdGNoZXJcIik7XG4gICAgICAgIHZhciBOb3RpZmljYXRpb25NYW5hZ2VyID0gcmVxdWlyZShcIi4uL21hbmFnZXIvTm90aWZpY2F0aW9uTWFuYWdlclwiKTtcbiAgICAgICAgdmFyIEFuYWx5c2VNYW5hZ2VyID0gcmVxdWlyZShcIi4uL21hbmFnZXIvQW5hbHlzZU1hbmFnZXJcIik7XG4gICAgICAgIHZhciBTdG9yZU1hbmFnZXIgPSByZXF1aXJlKFwiLi4vbWFuYWdlci9TdG9yZU1hbmFnZXJcIik7XG4gICAgICAgIHZhciBHQ01hbmFnZXIgPSByZXF1aXJlKFwiLi4vbWFuYWdlci9HQ01hbmFnZXJcIik7XG4gICAgICAgIHZhciBSYXRlTWFuYWdlciA9IHJlcXVpcmUoXCIuLi9tYW5hZ2VyL1JhdGVNYW5hZ2VyXCIpO1xuICAgICAgICB2YXIgUGxheWVyTWFuID0gcmVxdWlyZShcIi4uL21vZGVsL1BsYXllck1hblwiKTtcbiAgICAgICAgdmFyIFN0b3JhZ2VDb250cm9sbGVyID0gcmVxdWlyZShcIi4uL3N0b3JhZ2UvU3RvcmFnZUNvbnRyb2xsZXJcIik7XG4gICAgICAgIHZhciBBZHNNYW5hZ2VyID0gcmVxdWlyZShcIi4uL21hbmFnZXIvQWRzTWFuYWdlclwiKTtcbiAgICAgICAgdmFyIEF1ZGlvUGxheWVyID0gcmVxdWlyZShcIi4uL2F1ZGlvL0F1ZGlvUGxheWVyXCIpO1xuICAgICAgICB2YXIgVXRpbHMgPSByZXF1aXJlKFwiLi4vdXRpbC9VdGlsc1wiKTtcbiAgICAgICAgdmFyIFNoYXJlTWFuYWdlciA9IHJlcXVpcmUoXCIuLi9tYW5hZ2VyL1NoYXJlTWFuYWdlclwiKTtcbiAgICAgICAgdmFyIERpYWxvZ01hbmFnZXIgPSByZXF1aXJlKFwiLi4vcG9wdXAvRGlhbG9nTWFuYWdlclwiKTtcbiAgICAgICAgdmFyIEFzc2V0c01hbmFnZXIgPSByZXF1aXJlKFwiLi4vYXNzZXRzL0Fzc2V0c01hbmFnZXJcIik7XG5cbiAgICAgICAgdmFyIEJhc2VDQ0JDb250cm9sbGVyID0gcmVxdWlyZShcIi4uL2NvbnRyb2xsZXIvQmFzZUNDQkNvbnRyb2xsZXJcIik7XG4gICAgICAgIHZhciBBdWRpb0hlbHBlciA9IHJlcXVpcmUoXCIuLi91dGlsL0F1ZGlvSGVscGVyXCIpO1xuICAgICAgICB2YXIgQ2FwdHVyZU1hbmFnZXIgPSByZXF1aXJlKFwiLi4vbWFuYWdlci9DYXB0dXJlTWFuYWdlclwiKTtcbiAgICAgICAgdmFyIExvY2FsaXphdGlvbk1hbmFnZXIgPSByZXF1aXJlKFwiLi4vbWFuYWdlci9Mb2NhbGl6YXRpb25NYW5hZ2VyXCIpO1xuICAgICAgICB2YXIgQ3Jvc3NQcm9tTWFuYWdlciA9IHJlcXVpcmUoXCIuLi9tYW5hZ2VyL0Nyb3NzUHJvbU1hbmFnZXJcIik7XG4gICAgICAgIHZhciBFZmZlY3RNYW4gPSByZXF1aXJlKFwiLi4vbW9kZWwvRWZmZWN0TWFuXCIpO1xuICAgICAgICB2YXIgUmVtb3RlQ29uZmlnTWFuYWdlciA9IHJlcXVpcmUoXCIuLi9tYW5hZ2VyL1JlbW90ZUNvbmZpZ01hbmFnZXJcIik7XG5cbiAgICAgICAgd2luZG93LmdhbWUgPSB7fTtcbiAgICAgICAgd2luZG93LmdhbWUudXRpbHMgPSBVdGlscztcbiAgICAgICAgd2luZG93LmdhbWUuZXZlbnREaXNwYXRjaGVyID0gRXZlbnREaXNwYXRjaGVyLmdldEluc3RhbmNlKCk7XG4gICAgICAgIHdpbmRvdy5nYW1lLmxvZ2ljTWFuID0gdGhpcztcbiAgICAgICAgd2luZG93LmdhbWUubm90aWZpY2F0aW9uTWFuYWdlciA9IE5vdGlmaWNhdGlvbk1hbmFnZXIuZ2V0SW5zdGFuY2UoKTtcbiAgICAgICAgd2luZG93LmdhbWUuYW5hbHlzZU1hbmFnZXIgPSBBbmFseXNlTWFuYWdlci5nZXRJbnN0YW5jZSgpO1xuICAgICAgICB3aW5kb3cuZ2FtZS5zdG9yZU1hbmFnZXIgPSBTdG9yZU1hbmFnZXIuZ2V0SW5zdGFuY2UoKTtcbiAgICAgICAgd2luZG93LmdhbWUuZ2NNYW5hZ2VyID0gR0NNYW5hZ2VyLmdldEluc3RhbmNlKCk7XG4gICAgICAgIHdpbmRvdy5nYW1lLnJhdGVNYW5hZ2VyID0gUmF0ZU1hbmFnZXIuZ2V0SW5zdGFuY2UoKTtcbiAgICAgICAgd2luZG93LmdhbWUucGxheWVyTWFuID0gUGxheWVyTWFuLmdldEluc3RhbmNlKCk7XG4gICAgICAgIHdpbmRvdy5nYW1lLnN0b3JhZ2VDb250cm9sbGVyID0gU3RvcmFnZUNvbnRyb2xsZXIuZ2V0SW5zdGFuY2UoKTtcbiAgICAgICAgd2luZG93LmdhbWUuYWRzTWFuYWdlciA9IEFkc01hbmFnZXIuZ2V0SW5zdGFuY2UoKTtcbiAgICAgICAgd2luZG93LmdhbWUuYXVkaW9QbGF5ZXIgPSBBdWRpb1BsYXllci5nZXRJbnN0YW5jZSgpO1xuICAgICAgICB3aW5kb3cuZ2FtZS5zaGFyZU1hbmFnZXIgPSBTaGFyZU1hbmFnZXIuZ2V0SW5zdGFuY2UoKTtcbiAgICAgICAgd2luZG93LmdhbWUuZGlhbG9nTWFuYWdlciA9IERpYWxvZ01hbmFnZXIuZ2V0SW5zdGFuY2UoKTtcbiAgICAgICAgd2luZG93LmdhbWUuYXNzZXRzTWFuYWdlciA9IEFzc2V0c01hbmFnZXIuZ2V0SW5zdGFuY2UoKTtcbiAgICAgICAgd2luZG93LmdhbWUuY2FwdHVyZU1hbmFnZXIgPSBDYXB0dXJlTWFuYWdlci5nZXRJbnN0YW5jZSgpO1xuICAgICAgICB3aW5kb3cuZ2FtZS5sb2NhbCA9IExvY2FsaXphdGlvbk1hbmFnZXIuZ2V0SW5zdGFuY2UoKTtcbiAgICAgICAgd2luZG93LmdhbWUuZWZmZWN0TWFuID0gRWZmZWN0TWFuLmdldEluc3RhbmNlKCk7XG4gICAgICAgIC8vd2luZG93LmdhbWUuYWJ0ZXN0ID0gQUJUZXN0O1xuICAgICAgICB3aW5kb3cuZ2FtZS5yZW1vdGVDb25maWcgPSBSZW1vdGVDb25maWdNYW5hZ2VyLmdldEluc3RhbmNlKCk7XG5cbiAgICAgICAgd2luZG93LkJhc2VDQ0JDb250cm9sbGVyID0gQmFzZUNDQkNvbnRyb2xsZXI7XG4gICAgICAgIHdpbmRvdy5BdWRpb0hlbHBlciA9IEF1ZGlvSGVscGVyO1xuXG4gICAgICAgIHZhciBHYW1lQnJpZGdlID0gcmVxdWlyZShcIi4uL2JyaWRnZS9HYW1lQnJpZGdlXCIpO1xuICAgICAgICB3aW5kb3cuR2FtZUJyaWRnZSA9IEdhbWVCcmlkZ2U7XG4gICAgICAgIHdpbmRvdy5nYW1lLmNvbmZpZyA9IEdhbWVCcmlkZ2UuZ2V0Q29uZmlnKCk7XG4gICAgICAgIHdpbmRvdy5nYW1lLnBvcHVwTWFuID0gR2FtZUJyaWRnZS5nZXRQb3B1cE1hbigpO1xuICAgICAgICB3aW5kb3cuZ2FtZS5nYW1lTWFuID0gR2FtZUJyaWRnZS5nZXRHYW1lTWFuKCk7XG5cbiAgICAgICAgd2luZG93LmdhbWUuY3Jvc3NQcm9tTWFuID0gQ3Jvc3NQcm9tTWFuYWdlci5nZXRJbnN0YW5jZSgpO1xuICAgICAgICB3aW5kb3cuZ2FtZS5hZHNIZWxwZXIgPSBHYW1lQnJpZGdlLmdldEFkc0hlbHBlcigpO1xuICAgICAgICB3aW5kb3cuZ2FtZS5jaGFsbGVuZ2VNYW4gPSBHYW1lQnJpZGdlLmdldENoYWxsZW5nZU1hbigpO1xuICAgICAgICB3aW5kb3cuZ2FtZS5hY3Rpdml0eVRhc2tUeXBlID0gR2FtZUJyaWRnZS5nZXRBY3Rpdml0eVRhc2tUeXBlKCk7XG4gICAgICAgIHdpbmRvdy5nYW1lLmFjdGl2aXR5TWFuID0gR2FtZUJyaWRnZS5nZXRBY3Rpdml0eU1hbigpO1xuICAgICAgICB3aW5kb3cuZ2FtZS5hYlRlc3RUeXBlID0gR2FtZUJyaWRnZS5nZXRBQlRlc3RUeXBlKCk7XG4gICAgICAgIHdpbmRvdy5nYW1lLmNvbmZpZ01hbiA9IEdhbWVCcmlkZ2UuZ2V0Q29uZmlnTWFuKCk7XG4gICAgICAgIHdpbmRvdy5nYW1lLnN0b3JlTWFuID0gR2FtZUJyaWRnZS5nZXRTdG9yZU1hbigpO1xuICAgICAgICB3aW5kb3cuZ2FtZS5hZHNQbGFjZSA9IEFkc1BsYWNlO1xuXG4gICAgICAgIF8gPSBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICByZXR1cm4gZ2FtZS5sb2NhbC5nZXRWYWx1ZShrZXkpO1xuICAgICAgICB9O1xuICAgIH0sXG5cbiAgICBpbml0OiBmdW5jdGlvbiAoKSB7XG4gICAgfSxcblxuICAgIHJlZ2lzdGVyR2FtZUV2ZW50TGlzdGVuZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZighdGhpcy5faXNSZWdpc3RlckdhbWVFdmVudExpc3RlbmVyKSB7XG4gICAgICAgICAgICB0aGlzLl9pc1JlZ2lzdGVyR2FtZUV2ZW50TGlzdGVuZXIgPSB0cnVlO1xuICAgICAgICAgICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuYWRkQ3VzdG9tRXZlbnRMaXN0ZW5lcihjYy5nYW1lLkVWRU5UX1NIT1csIHRoaXMuZ2FtZU9uU2hvdywgdGhpcyk7XG4gICAgICAgICAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5hZGRDdXN0b21FdmVudExpc3RlbmVyKGNjLmdhbWUuRVZFTlRfSElERSwgdGhpcy5nYW1lT25IaWRlLCB0aGlzKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBwdXJnZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLnJlbW92ZUN1c3RvbUV2ZW50TGlzdGVuZXIoY2MuZ2FtZS5FVkVOVF9TSE9XLCB0aGlzLmdhbWVPblNob3csIHRoaXMpO1xuICAgICAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5yZW1vdmVDdXN0b21FdmVudExpc3RlbmVyKGNjLmdhbWUuRVZFTlRfSElERSwgdGhpcy5nYW1lT25IaWRlLCB0aGlzKTtcbiAgICB9LFxuXG4gICAgZ2FtZU9uU2hvdzogZnVuY3Rpb24oKSB7XG4gICAgICAgIGdhbWUubm90aWZpY2F0aW9uTWFuYWdlci51bnNjaGVkdWxlTm90aWZpY2F0aW9uKCk7XG5cbiAgICAgICAgZ2FtZS5hZHNNYW5hZ2VyLm9uR2FtZU9uU2hvdygpO1xuXG4gICAgICAgIHRoaXMudHJ5Um9sbGJhY2tEYXRhKCk7XG5cbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBnYW1lLmFkc0hlbHBlci5zaG93QmFja2dyb3VuZEFkcygpO1xuICAgICAgICB9LmJpbmQodGhpcyksIDEwMCk7XG4gICAgfSxcblxuICAgIGdhbWVPbkhpZGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICB0aGlzLnNjaGVkdWxlTG9jYWxOb3RpZmljYXRpb24oKTtcbiAgICAgICAgfVxuICAgICAgICBnYW1lLmFkc01hbmFnZXIuc2V0SW50ZXJzdGl0aWFsU2hvd2VkKEFkc1BsYWNlLkJhY2tHcm91bmQpO1xuICAgICAgICB0aGlzLmxhc3RIaWRlVGltZSA9IERhdGUubm93KCk7XG4gICAgfSxcblxuICAgIHJlZ2lzdGVyTm90aWZpY2F0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdhbWUubm90aWZpY2F0aW9uTWFuYWdlci5yZWdpc3Rlck5vdGlmaWNhdGlvbigpO1xuICAgIH0sXG5cbiAgICBzdGFydEdhbWU6IGZ1bmN0aW9uIChub3RJbml0UGxheWVyKSB7XG4gICAgICAgIGlmICh0aGlzLl9zdGFydCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3N0YXJ0ID0gdHJ1ZTtcbiAgICAgICAgZ2FtZS5ub3RpZmljYXRpb25NYW5hZ2VyLnVuc2NoZWR1bGVOb3RpZmljYXRpb24oKTtcbiAgICAgICAgdGhpcy5yZWdpc3RlckdhbWVFdmVudExpc3RlbmVyKCk7XG5cbiAgICAgICAgaWYgKCFub3RJbml0UGxheWVyKSB7XG4gICAgICAgICAgICBnYW1lLnBsYXllck1hbi5pbml0RGF0YSgpO1xuICAgICAgICB9XG4gICAgICAgIGdhbWUuY29uZmlnTWFuLnJlbG9hZCgpO1xuICAgICAgICBnYW1lLmFkc01hbmFnZXIuaW5pdCgpO1xuICAgICAgICBnYW1lLmFkc01hbmFnZXIubG9hZFJlbW90ZURhdGEoKTtcbiAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci5pbml0QW5hbHl0aWNzKCk7XG4gICAgICAgIGdhbWUuZ2NNYW5hZ2VyLmlzR2FtZUNlbnRlckF2YWlsYWJsZSgpO1xuICAgICAgICBnYW1lLnJhdGVNYW5hZ2VyLmluaXQoMywgMSwgMC41LCAwLjUsIHRydWUpO1xuICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrTG9naW5FdmVudCgpO1xuICAgICAgICBnYW1lLmNyb3NzUHJvbU1hbi50cnlUb0xvYWRGcm9tUmVtb3RlKCk7XG4gICAgICAgIGdhbWUuYWRzTWFuYWdlci5zZXRJc05ld1BsYXllcihnYW1lLnBsYXllck1hbi5pc05ld1BsYXllcigpKTtcblxuICAgICAgICB0aGlzLnRyeVJvbGxiYWNrRGF0YSgpO1xuICAgIH0sXG5cbiAgICBzY2hlZHVsZUxvY2FsTm90aWZpY2F0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgbGVmdFRpbWVTZWNvbmRzID0gTWF0aC5mbG9vcihnYW1lLmdhbWVNYW4uZ2V0V2hlZWxMZWZ0VGltZSgpIC8gMTAwMCk7XG4gICAgICAgIGlmIChsZWZ0VGltZVNlY29uZHMgPCAzMCAqIDYwKSB7XG4gICAgICAgICAgICBsZWZ0VGltZVNlY29uZHMgPSAzMCAqIDYwO1xuICAgICAgICB9XG4gICAgICAgIHZhciBpbmRleCA9IDE7XG4gICAgICAgIC8vd2hlZWwgbm90aWZpY2F0aW9uLlxuICAgICAgICBnYW1lLm5vdGlmaWNhdGlvbk1hbmFnZXIuc2NoZWR1bGVOb3RpZmljYXRpb24obGVmdFRpbWVTZWNvbmRzLFxuICAgICAgICAgICAgXyhcIndoZWVsX2lzX3JlYWR5XCIpLCBnYW1lLmxvY2FsLmdldFZhbHVlKFwiYXBwX25hbWVcIiksIGluZGV4KyspO1xuXG4gICAgICAgIC8vZGFpbHkgYm9udXMgbm90aWZpY2F0aW9uLlxuICAgICAgICB2YXIgbGFzdENsYWltRGF5ID0gZ2FtZS5wbGF5ZXJNYW4ucGxheWVyLmxhc3RDbGFpbURhaWx5Qm9udXNEYXk7XG4gICAgICAgIHZhciBjdXJyZW50RGF5Q2xhaW1lZCA9IChsYXN0Q2xhaW1EYXkgPj0gZ2FtZS51dGlscy5nZXREYXlCeVRzKERhdGUubm93KCkpKTtcbiAgICAgICAgdmFyIGRhaWx5Qm9udXNTZWNvbmRzID0gMDtcbiAgICAgICAgaWYgKGN1cnJlbnREYXlDbGFpbWVkKSB7XG4gICAgICAgICAgICB2YXIgbmV4dERheVRpbWUgPSAoZ2FtZS51dGlscy5nZXREYXlCeVRzKERhdGUubm93KCkpICsgMSkgKiAoMjQgKiAzNjAwICogMTAwMCk7XG4gICAgICAgICAgICBkYWlseUJvbnVzU2Vjb25kcyA9IChuZXh0RGF5VGltZSAtIERhdGUubm93KCkpIC8gMTAwMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGFpbHlCb251c1NlY29uZHMgPD0gNjAgKiA2MCkge1xuICAgICAgICAgICAgZGFpbHlCb251c1NlY29uZHMgPSA2MCAqIDYwO1xuICAgICAgICB9XG4gICAgICAgIGdhbWUubm90aWZpY2F0aW9uTWFuYWdlci5zY2hlZHVsZU5vdGlmaWNhdGlvbihkYWlseUJvbnVzU2Vjb25kcyxcbiAgICAgICAgICAgIF8oXCJkYWlseV9ib251c19pc19yZWFkeVwiKSwgZ2FtZS5sb2NhbC5nZXRWYWx1ZShcImFwcF9uYW1lXCIpLCBpbmRleCsrKTtcblxuICAgICAgICB2YXIgbWF4VGltZSA9IE1hdGgubWF4KGxlZnRUaW1lU2Vjb25kcywgZGFpbHlCb251c1NlY29uZHMpO1xuXG4gICAgICAgIC8vbm9ybWFsIG5vdGlmaWNhdGlvbi5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBOT1RJRklDQVRJT05fREFZUy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgZ2FtZS5ub3RpZmljYXRpb25NYW5hZ2VyLnNjaGVkdWxlTm90aWZpY2F0aW9uKG1heFRpbWUgKyBEQVlfSU5fU0VDT05EUyAqIE5PVElGSUNBVElPTl9EQVlTW2ldLFxuICAgICAgICAgICAgICAgIGdhbWUubG9jYWwuZ2V0VmFsdWUoZ2FtZS51dGlscy5zcHJpbnRmKFwibm90aV90aXBzJWRcIiwgaSArIDEpKSwgZ2FtZS5sb2NhbC5nZXRWYWx1ZShcImFwcF9uYW1lXCIpLCBpbmRleCsrKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByc3luY1VzZXJEYXRhRnJvbUdDOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vdmFyIGhpZ2hMZXZlbCA9IGdhbWUuZ2NNYW5hZ2VyLmhpZ2hTY29yZUZvckxlYWRlcmJvYXJkKGdhbWUuY29uZmlnLmdldExlYWRlckJvYXJkS2V5KCkpO1xuICAgICAgICAvL2lmIChoaWdoTGV2ZWwgPiBnYW1lLnBsYXllck1hbi5nZXRMZXZlbCgpKSB7XG4gICAgICAgIC8vICAgIGdhbWUucGxheWVyTWFuLnNldExldmVsKGhpZ2hMZXZlbCk7XG4gICAgICAgIC8vfVxuICAgIH0sXG5cbiAgICB0cnlSb2xsYmFja0RhdGE6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGdhbWUucGxheWVyTWFuLnBsYXllci5jdXJyZW50RGF5ICE9PSBnYW1lLnV0aWxzLmdldEN1cnJlbnREYXkoKSkge1xuICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4ucmVzZXREYWlseVRhc2tEYXRhKCk7XG4gICAgICAgICAgICBnYW1lLnBsYXllck1hbi5yZXNldEN1cnJlbnREYXkoKTtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuXG5Mb2dpY01hbi5faW5zdGFuY2UgPSBudWxsO1xuTG9naWNNYW4uX2ZpcnN0VXNlSW5zdGFuY2UgPSB0cnVlO1xuXG4vKipcbiAqXG4gKiBAcmV0dXJucyB7TG9naWNNYW59XG4gKi9cbkxvZ2ljTWFuLmdldEluc3RhbmNlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChMb2dpY01hbi5fZmlyc3RVc2VJbnN0YW5jZSkge1xuICAgICAgICBMb2dpY01hbi5fZmlyc3RVc2VJbnN0YW5jZSA9IGZhbHNlO1xuICAgICAgICBMb2dpY01hbi5faW5zdGFuY2UgPSBuZXcgTG9naWNNYW4oKTtcbiAgICB9XG4gICAgcmV0dXJuIExvZ2ljTWFuLl9pbnN0YW5jZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gTG9naWNNYW47IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMTUvNS8xMi5cbiAqL1xudmFyIFBsYXllckluZm8gPSByZXF1aXJlKFwiLi4vZW50aXR5L1BsYXllckluZm9cIik7XG5cbnZhciBQTEFZRVJfS0VZID0gXCJwbGF5ZXJfa2V5XCI7XG5cbnZhciBQbGF5ZXJNYW4gPSBjYy5DbGFzcy5leHRlbmQoe1xuICAgIHBsYXllcjogbnVsbCxcbiAgICBiZXN0U2NvcmVLZXk6IG51bGwsXG4gICAgbGV2ZWxCb2FyZEtleTogbnVsbCxcbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgfSxcblxuICAgIGluaXREYXRhOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBwbGF5ZXJJbmZvU3RyID0gZ2FtZS5zdG9yYWdlQ29udHJvbGxlci5nZXRJdGVtKFBMQVlFUl9LRVksIG51bGwpO1xuICAgICAgICB2YXIgcGxheWVyO1xuICAgICAgICBpZiAocGxheWVySW5mb1N0ciA9PSBudWxsIHx8IHBsYXllckluZm9TdHIgPT0gXCJcIikge1xuICAgICAgICAgICAgcGxheWVyID0gUGxheWVySW5mby5jcmVhdGVEZWZhdWx0KCk7XG4gICAgICAgICAgICBnYW1lLnN0b3JhZ2VDb250cm9sbGVyLnNldEl0ZW0oUExBWUVSX0tFWSwgSlNPTi5zdHJpbmdpZnkocGxheWVyKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwbGF5ZXIgPSBuZXcgUGxheWVySW5mbygpO1xuICAgICAgICAgICAgcGxheWVyLnVubWFyc2hhbGwoSlNPTi5wYXJzZShwbGF5ZXJJbmZvU3RyKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5wbGF5ZXIgPSBwbGF5ZXI7XG4gICAgfSxcblxuICAgIGdldEJlc3RTY29yZTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wbGF5ZXIuYmVzdFNjb3JlO1xuICAgIH0sXG5cbiAgICBnZXRMZXZlbDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2MuaXNVbmRlZmluZWQodGhpcy5wbGF5ZXIubGV2ZWwpKSB7XG4gICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnBsYXllci5sZXZlbDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXRMZXZlbDogZnVuY3Rpb24gKGxldmVsKSB7XG4gICAgICAgIHRoaXMucGxheWVyLmxldmVsID0gbGV2ZWw7XG4gICAgICAgIHRoaXMuX2ZsdXNoVG9TdG9yYWdlKCk7XG4gICAgfSxcblxuICAgIHVwZGF0ZUxldmVsU3RhcjogZnVuY3Rpb24gKGxldmVsLCBsZXZlbFN0YXIpIHtcbiAgICAgICAgaWYgKGNjLmlzVW5kZWZpbmVkKHRoaXMucGxheWVyLmxldmVsTWFwW2xldmVsXSkgfHwgdGhpcy5wbGF5ZXIubGV2ZWxNYXBbbGV2ZWxdIDwgbGV2ZWxTdGFyKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5sZXZlbE1hcFtsZXZlbF0gPSBsZXZlbFN0YXI7XG4gICAgICAgICAgICBnYW1lLmdjTWFuYWdlci5yZXBvcnRTY29yZShsZXZlbCwgdGhpcy5nZXRMZXZlbEJvYXJkS2V5KCkpO1xuICAgICAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRMZXZlbFN0YXI6IGZ1bmN0aW9uIChsZXZlbCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wbGF5ZXIubGV2ZWxNYXBbbGV2ZWxdIHx8IDA7XG4gICAgfSxcblxuICAgIGFkZExldmVsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdhbWUuZ2NNYW5hZ2VyLnJlcG9ydFNjb3JlKHRoaXMucGxheWVyLmxldmVsLCB0aGlzLmdldExldmVsQm9hcmRLZXkoKSk7XG4gICAgICAgIHRoaXMucGxheWVyLmxldmVsKys7XG4gICAgICAgIHRoaXMucGxheWVyLnByb2dyZXNzID0gMDtcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgdXBkYXRlQmVzdFNjb3JlOiBmdW5jdGlvbiAobmV3QmVzdFNjb3JlKSB7XG4gICAgICAgIGlmIChuZXdCZXN0U2NvcmUgPiB0aGlzLnBsYXllci5iZXN0U2NvcmUpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLmJlc3RTY29yZSA9IG5ld0Jlc3RTY29yZTtcbiAgICAgICAgICAgIGdhbWUuZ2NNYW5hZ2VyLnJlcG9ydFNjb3JlKG5ld0Jlc3RTY29yZSwgdGhpcy5nZXRCZXN0U2NvcmVCb2FyZEtleSgpKTtcbiAgICAgICAgICAgIHRoaXMuX2ZsdXNoVG9TdG9yYWdlKCk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIGdldExldmVsQm9hcmRLZXk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGV2ZWxCb2FyZEtleSB8fCBnYW1lLmNvbmZpZy5nZXRMZWFkZXJCb2FyZEtleSgpO1xuICAgIH0sXG5cbiAgICBnZXRCZXN0U2NvcmVCb2FyZEtleTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5iZXN0U2NvcmVLZXkgfHwgZ2FtZS5jb25maWcuZ2V0TGVhZGVyQm9hcmRLZXkoKTtcbiAgICB9LFxuXG4gICAgc2V0TGV2ZWxCb2FyZEtleTogZnVuY3Rpb24gKGtleSkge1xuICAgICAgICB0aGlzLmxldmVsQm9hcmRLZXkgPSBrZXk7XG4gICAgfSxcblxuICAgIHNldEJlc3RTY29yZUJvYXJkS2V5OiBmdW5jdGlvbiAoYmVzdFNjb3JlS2V5KSB7XG4gICAgICAgIHRoaXMuYmVzdFNjb3JlS2V5ID0gYmVzdFNjb3JlS2V5O1xuICAgIH0sXG5cbiAgICB1cGRhdGVQcm9ncmVzczogZnVuY3Rpb24gKHByb2dyZXNzKSB7XG4gICAgICAgIGlmICh0aGlzLnBsYXllci5wcm9ncmVzcyA8IHByb2dyZXNzKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5wcm9ncmVzcyA9IHByb2dyZXNzO1xuICAgICAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByZW1vdmVkQWRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucGxheWVyLnJlbW92ZWRBZHMgPSB0cnVlO1xuICAgICAgICBnYW1lLmFkc01hbmFnZXIucmVtb3ZlQmFubmVyQWRzKCk7XG4gICAgICAgIHRoaXMuX2ZsdXNoVG9TdG9yYWdlKCk7XG4gICAgfSxcblxuICAgIHNldFJhdGVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucGxheWVyLnJhdGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgX2ZsdXNoVG9TdG9yYWdlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdhbWUuc3RvcmFnZUNvbnRyb2xsZXIuc2V0SXRlbShQTEFZRVJfS0VZLCBKU09OLnN0cmluZ2lmeSh0aGlzLnBsYXllcikpO1xuICAgIH1cbn0pO1xuXG5QbGF5ZXJNYW4uX2luc3RhbmNlID0gbnVsbDtcblBsYXllck1hbi5fZmlyc3RVc2VJbnN0YW5jZSA9IHRydWU7XG5cbi8qKlxuICpcbiAqIEByZXR1cm5zIHtQbGF5ZXJNYW59XG4gKi9cblBsYXllck1hbi5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoUGxheWVyTWFuLl9maXJzdFVzZUluc3RhbmNlKSB7XG4gICAgICAgIFBsYXllck1hbi5fZmlyc3RVc2VJbnN0YW5jZSA9IGZhbHNlO1xuICAgICAgICBQbGF5ZXJNYW4uX2luc3RhbmNlID0gbmV3IFBsYXllck1hbigpO1xuICAgIH1cbiAgICByZXR1cm4gUGxheWVyTWFuLl9pbnN0YW5jZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUGxheWVyTWFuOyIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDE1LzQvMjIuXG4gKi9cbnZhciBIdHRwQ2xpZW50ID0ge1xuXG4gICAgLyoqXG4gICAgICogZ2V0IHJlcXVlc3QsanNiIG9rLGh0bWw1IHNob3dzICBObyAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJyBoZWFkZXIgaXMgcHJlc2VudCBvbiB0aGUgcmVxdWVzdGVkIHJlc291cmNlXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHVybFxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrXG4gICAgICovXG4gICAgZG9HZXQ6IGZ1bmN0aW9uICh1cmwsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciB4aHIgPSBjYy5sb2FkZXIuZ2V0WE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgeGhyLm9wZW4oXCJHRVRcIiwgdXJsLCB0cnVlKTtcblxuICAgICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY2MubG9nKFwicmVhZHlTdGF0ZTpcIit4aHIucmVhZHlTdGF0ZStcIixzdGF0dXM6XCIreGhyLnN0YXR1cytcIixzdGF0dVRleHQ6XCIreGhyLnN0YXR1c1RleHQrXCIsLCxyZXNwb25zZVRleHQ6XCIreGhyLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT0gNCAmJiB4aHIuc3RhdHVzID09IDIwMCkge1xuICAgICAgICAgICAgICAgIHZhciBodHRwU3RhdHVzID0geGhyLnN0YXR1c1RleHQ7XG4gICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0geGhyLnJlc3BvbnNlVGV4dDtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHhoci5zdGF0dXNUZXh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgeGhyLnNlbmQoKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHBhcmFtXG4gICAgICogQHBhcmFtIHtPYmplY3QuPHN0cmluZyxzdHJpbmc+fSBoZWFkZXJzXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2tcbiAgICAgKi9cbiAgICBkb1Bvc3Q6IGZ1bmN0aW9uICh1cmwsIHBhcmFtcywgaGVhZGVycywgY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIHhociA9IGNjLmxvYWRlci5nZXRYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICB4aHIub3BlbihcIlBPU1RcIiwgdXJsKTtcbiAgICAgICAgZm9yICh2YXIga2V5IGluIGhlYWRlcnMpIHtcbiAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKGtleSwgaGVhZGVyc1trZXldKTtcbiAgICAgICAgfVxuICAgICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID09IDQpIHtcbiAgICAgICAgICAgICAgICBpZiAoeGhyLnN0YXR1cyA+PSAyMDAgJiYgeGhyLnN0YXR1cyA8PSAyMDcpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgeGhyLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soeGhyLnN0YXR1cywgeGhyLnN0YXR1c1RleHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHhoci5zZW5kKHBhcmFtcyk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgfVxuICAgIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gSHR0cENsaWVudDsiLCJ2YXIgTW9kYWxMYXllciA9IHJlcXVpcmUoXCIuL01vZGFsTGF5ZXJcIik7XG5cbnZhciBEaWFsb2dNYW5hZ2VyID0gY2MuQ2xhc3MuZXh0ZW5kKHtcbiAgICBESUFMT0dfWk9SREVSX0JFR0lOOiA5OTksXG4gICAgRElBTE9HX1pPUkRFUl9TVEVQOiAyLFxuXG4gICAgLyoqXG4gICAgICogQHR5cGVzIHtNb2RhbExheWVyfVxuICAgICAqL1xuICAgIF9vdmVybGF5OiBudWxsLFxuICAgIF9zY2FsZUZhY3RvcjogMCxcbiAgICAvKipcbiAgICAgKiBAdHlwZXMge0FycmF5LjxNb2RhbExheWVyPn1cbiAgICAgKi9cbiAgICBfZGlhbG9nU3RhY2s6IG51bGwsXG5cbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgfSxcblxuICAgIGNyZWF0ZU92ZXJsYXk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fb3ZlcmxheSA9IG5ldyBNb2RhbExheWVyKCk7XG4gICAgICAgIHRoaXMuX292ZXJsYXkuc2V0Q29sb3IoY2MuY29sb3IuQkxBQ0spO1xuICAgICAgICB0aGlzLl9vdmVybGF5LnNldE9wYWNpdHkoMTkwKTtcbiAgICAgICAgdGhpcy5fb3ZlcmxheS5zZXRDb250ZW50U2l6ZShjYy5zaXplKGNjLndpblNpemUud2lkdGgsIGNjLndpblNpemUuaGVpZ2h0KSk7XG4gICAgICAgIHRoaXMuX292ZXJsYXkuc2V0TG9jYWxaT3JkZXIoOTk5KTtcbiAgICAgICAgdGhpcy5fb3ZlcmxheS5yZXRhaW4oKTtcbiAgICAgICAgdGhpcy5fc2NhbGVGYWN0b3IgPSAxLjA7XG4gICAgICAgIHRoaXMuX2RpYWxvZ1N0YWNrID0gW107XG4gICAgfSxcblxuICAgIHBvcHVwOiBmdW5jdGlvbiAoZGxnLCBwYXJhbSkge1xuICAgICAgICBkbGcuaWdub3JlQW5jaG9yUG9pbnRGb3JQb3NpdGlvbihmYWxzZSk7XG4gICAgICAgIGRsZy5zZXRTY2FsZSh0aGlzLl9zY2FsZUZhY3Rvcik7XG4gICAgICAgIHZhciBkbGdMZW4gPSB0aGlzLl9kaWFsb2dTdGFjay5sZW5ndGg7XG4gICAgICAgIGNjLmxvZyhcImRsZ0xlbjpcIiArIGRsZ0xlbik7XG4gICAgICAgIGlmIChkbGdMZW4gPT0gMCkge1xuICAgICAgICAgICAgZGxnLnNldExvY2FsWk9yZGVyKHRoaXMuRElBTE9HX1pPUkRFUl9CRUdJTik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBkbGcuc2V0TG9jYWxaT3JkZXIodGhpcy5fZGlhbG9nU3RhY2tbZGxnTGVuIC0gMV0uZ2V0TG9jYWxaT3JkZXIoKSArIHRoaXMuRElBTE9HX1pPUkRFUl9TVEVQKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9kaWFsb2dTdGFjay5wdXNoKGRsZyk7XG5cbiAgICAgICAgaWYgKHBhcmFtICYmIHBhcmFtLndpdGhvdXRPdmVybGF5KSB7XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX292ZXJsYXkuc2V0TG9jYWxaT3JkZXIoZGxnLmdldExvY2FsWk9yZGVyKCkgLSAxKTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9vdmVybGF5LmdldFBhcmVudCgpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmF0dGFjaFNjZW5lKHRoaXMuX292ZXJsYXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHBhcmFtICYmIHBhcmFtLm92ZXJsYXlDb2xvcikge1xuICAgICAgICAgICAgICAgIHRoaXMuX292ZXJsYXkuc2V0Q29sb3IocGFyYW0ub3ZlcmxheUNvbG9yKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fb3ZlcmxheS5zZXRDb2xvcihjYy5jb2xvci5CTEFDSyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChwYXJhbSAmJiBwYXJhbS5vdmVybGF5T3BhY2l0eSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX292ZXJsYXkuc2V0T3BhY2l0eShwYXJhbS5vdmVybGF5T3BhY2l0eSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX292ZXJsYXkuc2V0T3BhY2l0eSgxOTApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHBhcmFtICYmIHBhcmFtLnBvcHVwQW5pbSkge1xuICAgICAgICAgICAgaWYgKGRsZy5nZXRDaGlsZHJlbigpICYmIGRsZy5nZXRDaGlsZHJlbigpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAvL3RoaXMuX292ZXJsYXkuc2V0TG9jYWxaT3JkZXIoZGxnLmdldExvY2FsWk9yZGVyKCkgKyAxKTtcbiAgICAgICAgICAgICAgICB0aGlzLnBvcHVwRGlhbG9nQW5pbShkbGcuZ2V0Q2hpbGRyZW4oKVswXSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAvL3RoaXMuX292ZXJsYXkuc2V0TG9jYWxaT3JkZXIoZGxnLmdldExvY2FsWk9yZGVyKCkgLSAxKTtcbiAgICAgICAgICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuYXR0YWNoU2NlbmUoZGxnKTtcblxuICAgICAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KFwiZGlhbG9nX3BvcGVkXCIpO1xuICAgIH0sXG5cbiAgICBwb3B1cERpYWxvZ0FuaW06IGZ1bmN0aW9uIChwYW5lbCxjYWxsYmFjayxjYWxsYmFja1RhcmdldCkge1xuICAgICAgICBwYW5lbC5zZXRTY2FsZSgwLjgsIDAuOCk7XG4gICAgICAgIHBhbmVsLnJ1bkFjdGlvbihjYy5zZXF1ZW5jZShcbiAgICAgICAgICAgIGNjLnNjYWxlVG8oMC4wNjYsIDEuMDUsIDEuMDUpLmVhc2luZyhjYy5lYXNlT3V0KDIpKSxcbiAgICAgICAgICAgIGNjLnNjYWxlVG8oMC4wNSwgMC45OCwgMC45OCkuZWFzaW5nKGNjLmVhc2VPdXQoMikpLFxuICAgICAgICAgICAgY2Muc2NhbGVUbygwLjA4NCwgMSwgMSkuZWFzaW5nKGNjLmVhc2VPdXQoMikpLFxuICAgICAgICAgICAgY2MuY2FsbEZ1bmMoY2FsbGJhY2ssIGNhbGxiYWNrVGFyZ2V0KVxuICAgICAgICApKTtcbiAgICB9LFxuXG4gICAgYXR0YWNoU2NlbmU6IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgIGNjLmRpcmVjdG9yLmdldFJ1bm5pbmdTY2VuZSgpLmFkZENoaWxkKG5vZGUpO1xuICAgIH0sXG5cbiAgICBjbG9zZTogZnVuY3Rpb24gKGRsZywgZGlzcG9zZSkge1xuICAgICAgICBpZiAoY2MuaXNVbmRlZmluZWQoZGlzcG9zZSkpIHtcbiAgICAgICAgICAgIGRpc3Bvc2UgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHZhciBjbG9zZUluZGV4O1xuICAgICAgICB2YXIgZGxnTGVuID0gdGhpcy5fZGlhbG9nU3RhY2subGVuZ3RoO1xuICAgICAgICBmb3IgKGNsb3NlSW5kZXggPSBkbGdMZW4gLSAxOyBjbG9zZUluZGV4ID49IDA7IC0tY2xvc2VJbmRleCkge1xuICAgICAgICAgICAgaWYgKGRsZyA9PT0gdGhpcy5fZGlhbG9nU3RhY2tbY2xvc2VJbmRleF0pIHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjbG9zZUluZGV4ID49IDApIHtcbiAgICAgICAgICAgIHRoaXMuX2RpYWxvZ1N0YWNrLnNwbGljZShjbG9zZUluZGV4LCAxKTtcbiAgICAgICAgICAgIGRsZ0xlbiA9IHRoaXMuX2RpYWxvZ1N0YWNrLmxlbmd0aDtcbiAgICAgICAgICAgIGRsZy5yZW1vdmVGcm9tUGFyZW50KGRpc3Bvc2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuX292ZXJsYXkuZ2V0UGFyZW50KCkgIT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKGRsZ0xlbiA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX292ZXJsYXkucmVtb3ZlRnJvbVBhcmVudChmYWxzZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciB0b3BJbmRleCA9IGRsZ0xlbiAtIDE7XG5cbiAgICAgICAgICAgICAgICBpZiAodG9wSW5kZXggPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9vdmVybGF5LnNldExvY2FsWk9yZGVyKHRoaXMuX2RpYWxvZ1N0YWNrW3RvcEluZGV4XS5nZXRMb2NhbFpPcmRlcigpIC0gMSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb3ZlcmxheS5yZW1vdmVGcm9tUGFyZW50KGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGlhbG9nU3RhY2subGVuZ3RoID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChcImRpYWxvZ19jbG9zZWRcIik7XG4gICAgfSxcblxuICAgIGNsb3NlQWxsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBkbGdMZW4gPSB0aGlzLl9kaWFsb2dTdGFjay5sZW5ndGg7XG4gICAgICAgIHdoaWxlIChkbGdMZW4gIT0gMCkge1xuICAgICAgICAgICAgdmFyIG1vZGFsTGF5ZXIgPSB0aGlzLl9kaWFsb2dTdGFja1tkbGdMZW4gLSAxXTtcbiAgICAgICAgICAgIHRoaXMuY2xvc2UobW9kYWxMYXllciwgdHJ1ZSk7XG4gICAgICAgICAgICBkbGdMZW4gPSB0aGlzLl9kaWFsb2dTdGFjay5sZW5ndGg7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgaXNUb3Blc3REaWFsb2c6IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgIHJldHVybiAodGhpcy5fZGlhbG9nU3RhY2tbdGhpcy5fZGlhbG9nU3RhY2subGVuZ3RoIC0gMV0gPT09IG5vZGUpO1xuICAgIH0sXG5cbiAgICBoYXNEbGc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RpYWxvZ1N0YWNrLmxlbmd0aCA+IDA7XG4gICAgfVxuXG59KTtcblxuRGlhbG9nTWFuYWdlci5faW5zdGFuY2UgPSBudWxsO1xuRGlhbG9nTWFuYWdlci5fZmlyc3RVc2VJbnN0YW5jZSA9IHRydWU7XG5cbi8qKlxuICpcbiAqIEByZXR1cm5zIHtEaWFsb2dNYW5hZ2VyfVxuICovXG5EaWFsb2dNYW5hZ2VyLmdldEluc3RhbmNlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChEaWFsb2dNYW5hZ2VyLl9maXJzdFVzZUluc3RhbmNlKSB7XG4gICAgICAgIERpYWxvZ01hbmFnZXIuX2ZpcnN0VXNlSW5zdGFuY2UgPSBmYWxzZTtcbiAgICAgICAgRGlhbG9nTWFuYWdlci5faW5zdGFuY2UgPSBuZXcgRGlhbG9nTWFuYWdlcigpO1xuICAgIH1cbiAgICByZXR1cm4gRGlhbG9nTWFuYWdlci5faW5zdGFuY2U7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IERpYWxvZ01hbmFnZXI7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMTUvNC8yOC5cbiAqL1xudmFyIE1vZGFsTGF5ZXIgPSBjYy5MYXllckNvbG9yLmV4dGVuZCh7XG4gICAgY3RvcjpmdW5jdGlvbigpe1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgICAgICBjYy5ldmVudE1hbmFnZXIuYWRkTGlzdGVuZXIoe1xuICAgICAgICAgICAgZXZlbnQ6IGNjLkV2ZW50TGlzdGVuZXIuVE9VQ0hfT05FX0JZX09ORSxcbiAgICAgICAgICAgIHN3YWxsb3dUb3VjaGVzOiB0cnVlLFxuICAgICAgICAgICAgb25Ub3VjaEJlZ2FuOiB0aGlzLm9uVG91Y2hCZWdhbi5iaW5kKHRoaXMpXG4gICAgICAgIH0sIHRoaXMpO1xuICAgIH0sXG4gICAgb25Ub3VjaEJlZ2FuOmZ1bmN0aW9uKHRvdWNoLCBldmVudCkge1xuICAgICAgICBpZighdGhpcy5pc1Zpc2libGUoKSB8fCAoIXRoaXMuaXNUb3VjaEluc2lkZSh0aGlzLHRvdWNoKSkpe1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG4gICAgaXNUb3VjaEluc2lkZTogZnVuY3Rpb24gKG93bmVyLHRvdWNoKSB7XG4gICAgICAgIGlmKCFvd25lciB8fCAhb3duZXIuZ2V0UGFyZW50KCkpe1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHZhciB0b3VjaExvY2F0aW9uID0gdG91Y2guZ2V0TG9jYXRpb24oKTsgLy8gR2V0IHRoZSB0b3VjaCBwb3NpdGlvblxuICAgICAgICB0b3VjaExvY2F0aW9uID0gb3duZXIuZ2V0UGFyZW50KCkuY29udmVydFRvTm9kZVNwYWNlKHRvdWNoTG9jYXRpb24pO1xuICAgICAgICByZXR1cm4gY2MucmVjdENvbnRhaW5zUG9pbnQob3duZXIuZ2V0Qm91bmRpbmdCb3goKSwgdG91Y2hMb2NhdGlvbik7XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gTW9kYWxMYXllcjsiLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAxNS80LzIzLlxuICovXG5cbnZhciBTdG9yYWdlQ29udHJvbGxlciA9IGNjLkNsYXNzLmV4dGVuZCh7XG4gICAgc2V0SXRlbTogZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcbiAgICAgICAgY2Muc3lzLmxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgdmFsdWUpO1xuICAgIH0sXG4gICAgZ2V0SXRlbTogZnVuY3Rpb24gKGtleSwgZGVmYXVsdFZhbHVlKSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IGNjLnN5cy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpO1xuICAgICAgICBpZiAodmFsdWUgPT0gXCJcIiB8fCB2YWx1ZSA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gZGVmYXVsdFZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9LFxuICAgIHJlbW92ZUl0ZW06IGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgY2Muc3lzLmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XG4gICAgfVxufSk7XG5cblN0b3JhZ2VDb250cm9sbGVyLl9pbnN0YW5jZSA9IG51bGw7XG5TdG9yYWdlQ29udHJvbGxlci5fZmlyc3RVc2VJbnN0YW5jZSA9IHRydWU7XG5cbi8qKlxuICpcbiAqIEByZXR1cm5zIHtTdG9yYWdlQ29udHJvbGxlcn1cbiAqL1xuU3RvcmFnZUNvbnRyb2xsZXIuZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKFN0b3JhZ2VDb250cm9sbGVyLl9maXJzdFVzZUluc3RhbmNlKSB7XG4gICAgICAgIFN0b3JhZ2VDb250cm9sbGVyLl9maXJzdFVzZUluc3RhbmNlID0gZmFsc2U7XG4gICAgICAgIFN0b3JhZ2VDb250cm9sbGVyLl9pbnN0YW5jZSA9IG5ldyBTdG9yYWdlQ29udHJvbGxlcigpO1xuICAgIH1cbiAgICByZXR1cm4gU3RvcmFnZUNvbnRyb2xsZXIuX2luc3RhbmNlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBTdG9yYWdlQ29udHJvbGxlcjsiLCIvKipcbiAqIENyZWF0ZWQgYnkgb3llIG9uIDE2LzMvMTIuXG4gKi9cblxudmFyIEF1ZGlvSGVscGVyID0ge1xuICAgIHBsYXlCdG5Tb3VuZDogZnVuY3Rpb24gKCkge1xuICAgICAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImVudGVyXCIpO1xuICAgIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQXVkaW9IZWxwZXI7IiwidmFyIEZpbGVDYWNoZVN0dWIgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNhY2hlZEZpbGVzID0gW107XG59O1xuXG5GaWxlQ2FjaGVTdHViLnByb3RvdHlwZS5jYWNoZUZpbGUgPSBmdW5jdGlvbihmaWxlbmFtZSkge1xuICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgaWYoY2Muc3lzLm9zID09IGNjLnN5cy5PU19BTkRST0lEKSB7XG4gICAgICAgICAgICAvLyBjYy5sb2coXCJGaWxlQ2FjaGVTdHViLnByb3RvdHlwZS5jYWNoZUZpbGUuYW5kcm9pZFwiKTtcbiAgICAgICAgICAgIGlmKGpzYi5maWxlVXRpbHMuY2FjaGVGaWxlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJldCA9IGpzYi5maWxlVXRpbHMuY2FjaGVGaWxlKGZpbGVuYW1lKTtcbiAgICAgICAgICAgICAgICAvLyBjYy5sb2coXCJGaWxlQ2FjaGVTdHViLnByb3RvdHlwZS5jYWNoZUZpbGUgLS0tLT4gY2FjaGU6XCIgKyBmaWxlbmFtZSArIFwiLCByZXQ6XCIgKyByZXQpO1xuICAgICAgICAgICAgICAgIHRoaXMuY2FjaGVkRmlsZXMucHVzaChmaWxlbmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG5GaWxlQ2FjaGVTdHViLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uKCkge1xuICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgaWYoY2Muc3lzLm9zID09IGNjLnN5cy5PU19BTkRST0lEKSB7XG4gICAgICAgICAgICBpZiAoanNiLmZpbGVVdGlscy51bmNhY2hlRmlsZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuY2FjaGVkRmlsZXMuZm9yRWFjaChmdW5jdGlvbiAoZmlsZW5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAganNiLmZpbGVVdGlscy51bmNhY2hlRmlsZShmaWxlbmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNjLmxvZyhcIkZpbGVDYWNoZVN0dWIucHJvdG90eXBlLmRpc3Bvc2UgLS0tLT4gdW5jYWNoZWQgZmlsZSBcIiArIGZpbGVuYW1lKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuY2FjaGVkRmlsZXMgPSBbXTtcbiAgICAgICAgfVxuICAgIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gRmlsZUNhY2hlU3R1YjsiLCIvKipcbiAqIENyZWF0ZWQgYnkgb3llIG9uIDE1LTQtMTkuXG4gKi9cbnZhciB0aW1lc3BhbiA9IHJlcXVpcmUoJ3RpbWVzcGFuJyk7XG5cbnZhciBVdGlscyA9IHtcbiAgICAvKipcbiAgICAgKiBHZW5lcmF0ZSBhIHJhbmRvbSBpbnRlZ2VyIHZhbHVlIHdoaWNoIG1lZXRzIFswLCB1cHBlclZhbHVlKVxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSB1cHBlclZhbHVlXG4gICAgICogQHJldHVybnMge251bWJlcn1cbiAgICAgKi9cbiAgICByYW5kb21OZXh0SW50OiBmdW5jdGlvbih1cHBlclZhbHVlKSB7XG4gICAgICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB1cHBlclZhbHVlKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogZ2VuZXJhdGUgYSByYW5kb20gbnVtYmVyIHZhbHVlIHdoaWNoIG1lZXRzIFswLCB1cHBlclZhbHVlKVxuICAgICAqIEBwYXJhbSB1cHBlclZhbHVlXG4gICAgICogQHJldHVybnMge251bWJlcn1cbiAgICAgKi9cbiAgICByYW5kb21OZXh0TnVtYmVyOiBmdW5jdGlvbiAodXBwZXJWYWx1ZSkge1xuICAgICAgICByZXR1cm4gTWF0aC5yYW5kb20oKSAqIHVwcGVyVmFsdWU7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIHJhbmRvbSBhIGludGVnZXIgZnJvbSBbbWluLCBtYXhdXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IG1pblxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBtYXhcbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfVxuICAgICAqL1xuICAgIHJhbmdlTmV4dEludDogZnVuY3Rpb24obWluLCBtYXgpIHtcbiAgICAgICAgcmV0dXJuIG1pbiArIHRoaXMucmFuZG9tTmV4dEludChtYXggLSBtaW4gKyAxKTtcbiAgICB9LFxuXG4gICAgcmFuZ2VOZXh0TnVtYmVyOiBmdW5jdGlvbiAobWluLCBtYXgpIHtcbiAgICAgICAgcmV0dXJuIG1pbiArIHRoaXMucmFuZG9tTmV4dE51bWJlcihtYXggLSBtaW4pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBHZW5lcmF0ZSBhIHJhbmRvbSBudW1iZXIgdmFsdWUgd2hpY2ggbWVldHMgW2xvd2VyVmFsdWUsIHVwcGVyVmFsdWUpXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGxvd2VyVmFsdWVcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gdXBwZXJWYWx1ZVxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9XG4gICAgICovXG4gICAgcmFuZG9tTmV4dE51bWJlckluUmFuZ2U6IGZ1bmN0aW9uIChsb3dlclZhbHVlLCB1cHBlclZhbHVlKSB7XG4gICAgICAgIHJldHVybiBNYXRoLnJhbmRvbSgpICogKHVwcGVyVmFsdWUgLSBsb3dlclZhbHVlKSArIGxvd2VyVmFsdWU7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEdlbmVyYXRlIGEgcmFuZG9tIGludGVnZXIgdmFsdWUgd2hpY2ggbWVldHMgW2xvd2VyVmFsdWUsIHVwcGVyVmFsdWUpXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGxvd2VyVmFsdWVcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gdXBwZXJWYWx1ZVxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9XG4gICAgICovXG4gICAgcmFuZG9tTmV4dEludEluUmFuZ2U6IGZ1bmN0aW9uIChsb3dlclZhbHVlLCB1cHBlclZhbHVlKSB7XG4gICAgICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAodXBwZXJWYWx1ZSAtIGxvd2VyVmFsdWUpICsgbG93ZXJWYWx1ZSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOagvOW8j+WMluWtl+espuS4slxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9XG4gICAgICovXG4gICAgc3ByaW50ZjogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaSA9IDAsIGEsIGYgPSBhcmd1bWVudHNbaSsrXSwgbyA9IFtdLCBtLCBwLCBjLCB4LCBzID0gJyc7XG4gICAgICAgIHdoaWxlIChmKSB7XG4gICAgICAgICAgICBpZiAobSA9IC9eW15cXHgyNV0rLy5leGVjKGYpKSB7XG4gICAgICAgICAgICAgICAgby5wdXNoKG1bMF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAobSA9IC9eXFx4MjV7Mn0vLmV4ZWMoZikpIHtcbiAgICAgICAgICAgICAgICBvLnB1c2goJyUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKG0gPSAvXlxceDI1KD86KFxcZCspXFwkKT8oXFwrKT8oMHwnW14kXSk/KC0pPyhcXGQrKT8oPzpcXC4oXFxkKykpPyhbYi1mb3N1eFhdKS8uZXhlYyhmKSkge1xuICAgICAgICAgICAgICAgIGlmICgoKGEgPSBhcmd1bWVudHNbbVsxXSB8fCBpKytdKSA9PSBudWxsKSB8fCAoYSA9PSB1bmRlZmluZWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93KCdUb28gZmV3IGFyZ3VtZW50cy4nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKC9bXnNdLy50ZXN0KG1bN10pICYmICh0eXBlb2YoYSkgIT0gJ251bWJlcicpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93KCdFeHBlY3RpbmcgbnVtYmVyIGJ1dCBmb3VuZCAnICsgdHlwZW9mKGEpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc3dpdGNoIChtWzddKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2InOlxuICAgICAgICAgICAgICAgICAgICAgICAgYSA9IGEudG9TdHJpbmcoMik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYyc6XG4gICAgICAgICAgICAgICAgICAgICAgICBhID0gU3RyaW5nLmZyb21DaGFyQ29kZShhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdkJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGEgPSBwYXJzZUludChhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGEgPSBtWzZdID8gYS50b0V4cG9uZW50aWFsKG1bNl0pIDogYS50b0V4cG9uZW50aWFsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZic6XG4gICAgICAgICAgICAgICAgICAgICAgICBhID0gbVs2XSA/IHBhcnNlRmxvYXQoYSkudG9GaXhlZChtWzZdKSA6IHBhcnNlRmxvYXQoYSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbyc6XG4gICAgICAgICAgICAgICAgICAgICAgICBhID0gYS50b1N0cmluZyg4KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdzJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGEgPSAoKGEgPSBTdHJpbmcoYSkpICYmIG1bNl0gPyBhLnN1YnN0cmluZygwLCBtWzZdKSA6IGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3UnOlxuICAgICAgICAgICAgICAgICAgICAgICAgYSA9IE1hdGguYWJzKGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3gnOlxuICAgICAgICAgICAgICAgICAgICAgICAgYSA9IGEudG9TdHJpbmcoMTYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ1gnOlxuICAgICAgICAgICAgICAgICAgICAgICAgYSA9IGEudG9TdHJpbmcoMTYpLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYSA9ICgvW2RlZl0vLnRlc3QobVs3XSkgJiYgbVsyXSAmJiBhID49IDAgPyAnKycgKyBhIDogYSk7XG4gICAgICAgICAgICAgICAgYyA9IG1bM10gPyBtWzNdID09ICcwJyA/ICcwJyA6IG1bM10uY2hhckF0KDEpIDogJyAnO1xuICAgICAgICAgICAgICAgIHggPSBtWzVdIC0gU3RyaW5nKGEpLmxlbmd0aCAtIHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHAgPSBtWzVdID8gc3RyX3JlcGVhdChjLCB4KSA6ICcnO1xuICAgICAgICAgICAgICAgIG8ucHVzaChzICsgKG1bNF0gPyBhICsgcCA6IHAgKyBhKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aHJvdygnc3ByaW50ZiBwYXJhbXMgZXJyb3InKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGYgPSBmLnN1YnN0cmluZyhtWzBdLmxlbmd0aCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG8uam9pbignJyk7XG4gICAgfSxcblxuICAgIGdldERpc3RhbmNlIDogZnVuY3Rpb24ocG9pbnQxLHBvaW50Mil7XG4gICAgICAgIHJldHVybiBNYXRoLnNxcnQoKHBvaW50MS54IC0gcG9pbnQyLngpICogKHBvaW50MS54IC0gcG9pbnQyLngpICsgKHBvaW50MS55IC0gcG9pbnQyLnkpICogKHBvaW50MS55IC0gcG9pbnQyLnkpKTtcbiAgICB9LFxuXG4gICAgYXJyYXlDb250YWluIDogZnVuY3Rpb24gKGFyciwgZWxlbWVudCkge1xuICAgICAgICBpZihhcnIgJiYgYXJyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICBpZihhcnJbaV0gPT0gZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gY2NiRmlsZU5hbWVcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gY29udGFpbmVyTm9kZVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBjb250cm9sbGVyTmFtZVxuICAgICAqIEBwYXJhbSB7b2JqZWN0IHwgY2MuTm9kZX0gY29udHJvbGxlck5vZGVcbiAgICAgKiBAcmV0dXJucyB7Y2MuTm9kZSB8IG51bGx9XG4gICAgICovXG4gICAgbG9hZE5vZGVGcm9tQ0NCIDogZnVuY3Rpb24oY2NiRmlsZU5hbWUsY29udGFpbmVyTm9kZSxjb250cm9sbGVyTmFtZSxjb250cm9sbGVyTm9kZSwga2VlcENvbnRyb2xsZXIpe1xuICAgICAgICBjYy5sb2coXCJsb2FkIG5vZGUgZnJvbSBjY2I6XCIgKyBjY2JGaWxlTmFtZSk7XG4gICAgICAgIFV0aWxzLnNldFRyYWNrVmFsdWUoXCJjY2JOYW1lXCIsIGNjYkZpbGVOYW1lKTtcbiAgICAgICAgaWYoIWNjLmlzVW5kZWZpbmVkKGNvbnRyb2xsZXJOYW1lKSAmJiAhY2MuaXNVbmRlZmluZWQoY29udHJvbGxlck5vZGUpKXtcbiAgICAgICAgICAgIGNjLkJ1aWxkZXJSZWFkZXIucmVnaXN0ZXJDb250cm9sbGVyKGNvbnRyb2xsZXJOYW1lLGNvbnRyb2xsZXJOb2RlKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgbm9kZSA9IGNjLkJ1aWxkZXJSZWFkZXIubG9hZChjY2JGaWxlTmFtZSwgY29udGFpbmVyTm9kZSk7XG4gICAgICAgIGlmIChjb250cm9sbGVyTmFtZSAmJiBjb250cm9sbGVyTm9kZSAmJiAha2VlcENvbnRyb2xsZXIpIHtcbiAgICAgICAgICAgIGNjLkJ1aWxkZXJSZWFkZXIuX2NvbnRyb2xsZXJDbGFzc0NhY2hlW2NvbnRyb2xsZXJOYW1lXSA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICBub2RlLnJldGFpbigpO1xuICAgICAgICBjYy5sb2coXCJsb2FkIG5vZGUgcmV0YWluOlwiICsgY2NiRmlsZU5hbWUpO1xuICAgICAgICB0aGlzLmV4ZWN1dGVJbk5leHRGcmFtZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjYy5sb2coXCJsb2FkIG5vZGUgcmVsZWFzZTpcIiArIGNjYkZpbGVOYW1lKTtcbiAgICAgICAgICAgIG5vZGUucmVsZWFzZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIG5vZGU7XG4gICAgfSxcblxuICAgIHJlZ2lzdGVyQ29udHJvbGxlcjogZnVuY3Rpb24gKGNvbnRyb2xsZXJOYW1lLCBjb250cm9sbGVyTm9kZSkge1xuICAgICAgICBjYy5CdWlsZGVyUmVhZGVyLnJlZ2lzdGVyQ29udHJvbGxlcihjb250cm9sbGVyTmFtZSwgY29udHJvbGxlck5vZGUpO1xuICAgIH0sXG5cbiAgICB1blJlZ2lzdGVyQ29udHJvbGxlcjogZnVuY3Rpb24gKGNvbnRyb2xsZXJOYW1lKSB7XG4gICAgICAgIGNjLkJ1aWxkZXJSZWFkZXIuX2NvbnRyb2xsZXJDbGFzc0NhY2hlW2NvbnRyb2xsZXJOYW1lXSA9IHVuZGVmaW5lZDtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBzdWJUeXBlXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gc3VwZXJUeXBlXG4gICAgICovXG4gICAgaW5oZXJpdHM6IGZ1bmN0aW9uKHN1YlR5cGUsIHN1cGVyVHlwZSkge1xuICAgICAgICB2YXIgc3ViUHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlclR5cGUucHJvdG90eXBlKTtcbiAgICAgICAgc3ViUHJvdG90eXBlLmNvbnN0cnVjdG9yID0gc3ViVHlwZTtcbiAgICAgICAgc3ViVHlwZS5wcm90b3R5cGUgPSBzdWJQcm90b3R5cGU7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHVybFxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9XG4gICAgICovXG4gICAgbG9hZEpzb246IGZ1bmN0aW9uICh1cmwpIHtcbiAgICAgICAgaWYgKCFjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIHJldHVybiBjYy5sb2FkZXIuZ2V0UmVzKHVybCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZihqc2IuZmlsZVV0aWxzLmlzRmlsZUV4aXN0KHVybCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShqc2IuZmlsZVV0aWxzLmdldFN0cmluZ0Zyb21GaWxlKHVybCkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBsb2FkUGxpc3Q6IGZ1bmN0aW9uICh1cmwpIHtcbiAgICAgICAgaWYgKCFjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIHJldHVybiBjYy5sb2FkZXIuZ2V0UmVzKHVybCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZihqc2IuZmlsZVV0aWxzLmlzRmlsZUV4aXN0KHVybCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY2MucGxpc3RQYXJzZXIucGFyc2UoanNiLmZpbGVVdGlscy5nZXRTdHJpbmdGcm9tRmlsZSh1cmwpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZ2V0U2NyZWVuU2hvdDogZnVuY3Rpb24gKGZpbGVOYW1lKSB7XG4gICAgICAgIGNjLmxvZyhcImZpbGVOYW1lOlwiICsgZmlsZU5hbWUpO1xuICAgICAgICB2YXIgdGV4ID0gbmV3IGNjLlJlbmRlclRleHR1cmUoY2Mud2luU2l6ZS53aWR0aCwgY2Mud2luU2l6ZS5oZWlnaHQsIGNjLlRleHR1cmUyRC5QSVhFTF9GT1JNQVRfUkdCQTg4ODgpO1xuICAgICAgICB0ZXguc2V0UG9zaXRpb24oY2MucChjYy53aW5TaXplLndpZHRoIC8gMiwgY2Mud2luU2l6ZS5oZWlnaHQgLyAyKSk7XG4gICAgICAgIHRleC5iZWdpbigpO1xuICAgICAgICBjYy5kaXJlY3Rvci5nZXRSdW5uaW5nU2NlbmUoKS52aXNpdCgpO1xuICAgICAgICB0ZXguZW5kKCk7XG5cbiAgICAgICAgdmFyIGltZ1BhdGggPSBqc2IuZmlsZVV0aWxzLmdldFdyaXRhYmxlUGF0aCgpO1xuICAgICAgICBpZiAoaW1nUGF0aC5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHJlc3VsdCA9IHRleC5zYXZlVG9GaWxlKGZpbGVOYW1lLCBjYy5JTUFHRV9GT1JNQVRfSlBFRyk7XG4gICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICAgIGltZ1BhdGggKz0gZmlsZU5hbWU7XG4gICAgICAgICAgICBjYy5sb2coXCJzYXZlIGltYWdlOlwiICsgaW1nUGF0aCk7XG4gICAgICAgICAgICByZXR1cm4gaW1nUGF0aDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gXCJcIjtcbiAgICB9LFxuXG4gICAgaXNQYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGpzYl9kcC5vbmVTZGtCcmlkZ2UuaXNQYWQpIHtcbiAgICAgICAgICAgIHJldHVybiBqc2JfZHAub25lU2RrQnJpZGdlLmlzUGFkKCk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHdpblNpemUgPSBjYy53aW5TaXplO1xuICAgICAgICBpZiAoISFHYW1lQnJpZGdlLmdldENvbmZpZygpLmhvcml6b250YWxHYW1lKSB7XG4gICAgICAgICAgICByZXR1cm4gKHdpblNpemUud2lkdGggLyB3aW5TaXplLmhlaWdodCA8IDEuNSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gKHdpblNpemUuaGVpZ2h0IC8gd2luU2l6ZS53aWR0aCA8IDEuNSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZ2V0Rm9ybWF0Um90YXRpb246IGZ1bmN0aW9uIChyb3RhdGlvbikge1xuICAgICAgICByZXR1cm4gKChyb3RhdGlvbiAlIDM2MCkgKyAzNjApICUgMzYwO1xuICAgIH0sXG5cbiAgICBkb0NsaXBwaW5nOiBmdW5jdGlvbiAobWFza0xheWVyLCBjbGlwTGF5ZXIpIHtcbiAgICAgICAgaWYobWFza0xheWVyICYmIGNsaXBMYXllcil7XG4gICAgICAgICAgICB2YXIgY2xpcFBhcmVudE5vZGUgPSBjbGlwTGF5ZXIuZ2V0UGFyZW50KCk7XG4gICAgICAgICAgICBjbGlwTGF5ZXIucmV0YWluKCk7XG4gICAgICAgICAgICBjbGlwTGF5ZXIucmVtb3ZlRnJvbVBhcmVudChmYWxzZSk7XG5cbiAgICAgICAgICAgIG1hc2tMYXllci5yZW1vdmVGcm9tUGFyZW50KGZhbHNlKTtcbiAgICAgICAgICAgIG1hc2tMYXllci52aXNpYmxlID0gdHJ1ZTtcblxuICAgICAgICAgICAgdmFyIGNsaXBwaW5nTm9kZSA9IG5ldyBjYy5DbGlwcGluZ05vZGUobWFza0xheWVyKTtcbiAgICAgICAgICAgIGNsaXBwaW5nTm9kZS5hbHBoYVRocmVzaG9sZCA9IDE7XG4gICAgICAgICAgICBjbGlwcGluZ05vZGUuYWRkQ2hpbGQoY2xpcExheWVyKTtcbiAgICAgICAgICAgIGNsaXBMYXllci5yZWxlYXNlKCk7XG5cbiAgICAgICAgICAgIGNsaXBQYXJlbnROb2RlLmFkZENoaWxkKGNsaXBwaW5nTm9kZSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgaXNQaXhlbENvbGxpc2lvbjogZnVuY3Rpb24gKHNwcjEsIHNwcjIpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAgcmV0dXJuIGpzYl9kcC5vbmVTZGtCcmlkZ2UuaXNQaXhlbENvbGxpc2lvbihzcHIxLCBzcHIyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBjYy5yZWN0SW50ZXJzZWN0c1JlY3Qoc3ByMS5nZXRCb3VuZGluZ0JveCgpLCBzcHIyLmdldEJvdW5kaW5nQm94KCkpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNjYWxlQ0NMYWJlbEJNRm9udDogZnVuY3Rpb24gKGxhYmVsLCBtYXhXaWR0aCkge1xuICAgICAgICBpZiAobGFiZWwud2lkdGggPiBtYXhXaWR0aCkge1xuICAgICAgICAgICAgdmFyIHNjYWxlRmFjdG9yID0gbWF4V2lkdGggLyBsYWJlbC53aWR0aDtcbiAgICAgICAgICAgIGxhYmVsLnNjYWxlWCA9IGxhYmVsLnNjYWxlWSA9IHNjYWxlRmFjdG9yO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbGFiZWwuc2NhbGVYID0gbGFiZWwuc2NhbGVZID0gMS4wO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNjYWxlQ0NMYWJlbEJNRm9udFdpdGhNYXhTY2FsZTogZnVuY3Rpb24gKGxhYmVsLCBtYXhXaWR0aCwgbWF4U2NhbGUpIHtcbiAgICAgICAgaWYgKGxhYmVsLndpZHRoICogbGFiZWwuc2NhbGVYID4gbWF4V2lkdGgpIHtcbiAgICAgICAgICAgIGxhYmVsLnNjYWxlWCA9IGxhYmVsLnNjYWxlWSA9IG1heFdpZHRoIC8gbGFiZWwud2lkdGg7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxhYmVsLnNjYWxlWCA+IG1heFNjYWxlKSB7XG4gICAgICAgICAgICBsYWJlbC5zY2FsZVggPSBsYWJlbC5zY2FsZVkgPSBtYXhTY2FsZTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzY2FsZVNwcml0ZUZyYW1lOiBmdW5jdGlvbiAoc3ByaXRlLCBmcmFtZU5hbWUpIHtcbiAgICAgICAgdmFyIG9yaWdpbmFsV2lkdGggPSBzcHJpdGUud2lkdGggKiBzcHJpdGUuc2NhbGVYO1xuICAgICAgICBzcHJpdGUuc2V0U3ByaXRlRnJhbWUoZnJhbWVOYW1lKTtcbiAgICAgICAgc3ByaXRlLnNjYWxlID0gb3JpZ2luYWxXaWR0aCAvIHNwcml0ZS53aWR0aDtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2NjLk5vZGV9IG5vZGVcbiAgICAgKi9cbiAgICB3YWxrTm9kZTogZnVuY3Rpb24gKG5vZGUsIGNiKSB7XG4gICAgICAgIGlmKG5vZGUpIHtcbiAgICAgICAgICAgIHZhciBtb3JlID0gY2Iobm9kZSk7XG4gICAgICAgICAgICBpZihtb3JlKSB7XG4gICAgICAgICAgICAgICAgZm9yKHZhciBrIGluIG5vZGUuY2hpbGRyZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgbW9yZSA9IHRoaXMud2Fsa05vZGUobm9kZS5jaGlsZHJlbltrXSwgY2IpO1xuICAgICAgICAgICAgICAgICAgICBpZighbW9yZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBtb3JlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgaXNOb2RlQnV0dG9uOiBmdW5jdGlvbihuZCkge1xuICAgICAgICByZXR1cm4gKG5kIGluc3RhbmNlb2YgY2MuQ29udHJvbEJ1dHRvbik7XG4gICAgfSxcblxuICAgIGlzTm9kZU1lbnVJdGVtOiBmdW5jdGlvbihuZCkge1xuICAgICAgICByZXR1cm4gKG5kIGluc3RhbmNlb2YgY2MuTWVudUl0ZW0gfHwgbmQgaW5zdGFuY2VvZiBjYy5NZW51SXRlbUltYWdlKTtcbiAgICB9LFxuXG4gICAgaXNMYWJlbEJNRm9udDpmdW5jdGlvbiAobmQpIHtcbiAgICAgICAgcmV0dXJuIChuZCBpbnN0YW5jZW9mIGNjLkxhYmVsQk1Gb250IHx8IG5kIGluc3RhbmNlb2YgY2MuTGFiZWwpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBMb2FkIGFuIGltYWdlIHdpdGggdGhlIGdpdmVuIHVybFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmxcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayAtIGZ1bmN0aW9uKGVycm9yLCB0ZXh0dXJlLCBleHRyYSlcbiAgICAgKiBAcGFyYW0geyp9IGV4dHJhXG4gICAgICovXG4gICAgbG9hZFJlbW90ZUltZzogZnVuY3Rpb24gKHVybCwgY2FsbGJhY2ssIGV4dHJhKSB7XG4gICAgICAgIGlmICghY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBjYy5sb2FkZXIubG9hZEltZyh1cmwsIHtpc0Nyb3NzT3JpZ2luOiB0cnVlfSwgZnVuY3Rpb24gKGVycm9yLCBpbWcpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGV4dHVyZTJkID0gbmV3IGNjLlRleHR1cmUyRCgpO1xuICAgICAgICAgICAgICAgIHRleHR1cmUyZC5pbml0V2l0aEVsZW1lbnQoaW1nKTtcbiAgICAgICAgICAgICAgICB0ZXh0dXJlMmQuaGFuZGxlTG9hZGVkVGV4dHVyZSgpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCB0ZXh0dXJlMmQsIGV4dHJhKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2MubG9hZGVyLmxvYWRJbWcodXJsLCB7aXNDcm9zc09yaWdpbjogdHJ1ZX0sIGZ1bmN0aW9uIChlcnJvciwgdGV4dHVyZTJkKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsIHRleHR1cmUyZCwgZXh0cmEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcGxheUNDQkFuaW1hdGlvbjogZnVuY3Rpb24obm9kZSwgYW5tTmFtZSl7XG4gICAgICAgIHZhciBhbmltTWdyID0gbm9kZS5hbmltYXRpb25NYW5hZ2VyO1xuICAgICAgICB2YXIgc2VxSWQ7XG4gICAgICAgIGlmKGFubU5hbWUpIHtcbiAgICAgICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpe1xuICAgICAgICAgICAgICAgIHNlcUlkID0gYW5pbU1nci5nZXRTZXF1ZW5jZUlkKGFubU5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZXtcbiAgICAgICAgICAgICAgICBzZXFJZCA9IGFuaW1NZ3IuX2dldFNlcXVlbmNlSWQoYW5tTmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzZXFJZCA9IGFuaW1NZ3IuZ2V0QXV0b1BsYXlTZXF1ZW5jZUlkKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoc2VxSWQgIT0gLTEpe1xuICAgICAgICAgICAgaWYoIWFubU5hbWUpIHtcbiAgICAgICAgICAgICAgICBhbmltTWdyLnJ1bkFuaW1hdGlvbnNGb3JTZXF1ZW5jZUlkVHdlZW5EdXJhdGlvbihzZXFJZCwgMCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGFuaW1NZ3IucnVuQW5pbWF0aW9uc0ZvclNlcXVlbmNlTmFtZWQoYW5tTmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNjLmxvZyhcImFuaW1hdGlvbiBcIiArIGFubU5hbWUgKyBcIiBub3QgZXhpc3RzIVwiKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByYW5kb21TY2FsZUFuaW06IGZ1bmN0aW9uIChzcHIsIHN0YXJ0U2NhbGUsIHRvdGFsVGltZSkge1xuICAgICAgICB0b3RhbFRpbWUgPSB0aGlzLnJhbmRvbU5leHROdW1iZXJJblJhbmdlKHRvdGFsVGltZSAqIDAuOCwgdG90YWxUaW1lICogMS4yKTtcbiAgICAgICAgdmFyIGRlbGF5VGltZSA9IHRoaXMucmFuZG9tTmV4dE51bWJlcih0b3RhbFRpbWUgLyAyKTtcblxuICAgICAgICB2YXIgc2NhbGVCaWdUaW1lID0gMC4zICogKHRvdGFsVGltZSAtIGRlbGF5VGltZSkgKiAyO1xuICAgICAgICB2YXIgc2NhbGVTbWFsbFRpbWUgPSAwLjEgKiAodG90YWxUaW1lIC0gZGVsYXlUaW1lKSAqIDI7XG4gICAgICAgIHZhciBzY2FsZU5vcm1hbFRpbWUgPSAwLjEgKiAodG90YWxUaW1lIC0gZGVsYXlUaW1lKSAqIDI7XG5cbiAgICAgICAgc3ByLnN0b3BBbGxBY3Rpb25zKCk7XG4gICAgICAgIHNwci5zZXRTY2FsZSgwKTtcbiAgICAgICAgc3ByLnJ1bkFjdGlvbihjYy5zZXF1ZW5jZShjYy5kZWxheVRpbWUoZGVsYXlUaW1lKSxcbiAgICAgICAgICAgIGNjLnNjYWxlVG8oc2NhbGVCaWdUaW1lLCAxLjEgKiBzdGFydFNjYWxlKS5lYXNpbmcoY2MuZWFzZUluT3V0KDIpKSAsXG4gICAgICAgICAgICBjYy5zY2FsZVRvKHNjYWxlU21hbGxUaW1lLCAwLjkgKiBzdGFydFNjYWxlKS5lYXNpbmcoY2MuZWFzZUluT3V0KDIpKSxcbiAgICAgICAgICAgIGNjLnNjYWxlVG8oc2NhbGVOb3JtYWxUaW1lLCAxICogc3RhcnRTY2FsZSkuZWFzaW5nKGNjLmVhc2VJbk91dCgyKSkpKTtcbiAgICB9LFxuXG4gICAgZ2V0Rm9ybWF0VGltZTogZnVuY3Rpb24gKHRpbWUpIHtcbiAgICAgICAgdmFyIGRlY2ltYWxzID0gdGltZSAtIE1hdGguZmxvb3IodGltZSk7XG4gICAgICAgIHRpbWUgPSBNYXRoLmZsb29yKHRpbWUpO1xuICAgICAgICBpZiAodGltZSA8PSA2MCkge1xuICAgICAgICAgICAgcmV0dXJuIFwiXCIgKyAodGltZSArIGRlY2ltYWxzKS50b0ZpeGVkKDIpO1xuICAgICAgICB9IGVsc2UgaWYgKHRpbWUgPD0gMzYwMCkge1xuICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IodGltZSAvIDYwKSArIFwiOlwiICsgKCh0aW1lICUgNjApICsgZGVjaW1hbHMpLnRvRml4ZWQoMik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcih0aW1lIC8gMzYwMCkgKyBcIjpcIiArIE1hdGguZmxvb3IodGltZSAlIDM2MDAgLyA2MCkgKyBcIjpcIiArICgodGltZSAlICgzNjAwICogNjApKSArIGRlY2ltYWxzKS50b0ZpeGVkKDIpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldExvbmdGb3JtYXRUaW1lOiBmdW5jdGlvbiAodGltZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRUd29EaWdpdChNYXRoLmZsb29yKHRpbWUgLyAzNjAwKSkgK1xuICAgICAgICAgICAgXCI6XCIgKyB0aGlzLmdldFR3b0RpZ2l0KE1hdGguZmxvb3IodGltZSAlIDM2MDAgLyA2MCkpICtcbiAgICAgICAgICAgIFwiOlwiICsgIHRoaXMuZ2V0VHdvRGlnaXQoTWF0aC5mbG9vcih0aW1lICUgMzYwMCAlIDYwKSk7XG4gICAgfSxcblxuICAgIGdldExldHRlclRpbWU6IGZ1bmN0aW9uIChtaWxsaXNlY29uZCkge1xuICAgICAgICB2YXIgdGltZVNwYW4gPSB0aW1lc3Bhbi5mcm9tU2Vjb25kcyhtaWxsaXNlY29uZCAvIDEwMDApO1xuICAgICAgICBpZiAoIXRpbWVTcGFuKSB7XG4gICAgICAgICAgICByZXR1cm4gXCIwbSAwc1wiO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aW1lU3Bhbi50b3RhbERheXModHJ1ZSkgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gVXRpbHMuc3ByaW50ZihcIiVkZCAlZGhcIiwgdGltZVNwYW4udG90YWxEYXlzKHRydWUpLCB0aW1lU3Bhbi5ob3Vycyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAodGltZVNwYW4udG90YWxIb3Vycyh0cnVlKSA+IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gVXRpbHMuc3ByaW50ZihcIiVkaCAlZG1cIiwgdGltZVNwYW4udG90YWxIb3Vycyh0cnVlKSwgdGltZVNwYW4ubWludXRlcyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBVdGlscy5zcHJpbnRmKFwiJWRtICVkc1wiLCB0aW1lU3Bhbi50b3RhbE1pbnV0ZXModHJ1ZSksIHRpbWVTcGFuLnNlY29uZHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldFR3b0RpZ2l0OiBmdW5jdGlvbiAobnVtKSB7XG4gICAgICAgIGlmIChudW0gPj0gMCAmJiBudW0gPD0gOSkge1xuICAgICAgICAgICAgcmV0dXJuIFwiMFwiICsgbnVtO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBcIlwiICsgbnVtO1xuICAgIH0sXG5cbiAgICBzZWVrTm9kZUJ5VGFnOiBmdW5jdGlvbiAocm9vdE5vZGUsIHRhZykge1xuICAgICAgICBpZiAobnVsbCA9PT0gcm9vdE5vZGUpe1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYocm9vdE5vZGUuZ2V0VGFnKCkgPT09IHRhZyl7XG4gICAgICAgICAgICByZXR1cm4gcm9vdE5vZGU7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGFycmF5Um9vdENoaWxkcmVuID0gcm9vdE5vZGUuZ2V0Q2hpbGRyZW4oKTtcbiAgICAgICAgaWYoYXJyYXlSb290Q2hpbGRyZW4gJiYgYXJyYXlSb290Q2hpbGRyZW4ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdmFyIGxlbmd0aCA9IGFycmF5Um9vdENoaWxkcmVuLmxlbmd0aDtcbiAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBjaGlsZCA9IGFycmF5Um9vdENoaWxkcmVuW2ldO1xuICAgICAgICAgICAgICAgIGlmIChudWxsICE9PSBjaGlsZCl7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXMgPSB0aGlzLnNlZWtOb2RlQnlUYWcoY2hpbGQsIHRhZyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9PSByZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSxcblxuICAgIGF1dG9SZWxlYXNlOiBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgIFV0aWxzLmV4ZWN1dGVJbk5leHRGcmFtZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBvYmoucmVsZWFzZSgpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgZXhlY3V0ZUluTmV4dEZyYW1lOiBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCAwKTtcbiAgICB9LFxuXG4gICAgaXNJT1M6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5vcyA9PT0gY2Muc3lzLk9TX0lPUykge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICBnZXREYXlCeVRzOiBmdW5jdGlvbih0cykge1xuICAgICAgICByZXR1cm4gTWF0aC5mbG9vcih0cyAvICgxMDAwICogMzYwMCAqIDI0KSk7XG4gICAgfSxcblxuICAgIGdldEN1cnJlbnREYXk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIHJldHVybiBub3cuZ2V0RnVsbFllYXIoKSAqIDM2NSArIG5vdy5nZXRNb250aCgpICogMTIgKyBub3cuZ2V0RGF0ZSgpO1xuICAgIH0sXG5cbiAgICBpc1NlbGZHYW1lOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChjYy5zeXMub3MgPT09IGNjLnN5cy5PU19JT1MpIHtcbiAgICAgICAgICAgIGlmIChjYy5zeXMubGFuZ3VhZ2UgPT09IGNjLnN5cy5MQU5HVUFHRV9DSElORVNFKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvL3ZhciBwbGF0Zm9ybU5hbWUgPSBqc2JfZHAub25lU2RrQnJpZGdlLmdldENoYW5uZWxOYW1lKCk7XG4gICAgICAgICAgICAvL2lmIChwbGF0Zm9ybU5hbWUgPT09IFwidGFwdGFwXCIpIHtcbiAgICAgICAgICAgIC8vICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgLy99XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pc0FuZHJvaWRBbmRTZWxmR2FtZSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgaXNBbmRyb2lkQW5kU2VsZkdhbWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB2YXIgcGxhdGZvcm1OYW1lID0ganNiX2RwLm9uZVNka0JyaWRnZS5nZXRDaGFubmVsTmFtZSgpO1xuICAgICAgICBpZiAocGxhdGZvcm1OYW1lID09PSBcInRhcHRhcFwiKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIGdldERhc2hQb2ludHNOb2RlOiBmdW5jdGlvbiAocGFyZW50LCBwb2ludHMsIGRhc2hBcnJheSwgZGFzaE9mZnNldCwgYWRkRG90RnVuYykge1xuICAgICAgICB2YXIgbGFzdHggPSBwb2ludHNbMF0ueCxcbiAgICAgICAgICAgIGxhc3R5ID0gcG9pbnRzWzBdLnk7XG5cbiAgICAgICAgdmFyIGR4LCBkeTtcblxuICAgICAgICB2YXIgdG90YWxMZW5ndGggPSAwO1xuICAgICAgICB2YXIgbGVuZ3RoID0gMDtcblxuICAgICAgICB2YXIgZGFzaExlbmd0aCA9IGRhc2hBcnJheS5sZW5ndGg7XG4gICAgICAgIHZhciBkYXNoSW5kZXggPSAwO1xuXG4gICAgICAgIHZhciBmcm9tID0gZGFzaE9mZnNldDtcbiAgICAgICAgdmFyIGRyYXdMZW5ndGggPSBkYXNoQXJyYXlbZGFzaEluZGV4XTtcbiAgICAgICAgdmFyIHRvID0gZGFzaE9mZnNldCArIGRyYXdMZW5ndGg7XG5cbiAgICAgICAgdmFyIHgxLCB5MTtcbiAgICAgICAgdmFyIHgsIHk7XG5cbiAgICAgICAgLy92YXIgcGFyZW50ID0gbmV3IGNjLk5vZGUoKTtcblxuICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IHBvaW50cy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgICAgIHggPSBwb2ludHNbaV0ueDtcbiAgICAgICAgICAgIHkgPSBwb2ludHNbaV0ueTtcblxuICAgICAgICAgICAgaWYgKGkgIT09IDApIHtcbiAgICAgICAgICAgICAgICBkeCA9IHggLSBsYXN0eDtcbiAgICAgICAgICAgICAgICBkeSA9IHkgLSBsYXN0eTtcblxuICAgICAgICAgICAgICAgIGxlbmd0aCA9IE1hdGguc3FydChkeCAqIGR4ICsgZHkgKiBkeSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIXgxKSB4MSA9IGxhc3R4O1xuICAgICAgICAgICAgICAgIGlmICgheTEpIHkxID0gbGFzdHk7XG5cbiAgICAgICAgICAgICAgICB3aGlsZSAobGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodG90YWxMZW5ndGggKyBsZW5ndGggPCBmcm9tKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbExlbmd0aCArPSBsZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZW5ndGggPSAwO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB4MSA9IHg7XG4gICAgICAgICAgICAgICAgICAgICAgICB5MSA9IHk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRvdGFsTGVuZ3RoIDw9IGZyb20pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkaWZMZW5ndGggPSBmcm9tIC0gdG90YWxMZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IGRpZkxlbmd0aCAvIGxlbmd0aDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgeDEgPSB4MSArIHAgKiAoeCAtIHgxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHkxID0geTEgKyBwICogKHkgLSB5MSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vY3R4Lm1vdmVUbyh4MSwgeTEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYWRkRG90RnVuYyh4MSwgeTEpXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGxlbmd0aCAtPSBkaWZMZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbExlbmd0aCArPSBkaWZMZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoKHRvdGFsTGVuZ3RoICsgbGVuZ3RoKSA8IHRvKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB4MSA9IHg7XG4gICAgICAgICAgICAgICAgICAgICAgICB5MSA9IHk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vY3R4LmxpbmVUbyh4MSwgeTEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYWRkRG90RnVuYyh4MSwgeTEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbExlbmd0aCArPSBsZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZW5ndGggPSAwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKCh0b3RhbExlbmd0aCArIGxlbmd0aCkgPj0gdG8pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkaWZMZW5ndGggPSB0byAtIHRvdGFsTGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHAgPSBkaWZMZW5ndGggLyBsZW5ndGg7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHgxID0geDEgKyBwICogKHggLSB4MSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB5MSA9IHkxICsgcCAqICh5IC0geTEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2N0eC5saW5lVG8oeDEsIHkxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERvdEZ1bmMoeDEsIHkxKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgbGVuZ3RoIC09IGRpZkxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsTGVuZ3RoICs9IGRpZkxlbmd0aDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSA9IHRvICsgZGFzaEFycmF5WysrZGFzaEluZGV4ICUgZGFzaExlbmd0aF07XG4gICAgICAgICAgICAgICAgICAgICAgICB0byA9IGZyb20gKyBkYXNoQXJyYXlbKytkYXNoSW5kZXggJSBkYXNoTGVuZ3RoXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGFzdHggPSB4O1xuICAgICAgICAgICAgbGFzdHkgPSB5O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwYXJlbnQ7XG4gICAgfSxcblxuICAgIGlzRmlsZUV4aXN0OiBmdW5jdGlvbiAoZmlsZU5hbWUpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAgaWYgKGpzYi5maWxlVXRpbHMuaXNGaWxlRXhpc3QoZmlsZU5hbWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoY2MubG9hZGVyLmdldFJlcyhmaWxlTmFtZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOWIpOaWreWuvemrmOavlOaYr+WQpuWkp+S6jjLvvIzlpoLmnpzlpKfkuo4y77yM5YiZ5L2/55So5YiY5rW35bGP6YCC6YWN5pa55byP5p2l5pi+56S6VUlcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBpc05vdGNoU2NyZWVuOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIHJldHVybiBqc2JfZHAub25lU2RrQnJpZGdlLmlzTm90Y2hTY3JlZW4oKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIGlzQW5kcm9pZE5vdGNoU2NyZWVuOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGlmIChjYy5zeXMub3MgPT09IGNjLnN5cy5PU19BTkRST0lEKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGpzYl9kcC5vbmVTZGtCcmlkZ2UuaXNOb3RjaFNjcmVlbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgaXNJT1NOb3RjaFNjcmVlbjogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBpZiAoY2Muc3lzLm9zID09PSBjYy5zeXMuT1NfSU9TKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGpzYl9kcC5vbmVTZGtCcmlkZ2UuaXNOb3RjaFNjcmVlbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgbG9hZEl0ZXJhdG9yOiBmdW5jdGlvbiAoZnVuY0xpc3QsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgdmFyIGZ1bmMgPSBmdW5jTGlzdC5zaGlmdCgpO1xuICAgICAgICBpZiAoZnVuYykge1xuICAgICAgICAgICAgVXRpbHMuZXhlY3V0ZUluTmV4dEZyYW1lKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBmdW5jKCk7XG4gICAgICAgICAgICAgICAgc2VsZi5sb2FkSXRlcmF0b3IoZnVuY0xpc3QsIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRUb3RhbE1lbW9yeTogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMudG90YWxNZW1vcnkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRvdGFsTWVtb3J5ID0ganNiX2RwLm9uZVNka0JyaWRnZS5nZXRUb3RhbE1lbW9yeSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMudG90YWxNZW1vcnk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfSxcblxuICAgIGlzTG93QW5kcm9pZDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2Muc3lzLm9zID09PSBjYy5zeXMuT1NfQU5EUk9JRCkge1xuICAgICAgICAgICAgY2MubG9nKFwibWVtb3J5OiBcIiwgdGhpcy5nZXRUb3RhbE1lbW9yeSgpKTtcbiAgICAgICAgICAgIHJldHVybiAodGhpcy5nZXRUb3RhbE1lbW9yeSgpIDw9IDE1MzYpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgaXNMb3dJT1M6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5vcyA9PT0gY2Muc3lzLk9TX0lPUykge1xuICAgICAgICAgICAgY2MubG9nKFwibWVtb3J5OiBcIiwgdGhpcy5nZXRUb3RhbE1lbW9yeSgpKTtcbiAgICAgICAgICAgIHJldHVybiAodGhpcy5nZXRUb3RhbE1lbW9yeSgpIDw9IDEwMjQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgc2V0VHJhY2tWYWx1ZTogZnVuY3Rpb24gKG5hbWUsIHZhbHVlKSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2Uuc2V0VHJhY2tWYWx1ZShuYW1lLCB2YWx1ZSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZ2V0UmV2ZXJzZVN0cmluZzogZnVuY3Rpb24gKHN0cikge1xuICAgICAgICByZXR1cm4gc3RyLnNwbGl0KCcnKS5yZXZlcnNlKCkuam9pbignJyk7XG4gICAgfSxcblxuICAgIGdldEN1cnJlbnRGUFM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGdhbWUudXRpbHMuaXNMb3dBbmRyb2lkKCkpIHtcbiAgICAgICAgICAgIHJldHVybiBnYW1lLmNvbmZpZy5sb3dBbmRyb2lkRlBTO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiA2MDtcbiAgICB9LFxuXG4gICAgY3JlYXRlUHJvZ3Jlc3NUaW1lcjogZnVuY3Rpb24oc3ByaXRlLCBob3Jpem9udGFsLCByYWRpYWwpIHtcbiAgICAgICAgdmFyIHBvcyA9IHNwcml0ZS5nZXRQb3NpdGlvbigpO1xuICAgICAgICB2YXIgYW5jaG9yID0gc3ByaXRlLmdldEFuY2hvclBvaW50KCk7XG4gICAgICAgIHZhciBzY2FsZVggPSBzcHJpdGUuZ2V0U2NhbGVYKCk7XG4gICAgICAgIHZhciBzY2FsZVkgPSBzcHJpdGUuZ2V0U2NhbGVZKCk7XG4gICAgICAgIHZhciBwYXJlbnQgPSBzcHJpdGUuZ2V0UGFyZW50KCk7XG4gICAgICAgIHNwcml0ZS5yZXRhaW4oKTtcbiAgICAgICAgc3ByaXRlLnJlbW92ZUZyb21QYXJlbnQoKTtcbiAgICAgICAgdmFyIHJldCA9IG5ldyBjYy5Qcm9ncmVzc1RpbWVyKHNwcml0ZSk7XG4gICAgICAgIHNwcml0ZS5yZWxlYXNlKCk7XG4gICAgICAgIGlmICghcmFkaWFsKSB7XG4gICAgICAgICAgICByZXQuc2V0VHlwZShjYy5Qcm9ncmVzc1RpbWVyLlRZUEVfQkFSKTtcbiAgICAgICAgICAgIGlmKGhvcml6b250YWwpIHtcbiAgICAgICAgICAgICAgICByZXQuc2V0QmFyQ2hhbmdlUmF0ZShjYy5wKDEsIDApKTtcbiAgICAgICAgICAgICAgICByZXQuc2V0TWlkcG9pbnQoY2MucCgwLCAwLjUpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0LnNldEJhckNoYW5nZVJhdGUoY2MucCgwLCAxKSk7XG4gICAgICAgICAgICAgICAgcmV0LnNldE1pZHBvaW50KGNjLnAoMC41LCAwKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXQuc2V0VHlwZShjYy5Qcm9ncmVzc1RpbWVyLlRZUEVfUkFESUFMKTtcbiAgICAgICAgICAgIHJldC5zZXRBbmNob3JQb2ludChjYy5wKDAuNSwgMC41KSk7XG4gICAgICAgIH1cbiAgICAgICAgcGFyZW50LmFkZENoaWxkKHJldCk7XG4gICAgICAgIHJldC5zZXRQb3NpdGlvbihwb3MpO1xuICAgICAgICByZXQuc2V0QW5jaG9yUG9pbnQoYW5jaG9yKTtcbiAgICAgICAgcmV0LnNldFNjYWxlWChzY2FsZVgpO1xuICAgICAgICByZXQuc2V0U2NhbGVZKHNjYWxlWSk7XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgfSxcblxuICAgIHNodWZmbGU6IGZ1bmN0aW9uICh2ZWMpIHtcbiAgICAgICAgaWYgKCF2ZWMgfHwgdmVjLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuICAgICAgICB2ZWMuc29ydChmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgICAgcmV0dXJuIE1hdGgucmFuZG9tKCkgPCAwLjUgPyAtMSA6IDE7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBjbG9uZTogZnVuY3Rpb24oc3JjT2JqKSB7XG4gICAgICAgIHJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHNyY09iaikpO1xuICAgIH0sXG5cbiAgICBjcmVhdGVWaWRlb0FkOiBmdW5jdGlvbiAoc2l6ZSwgcG9zLCBhbmNob3IsIHVybCkge1xuICAgICAgICB2YXIgdmlkZW8gPSBuZXcgY2N1aS5WaWRlb1BsYXllcih1cmwpO1xuICAgICAgICB2aWRlby5zZXRDb250ZW50U2l6ZShzaXplKTtcbiAgICAgICAgdmlkZW8uc2V0QW5jaG9yUG9pbnQoYW5jaG9yKTtcbiAgICAgICAgdmlkZW8uc2V0U2NhbGUoMSk7XG4gICAgICAgIHZpZGVvLnNldFVSTCh1cmwpO1xuICAgICAgICB2aWRlby5zZXRGdWxsU2NyZWVuRW5hYmxlZChmYWxzZSk7XG4gICAgICAgIHZpZGVvLnBsYXkoKTtcbiAgICAgICAgdmlkZW8uc2V0UG9zaXRpb24ocG9zKTtcblxuICAgICAgICB2aWRlby5zZXRFdmVudExpc3RlbmVyKGNjdWkuVmlkZW9QbGF5ZXIuRXZlbnRUeXBlLkNPTVBMRVRFRCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY2MubG9nKFwiY2N1aS5WaWRlb1BsYXllci5FdmVudFR5cGUuQ09NUExFVEVEXCIpO1xuICAgICAgICAgICAgaWYgKGNjLnN5cy5vcyA9PT0gY2Muc3lzLk9TX0FORFJPSUQpIHtcbiAgICAgICAgICAgICAgICB2aWRlby5zZXRVUkwodXJsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZpZGVvLnNlZWtUbygwKTtcbiAgICAgICAgICAgIHZpZGVvLnBsYXkoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB2aWRlbztcbiAgICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFV0aWxzOyIsIi8qKlxuICogQ3JlYXRlZCBieSBYaW5DaGVuZyBvbiA4LzE4LzE2LlxuICovXG5cbnZhciBFYXNpbmdGdW5jdGlvbnMgPSB7XG4gICAgLy8gbm8gZWFzaW5nLCBubyBhY2NlbGVyYXRpb25cbiAgICBsaW5lYXI6IGZ1bmN0aW9uICh0KSB7IHJldHVybiB0OyB9LFxuICAgIC8vIGFjY2VsZXJhdGluZyBmcm9tIHplcm8gdmVsb2NpdHlcbiAgICBlYXNlSW5RdWFkOiBmdW5jdGlvbiAodCkgeyByZXR1cm4gdCp0OyB9LFxuICAgIC8vIGRlY2VsZXJhdGluZyB0byB6ZXJvIHZlbG9jaXR5XG4gICAgZWFzZU91dFF1YWQ6IGZ1bmN0aW9uICh0KSB7IHJldHVybiB0KigyLXQpOyB9LFxuICAgIC8vIGFjY2VsZXJhdGlvbiB1bnRpbCBoYWxmd2F5LCB0aGVuIGRlY2VsZXJhdGlvblxuICAgIGVhc2VJbk91dFF1YWQ6IGZ1bmN0aW9uICh0KSB7IHJldHVybiB0PDAuNSA/IDIqdCp0IDogLTErKDQtMip0KSp0OyB9LFxuICAgIC8vIGFjY2VsZXJhdGluZyBmcm9tIHplcm8gdmVsb2NpdHlcbiAgICBlYXNlSW5DdWJpYzogZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHQqdCp0OyB9LFxuICAgIC8vIGRlY2VsZXJhdGluZyB0byB6ZXJvIHZlbG9jaXR5XG4gICAgZWFzZU91dEN1YmljOiBmdW5jdGlvbiAodCkgeyByZXR1cm4gKC0tdCkqdCp0KzE7IH0sXG4gICAgLy8gYWNjZWxlcmF0aW9uIHVudGlsIGhhbGZ3YXksIHRoZW4gZGVjZWxlcmF0aW9uXG4gICAgZWFzZUluT3V0Q3ViaWM6IGZ1bmN0aW9uICh0KSB7IHJldHVybiB0PDAuNSA/IDQqdCp0KnQgOiAodC0xKSooMip0LTIpKigyKnQtMikrMTsgfSxcbiAgICAvLyBhY2NlbGVyYXRpbmcgZnJvbSB6ZXJvIHZlbG9jaXR5XG4gICAgZWFzZUluUXVhcnQ6IGZ1bmN0aW9uICh0KSB7IHJldHVybiB0KnQqdCp0OyB9LFxuICAgIC8vIGRlY2VsZXJhdGluZyB0byB6ZXJvIHZlbG9jaXR5XG4gICAgZWFzZU91dFF1YXJ0OiBmdW5jdGlvbiAodCkgeyByZXR1cm4gMS0oLS10KSp0KnQqdDsgfSxcbiAgICAvLyBhY2NlbGVyYXRpb24gdW50aWwgaGFsZndheSwgdGhlbiBkZWNlbGVyYXRpb25cbiAgICBlYXNlSW5PdXRRdWFydDogZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHQ8MC41ID8gOCp0KnQqdCp0IDogMS04KigtLXQpKnQqdCp0OyB9LFxuICAgIC8vIGFjY2VsZXJhdGluZyBmcm9tIHplcm8gdmVsb2NpdHlcbiAgICBlYXNlSW5RdWludDogZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHQqdCp0KnQqdDsgfSxcbiAgICAvLyBkZWNlbGVyYXRpbmcgdG8gemVybyB2ZWxvY2l0eVxuICAgIGVhc2VPdXRRdWludDogZnVuY3Rpb24gKHQpIHsgcmV0dXJuIDErKC0tdCkqdCp0KnQqdDsgfSxcbiAgICAvLyBhY2NlbGVyYXRpb24gdW50aWwgaGFsZndheSwgdGhlbiBkZWNlbGVyYXRpb25cbiAgICBlYXNlSW5PdXRRdWludDogZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHQ8MC41ID8gMTYqdCp0KnQqdCp0IDogMSsxNiooLS10KSp0KnQqdCp0OyB9LFxuXG4gICAgZWFzZU91dEVsYXN0aWM6IGZ1bmN0aW9uKHQpeyAgdmFyIHAgPSAwLjQ7IHJldHVybiBNYXRoLnBvdygyLC0xMCp0KSAqIE1hdGguc2luKCh0LXAvNCkqKDIqTWF0aC5QSSkvcCkgKyAxOyB9LFxuXG4gICAgZWxhc3RpYzogZnVuY3Rpb24odCwgeCkgeyByZXR1cm4gTWF0aC5wb3coMiwgMTAgKiAodC0xKSkgKiBNYXRoLmNvcygyMCpNYXRoLlBJKngvMyp0KTsgfSxcblxuICAgIC8vIOW8uei3s1xuICAgIGJvdW5jZTogZnVuY3Rpb24odCkge1xuICAgICAgICBmb3IodmFyIGEgPSAwLCBiID0gMTsgMTsgYSArPSBiLCBiIC89IDIpIHtcbiAgICAgICAgICAgIGlmICh0ID49ICg3IC0gNCAqIGEpIC8gMTEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gLU1hdGgucG93KCgxMSAtIDYgKiBhIC0gMTEgKiB0KSAvIDQsIDIpICsgTWF0aC5wb3coYiwgMik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy/kuInmrKHotJ3loZ7lsJTnrpfms5VcbiAgICBic2VCYXNlOiBmdW5jdGlvbih0LCBwMCwgcDEsIHAyLCBwMyl7XG4gICAgICAgIHZhciB4ID0gcDAueCAqICgxIC0gdCkgKiAoMSAtIHQpICogKDEgLSB0KSArIHAxLnggKiAzICogdCAqICgxIC0gdCkgKiAoMSAtIHQpICsgcDIueCAqIDMgKiB0ICogdCAqICgxIC0gdCkgKyBwMy54ICogdCAqIHQgKiB0O1xuICAgICAgICB2YXIgeSA9IHAwLnkgKiAoMSAtIHQpICogKDEgLSB0KSAqICgxIC0gdCkgKyBwMS55ICogMyAqIHQgKiAoMSAtIHQpICogKDEgLSB0KSArIHAyLnkgKiAzICogdCAqIHQgKiAoMSAtIHQpICsgcDMueSAqIHQgKiB0ICogdDtcbiAgICAgICAgcmV0dXJuIHt4OngseTp5fTtcbiAgICB9LFxuXG4gICAgZG9TaGFraW5nOiBmdW5jdGlvbiAodCkge1xuICAgICAgICByZXR1cm4gLU1hdGguc2luKDIgKiBNYXRoLlBJICogMyAqIHQpICogTWF0aC5wb3coKDEgLSB0KSwgMik7XG4gICAgfVxuXG59O1xuXG52YXIgV2hlZWwgPSBjYy5DbGFzcy5leHRlbmQoe1xuICAgIHRhcmdldDogbnVsbCwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHRhcmdldCBub2RlIHlvdSB3YW50IHRvIHJvdGF0ZVxuICAgIGJDdXJ2ZTogWzAuNDIsIC0wLjA4LCAwLjU4LCAxLjEwXSwgICAgICAgICAgLy8gbWFnaWMgY3VydmVcbiAgICBmcHM6IDAsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZwc1xuICAgIG5Sb3VuZDogMSwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbW92ZSBuUm91bmQgeCAzNjBcblxuICAgIGZyYW1lQ291bnQ6IDAsXG4gICAgZWxhcHNlZFRpbWU6IDAsXG4gICAgdG90YWxSb3RhdGlvblRpbWU6IDAsXG4gICAgc3RhcnRSb3RhdGlvbjogMCwgICAgICAgLy8gdGhlIHN0YXJ0IHJvdGF0aW9uXG4gICAgbW92ZW1lbnQ6IDAsICAgICAgICAgICAgIC8vIHRoZSBtb3ZlbWVudCBkZWdyZWVzXG4gICAgZWFzeUZ1bmN0aW9uOiBudWxsLFxuICAgIGVuZENhbGxiYWNrOiBudWxsLFxuICAgIHRhcmdldFJvdGF0aW9uOiAwLFxuICAgIHdoZWVsSXRlbUFuZ2xlOiAwLFxuICAgIGxhc3RUaW1lOiAwLFxuICAgIGxhc3RSb3RhdGlvbjogMCxcbiAgICBzcGVlZDogMCxcblxuICAgIF9sb3R0ZXJ5UmVzZXRpbmc6IGZhbHNlLFxuICAgIF9pc0hpZ2hSb3RhdGluZzogZmFsc2UsXG4gICAgX3N0YXJ0VXBkYXRlOiBmYWxzZSxcblxuXG4gICAgLypcbiAgICAgKiB0YXJnZXQ6IHRoZSBub2RlIHlvdSB3YW50IHRvIHJvdGF0ZVxuICAgICAqIGZwczogMzBmcHMgYnkgZGVmYXVsdFxuICAgICAqL1xuICAgIGN0b3I6IGZ1bmN0aW9uICh0YXJnZXQsIGZwcykge1xuICAgICAgICB0aGlzLnRhcmdldCA9IHRhcmdldDtcbiAgICAgICAgdGhpcy5mcHMgPSBmcHMgfHwgNjA7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIHJvdGF0ZSB0aGUgdGFyZ2V0IG5vZGUgdG8gdGhlIHNwZWNpZmllZCB2YWx1ZVxuICAgICAqIHRoZSBpbmRleCBzaG91bGQgc3RhcnQgd2l0aCAwXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHJvdGF0aW9uVGltZVxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSB0YXJnZXRSb3RhdGlvblxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSB3aGVlbEl0ZW1BbmdsZVxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IHJvbGxFbmRDYWxsYmFja1xuICAgICAqL1xuICAgIHJvdGF0ZTogZnVuY3Rpb24gKHJvdGF0aW9uVGltZSwgdGFyZ2V0Um90YXRpb24sIHdoZWVsSXRlbUFuZ2xlLCByb2xsRW5kQ2FsbGJhY2spIHtcbiAgICAgICAgLy8gSSBhbSBtb3ZpbmdcbiAgICAgICAgaWYgKHRoaXMuX3N0YXJ0VXBkYXRlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnRhcmdldFJvdGF0aW9uID0gdGFyZ2V0Um90YXRpb247XG4gICAgICAgIHRoaXMuZnJhbWVDb3VudCA9IDA7XG4gICAgICAgIHRoaXMudG90YWxSb3RhdGlvblRpbWUgPSByb3RhdGlvblRpbWU7XG5cbiAgICAgICAgdGhpcy5zdGFydFJvdGF0aW9uID0gdGhpcy50YXJnZXQucm90YXRpb24gJSAzNjA7XG4gICAgICAgIHRoaXMubW92ZW1lbnQgPSB0YXJnZXRSb3RhdGlvbiAtIHRoaXMuc3RhcnRSb3RhdGlvbjtcbiAgICAgICAgdGhpcy53aGVlbEl0ZW1BbmdsZSA9IHdoZWVsSXRlbUFuZ2xlO1xuXG4gICAgICAgIHRoaXMubGFzdFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICB0aGlzLmxhc3RSb3RhdGlvbiA9IDA7XG4gICAgICAgIHRoaXMuX2lzSGlnaFJvdGF0aW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX2xvdHRlcnlSZXNldGluZyA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMuZWFzeUZ1bmN0aW9uID0gdGhpcy5kZWZhdWx0RWFzeUZ1bmN0aW9uO1xuICAgICAgICAvLy8vIHVzZSBiZXppZXJcbiAgICAgICAgLy9pZiAoQXJyYXkuaXNBcnJheShwYXJhbXMuZWFzeUZ1bmN0aW9uKSkge1xuICAgICAgICAvLyAgICB0aGlzLmJDdXJ2ZSA9IHBhcmFtcy5lYXN5RnVuY3Rpb247XG4gICAgICAgIC8vICAgIHRoaXMuZWFzeUZ1bmN0aW9uID0gdGhpcy5kZWZhdWx0RWFzeUZ1bmN0aW9uO1xuICAgICAgICAvL31cbiAgICAgICAgLy8vLyBwcm92aWRlIGEgZnVuY3Rpb25cbiAgICAgICAgLy9lbHNlIGlmICh0eXBlb2YgZWFzeUZ1bmN0aW9uID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIC8vICAgIHRoaXMuZWFzeUZ1bmN0aW9uID0gcGFyYW1zLmVhc3lGdW5jdGlvbjtcbiAgICAgICAgLy99XG4gICAgICAgIC8vLy8gcHJvdmlkZSBhIGZ1bmN0aW9uTmFtZVxuICAgICAgICAvL2Vsc2Uge1xuICAgICAgICAvLyAgICB0aGlzLmVhc3lGdW5jdGlvbiA9IEVhc2luZ0Z1bmN0aW9uc1twYXJhbXMuZWFzeUZ1bmN0aW9uXSB8fCB0aGlzLmRlZmF1bHRFYXN5RnVuY3Rpb247XG4gICAgICAgIC8vfVxuXG4gICAgICAgIHRoaXMuZW5kQ2FsbGJhY2sgPSByb2xsRW5kQ2FsbGJhY2s7XG5cbiAgICAgICAgdGhpcy5zY2hlZHVsZVVwZGF0ZSgpO1xuICAgICAgICB0aGlzLl9zdGFydFVwZGF0ZSA9IHRydWU7XG4gICAgfSxcblxuICAgIHNjaGVkdWxlVXBkYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuZWxhcHNlZFRpbWUgPSAwO1xuICAgICAgICBjYy5kaXJlY3Rvci5nZXRTY2hlZHVsZXIoKS5zY2hlZHVsZVVwZGF0ZUZvclRhcmdldCh0aGlzLCAwLCBmYWxzZSk7XG4gICAgfSxcblxuICAgIHVuc2NoZWR1bGVVcGRhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2MuZGlyZWN0b3IuZ2V0U2NoZWR1bGVyKCkudW5zY2hlZHVsZVVwZGF0ZUZvclRhcmdldCh0aGlzKTtcbiAgICAgICAgdGhpcy5lbGFwc2VkVGltZSA9IDA7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24gKGR0KSB7XG4gICAgICAgIGlmICh0aGlzLl9zdGFydFVwZGF0ZSkge1xuICAgICAgICAgICAgdGhpcy5tb3ZlQnlGcmFtZShkdCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLypyb3RhdGUgdGhlIHJlZWwgZnJhbWUgYnkgZnJhbWUqL1xuICAgIG1vdmVCeUZyYW1lOiBmdW5jdGlvbiAoZHQpIHtcbiAgICAgICAgLy8gY2FsY3VsYXRlIGVsYXBzZWQgdGltZVxuICAgICAgICB0aGlzLmVsYXBzZWRUaW1lICs9IGR0O1xuXG4gICAgICAgIC8vIGNhbGN1bGF0ZSB0aGUgbW92aW5nIHByb2dyZXNzXG4gICAgICAgIHZhciBwcm9ncmVzcyA9IHRoaXMuZWFzeUZ1bmN0aW9uKHRoaXMuZWxhcHNlZFRpbWUgLyB0aGlzLnRvdGFsUm90YXRpb25UaW1lKTtcblxuICAgICAgICAvLyBkbyB0aGUgcm90YXRpb25cbiAgICAgICAgdGhpcy50YXJnZXQucm90YXRpb24gPSBwcm9ncmVzcyAqIHRoaXMubW92ZW1lbnQgKyB0aGlzLnN0YXJ0Um90YXRpb247XG5cbiAgICAgICAgLy92YXIgaGFzU3RvcCA9IGZhbHNlO1xuICAgICAgICAvLyBzdG9wIGhlcmVcbiAgICAgICAgaWYgKHRoaXMudGFyZ2V0Um90YXRpb24gPD0gdGhpcy50YXJnZXQucm90YXRpb24pIHtcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0LnJvdGF0aW9uID0gdGhpcy50YXJnZXRSb3RhdGlvbjtcbiAgICAgICAgICAgIHRoaXMudW5zY2hlZHVsZVVwZGF0ZSgpO1xuICAgICAgICAgICAgdGhpcy5fc3RhcnRVcGRhdGUgPSBmYWxzZTtcblxuICAgICAgICAgICAgLy9nYW1lLmF1ZGlvLnN0b3BFZmZlY3QoXCJzbG90cy9yb3VsZXR0ZS1iZ1wiKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuZW5kQ2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVuZENhbGxiYWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNwZWVkID0gKHRoaXMudGFyZ2V0LnJvdGF0aW9uIC0gdGhpcy5sYXN0Um90YXRpb24pIC8gKERhdGUubm93KCkgLSB0aGlzLmxhc3RUaW1lKSAqIDEwMDA7XG5cbiAgICAgICAgdGhpcy5sYXN0VGltZSA9IERhdGUubm93KCk7XG4gICAgICAgIHRoaXMubGFzdFJvdGF0aW9uID0gdGhpcy50YXJnZXQucm90YXRpb247XG4gICAgfSxcblxuICAgIC8qIFVzZSBiZXppZXIgQ3VyaXZlIGFzIGRlZmF1bHQgKi9cbiAgICBkZWZhdWx0RWFzeUZ1bmN0aW9uOiBmdW5jdGlvbiAodCkge1xuICAgICAgICB2YXIgYmV6ID0gdGhpcy5iQ3VydmU7XG4gICAgICAgIHZhciBjb29yZCA9IEVhc2luZ0Z1bmN0aW9ucy5ic2VCYXNlKHQsIHt4OiAwLCB5OiAwfSwge3g6IGJlelswXSwgeTogYmV6WzFdfSwge3g6IGJlelsyXSwgeTogYmV6WzNdfSwge1xuICAgICAgICAgICAgeDogMSxcbiAgICAgICAgICAgIHk6IDFcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBjb29yZC55O1xuICAgIH0sXG5cbiAgICBnZXRUYXJnZXRSb3RhdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy50YXJnZXRSb3RhdGlvbjtcbiAgICB9LFxuXG4gICAgZ2V0U3BlZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3BlZWQ7XG4gICAgfVxufSk7XG5cblxubW9kdWxlLmV4cG9ydHMgPSBXaGVlbDtcbiIsIi8qKlxuICogQSBicmllZiBleHBsYW5hdGlvbiBmb3IgXCJwcm9qZWN0Lmpzb25cIjpcbiAqIEhlcmUgaXMgdGhlIGNvbnRlbnQgb2YgcHJvamVjdC5qc29uIGZpbGUsIHRoaXMgaXMgdGhlIGdsb2JhbCBjb25maWd1cmF0aW9uIGZvciB5b3VyIGdhbWUsIHlvdSBjYW4gbW9kaWZ5IGl0IHRvIGN1c3RvbWl6ZSBzb21lIGJlaGF2aW9yLlxuICogVGhlIGRldGFpbCBvZiBlYWNoIGZpZWxkIGlzIHVuZGVyIGl0LlxuIHtcbiAgICBcInByb2plY3RfdHlwZVwiOiBcImphdmFzY3JpcHRcIixcbiAgICAvLyBcInByb2plY3RfdHlwZVwiIGluZGljYXRlIHRoZSBwcm9ncmFtIGxhbmd1YWdlIG9mIHlvdXIgcHJvamVjdCwgeW91IGNhbiBpZ25vcmUgdGhpcyBmaWVsZFxuXG4gICAgXCJkZWJ1Z01vZGVcIiAgICAgOiAxLFxuICAgIC8vIFwiZGVidWdNb2RlXCIgcG9zc2libGUgdmFsdWVzIDpcbiAgICAvLyAgICAgIDAgLSBObyBtZXNzYWdlIHdpbGwgYmUgcHJpbnRlZC5cbiAgICAvLyAgICAgIDEgLSBjYy5lcnJvciwgY2MuYXNzZXJ0LCBjYy53YXJuLCBjYy5sb2cgd2lsbCBwcmludCBpbiBjb25zb2xlLlxuICAgIC8vICAgICAgMiAtIGNjLmVycm9yLCBjYy5hc3NlcnQsIGNjLndhcm4gd2lsbCBwcmludCBpbiBjb25zb2xlLlxuICAgIC8vICAgICAgMyAtIGNjLmVycm9yLCBjYy5hc3NlcnQgd2lsbCBwcmludCBpbiBjb25zb2xlLlxuICAgIC8vICAgICAgNCAtIGNjLmVycm9yLCBjYy5hc3NlcnQsIGNjLndhcm4sIGNjLmxvZyB3aWxsIHByaW50IG9uIGNhbnZhcywgYXZhaWxhYmxlIG9ubHkgb24gd2ViLlxuICAgIC8vICAgICAgNSAtIGNjLmVycm9yLCBjYy5hc3NlcnQsIGNjLndhcm4gd2lsbCBwcmludCBvbiBjYW52YXMsIGF2YWlsYWJsZSBvbmx5IG9uIHdlYi5cbiAgICAvLyAgICAgIDYgLSBjYy5lcnJvciwgY2MuYXNzZXJ0IHdpbGwgcHJpbnQgb24gY2FudmFzLCBhdmFpbGFibGUgb25seSBvbiB3ZWIuXG5cbiAgICBcInNob3dGUFNcIiAgICAgICA6IHRydWUsXG4gICAgLy8gTGVmdCBib3R0b20gY29ybmVyIGZwcyBpbmZvcm1hdGlvbiB3aWxsIHNob3cgd2hlbiBcInNob3dGUFNcIiBlcXVhbHMgdHJ1ZSwgb3RoZXJ3aXNlIGl0IHdpbGwgYmUgaGlkZS5cblxuICAgIFwiZnJhbWVSYXRlXCIgICAgIDogNjAsXG4gICAgLy8gXCJmcmFtZVJhdGVcIiBzZXQgdGhlIHdhbnRlZCBmcmFtZSByYXRlIGZvciB5b3VyIGdhbWUsIGJ1dCB0aGUgcmVhbCBmcHMgZGVwZW5kcyBvbiB5b3VyIGdhbWUgaW1wbGVtZW50YXRpb24gYW5kIHRoZSBydW5uaW5nIGVudmlyb25tZW50LlxuXG4gICAgXCJpZFwiICAgICAgICAgICAgOiBcImdhbWVDYW52YXNcIixcbiAgICAvLyBcImdhbWVDYW52YXNcIiBzZXRzIHRoZSBpZCBvZiB5b3VyIGNhbnZhcyBlbGVtZW50IG9uIHRoZSB3ZWIgcGFnZSwgaXQncyB1c2VmdWwgb25seSBvbiB3ZWIuXG5cbiAgICBcInJlbmRlck1vZGVcIiAgICA6IDAsXG4gICAgLy8gXCJyZW5kZXJNb2RlXCIgc2V0cyB0aGUgcmVuZGVyZXIgdHlwZSwgb25seSB1c2VmdWwgb24gd2ViIDpcbiAgICAvLyAgICAgIDAgLSBBdXRvbWF0aWNhbGx5IGNob3NlbiBieSBlbmdpbmVcbiAgICAvLyAgICAgIDEgLSBGb3JjZWQgdG8gdXNlIGNhbnZhcyByZW5kZXJlclxuICAgIC8vICAgICAgMiAtIEZvcmNlZCB0byB1c2UgV2ViR0wgcmVuZGVyZXIsIGJ1dCB0aGlzIHdpbGwgYmUgaWdub3JlZCBvbiBtb2JpbGUgYnJvd3NlcnNcblxuICAgIFwiZW5naW5lRGlyXCIgICAgIDogXCJmcmFtZXdvcmtzL2NvY29zMmQtaHRtbDUvXCIsXG4gICAgLy8gSW4gZGVidWcgbW9kZSwgaWYgeW91IHVzZSB0aGUgd2hvbGUgZW5naW5lIHRvIGRldmVsb3AgeW91ciBnYW1lLCB5b3Ugc2hvdWxkIHNwZWNpZnkgaXRzIHJlbGF0aXZlIHBhdGggd2l0aCBcImVuZ2luZURpclwiLFxuICAgIC8vIGJ1dCBpZiB5b3UgYXJlIHVzaW5nIGEgc2luZ2xlIGVuZ2luZSBmaWxlLCB5b3UgY2FuIGlnbm9yZSBpdC5cblxuICAgIFwibW9kdWxlc1wiICAgICAgIDogW1wiY29jb3MyZFwiXSxcbiAgICAvLyBcIm1vZHVsZXNcIiBkZWZpbmVzIHdoaWNoIG1vZHVsZXMgeW91IHdpbGwgbmVlZCBpbiB5b3VyIGdhbWUsIGl0J3MgdXNlZnVsIG9ubHkgb24gd2ViLFxuICAgIC8vIHVzaW5nIHRoaXMgY2FuIGdyZWF0bHkgcmVkdWNlIHlvdXIgZ2FtZSdzIHJlc291cmNlIHNpemUsIGFuZCB0aGUgY29jb3MgY29uc29sZSB0b29sIGNhbiBwYWNrYWdlIHlvdXIgZ2FtZSB3aXRoIG9ubHkgdGhlIG1vZHVsZXMgeW91IHNldC5cbiAgICAvLyBGb3IgZGV0YWlscyBhYm91dCBtb2R1bGVzIGRlZmluaXRpb25zLCB5b3UgY2FuIHJlZmVyIHRvIFwiLi4vLi4vZnJhbWV3b3Jrcy9jb2NvczJkLWh0bWw1L21vZHVsZXNDb25maWcuanNvblwiLlxuXG4gICAgXCJqc0xpc3RcIiAgICAgICAgOiBbXG4gICAgXVxuICAgIC8vIFwianNMaXN0XCIgc2V0cyB0aGUgbGlzdCBvZiBqcyBmaWxlcyBpbiB5b3VyIGdhbWUuXG4gfVxuICpcbiAqL1xuXG5jYy5nYW1lLm9uU3RhcnQgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAoIWNjLnN5cy5pc05hdGl2ZSAmJiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvY29zTG9hZGluZ1wiKSlcbiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvY29zTG9hZGluZ1wiKSk7XG5cbiAgICBjYy52aWV3LmVuYWJsZVJldGluYShmYWxzZSk7XG4gICAgY2Mudmlldy5hZGp1c3RWaWV3UG9ydCh0cnVlKTtcblxuICAgIHZhciBMb2dpY01hbiA9IHJlcXVpcmUoXCIuL2NvbW1vbi9tb2RlbC9Mb2dpY01hblwiKTtcbiAgICBMb2dpY01hbi5nZXRJbnN0YW5jZSgpLmluaXQoKTtcblxuICAgIHZhciBVdGlscyA9IHJlcXVpcmUoXCIuL2NvbW1vbi91dGlsL1V0aWxzXCIpO1xuICAgIGNjLnZpZXcucmVzaXplV2l0aEJyb3dzZXJTaXplKHRydWUpO1xuICAgIGNjLnZpZXcuc2V0RGVzaWduUmVzb2x1dGlvblNpemUoMTAwMCwgMTMwMCwgY2MuUmVzb2x1dGlvblBvbGljeS5TSE9XX0FMTCk7XG4gICAgLy9pZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgLy8gICAgdmFyIHdpZHRoID0gMDtcbiAgICAvLyAgICB2YXIgaGVpZ2h0ID0gMDtcbiAgICAvLyAgICBpZiAoISFHYW1lQnJpZGdlLmdldENvbmZpZygpLmhvcml6b250YWxHYW1lKSB7XG4gICAgLy8gICAgICAgIGhlaWdodCA9IDY0MDtcbiAgICAvLyAgICAgICAgaWYgKFV0aWxzLmlzUGFkKCkpIHtcbiAgICAvLyAgICAgICAgICAgIGhlaWdodCA9IDc2ODtcbiAgICAvLyAgICAgICAgfVxuICAgIC8vICAgICAgICB3aWR0aCA9IGhlaWdodCAqIGNjLndpblNpemUud2lkdGggLyBjYy53aW5TaXplLmhlaWdodDtcbiAgICAvLyAgICAgICAgY2MubG9nKFwiY2Mud2luU2l6ZS53aWR0aDpcIiArIGNjLndpblNpemUud2lkdGgpO1xuICAgIC8vICAgICAgICBjYy5sb2coXCJjYy53aW5TaXplLmhlaWdodDpcIiArIGNjLndpblNpemUuaGVpZ2h0KTtcbiAgICAvL1xuICAgIC8vICAgIH0gZWxzZSB7XG4gICAgLy8gICAgICAgIGhlaWdodCA9IDExMzY7XG4gICAgLy8gICAgICAgIGlmIChVdGlscy5pc1BhZCgpKSB7XG4gICAgLy8gICAgICAgICAgICBoZWlnaHQgPSAxMDI0O1xuICAgIC8vICAgICAgICB9XG4gICAgLy8gICAgICAgIHdpZHRoID0gaGVpZ2h0ICogY2Mud2luU2l6ZS53aWR0aCAvIGNjLndpblNpemUuaGVpZ2h0O1xuICAgIC8vICAgIH1cbiAgICAvLyAgICBjYy5sb2coXCJ3aWR0aDpcIiArIHdpZHRoKTtcbiAgICAvLyAgICBjYy5sb2coXCJoZWlnaHQ6XCIgKyBoZWlnaHQpO1xuICAgIC8vICAgIGNjLnZpZXcuc2V0RGVzaWduUmVzb2x1dGlvblNpemUod2lkdGgsIGhlaWdodCwgY2MuUmVzb2x1dGlvblBvbGljeS5TSE9XX0FMTCk7XG4gICAgLy99IGVsc2Uge1xuICAgIC8vICAgIGlmICghIUdhbWVCcmlkZ2UuZ2V0Q29uZmlnKCkuaG9yaXpvbnRhbEdhbWUpIHtcbiAgICAvLyAgICAgICAgY2Mudmlldy5zZXREZXNpZ25SZXNvbHV0aW9uU2l6ZSg5NjAsIDY0MCwgY2MuUmVzb2x1dGlvblBvbGljeS5TSE9XX0FMTCk7XG4gICAgLy8gICAgfSBlbHNlIHtcbiAgICAvLyAgICAgICAgY2Mudmlldy5zZXREZXNpZ25SZXNvbHV0aW9uU2l6ZSg2NDAsIDk2MCwgY2MuUmVzb2x1dGlvblBvbGljeS5TSE9XX0FMTCk7XG4gICAgLy8gICAgfVxuICAgIC8vfVxuXG4gICAgLy8gVGhlIGdhbWUgd2lsbCBiZSByZXNpemVkIHdoZW4gYnJvd3NlciBzaXplIGNoYW5nZVxuICAgIGNjLkJ1aWxkZXJSZWFkZXIuc2V0UmVzb3VyY2VQYXRoKFwicmVzL1wiKTtcbiAgICBjYy52aWV3LnJlc2l6ZVdpdGhCcm93c2VyU2l6ZSh0cnVlKTtcblxuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5jcmVhdGVPdmVybGF5KCk7XG4gICAgd2luZG93LmlzRWRpdG9yID0gdHJ1ZTtcblxuICAgIHZhciBBZHNSZW1pbmRlckNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi9tYW55X2JyaWNrcy9jb250cm9sbGVyL0Fkc1JlbWluZGVyQ29udHJvbGxlclwiKTtcbiAgICB2YXIgRGlhbW9uZHNDb250cm9sbGVyID0gcmVxdWlyZShcIi4vbWFueV9icmlja3MvY29udHJvbGxlci9EaWFtb25kc0NvbnRyb2xsZXJcIik7XG4gICAgY2MuQnVpbGRlclJlYWRlci5yZWdpc3RlckNvbnRyb2xsZXIoXCJBZHNSZW1pbmRlckNvbnRyb2xsZXJcIiwgbmV3IEFkc1JlbWluZGVyQ29udHJvbGxlcigpKTtcbiAgICBjYy5CdWlsZGVyUmVhZGVyLnJlZ2lzdGVyQ29udHJvbGxlcihcIkRpYW1vbmRzQ29udHJvbGxlclwiLCBuZXcgRGlhbW9uZHNDb250cm9sbGVyKCkpO1xuXG4gICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICBnYW1lLmxvY2FsLnJlbG9hZCgpO1xuICAgICAgICBjYy5kaXJlY3Rvci5ydW5TY2VuZShuZXcgR2FtZUJyaWRnZS5nZXRNZW51U2NlbmUoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY2MubG9hZGVyLmxvYWRKc29uKFwicmVzL3Jlc291cmNlX2xpc3QvcmVzb3VyY2VfbGlzdC5qc29uXCIsIGZ1bmN0aW9uIChlcnJvciwgcmVzdWx0KSB7XG4gICAgICAgICAgICBpZiAoIWVycm9yKSB7XG4gICAgICAgICAgICAgICAgY2MuTG9hZGVyU2NlbmUucHJlbG9hZChyZXN1bHQsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgZ2FtZS5sb2NhbC5yZWxvYWQoKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIEVkaXRvclNjZW5lID0gcmVxdWlyZShcIi4vbWFueV9icmlja3MvZWRpdG9yL3NjZW5lL0VkaXRvclNjZW5lXCIpO1xuICAgICAgICAgICAgICAgICAgICBjYy5kaXJlY3Rvci5ydW5TY2VuZShuZXcgRWRpdG9yU2NlbmUoKSk7XG4gICAgICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn07XG5jYy5nYW1lLnJ1bigpO1xuIiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMjAxNy8xMi8xNS5cbiAqL1xuXG52YXIgQWN0aXZpdHlUYXNrQ29uZmlnID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuaWQgPSAwO1xuICAgIHRoaXMudHlwZSA9IFwiXCI7XG4gICAgdGhpcy5zY29yZSA9IDA7XG4gICAgdGhpcy5saW1pdCA9IDA7XG4gICAgdGhpcy5uYW1lID0gXCJcIjtcbn07XG5cbkFjdGl2aXR5VGFza0NvbmZpZy5wcm90b3R5cGUudW5tYXJzaGFsID0gZnVuY3Rpb24gKGpzb25PYmopIHtcbiAgICB0aGlzLmlkID0ganNvbk9ialtcImlkXCJdO1xuICAgIHRoaXMudHlwZSA9IGpzb25PYmpbXCJ0eXBlXCJdO1xuICAgIHRoaXMuc2NvcmUgPSBqc29uT2JqW1wic2NvcmVcIl07XG4gICAgdGhpcy5saW1pdCA9IGpzb25PYmpbXCJsaW1pdFwiXTtcbiAgICB0aGlzLm5hbWUgPSBqc29uT2JqW1wibmFtZVwiXTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQWN0aXZpdHlUYXNrQ29uZmlnO1xuXG4iLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAyMDE3LzEyLzE1LlxuICovXG5cbnZhciBBY3Rpdml0eVRhc2tSZXdhcmRDb25maWcgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5pZCA9IDA7XG4gICAgdGhpcy50eXBlID0gXCJcIjtcbiAgICB0aGlzLnNjb3JlID0gMDtcbiAgICB0aGlzLmNvdW50ID0gMDtcbiAgICB0aGlzLmltYWdlID0gXCJcIjtcbiAgICB0aGlzLnNjYWxlID0gMTtcbn07XG5cbkFjdGl2aXR5VGFza1Jld2FyZENvbmZpZy5wcm90b3R5cGUudW5tYXJzaGFsID0gZnVuY3Rpb24gKGpzb25PYmopIHtcbiAgICB0aGlzLmlkID0ganNvbk9ialtcImlkXCJdO1xuICAgIHRoaXMudHlwZSA9IGpzb25PYmpbXCJ0eXBlXCJdO1xuICAgIHRoaXMuc2NvcmUgPSBqc29uT2JqW1wic2NvcmVcIl07XG4gICAgdGhpcy5jb3VudCA9IGpzb25PYmpbXCJjb3VudFwiXTtcbiAgICB0aGlzLmltYWdlID0ganNvbk9ialtcImltYWdlXCJdO1xuICAgIHRoaXMuc2NhbGUgPSBqc29uT2JqW1wic2NhbGVcIl0gfHwgMTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQWN0aXZpdHlUYXNrUmV3YXJkQ29uZmlnO1xuXG4iLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAyMDE3LzEyLzE1LlxuICovXG5cbnZhciBCb2FyZENvbmZpZyA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmlkID0gMDtcbiAgICB0aGlzLmNvdW50ID0gXCJcIjtcbiAgICB0aGlzLmltYWdlID0gMDtcbiAgICB0aGlzLnNjYWxlID0gMTtcbiAgICB0aGlzLnR5cGUgPSAwO1xufTtcblxuQm9hcmRDb25maWcucHJvdG90eXBlLnVubWFyc2hhbCA9IGZ1bmN0aW9uIChqc29uT2JqKSB7XG4gICAgdGhpcy5pZCA9IGpzb25PYmpbXCJpZFwiXTtcbiAgICB0aGlzLmNvdW50ID0ganNvbk9ialtcImNvdW50XCJdO1xuICAgIHRoaXMuaW1hZ2UgPSBqc29uT2JqW1wiaW1hZ2VcIl07XG4gICAgdGhpcy5zY2FsZSA9IGpzb25PYmpbXCJzY2FsZVwiXSB8fCAxO1xuICAgIHRoaXMudHlwZSA9IGpzb25PYmpbXCJ0eXBlXCJdIHx8IDI7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJvYXJkQ29uZmlnO1xuXG4iLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAyMDE3LzEyLzE1LlxuICovXG5cbnZhciBCb3hDb25maWcgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5pZCA9IDA7XG4gICAgdGhpcy5jb3VudCA9IFwiXCI7XG4gICAgdGhpcy5pbWFnZSA9IDA7XG4gICAgdGhpcy50eXBlID0gMDtcbiAgICB0aGlzLmV4dHJhID0gMDtcbiAgICB0aGlzLnNjYWxlID0gMDtcbn07XG5cbkJveENvbmZpZy5wcm90b3R5cGUudW5tYXJzaGFsID0gZnVuY3Rpb24gKGpzb25PYmopIHtcbiAgICB0aGlzLmlkID0ganNvbk9ialtcImlkXCJdO1xuICAgIHRoaXMuY291bnQgPSBqc29uT2JqW1wiY291bnRcIl07XG4gICAgdGhpcy5pbWFnZSA9IGpzb25PYmpbXCJpbWFnZVwiXTtcbiAgICB0aGlzLnR5cGUgPSBqc29uT2JqW1widHlwZVwiXTtcbiAgICB0aGlzLmV4dHJhID0ganNvbk9ialtcImV4dHJhXCJdO1xuICAgIHRoaXMuc2NhbGUgPSBqc29uT2JqW1wic2NhbGVcIl07XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJveENvbmZpZztcblxuIiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMjAxNy8xMi8xNS5cbiAqL1xudmFyIEJveENvbmZpZyA9IHJlcXVpcmUoXCIuL0JveENvbmZpZ1wiKTtcblxudmFyIEJveFJld2FyZENvbmZpZyA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmJveFJld2FyZDEgPSBbXTtcbiAgICB0aGlzLmJveFJld2FyZDIgPSBbXTtcbiAgICB0aGlzLmJveFJld2FyZDMgPSBbXTtcbn07XG5cbkJveFJld2FyZENvbmZpZy5wcm90b3R5cGUudW5tYXJzaGFsID0gZnVuY3Rpb24gKGpzb25PYmopIHtcbiAgICB2YXIgaSwgYm94O1xuICAgIHZhciBib3hSZXdhcmQxID0ganNvbk9ialtcImJveFJld2FyZDFcIl07XG4gICAgZm9yIChpID0gMDsgaSA8IGJveFJld2FyZDEubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgYm94ID0gbmV3IEJveENvbmZpZygpO1xuICAgICAgICBib3gudW5tYXJzaGFsKGJveFJld2FyZDFbaV0pO1xuICAgICAgICB0aGlzLmJveFJld2FyZDEucHVzaChib3gpO1xuICAgIH1cbiAgICB2YXIgYm94UmV3YXJkMiA9IGpzb25PYmpbXCJib3hSZXdhcmQyXCJdO1xuICAgIGZvciAoaSA9IDA7IGkgPCBib3hSZXdhcmQyLmxlbmd0aDsgKytpKSB7XG4gICAgICAgIGJveCA9IG5ldyBCb3hDb25maWcoKTtcbiAgICAgICAgYm94LnVubWFyc2hhbChib3hSZXdhcmQyW2ldKTtcbiAgICAgICAgdGhpcy5ib3hSZXdhcmQyLnB1c2goYm94KTtcbiAgICB9XG4gICAgdmFyIGJveFJld2FyZDMgPSBqc29uT2JqW1wiYm94UmV3YXJkM1wiXTtcbiAgICBmb3IgKGkgPSAwOyBpIDwgYm94UmV3YXJkMy5sZW5ndGg7ICsraSkge1xuICAgICAgICBib3ggPSBuZXcgQm94Q29uZmlnKCk7XG4gICAgICAgIGJveC51bm1hcnNoYWwoYm94UmV3YXJkM1tpXSk7XG4gICAgICAgIHRoaXMuYm94UmV3YXJkMy5wdXNoKGJveCk7XG4gICAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBCb3hSZXdhcmRDb25maWc7XG5cbiIsIlxudmFyIEJyaWNrQ29uZmlnID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMud2lkdGggPSAwO1xuICAgIHRoaXMuaGVpZ2h0ID0gMDtcbiAgICB0aGlzLnggPSAwO1xuICAgIHRoaXMueSA9IDA7XG4gICAgdGhpcy50eXBlID0gMDtcbn07XG5cbkJyaWNrQ29uZmlnLnByb3RvdHlwZS51bm1hcnNoYWwgPSBmdW5jdGlvbiAoanNvbk9iaikge1xuICAgIHRoaXMueCA9IGpzb25PYmpbMF07XG4gICAgdGhpcy55ID0ganNvbk9ialsxXTtcbiAgICB0aGlzLndpZHRoID0ganNvbk9ialsyXTtcbiAgICB0aGlzLmhlaWdodCA9IGpzb25PYmpbM107XG4gICAgdGhpcy50eXBlID0ganNvbk9ials0XTtcbn07XG5cbkJyaWNrQ29uZmlnLnByb3RvdHlwZS5nZXRIYXJkQ2ZnID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBoYXJkQ2ZnID0gbmV3IEJyaWNrQ29uZmlnKCk7XG4gICAgaGFyZENmZy54ID0gdGhpcy54ICogMjtcbiAgICBoYXJkQ2ZnLnkgPSB0aGlzLnkgKiAyO1xuICAgIGhhcmRDZmcud2lkdGggPSB0aGlzLndpZHRoICogMjtcbiAgICBoYXJkQ2ZnLmhlaWdodCA9IHRoaXMuaGVpZ2h0ICogMjtcbiAgICBoYXJkQ2ZnLnR5cGUgPSB0aGlzLnR5cGU7XG4gICAgcmV0dXJuIGhhcmRDZmc7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJyaWNrQ29uZmlnOyIsIlxudmFyIENhcmRDb25maWcgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5pZCA9IDA7XG4gICAgdGhpcy5jb3VudCA9IDA7XG4gICAgdGhpcy5pbWFnZSA9IFwiXCI7XG59O1xuXG5DYXJkQ29uZmlnLnByb3RvdHlwZS51bm1hcnNoYWwgPSBmdW5jdGlvbiAoanNvbk9iaikge1xuICAgIHRoaXMuaWQgPSBqc29uT2JqW1wiaWRcIl07XG4gICAgdGhpcy5jb3VudCA9IGpzb25PYmpbXCJjb3VudFwiXTtcbiAgICB0aGlzLmltYWdlID0ganNvbk9ialtcImltYWdlXCJdO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBDYXJkQ29uZmlnOyIsInZhciBDaGFsbGVuZ2VSZXdhcmRDb25maWcgPSByZXF1aXJlKFwiLi9DaGFsbGVuZ2VSZXdhcmRDb25maWdcIik7XG52YXIgQ2hhbGxlbmdlSW5mb0NvbmZpZyA9IHJlcXVpcmUoXCIuL0NoYWxsZW5nZUluZm9Db25maWdcIik7XG5cbnZhciBDaGFsbGVuZ2VDb25maWcgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5sZXZlbExpbWl0ID0gMDtcbiAgICAvKipcbiAgICAgKiBAdHlwZSB7QXJyYXkuPENoYWxsZW5nZUluZm9Db25maWc+fVxuICAgICAqL1xuICAgIHRoaXMuY2hhbGxlbmdlcyA9IFtdO1xuICAgIHRoaXMuY2hhbGxlbmdlTWFwID0ge307XG59O1xuXG5DaGFsbGVuZ2VDb25maWcucHJvdG90eXBlLnVubWFyc2hhbCA9IGZ1bmN0aW9uIChqc29uT2JqKSB7XG4gICAgdGhpcy5sZXZlbExpbWl0ID0ganNvbk9ialtcImxldmVsTGltaXRcIl07XG4gICAgdmFyIGNoYWxsZW5nZXMgPSBqc29uT2JqW1wiY2hhbGxlbmdlc1wiXTtcbiAgICB0aGlzLmNoYWxsZW5nZXMgPSBbXTtcbiAgICB2YXIgajtcbiAgICBmb3IgKGogPSAwOyBqIDwgY2hhbGxlbmdlcy5sZW5ndGg7ICsraikge1xuICAgICAgICB2YXIgY2hhbGxlbmdlSW5mb0NmZyA9IG5ldyBDaGFsbGVuZ2VJbmZvQ29uZmlnKCk7XG4gICAgICAgIGNoYWxsZW5nZUluZm9DZmcudW5tYXJzaGFsKGNoYWxsZW5nZXNbal0pO1xuICAgICAgICB0aGlzLmNoYWxsZW5nZXMucHVzaChjaGFsbGVuZ2VJbmZvQ2ZnKTtcbiAgICB9XG4gICAgZm9yIChqID0gMDsgaiA8IHRoaXMuY2hhbGxlbmdlcy5sZW5ndGg7ICsraikge1xuICAgICAgICB2YXIgY2hhbGxlbmdlID0gdGhpcy5jaGFsbGVuZ2VzW2pdO1xuICAgICAgICB2YXIgaWQgPSBjaGFsbGVuZ2UuaWQ7XG4gICAgICAgIHRoaXMuY2hhbGxlbmdlTWFwW2lkXSA9IFtdO1xuICAgICAgICB2YXIgY2hhbGxlbmdlTGlzdCA9IGpzb25PYmpbXCJjaGFsbGVuZ2VcIiArIGlkXTtcbiAgICAgICAgdmFyIGksIGNoYWxsZW5nZUNvbmZpZztcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGNoYWxsZW5nZUxpc3QubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGNoYWxsZW5nZUNvbmZpZyA9IG5ldyBDaGFsbGVuZ2VSZXdhcmRDb25maWcoKTtcbiAgICAgICAgICAgIGNoYWxsZW5nZUNvbmZpZy51bm1hcnNoYWwoY2hhbGxlbmdlTGlzdFtpXSk7XG4gICAgICAgICAgICB0aGlzLmNoYWxsZW5nZU1hcFtpZF0ucHVzaChjaGFsbGVuZ2VDb25maWcpO1xuICAgICAgICB9XG4gICAgfVxufTtcblxuQ2hhbGxlbmdlQ29uZmlnLnByb3RvdHlwZS5nZXRDaGFsbGVuZ2VJbmZvQ2ZnID0gZnVuY3Rpb24gKGNoYWxsZW5nZUlkKSB7XG4gICAgcmV0dXJuIHRoaXMuY2hhbGxlbmdlc1tjaGFsbGVuZ2VJZCAtIDFdO1xufTtcblxuQ2hhbGxlbmdlQ29uZmlnLnByb3RvdHlwZS5nZXRDaGFsbGVuZ2VMaXN0ID0gZnVuY3Rpb24gKGNoYWxsZW5nZUlkKSB7XG4gICAgcmV0dXJuIHRoaXMuY2hhbGxlbmdlTWFwW2NoYWxsZW5nZUlkXTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQ2hhbGxlbmdlQ29uZmlnOyIsIlxudmFyIENoYWxsZW5nZUluZm9Db25maWcgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5pZCA9IDA7XG4gICAgdGhpcy5pbWFnZSA9IFwiXCI7XG4gICAgdGhpcy5ncmF5SW1hZ2UgPSBcIlwiO1xuICAgIHRoaXMubmFtZUtleSA9IFwiXCI7XG4gICAgdGhpcy5sZXZlbExpbWl0ID0gMDtcbn07XG5cbkNoYWxsZW5nZUluZm9Db25maWcucHJvdG90eXBlLnVubWFyc2hhbCA9IGZ1bmN0aW9uIChqc29uT2JqKSB7XG4gICAgdGhpcy5pZCA9IGpzb25PYmpbXCJpZFwiXTtcbiAgICB0aGlzLmltYWdlID0ganNvbk9ialtcImltYWdlXCJdIHx8IFwiXCI7XG4gICAgdGhpcy5ncmF5SW1hZ2UgPSBqc29uT2JqW1wiZ3JheUltYWdlXCJdIHx8IFwiXCI7XG4gICAgdGhpcy5uYW1lS2V5ID0ganNvbk9ialtcIm5hbWVLZXlcIl0gfHwgXCJcIjtcbiAgICB0aGlzLmxldmVsTGltaXQgPSBqc29uT2JqW1wibGV2ZWxMaW1pdFwiXSB8fCAwO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBDaGFsbGVuZ2VJbmZvQ29uZmlnOyIsInZhciBSZXdhcmRDb25maWcgPSByZXF1aXJlKFwiLi9SZXdhcmRDb25maWdcIik7XG5cbnZhciBDaGFsbGVuZ2VSZXdhcmRDb25maWcgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5pZCA9IDA7XG4gICAgdGhpcy5sZXZlbCA9IDA7XG4gICAgdGhpcy5yZXdhcmRzID0gW107XG59O1xuXG5DaGFsbGVuZ2VSZXdhcmRDb25maWcucHJvdG90eXBlLnVubWFyc2hhbCA9IGZ1bmN0aW9uIChqc29uT2JqKSB7XG4gICAgdGhpcy5pZCA9IGpzb25PYmpbXCJpZFwiXTtcbiAgICB0aGlzLmxldmVsID0ganNvbk9ialtcImxldmVsXCJdO1xuICAgIHZhciByZXdhcmRzID0ganNvbk9ialtcInJld2FyZHNcIl07XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZXdhcmRzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgIHZhciByZXdhcmRDZmcgPSBuZXcgUmV3YXJkQ29uZmlnKCk7XG4gICAgICAgIHJld2FyZENmZy51bm1hcnNoYWwocmV3YXJkc1tpXSk7XG4gICAgICAgIHRoaXMucmV3YXJkcy5wdXNoKHJld2FyZENmZyk7XG4gICAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBDaGFsbGVuZ2VSZXdhcmRDb25maWc7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IG95ZSBvbiAxNi81LzE5LlxuICovXG52YXIgQ29uZmlnID0ge1xuICAgIGl0dW5lc0Rvd25sb2FkVXJsOiBcIml0bXMtYXBwczovL2l0dW5lcy5hcHBsZS5jb20vYXBwL2lkMTM3MjgzNzEyMz9hY3Rpb249d3JpdGUtcmV2aWV3XCIsXG4gICAgZ29vZ2xlUGxheVVybDogXCJodHRwOi8vYml0Lmx5LzJPOEc5dnhcIixcbiAgICBpb3NTaG9ydFVybDogXCJodHRwczovL2FwcGxlLmNvLzJVUEN3ejZcIixcbiAgICBhbmRyb2lkU2hvcnRVcmw6IFwiaHR0cDovL2JpdC5seS8yTzhHOXZ4XCIsXG4gICAgaW9zVXJsOiBcImh0dHBzOi8vYXBwcy5hcHBsZS5jb20vY24vYXBwL2lkMTM3MjgzNzEyM1wiLFxuICAgIGFwcE5hbWU6IFwiQnJlYWsgQnJpY2tzXCIsXG4gICAgaW9zTGVhZGVyQm9hcmRLZXk6IFwiY29tLmRvdWFwcC5tYW55YnJpY2tzLnJhbmtcIixcbiAgICBpb3NIYXJkTGVhZGVyQm9hcmRLZXk6IFwiY29tLmRvdWFwcC5tYW55YnJpY2tzLmhhcmRyYW5rXCIsXG4gICAgZ29vZ2xlUGxheUxlYWRlckJvYXJkS2V5OiBcIkNna0lvdUN0MC1rQkVBSVFBUVwiLFxuICAgIGZhY2Vib29rRmFuUGFnZVVybDogXCJodHRwczovL3d3dy5mYWNlYm9vay5jb20vUGxheUJyZWFrQnJpY2tzL1wiLFxuICAgIHRhcHRhcFVybDogXCJodHRwczovL3d3dy50YXB0YXAuY29tL2FwcC84NzUzN1wiLFxuICAgIGlvc1N0YXJSYW5rS2V5OiBcImNvbS5kb3VhcHAubWFueWJyaWNrcy5zdGFycmFua1wiLFxuICAgIElTX0RFQlVHOiBmYWxzZSxcbiAgICBJU19FTkFCTEVfSE9UX1VQREFURTogZmFsc2UsXG5cbiAgICBnZXRGYW5zVXJsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChnYW1lLmxvY2FsLmlzQ2hpbmVzZSgpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy50YXB0YXBVcmw7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5mYWNlYm9va0ZhblBhZ2VVcmw7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZ2V0U3RhckxlYWRlckJvYXJkS2V5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlvc1N0YXJSYW5rS2V5O1xuICAgIH0sXG5cbiAgICBnZXRMZWFkZXJCb2FyZEtleTogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2Muc3lzLm9zID09IGNjLnN5cy5PU19BTkRST0lEKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nb29nbGVQbGF5TGVhZGVyQm9hcmRLZXk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pb3NMZWFkZXJCb2FyZEtleTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRIYXJkQm9hcmRLZXk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5vcyA9PSBjYy5zeXMuT1NfQU5EUk9JRCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ29vZ2xlUGxheUxlYWRlckJvYXJkS2V5O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW9zSGFyZExlYWRlckJvYXJkS2V5O1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldFBsYXRmb3JtRG93bmxvYWRVcmw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5vcyA9PSBjYy5zeXMuT1NfQU5EUk9JRCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ29vZ2xlUGxheVVybDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLml0dW5lc0Rvd25sb2FkVXJsO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldFNob3J0UGxhdGZvcm1Eb3dubG9hZFVybDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2Muc3lzLm9zID09IGNjLnN5cy5PU19BTkRST0lEKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5hbmRyb2lkU2hvcnRVcmw7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pb3NTaG9ydFVybDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRTaGFyZVVybDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2Muc3lzLm9zID09PSBjYy5zeXMuT1NfQU5EUk9JRCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYW5kcm9pZFNob3J0VXJsO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW9zVXJsO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldENyb3NzUHJvbVVybDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2Muc3lzLm9zID09IGNjLnN5cy5PU19BTkRST0lEKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jcm9zc1Byb21Vcmw7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoZ2FtZS51dGlscy5pc1NlbGZHYW1lKCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jbkNyb3NzUHJvbVVybDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNyb3NzUHJvbVVybDtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgZ2V0UGFja2FnZU5hbWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5vcyA9PSBjYy5zeXMuT1NfQU5EUk9JRCkge1xuICAgICAgICAgICAgaWYgKGdhbWUudXRpbHMuaXNTZWxmR2FtZSgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiY29tLmRvdWFwcC5tYW55YnJpY2tzXCI7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBcImNvbS5xMS5icmVha2JyaWNrc1wiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFwiY29tLmRvdWFwcC5tYW55YnJpY2tzXCI7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGdldEFkVXJsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChnYW1lLnV0aWxzLmlzU2VsZkdhbWUoKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY25OZXdBZENvbmZpZ1VybDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5hZENvbmZpZ1VybDtcbiAgICB9LFxuXG4gICAgZ2V0RW1haWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGdhbWUubG9jYWwuaXNDaGluZXNlKCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNuQ29ubmVjdEVtYWlsO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdEVtYWlsO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGhvcml6b250YWxHYW1lOiBmYWxzZSxcblxuICAgIC8vYmluZ2NodWFuIGFkIHVybC5cbiAgICBhZENvbmZpZ1VybDogXCJodHRwczovL29uZWdhbWVpbmMuZ2l0aHViLmlvL21hbnlfYnJpY2tzL2dhbWVfYmluZ2NodWFuLmh0bWxcIixcbiAgICAvL2JpbmdjaHVhbiBwcm9tIHVybC5cbiAgICBjcm9zc1Byb21Vcmw6IFwiaHR0cHM6Ly9vbmVnYW1laW5jLmdpdGh1Yi5pby9jcm9zc19wcm9tb3Rpb24vY29uZmlnL21hbnlfYnJpY2tzL2Nyb3NzX3Byb21vdGlvbl9iaW5nY2h1YW4uaHRtbFwiLFxuXG4gICAgLy9vbGQgdmVyc2lvbiBjbiBhZCB1cmwuXG4gICAgY25BZENvbmZpZ1VybDogXCJodHRwczovL29uZWdhbWVpbmMuZ2l0aHViLmlvL21hbnlfYnJpY2tzL2dhbWUuaHRtbFwiLFxuICAgIC8vbmV3IHZlcnNpb24gY24gYWQgdXJsLlxuICAgIGNuTmV3QWRDb25maWdVcmw6IFwiaHR0cHM6Ly9vbmVnYW1laW5jLmdpdGh1Yi5pby9tYW55X2JyaWNrcy9nYW1lX2NuLmh0bWxcIixcbiAgICAvL2NuIHByb20gdXJsLlxuICAgIGNuQ3Jvc3NQcm9tVXJsOiBcImh0dHBzOi8vb25lZ2FtZWluYy5naXRodWIuaW8vY3Jvc3NfcHJvbW90aW9uL2NvbmZpZy9tYW55X2JyaWNrcy9jcm9zc19wcm9tb3Rpb24uaHRtbFwiLFxuICAgIFxuICAgIGNvbm5lY3RFbWFpbDogXCJicmlja3MuY3J1c2gucGxheUBnbWFpbC5jb21cIixcblxuICAgIGNuQ29ubmVjdEVtYWlsOiBcImJyZWFrX2JyaWNrc18yMDE5QDE2My5jb21cIixcblxuICAgIHJld2FyZEFkTWF4Q291bnRQZXJEYXk6IDEwLFxuICAgIHJld2FyZERpYW1vbmRzOiA1LFxuICAgIHJld2FyZERpYW1vbmRNYXA6IHtcbiAgICAgICAgXCIxXCI6IDEsXG4gICAgICAgIFwiMlwiOiAzLFxuICAgICAgICBcIjNcIjogNVxuICAgIH0sXG4gICAgcmVsaWZlRGlhbW9uZHM6IDIwLFxuICAgIHNraXBEaWFtb25kczogMTAwLFxuICAgIGFpbUl0ZW1EaWFtb25kczogNTAsXG4gICAgbG93QW5kcm9pZEZQUzogNDAsXG4gICAgZGFpbHlEaWFtb25kczogNTAsXG4gICAgYm9vc3RQcm9iYWJpbGl0eTogMC4wNCxcbiAgICBjaGFsbGVuZ2VCb29zdFByb2JhYmlsaXR5OiAwLjEsXG4gICAgbXVsdGlDbGFpbVJhbmdlOiBbMywgMjBdLFxuICAgIG11bHRpRGlhbW9uZHNSYW5nZTogWzE1LCA0MF0sXG4gICAgcmV3YXJkUmVtb3ZlQWRzQ2ZnOiB7XG4gICAgICAgIFwibXVsdGlcIjogMSxcbiAgICAgICAgXCJhZGRcIjogMSxcbiAgICAgICAgXCJ0aW1lSW5NaW51dGVcIjogNFxuICAgIH0sXG4gICAgbXVsdGlDbGFpbVBvc3NpYmlsaXR5OiBbXG4gICAgICAgIHtzdGFydDozLCBlbmQ6IDQsIHA6IDIwfSxcbiAgICAgICAge3N0YXJ0OjUsIGVuZDogNiwgcDogMzV9LFxuICAgICAgICB7c3RhcnQ6NywgZW5kOiA4LCBwOiAyMH0sXG4gICAgICAgIHtzdGFydDo5LCBlbmQ6IDEwLCBwOiAxNX0sXG4gICAgICAgIHtzdGFydDoxMSwgZW5kOiAxNSwgcDogN30sXG4gICAgICAgIHtzdGFydDoxNiwgZW5kOiAyMCwgcDogM31cbiAgICBdLFxuICAgIG11bHRpRGlhbW9uZHNQb3NzaWJpbGl0eTogW1xuICAgICAgICB7c3RhcnQ6MTUsIGVuZDogMjAsIHA6IDI1fSxcbiAgICAgICAge3N0YXJ0OjIxLCBlbmQ6IDI1LCBwOiA0MH0sXG4gICAgICAgIHtzdGFydDoyNiwgZW5kOiAzMCwgcDogMjB9LFxuICAgICAgICB7c3RhcnQ6MzEsIGVuZDogMzUsIHA6IDEwfSxcbiAgICAgICAge3N0YXJ0OjM2LCBlbmQ6IDQwLCBwOiA1fVxuICAgIF0sXG4gICAgZGFpbHlXaGVlbE1heENvdW50OiAzLFxuICAgIGFjdGl2aXR5VGFza0RheTogMTBcbiAgICAvLyBhY3Rpdml0eVRhc2tFbmRUaW1lOiBuZXcgRGF0ZSgyMDE5LCAxMSwgMjYsIDAsIDAsIDAsIDApXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IENvbmZpZzsiLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAyMDE3LzMvMjUuXG4gKi9cbnZhciBMZXZlbENvbmZpZyA9IHJlcXVpcmUoXCIuL0xldmVsQ29uZmlnXCIpO1xuLy92YXIgUGFja2FnZUNvbmZpZyA9IHJlcXVpcmUoXCIuL1BhY2thZ2VDb25maWdcIik7XG52YXIgU3RvcmVDb25maWcgPSByZXF1aXJlKFwiLi9TdG9yZUNvbmZpZ1wiKTtcbnZhciBXaGVlbENvbmZpZyA9IHJlcXVpcmUoXCIuL1doZWVsQ29uZmlnXCIpO1xudmFyIFNoYXJlQ29uZmlnID0gcmVxdWlyZShcIi4vU2hhcmVDb25maWdcIik7XG52YXIgU2tpbkNvbmZpZyA9IHJlcXVpcmUoXCIuL1NraW5Db25maWdcIik7XG52YXIgRGFpbHlCb251c0NvbmZpZyA9IHJlcXVpcmUoXCIuL0RhaWx5Qm9udXNDb25maWdcIik7XG52YXIgU3RvcmVUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vU3RvcmVUeXBlXCIpO1xudmFyIFRhc2tDb25maWcgPSByZXF1aXJlKFwiLi9UYXNrQ29uZmlnXCIpO1xudmFyIEJvb3N0VHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL0Jvb3N0VHlwZVwiKTtcbnZhciBUYXNrT2xkQ29uZmlnID0gcmVxdWlyZShcIi4vVGFza09sZENvbmZpZ1wiKTtcbnZhciBDYXJkQ29uZmlnID0gcmVxdWlyZShcIi4vQ2FyZENvbmZpZ1wiKTtcbnZhciBDaGFsbGVuZ2VDb25maWcgPSByZXF1aXJlKFwiLi9DaGFsbGVuZ2VDb25maWdcIik7XG52YXIgQm9hcmRDb25maWcgPSByZXF1aXJlKFwiLi9Cb2FyZENvbmZpZ1wiKTtcbnZhciBCb3hSZXdhcmRDb25maWcgPSByZXF1aXJlKFwiLi9Cb3hSZXdhcmRDb25maWdcIik7XG52YXIgQWN0aXZpdHlUYXNrQ29uZmlnID0gcmVxdWlyZShcIi4vQWN0aXZpdHlUYXNrQ29uZmlnXCIpO1xudmFyIEFjdGl2aXR5VGFza1Jld2FyZENvbmZpZyA9IHJlcXVpcmUoXCIuL0FjdGl2aXR5VGFza1Jld2FyZENvbmZpZ1wiKTtcblxudmFyIExldmVsQ29uZmlnTWFuID0gY2MuQ2xhc3MuZXh0ZW5kKHtcblxuICAgIGxldmVsTGlzdDogbnVsbCxcbiAgICBsZXZlbExpc3RCOiBudWxsLFxuICAgIGhhcmRMZXZlbExpc3Q6IG51bGwsXG4gICAgc2VydmVySGFyZExldmVsTGlzdDogbnVsbCxcbiAgICBzdG9yZUxpc3Q6IG51bGwsXG4gICAgd2hlZWxMaXN0OiBudWxsLFxuICAgIGJveFdoZWVsTGlzdDogbnVsbCxcbiAgICBzaGFyZUxpc3Q6IG51bGwsXG4gICAgc2tpbkxpc3Q6IG51bGwsXG4gICAgZGFpbHlCb251c0xpc3Q6IG51bGwsXG4gICAgc3RvcmVMaXN0V2l0aG91dEZpcnN0UHVyY2hhc2U6IG51bGwsXG4gICAgc3RvcmVMaXN0V2l0aG91dEZpcnN0UHVyY2hhc2VBbmRBaW1JdGVtOiBudWxsLFxuICAgIHRhc2tMaXN0OiBudWxsLFxuICAgIG9sZFRhc2tMaXN0OiBudWxsLFxuICAgIG9yaWdpbmFsTGV2ZWxMaXN0OiBudWxsLFxuICAgIGNhcmRDb25maWdMaXN0OiBudWxsLFxuICAgIGJvYXJkTGlzdDogbnVsbCxcbiAgICBib3hMaXN0OiBudWxsLFxuXG4gICAgLy8gY2hhbGxlbmdlTGV2ZWxMaXN0OiBudWxsLFxuXG4gICAgY2hhbGxlbmdlQ29uZmlnOiBudWxsLFxuICAgIGFjdGl2aXR5VGFza0xpc3Q6IG51bGwsXG4gICAgYWN0aXZpdHlUYXNrQkxpc3Q6IG51bGwsXG4gICAgYWN0aXZpdHlUYXNrUmV3YXJkTGlzdDogbnVsbCxcblxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5zdG9yZUxpc3QgPSBbXTtcbiAgICAgICAgdGhpcy5sZXZlbExpc3QgPSBbXTtcbiAgICAgICAgdGhpcy53aGVlbExpc3QgPSBbXTtcbiAgICAgICAgdGhpcy5ib3hXaGVlbExpc3QgPSBbXTtcbiAgICAgICAgdGhpcy5zaGFyZUxpc3QgPSBbXTtcbiAgICAgICAgdGhpcy5za2luTGlzdCA9IFtdO1xuICAgICAgICB0aGlzLmRhaWx5Qm9udXNMaXN0ID0gW107XG4gICAgICAgIHRoaXMuc3RvcmVMaXN0V2l0aG91dEZpcnN0UHVyY2hhc2UgPSBbXTtcbiAgICAgICAgdGhpcy5zdG9yZUxpc3RXaXRob3V0Rmlyc3RQdXJjaGFzZUFuZEFpbUl0ZW0gPSBbXTtcbiAgICAgICAgdGhpcy50YXNrTGlzdCA9IFtdO1xuICAgICAgICB0aGlzLm9sZFRhc2tMaXN0ID0gW107XG4gICAgICAgIHRoaXMuY2FyZENvbmZpZ0xpc3QgPSBbXTtcbiAgICAgICAgLy8gdGhpcy5jaGFsbGVuZ2VMZXZlbExpc3QgPSBbXTtcbiAgICAgICAgdGhpcy5jaGFsbGVuZ2VDb25maWcgPSBudWxsO1xuICAgICAgICB0aGlzLmJvYXJkTGlzdCA9IFtdO1xuICAgICAgICB0aGlzLmJveExpc3QgPSBbXTtcbiAgICAgICAgdGhpcy5hY3Rpdml0eVRhc2tMaXN0ID0gW107XG4gICAgICAgIHRoaXMuYWN0aXZpdHlUYXNrQkxpc3QgPSBbXTtcbiAgICAgICAgdGhpcy5hY3Rpdml0eVRhc2tSZXdhcmRMaXN0ID0gW107XG5cbiAgICAgICAgLy8gdGhpcy5yZWxvYWQoKTtcbiAgICB9LFxuXG4gICAgcmVsb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBpO1xuXG4gICAgICAgIHZhciBqc29uT2JqID0gZ2FtZS51dGlscy5sb2FkSnNvbihcInJlcy9jb25maWcvc3RvcmVfY29uZmlnLmpzb25cIik7XG4gICAgICAgIHZhciBzdG9yZUNvbmZpZ3MgPSBqc29uT2JqW1wic3RvcmVzXCJdO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc3RvcmVDb25maWdzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB2YXIgc3RvcmVDb25maWcgPSBuZXcgU3RvcmVDb25maWcoKTtcbiAgICAgICAgICAgIHN0b3JlQ29uZmlnLnVubWFyc2hhbChzdG9yZUNvbmZpZ3NbaV0pO1xuICAgICAgICAgICAgdGhpcy5zdG9yZUxpc3QucHVzaChzdG9yZUNvbmZpZyk7XG5cbiAgICAgICAgICAgIGlmIChzdG9yZUNvbmZpZy50eXBlID09PSBTdG9yZVR5cGUuRklSU1RfUFVSQ0hBU0UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNwZWNpYWxPZmZlckNmZyA9IHN0b3JlQ29uZmlnO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoc3RvcmVDb25maWcudHlwZSAhPT0gU3RvcmVUeXBlLkFJTV9JVEVNKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcmVMaXN0V2l0aG91dEZpcnN0UHVyY2hhc2VBbmRBaW1JdGVtLnB1c2goc3RvcmVDb25maWcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnN0b3JlTGlzdFdpdGhvdXRGaXJzdFB1cmNoYXNlLnB1c2goc3RvcmVDb25maWcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5yZWxvYWRMZXZlbENvbmZpZygpO1xuXG4gICAgICAgIGpzb25PYmogPSBnYW1lLnV0aWxzLmxvYWRKc29uKFwicmVzL2NvbmZpZy9kYXRhX2NvbmZpZy5qc29uXCIpO1xuICAgICAgICB2YXIgd2hlZWxDb25maWdzID0ganNvbk9ialtcIndoZWVsXCJdO1xuICAgICAgICB2YXIgd2hlZWxDb25maWc7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCB3aGVlbENvbmZpZ3MubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHdoZWVsQ29uZmlnID0gbmV3IFdoZWVsQ29uZmlnKCk7XG4gICAgICAgICAgICB3aGVlbENvbmZpZy51bm1hcnNoYWwod2hlZWxDb25maWdzW2ldKTtcbiAgICAgICAgICAgIHRoaXMud2hlZWxMaXN0LnB1c2god2hlZWxDb25maWcpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGJveFdoZWVsQ29uZmlncyA9IGpzb25PYmpbXCJib3hcIl07XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBib3hXaGVlbENvbmZpZ3MubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHdoZWVsQ29uZmlnID0gbmV3IFdoZWVsQ29uZmlnKCk7XG4gICAgICAgICAgICB3aGVlbENvbmZpZy51bm1hcnNoYWwoYm94V2hlZWxDb25maWdzW2ldKTtcbiAgICAgICAgICAgIHRoaXMuYm94V2hlZWxMaXN0LnB1c2god2hlZWxDb25maWcpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHNoYXJlQ29uZmlncyA9IGpzb25PYmpbXCJzaGFyZVwiXTtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IHNoYXJlQ29uZmlncy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdmFyIHNoYXJlQ29uZmlnID0gbmV3IFNoYXJlQ29uZmlnKCk7XG4gICAgICAgICAgICBzaGFyZUNvbmZpZy51bm1hcnNoYWwoc2hhcmVDb25maWdzW2ldKTtcbiAgICAgICAgICAgIHRoaXMuc2hhcmVMaXN0LnB1c2goc2hhcmVDb25maWcpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGNhcmRDb25maWdzID0ganNvbk9ialtcImNhcmRzXCJdO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY2FyZENvbmZpZ3MubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciBjYXJkQ29uZmlnID0gbmV3IENhcmRDb25maWcoKTtcbiAgICAgICAgICAgIGNhcmRDb25maWcudW5tYXJzaGFsKGNhcmRDb25maWdzW2ldKTtcbiAgICAgICAgICAgIHRoaXMuY2FyZENvbmZpZ0xpc3QucHVzaChjYXJkQ29uZmlnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBkYWlseUJvbnVzQ29uZmlncyA9IGpzb25PYmpbXCJkYWlseV9ib251c1wiXTtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGRhaWx5Qm9udXNDb25maWdzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB2YXIgZGFpbHlCb251c0NvbmZpZyA9IG5ldyBEYWlseUJvbnVzQ29uZmlnKCk7XG4gICAgICAgICAgICBkYWlseUJvbnVzQ29uZmlnLnVubWFyc2hhbChkYWlseUJvbnVzQ29uZmlnc1tpXSk7XG4gICAgICAgICAgICBpZiAoZGFpbHlCb251c0NvbmZpZy50eXBlID09PSBCb29zdFR5cGUuU0tJTikge1xuICAgICAgICAgICAgICAgIHZhciBnZXR0ZWQgPSBnYW1lLnBsYXllck1hbi5oYXNTa2luKGRhaWx5Qm9udXNDb25maWcuYXJnMSk7XG4gICAgICAgICAgICAgICAgaWYgKGdldHRlZCkge1xuICAgICAgICAgICAgICAgICAgICBkYWlseUJvbnVzQ29uZmlnLnR5cGUgPSBkYWlseUJvbnVzQ29uZmlnLmV4dHJhLnR5cGU7XG4gICAgICAgICAgICAgICAgICAgIGRhaWx5Qm9udXNDb25maWcuY291bnQgPSBkYWlseUJvbnVzQ29uZmlnLmV4dHJhLmNvdW50O1xuICAgICAgICAgICAgICAgICAgICBkYWlseUJvbnVzQ29uZmlnLmltYWdlID0gZGFpbHlCb251c0NvbmZpZy5leHRyYS5pbWFnZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuZGFpbHlCb251c0xpc3QucHVzaChkYWlseUJvbnVzQ29uZmlnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGpzb25PYmogPSBnYW1lLnV0aWxzLmxvYWRKc29uKFwicmVzL2NvbmZpZy9za2luc19jb25maWcuanNvblwiKTtcbiAgICAgICAgdmFyIHNraW5zQ29uZmlncyA9IGpzb25PYmpbXCJza2luc1wiXTtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IHNraW5zQ29uZmlncy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdmFyIHNraW5Db25maWcgPSBuZXcgU2tpbkNvbmZpZygpO1xuICAgICAgICAgICAgc2tpbkNvbmZpZy51bm1hcnNoYWwoc2tpbnNDb25maWdzW2ldKTtcbiAgICAgICAgICAgIHRoaXMuc2tpbkxpc3QucHVzaChza2luQ29uZmlnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGpzb25PYmogPSBnYW1lLnV0aWxzLmxvYWRKc29uKFwicmVzL2NvbmZpZy9ib2FyZHNfY29uZmlnLmpzb25cIik7XG4gICAgICAgIHZhciBza2luc0NvbmZpZ3MgPSBqc29uT2JqW1wiYm9hcmRzXCJdO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc2tpbnNDb25maWdzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB2YXIgc2tpbkNvbmZpZyA9IG5ldyBCb2FyZENvbmZpZygpO1xuICAgICAgICAgICAgc2tpbkNvbmZpZy51bm1hcnNoYWwoc2tpbnNDb25maWdzW2ldKTtcbiAgICAgICAgICAgIHRoaXMuYm9hcmRMaXN0LnB1c2goc2tpbkNvbmZpZyk7XG4gICAgICAgIH1cblxuICAgICAgICBqc29uT2JqID0gZ2FtZS51dGlscy5sb2FkSnNvbihcInJlcy9jb25maWcvYm94X2NvbmZpZy5qc29uXCIpO1xuICAgICAgICB0aGlzLmJveFJld2FyZENvbmZpZyA9IG5ldyBCb3hSZXdhcmRDb25maWcoKTtcbiAgICAgICAgdGhpcy5ib3hSZXdhcmRDb25maWcudW5tYXJzaGFsKGpzb25PYmopO1xuXG4gICAgICAgIGpzb25PYmogPSBnYW1lLnV0aWxzLmxvYWRKc29uKFwicmVzL2NvbmZpZy90YXNrX2NvbmZpZy5qc29uXCIpO1xuICAgICAgICB2YXIgdGFza0NvbmZpZ3MgPSBqc29uT2JqW1widGFza3NcIl07XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCB0YXNrQ29uZmlncy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdmFyIHRhc2tDb25maWcgPSBuZXcgVGFza0NvbmZpZygpO1xuICAgICAgICAgICAgdGFza0NvbmZpZy51bm1hcnNoYWwodGFza0NvbmZpZ3NbaV0pO1xuICAgICAgICAgICAgdGhpcy50YXNrTGlzdC5wdXNoKHRhc2tDb25maWcpO1xuICAgICAgICB9XG5cbiAgICAgICAganNvbk9iaiA9IGdhbWUudXRpbHMubG9hZEpzb24oXCJyZXMvY29uZmlnL3Rhc2tfb2xkX2NvbmZpZy5qc29uXCIpO1xuICAgICAgICB2YXIgdGFza0NvbmZpZ3MgPSBqc29uT2JqW1widGFza3NcIl07XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCB0YXNrQ29uZmlncy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdmFyIHRhc2tDb25maWcgPSBuZXcgVGFza09sZENvbmZpZygpO1xuICAgICAgICAgICAgdGFza0NvbmZpZy51bm1hcnNoYWwodGFza0NvbmZpZ3NbaV0pO1xuICAgICAgICAgICAgdGhpcy5vbGRUYXNrTGlzdC5wdXNoKHRhc2tDb25maWcpO1xuICAgICAgICB9XG5cbiAgICAgICAganNvbk9iaiA9IGdhbWUudXRpbHMubG9hZEpzb24oXCJyZXMvY29uZmlnL2FjdGl2aXR5X3Rhc2tfY29uZmlnLmpzb25cIik7XG4gICAgICAgIHZhciB0YXNrQ29uZmlncyA9IGpzb25PYmpbXCJ0YXNrc1wiXTtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IHRhc2tDb25maWdzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB2YXIgdGFza0NvbmZpZyA9IG5ldyBBY3Rpdml0eVRhc2tDb25maWcoKTtcbiAgICAgICAgICAgIHRhc2tDb25maWcudW5tYXJzaGFsKHRhc2tDb25maWdzW2ldKTtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZpdHlUYXNrTGlzdC5wdXNoKHRhc2tDb25maWcpO1xuICAgICAgICB9XG5cbiAgICAgICAganNvbk9iaiA9IGdhbWUudXRpbHMubG9hZEpzb24oXCJyZXMvY29uZmlnL2FjdGl2aXR5X3Rhc2tfY29uZmlnLWIuanNvblwiKTtcbiAgICAgICAgdmFyIHRhc2tDb25maWdzID0ganNvbk9ialtcInRhc2tzXCJdO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdGFza0NvbmZpZ3MubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciB0YXNrQ29uZmlnID0gbmV3IEFjdGl2aXR5VGFza0NvbmZpZygpO1xuICAgICAgICAgICAgdGFza0NvbmZpZy51bm1hcnNoYWwodGFza0NvbmZpZ3NbaV0pO1xuICAgICAgICAgICAgdGhpcy5hY3Rpdml0eVRhc2tCTGlzdC5wdXNoKHRhc2tDb25maWcpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHRhc2tDb25maWdzID0ganNvbk9ialtcInJld2FyZHNcIl07XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCB0YXNrQ29uZmlncy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdmFyIHRhc2tDb25maWcgPSBuZXcgQWN0aXZpdHlUYXNrUmV3YXJkQ29uZmlnKCk7XG4gICAgICAgICAgICB0YXNrQ29uZmlnLnVubWFyc2hhbCh0YXNrQ29uZmlnc1tpXSk7XG4gICAgICAgICAgICB0aGlzLmFjdGl2aXR5VGFza1Jld2FyZExpc3QucHVzaCh0YXNrQ29uZmlnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGpzb25PYmogPSBnYW1lLnV0aWxzLmxvYWRKc29uKFwicmVzL2NvbmZpZy9jaGFsbGVuZ2VfY29uZmlnLmpzb25cIik7XG5cbiAgICAgICAgdGhpcy5jaGFsbGVuZ2VDb25maWcgPSBuZXcgQ2hhbGxlbmdlQ29uZmlnKCk7XG4gICAgICAgIHRoaXMuY2hhbGxlbmdlQ29uZmlnLnVubWFyc2hhbChqc29uT2JqKTtcblxuXG4gICAgICAgIHRoaXMuY2hhbGxlbmdlTGV2ZWxNYXAgPSB7fTtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuY2hhbGxlbmdlQ29uZmlnLmNoYWxsZW5nZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciBjaGFsbGVuZ2UgPSB0aGlzLmNoYWxsZW5nZUNvbmZpZy5jaGFsbGVuZ2VzW2ldO1xuICAgICAgICAgICAganNvbk9iaiA9IGdhbWUudXRpbHMubG9hZEpzb24oXCJyZXMvY29uZmlnL2NoYWxsZW5nZVwiICsgY2hhbGxlbmdlLmlkICsgXCJfbGV2ZWxfY29uZmlncy5qc29uXCIpO1xuICAgICAgICAgICAgdmFyIGxldmVsQ29uZmlncyA9IGpzb25PYmpbXCJsZXZlbHNcIl07XG4gICAgICAgICAgICB0aGlzLmNoYWxsZW5nZUxldmVsTWFwW2NoYWxsZW5nZS5pZF0gPSBbXTtcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbGV2ZWxDb25maWdzLmxlbmd0aDsgKytqKSB7XG4gICAgICAgICAgICAgICAgdmFyIGxldmVsQ29uZmlnID0gbmV3IExldmVsQ29uZmlnKCk7XG4gICAgICAgICAgICAgICAgbGV2ZWxDb25maWcudW5tYXJzaGFsKGxldmVsQ29uZmlnc1tqXSk7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFsbGVuZ2VMZXZlbE1hcFtjaGFsbGVuZ2UuaWRdLnB1c2gobGV2ZWxDb25maWcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldENoYWxsZW5nZTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jaGFsbGVuZ2VDb25maWc7XG4gICAgfSxcblxuICAgIHJlbG9hZExldmVsQ29uZmlnOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMubGV2ZWxMaXN0ID0gdGhpcy5sb2FkTGV2ZWxDb25maWdzKFwiYVwiKTtcbiAgICAgICAgdGhpcy5sZXZlbExpc3RCID0gdGhpcy5sb2FkTGV2ZWxDb25maWdzKFwiYlwiKTtcbiAgICAgICAgdGhpcy5oYXJkTGV2ZWxMaXN0ID0gdGhpcy5sb2FkTGV2ZWxDb25maWdzKFwiaGFyZFwiKTtcbiAgICB9LFxuXG4gICAgbG9hZExldmVsQ29uZmlnczogZnVuY3Rpb24gKGdyb3VwKSB7XG4gICAgICAgIHZhciBsZXZlbExpc3QgPSBbXTtcbiAgICAgICAgdmFyIHBhdGggPSBcInJlcy9jb25maWcvbGV2ZWxfY29uZmlncy5qc29uXCI7XG4gICAgICAgIGlmIChncm91cCA9PT0gXCJiXCIpIHtcbiAgICAgICAgICAgIHBhdGggPSBcInJlcy9jb25maWcvbGV2ZWxfY29uZmlncy1iLmpzb25cIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChncm91cCA9PT0gXCJoYXJkXCIpIHtcbiAgICAgICAgICAgIHBhdGggPSBcInJlcy9jb25maWcvbGV2ZWxfY29uZmlncy1oYXJkLmpzb25cIjtcbiAgICAgICAgfVxuICAgICAgICB2YXIganNvbk9iaiA9IGdhbWUudXRpbHMubG9hZEpzb24ocGF0aCk7XG4gICAgICAgIHZhciBsZXZlbENvbmZpZ3MgPSBqc29uT2JqW1wibGV2ZWxzXCJdO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxldmVsQ29uZmlncy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdmFyIGxldmVsQ29uZmlnID0gbmV3IExldmVsQ29uZmlnKCk7XG4gICAgICAgICAgICBsZXZlbENvbmZpZy51bm1hcnNoYWwobGV2ZWxDb25maWdzW2ldKTtcbiAgICAgICAgICAgIGxldmVsTGlzdC5wdXNoKGxldmVsQ29uZmlnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbGV2ZWxMaXN0O1xuICAgIH0sXG5cbiAgICBnZXRDaGFsbGVuZ2VMZXZlbExpc3Q6IGZ1bmN0aW9uIChjaGFsbGVuZ2VJZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jaGFsbGVuZ2VMZXZlbE1hcFtjaGFsbGVuZ2VJZF07XG4gICAgfSxcblxuICAgIGdldENoYWxsZW5nZUNvbmZpZzogZnVuY3Rpb24gKGNoYWxsZW5nZUlkLCBsZXZlbElkKSB7XG4gICAgICAgIHZhciBjaGFsbGVuZ2VMaXN0ID0gdGhpcy5jaGFsbGVuZ2VMZXZlbE1hcFtjaGFsbGVuZ2VJZF07XG4gICAgICAgIGlmIChsZXZlbElkIDwgY2hhbGxlbmdlTGlzdC5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBjaGFsbGVuZ2VMaXN0W2xldmVsSWQgLSAxXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9LFxuXG4gICAgZ2V0Q2FyZExpc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FyZENvbmZpZ0xpc3Q7XG4gICAgfSxcblxuICAgIGdldFN0b3JlTGlzdDogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdG9yZUxpc3Q7XG4gICAgfSxcblxuICAgIGdldFN0b3JlTGlzdFdpdGhvdXRGaXJzdFB1cmNoYXNlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0b3JlTGlzdFdpdGhvdXRGaXJzdFB1cmNoYXNlO1xuICAgIH0sXG5cbiAgICBnZXRTdG9yZUxpc3RXaXRob3V0Rmlyc3RQdXJjaGFzZUFuZEFpbUl0ZW06IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RvcmVMaXN0V2l0aG91dEZpcnN0UHVyY2hhc2VBbmRBaW1JdGVtO1xuICAgIH0sXG5cbiAgICBnZXRMZXZlbExpc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGV2ZWxMaXN0O1xuICAgIH0sXG5cbiAgICBnZXROZXdIYXJkTGV2ZWxMaXN0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5zZXJ2ZXJIYXJkTGV2ZWxMaXN0KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5oYXJkTGV2ZWxMaXN0O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmhhcmRMZXZlbExpc3QuY29uY2F0KHRoaXMuc2VydmVySGFyZExldmVsTGlzdCk7XG4gICAgfSxcblxuICAgIGFkZEhhcmRMZXZlbExpc3Q6IGZ1bmN0aW9uIChoYXJkTGlzdCkge1xuICAgICAgICB0aGlzLnNlcnZlckhhcmRMZXZlbExpc3QgPSBoYXJkTGlzdDtcbiAgICB9LFxuXG4gICAgX2dldExldmVsTGlzdDogZnVuY3Rpb24gKGdyb3VwKSB7XG4gICAgICAgIGlmIChncm91cCA9PT0gXCJiXCIpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxldmVsTGlzdEI7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMubGV2ZWxMaXN0O1xuICAgIH0sXG5cbiAgICBnZXROZXdIYXJkTGV2ZWxDb25maWc6IGZ1bmN0aW9uIChsZXZlbElkKSB7XG4gICAgICAgIHZhciBsaXN0ID0gdGhpcy5nZXROZXdIYXJkTGV2ZWxMaXN0KCk7XG4gICAgICAgIGlmIChsZXZlbElkIC0gMSA+PSBsaXN0Lmxlbmd0aCkge1xuICAgICAgICAgICAgaWYgKGxldmVsSWQgLSAxID49IGxpc3QubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBsaXN0W2xldmVsSWQgLSAxXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbGlzdFtsZXZlbElkIC0gMV07XG4gICAgfSxcblxuICAgIGdldExldmVsQ29uZmlnOiBmdW5jdGlvbiAobGV2ZWxJZCkge1xuICAgICAgICB2YXIgZ3JvdXAgPSBnYW1lLnBsYXllck1hbi5nZXRHcm91cChnYW1lLmFiVGVzdFR5cGUuTGV2ZWwpO1xuICAgICAgICB2YXIgbGlzdCA9IHRoaXMuX2dldExldmVsTGlzdChncm91cCk7XG4gICAgICAgIGlmIChsZXZlbElkIC0gMSA+PSBsaXN0Lmxlbmd0aCkge1xuICAgICAgICAgICAgaWYgKGxldmVsSWQgLSAxID49IHRoaXMubGV2ZWxMaXN0Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sZXZlbExpc3RbbGV2ZWxJZCAtIDFdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBsaXN0W2xldmVsSWQgLSAxXTtcbiAgICB9LFxuXG4gICAgZ2V0T3JpZ2luYWxMZXZlbENvbmZpZzogZnVuY3Rpb24gKGxldmVsSWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3JpZ2luYWxMZXZlbExpc3RbbGV2ZWxJZCAtIDFdO1xuICAgIH0sXG5cbiAgICBnZXRXaGVlbExpc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud2hlZWxMaXN0O1xuICAgIH0sXG5cbiAgICBnZXRCb3hXaGVlbExpc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYm94V2hlZWxMaXN0O1xuICAgIH0sXG5cbiAgICBnZXRTaGFyZUxpc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2hhcmVMaXN0O1xuICAgIH0sXG5cbiAgICBnZXRTa2luTGlzdDogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5za2luTGlzdDtcbiAgICB9LFxuXG4gICAgZ2V0Qm9hcmRMaXN0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJvYXJkTGlzdDtcbiAgICB9LFxuXG4gICAgZ2V0Qm9hcmRMaXN0QnlUeXBlOiBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICB2YXIgbGlzdCA9IFtdO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuYm9hcmRMaXN0Lmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gdGhpcy5ib2FyZExpc3RbaV0udHlwZSkge1xuICAgICAgICAgICAgICAgIGxpc3QucHVzaCh0aGlzLmJvYXJkTGlzdFtpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGxpc3Q7XG4gICAgfSxcblxuICAgIGdldFNraW5MaXN0QnlUeXBlOiBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICB2YXIgbGlzdCA9IFtdO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc2tpbkxpc3QubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGlmICh0eXBlID09PSB0aGlzLnNraW5MaXN0W2ldLnR5cGUpIHtcbiAgICAgICAgICAgICAgICBsaXN0LnB1c2godGhpcy5za2luTGlzdFtpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGxpc3Q7XG4gICAgfSxcblxuICAgIGdldFRhc2tMaXN0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRhc2tMaXN0O1xuICAgIH0sXG5cbiAgICBnZXRPbGRUYXNrTGlzdDogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vbGRUYXNrTGlzdDtcbiAgICB9LFxuXG4gICAgZ2V0U2tpbkNmZzogZnVuY3Rpb24gKHNraW5JZCkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc2tpbkxpc3QubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGlmIChza2luSWQgPT09IHRoaXMuc2tpbkxpc3RbaV0uaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5za2luTGlzdFtpXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9LFxuXG4gICAgZ2V0Qm9hcmRDZmc6IGZ1bmN0aW9uIChib2FyZElkKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5ib2FyZExpc3QubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGlmIChib2FyZElkID09IHRoaXMuYm9hcmRMaXN0W2ldLmlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYm9hcmRMaXN0W2ldO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH0sXG5cbiAgICBnZXREYWlseUJvbnVzTGlzdDogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kYWlseUJvbnVzTGlzdDtcbiAgICB9LFxuXG4gICAgZ2V0U3BlY2lhbE9mZmVyQ2ZnOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNwZWNpYWxPZmZlckNmZztcbiAgICB9LFxuXG4gICAgZ2V0QWN0aXZpdHlUYXNrQ29uZmlnOiBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICB2YXIgdGFza0xpc3QgPSB0aGlzLmdldEFjdGl2aXR5VGFza0xpc3QoKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0YXNrTGlzdC5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgaWYgKHRhc2tMaXN0W2ldLnR5cGUgPT09IHR5cGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGFza0xpc3RbaV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSxcblxuICAgIGdldEFjdGl2aXR5VGFza0xpc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWN0aXZpdHlUYXNrTGlzdDtcbiAgICB9LFxuXG4gICAgZ2V0QWN0aXZpdHlUYXNrUmV3YXJkczogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hY3Rpdml0eVRhc2tSZXdhcmRMaXN0O1xuICAgIH1cblxuICAgIC8vZ2V0UGFja2FnZTogZnVuY3Rpb24gKHBhY2thZ2VJZCkge1xuICAgIC8vICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5wYWNrYWdlTGlzdC5sZW5ndGg7ICsraSkge1xuICAgIC8vICAgICAgICBpZiAodGhpcy5wYWNrYWdlTGlzdFtpXS5pZCA9PT0gcGFja2FnZUlkKSB7XG4gICAgLy8gICAgICAgICAgICByZXR1cm4gdGhpcy5wYWNrYWdlTGlzdFtpXTtcbiAgICAvLyAgICAgICAgfVxuICAgIC8vICAgIH1cbiAgICAvLyAgICByZXR1cm4gbnVsbDtcbiAgICAvL31cbn0pO1xuXG5MZXZlbENvbmZpZ01hbi5faW5zdGFuY2UgPSBudWxsO1xuTGV2ZWxDb25maWdNYW4uX2ZpcnN0VXNlSW5zdGFuY2UgPSB0cnVlO1xuXG4vKipcbiAqXG4gKiBAcmV0dXJucyB7TGV2ZWxDb25maWdNYW59XG4gKi9cbkxldmVsQ29uZmlnTWFuLmdldEluc3RhbmNlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChMZXZlbENvbmZpZ01hbi5fZmlyc3RVc2VJbnN0YW5jZSkge1xuICAgICAgICBMZXZlbENvbmZpZ01hbi5fZmlyc3RVc2VJbnN0YW5jZSA9IGZhbHNlO1xuICAgICAgICBMZXZlbENvbmZpZ01hbi5faW5zdGFuY2UgPSBuZXcgTGV2ZWxDb25maWdNYW4oKTtcbiAgICB9XG4gICAgcmV0dXJuIExldmVsQ29uZmlnTWFuLl9pbnN0YW5jZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gTGV2ZWxDb25maWdNYW47XG4iLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAyMDE3LzEyLzE1LlxuICovXG5cbnZhciBEYWlseUJvbnVzQ29uZmlnID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuaWQgPSAwO1xuICAgIHRoaXMudHlwZSA9IDA7XG4gICAgdGhpcy5jb3VudCA9IDA7XG4gICAgLy90aGlzLnByb2JhYmlsaXR5ID0gMDtcbiAgICB0aGlzLmltYWdlID0gXCJcIjtcbiAgICB0aGlzLmFyZzEgPSBcIlwiO1xufTtcblxuRGFpbHlCb251c0NvbmZpZy5wcm90b3R5cGUudW5tYXJzaGFsID0gZnVuY3Rpb24gKGpzb25PYmopIHtcbiAgICB0aGlzLmlkID0ganNvbk9ialtcImlkXCJdO1xuICAgIHRoaXMudHlwZSA9IGpzb25PYmpbXCJ0eXBlXCJdO1xuICAgIHRoaXMuY291bnQgPSBqc29uT2JqW1wiY291bnRcIl07XG4gICAgLy90aGlzLnByb2JhYmlsaXR5ID0ganNvbk9ialtcInByb2JhYmlsaXR5XCJdO1xuICAgIHRoaXMuaW1hZ2UgPSBqc29uT2JqW1wiaW1hZ2VcIl07XG4gICAgdGhpcy5hcmcxID0ganNvbk9ialtcImFyZzFcIl07XG4gICAgdGhpcy5leHRyYSA9IGpzb25PYmpbXCJleHRyYVwiXTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gRGFpbHlCb251c0NvbmZpZztcblxuIiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMjAxNy8zLzI1LlxuICovXG52YXIgQnJpY2tDb25maWcgPSByZXF1aXJlKFwiLi9Ccmlja0NvbmZpZ1wiKTtcblxudmFyIExldmVsQ29uZmlnID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMubGlmZVByb2JhYmlsaXR5ID0gMDtcbiAgICB0aGlzLmJvb3N0UHJvYmFiaWxpdHkgPSAwO1xuICAgIHRoaXMucGl4ZWxXaWR0aCA9IDA7XG4gICAgdGhpcy5waXhlbEhlaWdodCA9IDA7XG4gICAgdGhpcy53aWR0aCA9IDA7XG4gICAgdGhpcy5oZWlnaHQgPSAwO1xuICAgIC8qKlxuICAgICAqIEB0eXBlIHtBcnJheS48QnJpY2tDb25maWc+fVxuICAgICAqL1xuICAgIHRoaXMub2JzdGFjbGVzID0gW107XG4gICAgLyoqXG4gICAgICogQHR5cGUge0FycmF5LjxCcmlja0NvbmZpZz59XG4gICAgICovXG4gICAgdGhpcy5icmlja3MgPSBbXTtcbiAgICB0aGlzLnN0YXJUaW1lID0gMDtcbiAgICB0aGlzLmJvbWJQcm9iYWJpbGl0eSA9IDA7XG4gICAgdGhpcy5sYXplckludGVydmFsID0gMDtcbiAgICB0aGlzLm5vbmVMYXplckNvdW50ID0gMDtcbiAgICB0aGlzLmNvbnRpbnVvdXNMYXplcnMgPSBbXTtcbn07XG5cbkxldmVsQ29uZmlnLnByb3RvdHlwZS51bm1hcnNoYWwgPSBmdW5jdGlvbiAoanNvbk9iaikge1xuICAgIHRoaXMubGlmZVByb2JhYmlsaXR5ID0ganNvbk9ialtcImxcIl0gfHwgMDtcbiAgICB0aGlzLmJvb3N0UHJvYmFiaWxpdHkgPSBqc29uT2JqW1wiYlwiXSB8fCAwO1xuICAgIHRoaXMuYm9tYlByb2JhYmlsaXR5ID0ganNvbk9ialtcIm1cIl0gfHwgMTtcbiAgICB0aGlzLnBpeGVsV2lkdGggPSBqc29uT2JqW1wicGl4ZWxXaWR0aFwiXTtcbiAgICB0aGlzLnBpeGVsSGVpZ2h0ID0ganNvbk9ialtcInBpeGVsSGVpZ2h0XCJdO1xuICAgIHRoaXMud2lkdGggPSBqc29uT2JqW1wid2lkdGhcIl07XG4gICAgdGhpcy5oZWlnaHQgPSBqc29uT2JqW1wiaGVpZ2h0XCJdO1xuICAgIHZhciBpO1xuICAgIHZhciBvYnN0YWNsZXMgPSBqc29uT2JqW1wib2JzdGFjbGVzXCJdO1xuICAgIGZvciAoaSA9IDA7IGkgPCBvYnN0YWNsZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgdmFyIG9ic3RhY2xlID0gb2JzdGFjbGVzW2ldO1xuICAgICAgICB2YXIgb2JzdGFjbGVDZmcgPSBuZXcgQnJpY2tDb25maWcoKTtcbiAgICAgICAgb2JzdGFjbGVDZmcudW5tYXJzaGFsKG9ic3RhY2xlKTtcbiAgICAgICAgdGhpcy5vYnN0YWNsZXMucHVzaChvYnN0YWNsZUNmZyk7XG4gICAgfVxuXG4gICAgdmFyIGJyaWNrcyA9IGpzb25PYmpbXCJicmlja3NcIl07XG4gICAgZm9yIChpID0gMDsgaSA8IGJyaWNrcy5sZW5ndGg7ICsraSkge1xuICAgICAgICB2YXIgYnJpY2sgPSBicmlja3NbaV07XG4gICAgICAgIHZhciBicmlja0NmZyA9IG5ldyBCcmlja0NvbmZpZygpO1xuICAgICAgICBicmlja0NmZy51bm1hcnNoYWwoYnJpY2spO1xuICAgICAgICB0aGlzLmJyaWNrcy5wdXNoKGJyaWNrQ2ZnKTtcbiAgICB9XG4gICAgdGhpcy5zdGFyVGltZSA9IDMgKiBqc29uT2JqW1wic3RhclRpbWVcIl0gfHwgMDtcbiAgICB0aGlzLmxhemVySW50ZXJ2YWwgPSBqc29uT2JqW1wibGF6ZXJJbnRlcnZhbFwiXSB8fCAzO1xuICAgIHRoaXMubm9uZUxhemVyQ291bnQgPSBqc29uT2JqW1wibm9uZUxhemVyQ291bnRcIl0gfHwgNTtcbiAgICB0aGlzLmNvbnRpbnVvdXNMYXplcnMgPSBqc29uT2JqW1wiY29udGludW91c0xhemVyc1wiXSB8fCBbMl07XG59O1xuXG5MZXZlbENvbmZpZy5wcm90b3R5cGUuZ2V0SGFyZENmZyA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgbGV2ZWxDZmcgPSBuZXcgTGV2ZWxDb25maWcoKTtcbiAgICBsZXZlbENmZy5saWZlUHJvYmFiaWxpdHkgPSB0aGlzLmxpZmVQcm9iYWJpbGl0eTtcbiAgICBsZXZlbENmZy5ib29zdFByb2JhYmlsaXR5ID0gdGhpcy5ib29zdFByb2JhYmlsaXR5ICogMC45O1xuICAgIGxldmVsQ2ZnLnBpeGVsV2lkdGggPSB0aGlzLnBpeGVsV2lkdGg7XG4gICAgbGV2ZWxDZmcucGl4ZWxIZWlnaHQgPSB0aGlzLnBpeGVsSGVpZ2h0O1xuICAgIGxldmVsQ2ZnLndpZHRoID0gdGhpcy53aWR0aCAqIDI7XG4gICAgbGV2ZWxDZmcuaGVpZ2h0ID0gdGhpcy5oZWlnaHQgKiAyO1xuICAgIGxldmVsQ2ZnLm9ic3RhY2xlcyA9IFtdO1xuICAgIGxldmVsQ2ZnLmJyaWNrcyA9IFtdO1xuICAgIGxldmVsQ2ZnLnN0YXJUaW1lID0gdGhpcy5zdGFyVGltZSAqIDEuMjtcbiAgICB2YXIgaTtcbiAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5vYnN0YWNsZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgbGV2ZWxDZmcub2JzdGFjbGVzLnB1c2godGhpcy5vYnN0YWNsZXNbaV0uZ2V0SGFyZENmZygpKTtcbiAgICB9XG4gICAgZm9yIChpID0gMDsgaSA8IHRoaXMuYnJpY2tzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgIGxldmVsQ2ZnLmJyaWNrcy5wdXNoKHRoaXMuYnJpY2tzW2ldLmdldEhhcmRDZmcoKSk7XG4gICAgfVxuICAgIHJldHVybiBsZXZlbENmZztcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gTGV2ZWxDb25maWc7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMjAxNy8xMi8xNS5cbiAqL1xudmFyIEJvb3N0VHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL0Jvb3N0VHlwZVwiKTtcblxudmFyIFJld2FyZENvbmZpZyA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnR5cGUgPSAwO1xuICAgIHRoaXMuY291bnQgPSBcIlwiO1xuICAgIHRoaXMucGFyYW0xID0gbnVsbDtcbiAgICB0aGlzLmltYWdlID0gXCJcIjtcbn07XG5cblJld2FyZENvbmZpZy5wcm90b3R5cGUudW5tYXJzaGFsID0gZnVuY3Rpb24gKGpzb25PYmopIHtcbiAgICB0aGlzLnR5cGUgPSBqc29uT2JqW1widHlwZVwiXTtcbiAgICB0aGlzLmNvdW50ID0ganNvbk9ialtcImNvdW50XCJdIHx8IDE7XG4gICAgdGhpcy5wYXJhbTEgPSBqc29uT2JqW1wicGFyYW0xXCJdO1xuICAgIHRoaXMuaW1hZ2UgPSBSZXdhcmRDb25maWcuZ2V0SW1hZ2UodGhpcyk7XG59O1xuXG5SZXdhcmRDb25maWcuZ2V0SW1hZ2UgPSBmdW5jdGlvbiAoY2ZnKSB7XG4gICAgc3dpdGNoIChjZmcudHlwZSkge1xuICAgICAgICBjYXNlIEJvb3N0VHlwZS5TUExJVDpcbiAgICAgICAgICAgIHJldHVybiBcInN0b3JlXzNfbXVsdGlwbGUucG5nXCI7XG4gICAgICAgIGNhc2UgQm9vc3RUeXBlLlRIUkVFX0JBTEw6XG4gICAgICAgICAgICByZXR1cm4gXCJzdG9yZV8zX25ldy5wbmdcIjtcbiAgICAgICAgY2FzZSBCb29zdFR5cGUuRElBTU9ORDpcbiAgICAgICAgICAgIHJldHVybiBcImljb25fZGlhbW9uZC5wbmdcIjtcbiAgICAgICAgY2FzZSBCb29zdFR5cGUuQUlNX0lURU06XG4gICAgICAgICAgICByZXR1cm4gXCJzdG9yZV9haW0ucG5nXCI7XG4gICAgICAgIGNhc2UgQm9vc3RUeXBlLlNLSU46XG4gICAgICAgICAgICByZXR1cm4gXCJza2luX1wiICsgY2ZnLnBhcmFtMSArIFwiLnBuZ1wiO1xuICAgICAgICBjYXNlIEJvb3N0VHlwZS5CT0FSRF9TS0lOOlxuICAgICAgICAgICAgcmV0dXJuIFwiaWNvbl9ib2FyZF9cIiArIGNmZy5wYXJhbTEgKyBcIi5wbmdcIjtcbiAgICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFJld2FyZENvbmZpZztcblxuIiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMjAxNy8xMi8xNS5cbiAqL1xuXG52YXIgU2hhcmVDb25maWcgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5pZCA9IDA7XG4gICAgdGhpcy5pbWFnZSA9IFwiXCI7XG4gICAgdGhpcy5kZXNjID0gXCJcIjtcbn07XG5cblNoYXJlQ29uZmlnLnByb3RvdHlwZS51bm1hcnNoYWwgPSBmdW5jdGlvbiAoanNvbk9iaikge1xuICAgIHRoaXMuaWQgPSBqc29uT2JqW1wiaWRcIl07XG4gICAgdGhpcy5pbWFnZSA9IGpzb25PYmpbXCJpbWFnZVwiXTtcbiAgICB0aGlzLmRlc2MgPSBqc29uT2JqW1wiZGVzY1wiXTtcbn07XG5cblNoYXJlQ29uZmlnLnByb3RvdHlwZS5jb3B5ID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBjb25maWcgPSBuZXcgU2hhcmVDb25maWcoKTtcbiAgICBjb25maWcuaWQgPSB0aGlzLmlkO1xuICAgIGNvbmZpZy5pbWFnZSA9IHRoaXMuaW1hZ2U7XG4gICAgY29uZmlnLmRlc2MgPSB0aGlzLmRlc2M7XG4gICAgcmV0dXJuIGNvbmZpZztcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gU2hhcmVDb25maWc7XG5cbiIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDIwMTcvMTIvMTUuXG4gKi9cblxudmFyIFNraW5Db25maWcgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5pZCA9IDA7XG4gICAgdGhpcy5jb3VudCA9IFwiXCI7XG4gICAgdGhpcy5pbWFnZSA9IDA7XG4gICAgdGhpcy5zY2FsZSA9IDE7XG4gICAgdGhpcy50eXBlID0gMDtcblxuICAgIHRoaXMuZXh0cmEgPSBudWxsO1xufTtcblxuU2tpbkNvbmZpZy5wcm90b3R5cGUudW5tYXJzaGFsID0gZnVuY3Rpb24gKGpzb25PYmopIHtcbiAgICB0aGlzLmlkID0ganNvbk9ialtcImlkXCJdO1xuICAgIHRoaXMuY291bnQgPSBqc29uT2JqW1wiY291bnRcIl07XG4gICAgdGhpcy5pbWFnZSA9IGpzb25PYmpbXCJpbWFnZVwiXTtcbiAgICB0aGlzLnNjYWxlID0ganNvbk9ialtcInNjYWxlXCJdIHx8IDE7XG4gICAgdGhpcy50eXBlID0ganNvbk9ialtcInR5cGVcIl0gfHwgMjtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gU2tpbkNvbmZpZztcblxuIiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMjAxNy8xMi8xNS5cbiAqL1xuXG52YXIgU3RvcmVDb25maWcgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5pZCA9IDA7XG4gICAgdGhpcy50eXBlID0gMDtcbiAgICB0aGlzLm5hbWUgPSBcIlwiO1xuICAgIHRoaXMucHJpY2UgPSAwO1xuICAgIHRoaXMuY291bnQgPSAxO1xuICAgIHRoaXMuaW1hZ2UgPSBcIlwiO1xuICAgIHRoaXMucGlkID0gXCJcIjtcbiAgICB0aGlzLmtleSA9IFwiXCI7XG4gICAgdGhpcy5ob3QgPSBmYWxzZTtcbiAgICB0aGlzLmJlc3QgPSBmYWxzZTtcbiAgICB0aGlzLmRhdGEgPSBudWxsO1xuICAgIHRoaXMub3JpZ2luYWxfcHJpY2UgPSAwO1xuICAgIHRoaXMuZGlzY291bnRfbXVsdGkgPSAwO1xuICAgIHRoaXMuZXh0cmEgPSAwO1xuICAgIHRoaXMucHJpY2VVUyA9IDA7XG59O1xuXG5TdG9yZUNvbmZpZy5wcm90b3R5cGUudW5tYXJzaGFsID0gZnVuY3Rpb24gKGpzb25PYmopIHtcbiAgICB0aGlzLmlkID0ganNvbk9ialtcImlkXCJdO1xuICAgIHRoaXMudHlwZSA9IGpzb25PYmpbXCJ0eXBlXCJdO1xuICAgIHRoaXMubmFtZSA9IGpzb25PYmpbXCJuYW1lXCJdO1xuICAgIHRoaXMucHJpY2UgPSBqc29uT2JqW1wicHJpY2VcIl07XG4gICAgdGhpcy5jb3VudCA9IGpzb25PYmpbXCJjb3VudFwiXTtcbiAgICB0aGlzLmltYWdlID0ganNvbk9ialtcImltYWdlXCJdO1xuICAgIHRoaXMucGlkID0ganNvbk9ialtcInBpZFwiXTtcbiAgICBpZiAoY2Muc3lzLm9zID09PSBjYy5zeXMuT1NfQU5EUk9JRCkge1xuICAgICAgICB0aGlzLnBpZCA9IGpzb25PYmpbXCJwaWRfZ3BcIl07XG4gICAgfVxuICAgIHRoaXMua2V5ID0ganNvbk9ialtcImtleVwiXTtcbiAgICB0aGlzLmhvdCA9IGpzb25PYmpbXCJob3RcIl07XG4gICAgdGhpcy5iZXN0ID0ganNvbk9ialtcImJlc3RcIl07XG4gICAgdGhpcy5kYXRhID0ganNvbk9ialtcImRhdGFcIl0gfHwge307XG4gICAgdGhpcy5vcmlnaW5hbF9wcmljZSA9IGpzb25PYmpbXCJvcmlnaW5hbF9wcmljZVwiXTtcbiAgICB0aGlzLmRpc2NvdW50X211bHRpID0ganNvbk9ialtcImRpc2NvdW50X211bHRpXCJdO1xuICAgIHRoaXMuZXh0cmEgPSBqc29uT2JqW1wiZXh0cmFcIl0gfHwgMDtcbiAgICB0aGlzLnByaWNlVVMgPSBwYXJzZUZsb2F0KHRoaXMucHJpY2Uuc3Vic3RyKDEpKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gU3RvcmVDb25maWc7XG5cbiIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDIwMTcvMTIvMTUuXG4gKi9cblxudmFyIFRhc2tDb25maWcgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5pZCA9IDA7XG4gICAgdGhpcy50eXBlID0gMDtcbiAgICB0aGlzLmNvdW50ID0gXCJcIjtcbiAgICB0aGlzLnJld2FyZENvdW50ID0gMDtcbiAgICB0aGlzLm5hbWUgPSBcIlwiO1xufTtcblxuVGFza0NvbmZpZy5wcm90b3R5cGUudW5tYXJzaGFsID0gZnVuY3Rpb24gKGpzb25PYmopIHtcbiAgICB0aGlzLmlkID0ganNvbk9ialtcImlkXCJdO1xuICAgIHRoaXMudHlwZSA9IGpzb25PYmpbXCJ0eXBlXCJdO1xuICAgIHRoaXMuY291bnQgPSBqc29uT2JqW1wiY291bnRcIl07XG4gICAgdGhpcy5yZXdhcmRDb3VudCA9IGpzb25PYmpbXCJyZXdhcmRDb3VudFwiXTtcbiAgICB0aGlzLm5hbWUgPSBqc29uT2JqW1wibmFtZVwiXTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gVGFza0NvbmZpZztcblxuIiwiXG4vKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAyMDE3LzEyLzE1LlxuICovXG5cbnZhciBUYXNrT2xkQ29uZmlnID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuaWQgPSAwO1xuICAgIHRoaXMuY291bnQgPSBcIlwiO1xuICAgIHRoaXMuaW1hZ2UgPSAwO1xuICAgIHRoaXMuc2NhbGUgPSAxO1xuICAgIHRoaXMudHlwZSA9IDA7XG59O1xuXG5UYXNrT2xkQ29uZmlnLnByb3RvdHlwZS51bm1hcnNoYWwgPSBmdW5jdGlvbiAoanNvbk9iaikge1xuICAgIHRoaXMuaWQgPSBqc29uT2JqW1wiaWRcIl07XG4gICAgdGhpcy50eXBlID0ganNvbk9ialtcInR5cGVcIl07XG4gICAgdGhpcy5jb3VudCA9IGpzb25PYmpbXCJjb3VudFwiXTtcbiAgICB0aGlzLmltYWdlID0ganNvbk9ialtcImltYWdlXCJdO1xuICAgIHRoaXMuc2NhbGUgPSBqc29uT2JqW1wic2NhbGVcIl0gfHwgMTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gVGFza09sZENvbmZpZztcblxuIiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMjAxNy8xMi8xNS5cbiAqL1xuXG52YXIgV2hlZWxDb25maWcgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5pZCA9IDA7XG4gICAgdGhpcy50eXBlID0gMDtcbiAgICB0aGlzLmNvdW50ID0gMDtcbiAgICB0aGlzLnByb2JhYmlsaXR5ID0gMDtcbiAgICB0aGlzLmltYWdlID0gXCJcIjtcbiAgICB0aGlzLnNjYWxlID0gMTtcbn07XG5cbldoZWVsQ29uZmlnLnByb3RvdHlwZS51bm1hcnNoYWwgPSBmdW5jdGlvbiAoanNvbk9iaikge1xuICAgIHRoaXMuaWQgPSBqc29uT2JqW1wiaWRcIl07XG4gICAgdGhpcy50eXBlID0ganNvbk9ialtcInR5cGVcIl07XG4gICAgdGhpcy5jb3VudCA9IGpzb25PYmpbXCJjb3VudFwiXTtcbiAgICB0aGlzLnByb2JhYmlsaXR5ID0ganNvbk9ialtcInByb2JhYmlsaXR5XCJdO1xuICAgIHRoaXMuaW1hZ2UgPSBqc29uT2JqW1wiaW1hZ2VcIl07XG4gICAgdGhpcy5zY2FsZSA9IGpzb25PYmpbXCJzY2FsZVwiXSB8fCAxO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBXaGVlbENvbmZpZztcblxuIiwidmFyIEFjdGl2aXR5VGFza0l0ZW1Db250cm9sbGVyID0gcmVxdWlyZShcIi4vQWN0aXZpdHlUYXNrSXRlbUNvbnRyb2xsZXJcIik7XG52YXIgQ29uZmlnTWFuID0gcmVxdWlyZShcIi4uL2NvbmZpZy9Db25maWdNYW5cIik7XG52YXIgRXZlbnRzTmFtZSA9IHJlcXVpcmUoXCIuLi9ldmVudHMvRXZlbnRzTmFtZVwiKTtcbnZhciBNdWx0aUNvbFRhYmxlVmlldyA9IHJlcXVpcmUoXCIuLi8uLi9jb21tb24vZXh0L011bHRpQ29sVGFibGVWaWV3XCIpO1xudmFyIEFjdGl2aXR5VGFza1Jld2FyZEl0ZW1Db250cm9sbGVyID0gcmVxdWlyZShcIi4vQWN0aXZpdHlUYXNrUmV3YXJkSXRlbUNvbnRyb2xsZXJcIik7XG5cbnZhciBHUklEX1NJWkUgPSBjYy5zaXplKDU0MCwgMTIwKTtcblxudmFyIFN0b3JlSXRlbUNlbGxWaWV3ID0gY2MuVGFibGVWaWV3Q2VsbC5leHRlbmQoe1xuICAgIGVudGl0eTogbnVsbCxcbiAgICBpdGVtTm9kZTogbnVsbCxcbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICAgIHRoaXMuaXRlbU5vZGUgPSBBY3Rpdml0eVRhc2tJdGVtQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG4gICAgICAgIHRoaXMuYWRkQ2hpbGQodGhpcy5pdGVtTm9kZSk7XG4gICAgICAgIHRoaXMuaXRlbU5vZGUuc2V0UG9zaXRpb24oY2MucChHUklEX1NJWkUud2lkdGggKiAwLjUsIEdSSURfU0laRS5oZWlnaHQgKiAwLjUpKTtcbiAgICB9LFxuXG4gICAgaW5pdFdpdGg6IGZ1bmN0aW9uIChlbnRpdHksIGlkeCkge1xuICAgICAgICB0aGlzLmVudGl0eSA9IGVudGl0eTtcbiAgICAgICAgdGhpcy5pdGVtTm9kZS5jb250cm9sbGVyLmluaXRXaXRoKGVudGl0eSwgaWR4KTtcbiAgICB9XG59KTtcblxudmFyIEFjdGl2aXR5VGFza0NvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcblxuICAgIHRoaXMuUkVXQVJEX1NUQVJUX1RBRyA9IDEwMDtcbiAgICB0aGlzLlJFV0FSRF9DT1VOVCA9IDU7XG5cbiAgICB0aGlzLm5kUmV3YXJkQ29udGFpbmVyICA9IG51bGw7XG5cbiAgICB0aGlzLm5kQ29udGFpbmVyID0gbnVsbDtcblxuICAgIHRoaXMubGJsVGl0bGUgPSBudWxsO1xuXG4gICAgdGhpcy5zcFByb2dyZXNzID0gbnVsbDtcblxuICAgIHRoaXMuYm90dG9tUHJvZ3Jlc3MgPSBudWxsO1xuXG4gICAgdGhpcy5sYkxlZnRUaW1lID0gbnVsbDtcblxuICAgIHRoaXMuX3RhYmxlVmlldyA9IG51bGw7XG5cbiAgICAvL3VzZXIgZGF0YS5cbiAgICB0aGlzLmNvbmZpZ3MgPSBudWxsO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhBY3Rpdml0eVRhc2tDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbkFjdGl2aXR5VGFza0NvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIuY2FsbCh0aGlzKTtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5hZGRFdmVudExpc3RlbmVyKEV2ZW50c05hbWUuVVBEQVRFX0FDVElWSVRZX1RBU0tfU0NPUkUsIHRoaXMub25VcGRhdGVBY3Rpdml0eVRhc2tTY29yZSwgdGhpcyk7XG4gICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuYWRkRXZlbnRMaXN0ZW5lcihFdmVudHNOYW1lLkNMT1NFX0FDVElWSVRZX1RBU0ssIHRoaXMuY2xvc2UsIHRoaXMpO1xuICAgIHRoaXMuaW50ZXJ2YWxLZXkgPSBzZXRJbnRlcnZhbCh0aGlzLm9uVXBkYXRlLmJpbmQodGhpcyksIDEwMDApO1xuXG59O1xuXG5BY3Rpdml0eVRhc2tDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsS2V5KTtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5yZW1vdmVFdmVudExpc3RlbmVyKEV2ZW50c05hbWUuVVBEQVRFX0FDVElWSVRZX1RBU0tfU0NPUkUsIHRoaXMub25VcGRhdGVBY3Rpdml0eVRhc2tTY29yZSwgdGhpcyk7XG4gICAgZ2FtZS5ldmVudERpc3BhdGNoZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihFdmVudHNOYW1lLkNMT1NFX0FDVElWSVRZX1RBU0ssIHRoaXMuY2xvc2UsIHRoaXMpO1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQuY2FsbCh0aGlzKTtcbn07XG5cbkFjdGl2aXR5VGFza0NvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcblxuICAgIHZhciByZXdhcmRzID0gQ29uZmlnTWFuLmdldEluc3RhbmNlKCkuZ2V0QWN0aXZpdHlUYXNrUmV3YXJkcygpO1xuICAgIHZhciB0b3RhbExpbWl0ID0gZ2FtZS5hY3Rpdml0eU1hbi5nZXRUb3RhbEFjdGl2aXR5VGFza0xpbWl0Q291bnQoKTtcbiAgICB0aGlzLnJld2FyZE5vZGVzID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLlJFV0FSRF9DT1VOVDsgKytpKSB7XG4gICAgICAgIHZhciB0YWcgPSB0aGlzLlJFV0FSRF9TVEFSVF9UQUcgKyBpO1xuICAgICAgICBjYy5sb2coXCJ0YWc6XCIgKyB0YWcpO1xuICAgICAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMuc2Vla05vZGVCeVRhZyh0aGlzLm5kUmV3YXJkQ29udGFpbmVyLCB0YWcpO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIuaW5pdFdpdGgocmV3YXJkc1tpXSwgaSk7XG4gICAgICAgIHRoaXMucmV3YXJkTm9kZXMucHVzaChub2RlKTtcbiAgICAgICAgbm9kZS54ID0gcmV3YXJkc1tpXS5zY29yZSAvIHRvdGFsTGltaXQgKiB0aGlzLm5kUmV3YXJkQ29udGFpbmVyLndpZHRoO1xuICAgIH1cblxuICAgIHRoaXMuY29uZmlncyA9IENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldEFjdGl2aXR5VGFza0xpc3QoKTtcbiAgICB0aGlzLm9uVXBkYXRlQWN0aXZpdHlUYXNrU2NvcmUoKTtcbiAgICB0aGlzLnVwZGF0ZVRpbWUoKTtcbn07XG5cbkFjdGl2aXR5VGFza0NvbnRyb2xsZXIucHJvdG90eXBlLmluaXRXaXRoID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gY2FsbGJhY2s7XG59O1xuXG5BY3Rpdml0eVRhc2tDb250cm9sbGVyLnByb3RvdHlwZS5vblVwZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnVwZGF0ZVRpbWUoKTtcbn07XG5cbkFjdGl2aXR5VGFza0NvbnRyb2xsZXIucHJvdG90eXBlLnVwZGF0ZVRpbWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgY2MubG9nKFwiYWN0aXZpdHkgbGVmdCB0aW1lOlwiICsgZ2FtZS5hY3Rpdml0eU1hbi5nZXRBY3Rpdml0eUxlZnRUaW1lKCkpO1xuICAgIHRoaXMubGJMZWZ0VGltZS5zZXRTdHJpbmcoZ2FtZS51dGlscy5zcHJpbnRmKF8oXCJkYWlseV90YXNrX3RpcHNcIiksIGdhbWUudXRpbHMuZ2V0TG9uZ0Zvcm1hdFRpbWUoZ2FtZS5hY3Rpdml0eU1hbi5nZXRBY3Rpdml0eUxlZnRUaW1lKCkpKSk7XG59O1xuXG5BY3Rpdml0eVRhc2tDb250cm9sbGVyLnByb3RvdHlwZS5vblVwZGF0ZUFjdGl2aXR5VGFza1Njb3JlID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciB3aWR0aCA9IHRoaXMuYm90dG9tUHJvZ3Jlc3MuZ2V0UHJlZmVycmVkU2l6ZSgpLndpZHRoICogZ2FtZS5hY3Rpdml0eU1hbi5nZXRUb3RhbEFjdGl2aXR5VGFza1BlcmNlbnQoKTtcbiAgICB2YXIgaGVpZ2h0ID0gdGhpcy5zcFByb2dyZXNzLmdldFByZWZlcnJlZFNpemUoKS5oZWlnaHQ7XG4gICAgdGhpcy5zcFByb2dyZXNzLnNldFByZWZlcnJlZFNpemUoY2Muc2l6ZSh3aWR0aCwgaGVpZ2h0KSk7XG4gICAgdGhpcy5zaG93VGFibGVWaWV3KCk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnJld2FyZE5vZGVzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgIHRoaXMucmV3YXJkTm9kZXNbaV0uY29udHJvbGxlci5yZWZyZXNoKCk7XG4gICAgfVxufTtcblxuQWN0aXZpdHlUYXNrQ29udHJvbGxlci5wcm90b3R5cGUub25VcGRhdGVTa2luID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgdGhpcy5zaG93VGFibGVWaWV3KCk7XG59O1xuXG5BY3Rpdml0eVRhc2tDb250cm9sbGVyLnByb3RvdHlwZS5yZXdhcmRDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIC8vVE9ETyBwb3B1cCByZXdhcmRzIGFuZCBjbGFpbSBpdC5cbn07XG5cbkFjdGl2aXR5VGFza0NvbnRyb2xsZXIucHJvdG90eXBlLnNob3dUYWJsZVZpZXcgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCF0aGlzLl90YWJsZVZpZXcpIHtcbiAgICAgICAgdmFyIHNpemUgPSB0aGlzLm5kQ29udGFpbmVyLmdldENvbnRlbnRTaXplKCk7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldyA9IG5ldyBNdWx0aUNvbFRhYmxlVmlldyh0aGlzLCBzaXplLCBudWxsKTtcbiAgICAgICAgdGhpcy5fdGFibGVWaWV3LnNldERpcmVjdGlvbihjYy5TQ1JPTExWSUVXX0RJUkVDVElPTl9WRVJUSUNBTCk7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5zZXRWZXJ0aWNhbEZpbGxPcmRlcihjYy5UQUJMRVZJRVdfRklMTF9UT1BET1dOKTtcbiAgICAgICAgdGhpcy5fdGFibGVWaWV3LnNldE11bHRpVGFibGVWaWV3RGVsZWdhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5pZ25vcmVBbmNob3JQb2ludEZvclBvc2l0aW9uKGZhbHNlKTtcbiAgICAgICAgdGhpcy5fdGFibGVWaWV3LnNldEFuY2hvclBvaW50KGNjLnAoMCwgMCkpO1xuICAgICAgICB0aGlzLm5kQ29udGFpbmVyLmFkZENoaWxkKHRoaXMuX3RhYmxlVmlldyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5fb2Zmc2V0ID0gdGhpcy5fdGFibGVWaWV3LmdldENvbnRlbnRPZmZzZXQoKTtcbiAgICB9XG4gICAgdGhpcy5fdGFibGVWaWV3LnJlbG9hZERhdGEoKTtcbiAgICBpZiAodGhpcy5fb2Zmc2V0KSB7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5zZXRDb250ZW50T2Zmc2V0KHRoaXMuX29mZnNldCk7XG4gICAgICAgIHRoaXMuX29mZnNldCA9IG51bGw7XG4gICAgfVxufTtcblxuQWN0aXZpdHlUYXNrQ29udHJvbGxlci5wcm90b3R5cGUuc2Nyb2xsVmlld0RpZFNjcm9sbCA9IGZ1bmN0aW9uICh2aWV3KSB7XG59O1xuXG5BY3Rpdml0eVRhc2tDb250cm9sbGVyLnByb3RvdHlwZS5zY3JvbGxWaWV3RGlkWm9vbSA9IGZ1bmN0aW9uICh2aWV3KSB7XG59O1xuXG5BY3Rpdml0eVRhc2tDb250cm9sbGVyLnByb3RvdHlwZS5ncmlkQXRJbmRleCA9IGZ1bmN0aW9uKG11bHRpVGFibGUsICBpZHgpIHtcbiAgICB2YXIgY2VsbCA9IG11bHRpVGFibGUuZGVxdWV1ZUdyaWQoKTtcbiAgICBpZiAoIWNlbGwpIHtcbiAgICAgICAgY2VsbCA9IG5ldyBTdG9yZUl0ZW1DZWxsVmlldygpO1xuICAgIH1cblxuICAgIGlmIChpZHggPCB0aGlzLmNvbmZpZ3MubGVuZ3RoKSB7XG4gICAgICAgIHZhciBza2luQ2ZnID0gdGhpcy5jb25maWdzW2lkeF07XG4gICAgICAgIGNlbGwuaW5pdFdpdGgoc2tpbkNmZywgaWR4KTtcbiAgICAgICAgY2VsbC52aXNpYmxlID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBjZWxsLnZpc2libGUgPSBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gY2VsbDtcbn07XG5cbkFjdGl2aXR5VGFza0NvbnRyb2xsZXIucHJvdG90eXBlLm51bWJlck9mQ2VsbHNJblRhYmxlVmlldyA9IGZ1bmN0aW9uKG11bHRpVGFibGUpIHtcbiAgICB2YXIgZ3JpZHNJbkNlbGwgPSB0aGlzLm51bWJlck9mR3JpZHNJbkNlbGwobXVsdGlUYWJsZSk7XG4gICAgcmV0dXJuIE1hdGguY2VpbCh0aGlzLmNvbmZpZ3MubGVuZ3RoIC8gZ3JpZHNJbkNlbGwpO1xufTtcblxuQWN0aXZpdHlUYXNrQ29udHJvbGxlci5wcm90b3R5cGUubnVtYmVyT2ZHcmlkc0luQ2VsbCA9IGZ1bmN0aW9uKG11bHRpVGFibGUsIGNvbElkeCkge1xuICAgIHJldHVybiAxO1xufTtcblxuQWN0aXZpdHlUYXNrQ29udHJvbGxlci5wcm90b3R5cGUuZ3JpZFNpemVGb3JUYWJsZSA9IGZ1bmN0aW9uKHRhYmxlLCBjb2xJZHgpIHtcbiAgICByZXR1cm4gY2Muc2l6ZShHUklEX1NJWkUud2lkdGgsIEdSSURfU0laRS5oZWlnaHQpO1xufTtcblxuQWN0aXZpdHlUYXNrQ29udHJvbGxlci5wcm90b3R5cGUuZ3JpZFRvdWNoZWQgPSBmdW5jdGlvbih0YWJsZSwgZ3JpZCkge1xufTtcblxuQWN0aXZpdHlUYXNrQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2VDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuXG4gICAgdGhpcy5jbG9zZSgpO1xufTtcblxuQWN0aXZpdHlUYXNrQ29udHJvbGxlci5wcm90b3R5cGUucG9wdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLnBvcHVwKHRoaXMucm9vdE5vZGUsIHtwb3B1cEFuaW06IHRydWV9KTtcbn07XG5cbkFjdGl2aXR5VGFza0NvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5jbG9zZSh0aGlzLnJvb3ROb2RlKTtcbiAgICBpZiAodGhpcy5jbG9zZUNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuY2xvc2VDYWxsYmFjaygpO1xuICAgICAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBudWxsO1xuICAgIH1cbn07XG5cbkFjdGl2aXR5VGFza0NvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIGdhbWUudXRpbHMucmVnaXN0ZXJDb250cm9sbGVyKFwiQWN0aXZpdHlUYXNrUmV3YXJkSXRlbUNvbnRyb2xsZXJcIiwgbmV3IEFjdGl2aXR5VGFza1Jld2FyZEl0ZW1Db250cm9sbGVyKCkpO1xuICAgIHZhciBub2RlID0gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvYWN0aXZpdHkvY2hyaXN0bWFzX3ZpZXcuY2NiaVwiLCBudWxsLCBcIkFjdGl2aXR5VGFza0NvbnRyb2xsZXJcIiwgbmV3IEFjdGl2aXR5VGFza0NvbnRyb2xsZXIoKSk7XG4gICAgZ2FtZS51dGlscy51blJlZ2lzdGVyQ29udHJvbGxlcihcIkFjdGl2aXR5VGFza1Jld2FyZEl0ZW1Db250cm9sbGVyXCIpO1xuICAgIHJldHVybiBub2RlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBBY3Rpdml0eVRhc2tDb250cm9sbGVyOyIsIlxudmFyIEFjdGl2aXR5VGFza0VudHJhbmNlQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuXG4gICAgdGhpcy5sYkxlZnRUaW1lID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoQWN0aXZpdHlUYXNrRW50cmFuY2VDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbkFjdGl2aXR5VGFza0VudHJhbmNlQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlci5jYWxsKHRoaXMpO1xuICAgIHRoaXMuaW50ZXJ2YWxLZXkgPSBzZXRJbnRlcnZhbCh0aGlzLm9uVXBkYXRlLmJpbmQodGhpcyksIDEwMDApO1xufTtcblxuQWN0aXZpdHlUYXNrRW50cmFuY2VDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsS2V5KTtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0LmNhbGwodGhpcyk7XG59O1xuXG5BY3Rpdml0eVRhc2tFbnRyYW5jZUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcbiAgICB0aGlzLm9uVXBkYXRlKCk7XG59O1xuXG5BY3Rpdml0eVRhc2tFbnRyYW5jZUNvbnRyb2xsZXIucHJvdG90eXBlLmluaXRXaXRoID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gY2FsbGJhY2s7XG59O1xuXG5BY3Rpdml0eVRhc2tFbnRyYW5jZUNvbnRyb2xsZXIucHJvdG90eXBlLm9uVXBkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBsZWZ0VGltZSA9IGdhbWUuYWN0aXZpdHlNYW4uZ2V0QWN0aXZpdHlMZWZ0VGltZSgpO1xuICAgIGlmIChsZWZ0VGltZSA+IDApIHtcbiAgICAgICAgdGhpcy5sYkxlZnRUaW1lLnNldFN0cmluZyhnYW1lLnV0aWxzLmdldExldHRlclRpbWUobGVmdFRpbWUpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfVxufTtcblxuQWN0aXZpdHlUYXNrRW50cmFuY2VDb250cm9sbGVyLnByb3RvdHlwZS5wbGF5Q2xpY2tlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB0aGlzLmNsb3NlKCk7XG4gICAgZ2FtZS5wb3B1cE1hbi5wb3B1cEFjdGl2aXR5VGFzaygpO1xufTtcblxuQWN0aXZpdHlUYXNrRW50cmFuY2VDb250cm9sbGVyLnByb3RvdHlwZS5jbG9zZUNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG5cbiAgICB0aGlzLmNsb3NlKCk7XG59O1xuXG5BY3Rpdml0eVRhc2tFbnRyYW5jZUNvbnRyb2xsZXIucHJvdG90eXBlLnBvcHVwID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5wb3B1cCh0aGlzLnJvb3ROb2RlLCB7cG9wdXBBbmltOiB0cnVlfSk7XG59O1xuXG5BY3Rpdml0eVRhc2tFbnRyYW5jZUNvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5jbG9zZSh0aGlzLnJvb3ROb2RlKTtcbiAgICBpZiAodGhpcy5jbG9zZUNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuY2xvc2VDYWxsYmFjaygpO1xuICAgICAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBudWxsO1xuICAgIH1cbn07XG5cblxuQWN0aXZpdHlUYXNrRW50cmFuY2VDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL2FjdGl2aXR5L2NocmlzdG1hc19ub3RpY2Vfdmlldy5jY2JpXCIsIG51bGwsIFwiQWN0aXZpdHlUYXNrRW50cmFuY2VDb250cm9sbGVyXCIsIG5ldyBBY3Rpdml0eVRhc2tFbnRyYW5jZUNvbnRyb2xsZXIoKSk7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEFjdGl2aXR5VGFza0VudHJhbmNlQ29udHJvbGxlcjsiLCJ2YXIgU2tpblJld2FyZFR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9Ta2luUmV3YXJkVHlwZVwiKTtcbnZhciBFdmVudHNOYW1lID0gcmVxdWlyZShcIi4uL2V2ZW50cy9FdmVudHNOYW1lXCIpO1xudmFyIEJvb3N0VHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL0Jvb3N0VHlwZVwiKTtcbnZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcbnZhciBDb25maWdNYW4gPSByZXF1aXJlKFwiLi4vY29uZmlnL0NvbmZpZ01hblwiKTtcblxudmFyIEFjdGl2aXR5VGFza0l0ZW1Db250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG5cbiAgICB0aGlzLmxibERlc2MgPSBudWxsO1xuXG4gICAgdGhpcy5sYmxDb3VudERlc2MgPSBudWxsO1xuXG4gICAgdGhpcy5uZEdvID0gbnVsbDtcbiAgICB0aGlzLm5kQ29tcGxldGVkID0gbnVsbDtcblxuICAgIHRoaXMuc3BQcm9ncmVzcyA9IG51bGw7XG4gICAgdGhpcy5ib3R0b21Qcm9ncmVzcyA9IG51bGw7XG4gICAgLy8gdGhpcy5wdFByb2dyZXNzID0gbnVsbDtcblxuICAgIHRoaXMuaWR4ID0gMDtcbiAgICB0aGlzLmRhdGEgPSBudWxsO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhBY3Rpdml0eVRhc2tJdGVtQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5BY3Rpdml0eVRhc2tJdGVtQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuICAgIC8vIHRoaXMucHRQcm9ncmVzcyA9IGdhbWUudXRpbHMuY3JlYXRlUHJvZ3Jlc3NUaW1lcih0aGlzLnNwUHJvZ3Jlc3MsIHRydWUsIGZhbHNlKTtcbn07XG4vKipcbiAqIEBwYXJhbSB7VGFza0NvbmZpZ30gZGF0YVxuICogQHBhcmFtIHtudW1iZXJ9IGlkeFxuICovXG5BY3Rpdml0eVRhc2tJdGVtQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdFdpdGggPSBmdW5jdGlvbiAoZGF0YSwgaWR4KSB7XG4gICAgdGhpcy5pZHggPSBpZHg7XG4gICAgdGhpcy5kYXRhID0gZGF0YTtcbiAgICB0aGlzLnJlZnJlc2goKTtcbn07XG5cbkFjdGl2aXR5VGFza0l0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5yZWZyZXNoID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBkYXRhID0gdGhpcy5kYXRhO1xuXG4gICAgdmFyIGNvbmZpZyA9IENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldEFjdGl2aXR5VGFza0NvbmZpZyhkYXRhLnR5cGUpO1xuICAgIHZhciBjdXJyZW50Q291bnQgPSBnYW1lLmFjdGl2aXR5TWFuLmdldEFjdGl2aXR5VGFza0NvdW50KGRhdGEudHlwZSk7XG4gICAgdmFyIGNvbXBsZXRlZCA9IGN1cnJlbnRDb3VudCA+PSBjb25maWcubGltaXQ7XG4gICAgdmFyIHBlcmNlbnQgPSBNYXRoLm1pbigxLCBjdXJyZW50Q291bnQgLyBjb25maWcubGltaXQpO1xuXG4gICAgdGhpcy5zcFByb2dyZXNzLnNldFByZWZlcnJlZFNpemUoY2Muc2l6ZSh0aGlzLmJvdHRvbVByb2dyZXNzLmdldFByZWZlcnJlZFNpemUoKS53aWR0aCAqIHBlcmNlbnQsIHRoaXMuc3BQcm9ncmVzcy5nZXRQcmVmZXJyZWRTaXplKCkuaGVpZ2h0KSk7XG4gICAgaWYgKGN1cnJlbnRDb3VudCA+IGNvbmZpZy5saW1pdCkge1xuICAgICAgICBjdXJyZW50Q291bnQgPSBjb25maWcubGltaXQ7XG4gICAgfVxuICAgIHRoaXMubGJsQ291bnREZXNjLnNldFN0cmluZyhjdXJyZW50Q291bnQgKyBcIi9cIiArIGNvbmZpZy5saW1pdCk7XG5cbiAgICB0aGlzLm5kR28udmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMubmRDb21wbGV0ZWQudmlzaWJsZSA9IGZhbHNlO1xuXG4gICAgaWYgKGNvbXBsZXRlZCkge1xuICAgICAgICB0aGlzLm5kQ29tcGxldGVkLnZpc2libGUgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubmRHby52aXNpYmxlID0gdHJ1ZTtcbiAgICB9XG5cbiAgICB0aGlzLmxibERlc2Muc2V0U3RyaW5nKF8oZGF0YS5uYW1lKSk7XG59O1xuXG5BY3Rpdml0eVRhc2tJdGVtQ29udHJvbGxlci5wcm90b3R5cGUuZ29DbGlja2VkID0gZnVuY3Rpb24gKCkge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuXG4gICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChFdmVudHNOYW1lLkNMT1NFX0FDVElWSVRZX1RBU0spO1xuXG4gICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiRGFpbHlUYXNrR29DbGlja1wiLCB7XCJ0eXBlXCI6IGdhbWUuYWN0aXZpdHlUYXNrVHlwZS5nZXROYW1lKHRoaXMuZGF0YS50eXBlKX0pO1xuXG4gICAgc3dpdGNoICh0aGlzLmRhdGEudHlwZSkge1xuICAgICAgICBjYXNlIGdhbWUuYWN0aXZpdHlUYXNrVHlwZS5XaGVlbDpcbiAgICAgICAgICAgIHZhciBXaGVlbFR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9XaGVlbFR5cGVcIik7XG4gICAgICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwV2hlZWxEbGcoV2hlZWxUeXBlLkRhaWx5Qm9udXMpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgZ2FtZS5hY3Rpdml0eVRhc2tUeXBlLlVzZUJvb3N0OlxuICAgICAgICBjYXNlIGdhbWUuYWN0aXZpdHlUYXNrVHlwZS5MZXZlbDpcbiAgICAgICAgY2FzZSBnYW1lLmFjdGl2aXR5VGFza1R5cGUuT3BlbkJveDpcbiAgICAgICAgY2FzZSBnYW1lLmFjdGl2aXR5VGFza1R5cGUuQ2hlc3RPcGVuOlxuICAgICAgICAgICAgZ2FtZS5nYW1lTWFuLmlzQ2hhbGxlbmdlTGV2ZWwgPSBmYWxzZTtcbiAgICAgICAgICAgIGdhbWUuZ2FtZU1hbi5zZXRIYXJkTW9kZShmYWxzZSk7XG4gICAgICAgICAgICBnYW1lLmdhbWVNYW4uc2V0TmV3SGFyZE1vZGUoZmFsc2UpO1xuICAgICAgICAgICAgaWYgKGdhbWUuZ2FtZU1hbi5jaG9vc2VMYXRlc3RMZXZlbCgpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucGxheWVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGdhbWUuc2NlbmVNYW4uc3dpdGNoU2NlbmUoZ2FtZS5zY2VuZVR5cGUuR0FNRSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBDb21tb25EbGcoXyhcImFsbF9jb21wbGV0ZWRcIikpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgZ2FtZS5hY3Rpdml0eVRhc2tUeXBlLkNoYWxsZW5nZUxldmVsOlxuICAgICAgICAgICAgZ2FtZS5nYW1lTWFuLmlzQ2hhbGxlbmdlTGV2ZWwgPSB0cnVlO1xuICAgICAgICAgICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5DSEFMTEVOR0VfTElTVCk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgIH1cbn07XG5cbkFjdGl2aXR5VGFza0l0ZW1Db250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvYWN0aXZpdHkvY2hyaXN0bWFzX2l0ZW1fdmlldy5jY2JpXCIsIG51bGwsIFwiQWN0aXZpdHlUYXNrSXRlbUNvbnRyb2xsZXJcIiwgbmV3IEFjdGl2aXR5VGFza0l0ZW1Db250cm9sbGVyKCkpO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBBY3Rpdml0eVRhc2tJdGVtQ29udHJvbGxlcjsiLCJ2YXIgU2tpblJld2FyZFR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9Ta2luUmV3YXJkVHlwZVwiKTtcbnZhciBFdmVudHNOYW1lID0gcmVxdWlyZShcIi4uL2V2ZW50cy9FdmVudHNOYW1lXCIpO1xudmFyIEJvb3N0VHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL0Jvb3N0VHlwZVwiKTtcbnZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcbnZhciBDb25maWdNYW4gPSByZXF1aXJlKFwiLi4vY29uZmlnL0NvbmZpZ01hblwiKTtcblxudmFyIEFjdGl2aXR5VGFza1Jld2FyZEl0ZW1Db250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG5cbiAgICB0aGlzLm5kUmV3YXJkID0gbnVsbDtcbiAgICB0aGlzLnNwUmV3YXJkQmlnID0gbnVsbDtcblxuICAgIHRoaXMuc3BSZXdhcmQgPSBudWxsO1xuICAgIHRoaXMubGJSZXdhcmQgPSBudWxsO1xuXG4gICAgdGhpcy5sYlNjb3JlID0gbnVsbDtcblxuICAgIHRoaXMuc3BVbkNvbXBsZXRlZCA9IG51bGw7XG4gICAgdGhpcy5zcENvbXBsZXRlZCA9IG51bGw7XG5cbiAgICB0aGlzLnNwR3JheU1hc2sgPSBudWxsO1xuXG4gICAgdGhpcy5pZHggPSAwO1xuICAgIHRoaXMuZGF0YSA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKEFjdGl2aXR5VGFza1Jld2FyZEl0ZW1Db250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbkFjdGl2aXR5VGFza1Jld2FyZEl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG59O1xuLyoqXG4gKiBAcGFyYW0ge1Rhc2tDb25maWd9IGRhdGFcbiAqIEBwYXJhbSB7bnVtYmVyfSBpZHhcbiAqL1xuQWN0aXZpdHlUYXNrUmV3YXJkSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLmluaXRXaXRoID0gZnVuY3Rpb24gKGRhdGEsIGlkeCkge1xuICAgIHRoaXMuaWR4ID0gaWR4O1xuICAgIHRoaXMuZGF0YSA9IGRhdGE7XG4gICAgdGhpcy5yZWZyZXNoKCk7XG59O1xuXG5BY3Rpdml0eVRhc2tSZXdhcmRJdGVtQ29udHJvbGxlci5wcm90b3R5cGUucmVmcmVzaCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTtcblxuICAgIHZhciBjb21wbGV0ZWQgPSBnYW1lLmFjdGl2aXR5TWFuLmlzQWN0aXZpdHlUYXNrQ29tcGxldGVkKGRhdGEpO1xuXG4gICAgdGhpcy5zcFVuQ29tcGxldGVkLnZpc2libGUgPSAhY29tcGxldGVkO1xuICAgIHRoaXMuc3BDb21wbGV0ZWQudmlzaWJsZSA9IGNvbXBsZXRlZDtcblxuICAgIHRoaXMubmRSZXdhcmQudmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMuc3BSZXdhcmRCaWcudmlzaWJsZSA9IGZhbHNlO1xuICAgIGlmIChkYXRhLnR5cGUgPT09IEJvb3N0VHlwZS5ESUFNT05EKSB7XG4gICAgICAgIHRoaXMubmRSZXdhcmQudmlzaWJsZSA9IHRydWU7XG4gICAgICAgIHRoaXMubGJSZXdhcmQuc2V0U3RyaW5nKFwiK1wiICsgZGF0YS5jb3VudCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zcFJld2FyZEJpZy52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zcFJld2FyZEJpZy5zZXRTcHJpdGVGcmFtZShjYy5zcHJpdGVGcmFtZUNhY2hlLmdldFNwcml0ZUZyYW1lKGRhdGEuaW1hZ2UpKTtcbiAgICAgICAgdGhpcy5zcFJld2FyZEJpZy5zZXRTY2FsZShkYXRhLnNjYWxlKTtcbiAgICB9XG5cbiAgICAvLyB0aGlzLmxiU2NvcmUuc2V0U3RyaW5nKFwiXCIgKyBkYXRhLnNjb3JlKTtcblxuICAgIGlmICh0aGlzLmNhbkNsYWltUmV3YXJkKCkpIHtcbiAgICAgICAgZ2FtZS51dGlscy5wbGF5Q0NCQW5pbWF0aW9uKHRoaXMucm9vdE5vZGUsIFwicmV3YXJkXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGdhbWUudXRpbHMucGxheUNDQkFuaW1hdGlvbih0aGlzLnJvb3ROb2RlLCBcIm5vcm1hbFwiKTtcbiAgICB9XG5cbiAgICB0aGlzLnNwR3JheU1hc2sudmlzaWJsZSA9IGdhbWUuYWN0aXZpdHlNYW4uaXNSZXdhcmRDbGFpbWVkKGRhdGEpO1xufTtcblxuQWN0aXZpdHlUYXNrUmV3YXJkSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLmNhbkNsYWltUmV3YXJkID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBnYW1lLmFjdGl2aXR5TWFuLmNhbkNsYWltUmV3YXJkKHRoaXMuZGF0YSk7XG59O1xuXG5BY3Rpdml0eVRhc2tSZXdhcmRJdGVtQ29udHJvbGxlci5wcm90b3R5cGUucmV3YXJkQ2xpY2tlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAodGhpcy5jYW5DbGFpbVJld2FyZCgpKSB7XG4gICAgICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgICAgICBnYW1lLmFjdGl2aXR5TWFuLmNsYWltQWN0aXZpdHlUYXNrUmV3YXJkKHRoaXMuZGF0YSk7XG4gICAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBBY3Rpdml0eVRhc2tSZXdhcmRJdGVtQ29udHJvbGxlcjsiLCJ2YXIgRXZlbnRzTmFtZSA9IHJlcXVpcmUoXCIuLi9ldmVudHMvRXZlbnRzTmFtZVwiKTtcblxudmFyIEFjdGl2aXR5VGFza1RpcHNDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG5cbiAgICB0aGlzLnNwUmV3YXJkID0gbnVsbDtcbiAgICB0aGlzLnNwUHJvZ3Jlc3MgPSBudWxsO1xuICAgIHRoaXMubGJTY29yZSA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKEFjdGl2aXR5VGFza1RpcHNDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbkFjdGl2aXR5VGFza1RpcHNDb250cm9sbGVyLnByb3RvdHlwZS5vbkVudGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkVudGVyLmNhbGwodGhpcyk7XG4gICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuYWRkRXZlbnRMaXN0ZW5lcihFdmVudHNOYW1lLlVQREFURV9BQ1RJVklUWV9UQVNLX1NDT1JFLCB0aGlzLm9uVXBkYXRlUHJvZ3Jlc3MsIHRoaXMpO1xufTtcblxuQWN0aXZpdHlUYXNrVGlwc0NvbnRyb2xsZXIucHJvdG90eXBlLm9uRXhpdCA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5yZW1vdmVFdmVudExpc3RlbmVyKEV2ZW50c05hbWUuVVBEQVRFX0FDVElWSVRZX1RBU0tfU0NPUkUsIHRoaXMub25VcGRhdGVQcm9ncmVzcywgdGhpcyk7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRXhpdC5jYWxsKHRoaXMpO1xufTtcblxuQWN0aXZpdHlUYXNrVGlwc0NvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcbiAgICBpZiAoIWdhbWUuYWN0aXZpdHlNYW4uaXNPcGVuKCkpIHtcbiAgICAgICAgdGhpcy5yb290Tm9kZS52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5wdFByb2dyZXNzID0gZ2FtZS51dGlscy5jcmVhdGVQcm9ncmVzc1RpbWVyKHRoaXMuc3BQcm9ncmVzcywgZmFsc2UsIGZhbHNlKTtcbiAgICB0aGlzLnVwZGF0ZVByb2dyZXNzKGZhbHNlKTtcbn07XG5cbkFjdGl2aXR5VGFza1RpcHNDb250cm9sbGVyLnByb3RvdHlwZS5vblVwZGF0ZVByb2dyZXNzID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMudXBkYXRlUHJvZ3Jlc3ModHJ1ZSk7XG4gICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJhZGRfdGFza19wcm9ncmVzc1wiKTtcbn07XG5cbkFjdGl2aXR5VGFza1RpcHNDb250cm9sbGVyLnByb3RvdHlwZS51cGRhdGVQcm9ncmVzcyA9IGZ1bmN0aW9uIChhbmltKSB7XG4gICAgaWYgKCFnYW1lLmFjdGl2aXR5TWFuLmlzT3BlbigpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIG5leHRSZXdhcmQgPSBnYW1lLmFjdGl2aXR5TWFuLmdldE5leHRTdGFnZVJld2FyZENmZygpO1xuICAgIHZhciBjdXJyZW50UmV3YXJkID0gZ2FtZS5hY3Rpdml0eU1hbi5nZXRDdXJyZW50U3RhZ2VSZXdhcmRDZmcoKTtcbiAgICB2YXIgY3VycmVudFNjb3JlID0gMDtcbiAgICBpZiAoY3VycmVudFJld2FyZCkge1xuICAgICAgICBjdXJyZW50U2NvcmUgPSBjdXJyZW50UmV3YXJkLnNjb3JlO1xuICAgIH1cbiAgICB2YXIgdG90YWxTY29yZSA9IG5leHRSZXdhcmQuc2NvcmUgLSBjdXJyZW50U2NvcmU7XG4gICAgdmFyIG5vd1Njb3JlID0gZ2FtZS5hY3Rpdml0eU1hbi5nZXRUb3RhbEFjdGl2aXR5VGFza0NvdW50KCkgLSBjdXJyZW50U2NvcmU7XG4gICAgdmFyIHBlcmNlbnQgPSBNYXRoLm1pbigxLCBub3dTY29yZSAvIHRvdGFsU2NvcmUpO1xuICAgIGlmIChhbmltKSB7XG4gICAgICAgIGlmICh0aGlzLmxhc3ROZXh0UmV3YXJkICE9PSBuZXh0UmV3YXJkKSB7XG4gICAgICAgICAgICB0aGlzLnB0UHJvZ3Jlc3MucnVuQWN0aW9uKGNjLnNlcXVlbmNlKGNjLnByb2dyZXNzVG8oMC41LCAxMDApLCBjYy5wcm9ncmVzc0Zyb21UbygwLjUsIDAsIHBlcmNlbnQgKiAxMDApKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnB0UHJvZ3Jlc3MucnVuQWN0aW9uKGNjLnByb2dyZXNzVG8oMC41LCBwZXJjZW50ICogMTAwKSk7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnB0UHJvZ3Jlc3Muc2V0UGVyY2VudGFnZShwZXJjZW50ICogMTAwKTtcbiAgICB9XG4gICAgdGhpcy5sYlNjb3JlLnNldFN0cmluZyhnYW1lLmFjdGl2aXR5TWFuLmdldFRvdGFsQWN0aXZpdHlUYXNrQ291bnQoKSArIFwiL1wiICsgbmV4dFJld2FyZC5zY29yZSk7XG4gICAgdGhpcy5zcFJld2FyZC5zZXRTcHJpdGVGcmFtZShjYy5zcHJpdGVGcmFtZUNhY2hlLmdldFNwcml0ZUZyYW1lKG5leHRSZXdhcmQuaW1hZ2UpKTtcbiAgICB0aGlzLmxhc3ROZXh0UmV3YXJkID0gbmV4dFJld2FyZDtcblxuICAgIGlmIChnYW1lLmFjdGl2aXR5TWFuLmhhc1VuQ2xhaW1lZFJld2FyZCgpKSB7XG4gICAgICAgIGdhbWUudXRpbHMucGxheUNDQkFuaW1hdGlvbih0aGlzLnJvb3ROb2RlLCBcImFuaW1cIik7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgZ2FtZS51dGlscy5wbGF5Q0NCQW5pbWF0aW9uKHRoaXMucm9vdE5vZGUsIFwiRGVmYXVsdCBUaW1lbGluZVwiKTtcbiAgICB9XG59O1xuXG5BY3Rpdml0eVRhc2tUaXBzQ29udHJvbGxlci5wcm90b3R5cGUudGFza0NsaWNrZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiRGFpbHlUYXNrVGlwc0NsaWNrXCIpO1xuICAgIGdhbWUucG9wdXBNYW4ucG9wdXBBY3Rpdml0eVRhc2soKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQWN0aXZpdHlUYXNrVGlwc0NvbnRyb2xsZXI7IiwidmFyIEV2ZW50c05hbWUgPSByZXF1aXJlKFwiLi4vZXZlbnRzL0V2ZW50c05hbWVcIik7XG5cbnZhciBBZHNSZW1pbmRlckNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcblxuICAgIHRoaXMuc3BSZW1pbmRlciA9IG51bGw7XG4gICAgdGhpcy5sYlJlbWluZGVyID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoQWRzUmVtaW5kZXJDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbkFkc1JlbWluZGVyQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlci5jYWxsKHRoaXMpO1xuICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLmFkZEV2ZW50TGlzdGVuZXIoRXZlbnRzTmFtZS5SRVdBUkRFRF9WSURFT19DT1VOVCwgdGhpcy5vblVwZGF0ZVJlbWluZGVyLCB0aGlzKTtcbn07XG5cbkFkc1JlbWluZGVyQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0ID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoRXZlbnRzTmFtZS5SRVdBUkRFRF9WSURFT19DT1VOVCwgdGhpcy5vblVwZGF0ZVJlbWluZGVyLCB0aGlzKTtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0LmNhbGwodGhpcyk7XG59O1xuXG5BZHNSZW1pbmRlckNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcbiAgICB0aGlzLm9uVXBkYXRlUmVtaW5kZXIoKTtcbn07XG5cbkFkc1JlbWluZGVyQ29udHJvbGxlci5wcm90b3R5cGUub25VcGRhdGVSZW1pbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgY291bnQgPSBnYW1lLmNvbmZpZy5yZXdhcmRBZE1heENvdW50UGVyRGF5IC0gZ2FtZS5wbGF5ZXJNYW4uZ2V0UmV3YXJkQWRQbGFjZUNvdW50UGVyRGF5KCk7XG4gICAgaWYgKGNvdW50IDwgMCkge1xuICAgICAgICBjb3VudCA9IDA7XG4gICAgfVxuICAgIHRoaXMubGJSZW1pbmRlci5zZXRTdHJpbmcoY291bnQpO1xufTtcblxuQWRzUmVtaW5kZXJDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL21lbnUvYWRzX3JlbWluZGVyX3ZpZXcuY2NiaVwiLCBudWxsLCBcIkFkc1JlbWluZGVyQ29udHJvbGxlclwiLCBuZXcgQWRzUmVtaW5kZXJDb250cm9sbGVyKCksIHRydWUpO1xuICAgIHJldHVybiBub2RlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBBZHNSZW1pbmRlckNvbnRyb2xsZXI7IiwiXG5cbnZhciBBaW1IZWxwQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuICAgIHRoaXMuc3BIYW5kID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoQWltSGVscENvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuQWltSGVscENvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcbiAgICAvL3RoaXMubGJIZWxwSW5mby5zZXRTdHJpbmcoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcImFpbV9oZWxwX2NvbnRlbnRcIikpO1xuICAgIC8vdGhpcy5sYkhlbHBJbmZvLnNldEFsaWdubWVudChjYy5URVhUX0FMSUdOTUVOVF9DRU5URVIpO1xufTtcblxuQWltSGVscENvbnRyb2xsZXIucHJvdG90eXBlLmdldEhhbmRXb3JsZFBvc2l0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLnNwSGFuZC5wYXJlbnQuY29udmVydFRvV29ybGRTcGFjZSh0aGlzLnNwSGFuZC5nZXRQb3NpdGlvbigpKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQWltSGVscENvbnRyb2xsZXI7IiwidmFyIEV2ZW50c05hbWUgPSByZXF1aXJlKFwiLi4vZXZlbnRzL0V2ZW50c05hbWVcIik7XG5cbnZhciBBaW1JdGVtQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuXG4gICAgdGhpcy5idG5BaW1JdGVtID0gbnVsbDtcbiAgICB0aGlzLmxiQWltUHJpY2UgPSBudWxsO1xuICAgIC8vdGhpcy5sYkFpbVRpcHMgPSBudWxsO1xuXG4gICAgdGhpcy5oaWRlZCA9IGZhbHNlO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhBaW1JdGVtQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5BaW1JdGVtQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuICAgIHRoaXMubGJBaW1QcmljZS5zZXRTdHJpbmcoZ2FtZS5jb25maWcuYWltSXRlbURpYW1vbmRzKTtcbn07XG5cbkFpbUl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS50cnlBaW1JdGVtQ2xpY2tlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB2YXIgU3RvcmVIZWxwZXIgPSByZXF1aXJlKFwiLi4vbW9kZWwvU3RvcmVIZWxwZXJcIik7XG4gICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS50cnlBaW1JdGVtKGdhbWUuZ2FtZU1hbi5sZXZlbElkLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdhbWUuZ2FtZU1hbi50cnlBaW1JdGVtKCk7XG4gICAgICAgIHRoaXMucGxheUhpZGVBbmltKCk7XG4gICAgfS5iaW5kKHRoaXMpKTtcbn07XG5cbkFpbUl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5wbGF5SGlkZUFuaW0gPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHRoaXMuaGlkZWQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmhpZGVkID0gdHJ1ZTtcbiAgICB0aGlzLmJ0bkFpbUl0ZW0uZW5hYmxlZCA9IGZhbHNlO1xuICAgIGdhbWUudXRpbHMucGxheUNDQkFuaW1hdGlvbih0aGlzLnJvb3ROb2RlLCBcImhpZGVcIik7XG5cbiAgICB0aGlzLnJvb3ROb2RlLnJ1bkFjdGlvbihjYy5zZXF1ZW5jZShjYy5kZWxheVRpbWUoMC41KSwgY2MuaGlkZSgpKSk7XG59O1xuXG5BaW1JdGVtQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9tZW51L2FpbV9pdGVtX3ZpZXcuY2NiaVwiLCBudWxsLCBcIkFpbUl0ZW1Db250cm9sbGVyXCIsIG5ldyBBaW1JdGVtQ29udHJvbGxlcigpLCB0cnVlKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQWltSXRlbUNvbnRyb2xsZXI7IiwiLy92YXIgU2tpbkl0ZW1Db250cm9sbGVyID0gcmVxdWlyZShcIi4vU2tpbkl0ZW1Db250cm9sbGVyXCIpO1xuLy92YXIgQ29uZmlnTWFuID0gcmVxdWlyZShcIi4uL2NvbmZpZy9Db25maWdNYW5cIik7XG4vL3ZhciBFdmVudHNOYW1lID0gcmVxdWlyZShcIi4uL2V2ZW50cy9FdmVudHNOYW1lXCIpO1xuLy9cbi8vdmFyIEdSSURfU0laRSA9IGNjLnNpemUoMzUwLCA1MDApO1xuLy9cbi8vdmFyIFN0b3JlSXRlbUNlbGxWaWV3ID0gY2MuVGFibGVWaWV3Q2VsbC5leHRlbmQoe1xuLy8gICAgZW50aXR5OiBudWxsLFxuLy8gICAgaXRlbU5vZGU6IG51bGwsXG4vLyAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4vLyAgICAgICAgdGhpcy5fc3VwZXIoKTtcbi8vICAgICAgICB0aGlzLml0ZW1Ob2RlID0gU2tpbkl0ZW1Db250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbi8vICAgICAgICB0aGlzLmFkZENoaWxkKHRoaXMuaXRlbU5vZGUpO1xuLy8gICAgICAgIHRoaXMuaXRlbU5vZGUuc2V0UG9zaXRpb24oY2MucChHUklEX1NJWkUud2lkdGggKiAwLjUsIEdSSURfU0laRS5oZWlnaHQgKiAwLjUpKTtcbi8vICAgIH0sXG4vL1xuLy8gICAgaW5pdFdpdGg6IGZ1bmN0aW9uIChlbnRpdHksIGlkeCwgaW5pdGVkKSB7XG4vLyAgICAgICAgdGhpcy5lbnRpdHkgPSBlbnRpdHk7XG4vLyAgICAgICAgdGhpcy5pdGVtTm9kZS5jb250cm9sbGVyLmluaXRXaXRoKGVudGl0eSwgaWR4KTtcbi8vICAgIH1cbi8vfSk7XG52YXIgQm9vc3RUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vQm9vc3RUeXBlXCIpO1xudmFyIEdhbWVNYW4gPSByZXF1aXJlKFwiLi4vbW9kZWwvR2FtZU1hblwiKTtcblxudmFyIEJhZ0NvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcbiAgICB0aGlzLmxiQm9vc3ROYW1lMSA9IG51bGw7XG4gICAgdGhpcy5sYkJvb3N0TmFtZTIgPSBudWxsO1xuICAgIHRoaXMubGJCb29zdERlc2MxID0gbnVsbDtcbiAgICB0aGlzLmxiQm9vc3REZXNjMiA9IG51bGw7XG4gICAgdGhpcy5sYlNoYXJlVGlwcyA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKEJhZ0NvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuQmFnQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlci5jYWxsKHRoaXMpO1xufTtcblxuQmFnQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0ID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQuY2FsbCh0aGlzKTtcbn07XG5cbkJhZ0NvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcbiAgICB0aGlzLmxiQm9vc3ROYW1lMS5zZXRTdHJpbmcoXyhcImJvb3N0X3NwbGl0X3RpdGxlXCIpICsgXCIgWFwiICsgKGdhbWUucGxheWVyTWFuLmdldEJvb3N0Q291bnQoQm9vc3RUeXBlLlNQTElUKSkpO1xuICAgIHRoaXMubGJCb29zdE5hbWUyLnNldFN0cmluZyhfKFwiYm9vc3RfbmV3X3RpdGxlXCIpICsgXCIgWFwiICsgKGdhbWUucGxheWVyTWFuLmdldEJvb3N0Q291bnQoQm9vc3RUeXBlLlRIUkVFX0JBTEwpKSk7XG4gICAgdGhpcy5sYkJvb3N0RGVzYzEuc2V0U3RyaW5nKF8oXCJib29zdF9zcGxpdF9kZXNjXCIpKTtcbiAgICB0aGlzLmxiQm9vc3REZXNjMi5zZXRTdHJpbmcoXyhcImJvb3N0X25ld19kZXNjXCIpKTtcbiAgICB0aGlzLmxiU2hhcmVUaXBzLnNldFN0cmluZyhcIlwiKTsvL18oXCJiYWdfc2hhcmVfdGlwc1wiKSk7XG4gICAgdGhpcy5sYlRpdGxlLnNldFN0cmluZyhfKFwiYmFnX3RpdGxlXCIpKTtcbn07XG5cbkJhZ0NvbnRyb2xsZXIucHJvdG90eXBlLmJhY2tDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuXG4gICAgdGhpcy5jbG9zZSgpO1xufTtcblxuQmFnQ29udHJvbGxlci5wcm90b3R5cGUuc2hhcmVDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIHZhciBzaGFyZSA9IEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5nZXRTaGFyZUNvbmZpZygpO1xuICAgIGdhbWUuc2hhcmVNYW5hZ2VyLnd4U2hhcmUoc2hhcmUsIGZ1bmN0aW9uIChzaGFyZWQpIHtcblxuICAgIH0pO1xufTtcblxuQmFnQ29udHJvbGxlci5wcm90b3R5cGUucG9wdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLnBvcHVwKHRoaXMucm9vdE5vZGUpO1xufTtcblxuQmFnQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLmNsb3NlKHRoaXMucm9vdE5vZGUpO1xufTtcblxuQmFnQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9tZW51L2JhZ192aWV3LmNjYmlcIiwgbnVsbCwgXCJCYWdDb250cm9sbGVyXCIsIG5ldyBCYWdDb250cm9sbGVyKCkpO1xuICAgIHJldHVybiBub2RlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBCYWdDb250cm9sbGVyOyIsInZhciBHYW1lTWFuID0gcmVxdWlyZShcIi4uL21vZGVsL0dhbWVNYW5cIik7XG52YXIgRXZlbnRzTmFtZSA9IHJlcXVpcmUoXCIuLi9ldmVudHMvRXZlbnRzTmFtZVwiKTtcblxudmFyIEJvYXJkQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuXG4gICAgdGhpcy5zcENpcmNsZSA9IG51bGw7XG4gICAgdGhpcy5uZEJvYXJkID0gbnVsbDtcbiAgICB0aGlzLnNwQmFsbCA9IG51bGw7XG4gICAgdGhpcy5zcHJCb2FyZCA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKEJvYXJkQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5Cb2FyZENvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlci5jYWxsKHRoaXMpO1xuICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLmFkZEV2ZW50TGlzdGVuZXIoRXZlbnRzTmFtZS5VUERBVEVfQk9BUkQsIHRoaXMub25VcGRhdGVTa2luLCB0aGlzKTtcbn07XG5cbkJvYXJkQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0ID0gZnVuY3Rpb24oKSB7XG4gICAgZ2FtZS5ldmVudERpc3BhdGNoZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihFdmVudHNOYW1lLlVQREFURV9CT0FSRCwgdGhpcy5vblVwZGF0ZVNraW4sIHRoaXMpO1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQuY2FsbCh0aGlzKTtcbn07XG5cbkJvYXJkQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuICAgIEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS51cGRhdGVTa2luKHRoaXMuc3BCYWxsKTtcbiAgICB0aGlzLm9uVXBkYXRlU2tpbigpO1xufTtcblxuQm9hcmRDb250cm9sbGVyLnByb3RvdHlwZS5vblVwZGF0ZVNraW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHNraW5DZmcgPSBHYW1lTWFuLmdldEluc3RhbmNlKCkuZ2V0Q3VycmVudEJvYXJkQ2ZnKCk7XG4gICAgdmFyIGltYWdlID0gc2tpbkNmZy5pbWFnZSArIFwiLnBuZ1wiO1xuICAgIHRoaXMuc3ByQm9hcmQuc2V0U3ByaXRlRnJhbWUoY2Muc3ByaXRlRnJhbWVDYWNoZS5nZXRTcHJpdGVGcmFtZShpbWFnZSkpO1xufTtcblxuQm9hcmRDb250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aCA9IGZ1bmN0aW9uIChiYWxsV2lkdGgpIHtcbiAgICB2YXIgc2NhbGUgPSBHYW1lTWFuLmdldEluc3RhbmNlKCkuZ2V0Q3VycmVudFNraW5DZmcoKS5zY2FsZTtcbiAgICB0aGlzLnNwQmFsbC5zY2FsZVggPSBiYWxsV2lkdGggLyB0aGlzLnNwQmFsbC53aWR0aCAqIHNjYWxlO1xuICAgIHRoaXMuc3BCYWxsLnNjYWxlWSA9IGJhbGxXaWR0aCAvIHRoaXMuc3BCYWxsLmhlaWdodCAqIHNjYWxlO1xufTtcblxuQm9hcmRDb250cm9sbGVyLnByb3RvdHlwZS5oaWRlQmFsbCA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnNwQmFsbC52aXNpYmxlID0gZmFsc2U7XG59O1xuXG5Cb2FyZENvbnRyb2xsZXIucHJvdG90eXBlLnNob3dCYWxsID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuc3BCYWxsLnZpc2libGUgPSB0cnVlO1xufTtcblxuQm9hcmRDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbihiYWxsV2lkdGgpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL2dhbWUvYm9hcmRfdmlldy5jY2JpXCIsIG51bGwsIFwiQm9hcmRDb250cm9sbGVyXCIsIG5ldyBCb2FyZENvbnRyb2xsZXIoKSk7XG4gICAgbm9kZS5jb250cm9sbGVyLmluaXRXaXRoKGJhbGxXaWR0aCk7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJvYXJkQ29udHJvbGxlcjsiLCJ2YXIgRXZlbnRzTmFtZSA9IHJlcXVpcmUoXCIuLi9ldmVudHMvRXZlbnRzTmFtZVwiKTtcblxudmFyIEJvYXJkR2V0Q29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuXG4gICAgdGhpcy5idG5QdXJjaGFzZSA9IG51bGw7XG4gICAgLy8gdGhpcy5sYkFpbVByaWNlID0gbnVsbDtcbiAgICAvLyAvL3RoaXMubGJBaW1UaXBzID0gbnVsbDtcblxuICAgIHRoaXMuc3BCb2FyZFNraW4gPSBudWxsO1xuICAgIHRoaXMuaGlkZWQgPSBmYWxzZTtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoQm9hcmRHZXRDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbkJvYXJkR2V0Q29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuICAgIC8vIHRoaXMubGJBaW1QcmljZS5zZXRTdHJpbmcoZ2FtZS5jb25maWcuYWltSXRlbURpYW1vbmRzKTtcbn07XG5cbkJvYXJkR2V0Q29udHJvbGxlci5wcm90b3R5cGUuaW5pdFdpdGggPSBmdW5jdGlvbiAoYm9hcmRDZmcpIHtcbiAgICB0aGlzLmJvYXJkQ2ZnID0gYm9hcmRDZmc7XG4gICAgdGhpcy5zcEJvYXJkU2tpbi5zZXRTcHJpdGVGcmFtZShib2FyZENmZy5pbWFnZSArIFwiLnBuZ1wiKTtcbn07XG5cbkJvYXJkR2V0Q29udHJvbGxlci5wcm90b3R5cGUucHVyY2hhc2VCb2FyZENsaWNrZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgdmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xuICAgIFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuYnV5Qm9hcmQodGhpcy5ib2FyZENmZywgXCJidXlfYm9hcmRfaW5fZ2FtZVwiLCBmdW5jdGlvbiAocmV3YXJkZWQpIHtcbiAgICAgICAgaWYgKHJld2FyZGVkKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXlIaWRlQW5pbSgpO1xuICAgICAgICB9XG4gICAgfS5iaW5kKHRoaXMpKTtcbn07XG5cbkJvYXJkR2V0Q29udHJvbGxlci5wcm90b3R5cGUucGxheUhpZGVBbmltID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICh0aGlzLmhpZGVkKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5oaWRlZCA9IHRydWU7XG4gICAgdGhpcy5idG5QdXJjaGFzZS5lbmFibGVkID0gZmFsc2U7XG4gICAgZ2FtZS51dGlscy5wbGF5Q0NCQW5pbWF0aW9uKHRoaXMucm9vdE5vZGUsIFwiaGlkZVwiKTtcblxuICAgIHRoaXMucm9vdE5vZGUucnVuQWN0aW9uKGNjLnNlcXVlbmNlKGNjLmRlbGF5VGltZSgwLjYpLCBjYy5oaWRlKCkpKTtcbn07XG5cbkJvYXJkR2V0Q29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9tZW51L2JvYXJkX2dldF92aWV3LmNjYmlcIiwgbnVsbCwgXCJCb2FyZEdldENvbnRyb2xsZXJcIiwgbmV3IEJvYXJkR2V0Q29udHJvbGxlcigpLCB0cnVlKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQm9hcmRHZXRDb250cm9sbGVyOyIsInZhciBTa2luUmV3YXJkVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1NraW5SZXdhcmRUeXBlXCIpO1xudmFyIEV2ZW50c05hbWUgPSByZXF1aXJlKFwiLi4vZXZlbnRzL0V2ZW50c05hbWVcIik7XG52YXIgU2tpblR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9Ta2luVHlwZVwiKTtcblxudmFyIEJvYXJkSXRlbUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcblxuICAgIHRoaXMubmRQdXJjaGFzZSA9IG51bGw7XG4gICAgdGhpcy5uZE93bmVkID0gbnVsbDtcbiAgICB0aGlzLm5kV2F0Y2hBZHMgPSBudWxsO1xuICAgIHRoaXMubmRDaGFsbGVuZ2UgPSBudWxsO1xuICAgIHRoaXMubmRLZXlBY3Rpdml0eSA9IG51bGw7XG5cbiAgICB0aGlzLmxiRGlhbW9uZFByaWNlID0gbnVsbDtcbiAgICB0aGlzLmxiVXNpbmcgPSBudWxsO1xuICAgIHRoaXMubGJSZXdhcmRBZHNDb3VudCA9IG51bGw7XG5cbiAgICB0aGlzLnNwU2tpbiA9IG51bGw7XG5cbiAgICB0aGlzLmlkeCA9IDA7XG4gICAgdGhpcy5za2luQ2ZnID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoQm9hcmRJdGVtQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5Cb2FyZEl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG59O1xuXG5Cb2FyZEl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5vbkVudGVyID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIuY2FsbCh0aGlzKTtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5hZGRFdmVudExpc3RlbmVyKEV2ZW50c05hbWUuVVBEQVRFX0JPQVJELCB0aGlzLm9uVXBkYXRlU2tpbiwgdGhpcyk7XG59O1xuXG5Cb2FyZEl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQgPSBmdW5jdGlvbigpIHtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5yZW1vdmVFdmVudExpc3RlbmVyKEV2ZW50c05hbWUuVVBEQVRFX0JPQVJELCB0aGlzLm9uVXBkYXRlU2tpbiwgdGhpcyk7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRXhpdC5jYWxsKHRoaXMpO1xufTtcbi8qKlxuICogQHBhcmFtIHtTa2luQ29uZmlnfSBkYXRhXG4gKiBAcGFyYW0ge251bWJlcn0gaWR4XG4gKi9cbkJvYXJkSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLmluaXRXaXRoID0gZnVuY3Rpb24gKGRhdGEsIGlkeCkge1xuICAgIHRoaXMuaWR4ID0gaWR4O1xuICAgIHRoaXMuc2tpbkNmZyA9IGRhdGE7XG4gICAgdHJ5IHtcbiAgICAgICAgdmFyIHNwcml0ZUZyYW1lID0gY2Muc3ByaXRlRnJhbWVDYWNoZS5nZXRTcHJpdGVGcmFtZShkYXRhLmltYWdlICsgXCIucG5nXCIpO1xuICAgICAgICB0aGlzLnNwU2tpbi5zZXRTcHJpdGVGcmFtZShzcHJpdGVGcmFtZSk7XG5cbiAgICAgICAgdGhpcy5uZFB1cmNoYXNlLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5uZE93bmVkLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5uZFdhdGNoQWRzLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5uZENoYWxsZW5nZS52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMubmRLZXlBY3Rpdml0eS52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMubmRDaHJpc3RtYXMudmlzaWJsZSA9IGZhbHNlO1xuXG4gICAgICAgIHZhciBvd25lZCA9IGdhbWUucGxheWVyTWFuLmhhc0JvYXJkKHRoaXMuc2tpbkNmZy5pZCk7XG4gICAgICAgIGlmIChvd25lZCkge1xuICAgICAgICAgICAgdGhpcy5uZE93bmVkLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgaWYgKGRhdGEuaWQgPT09IGdhbWUucGxheWVyTWFuLmdldEN1cnJlbnRCb2FyZElkKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxiVXNpbmcuc2V0U3RyaW5nKF8oXCJzZWxlY3RlZF90aXRsZVwiKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMubGJVc2luZy5zZXRTdHJpbmcoXyhcInNlbGVjdF90aXRsZVwiKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzd2l0Y2ggKGRhdGEudHlwZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgU2tpblR5cGUuV2F0Y2hBZHM6XG4gICAgICAgICAgICAgICAgICAgIHZhciBza2luUmV3YXJkQ291bnQgPSBnYW1lLnBsYXllck1hbi5nZXRCb2FyZEFkc0NvdW50KGRhdGEuaWQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm5kV2F0Y2hBZHMudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGJSZXdhcmRBZHNDb3VudC5zZXRTdHJpbmcoZ2FtZS51dGlscy5zcHJpbnRmKFwiJWQvJWRcIiwgc2tpblJld2FyZENvdW50LCBkYXRhLmNvdW50KSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgU2tpblR5cGUuRGlhbW9uZHM6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubmRQdXJjaGFzZS52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYkRpYW1vbmRQcmljZS5zZXRTdHJpbmcodGhpcy5za2luQ2ZnLmNvdW50KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBTa2luVHlwZS5DaGFsbGVuZ2U6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubmRDaGFsbGVuZ2UudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgU2tpblR5cGUuS2V5QWN0aXZpdHk6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubmRLZXlBY3Rpdml0eS52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBTa2luVHlwZS5DaHJpc3RtYXM6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubmRDaHJpc3RtYXMudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSBjYXRjaCAoZXgpIHtcbiAgICAgICAgY2MuZXJyb3IoZXgpO1xuICAgIH1cbn07XG5cbkJvYXJkSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLm9uVXBkYXRlU2tpbiA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmluaXRXaXRoKHRoaXMuc2tpbkNmZywgdGhpcy5pZHgpO1xufTtcblxuQm9hcmRJdGVtQ29udHJvbGxlci5wcm90b3R5cGUuZ2V0Q29udGVudFNpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3BCZ1NlbGVjdGVkLmdldENvbnRlbnRTaXplKCk7XG59O1xuXG5Cb2FyZEl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5wdXJjaGFzZUNsaWNrZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgdmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xuICAgIFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuYnV5Qm9hcmQodGhpcy5za2luQ2ZnLCBcImJ1eV9ib2FyZF9pbl9zdG9yZVwiKTtcbn07XG5cbkJvYXJkSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLnNlbGVjdENsaWNrZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgZ2FtZS5wbGF5ZXJNYW4uc2V0Q3VycmVudEJvYXJkSWQodGhpcy5za2luQ2ZnLmlkKTtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KEV2ZW50c05hbWUuVVBEQVRFX0JPQVJEKTtcbn07XG5cbkJvYXJkSXRlbUNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9tZW51L2JvYXJkX2l0ZW1fdmlldy5jY2JpXCIsIG51bGwsIFwiQm9hcmRJdGVtQ29udHJvbGxlclwiLCBuZXcgQm9hcmRJdGVtQ29udHJvbGxlcigpKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQm9hcmRJdGVtQ29udHJvbGxlcjsiLCJ2YXIgQm94SXRlbUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi9Cb3hJdGVtQ29udHJvbGxlclwiKTtcbnZhciBDb25maWdNYW4gPSByZXF1aXJlKFwiLi4vY29uZmlnL0NvbmZpZ01hblwiKTtcbnZhciBFdmVudHNOYW1lID0gcmVxdWlyZShcIi4uL2V2ZW50cy9FdmVudHNOYW1lXCIpO1xudmFyIE11bHRpQ29sVGFibGVWaWV3ID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi9leHQvTXVsdGlDb2xUYWJsZVZpZXdcIik7XG52YXIgU3RvcmVIZWxwZXIgPSByZXF1aXJlKFwiLi4vbW9kZWwvU3RvcmVIZWxwZXJcIik7XG52YXIgRXZlbnRzTmFtZSA9IHJlcXVpcmUoXCIuLi9ldmVudHMvRXZlbnRzTmFtZVwiKTtcbnZhciBCb29zdFR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9Cb29zdFR5cGVcIik7XG5cbnZhciBHUklEX1NJWkUgPSBjYy5zaXplKDE4MywgMTgzKTtcblxudmFyIFN0b3JlSXRlbUNlbGxWaWV3ID0gY2MuVGFibGVWaWV3Q2VsbC5leHRlbmQoe1xuICAgIGVudGl0eTogbnVsbCxcbiAgICBpdGVtTm9kZTogbnVsbCxcbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICAgIHRoaXMuaXRlbU5vZGUgPSBCb3hJdGVtQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG4gICAgICAgIHRoaXMuYWRkQ2hpbGQodGhpcy5pdGVtTm9kZSk7XG4gICAgICAgIHRoaXMuaXRlbU5vZGUuc2V0UG9zaXRpb24oY2MucChHUklEX1NJWkUud2lkdGggKiAwLjUsIEdSSURfU0laRS5oZWlnaHQgKiAwLjUpKTtcbiAgICB9LFxuXG4gICAgaW5pdFdpdGg6IGZ1bmN0aW9uIChlbnRpdHksIGlkeCwgYmVzdFJld2FyZCkge1xuICAgICAgICB0aGlzLmVudGl0eSA9IGVudGl0eTtcbiAgICAgICAgdGhpcy5pdGVtTm9kZS5jb250cm9sbGVyLmluaXRXaXRoKGVudGl0eSwgaWR4LCBiZXN0UmV3YXJkKTtcbiAgICB9LFxuXG4gICAgcGxheUZseUJveEFuaW06IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pdGVtTm9kZS5jb250cm9sbGVyLnBsYXlGbHlCb3hBbmltKCk7XG4gICAgfSxcblxuICAgIGlzT3BlbmVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLml0ZW1Ob2RlLmNvbnRyb2xsZXIub3BlbmVkO1xuICAgIH1cbn0pO1xuXG52YXIgQm94Q29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuICAgIHRoaXMuS0VZX1NUQVJUX05PX1RBRyA9IDIwMDtcbiAgICB0aGlzLktFWV9DT1VOVCA9IDM7XG4gICAgdGhpcy5LRVlfU1RBUlRfVEFHID0gMzAwO1xuXG4gICAgdGhpcy5uZENvbnRhaW5lciA9IG51bGw7XG4gICAgdGhpcy5uZFdhdGNoQWRzID0gbnVsbDtcbiAgICB0aGlzLm5kS2V5ID0gbnVsbDtcbiAgICB0aGlzLnNwU3VwZXJSZXdhcmQgPSBudWxsO1xuICAgIHRoaXMubmRLZXlOb2RlID0gbnVsbDtcbiAgICB0aGlzLm5kQWxsQ29tcGxldGVkID0gbnVsbDtcblxuICAgIHRoaXMuYnRuV2F0Y2hBZHMgPSBudWxsO1xuICAgIHRoaXMudG9wQmcgPSBudWxsO1xuXG4gICAgdGhpcy5fdGFibGVWaWV3ID0gbnVsbDtcblxuICAgIC8vdXNlciBkYXRhLlxuICAgIHRoaXMuY29uZmlncyA9IG51bGw7XG4gICAgdGhpcy5zdXBlckNvbmZpZyA9IG51bGw7XG5cbiAgICAvLyB0aGlzLnVubG9ja0NvdW50ID0gMDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoQm94Q29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5Cb3hDb250cm9sbGVyLnByb3RvdHlwZS5vbkVudGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkVudGVyLmNhbGwodGhpcyk7XG4gICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuYWRkRXZlbnRMaXN0ZW5lcihFdmVudHNOYW1lLk9QRU5fS0VZX0JPWCwgdGhpcy5vblVwZGF0ZUtleUJveCwgdGhpcyk7XG59O1xuXG5Cb3hDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5ldmVudERpc3BhdGNoZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihFdmVudHNOYW1lLk9QRU5fS0VZX0JPWCwgdGhpcy5vblVwZGF0ZUtleUJveCwgdGhpcyk7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRXhpdC5jYWxsKHRoaXMpO1xufTtcblxuQm94Q29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuXG4gICAgdGhpcy5uZEtleU5vZGVzID0gW107XG4gICAgdGhpcy5uZEtleU5vTm9kZXMgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuS0VZX0NPVU5UOyArK2kpIHtcbiAgICAgICAgdmFyIGtleU5vZGUgPSB0aGlzLm5kS2V5Tm9kZS5nZXRDaGlsZEJ5VGFnKHRoaXMuS0VZX1NUQVJUX1RBRyArIGkpO1xuICAgICAgICB2YXIga2V5Tm9Ob2RlID0gdGhpcy5uZEtleU5vZGUuZ2V0Q2hpbGRCeVRhZyh0aGlzLktFWV9TVEFSVF9OT19UQUcgKyBpKTtcbiAgICAgICAgdGhpcy5uZEtleU5vZGVzLnB1c2goa2V5Tm9kZSk7XG4gICAgICAgIHRoaXMubmRLZXlOb05vZGVzLnB1c2goa2V5Tm9Ob2RlKTtcbiAgICB9XG5cbiAgICB0aGlzLmNvbmZpZ3MgPSBnYW1lLmdhbWVNYW4uZ2V0Qm94UmV3YXJkcygpO1xuICAgIHRoaXMuc3VwZXJDb25maWcgPSB0aGlzLmNvbmZpZ3NbMF07XG4gICAgZ2FtZS5nYW1lTWFuLmJveENvbmZpZ3MgPSB0aGlzLmNvbmZpZ3M7XG4gICAgZ2FtZS5nYW1lTWFuLnVubG9ja0JveENvdW50ID0gMDtcbiAgICAvLyBnYW1lLnV0aWxzLnNodWZmbGUodGhpcy5jb25maWdzKTtcbiAgICBzd2l0Y2ggKHRoaXMuc3VwZXJDb25maWcudHlwZSkge1xuICAgICAgICBjYXNlIEJvb3N0VHlwZS5TS0lOOlxuICAgICAgICAgICAgdGhpcy5zcFN1cGVyUmV3YXJkLnNldFNwcml0ZUZyYW1lKHRoaXMuc3VwZXJDb25maWcuZXh0cmEuaW1hZ2UgKyBcIl9sLnBuZ1wiKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgaWYgKHRoaXMuc3VwZXJDb25maWcuZXh0cmEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNwU3VwZXJSZXdhcmQuc2V0U3ByaXRlRnJhbWUodGhpcy5zdXBlckNvbmZpZy5leHRyYS5pbWFnZSArIFwiLnBuZ1wiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zcFN1cGVyUmV3YXJkLnNldFNwcml0ZUZyYW1lKHRoaXMuc3VwZXJDb25maWcuaW1hZ2UpO1xuICAgICAgICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuc2hvd1RhYmxlVmlldygpO1xuICAgIHRoaXMudXBkYXRlS2V5KCk7XG5cbiAgICAvLyB0aGlzLnRvcEJnLnJ1bkFjdGlvbihjYy5yb3RhdGVCeSgyLCAzNjApLnJlcGVhdEZvcmV2ZXIoKSk7XG59O1xuXG5Cb3hDb250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aCA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgIHRoaXMuY2xvc2VDYWxsYmFjayA9IGNhbGxiYWNrO1xufTtcblxuQm94Q29udHJvbGxlci5wcm90b3R5cGUudXBkYXRlS2V5ID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMubmRXYXRjaEFkcy52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5uZEtleS52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5uZEFsbENvbXBsZXRlZC52aXNpYmxlID0gZmFsc2U7XG4gICAgaWYgKGdhbWUucGxheWVyTWFuLnBsYXllci5jdXJyZW50S2V5Q291bnQgPiAwKSB7XG4gICAgICAgIHRoaXMubmRLZXkudmlzaWJsZSA9IHRydWU7XG4gICAgICAgIHZhciBrZXlDb3VudCA9IGdhbWUucGxheWVyTWFuLnBsYXllci5jdXJyZW50S2V5Q291bnQ7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5LRVlfQ09VTlQ7ICsraSkge1xuICAgICAgICAgICAgdmFyIG5vZGUgPSB0aGlzLm5kS2V5Tm9kZXNbaV07XG4gICAgICAgICAgICBub2RlLnZpc2libGUgPSAoa2V5Q291bnQgPiBpKTtcbiAgICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChnYW1lLmdhbWVNYW4udW5sb2NrQm94Q291bnQgPj0gOSkge1xuICAgICAgICAgICAgdGhpcy5uZEFsbENvbXBsZXRlZC52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubmRXYXRjaEFkcy52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIGdhbWUudXRpbHMucGxheUNDQkFuaW1hdGlvbih0aGlzLnJvb3ROb2RlLCBcIkRlZmF1bHQgVGltZWxpbmVcIik7XG4gICAgICAgICAgICAvLyB0aGlzLnRvcEJnLnJ1bkFjdGlvbihjYy5yb3RhdGVCeSgyLCAzNjApLnJlcGVhdEZvcmV2ZXIoKSk7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG5Cb3hDb250cm9sbGVyLnByb3RvdHlwZS5vblVwZGF0ZUtleUJveCA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgIGdhbWUuZ2FtZU1hbi51bmxvY2tCb3hDb3VudCArKztcbiAgICBpZiAoZ2FtZS5nYW1lTWFuLnVubG9ja0JveENvdW50ID09PSAzKSB7XG4gICAgICAgIGdhbWUuYWN0aXZpdHlNYW4uYWRkQWN0aXZpdHlUYXNrQ291bnQoZ2FtZS5hY3Rpdml0eVRhc2tUeXBlLkNoZXN0T3Blbik7XG4gICAgfVxuICAgIHRoaXMudXBkYXRlS2V5KCk7XG59O1xuXG5Cb3hDb250cm9sbGVyLnByb3RvdHlwZS5zaG93VGFibGVWaWV3ID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICghdGhpcy5fdGFibGVWaWV3KSB7XG4gICAgICAgIHZhciBzaXplID0gdGhpcy5uZENvbnRhaW5lci5nZXRDb250ZW50U2l6ZSgpO1xuICAgICAgICB0aGlzLl90YWJsZVZpZXcgPSBuZXcgTXVsdGlDb2xUYWJsZVZpZXcodGhpcywgc2l6ZSwgbnVsbCk7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5zZXREaXJlY3Rpb24oY2MuU0NST0xMVklFV19ESVJFQ1RJT05fVkVSVElDQUwpO1xuICAgICAgICB0aGlzLl90YWJsZVZpZXcuc2V0VmVydGljYWxGaWxsT3JkZXIoY2MuVEFCTEVWSUVXX0ZJTExfVE9QRE9XTik7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5zZXRNdWx0aVRhYmxlVmlld0RlbGVnYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLl90YWJsZVZpZXcuaWdub3JlQW5jaG9yUG9pbnRGb3JQb3NpdGlvbihmYWxzZSk7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5zZXRBbmNob3JQb2ludChjYy5wKDAsIDApKTtcbiAgICAgICAgdGhpcy5fdGFibGVWaWV3LnNldEJvdW5jZWFibGUoZmFsc2UpO1xuICAgICAgICB0aGlzLm5kQ29udGFpbmVyLmFkZENoaWxkKHRoaXMuX3RhYmxlVmlldyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5fb2Zmc2V0ID0gdGhpcy5fdGFibGVWaWV3LmdldENvbnRlbnRPZmZzZXQoKTtcbiAgICB9XG4gICAgdGhpcy5fdGFibGVWaWV3LnJlbG9hZERhdGEoKTtcbiAgICBpZiAodGhpcy5fb2Zmc2V0KSB7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5zZXRDb250ZW50T2Zmc2V0KHRoaXMuX29mZnNldCk7XG4gICAgICAgIHRoaXMuX29mZnNldCA9IG51bGw7XG4gICAgfVxufTtcblxuQm94Q29udHJvbGxlci5wcm90b3R5cGUuc2Nyb2xsVmlld0RpZFNjcm9sbCA9IGZ1bmN0aW9uICh2aWV3KSB7XG59O1xuXG5Cb3hDb250cm9sbGVyLnByb3RvdHlwZS5zY3JvbGxWaWV3RGlkWm9vbSA9IGZ1bmN0aW9uICh2aWV3KSB7XG59O1xuXG5Cb3hDb250cm9sbGVyLnByb3RvdHlwZS5ncmlkQXRJbmRleCA9IGZ1bmN0aW9uKG11bHRpVGFibGUsICBpZHgpIHtcbiAgICB2YXIgY2VsbCA9IG11bHRpVGFibGUuZGVxdWV1ZUdyaWQoKTtcbiAgICBpZiAoIWNlbGwpIHtcbiAgICAgICAgY2VsbCA9IG5ldyBTdG9yZUl0ZW1DZWxsVmlldygpO1xuICAgIH1cblxuICAgIGlmIChpZHggPCB0aGlzLmNvbmZpZ3MubGVuZ3RoKSB7XG4gICAgICAgIHZhciBza2luQ2ZnID0gdGhpcy5jb25maWdzW2lkeF07XG4gICAgICAgIGNlbGwuaW5pdFdpdGgoc2tpbkNmZywgaWR4LCB0aGlzLnN1cGVyQ29uZmlnKTtcbiAgICAgICAgY2VsbC52aXNpYmxlID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBjZWxsLnZpc2libGUgPSBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gY2VsbDtcbn07XG5cbkJveENvbnRyb2xsZXIucHJvdG90eXBlLm51bWJlck9mQ2VsbHNJblRhYmxlVmlldyA9IGZ1bmN0aW9uKG11bHRpVGFibGUpIHtcbiAgICB2YXIgZ3JpZHNJbkNlbGwgPSB0aGlzLm51bWJlck9mR3JpZHNJbkNlbGwobXVsdGlUYWJsZSk7XG4gICAgcmV0dXJuIE1hdGguY2VpbCh0aGlzLmNvbmZpZ3MubGVuZ3RoIC8gZ3JpZHNJbkNlbGwpO1xufTtcblxuQm94Q29udHJvbGxlci5wcm90b3R5cGUubnVtYmVyT2ZHcmlkc0luQ2VsbCA9IGZ1bmN0aW9uKG11bHRpVGFibGUsIGNvbElkeCkge1xuICAgIHJldHVybiAzO1xufTtcblxuQm94Q29udHJvbGxlci5wcm90b3R5cGUuZ3JpZFNpemVGb3JUYWJsZSA9IGZ1bmN0aW9uKHRhYmxlLCBjb2xJZHgpIHtcbiAgICByZXR1cm4gY2Muc2l6ZShHUklEX1NJWkUud2lkdGgsIEdSSURfU0laRS5oZWlnaHQpO1xufTtcblxuQm94Q29udHJvbGxlci5wcm90b3R5cGUuZ3JpZFRvdWNoZWQgPSBmdW5jdGlvbih0YWJsZSwgZ3JpZCkge1xufTtcblxuQm94Q29udHJvbGxlci5wcm90b3R5cGUud2F0Y2hBZHNDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuY2hlY2tBbmRTaG93UmV3YXJkVmlkZW8oXCJnZXRfbmV3X2tleVwiLCBmdW5jdGlvbiAod2F0Y2hlZCkge1xuICAgICAgICBpZiAod2F0Y2hlZCkge1xuICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uc2V0Q3VycmVudEtleUNvdW50KDMpO1xuICAgICAgICAgICAgc2VsZi51cGRhdGVLZXkoKTtcbiAgICAgICAgfVxuICAgIH0pO1xufTtcblxuQm94Q29udHJvbGxlci5wcm90b3R5cGUuY2xvc2VDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuXG4gICAgdGhpcy5jbG9zZSgpO1xufTtcblxuQm94Q29udHJvbGxlci5wcm90b3R5cGUuYWxsQ29tcGxldGVkQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcblxuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cbkJveENvbnRyb2xsZXIucHJvdG90eXBlLnBvcHVwID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5wb3B1cCh0aGlzLnJvb3ROb2RlLCB7cG9wdXBBbmltOiB0cnVlfSk7XG59O1xuXG5Cb3hDb250cm9sbGVyLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIuY2xvc2UodGhpcy5yb290Tm9kZSk7XG4gICAgaWYgKHRoaXMuY2xvc2VDYWxsYmFjaykge1xuICAgICAgICB0aGlzLmNsb3NlQ2FsbGJhY2soKTtcbiAgICAgICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gbnVsbDtcbiAgICB9XG59O1xuXG5Cb3hDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL2FjdGl2aXR5L2FjdGl2aXR5X29wZW5ib3hfdmlldy5jY2JpXCIsIG51bGwsIFwiQm94Q29udHJvbGxlclwiLCBuZXcgQm94Q29udHJvbGxlcigpKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQm94Q29udHJvbGxlcjsiLCJ2YXIgTG9ja1N0YXR1cyA9IHJlcXVpcmUoXCIuLi9lbnVtL0xvY2tTdGF0dXNcIik7XG52YXIgR2FtZU1hbiA9IHJlcXVpcmUoXCIuLi9tb2RlbC9HYW1lTWFuXCIpO1xudmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xudmFyIEV2ZW50c05hbWUgPSByZXF1aXJlKFwiLi4vZXZlbnRzL0V2ZW50c05hbWVcIik7XG5cbnZhciBCb3hJdGVtQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuXG4gICAgdGhpcy5uZEl0ZW0gPSBudWxsO1xuICAgIHRoaXMubmRCb3ggPSBudWxsO1xuICAgIHRoaXMuc3BySXRlbSA9IG51bGw7XG4gICAgdGhpcy5sYkNvdW50ID0gbnVsbDtcbiAgICB0aGlzLmJnID0gbnVsbDtcblxuICAgIHRoaXMuaWR4ID0gMDtcbiAgICB0aGlzLmRhdGEgPSBudWxsO1xuXG4gICAgdGhpcy5vcGVuZWQgPSBmYWxzZTtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoQm94SXRlbUNvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuQm94SXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xufTtcblxuQm94SXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLnBsYXlGbHlCb3hBbmltID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMub3BlbmVkID0gdHJ1ZTtcbiAgICAvLyB0aGlzLm5kSXRlbS52aXNpYmxlID0gdHJ1ZTtcbiAgICAvLyB0aGlzLm5kQm94LnZpc2libGUgPSBmYWxzZTtcblxuICAgIHRoaXMuZGF0YSA9IGdhbWUuZ2FtZU1hbi5yYW5kb21Cb3goKTtcblxuICAgIGlmICh0aGlzLmRhdGEuZXh0cmEgJiYgdGhpcy5kYXRhLmV4dHJhLmltYWdlKSB7XG4gICAgICAgIHRoaXMuc3BySXRlbS5zZXRTcHJpdGVGcmFtZSh0aGlzLmRhdGEuZXh0cmEuaW1hZ2UgKyBcIi5wbmdcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zcHJJdGVtLnNldFNwcml0ZUZyYW1lKHRoaXMuZGF0YS5pbWFnZSk7XG4gICAgfVxuICAgIGlmICh0aGlzLmRhdGEuc2NhbGUpIHtcbiAgICAgICAgdGhpcy5zcHJJdGVtLnNjYWxlICo9IHRoaXMuZGF0YS5zY2FsZTtcbiAgICB9XG4gICAgdGhpcy5sYkNvdW50LnNldFN0cmluZyhcIlhcIiArIHRoaXMuZGF0YS5jb3VudCk7XG4gICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJvcGVuX2JveFwiKTtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KEV2ZW50c05hbWUuT1BFTl9LRVlfQk9YKTtcbiAgICBTdG9yZUhlbHBlci5nZXRJbnN0YW5jZSgpLmNsYWltQm94UmV3YXJkKHRoaXMuZGF0YSk7XG5cbiAgICB0aGlzLmJnLnJ1bkFjdGlvbihjYy5yb3RhdGVCeSgyLCAzNjApLnJlcGVhdEZvcmV2ZXIoKSk7XG5cbiAgICBpZiAodGhpcy5iZXN0UmV3YXJkID09PSB0aGlzLmRhdGEpIHtcbiAgICAgICAgZ2FtZS5hY3Rpdml0eU1hbi5hZGRBY3Rpdml0eVRhc2tDb3VudChnYW1lLmFjdGl2aXR5VGFza1R5cGUuT3BlbkJveCk7XG4gICAgfVxuXG4gICAgZ2FtZS51dGlscy5wbGF5Q0NCQW5pbWF0aW9uKHRoaXMucm9vdE5vZGUsIFwiZmxpcFwiKTtcbn07XG5cbi8qKlxuICogQHBhcmFtIHtMZXZlbENvbmZpZ30gZGF0YVxuICogQHBhcmFtIHtudW1iZXJ9IGlkeFxuICogQHBhcmFtIHtPYmplY3R9IGJlc3RcbiAqL1xuQm94SXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLmluaXRXaXRoID0gZnVuY3Rpb24gKGRhdGEsIGlkeCwgYmVzdCkge1xuICAgIGNjLmxvZyhcIkJveEl0ZW1Db250cm9sbGVyIGluaXRXaXRoXCIpO1xuICAgIHRoaXMub3BlbmVkID0gZmFsc2U7XG4gICAgdGhpcy5pZHggPSBpZHg7XG4gICAgdGhpcy5iZXN0UmV3YXJkID0gYmVzdDtcbiAgICAvLyB0aGlzLm5kSXRlbS52aXNpYmxlID0gZmFsc2U7XG4gICAgLy8gdGhpcy5uZEJveC52aXNpYmxlID0gdHJ1ZTtcbn07XG5cbkJveEl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5ib3hDbGlja2VkID0gZnVuY3Rpb24gKCkge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGlmIChnYW1lLnBsYXllck1hbi5wbGF5ZXIuY3VycmVudEtleUNvdW50ID4gMCAmJiAhdGhpcy5vcGVuZWQpIHtcbiAgICAgICAgZ2FtZS5wbGF5ZXJNYW4ucmVkdWNlQ3VycmVudEtleUNvdW50KCk7XG4gICAgICAgIHRoaXMucGxheUZseUJveEFuaW0oKTtcbiAgICB9XG59O1xuXG5Cb3hJdGVtQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL2FjdGl2aXR5L2FjdGl2aXR5X2JveF9pdGVtX3ZpZXcuY2NiaVwiLCBudWxsLCBcIkJveEl0ZW1Db250cm9sbGVyXCIsIG5ldyBCb3hJdGVtQ29udHJvbGxlcigpKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQm94SXRlbUNvbnRyb2xsZXI7IiwidmFyIFdoZWVsID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi93aGVlbC9XaGVlbFwiKTtcbnZhciBDb25maWdNYW4gPSByZXF1aXJlKFwiLi4vY29uZmlnL0NvbmZpZ01hblwiKTtcbnZhciBCb29zdFR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9Cb29zdFR5cGVcIik7XG52YXIgU3RvcmVIZWxwZXIgPSByZXF1aXJlKFwiLi4vbW9kZWwvU3RvcmVIZWxwZXJcIik7XG52YXIgR2FtZU1hbiA9IHJlcXVpcmUoXCIuLi9tb2RlbC9HYW1lTWFuXCIpO1xudmFyIFdoZWVsVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1doZWVsVHlwZVwiKTtcbnZhciBDYXJkSXRlbUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi9DYXJkSXRlbUNvbnRyb2xsZXJcIik7XG5cbnZhciBDYXJkQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuXG4gICAgdGhpcy5YID0gMTIwO1xuICAgIHRoaXMuWSA9IDE0MDtcblxuICAgIHRoaXMubmRDYXJkMSA9IG51bGw7XG4gICAgdGhpcy5uZENhcmQyID0gbnVsbDtcbiAgICB0aGlzLm5kQ2FyZDMgPSBudWxsO1xuICAgIHRoaXMubmRDYXJkNCA9IG51bGw7XG5cbiAgICB0aGlzLm5kV2F0Y2ggPSBudWxsO1xuICAgIHRoaXMubmRDbG9zZSA9IG51bGw7XG5cbiAgICB0aGlzLmNhcmRMaXN0ID0gbnVsbDtcbiAgICB0aGlzLmNhcmROb2RlcyA9IG51bGw7XG4gICAgdGhpcy5pbnRlcnZhbEtleSA9IG51bGw7XG5cbiAgICB0aGlzLmNhcmRDb3VudCA9IDA7XG4gICAgdGhpcy5jYXJkQW5pbUNvdW50ID0gMDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoQ2FyZENvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuQ2FyZENvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIuY2FsbCh0aGlzKTtcbiAgICAvLyB0aGlzLmludGVydmFsS2V5ID0gc2V0SW50ZXJ2YWwodGhpcy5vblVwZGF0ZS5iaW5kKHRoaXMpLCAxMDAwKTtcbn07XG5cbkNhcmRDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgLy8gY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsS2V5KTtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0LmNhbGwodGhpcyk7XG5cbiAgICBpZiAodGhpcy5jbG9zZUNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuY2xvc2VDYWxsYmFjaygpO1xuICAgIH1cbn07XG5cbkNhcmRDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcblxuICAgIHZhciBjYXJkTGlzdCA9IENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldENhcmRMaXN0KCk7XG5cbiAgICB0aGlzLmNhcmRMaXN0ID0gZ2FtZS51dGlscy5jbG9uZShjYXJkTGlzdCk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmNhcmRMaXN0Lmxlbmd0aDsgKytpKSB7XG4gICAgICAgIHZhciBjYXJkID0gdGhpcy5jYXJkTGlzdFtpXTtcbiAgICAgICAgY2FyZC5jb3VudCA9IGdhbWUudXRpbHMucmFuZG9tTmV4dEludEluUmFuZ2UoY2FyZC5jb3VudCAtIDMsIGNhcmQuY291bnQgKyAzKTtcbiAgICB9XG4gICAgZ2FtZS51dGlscy5zaHVmZmxlKHRoaXMuY2FyZExpc3QpO1xuXG4gICAgdGhpcy5jYXJkTm9kZXMgPSBbXG4gICAgICAgIHRoaXNbXCJuZENhcmQxXCJdLFxuICAgICAgICB0aGlzW1wibmRDYXJkMlwiXSxcbiAgICAgICAgdGhpc1tcIm5kQ2FyZDNcIl0sXG4gICAgICAgIHRoaXNbXCJuZENhcmQ0XCJdXG4gICAgXTtcblxuICAgIHRoaXMucGxheVNodWZmbGVBbmltKCk7XG5cbiAgICB0aGlzLm5kV2F0Y2gudmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMubmRDbG9zZS52aXNpYmxlID0gZmFsc2U7XG59O1xuXG5DYXJkQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdFdpdGggPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBjYWxsYmFjaztcbn07XG5cbkNhcmRDb250cm9sbGVyLnByb3RvdHlwZS5wbGF5U2h1ZmZsZUFuaW0gPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGFuaW1UaW1lID0gMC41O1xuICAgIHZhciBvZmZzZXRYID0gNzA7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmNhcmROb2Rlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICB2YXIgY2FyZE5vZGUgPSB0aGlzLmNhcmROb2Rlc1tpXTtcbiAgICAgICAgY2FyZE5vZGUuY29udHJvbGxlci5pbml0V2l0aCh0aGlzLmNhcmRMaXN0W2ldKTtcbiAgICAgICAgY2FyZE5vZGUuc3RhcnRQb3MgPSBjYXJkTm9kZS5nZXRQb3NpdGlvbigpO1xuICAgICAgICBjYXJkTm9kZS5jb250cm9sbGVyLnNob3dDYXJkRnJvbnQoKTtcbiAgICAgICAgY2FyZE5vZGUuY29udHJvbGxlci5lbmFibGVkQ2xpY2sgPSBmYWxzZTtcbiAgICAgICAgY2FyZE5vZGUuc2V0UG9zaXRpb24oY2MucCgwLCAwKSk7XG4gICAgICAgIHZhciBkaXJlY3Rpb24gPSAoKGkgJSAyKSA9PT0gMCkgPyAxIDogLTE7XG4gICAgICAgIHZhciB0b3RhbFRpbWUgPSAyLjU7XG4gICAgICAgIHZhciBhY3Rpb24gPSBjYy5zZXF1ZW5jZShcbiAgICAgICAgICAgIGNjLmRlbGF5VGltZShpICogMC41ICsgMC41KSwvLzAuNSwgMSwgMS41LCAyXG4gICAgICAgICAgICBjYy5jYWxsRnVuYyhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJjYXJkX3R1cm5cIik7XG4gICAgICAgICAgICB9LCB0aGlzKSxcbiAgICAgICAgICAgIGNjLm1vdmVUbyhhbmltVGltZSwgY2FyZE5vZGUuc3RhcnRQb3MpLFxuICAgICAgICAgICAgY2MuZGVsYXlUaW1lKHRvdGFsVGltZSAtIGkgKiAwLjUgLSAwLjUpLFxuICAgICAgICAgICAgY2MuY2FsbEZ1bmMoY2FyZE5vZGUuY29udHJvbGxlci5zaG93Q2FyZEJhY2tBbmltLCBjYXJkTm9kZS5jb250cm9sbGVyKSxcbiAgICAgICAgICAgIGNjLmRlbGF5VGltZSgxKSxcbiAgICAgICAgICAgIGNjLm1vdmVUbyhhbmltVGltZSwgY2MucCgwLCAwKSksXG4gICAgICAgICAgICBjYy5jYWxsRnVuYyh0aGlzLm9uU2hvd1NodWZmbGVBdWRpbywgdGhpcyksXG4gICAgICAgICAgICBjYy5tb3ZlVG8oYW5pbVRpbWUgKiAwLjIsIGNjLnAoZGlyZWN0aW9uICogb2Zmc2V0WCwgMCkpLFxuICAgICAgICAgICAgY2MubW92ZVRvKGFuaW1UaW1lICogMC4yLCBjYy5wKDAsIDApKSxcbiAgICAgICAgICAgIGNjLm1vdmVUbyhhbmltVGltZSAqIDAuMiwgY2MucCgtZGlyZWN0aW9uICogb2Zmc2V0WCwgMCkpLFxuICAgICAgICAgICAgY2MubW92ZVRvKGFuaW1UaW1lICogMC4yLCBjYy5wKDAsIDApKSxcbiAgICAgICAgICAgIGNjLm1vdmVUbyhhbmltVGltZSAqIDAuMiwgY2MucChkaXJlY3Rpb24gKiBvZmZzZXRYLCAwKSksXG4gICAgICAgICAgICBjYy5tb3ZlVG8oYW5pbVRpbWUgKiAwLjIsIGNjLnAoMCwgMCkpLFxuICAgICAgICAgICAgY2MubW92ZVRvKGFuaW1UaW1lICogMC4yLCBjYy5wKC1kaXJlY3Rpb24gKiBvZmZzZXRYLCAwKSksXG4gICAgICAgICAgICBjYy5tb3ZlVG8oYW5pbVRpbWUgKiAwLjIsIGNjLnAoMCwgMCkpLFxuICAgICAgICAgICAgY2MuY2FsbEZ1bmModGhpcy5vbkVuZFNodWZmbGVBdWRpbywgdGhpcyksXG4gICAgICAgICAgICBjYy5tb3ZlVG8oYW5pbVRpbWUsIGNhcmROb2RlLnN0YXJ0UG9zKSxcbiAgICAgICAgICAgIGNjLmNhbGxGdW5jKHRoaXMub25TaHVmZmxlZCwgdGhpcylcbiAgICAgICAgKTtcbiAgICAgICAgY2FyZE5vZGUucnVuQWN0aW9uKGFjdGlvbik7XG4gICAgfVxufTtcblxuQ2FyZENvbnRyb2xsZXIucHJvdG90eXBlLm9uU2hvd1NodWZmbGVBdWRpbyA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAodGhpcy5zaG93ZWRTaHVmZmxlQXVkaW8pIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnNob3dlZFNodWZmbGVBdWRpbyA9IHRydWU7XG4gICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJjYXJkX3R1cm5cIiwgdHJ1ZSk7XG59O1xuXG5DYXJkQ29udHJvbGxlci5wcm90b3R5cGUub25FbmRTaHVmZmxlQXVkaW8gPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHRoaXMuZW5kU2h1ZmZsZUF1ZGlvKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5lbmRTaHVmZmxlQXVkaW8gPSB0cnVlO1xuICAgIGdhbWUuYXVkaW9QbGF5ZXIuc3RvcEVmZmVjdChcImNhcmRfdHVyblwiKTtcbn07XG5cbkNhcmRDb250cm9sbGVyLnByb3RvdHlwZS5vblNodWZmbGVkID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICh0aGlzLnNodWZmbGVkKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY2MubG9nKFwiQ2FyZENvbnRyb2xsZXIucHJvdG90eXBlLm9uU2h1ZmZsZWRcIik7XG4gICAgdGhpcy5zaHVmZmxlZCA9IHRydWU7XG4gICAgZ2FtZS51dGlscy5zaHVmZmxlKHRoaXMuY2FyZExpc3QpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5jYXJkTm9kZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgdmFyIGNhcmROb2RlID0gdGhpcy5jYXJkTm9kZXNbaV07XG4gICAgICAgIGNhcmROb2RlLmNvbnRyb2xsZXIuZW5hYmxlZENsaWNrID0gdHJ1ZTtcbiAgICAgICAgY2FyZE5vZGUuY29udHJvbGxlci5pbml0V2l0aCh0aGlzLmNhcmRMaXN0W2ldLCB0aGlzLm9uU2hvd0NhcmRDYWxsYmFjay5iaW5kKHRoaXMpLCB0aGlzLm9uQ2FyZEFuaW1FbmRDYWxsYmFjay5iaW5kKHRoaXMpKTtcbiAgICB9XG59O1xuXG5DYXJkQ29udHJvbGxlci5wcm90b3R5cGUub25TaG93Q2FyZENhbGxiYWNrID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuY2FyZENvdW50Kys7XG4gICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJjYXJkX3R1cm5cIik7XG4gICAgaWYgKHRoaXMuY2FyZENvdW50ID49IDIpIHtcbiAgICAgICAgY2MubG9nKFwiQ2FyZENvbnRyb2xsZXIucHJvdG90eXBlLm9uU2hvd0NhcmRDYWxsYmFjayAxOlwiICsgdGhpcy5jYXJkQ291bnQpO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY2FyZE5vZGVzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB2YXIgY2FyZE5vZGUgPSB0aGlzLmNhcmROb2Rlc1tpXTtcbiAgICAgICAgICAgIGNhcmROb2RlLmNvbnRyb2xsZXIuZW5hYmxlZENsaWNrID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICBjYy5sb2coXCJDYXJkQ29udHJvbGxlci5wcm90b3R5cGUub25TaG93Q2FyZENhbGxiYWNrIDJcIik7XG4gICAgfVxufTtcblxuQ2FyZENvbnRyb2xsZXIucHJvdG90eXBlLm9uQ2FyZEFuaW1FbmRDYWxsYmFjayA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmNhcmRBbmltQ291bnQrKztcbiAgICBpZiAodGhpcy5jYXJkQW5pbUNvdW50ID49IDIpIHtcbiAgICAgICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJjYXJkX3R1cm5cIik7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5jYXJkTm9kZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciBjYXJkTm9kZSA9IHRoaXMuY2FyZE5vZGVzW2ldO1xuICAgICAgICAgICAgY2FyZE5vZGUuY29udHJvbGxlci5zdG9wQ2xhaW1lZCA9IHRydWU7XG4gICAgICAgICAgICBjYXJkTm9kZS5jb250cm9sbGVyLnNob3dDYXJkRnJvbnRBbmltKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5uZFdhdGNoLnZpc2libGUgPSB0cnVlO1xuICAgICAgICB0aGlzLm5kQ2xvc2UudmlzaWJsZSA9IHRydWU7XG4gICAgICAgIGdhbWUudXRpbHMucGxheUNDQkFuaW1hdGlvbih0aGlzLnJvb3ROb2RlLCBcInNob3dcIik7XG4gICAgfVxufTtcblxuQ2FyZENvbnRyb2xsZXIucHJvdG90eXBlLndhdGNoQWRzQ2xpY2tlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICAvLyB0aGlzLmNsb3NlKCk7XG4gICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5jaGVja0FuZFNob3dSZXdhcmRWaWRlbyhcImZsaXBfY2FyZF9hZ2FpblwiLCBmdW5jdGlvbiAod2F0Y2hlZCkge1xuICAgICAgICBpZiAod2F0Y2hlZCkge1xuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cENhcmQoKTtcbiAgICAgICAgfVxuICAgIH0uYmluZCh0aGlzKSk7XG59O1xuXG5DYXJkQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2VDbGlja2VkID0gZnVuY3Rpb24gKCkge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cbkNhcmRDb250cm9sbGVyLnByb3RvdHlwZS5wb3B1cCA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIucG9wdXAodGhpcy5yb290Tm9kZSwge3BvcHVwQW5pbTogdHJ1ZX0pO1xufTtcblxuQ2FyZENvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5jbG9zZSh0aGlzLnJvb3ROb2RlKTtcbn07XG5cbkNhcmRDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICBnYW1lLnV0aWxzLnJlZ2lzdGVyQ29udHJvbGxlcihcIkNhcmRJdGVtQ29udHJvbGxlclwiLCBuZXcgQ2FyZEl0ZW1Db250cm9sbGVyKCkpO1xuICAgIC8vdmFyIGNjYmlOYW1lID0gZ2FtZS51dGlscy5pc1NlbGZHYW1lKCkgPyBcInJlcy93aGVlbC93aGVlbF92aWV3LmNjYmlcIiA6IFwicmVzL3doZWVsL3doZWVsX3ZpZXdfbmV3LmNjYmlcIjtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL21lbnUvY2FyZHNfdmlldy5jY2JpXCIsIG51bGwsIFwiQ2FyZENvbnRyb2xsZXJcIiwgbmV3IENhcmRDb250cm9sbGVyKCkpO1xuICAgIGdhbWUudXRpbHMudW5SZWdpc3RlckNvbnRyb2xsZXIoXCJDYXJkSXRlbUNvbnRyb2xsZXJcIik7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IENhcmRDb250cm9sbGVyOyIsInZhciBCb29zdFR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9Cb29zdFR5cGVcIik7XG5cbnZhciBDYXJkSXRlbUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcblxuICAgIHRoaXMuQU5JTV9USU1FID0gMC40O1xuXG4gICAgdGhpcy5sYmxDb3VudCA9IG51bGw7XG4gICAgdGhpcy5zcENhcmRCYWNrID0gbnVsbDtcbiAgICB0aGlzLnNwQ2FyZEZyb250ID0gbnVsbDtcblxuICAgIHRoaXMuc3BEaWFtb25kID0gbnVsbDtcblxuICAgIHRoaXMubmRDYXJkQmFjayA9IG51bGw7XG4gICAgdGhpcy5uZENhcmRGcm9udCA9IG51bGw7XG5cbiAgICB0aGlzLmNhcmREYXRhID0gbnVsbDtcblxuICAgIHRoaXMuZW5hYmxlZENsaWNrID0gZmFsc2U7XG5cbiAgICB0aGlzLnN0b3BDbGFpbWVkID0gZmFsc2U7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKENhcmRJdGVtQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5DYXJkSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcbn07XG4vKipcbiAqIEBwYXJhbSB7Q2FyZENvbmZpZ30gZGF0YVxuICovXG4vL2RheSwgc3RhdGUsIHJld2FyZE9iaiwgY2xhaW1lZFxuQ2FyZEl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aCA9IGZ1bmN0aW9uIChkYXRhLCBzaG93Q2FyZENhbGxiYWNrLCBhbmltRW5kQ2FsbGJhY2spIHtcbiAgICB0aGlzLmNhcmREYXRhID0gZGF0YTtcbiAgICB0aGlzLmxibENvdW50LnNldFN0cmluZyhcInhcIiArIGRhdGEuY291bnQpO1xuICAgIHRoaXMuc2hvd0NhcmRDYWxsYmFjayA9IHNob3dDYXJkQ2FsbGJhY2s7XG4gICAgdGhpcy5hbmltRW5kQ2FsbGJhY2sgPSBhbmltRW5kQ2FsbGJhY2s7XG59O1xuXG5DYXJkSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLm9uQ2FyZENsaWNrZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCF0aGlzLmVuYWJsZWRDbGljaykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIHRoaXMuc2hvd0NhcmRGcm9udEFuaW0oKTtcbn07XG5cbkNhcmRJdGVtQ29udHJvbGxlci5wcm90b3R5cGUuc2hvd0NhcmRCYWNrID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMubmRDYXJkQmFjay52aXNpYmxlID0gdHJ1ZTtcbiAgICB0aGlzLm5kQ2FyZEZyb250LnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLm5kQ2FyZEJhY2suc2NhbGVYID0gMTtcbn07XG5cbkNhcmRJdGVtQ29udHJvbGxlci5wcm90b3R5cGUuc2hvd0NhcmRGcm9udCA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLm5kQ2FyZEJhY2sudmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMubmRDYXJkRnJvbnQudmlzaWJsZSA9IHRydWU7XG4gICAgdGhpcy5uZENhcmRGcm9udC5zY2FsZVggPSAxO1xufTtcblxuQ2FyZEl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5zaG93Q2FyZEZyb250QW5pbSA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAodGhpcy5jbGlja2VkKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5jbGlja2VkID0gdHJ1ZTtcbiAgICB0aGlzLnNob3dDYXJkQ2FsbGJhY2sgJiYgdGhpcy5zaG93Q2FyZENhbGxiYWNrKCk7XG4gICAgdGhpcy5uZENhcmRCYWNrLnZpc2libGUgPSB0cnVlO1xuICAgIHRoaXMubmRDYXJkRnJvbnQudmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMubmRDYXJkQmFjay5zY2FsZVggPSAxO1xuICAgIHRoaXMubmRDYXJkQmFjay5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoXG4gICAgICAgIGNjLnNjYWxlVG8odGhpcy5BTklNX1RJTUUsIDAsIDEpLFxuICAgICAgICBjYy5jYWxsRnVuYyh0aGlzLm9uQ2FyZEZyb250U2hvd2VkLCB0aGlzKVxuICAgICkpO1xufTtcblxuQ2FyZEl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5vbkNhcmRGcm9udFNob3dlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLm5kQ2FyZEZyb250LnZpc2libGUgPSB0cnVlO1xuICAgIHRoaXMubmRDYXJkQmFjay52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5uZENhcmRGcm9udC5zY2FsZVggPSAwO1xuICAgIHRoaXMubmRDYXJkRnJvbnQucnVuQWN0aW9uKGNjLnNlcXVlbmNlKFxuICAgICAgICBjYy5zY2FsZVRvKHRoaXMuQU5JTV9USU1FLCAxLCAxKSxcbiAgICAgICAgY2MuY2FsbEZ1bmModGhpcy5vbkNhcmRTaG93ZWQsIHRoaXMpXG4gICAgKSk7XG59O1xuXG5DYXJkSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLm9uQ2FyZFNob3dlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAodGhpcy5zdG9wQ2xhaW1lZCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBkaWFtb25kUG9zID0gdGhpcy5zcERpYW1vbmQucGFyZW50LmNvbnZlcnRUb1dvcmxkU3BhY2UodGhpcy5zcERpYW1vbmQuZ2V0UG9zaXRpb24oKSk7XG4gICAgdmFyIGRpYW1uZEVuZFBvcyA9IGNjLnAoY2Mud2luU2l6ZS53aWR0aCAtIDgwLCBjYy53aW5TaXplLmhlaWdodCAtIDYwKTtcbiAgICBnYW1lLmVmZmVjdE1hbi5wbGF5Rmx5Q29pbnMoZGlhbW9uZFBvcywgZGlhbW5kRW5kUG9zLCAxMCwgMTAwMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICBnYW1lLnBsYXllck1hbi5hZGREaWFtb25kcyh0aGlzLmNhcmREYXRhLmNvdW50LCBcImNhcmRfZmxpcFwiKTtcbiAgICB9LmJpbmQodGhpcyksIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy90aGlzLm5kQ2xhaW1EaWFtb25kcy5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoY2MuZGVsYXlUaW1lKDEpLCBjYy5mYWRlT3V0KDAuMykpKTtcbiAgICAgICAgdGhpcy5hbmltRW5kQ2FsbGJhY2sgJiYgdGhpcy5hbmltRW5kQ2FsbGJhY2soKTtcbiAgICB9LmJpbmQodGhpcykpO1xufTtcblxuQ2FyZEl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5zaG93Q2FyZEJhY2tBbmltID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMubmRDYXJkQmFjay52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5uZENhcmRGcm9udC52aXNpYmxlID0gdHJ1ZTtcbiAgICB0aGlzLm5kQ2FyZEZyb250LnNjYWxlWCA9IDE7XG4gICAgdGhpcy5uZENhcmRGcm9udC5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoXG4gICAgICAgIGNjLnNjYWxlVG8odGhpcy5BTklNX1RJTUUsIDAsIDEpLFxuICAgICAgICBjYy5jYWxsRnVuYyh0aGlzLm9uQ2FyZEJhY2tTaG93ZWQsIHRoaXMpXG4gICAgKSk7XG59O1xuXG5DYXJkSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLm9uQ2FyZEJhY2tTaG93ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5uZENhcmRGcm9udC52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5uZENhcmRCYWNrLnZpc2libGUgPSB0cnVlO1xuICAgIHRoaXMubmRDYXJkQmFjay5zY2FsZVggPSAwO1xuICAgIHRoaXMubmRDYXJkQmFjay5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoXG4gICAgICAgY2Muc2NhbGVUbyh0aGlzLkFOSU1fVElNRSwgMSwgMSksXG4gICAgICAgIGNjLmNhbGxGdW5jKHRoaXMub25DYXJkQmFja2VkLCB0aGlzKVxuICAgICkpO1xufTtcblxuQ2FyZEl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5vbkNhcmRCYWNrZWQgPSBmdW5jdGlvbiAoKSB7XG5cbn07XG5cbkNhcmRJdGVtQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL21lbnUvZGFpbHlfYm9udXNfaXRlbV92aWV3LmNjYmlcIiwgbnVsbCwgXCJDYXJkSXRlbUNvbnRyb2xsZXJcIiwgbmV3IENhcmRJdGVtQ29udHJvbGxlcigpKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQ2FyZEl0ZW1Db250cm9sbGVyOyIsInZhciBDaGFsbGVuZ2VMZXZlbENvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi9DaGFsbGVuZ2VMZXZlbENvbnRyb2xsZXJcIik7XG5cbnZhciBDaGFsbGVuZ2VDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG5cbiAgICB0aGlzLkxFVkVMX0NPVU5UID0gMjU7XG5cbiAgICB0aGlzLmN1cnJlbnRDaGFsbGVuZ2VOb2RlID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoQ2hhbGxlbmdlQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5DaGFsbGVuZ2VDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG4gICAgaWYgKCFnYW1lLnV0aWxzLmlzUGFkKCkpIHtcbiAgICAgICAgdGhpcy5yb290Tm9kZS5zY2FsZSA9IDY0MC4wIC8gNzY4LjA7XG4gICAgfVxuICAgIHZhciBsYXN0Tm9kZSA9IG51bGw7XG4gICAgZm9yICh2YXIgaSA9IDE7IGkgPD0gdGhpcy5MRVZFTF9DT1VOVDsgKytpKSB7XG4gICAgICAgIGNjLmxvZyhcIkNoYWxsZW5nZUNvbnRyb2xsZXIgbGV2ZWw6XCIgKyBpKTtcbiAgICAgICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLnNlZWtOb2RlQnlUYWcodGhpcy5yb290Tm9kZSwgaSk7XG4gICAgICAgIHZhciBjb25maWcgPSBnYW1lLmNoYWxsZW5nZU1hbi5nZXRMZXZlbENvbmZpZyhpKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLmluaXRXaXRoTGV2ZWwoaSwgY29uZmlnKTtcblxuICAgICAgICBpZiAoaSA9PT0gZ2FtZS5jaGFsbGVuZ2VNYW4uZ2V0Q2hhbGxlbmdlTGV2ZWwoKSkge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50Q2hhbGxlbmdlTm9kZSA9IG5vZGU7XG4gICAgICAgIH1cbiAgICAgICAgbGFzdE5vZGUgPSBub2RlO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5jdXJyZW50Q2hhbGxlbmdlTm9kZSkge1xuICAgICAgICB0aGlzLmN1cnJlbnRDaGFsbGVuZ2VOb2RlID0gbGFzdE5vZGU7XG4gICAgfVxufTtcblxuQ2hhbGxlbmdlQ29udHJvbGxlci5wcm90b3R5cGUuZ2V0Q3VycmVudENoYWxsZW5nZU5vZGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudENoYWxsZW5nZU5vZGU7XG59O1xuXG5DaGFsbGVuZ2VDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICBjYy5CdWlsZGVyUmVhZGVyLnJlZ2lzdGVyQ29udHJvbGxlcihcIkNoYWxsZW5nZUxldmVsQ29udHJvbGxlclwiLCBuZXcgQ2hhbGxlbmdlTGV2ZWxDb250cm9sbGVyKCkpO1xuICAgIHZhciBub2RlID0gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvYWN0aXZpdHkvYWN0aXZpdHlfdmlldy5jY2JpXCIsIG51bGwsIFwiQ2hhbGxlbmdlQ29udHJvbGxlclwiLCBuZXcgQ2hhbGxlbmdlQ29udHJvbGxlcigpKTtcbiAgICBjYy5CdWlsZGVyUmVhZGVyLl9jb250cm9sbGVyQ2xhc3NDYWNoZVtcIkNoYWxsZW5nZUxldmVsQ29udHJvbGxlclwiXSA9IHVuZGVmaW5lZDtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQ2hhbGxlbmdlQ29udHJvbGxlcjsiLCJ2YXIgU2tpblJld2FyZFR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9Ta2luUmV3YXJkVHlwZVwiKTtcbnZhciBFdmVudHNOYW1lID0gcmVxdWlyZShcIi4uL2V2ZW50cy9FdmVudHNOYW1lXCIpO1xudmFyIEJvb3N0VHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL0Jvb3N0VHlwZVwiKTtcbnZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcbnZhciBDb25maWdNYW4gPSByZXF1aXJlKFwiLi4vY29uZmlnL0NvbmZpZ01hblwiKTtcblxudmFyIENoYWxsZW5nZUl0ZW1Db250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG5cbiAgICB0aGlzLnNwckNoYWxsZW5nZUljb24gPSBudWxsO1xuICAgIHRoaXMubGJDaGFsbGVuZ2VOdW0gPSBudWxsO1xuICAgIHRoaXMubGJCdG5UaXRsZSA9IG51bGw7XG4gICAgdGhpcy5idG5DaGFsbGVuZ2UgPSBudWxsO1xuICAgIHRoaXMubGJOYW1lID0gbnVsbDtcblxuICAgIHRoaXMubGJVbmxvY2tUaXBzID0gbnVsbDtcbiAgICB0aGlzLnNwckNoYWxsZW5nZUdyYXlJY29uID0gbnVsbDtcblxuICAgIHRoaXMubmROb3JtYWwgPSBudWxsO1xuICAgIHRoaXMubmRHcmF5ID0gbnVsbDtcblxuICAgIHRoaXMuaWR4ID0gMDtcbiAgICB0aGlzLmNoYWxsZW5nZUNmZyA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKENoYWxsZW5nZUl0ZW1Db250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbkNoYWxsZW5nZUl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG59O1xuLyoqXG4gKiBAcGFyYW0ge1Rhc2tDb25maWd9IGRhdGFcbiAqIEBwYXJhbSB7bnVtYmVyfSBpZHhcbiAqL1xuQ2hhbGxlbmdlSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLmluaXRXaXRoID0gZnVuY3Rpb24gKGRhdGEsIGlkeCkge1xuICAgIHRoaXMuaWR4ID0gaWR4O1xuICAgIHRoaXMuY2hhbGxlbmdlQ2ZnID0gZGF0YTtcbiAgICB0aGlzLnJlZnJlc2goKTtcbn07XG5cbkNoYWxsZW5nZUl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5yZWZyZXNoID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBkYXRhID0gdGhpcy5jaGFsbGVuZ2VDZmc7XG5cbiAgICB0aGlzLm5kTm9ybWFsLnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLm5kR3JheS52aXNpYmxlID0gZmFsc2U7XG5cbiAgICB2YXIgc3ByaXRlRnJhbWU7XG4gICAgaWYgKGdhbWUuY2hhbGxlbmdlTWFuLmlzQ2hhbGxlbmdlVW5sb2NrZWQodGhpcy5jaGFsbGVuZ2VDZmcuaWQpKSB7XG4gICAgICAgIHRoaXMubmROb3JtYWwudmlzaWJsZSA9IHRydWU7XG5cbiAgICAgICAgc3ByaXRlRnJhbWUgPSBjYy5zcHJpdGVGcmFtZUNhY2hlLmdldFNwcml0ZUZyYW1lKGRhdGEuaW1hZ2UgKyBcIi5wbmdcIik7XG4gICAgICAgIHRoaXMuc3ByQ2hhbGxlbmdlSWNvbi5zZXRTcHJpdGVGcmFtZShzcHJpdGVGcmFtZSk7XG5cbiAgICAgICAgdmFyIGNoYWxsZW5nZUxldmVsID0gZ2FtZS5wbGF5ZXJNYW4uZ2V0T3JDcmVhdGVDaGFsbGVuZ2UoZGF0YS5pZCkuY2hhbGxlbmdlTGV2ZWw7XG4gICAgICAgIHZhciBjaGFsbGVuZ2VMaXN0ID0gQ29uZmlnTWFuLmdldEluc3RhbmNlKCkuZ2V0Q2hhbGxlbmdlTGV2ZWxMaXN0KGRhdGEuaWQpO1xuICAgICAgICBpZiAoY2hhbGxlbmdlTGV2ZWwgPiBjaGFsbGVuZ2VMaXN0Lmxlbmd0aCkge1xuICAgICAgICAgICAgY2hhbGxlbmdlTGV2ZWwgPSBjaGFsbGVuZ2VMaXN0Lmxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxiQ2hhbGxlbmdlTnVtLnNldFN0cmluZyhjaGFsbGVuZ2VMZXZlbCArIFwiL1wiICsgY2hhbGxlbmdlTGlzdC5sZW5ndGgpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubmRHcmF5LnZpc2libGUgPSB0cnVlO1xuICAgICAgICBzcHJpdGVGcmFtZSA9IGNjLnNwcml0ZUZyYW1lQ2FjaGUuZ2V0U3ByaXRlRnJhbWUoZGF0YS5ncmF5SW1hZ2UgKyBcIi5wbmdcIik7XG4gICAgICAgIHRoaXMuc3ByQ2hhbGxlbmdlR3JheUljb24uc2V0U3ByaXRlRnJhbWUoc3ByaXRlRnJhbWUpO1xuICAgICAgICB0aGlzLmxiVW5sb2NrVGlwcy5zZXRTdHJpbmcoZ2FtZS51dGlscy5zcHJpbnRmKF8oXCJ1bmxvY2tfdGlwc1wiKSwgdGhpcy5jaGFsbGVuZ2VDZmcubGV2ZWxMaW1pdCkpO1xuICAgIH1cblxuICAgIHRoaXMubGJOYW1lLnNldFN0cmluZyhfKGRhdGEubmFtZUtleSkpO1xufTtcblxuQ2hhbGxlbmdlSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLmdldENvbnRlbnRTaXplID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLnNwQmdTZWxlY3RlZC5nZXRDb250ZW50U2l6ZSgpO1xufTtcblxuQ2hhbGxlbmdlSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLmVudGVyQ2xpY2tlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBnYW1lLmNoYWxsZW5nZU1hbi5jdXJyZW50Q2hhbGxlbmdlSWQgPSB0aGlzLmNoYWxsZW5nZUNmZy5pZDtcbiAgICBnYW1lLnNjZW5lTWFuLnN3aXRjaFNjZW5lKGdhbWUuc2NlbmVUeXBlLkNIQUxMRU5HRSk7XG4gICAgLy8gY2MubG9nKFwidGFzayBjbGFpbWVkOlwiICsgZ2FtZS5wbGF5ZXJNYW4uaXNUYXNrQ2xhaW1lZCh0aGlzLnRhc2tDZmcuaWQpKTtcbiAgICAvLyBpZiAoIWdhbWUucGxheWVyTWFuLmlzVGFza0NsYWltZWQodGhpcy50YXNrQ2ZnLmlkKSkge1xuICAgIC8vICAgICBjYy5sb2coXCJ0YXNrIHNldCBjbGFpbWVkOlwiICsgdGhpcy50YXNrQ2ZnLmlkKTtcbiAgICAvLyAgICAgZ2FtZS5wbGF5ZXJNYW4uc2V0VGFza0NsYWltZWQodGhpcy50YXNrQ2ZnLmlkKTtcbiAgICAvLyAgICAgdmFyIHJld2FyZENvdW50ID0gdGhpcy50YXNrQ2ZnLnJld2FyZENvdW50O1xuICAgIC8vICAgICBTdG9yZUhlbHBlci5nZXRJbnN0YW5jZSgpLnBvcHVwUmV3YXJkRG91YmxlRGxnKHJld2FyZENvdW50LCBCb29zdFR5cGUuRElBTU9ORCwgIGdhbWUudXRpbHMuaXNJT1MoKSA/IFwidGFza3NcIiA6IFwidGFza3NcIiwgZnVuY3Rpb24gKCkge1xuICAgIC8vICAgICB9LmJpbmQodGhpcykpO1xuICAgIC8vICAgICB0aGlzLnJlZnJlc2goKTtcbiAgICAvLyAgICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChFdmVudHNOYW1lLlRBU0tfVVBEQVRFKTtcbiAgICAvLyB9XG59O1xuXG5DaGFsbGVuZ2VJdGVtQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL2FjdGl2aXR5L3BhdHRlcm5faXRlbV92aWV3LmNjYmlcIiwgbnVsbCwgXCJDaGFsbGVuZ2VJdGVtQ29udHJvbGxlclwiLCBuZXcgQ2hhbGxlbmdlSXRlbUNvbnRyb2xsZXIoKSk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IENoYWxsZW5nZUl0ZW1Db250cm9sbGVyOyIsInZhciBSZXdhcmRQb3B1cENvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi9SZXdhcmRQb3B1cENvbnRyb2xsZXJcIik7XG5cbnZhciBDaGFsbGVuZ2VMZXZlbENvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcbiAgICB0aGlzLnNwTG9ja2VkID0gbnVsbDtcbiAgICB0aGlzLnNwQ3VycmVudCA9IG51bGw7XG4gICAgdGhpcy5zcENvbXBsZXRlZCA9IG51bGw7XG5cbiAgICB0aGlzLmxiTGV2ZWwgPSBudWxsO1xuXG4gICAgdGhpcy5uZEdpZnQgPSBudWxsO1xuICAgIHRoaXMuc3ByR2lmdE5vcm1hbCA9IG51bGw7XG4gICAgdGhpcy5zcHJHaWZ0R3JheSA9IG51bGw7XG5cbiAgICB0aGlzLm5kTmV4dEdpZnQgPSBudWxsO1xuICAgIHRoaXMubmRDdXJyZW50R2lmdCA9IG51bGw7XG4gICAgdGhpcy5uZE9wZW5lZEdpZnQgPSBudWxsO1xuICAgIHRoaXMubmRHaWZ0RmluYWwgPSBudWxsO1xuXG4gICAgdGhpcy5uZEdpZnRGaW5hbE9wZW5lZCA9IG51bGw7XG4gICAgdGhpcy5uZEdpZnRGaW5hbENsb3NlZCA9IG51bGw7XG5cbiAgICB0aGlzLmxldmVsQ29uZmlnID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoQ2hhbGxlbmdlTGV2ZWxDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbkNoYWxsZW5nZUxldmVsQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xufTtcblxuQ2hhbGxlbmdlTGV2ZWxDb250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aExldmVsID0gZnVuY3Rpb24gKGxldmVsSWQsIGxldmVsQ29uZmlnKSB7XG4gICAgdGhpcy5sZXZlbENvbmZpZyA9IGxldmVsQ29uZmlnO1xuICAgIGxldmVsQ29uZmlnLmxldmVsSWQgPSBsZXZlbElkO1xuICAgIHZhciBjdXJyZW50TGV2ZWwgPSBnYW1lLmNoYWxsZW5nZU1hbi5nZXRDaGFsbGVuZ2VMZXZlbCgpO1xuICAgIHRoaXMuc3BMb2NrZWQudmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMuc3BDdXJyZW50LnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLnNwQ29tcGxldGVkLnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLmxiTGV2ZWwuc2V0U3RyaW5nKGxldmVsSWQpO1xuICAgIGlmIChsZXZlbElkID4gY3VycmVudExldmVsKSB7XG4gICAgICAgIC8vbG9ja2VkXG4gICAgICAgIHRoaXMuc3BMb2NrZWQudmlzaWJsZSA9IHRydWU7XG4gICAgfSBlbHNlIGlmIChsZXZlbElkID09PSBjdXJyZW50TGV2ZWwpIHtcbiAgICAgICAgLy9jdXJyZW50XG4gICAgICAgIHRoaXMuc3BDdXJyZW50LnZpc2libGUgPSB0cnVlO1xuICAgICAgICBnYW1lLnV0aWxzLnBsYXlDQ0JBbmltYXRpb24odGhpcy5yb290Tm9kZSwgXCJjdXJyZW50XCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vY29tcGxldGVkXG4gICAgICAgIHRoaXMuc3BDb21wbGV0ZWQudmlzaWJsZSA9IHRydWU7XG4gICAgfVxuXG4gICAgaWYgKGxldmVsSWQgJSA1ID09PSAwKSB7XG4gICAgICAgIHRoaXMubmRHaWZ0LnZpc2libGUgPSB0cnVlO1xuICAgICAgICB2YXIgbWlsZXN0b25lSWQgPSB0aGlzLmxldmVsQ29uZmlnLmxldmVsSWQgLyA1O1xuICAgICAgICB0aGlzLm5kTmV4dEdpZnQudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLm5kQ3VycmVudEdpZnQudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLm5kT3BlbmVkR2lmdC52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMubmRHaWZ0RmluYWwudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICBjYy5sb2coXCJjdXJyZW50OlwiICsgZ2FtZS5jaGFsbGVuZ2VNYW4uZ2V0Q3VycmVudE1pbGVzdG9uZUlkKCkpO1xuICAgICAgICBpZiAodGhpcy5sZXZlbENvbmZpZy5sZXZlbElkID09PSAyNSkge1xuICAgICAgICAgICAgdGhpcy5uZEdpZnRGaW5hbC52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuc3BMb2NrZWQudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5zcEN1cnJlbnQudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5zcENvbXBsZXRlZC52aXNpYmxlID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGlmIChnYW1lLmNoYWxsZW5nZU1hbi5pc01pbGVzdG9uZVBhc3NlZChtaWxlc3RvbmVJZCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm5kR2lmdEZpbmFsT3BlbmVkLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLm5kR2lmdEZpbmFsQ2xvc2VkLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLm5kR2lmdEZpbmFsT3BlbmVkLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMubmRHaWZ0RmluYWxDbG9zZWQudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGdhbWUuY2hhbGxlbmdlTWFuLmlzTWlsZXN0b25lUGFzc2VkKG1pbGVzdG9uZUlkKSkge1xuICAgICAgICAgICAgdGhpcy5uZE9wZW5lZEdpZnQudmlzaWJsZSA9IHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoZ2FtZS5jaGFsbGVuZ2VNYW4uZ2V0Q3VycmVudE1pbGVzdG9uZUlkKCkgPT09IG1pbGVzdG9uZUlkKSB7XG4gICAgICAgICAgICB0aGlzLm5kQ3VycmVudEdpZnQudmlzaWJsZSA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm5kTmV4dEdpZnQudmlzaWJsZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sYkxldmVsLnZpc2libGUgPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLm5kR2lmdC52aXNpYmxlID0gZmFsc2U7XG4gICAgfVxufTtcblxuQ2hhbGxlbmdlTGV2ZWxDb250cm9sbGVyLnByb3RvdHlwZS5vbkxldmVsQ2xpY2tlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB2YXIgY3VycmVudExldmVsID0gZ2FtZS5jaGFsbGVuZ2VNYW4uZ2V0Q2hhbGxlbmdlTGV2ZWwoKTtcbiAgICBpZiAodGhpcy5sZXZlbENvbmZpZy5sZXZlbElkID09PSBjdXJyZW50TGV2ZWwpIHtcbiAgICAgICAgLy9lbnRlciBnYW1lLlxuICAgICAgICBnYW1lLmdhbWVNYW4uY2hvb3NlTGV2ZWwoY3VycmVudExldmVsKTtcbiAgICAgICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5HQU1FKTtcblxuICAgICAgICBpZiAoKHRoaXMubGV2ZWxDb25maWcubGV2ZWxJZCAtIDEpICUgNSA9PT0gMCkge1xuICAgICAgICAgICAgdmFyIG1pbGVzdG9uZUlkID0gKHRoaXMubGV2ZWxDb25maWcubGV2ZWxJZCAtIDEpIC8gNSArIDE7XG4gICAgICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRXZlbnQoXCJDaGFsbGVuZ2VFbnRlckxldmVsXCIsIHtcImlkXCI6IG1pbGVzdG9uZUlkfSk7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICBpZiAodGhpcy5sZXZlbENvbmZpZy5sZXZlbElkICUgNSA9PT0gMCkge1xuICAgICAgICAgICAgdmFyIG1pbGVzdG9uZUlkID0gdGhpcy5sZXZlbENvbmZpZy5sZXZlbElkIC8gNTtcbiAgICAgICAgICAgIGlmIChnYW1lLmNoYWxsZW5nZU1hbi5nZXRDdXJyZW50TWlsZXN0b25lSWQoKSA9PT0gbWlsZXN0b25lSWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2Nyb2xsVmlld0NvbnRhaW5lciA9IHRoaXMucm9vdE5vZGUucGFyZW50O1xuICAgICAgICAgICAgICAgIHZhciBwb3MgPSBzY3JvbGxWaWV3Q29udGFpbmVyLmNvbnZlcnRUb05vZGVTcGFjZSh0aGlzLnJvb3ROb2RlLmNvbnZlcnRUb1dvcmxkU3BhY2UoY2MucCgwLCAwKSkpO1xuICAgICAgICAgICAgICAgIHBvcyA9IGNjLnBBZGQocG9zLCBjYy5wKDAsIDUwKSk7XG4gICAgICAgICAgICAgICAgdmFyIGNoYWxsZW5nZSA9IGdhbWUuY2hhbGxlbmdlTWFuLmdldENoYWxsZW5nZShtaWxlc3RvbmVJZCk7XG4gICAgICAgICAgICAgICAgUmV3YXJkUG9wdXBDb250cm9sbGVyLmNyZWF0ZUFuZFBvcChjaGFsbGVuZ2UucmV3YXJkcywgc2Nyb2xsVmlld0NvbnRhaW5lciwgcG9zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQ2hhbGxlbmdlTGV2ZWxDb250cm9sbGVyOyIsIi8vIHZhciBUYXNrSXRlbUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi9UYXNrSXRlbUNvbnRyb2xsZXJcIik7XG52YXIgQ2hhbGxlbmdlSXRlbUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi9DaGFsbGVuZ2VJdGVtQ29udHJvbGxlclwiKTtcbnZhciBDb25maWdNYW4gPSByZXF1aXJlKFwiLi4vY29uZmlnL0NvbmZpZ01hblwiKTtcbnZhciBFdmVudHNOYW1lID0gcmVxdWlyZShcIi4uL2V2ZW50cy9FdmVudHNOYW1lXCIpO1xudmFyIE11bHRpQ29sVGFibGVWaWV3ID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi9leHQvTXVsdGlDb2xUYWJsZVZpZXdcIik7XG5cbnZhciBHUklEX1NJWkUgPSBjYy5zaXplKDU0MCwgMjMwKTtcblxudmFyIFN0b3JlSXRlbUNlbGxWaWV3ID0gY2MuVGFibGVWaWV3Q2VsbC5leHRlbmQoe1xuICAgIGVudGl0eTogbnVsbCxcbiAgICBpdGVtTm9kZTogbnVsbCxcbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICAgIHRoaXMuaXRlbU5vZGUgPSBDaGFsbGVuZ2VJdGVtQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG4gICAgICAgIHRoaXMuYWRkQ2hpbGQodGhpcy5pdGVtTm9kZSk7XG4gICAgICAgIHRoaXMuaXRlbU5vZGUuc2V0UG9zaXRpb24oY2MucChHUklEX1NJWkUud2lkdGggKiAwLjUsIEdSSURfU0laRS5oZWlnaHQgKiAwLjUpKTtcbiAgICB9LFxuXG4gICAgaW5pdFdpdGg6IGZ1bmN0aW9uIChlbnRpdHksIGlkeCkge1xuICAgICAgICB0aGlzLmVudGl0eSA9IGVudGl0eTtcbiAgICAgICAgdGhpcy5pdGVtTm9kZS5jb250cm9sbGVyLmluaXRXaXRoKGVudGl0eSwgaWR4KTtcbiAgICB9XG59KTtcblxudmFyIENoYWxsZW5nZUxpc3RDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG4gICAgdGhpcy5uZENvbnRhaW5lciA9IG51bGw7XG5cbiAgICAvLyB0aGlzLmxibFRpdGxlID0gbnVsbDtcblxuICAgIHRoaXMuX3RhYmxlVmlldyA9IG51bGw7XG5cbiAgICAvL3VzZXIgZGF0YS5cbiAgICB0aGlzLmNvbmZpZ3MgPSBudWxsO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhDaGFsbGVuZ2VMaXN0Q29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5DaGFsbGVuZ2VMaXN0Q29udHJvbGxlci5wcm90b3R5cGUub25FbnRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlci5jYWxsKHRoaXMpO1xufTtcblxuQ2hhbGxlbmdlTGlzdENvbnRyb2xsZXIucHJvdG90eXBlLm9uRXhpdCA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0LmNhbGwodGhpcyk7XG59O1xuXG5DaGFsbGVuZ2VMaXN0Q29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuXG4gICAgZ2FtZS5nYW1lTWFuLmlzQ2hhbGxlbmdlTGV2ZWwgPSB0cnVlO1xuICAgIGdhbWUucGxheWVyTWFuLnNldENoYWxsZW5nZVVubG9ja1RpcHNTaG93ZWQoKTtcbiAgICBnYW1lLnBsYXllck1hbi5zZXRDaGFsbGVuZ2VFbnRlcmVkKCk7XG5cbiAgICB0aGlzLmNvbmZpZ3MgPSBDb25maWdNYW4uZ2V0SW5zdGFuY2UoKS5nZXRDaGFsbGVuZ2UoKS5jaGFsbGVuZ2VzO1xuICAgIHRoaXMuc2hvd1RhYmxlVmlldygpO1xufTtcblxuQ2hhbGxlbmdlTGlzdENvbnRyb2xsZXIucHJvdG90eXBlLm9uVXBkYXRlU2tpbiA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgIHRoaXMuc2hvd1RhYmxlVmlldygpO1xufTtcblxuQ2hhbGxlbmdlTGlzdENvbnRyb2xsZXIucHJvdG90eXBlLnNob3dUYWJsZVZpZXcgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCF0aGlzLl90YWJsZVZpZXcpIHtcbiAgICAgICAgdmFyIHNpemUgPSB0aGlzLm5kQ29udGFpbmVyLmdldENvbnRlbnRTaXplKCk7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldyA9IG5ldyBNdWx0aUNvbFRhYmxlVmlldyh0aGlzLCBzaXplLCBudWxsKTtcbiAgICAgICAgdGhpcy5fdGFibGVWaWV3LnNldERpcmVjdGlvbihjYy5TQ1JPTExWSUVXX0RJUkVDVElPTl9WRVJUSUNBTCk7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5zZXRWZXJ0aWNhbEZpbGxPcmRlcihjYy5UQUJMRVZJRVdfRklMTF9UT1BET1dOKTtcbiAgICAgICAgdGhpcy5fdGFibGVWaWV3LnNldE11bHRpVGFibGVWaWV3RGVsZWdhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5pZ25vcmVBbmNob3JQb2ludEZvclBvc2l0aW9uKGZhbHNlKTtcbiAgICAgICAgdGhpcy5fdGFibGVWaWV3LnNldEFuY2hvclBvaW50KGNjLnAoMCwgMCkpO1xuICAgICAgICB0aGlzLm5kQ29udGFpbmVyLmFkZENoaWxkKHRoaXMuX3RhYmxlVmlldyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5fb2Zmc2V0ID0gdGhpcy5fdGFibGVWaWV3LmdldENvbnRlbnRPZmZzZXQoKTtcbiAgICB9XG4gICAgdGhpcy5fdGFibGVWaWV3LnJlbG9hZERhdGEoKTtcbiAgICBpZiAodGhpcy5fb2Zmc2V0KSB7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5zZXRDb250ZW50T2Zmc2V0KHRoaXMuX29mZnNldCk7XG4gICAgICAgIHRoaXMuX29mZnNldCA9IG51bGw7XG4gICAgfVxufTtcblxuQ2hhbGxlbmdlTGlzdENvbnRyb2xsZXIucHJvdG90eXBlLnNjcm9sbFZpZXdEaWRTY3JvbGwgPSBmdW5jdGlvbiAodmlldykge1xufTtcblxuQ2hhbGxlbmdlTGlzdENvbnRyb2xsZXIucHJvdG90eXBlLnNjcm9sbFZpZXdEaWRab29tID0gZnVuY3Rpb24gKHZpZXcpIHtcbn07XG5cbkNoYWxsZW5nZUxpc3RDb250cm9sbGVyLnByb3RvdHlwZS5ncmlkQXRJbmRleCA9IGZ1bmN0aW9uKG11bHRpVGFibGUsICBpZHgpIHtcbiAgICB2YXIgY2VsbCA9IG11bHRpVGFibGUuZGVxdWV1ZUdyaWQoKTtcbiAgICBpZiAoIWNlbGwpIHtcbiAgICAgICAgY2VsbCA9IG5ldyBTdG9yZUl0ZW1DZWxsVmlldygpO1xuICAgIH1cblxuICAgIGlmIChpZHggPCB0aGlzLmNvbmZpZ3MubGVuZ3RoKSB7XG4gICAgICAgIHZhciBza2luQ2ZnID0gdGhpcy5jb25maWdzW2lkeF07XG4gICAgICAgIGNlbGwuaW5pdFdpdGgoc2tpbkNmZywgaWR4KTtcbiAgICAgICAgY2VsbC52aXNpYmxlID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBjZWxsLnZpc2libGUgPSBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gY2VsbDtcbn07XG5cbkNoYWxsZW5nZUxpc3RDb250cm9sbGVyLnByb3RvdHlwZS5udW1iZXJPZkNlbGxzSW5UYWJsZVZpZXcgPSBmdW5jdGlvbihtdWx0aVRhYmxlKSB7XG4gICAgdmFyIGdyaWRzSW5DZWxsID0gdGhpcy5udW1iZXJPZkdyaWRzSW5DZWxsKG11bHRpVGFibGUpO1xuICAgIHJldHVybiBNYXRoLmNlaWwodGhpcy5jb25maWdzLmxlbmd0aCAvIGdyaWRzSW5DZWxsKTtcbn07XG5cbkNoYWxsZW5nZUxpc3RDb250cm9sbGVyLnByb3RvdHlwZS5udW1iZXJPZkdyaWRzSW5DZWxsID0gZnVuY3Rpb24obXVsdGlUYWJsZSwgY29sSWR4KSB7XG4gICAgcmV0dXJuIDE7XG59O1xuXG5DaGFsbGVuZ2VMaXN0Q29udHJvbGxlci5wcm90b3R5cGUuZ3JpZFNpemVGb3JUYWJsZSA9IGZ1bmN0aW9uKHRhYmxlLCBjb2xJZHgpIHtcbiAgICByZXR1cm4gY2Muc2l6ZShHUklEX1NJWkUud2lkdGgsIEdSSURfU0laRS5oZWlnaHQpO1xufTtcblxuQ2hhbGxlbmdlTGlzdENvbnRyb2xsZXIucHJvdG90eXBlLmdyaWRUb3VjaGVkID0gZnVuY3Rpb24odGFibGUsIGdyaWQpIHtcbn07XG5cbkNoYWxsZW5nZUxpc3RDb250cm9sbGVyLnByb3RvdHlwZS5iYWNrQ2xpY2tlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBnYW1lLnNjZW5lTWFuLnN3aXRjaFNjZW5lKGdhbWUuc2NlbmVUeXBlLk1FTlUpO1xufTtcblxuLy8gQ2hhbGxlbmdlTGlzdENvbnRyb2xsZXIucHJvdG90eXBlLnBvcHVwID0gZnVuY3Rpb24gKCkge1xuLy8gICAgIGdhbWUuZGlhbG9nTWFuYWdlci5wb3B1cCh0aGlzLnJvb3ROb2RlLCB7cG9wdXBBbmltOiB0cnVlfSk7XG4vLyB9O1xuLy9cbi8vIENoYWxsZW5nZUxpc3RDb250cm9sbGVyLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbi8vICAgICBnYW1lLmRpYWxvZ01hbmFnZXIuY2xvc2UodGhpcy5yb290Tm9kZSk7XG4vLyB9O1xuLy9cbi8vIENoYWxsZW5nZUxpc3RDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQgPSBmdW5jdGlvbiAoKSB7XG4vLyAgICAgLy9pZiAodGhpcy5jbG9zZUNhbGxiYWNrKSB7XG4vLyAgICAgLy8gICAgdGhpcy5jbG9zZUNhbGxiYWNrKCk7XG4vLyAgICAgLy8gICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gbnVsbDtcbi8vICAgICAvL31cbi8vIH07XG5cbkNoYWxsZW5nZUxpc3RDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL2FjdGl2aXR5L2FjdGl2aXR5X2NoYWxsZW5nZV92aWV3LmNjYmlcIiwgbnVsbCwgXCJDaGFsbGVuZ2VMaXN0Q29udHJvbGxlclwiLCBuZXcgQ2hhbGxlbmdlTGlzdENvbnRyb2xsZXIoKSk7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IENoYWxsZW5nZUxpc3RDb250cm9sbGVyOyIsInZhciBDaGFsbGVuZ2VDb250cm9sbGVyID0gcmVxdWlyZShcIi4vQ2hhbGxlbmdlQ29udHJvbGxlclwiKTtcblxudmFyIENoYWxsZW5nZVBhcmVudENvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcbiAgICB0aGlzLm5kQ29udGFpbmVyID0gbnVsbDtcbiAgICB0aGlzLmxiQ2hhbGxlbmdlTmFtZSA9IG51bGw7XG5cbiAgICB0aGlzLnNjcm9sbFZpZXcgPSBudWxsO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhDaGFsbGVuZ2VQYXJlbnRDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbkNoYWxsZW5nZVBhcmVudENvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcblxuICAgIHZhciBjaGFsbGVuZ2VJbmZvQ2ZnID0gZ2FtZS5jaGFsbGVuZ2VNYW4uZ2V0Q2hhbGxlbmdlSW5mb0NmZyhnYW1lLmNoYWxsZW5nZU1hbi5jdXJyZW50Q2hhbGxlbmdlSWQpO1xuICAgIHRoaXMubGJDaGFsbGVuZ2VOYW1lLnNldFN0cmluZyhfKGNoYWxsZW5nZUluZm9DZmcubmFtZUtleSkpO1xuXG4gICAgdmFyIHBsYXlpbmcgPSBnYW1lLnBsYXllck1hbi5nZXRPckNyZWF0ZUNoYWxsZW5nZShnYW1lLmNoYWxsZW5nZU1hbi5jdXJyZW50Q2hhbGxlbmdlSWQpLmNoYWxsZW5nZVBsYXlpbmc7XG4gICAgaWYgKHBsYXlpbmcpIHtcbiAgICAgICAgZ2FtZS5jaGFsbGVuZ2VNYW4ucm9sbEJhY2tQcm9ncmVzcygpO1xuICAgIH1cblxuICAgIHZhciBub2RlID0gQ2hhbGxlbmdlQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG5cbiAgICB0aGlzLnNjcm9sbFZpZXcgPSBuZXcgY2MuU2Nyb2xsVmlldyh0aGlzLm5kQ29udGFpbmVyLmdldENvbnRlbnRTaXplKCkpO1xuICAgIHRoaXMuc2Nyb2xsVmlldy5zZXREaXJlY3Rpb24oY2MuU0NST0xMVklFV19ESVJFQ1RJT05fVkVSVElDQUwpO1xuICAgIHRoaXMuc2Nyb2xsVmlldy5zZXRCb3VuY2VhYmxlKGZhbHNlKTtcbiAgICB0aGlzLnNjcm9sbFZpZXcuc2V0Vmlld1NpemUodGhpcy5uZENvbnRhaW5lci5nZXRDb250ZW50U2l6ZSgpKTtcbiAgICB0aGlzLnNjcm9sbFZpZXcuc2V0RGVsZWdhdGUodGhpcyk7XG4gICAgdGhpcy5zY3JvbGxWaWV3LnNldENvbnRhaW5lcihub2RlKTtcblxuICAgIHRoaXMubmRDb250YWluZXIuYWRkQ2hpbGQodGhpcy5zY3JvbGxWaWV3KTtcblxuICAgIHZhciB5T2Zmc2V0ID0gLShub2RlLmNvbnRyb2xsZXIuZ2V0Q3VycmVudENoYWxsZW5nZU5vZGUoKS55IC0gY2Mud2luU2l6ZS5oZWlnaHQgKiAwLjUpO1xuXG4gICAgaWYgKHlPZmZzZXQgPCB0aGlzLnNjcm9sbFZpZXcubWluQ29udGFpbmVyT2Zmc2V0KCkueSkge1xuICAgICAgICB5T2Zmc2V0ID0gdGhpcy5zY3JvbGxWaWV3Lm1pbkNvbnRhaW5lck9mZnNldCgpLnk7XG4gICAgfSBlbHNlIGlmICh5T2Zmc2V0ID49IHRoaXMuc2Nyb2xsVmlldy5tYXhDb250YWluZXJPZmZzZXQoKS55KSB7XG4gICAgICAgIHlPZmZzZXQgPSB0aGlzLnNjcm9sbFZpZXcubWF4Q29udGFpbmVyT2Zmc2V0KCkueTtcbiAgICB9XG4gICAgdGhpcy5zY3JvbGxWaWV3LnNldENvbnRlbnRPZmZzZXQoY2MucCgwLCB5T2Zmc2V0KSk7XG5cbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHBsYXlpbmcpIHtcbiAgICAgICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBDb21tb25EbGcoZ2FtZS51dGlscy5zcHJpbnRmKF8oXCJjaGFsbGVuZ2VfcmVzdGFydF90aXBzXCIpLCBnYW1lLmNoYWxsZW5nZU1hbi5nZXRSb2xsYmFja0xldmVsKCkpLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgZ2FtZS5jaGFsbGVuZ2VNYW4uY2hlY2tBbmRTaG93UmV3YXJkcygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBnYW1lLmNoYWxsZW5nZU1hbi5jaGVja0FuZFNob3dSZXdhcmRzKCk7XG4gICAgICAgIH1cbiAgICB9LCA1MDApO1xufTtcblxuQ2hhbGxlbmdlUGFyZW50Q29udHJvbGxlci5wcm90b3R5cGUuc2Nyb2xsVmlld0RpZFNjcm9sbCA9IGZ1bmN0aW9uICh2aWV3KSB7XG4gICAgY2MubG9nKFwic2Nyb2xsVmlld0RpZFNjcm9sbDpcIiArIEpTT04uc3RyaW5naWZ5KHZpZXcuZ2V0Q29udGVudE9mZnNldCgpKSk7XG59O1xuXG5DaGFsbGVuZ2VQYXJlbnRDb250cm9sbGVyLnByb3RvdHlwZS5zY3JvbGxWaWV3RGlkWm9vbSA9IGZ1bmN0aW9uICh2aWV3KSB7XG5cbn07XG5cbkNoYWxsZW5nZVBhcmVudENvbnRyb2xsZXIucHJvdG90eXBlLmJhY2tDbGlja2VkID0gZnVuY3Rpb24gKCkge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGdhbWUuc2NlbmVNYW4uc3dpdGNoU2NlbmUoZ2FtZS5zY2VuZVR5cGUuQ0hBTExFTkdFX0xJU1QpO1xufTtcblxuQ2hhbGxlbmdlUGFyZW50Q29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9hY3Rpdml0eS9hY3Rpdml0eV9wYXJlbnRfdmlldy5jY2JpXCIsIG51bGwsIFwiQ2hhbGxlbmdlUGFyZW50Q29udHJvbGxlclwiLCBuZXcgQ2hhbGxlbmdlUGFyZW50Q29udHJvbGxlcigpKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQ2hhbGxlbmdlUGFyZW50Q29udHJvbGxlcjsiLCJ2YXIgU3RvcmVIZWxwZXIgPSByZXF1aXJlKFwiLi4vbW9kZWwvU3RvcmVIZWxwZXJcIik7XG52YXIgRmFpbFJlYXNvbiA9IHJlcXVpcmUoXCIuLi9lbnVtL0ZhaWxSZWFzb25cIik7XG5cbnZhciBDaGFsbGVuZ2VSZWxpdmVDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG5cbiAgICB0aGlzLmxiUmVsaWZlVGl0bGUgPSBudWxsO1xuXG4gICAgdGhpcy5sYkNvc3REaWFtb25kcyA9IG51bGw7XG5cbiAgICB0aGlzLmxiUmV2aXZlQ291bnQgPSBudWxsO1xuXG4gICAgdGhpcy5uZFdhdGNoQWRzID0gbnVsbDtcbiAgICB0aGlzLm5kRGlhbW9uZCA9IG51bGw7XG5cbiAgICB0aGlzLl9yZWxpdmVDYWxsYmFjayA9IG51bGw7XG4gICAgdGhpcy5fY2FuY2VsQ2FsbGJhY2sgPSBudWxsO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhDaGFsbGVuZ2VSZWxpdmVDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbkNoYWxsZW5nZVJlbGl2ZUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRXhpdCA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0LmNhbGwodGhpcyk7XG4gICAgdGhpcy5fcmVsaXZlQ2FsbGJhY2sgPSBudWxsO1xuICAgIHRoaXMuX2NhbmNlbENhbGxiYWNrID0gbnVsbDtcbn07XG5cbkNoYWxsZW5nZVJlbGl2ZUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcblxuICAgIHRoaXMubGJDb3N0RGlhbW9uZHMuc2V0U3RyaW5nKFwieFwiICsgZ2FtZS5jb25maWcucmVsaWZlRGlhbW9uZHMpO1xuXG4gICAgdGhpcy5uZERpYW1vbmQudmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMubmRXYXRjaEFkcy52aXNpYmxlID0gZmFsc2U7XG4gICAgaWYgKGdhbWUuYWRzTWFuYWdlci5pc1Jld2FyZFZpZGVvUmVhZHkoKSkge1xuICAgICAgICB0aGlzLm5kV2F0Y2hBZHMudmlzaWJsZSA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5uZERpYW1vbmQudmlzaWJsZSA9IHRydWU7XG4gICAgfVxuXG4gICAgdmFyIHRvdGFsTGlmZUNvdW50ID0gZ2FtZS5jaGFsbGVuZ2VNYW4uVE9UQUxfTElGRV9DT1VOVDtcbiAgICB2YXIgY3VycmVudExpZmVDb3VudCA9IHRvdGFsTGlmZUNvdW50IC0gZ2FtZS5wbGF5ZXJNYW4uZ2V0T3JDcmVhdGVDaGFsbGVuZ2UoZ2FtZS5jaGFsbGVuZ2VNYW4uY3VycmVudENoYWxsZW5nZUlkKS5jaGFsbGVuZ2VSZXZpdmVDb3VudDtcbiAgICB0aGlzLmxiUmV2aXZlQ291bnQuc2V0U3RyaW5nKGdhbWUudXRpbHMuc3ByaW50ZihfKFwibGlmZXNfY291bnRcIiksIGN1cnJlbnRMaWZlQ291bnQsIHRvdGFsTGlmZUNvdW50KSk7XG59O1xuXG5DaGFsbGVuZ2VSZWxpdmVDb250cm9sbGVyLnByb3RvdHlwZS53YXRjaEFkc0NsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJlbnRlclwiKTtcbiAgICB2YXIgU3RvcmVIZWxwZXIgPSByZXF1aXJlKFwiLi4vbW9kZWwvU3RvcmVIZWxwZXJcIik7XG4gICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5jaGVja0FuZFNob3dSZXdhcmRWaWRlbyhnYW1lLnV0aWxzLmlzSU9TKCkgPyBcInJlbGl2ZVwiIDogXCJyZWxpdmVcIik7XG59O1xuXG5DaGFsbGVuZ2VSZWxpdmVDb250cm9sbGVyLnByb3RvdHlwZS5yZWxpdmVDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGlmIChTdG9yZUhlbHBlci5nZXRJbnN0YW5jZSgpLnJlbGl2ZUxldmVsKGdhbWUuZ2FtZU1hbi5sZXZlbElkKSkge1xuICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRXZlbnQoXCJDaGFsbGVuZ2VSZXZpdmVcIiwge1widHlwZVwiOiBcImRpYW1vbmRzXCJ9KTtcbiAgICAgICAgaWYgKHRoaXMuX3JlbGl2ZUNhbGxiYWNrKSB7XG4gICAgICAgICAgICB0aGlzLl9yZWxpdmVDYWxsYmFjaygpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG59O1xuXG5DaGFsbGVuZ2VSZWxpdmVDb250cm9sbGVyLnByb3RvdHlwZS53YXRjaEFkc1JlbGl2ZUNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuY2hlY2tBbmRTaG93UmV3YXJkVmlkZW8oXCJjaGFsbGVuZ2VfcmV2aXZlX1wiICsgZ2FtZS5jaGFsbGVuZ2VNYW4uY3VycmVudENoYWxsZW5nZUlkLCBmdW5jdGlvbiAod2F0Y2hlZCkge1xuICAgICAgICBpZiAod2F0Y2hlZCkge1xuICAgICAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiQ2hhbGxlbmdlUmV2aXZlXCIsIHtcInR5cGVcIjogXCJ3YXRjaF9hZHNfXCIgKyBnYW1lLmNoYWxsZW5nZU1hbi5jdXJyZW50Q2hhbGxlbmdlSWR9KTtcbiAgICAgICAgICAgIGlmIChzZWxmLl9yZWxpdmVDYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIHNlbGYuX3JlbGl2ZUNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZWxmLmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn07XG5cbkNoYWxsZW5nZVJlbGl2ZUNvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBpZiAodGhpcy5fY2FuY2VsQ2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5fY2FuY2VsQ2FsbGJhY2soKTtcbiAgICB9XG4gICAgdGhpcy5jbG9zZSgpO1xufTtcblxuQ2hhbGxlbmdlUmVsaXZlQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdFdpdGggPSBmdW5jdGlvbiAocmVhc29uLCByZWxpdmVDYWxsYmFjaywgY2FuY2VsQ2FsbGJhY2spIHtcbiAgICB0aGlzLl9yZWFzb24gPSByZWFzb247XG4gICAgdGhpcy5fcmVsaXZlQ2FsbGJhY2sgPSByZWxpdmVDYWxsYmFjaztcbiAgICB0aGlzLl9jYW5jZWxDYWxsYmFjayA9IGNhbmNlbENhbGxiYWNrO1xuXG4gICAgc3dpdGNoICh0aGlzLl9yZWFzb24pIHtcbiAgICAgICAgY2FzZSBGYWlsUmVhc29uLkJvbWI6XG4gICAgICAgICAgICB0aGlzLmxiUmVsaWZlVGl0bGUuc2V0U3RyaW5nKF8oXCJib21iX3RpdGxlXCIpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEZhaWxSZWFzb24uVGltZW91dDpcbiAgICAgICAgICAgIHRoaXMubGJSZWxpZmVUaXRsZS5zZXRTdHJpbmcoXyhcInRpbWVfb3V0X3RpdGxlXCIpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgdGhpcy5sYlJlbGlmZVRpdGxlLnNldFN0cmluZyhfKFwibG9zdF90aXRsZVwiKSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICB9XG59O1xuXG5DaGFsbGVuZ2VSZWxpdmVDb250cm9sbGVyLnByb3RvdHlwZS5wb3B1cCA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIucG9wdXAodGhpcy5yb290Tm9kZSwge3BvcHVwQW5pbTogdHJ1ZX0pO1xufTtcblxuQ2hhbGxlbmdlUmVsaXZlQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLmNsb3NlKHRoaXMucm9vdE5vZGUpO1xufTtcblxuQ2hhbGxlbmdlUmVsaXZlQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9hY3Rpdml0eS9yZWxpZmVfdmlldy5jY2JpXCIsIG51bGwsIFwiQ2hhbGxlbmdlUmVsaXZlQ29udHJvbGxlclwiLCBuZXcgQ2hhbGxlbmdlUmVsaXZlQ29udHJvbGxlcigpKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQ2hhbGxlbmdlUmVsaXZlQ29udHJvbGxlcjsiLCJ2YXIgQ29uZmlnTWFuID0gcmVxdWlyZShcIi4uL2NvbmZpZy9Db25maWdNYW5cIik7XG52YXIgRGFpbHlCb251c0l0ZW1Db250cm9sbGVyID0gcmVxdWlyZShcIi4vRGFpbHlCb251c0l0ZW1Db250cm9sbGVyXCIpO1xudmFyIEJvb3N0VHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL0Jvb3N0VHlwZVwiKTtcbnZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcblxudmFyIERhaWx5Qm9udXNDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG4gICAgdGhpcy5EQUlMWV9CT05VU19DT1VOVCA9IDc7XG4gICAgdGhpcy5EQUlMWV9CT05VU19UQUcgPSAyMDA7XG4gICAgdGhpcy5uZENvbnRhaW5lciA9IG51bGw7XG5cbiAgICB0aGlzLmxibFRpdGxlID0gbnVsbDtcblxuICAgIHRoaXMubmREYWlseUJvbnVzID0gbnVsbDtcblxuICAgIHRoaXMuYnRuRG91YmxlID0gbnVsbDtcbiAgICB0aGlzLmJ0bkNsYWltID0gbnVsbDtcblxuICAgIHRoaXMubGJsQ2xhaW0gPSBudWxsO1xuICAgIHRoaXMubGJsRG91YmxlID0gbnVsbDtcblxuICAgIHRoaXMuZGFpbHlCb251c05vZGVzID0gW107XG5cbiAgICAvL3VzZXIgZGF0YS5cbiAgICB0aGlzLmNvbmZpZ3MgPSBudWxsO1xuXG4gICAgdGhpcy5jdXJDb25maWcgPSBudWxsO1xuXG4gICAgdGhpcy5jbGFpbWVkID0gZmFsc2U7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKERhaWx5Qm9udXNDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbkRhaWx5Qm9udXNDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG4gICAgdGhpcy5sYmxUaXRsZS5zZXRTdHJpbmcoXyhcImRhaWx5X2JvbnVzX3RpdGxlXCIpKTtcbiAgICB0aGlzLmxibENsYWltLnNldFN0cmluZyhfKFwiY2xhaW1fdGl0bGVcIikpO1xuICAgIHRoaXMubGJsRG91YmxlLnNldFN0cmluZyhfKFwiZG91YmxlX3RpdGxlXCIpKTtcblxuICAgIHRoaXMuY29uZmlncyA9IENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldERhaWx5Qm9udXNMaXN0KCk7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuREFJTFlfQk9OVVNfQ09VTlQ7ICsraSkge1xuICAgICAgICB2YXIgbm9kZSA9IHRoaXMubmREYWlseUJvbnVzLmdldENoaWxkQnlUYWcodGhpcy5EQUlMWV9CT05VU19UQUcgKyBpKTtcbiAgICAgICAgdmFyIGl0ZW1Ob2RlID0gRGFpbHlCb251c0l0ZW1Db250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgdGhpcy5kYWlseUJvbnVzTm9kZXMucHVzaChpdGVtTm9kZSk7XG4gICAgICAgIG5vZGUuYWRkQ2hpbGQoaXRlbU5vZGUpO1xuICAgIH1cblxuICAgIHRoaXMuaW5pdFVJKCk7XG59O1xuXG5EYWlseUJvbnVzQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdFVJID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBsYXN0Q2xhaW1EYXkgPSBnYW1lLnBsYXllck1hbi5wbGF5ZXIubGFzdENsYWltRGFpbHlCb251c0RheTtcbiAgICB2YXIgY29uc2VjdXRpdmVEYXkgPSBnYW1lLnBsYXllck1hbi5jaGVja0NvbnNlY3V0aXZlTG9naW5EYXkoKTtcbiAgICB2YXIgY3VycmVudERheUNsYWltZWQgPSBsYXN0Q2xhaW1EYXkgPj0gZ2FtZS51dGlscy5nZXREYXlCeVRzKERhdGUubm93KCkpO1xuICAgIGNvbnNlY3V0aXZlRGF5ICU9IDc7XG4gICAgY29uc2VjdXRpdmVEYXkgPSBjb25zZWN1dGl2ZURheSB8fCA3O1xuICAgIHRoaXMuY2xhaW1lZCA9IGN1cnJlbnREYXlDbGFpbWVkO1xuXG4gICAgdGhpcy5idG5DbGFpbS5lbmFibGVkID0gIWN1cnJlbnREYXlDbGFpbWVkO1xuICAgIHRoaXMuYnRuRG91YmxlLmVuYWJsZWQgPSAhY3VycmVudERheUNsYWltZWQ7XG5cbiAgICBjYy5sb2coXCJjb25zZWN1dGl2ZURheTpcIiArIGNvbnNlY3V0aXZlRGF5ICsgXCIsZGFpbHlCb251c05vZGVzIGxlbmd0aDpcIiArIHRoaXMuZGFpbHlCb251c05vZGVzLmxlbmd0aCArIFwiLGN1cnJlbnREYXlDbGFpbWVkOlwiICsgY3VycmVudERheUNsYWltZWQpO1xuICAgIGZvciAodmFyIGkgPSAxOyBpIDw9IDc7ICsraSkge1xuICAgICAgICBjYy5sb2coXCJpbml0VUk6XCIgKyBpKTtcbiAgICAgICAgdmFyIGNvbmZpZyA9IHRoaXMuY29uZmlnc1tpIC0gMV07XG4gICAgICAgIHZhciBub2RlID0gdGhpcy5kYWlseUJvbnVzTm9kZXNbaSAtIDFdO1xuICAgICAgICBpZiAoIW5vZGUpIHtcbiAgICAgICAgICAgIGNjLmxvZyhcImRhaWx5IGJvbnVzIG5vZGUgaXMgbnVsbDpcIiArIGkpO1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGNvbnRyb2xsZXIgPSBub2RlLmNvbnRyb2xsZXI7XG4gICAgICAgIGlmICghY29udHJvbGxlcikge1xuICAgICAgICAgICAgY2MubG9nKFwiZGFpbHkgYm9udXMgY29udHJvbGxlciBpcyBudWxsOlwiICsgaSk7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaSA8IGNvbnNlY3V0aXZlRGF5KSB7XG4gICAgICAgICAgICBjb250cm9sbGVyLmluaXRXaXRoKGNvbmZpZywgaSwgZmFsc2UsIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGkgPT09IGNvbnNlY3V0aXZlRGF5KSB7XG4gICAgICAgICAgICBjb250cm9sbGVyLmluaXRXaXRoKGNvbmZpZywgaSwgdHJ1ZSwgY3VycmVudERheUNsYWltZWQpO1xuICAgICAgICAgICAgdGhpcy5jdXJDb25maWcgPSBjb25maWc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb250cm9sbGVyLmluaXRXaXRoKGNvbmZpZywgaSwgZmFsc2UsIGZhbHNlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmIChjb25zZWN1dGl2ZURheSA9PT0gMykge1xuICAgICAgICB0aGlzLmJ0bkRvdWJsZS5lbmFibGVkID0gZmFsc2U7XG4gICAgfVxufTtcblxuRGFpbHlCb251c0NvbnRyb2xsZXIucHJvdG90eXBlLnBvcHVwQ2xhaW1SZXdhcmQgPSBmdW5jdGlvbiAoY29uZmlnLCBkb3VibGUsIGNhbGxiYWNrKSB7XG4gICAgLy92YXIgY291bnQgPSBkb3VibGUgPyBjb25maWcuY291bnQgKiAyIDogY29uZmlnLmNvdW50O1xuICAgIHZhciBwYXJhbSA9IGRvdWJsZSA/IDIgOiAxO1xuICAgIHZhciBjb3VudCA9IGNvbmZpZy5jb3VudDtcbiAgICB2YXIgc3BsaXRDb3VudCA9IDA7XG4gICAgdmFyIHRocmVlQmFsbENvdW50ID0gMDtcbiAgICB2YXIgcmV3YXJkTmFtZSA9IGdhbWUudXRpbHMuaXNJT1MoKSA/IFwiZGFpbHlfYm9udXNfdGlwc1wiIDogXCJkYWlseV9ib251c190aXBzXCI7XG4gICAgaWYgKGNvbmZpZy50eXBlID09PSBCb29zdFR5cGUuU1BMSVQpIHtcbiAgICAgICAgc3BsaXRDb3VudCA9IGNvdW50O1xuICAgIH0gZWxzZSBpZiAoY29uZmlnLnR5cGUgPT09IEJvb3N0VHlwZS5USFJFRV9CQUxMKSB7XG4gICAgICAgIHRocmVlQmFsbENvdW50ID0gY291bnQ7XG4gICAgfSBlbHNlIGlmIChjb25maWcudHlwZSA9PT0gQm9vc3RUeXBlLkdJRlQpIHtcbiAgICAgICAgc3BsaXRDb3VudCA9IGdhbWUudXRpbHMucmFuZG9tTmV4dEludEluUmFuZ2UoMiwgNCk7XG4gICAgICAgIHRocmVlQmFsbENvdW50ID0gZ2FtZS51dGlscy5yYW5kb21OZXh0SW50SW5SYW5nZSgyLCA0KTtcbiAgICB9IGVsc2UgaWYgKGNvbmZpZy50eXBlID09PSBCb29zdFR5cGUuU0tJTikge1xuICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwUmV3YXJkTm90aWNlRGxnKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJza2luX2NsYWltZWRcIiksXG4gICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uc2V0Q2xhaW1lZFNraW4oY29uZmlnLmFyZzEpO1xuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIGNvbmZpZy5pbWFnZSwgMSk7XG4gICAgICAgIHJldHVybjtcbiAgICB9IGVsc2UgaWYgKGNvbmZpZy50eXBlID09PSBCb29zdFR5cGUuRElBTU9ORCkge1xuICAgICAgICB2YXIgZGlhbW9uZENvdW50ID0gY29uZmlnLmNvdW50O1xuICAgICAgICBpZiAoZG91YmxlKSB7XG4gICAgICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwUmV3YXJkTm90aWNlRGxnKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJyZXdhcmRfdmlkZW9fZGlhbW9uZHNcIiksXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5hZGREaWFtb25kcyhkaWFtb25kQ291bnQsIHJld2FyZE5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCBjb25maWcuaW1hZ2UsIGRpYW1vbmRDb3VudCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBTdG9yZUhlbHBlci5nZXRJbnN0YW5jZSgpLnBvcHVwUmV3YXJkRG91YmxlRGxnKGRpYW1vbmRDb3VudCwgQm9vc3RUeXBlLkRJQU1PTkQsIHJld2FyZE5hbWUsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgc3BsaXRDb3VudCA9IHNwbGl0Q291bnQgKiBwYXJhbTtcbiAgICB0aHJlZUJhbGxDb3VudCA9IHRocmVlQmFsbENvdW50ICogcGFyYW07XG4gICAgaWYgKGRvdWJsZSkge1xuICAgICAgICBTdG9yZUhlbHBlci5nZXRJbnN0YW5jZSgpLnBvcHVwQm9vc3RSZXdhcmREbGcoc3BsaXRDb3VudCwgdGhyZWVCYWxsQ291bnQsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKCk7XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChzcGxpdENvdW50ID4gMCkge1xuICAgICAgICAgICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5wb3B1cFJld2FyZERvdWJsZURsZyhzcGxpdENvdW50LCBCb29zdFR5cGUuU1BMSVQsIHJld2FyZE5hbWUsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhyZWVCYWxsQ291bnQgPiAwKSB7XG4gICAgICAgICAgICBTdG9yZUhlbHBlci5nZXRJbnN0YW5jZSgpLnBvcHVwUmV3YXJkRG91YmxlRGxnKHRocmVlQmFsbENvdW50LCBCb29zdFR5cGUuVEhSRUVfQkFMTCwgcmV3YXJkTmFtZSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICB9XG4gICAgfVxufTtcblxuRGFpbHlCb251c0NvbnRyb2xsZXIucHJvdG90eXBlLmNsYWltQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgaWYgKCF0aGlzLmNsYWltZWQpIHtcbiAgICAgICAgdGhpcy5wb3B1cENsYWltUmV3YXJkKHRoaXMuY3VyQ29uZmlnLCBmYWxzZSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc2VsZi5zZXRDbGFpbWVkKCk7XG4gICAgICAgICAgICBzZWxmLmNsb3NlKCk7XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHNlbGYuY2xvc2UoKTtcbiAgICB9XG59O1xuXG5EYWlseUJvbnVzQ29udHJvbGxlci5wcm90b3R5cGUuZG91YmxlQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgaWYgKCF0aGlzLmNsYWltZWQpIHtcbiAgICAgICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5jaGVja0FuZFNob3dSZXdhcmRWaWRlbyhnYW1lLnV0aWxzLmlzSU9TKCkgPyBcInNodWFuZ2JlaWxpYmFvXCIgOiBcImRhaWx5Ym9udXNcIiwgZnVuY3Rpb24gKHJld2FyZGVkKSB7XG4gICAgICAgICAgICBpZiAocmV3YXJkZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBvcHVwQ2xhaW1SZXdhcmQodGhpcy5jdXJDb25maWcsIHRydWUsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXRDbGFpbWVkKCk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBzZWxmLmNsb3NlKCk7XG4gICAgfVxufTtcblxuRGFpbHlCb251c0NvbnRyb2xsZXIucHJvdG90eXBlLnNldENsYWltZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5wbGF5ZXJNYW4uc2V0TGFzdENsYWltRGFpbHlCb251c0RheShnYW1lLnV0aWxzLmdldERheUJ5VHMoRGF0ZS5ub3coKSkpO1xuICAgIHRoaXMuY2xhaW1lZCA9IHRydWU7XG59O1xuXG5EYWlseUJvbnVzQ29udHJvbGxlci5wcm90b3R5cGUuYmFja0NsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG5cbiAgICB0aGlzLmNsb3NlKCk7XG59O1xuXG5EYWlseUJvbnVzQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdFdpdGggPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBjYWxsYmFjaztcbn07XG5cbkRhaWx5Qm9udXNDb250cm9sbGVyLnByb3RvdHlwZS5wb3B1cCA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIucG9wdXAodGhpcy5yb290Tm9kZSwge3BvcHVwQW5pbTogdHJ1ZX0pO1xufTtcblxuRGFpbHlCb251c0NvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5jbG9zZSh0aGlzLnJvb3ROb2RlKTtcbiAgICBpZiAodGhpcy5jbG9zZUNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuY2xvc2VDYWxsYmFjaygpO1xuICAgICAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBudWxsO1xuICAgIH1cbn07XG5cbkRhaWx5Qm9udXNDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRXhpdC5jYWxsKHRoaXMpO1xufTtcblxuRGFpbHlCb251c0NvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIGNjLkJ1aWxkZXJSZWFkZXIucmVnaXN0ZXJDb250cm9sbGVyKFwiRGFpbHlCb251c0l0ZW1Db250cm9sbGVyXCIsIG5ldyBEYWlseUJvbnVzSXRlbUNvbnRyb2xsZXIoKSk7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9tZW51L2RhaWx5X2JvbnVzX3ZpZXcuY2NiaVwiLCBudWxsLCBcIkRhaWx5Qm9udXNDb250cm9sbGVyXCIsIG5ldyBEYWlseUJvbnVzQ29udHJvbGxlcigpKTtcbiAgICBjYy5CdWlsZGVyUmVhZGVyLl9jb250cm9sbGVyQ2xhc3NDYWNoZVtcIkRhaWx5Qm9udXNJdGVtQ29udHJvbGxlclwiXSA9IHVuZGVmaW5lZDtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gRGFpbHlCb251c0NvbnRyb2xsZXI7IiwidmFyIEJvb3N0VHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL0Jvb3N0VHlwZVwiKTtcblxudmFyIERhaWx5Qm9udXNJdGVtQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuXG4gICAgdGhpcy5zcEJsYWNrID0gbnVsbDtcbiAgICB0aGlzLnNwSXRlbSA9IG51bGw7XG4gICAgdGhpcy5zcEN1cnJlbnQgPSBudWxsO1xuICAgIHRoaXMuc3BDbGFpbWVkID0gbnVsbDtcbiAgICB0aGlzLmxibENvdW50ID0gbnVsbDtcbiAgICB0aGlzLmxibERheSA9IG51bGw7XG5cbiAgICB0aGlzLmRhaWx5Qm9udXNDZmcgPSBudWxsO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhEYWlseUJvbnVzSXRlbUNvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuRGFpbHlCb251c0l0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG59O1xuLyoqXG4gKiBAcGFyYW0ge0RhaWx5Qm9udXNDb25maWd9IGRhdGFcbiAqIEBwYXJhbSB7bnVtYmVyfSBkYXlcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gY3VycmVudFxuICogQHBhcmFtIHtib29sZWFufSBjbGFpbWVkXG4gKi9cbi8vZGF5LCBzdGF0ZSwgcmV3YXJkT2JqLCBjbGFpbWVkXG5EYWlseUJvbnVzSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLmluaXRXaXRoID0gZnVuY3Rpb24gKGRhdGEsIGRheSwgY3VycmVudCwgY2xhaW1lZCkge1xuICAgIHRoaXMuZGFpbHlCb251c0NmZyA9IGRhdGE7XG5cbiAgICBpZiAoZGF0YS50eXBlID09PSBCb29zdFR5cGUuU0tJTikge1xuICAgICAgICB2YXIgZ2V0dGVkID0gZ2FtZS5wbGF5ZXJNYW4uaGFzU2tpbihkYXRhLmFyZzEpO1xuICAgICAgICBpZiAoZ2V0dGVkKSB7XG4gICAgICAgICAgICBkYXRhLnR5cGUgPSBkYXRhLmV4dHJhLnR5cGU7XG4gICAgICAgICAgICBkYXRhLmNvdW50ID0gZGF0YS5leHRyYS5jb3VudDtcbiAgICAgICAgICAgIGRhdGEuaW1hZ2UgPSBkYXRhLmV4dHJhLmltYWdlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5zcEJsYWNrLnZpc2libGUgPSBjbGFpbWVkO1xuICAgIHRoaXMuc3BJdGVtLnNldFNwcml0ZUZyYW1lKGRhdGEuaW1hZ2UpO1xuICAgIC8vZ2FtZS51dGlscy5zY2FsZUNDTGFiZWxCTUZvbnQodGhpcy5zcEl0ZW0sIDU5KTtcbiAgICBpZiAoIWNsYWltZWQpIHtcbiAgICAgICAgdGhpcy5zcEN1cnJlbnQudmlzaWJsZSA9IGN1cnJlbnQ7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zcEN1cnJlbnQudmlzaWJsZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIHRoaXMuc3BDbGFpbWVkLnZpc2libGUgPSBjbGFpbWVkO1xuICAgIHRoaXMubGJsQ291bnQuc2V0U3RyaW5nKFwieFwiICsgZGF0YS5jb3VudCk7XG4gICAgdGhpcy5sYmxEYXkuc2V0U3RyaW5nKGdhbWUudXRpbHMuc3ByaW50ZihfKFwiZGF5X3RpdGxlXCIpLCBkYXkpKTtcbn07XG5cbkRhaWx5Qm9udXNJdGVtQ29udHJvbGxlci5wcm90b3R5cGUuZ2V0Q29udGVudFNpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3BCZ1NlbGVjdGVkLmdldENvbnRlbnRTaXplKCk7XG59O1xuXG5EYWlseUJvbnVzSXRlbUNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9tZW51L2RhaWx5X2JvbnVzX2l0ZW1fdmlldy5jY2JpXCIsIG51bGwsIFwiRGFpbHlCb251c0l0ZW1Db250cm9sbGVyXCIsIG5ldyBEYWlseUJvbnVzSXRlbUNvbnRyb2xsZXIoKSk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IERhaWx5Qm9udXNJdGVtQ29udHJvbGxlcjsiLCJ2YXIgRXZlbnRzTmFtZSA9IHJlcXVpcmUoXCIuLi9ldmVudHMvRXZlbnRzTmFtZVwiKTtcbnZhciBEYWlseVRhc2tQb3MgPSByZXF1aXJlKFwiLi4vZW51bS9EYWlseVRhc2tQb3NcIik7XG5cbnZhciBEYWlseVRhc2tFbnRyYW5jZUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcblxuICAgIHRoaXMubmRBY3Rpdml0eSA9IG51bGw7XG4gICAgdGhpcy5idG5BY3Rpdml0eSA9IG51bGw7XG5cbiAgICB0aGlzLmxiQWN0aXZpdHlMZWZ0VGltZSA9IG51bGw7XG5cbiAgICB0aGlzLm5kRGFpbHlUYXNrUmVtaW5kZXIgPSBudWxsO1xuICAgIHRoaXMubGJsRGFpbHlUYXNrUmVtaW5kZXIgPSBudWxsO1xuICAgIHRoaXMuc3BEYWlseVRhc2tDbGFpbVJlbWluZGVyID0gbnVsbDtcblxuICAgIHRoaXMuZGFpbHlUYXNrUG9zID0gRGFpbHlUYXNrUG9zLk1lbnU7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKERhaWx5VGFza0VudHJhbmNlQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5EYWlseVRhc2tFbnRyYW5jZUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIuY2FsbCh0aGlzKTtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5hZGRFdmVudExpc3RlbmVyKEV2ZW50c05hbWUuVVBEQVRFX0FDVElWSVRZX1RBU0tfU0NPUkUsIHRoaXMudXBkYXRlQWN0aXZpdHlFbnRyYW5jZSwgdGhpcyk7XG59O1xuXG5EYWlseVRhc2tFbnRyYW5jZUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRXhpdCA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5yZW1vdmVFdmVudExpc3RlbmVyKEV2ZW50c05hbWUuVVBEQVRFX0FDVElWSVRZX1RBU0tfU0NPUkUsIHRoaXMudXBkYXRlQWN0aXZpdHlFbnRyYW5jZSwgdGhpcyk7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRXhpdC5jYWxsKHRoaXMpO1xufTtcblxuRGFpbHlUYXNrRW50cmFuY2VDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG4gICAgdGhpcy51cGRhdGVBY3Rpdml0eUVudHJhbmNlKCk7XG59O1xuXG5EYWlseVRhc2tFbnRyYW5jZUNvbnRyb2xsZXIucHJvdG90eXBlLmluaXRXaXRoID0gZnVuY3Rpb24gKHBvcykge1xuICAgIHRoaXMuZGFpbHlUYXNrUG9zID0gcG9zO1xufTtcblxuRGFpbHlUYXNrRW50cmFuY2VDb250cm9sbGVyLnByb3RvdHlwZS51cGRhdGVBY3Rpdml0eUVudHJhbmNlID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMubmREYWlseVRhc2tSZW1pbmRlci5zdG9wQWxsQWN0aW9ucygpO1xuICAgIHRoaXMubmREYWlseVRhc2tSZW1pbmRlci5zY2FsZSA9IDE7XG4gICAgdGhpcy5uZEFjdGl2aXR5LnZpc2libGUgPSB0cnVlO1xuICAgIHRoaXMuYnRuQWN0aXZpdHkuZW5hYmxlZCA9IHRydWU7XG4gICAgdGhpcy5uZERhaWx5VGFza1JlbWluZGVyLnZpc2libGUgPSBmYWxzZTtcbiAgICBpZiAoZ2FtZS5hY3Rpdml0eU1hbi5pc09wZW4oKSkge1xuICAgICAgICB0aGlzLnNwRGFpbHlUYXNrQ2xhaW1SZW1pbmRlci52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMubGJsRGFpbHlUYXNrUmVtaW5kZXIudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICBpZiAoZ2FtZS5hY3Rpdml0eU1hbi5oYXNVbkNsYWltZWRSZXdhcmQoKSkge1xuICAgICAgICAgICAgdGhpcy5uZERhaWx5VGFza1JlbWluZGVyLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5zcERhaWx5VGFza0NsYWltUmVtaW5kZXIudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLm5kRGFpbHlUYXNrUmVtaW5kZXIucnVuQWN0aW9uKGNjLnNlcXVlbmNlKGNjLnNjYWxlVG8oMC4yLCAxLjIpLCBjYy5zY2FsZVRvKDAuNCwgMC44KSwgY2Muc2NhbGVUbygwLjIsIDEpKS5yZXBlYXRGb3JldmVyKCkpO1xuICAgICAgICB9IGVsc2UgaWYgKGdhbWUuYWN0aXZpdHlNYW4uZ2V0VW5Db21wbGV0ZWRUYXNrKCkgPiAwKSB7XG4gICAgICAgICAgICB0aGlzLm5kRGFpbHlUYXNrUmVtaW5kZXIudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmxibERhaWx5VGFza1JlbWluZGVyLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5sYmxEYWlseVRhc2tSZW1pbmRlci5zZXRTdHJpbmcoZ2FtZS5hY3Rpdml0eU1hbi5nZXRVbkNvbXBsZXRlZFRhc2soKSk7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLm5kQWN0aXZpdHkudmlzaWJsZSA9IGZhbHNlO1xuICAgIH1cbn07XG5cbkRhaWx5VGFza0VudHJhbmNlQ29udHJvbGxlci5wcm90b3R5cGUuYWN0aXZpdHlDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcIkRhaWx5VGFza1wiICsgRGFpbHlUYXNrUG9zLmdldE5hbWUodGhpcy5kYWlseVRhc2tQb3MpICsgXCJDbGlja1wiKTtcblxuICAgIGdhbWUucG9wdXBNYW4ucG9wdXBBY3Rpdml0eVRhc2soKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gRGFpbHlUYXNrRW50cmFuY2VDb250cm9sbGVyOyIsInZhciBFdmVudHNOYW1lID0gcmVxdWlyZShcIi4uL2V2ZW50cy9FdmVudHNOYW1lXCIpO1xudmFyIE51bWJlckFuaW1hdGlvbiA9IHJlcXVpcmUoXCIuLi8uLi9jb21tb24vZW50aXR5L051bWJlckFuaW1hdGlvblwiKTtcblxudmFyIERpYW1vbmRzQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuXG4gICAgdGhpcy5sYkRpYW1vbmRzID0gbnVsbDtcblxuICAgIHRoaXMubnVtYmVyQW5pbWF0aW9uID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoRGlhbW9uZHNDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbkRpYW1vbmRzQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlci5jYWxsKHRoaXMpO1xuICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLmFkZEV2ZW50TGlzdGVuZXIoRXZlbnRzTmFtZS5ESUFNT05EU19VUERBVEUsIHRoaXMub25VcGRhdGVEaWFtb25kcywgdGhpcyk7XG4gICAgY2MuZGlyZWN0b3IuZ2V0U2NoZWR1bGVyKCkuc2NoZWR1bGVDYWxsYmFja0ZvclRhcmdldCh0aGlzLCB0aGlzLm9uVXBkYXRlLCAwLjA1LCBjYy5SRVBFQVRfRk9SRVZFUiwgMCwgZmFsc2UpO1xufTtcblxuRGlhbW9uZHNDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5udW1iZXJBbmltYXRpb24uZGVzdHJveSgpO1xuICAgIGNjLmRpcmVjdG9yLmdldFNjaGVkdWxlcigpLnVuc2NoZWR1bGVDYWxsYmFja0ZvclRhcmdldCh0aGlzLCB0aGlzLm9uVXBkYXRlKTtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5yZW1vdmVFdmVudExpc3RlbmVyKEV2ZW50c05hbWUuRElBTU9ORFNfVVBEQVRFLCB0aGlzLm9uVXBkYXRlRGlhbW9uZHMsIHRoaXMpO1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQuY2FsbCh0aGlzKTtcbn07XG5cbkRpYW1vbmRzQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuICAgIHRoaXMubnVtYmVyQW5pbWF0aW9uID0gbmV3IE51bWJlckFuaW1hdGlvbih0aGlzLmxiRGlhbW9uZHMpO1xuICAgIHRoaXMubGJEaWFtb25kcy5zZXRTdHJpbmcoZ2FtZS5wbGF5ZXJNYW4uZ2V0RGlhbW9uZHMoKSk7XG59O1xuXG5EaWFtb25kc0NvbnRyb2xsZXIucHJvdG90eXBlLm9uVXBkYXRlRGlhbW9uZHMgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICB2YXIgZGF0YSA9IGV2ZW50LmdldFVzZXJEYXRhKCk7XG4gICAgdmFyIGRpYW1vbmRzID0gZGF0YS5kaWFtb25kcztcbiAgICB2YXIgZGVsdGEgPSBkYXRhLmRlbHRhO1xuICAgIHRoaXMubnVtYmVyQW5pbWF0aW9uLnBsYXlOdW1BbmltKGRpYW1vbmRzIC0gZGVsdGEsIGRpYW1vbmRzKTtcbn07XG5cbkRpYW1vbmRzQ29udHJvbGxlci5wcm90b3R5cGUuZGlhbW9uZENsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgdmFyIFN0b3JlVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1N0b3JlVHlwZVwiKTtcbiAgICBnYW1lLnBvcHVwTWFuLnBvcHVwU3RvcmVEbGcoU3RvcmVUeXBlLkRJQU1PTkQpO1xufTtcblxuRGlhbW9uZHNDb250cm9sbGVyLnByb3RvdHlwZS5vblVwZGF0ZSA9IGZ1bmN0aW9uIChkdCkge1xuICAgIHRoaXMubnVtYmVyQW5pbWF0aW9uLnVwZGF0ZShkdCk7XG59O1xuXG5EaWFtb25kc0NvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBub2RlID0gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvbWVudS9kaWFtb25kX3ZpZXcuY2NiaVwiLCBudWxsLCBcIkRpYW1vbmRzQ29udHJvbGxlclwiLCBuZXcgRGlhbW9uZHNDb250cm9sbGVyKCksIHRydWUpO1xuICAgIHJldHVybiBub2RlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBEaWFtb25kc0NvbnRyb2xsZXI7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMjAxNy8xMi8xNS5cbiAqL1xudmFyIEdhbWVNYW4gPSByZXF1aXJlKFwiLi4vbW9kZWwvR2FtZU1hblwiKTtcbnZhciBSZW1vdmVBZHNDb250cm9sbGVyID0gcmVxdWlyZShcIi4vUmVtb3ZlQWRzQ29udHJvbGxlclwiKTtcblxudmFyIEZhaWxDbkNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcbiAgICB0aGlzLl9yZXBsYXlDYWxsYmFjayA9IG51bGw7XG4gICAgdGhpcy5fbmV4dENhbGxiYWNrID0gbnVsbDtcblxuICAgIHRoaXMuc3BGYWlsQ24gPSBudWxsO1xuICAgIHRoaXMuc3BGYWlsRW4gPSBudWxsO1xuXG4gICAgLy8gdGhpcy5sYmxSZXdhcmQgPSBudWxsO1xuICAgIC8vdGhpcy5sYmxSZWxpZmUgPSBudWxsO1xuICAgIC8vIHRoaXMubGJsV2hlZWwgPSBudWxsO1xuXG4gICAgdGhpcy5sYmxTa2lwID0gbnVsbDtcblxuICAgIHRoaXMubGJsTXVsdGkgPSBudWxsO1xuICAgIC8vdGhpcy5uZFNraXBNYXNrID0gbnVsbDtcbiAgICAvL25ld1xuICAgIHRoaXMubGJsU2tpcENvc3REaWFtb25kcyA9IG51bGw7XG5cbiAgICAvL3RoaXMuYnRuU2tpcCA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKEZhaWxDbkNvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuRmFpbENuQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0ID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuX3JlcGxheUNhbGxiYWNrID0gbnVsbDtcbiAgICAvLyBnYW1lLmV2ZW50RGlzcGF0Y2hlci5yZW1vdmVFdmVudExpc3RlbmVyKFwiZGlhbG9nX3BvcGVkXCIsIHRoaXMub25EaWFsb2dQb3BlZCwgdGhpcyk7XG4gICAgLy8gZ2FtZS5ldmVudERpc3BhdGNoZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImRpYWxvZ19jbG9zZWRcIiwgdGhpcy5vbkRpYWxvZ0Nsb3NlZCwgdGhpcyk7XG4gICAgLy8gdGhpcy5yZW1vdmVOYXRpdmVBZCgpO1xufTtcblxuRmFpbENuQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAvLyBnYW1lLmV2ZW50RGlzcGF0Y2hlci5hZGRFdmVudExpc3RlbmVyKFwiZGlhbG9nX3BvcGVkXCIsIHRoaXMub25EaWFsb2dQb3BlZCwgdGhpcyk7XG4gICAgLy8gZ2FtZS5ldmVudERpc3BhdGNoZXIuYWRkRXZlbnRMaXN0ZW5lcihcImRpYWxvZ19jbG9zZWRcIiwgdGhpcy5vbkRpYWxvZ0Nsb3NlZCwgdGhpcyk7XG4gICAgaWYgKGdhbWUuYWRzTWFuYWdlci5zaG93VG9wQmFubmVyKSB7XG4gICAgICAgIGdhbWUuYWRzTWFuYWdlci5yZW1vdmVCYW5uZXJBZHMoXCJ0b3BcIik7XG4gICAgfVxufTtcblxuLy8gRmFpbENuQ29udHJvbGxlci5wcm90b3R5cGUub25EaWFsb2dQb3BlZCA9IGZ1bmN0aW9uICgpIHtcbi8vICAgICB0aGlzLnVwZGF0ZU5hdGl2ZUFkKCk7XG4vLyB9O1xuLy9cbi8vIEZhaWxDbkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlhbG9nQ2xvc2VkID0gZnVuY3Rpb24gKCkge1xuLy8gICAgIHRoaXMudXBkYXRlTmF0aXZlQWQoKTtcbi8vIH07XG4vL1xuLy8gRmFpbENuQ29udHJvbGxlci5wcm90b3R5cGUudXBkYXRlTmF0aXZlQWQgPSBmdW5jdGlvbiAoKSB7XG4vLyAgICAgaWYgKGdhbWUuZGlhbG9nTWFuYWdlci5pc1RvcGVzdERpYWxvZyh0aGlzLnJvb3ROb2RlKSkge1xuLy8gICAgICAgICB0aGlzLnNob3dOYXRpdmVBZCgpO1xuLy8gICAgIH0gZWxzZSB7XG4vLyAgICAgICAgIHRoaXMucmVtb3ZlTmF0aXZlQWQoKTtcbi8vICAgICB9XG4vLyB9O1xuLy9cbi8vIEZhaWxDbkNvbnRyb2xsZXIucHJvdG90eXBlLnNob3dOYXRpdmVBZCA9IGZ1bmN0aW9uICgpIHtcbi8vICAgICBnYW1lLmFkc01hbmFnZXIuc2hvd05hdGl2ZUFkKFwiZmFpbFwiLCAwLCAwKTtcbi8vIH07XG4vL1xuLy8gRmFpbENuQ29udHJvbGxlci5wcm90b3R5cGUucmVtb3ZlTmF0aXZlQWQgPSBmdW5jdGlvbiAoKSB7XG4vLyAgICAgZ2FtZS5hZHNNYW5hZ2VyLnJlbW92ZU5hdGl2ZUFkKFwiZmFpbFwiKTtcbi8vIH07XG5cbkZhaWxDbkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcbiAgICAvLyB0aGlzLmxibFdoZWVsLnNldFN0cmluZyhfKFwibHVja3lfd2hlZWxfdGl0bGVcIikpO1xuICAgIC8vIHRoaXMubGJsUmV3YXJkLnNldFN0cmluZyhfKFwid2F0Y2hfYWRzX2dldF9ib29zdHNcIikpO1xuICAgIHRoaXMubGJsU2tpcC5zZXRTdHJpbmcoXyhcInNraXBfbGV2ZWxfdGl0bGVcIikpO1xuICAgIC8vdGhpcy5sYmxTa2lwQ29zdERpYW1vbmRzLnNldFN0cmluZyhcInhcIiArIGdhbWUuY29uZmlnLnNraXBEaWFtb25kcyk7XG4gICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJmYWlsXCIpO1xuXG4gICAgaWYgKCFnYW1lLnV0aWxzLmlzUGFkKCkpIHtcbiAgICAgICAgdmFyIG5vZGUgPSBSZW1vdmVBZHNDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgdGhpcy5yb290Tm9kZS5hZGRDaGlsZChub2RlKTtcbiAgICAgICAgaWYgKGdhbWUudXRpbHMuaXNJT1NOb3RjaFNjcmVlbigpKSB7XG4gICAgICAgICAgICBub2RlLnkgKz0gNDA7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmxibE11bHRpLnNldFN0cmluZyhnYW1lLnV0aWxzLnNwcmludGYoXyhcIm11bHRpX2RpYW1vbmRzX3RpdGxlXCIpLFxuICAgICAgICBnYW1lLmNvbmZpZy5tdWx0aURpYW1vbmRzUmFuZ2VbMF0sXG4gICAgICAgIGdhbWUuY29uZmlnLm11bHRpRGlhbW9uZHNSYW5nZVsxXSkpO1xuXG4gICAgLy8yMDAgZGlhbW9uZHMgdG8gc2tpcC5cblxuICAgIC8vIGlmIChnYW1lLmdhbWVNYW4uY2FuU2tpcCgpKSB7XG4gICAgLy8gICAgIGNjLmxvZyhcImNhbiBza2lwXCIpO1xuICAgIC8vICAgICB0aGlzLm5kU2tpcE1hc2sudmlzaWJsZSA9IGZhbHNlO1xuICAgIC8vICAgICB0aGlzLmJ0blNraXAuZW5hYmxlZCA9IHRydWU7XG4gICAgLy8gfSBlbHNlIHtcbiAgICAvLyAgICAgY2MubG9nKFwiY2FuIG5vdCBza2lwXCIpO1xuICAgIC8vICAgICB0aGlzLm5kU2tpcE1hc2sudmlzaWJsZSA9IHRydWU7XG4gICAgLy8gICAgIHRoaXMuYnRuU2tpcC5lbmFibGVkID0gZmFsc2U7XG4gICAgLy8gfVxuXG4gICAgdmFyIFJld2FyZFJlbW92ZUFkQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuL1Jld2FyZFJlbW92ZUFkQ29udHJvbGxlclwiKTtcbiAgICB0aGlzLm5kUmV3YXJkUmVtb3ZlQWRzLmFkZENoaWxkKFJld2FyZFJlbW92ZUFkQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCkpO1xufTtcblxuRmFpbENuQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdFdpdGggPSBmdW5jdGlvbiAocmVwbGF5Q2FsbGJhY2ssIHNraXBDYWxsYmFjaykge1xuICAgIHRoaXMuX3JlcGxheUNhbGxiYWNrID0gcmVwbGF5Q2FsbGJhY2s7XG4gICAgdGhpcy5fc2tpcENhbGxiYWNrID0gc2tpcENhbGxiYWNrO1xufTtcblxuRmFpbENuQ29udHJvbGxlci5wcm90b3R5cGUub25BbmltRW5kID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICghZ2FtZS5nYW1lTWFuLmNoZWNrQW5kU2hvd0JveCgpKSB7XG4gICAgICAgIGlmICghR2FtZU1hbi5nZXRJbnN0YW5jZSgpLnRyeVNob3dGYWlsUG9wdXAoKSkge1xuICAgICAgICAgICAgZ2FtZS5hZHNIZWxwZXIuc2hvd1Bhc3NBZHMoKTtcbiAgICAgICAgfVxuICAgIH1cbn07XG5cbkZhaWxDbkNvbnRyb2xsZXIucHJvdG90eXBlLnJlc3RhcnRDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIGdhbWUuYXVkaW9QbGF5ZXIucGxheUVmZmVjdEJ5S2V5KFwiZW50ZXJcIik7XG4gICAgZ2FtZS5hZHNIZWxwZXIuc2hvd1Bhc3NBZHMoKTtcbiAgICBpZiAodGhpcy5fcmVwbGF5Q2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5fcmVwbGF5Q2FsbGJhY2soKTtcbiAgICB9XG4gICAgdGhpcy5jbG9zZSgpO1xufTtcblxuRmFpbENuQ29udHJvbGxlci5wcm90b3R5cGUuaG9tZUNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJlbnRlclwiKTtcbiAgICBnYW1lLmFkc0hlbHBlci5zaG93QmFja0hvbWVBZHMoKTtcbiAgICBnYW1lLnNjZW5lTWFuLnN3aXRjaFNjZW5lKGdhbWUuc2NlbmVUeXBlLk1FTlUpO1xufTtcblxuRmFpbENuQ29udHJvbGxlci5wcm90b3R5cGUud2F0Y2hBZHNNdWx0aUNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJlbnRlclwiKTtcbiAgICB2YXIgU3RvcmVIZWxwZXIgPSByZXF1aXJlKFwiLi4vbW9kZWwvU3RvcmVIZWxwZXJcIik7XG4gICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5jaGVja0FuZEdldFJhbmRvbURpYW1vbmRzKFwiZGlhbW9uZHNfcmFuZG9tX2ZhaWxcIik7XG59O1xuXG5GYWlsQ25Db250cm9sbGVyLnByb3RvdHlwZS5yZWxpZmVDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIC8vZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJlbnRlclwiKTtcbiAgICAvL3ZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcbiAgICAvL1N0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuY2hlY2tBbmRTaG93UmV3YXJkVmlkZW8oZnVuY3Rpb24gKCkge1xuICAgIC8vfSk7XG59O1xuXG5GYWlsQ25Db250cm9sbGVyLnByb3RvdHlwZS5za2lwQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICB2YXIgU3RvcmVIZWxwZXIgPSByZXF1aXJlKFwiLi4vbW9kZWwvU3RvcmVIZWxwZXJcIik7XG4gICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5jaGVja0FuZFNob3dSZXdhcmRWaWRlbyhnYW1lLnV0aWxzLmlzSU9TKCkgPyBcInRpYW9ndW8wMVwiIDogXCJza2lwXCIsIGZ1bmN0aW9uIChyZXdhcmRlZCkge1xuICAgICAgICBpZiAocmV3YXJkZWQpIHtcbiAgICAgICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcIldhdGNoQWRzVG9Ta2lwTGV2ZWxcIiwge1wibGV2ZWxcIjogR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmxldmVsSWR9KTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9za2lwQ2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9za2lwQ2FsbGJhY2soKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0uYmluZCh0aGlzKSk7XG59O1xuXG5GYWlsQ25Db250cm9sbGVyLnByb3RvdHlwZS53aGVlbENsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgdmFyIFdoZWVsVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1doZWVsVHlwZVwiKTtcbiAgICBnYW1lLnBvcHVwTWFuLnBvcHVwV2hlZWxEbGcoV2hlZWxUeXBlLkRhaWx5Qm9udXMpO1xufTtcblxuRmFpbENuQ29udHJvbGxlci5wcm90b3R5cGUucG9wdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLnBvcHVwKHRoaXMucm9vdE5vZGUpO1xufTtcblxuRmFpbENuQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLmNsb3NlKHRoaXMucm9vdE5vZGUpO1xufTtcblxuRmFpbENuQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9ub3RpY2UvZmFpbF92aWV3XzEuY2NiaVwiLCBudWxsLCBcIkZhaWxDbkNvbnRyb2xsZXJcIiwgbmV3IEZhaWxDbkNvbnRyb2xsZXIoKSk7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEZhaWxDbkNvbnRyb2xsZXI7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMjAxNy8xMi8xNS5cbiAqL1xudmFyIEdhbWVNYW4gPSByZXF1aXJlKFwiLi4vbW9kZWwvR2FtZU1hblwiKTtcbnZhciBSZW1vdmVBZHNDb250cm9sbGVyID0gcmVxdWlyZShcIi4vUmVtb3ZlQWRzQ29udHJvbGxlclwiKTtcblxudmFyIEZhaWxDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG4gICAgdGhpcy5fcmVwbGF5Q2FsbGJhY2sgPSBudWxsO1xuICAgIHRoaXMuX25leHRDYWxsYmFjayA9IG51bGw7XG5cbiAgICB0aGlzLnNwRmFpbENuID0gbnVsbDtcbiAgICB0aGlzLnNwRmFpbEVuID0gbnVsbDtcblxuICAgIHRoaXMubGJsUmV3YXJkID0gbnVsbDtcbiAgICAvL3RoaXMubGJsUmVsaWZlID0gbnVsbDtcbiAgICAvLyB0aGlzLmxibFdoZWVsID0gbnVsbDtcblxuICAgIHRoaXMubGJsU2tpcCA9IG51bGw7XG4gICAgLy90aGlzLm5kU2tpcE1hc2sgPSBudWxsO1xuICAgIC8vbmV3XG4gICAgdGhpcy5sYmxTa2lwQ29zdERpYW1vbmRzID0gbnVsbDtcbiAgICAvL3RoaXMuYnRuU2tpcCA9IG51bGw7XG5cbiAgICB0aGlzLm5kRnJlZURpYW1vbmRTaG9ydCA9IG51bGw7XG4gICAgdGhpcy5uZEZyZWVEaWFtb25kTG9uZyA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKEZhaWxDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbkZhaWxDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5fcmVwbGF5Q2FsbGJhY2sgPSBudWxsO1xufTtcblxuRmFpbENvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKGdhbWUuYWRzTWFuYWdlci5zaG93VG9wQmFubmVyKSB7XG4gICAgICAgIGdhbWUuYWRzTWFuYWdlci5yZW1vdmVCYW5uZXJBZHMoXCJ0b3BcIik7XG4gICAgfVxufTtcblxuRmFpbENvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcbiAgICAvLyB0aGlzLmxibFdoZWVsLnNldFN0cmluZyhfKFwibHVja3lfd2hlZWxfdGl0bGVcIikpO1xuICAgIHRoaXMubGJsUmV3YXJkLnNldFN0cmluZyhfKFwiZnJlZV9jb2luc190aXRsZVwiKSk7XG4gICAgdGhpcy5sYmxTa2lwLnNldFN0cmluZyhfKFwic2tpcF9sZXZlbF90aXRsZVwiKSk7XG4gICAgLy90aGlzLmxibFNraXBDb3N0RGlhbW9uZHMuc2V0U3RyaW5nKFwieFwiICsgZ2FtZS5jb25maWcuc2tpcERpYW1vbmRzKTtcbiAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImZhaWxcIik7XG5cbiAgICBpZiAoIWdhbWUudXRpbHMuaXNQYWQoKSkge1xuICAgICAgICB2YXIgbm9kZSA9IFJlbW92ZUFkc0NvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICB0aGlzLnJvb3ROb2RlLmFkZENoaWxkKG5vZGUpO1xuICAgICAgICBpZiAoZ2FtZS51dGlscy5pc0lPU05vdGNoU2NyZWVuKCkpIHtcbiAgICAgICAgICAgIG5vZGUueSArPSA0MDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMubmRGcmVlRGlhbW9uZFNob3J0LnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLm5kRnJlZURpYW1vbmRMb25nLnZpc2libGUgPSBmYWxzZTtcbiAgICBpZiAoZ2FtZS5hY3Rpdml0eU1hbi5pc09wZW4oKSkge1xuICAgICAgICB0aGlzLm5kRnJlZURpYW1vbmRTaG9ydC52aXNpYmxlID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLm5kRnJlZURpYW1vbmRMb25nLnZpc2libGUgPSB0cnVlO1xuICAgIH1cblxuICAgIC8vMjAwIGRpYW1vbmRzIHRvIHNraXAuXG5cbiAgICAvLyBpZiAoZ2FtZS5nYW1lTWFuLmNhblNraXAoKSkge1xuICAgIC8vICAgICBjYy5sb2coXCJjYW4gc2tpcFwiKTtcbiAgICAvLyAgICAgdGhpcy5uZFNraXBNYXNrLnZpc2libGUgPSBmYWxzZTtcbiAgICAvLyAgICAgdGhpcy5idG5Ta2lwLmVuYWJsZWQgPSB0cnVlO1xuICAgIC8vIH0gZWxzZSB7XG4gICAgLy8gICAgIGNjLmxvZyhcImNhbiBub3Qgc2tpcFwiKTtcbiAgICAvLyAgICAgdGhpcy5uZFNraXBNYXNrLnZpc2libGUgPSB0cnVlO1xuICAgIC8vICAgICB0aGlzLmJ0blNraXAuZW5hYmxlZCA9IGZhbHNlO1xuICAgIC8vIH1cbn07XG5cbkZhaWxDb250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aCA9IGZ1bmN0aW9uIChyZXBsYXlDYWxsYmFjaywgc2tpcENhbGxiYWNrKSB7XG4gICAgdGhpcy5fcmVwbGF5Q2FsbGJhY2sgPSByZXBsYXlDYWxsYmFjaztcbiAgICB0aGlzLl9za2lwQ2FsbGJhY2sgPSBza2lwQ2FsbGJhY2s7XG59O1xuXG5GYWlsQ29udHJvbGxlci5wcm90b3R5cGUub25BbmltRW5kID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICghZ2FtZS5nYW1lTWFuLmNoZWNrQW5kU2hvd0JveCgpKSB7XG4gICAgICAgIGlmICghR2FtZU1hbi5nZXRJbnN0YW5jZSgpLnRyeVNob3dGYWlsUG9wdXAoKSkge1xuICAgICAgICAgICAgZ2FtZS5hZHNIZWxwZXIuc2hvd1Bhc3NBZHMoKTtcbiAgICAgICAgfVxuICAgIH1cbn07XG5cbkZhaWxDb250cm9sbGVyLnByb3RvdHlwZS5yZXN0YXJ0Q2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImVudGVyXCIpO1xuICAgIGdhbWUuYWRzSGVscGVyLnNob3dQYXNzQWRzKCk7XG4gICAgaWYgKHRoaXMuX3JlcGxheUNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX3JlcGxheUNhbGxiYWNrKCk7XG4gICAgfVxuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cbkZhaWxDb250cm9sbGVyLnByb3RvdHlwZS5ob21lQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImVudGVyXCIpO1xuICAgIGdhbWUuYWRzSGVscGVyLnNob3dCYWNrSG9tZUFkcygpO1xuICAgIGdhbWUuc2NlbmVNYW4uc3dpdGNoU2NlbmUoZ2FtZS5zY2VuZVR5cGUuTUVOVSk7XG59O1xuXG5GYWlsQ29udHJvbGxlci5wcm90b3R5cGUud2F0Y2hBZHNDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIGdhbWUuYXVkaW9QbGF5ZXIucGxheUVmZmVjdEJ5S2V5KFwiZW50ZXJcIik7XG4gICAgdmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xuICAgIFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuY2hlY2tBbmRTaG93UmV3YXJkVmlkZW8oZ2FtZS51dGlscy5pc0lPUygpID8gXCJmYWlsZ2lmdFwiIDogXCJqaWxpMDZcIiwgbnVsbCwgXCJGYWlsQW5kV2F0Y2hEaWFtb25kc0Fkc1wiKTtcbn07XG5cbkZhaWxDb250cm9sbGVyLnByb3RvdHlwZS5yZWxpZmVDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIC8vZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJlbnRlclwiKTtcbiAgICAvL3ZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcbiAgICAvL1N0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuY2hlY2tBbmRTaG93UmV3YXJkVmlkZW8oZnVuY3Rpb24gKCkge1xuICAgIC8vfSk7XG59O1xuXG5GYWlsQ29udHJvbGxlci5wcm90b3R5cGUuYWN0aXZpdHlDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcIkRhaWx5VGFza0ZhaWxDbGlja1wiKTtcbiAgICBnYW1lLnBvcHVwTWFuLnBvcHVwQWN0aXZpdHlUYXNrKCk7XG59O1xuXG5GYWlsQ29udHJvbGxlci5wcm90b3R5cGUuc2tpcENsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgdmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xuICAgIFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuY2hlY2tBbmRTaG93UmV3YXJkVmlkZW8oZ2FtZS51dGlscy5pc0lPUygpID8gXCJ0aWFvZ3VvMDFcIiA6IFwic2tpcFwiLCBmdW5jdGlvbiAocmV3YXJkZWQpIHtcbiAgICAgICAgaWYgKHJld2FyZGVkKSB7XG4gICAgICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRXZlbnQoXCJXYXRjaEFkc1RvU2tpcExldmVsXCIsIHtcImxldmVsXCI6IEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5sZXZlbElkfSk7XG4gICAgICAgICAgICBpZiAodGhpcy5fc2tpcENhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fc2tpcENhbGxiYWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LmJpbmQodGhpcykpO1xufTtcblxuRmFpbENvbnRyb2xsZXIucHJvdG90eXBlLndoZWVsQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB2YXIgV2hlZWxUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vV2hlZWxUeXBlXCIpO1xuICAgIGdhbWUucG9wdXBNYW4ucG9wdXBXaGVlbERsZyhXaGVlbFR5cGUuRGFpbHlCb251cyk7XG59O1xuXG5GYWlsQ29udHJvbGxlci5wcm90b3R5cGUucG9wdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLnBvcHVwKHRoaXMucm9vdE5vZGUpO1xufTtcblxuRmFpbENvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5jbG9zZSh0aGlzLnJvb3ROb2RlKTtcbn07XG5cbkZhaWxDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL25vdGljZS9mYWlsX3ZpZXcuY2NiaVwiLCBudWxsLCBcIkZhaWxDb250cm9sbGVyXCIsIG5ldyBGYWlsQ29udHJvbGxlcigpKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gRmFpbENvbnRyb2xsZXI7IiwidmFyIEV2ZW50c05hbWUgPSByZXF1aXJlKFwiLi4vZXZlbnRzL0V2ZW50c05hbWVcIik7XG52YXIgQnJpY2tzVmlldyA9IHJlcXVpcmUoXCIuLi92aWV3L0JyaWNrc1ZpZXdcIik7XG52YXIgR2FtZU1hbiA9IHJlcXVpcmUoXCIuLi9tb2RlbC9HYW1lTWFuXCIpO1xudmFyIEJvb3N0VHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL0Jvb3N0VHlwZVwiKTtcbnZhciBIZWxwQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuL0hlbHBDb250cm9sbGVyXCIpO1xudmFyIFN0b3JlVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1N0b3JlVHlwZVwiKTtcbnZhciBBaW1JdGVtQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuL0FpbUl0ZW1Db250cm9sbGVyXCIpO1xudmFyIEFpbUhlbHBDb250cm9sbGVyID0gcmVxdWlyZShcIi4vQWltSGVscENvbnRyb2xsZXJcIik7XG52YXIgU3RvcmVIZWxwZXIgPSByZXF1aXJlKFwiLi4vbW9kZWwvU3RvcmVIZWxwZXJcIik7XG52YXIgR2lmdEJveENvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9HaWZ0Qm94Q29udHJvbGxlclwiKTtcbnZhciBCb2FyZEdldENvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi9Cb2FyZEdldENvbnRyb2xsZXJcIik7XG52YXIgU2tpblR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9Ta2luVHlwZVwiKTtcbnZhciBMYXNlckNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi9MYXNlckNvbnRyb2xsZXJcIik7XG52YXIgQ2hhbGxlbmdlSWQgPSByZXF1aXJlKFwiLi4vZW51bS9DaGFsbGVuZ2VJZFwiKTtcblxudmFyIEdhbWVDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG4gICAgdGhpcy5MSUZFX1NUQVJUX1RBRyA9IDEwMDtcbiAgICB0aGlzLkxJRkVfQ09VTlQgPSA2O1xuICAgIHRoaXMuS0VZX1NUQVJUX05PX1RBRyA9IDIwMDtcbiAgICB0aGlzLktFWV9DT1VOVCA9IDM7XG4gICAgdGhpcy5LRVlfU1RBUlRfVEFHID0gMzAwO1xuICAgIHRoaXMuTEFTRVJfQ09VTlQgPSAxMDtcbiAgICB0aGlzLkxBU0VSX1NUQVJUX1RBRyA9IDQwMDtcblxuICAgIHRoaXMubmRMaWZlTm9kZSA9IG51bGw7XG4gICAgdGhpcy5sYlRpbWUgPSBudWxsO1xuICAgIHRoaXMuX2dhbWVOb2RlID0gbnVsbDtcbiAgICB0aGlzLm5kSGVscCA9IG51bGw7XG4gICAgdGhpcy5uZEFpbUhlbHAgPSBudWxsO1xuXG4gICAgdGhpcy5uZEJvb3N0MSA9IG51bGw7XG4gICAgdGhpcy5uZEJvb3N0MiA9IG51bGw7XG5cbiAgICB0aGlzLm5kTGlmZU5vZGVzID0gbnVsbDtcblxuICAgIHRoaXMuc3BUb3BQcm9ncmVzcyA9IG51bGw7XG5cbiAgICB0aGlzLnNwWWVsbG93MSA9IG51bGw7XG4gICAgdGhpcy5zcFllbGxvdzIgPSBudWxsO1xuICAgIHRoaXMuc3BZZWxsb3czID0gbnVsbDtcblxuICAgIHRoaXMuc3BCbGFjazEgPSBudWxsO1xuICAgIHRoaXMuc3BCbGFjazIgPSBudWxsO1xuICAgIHRoaXMuc3BCbGFjazMgPSBudWxsO1xuXG4gICAgdGhpcy5sYkxldmVsID0gbnVsbDtcblxuICAgIHRoaXMubmRBbmltSXRlbSA9IG51bGw7XG4gICAgdGhpcy5uZEdldEJvYXJkU2tpbiA9IG51bGw7XG5cbiAgICB0aGlzLm5kVG9wQ29udGFpbmVyID0gbnVsbDtcbiAgICB0aGlzLm5kVG9wQmcgPSBudWxsO1xuXG4gICAgdGhpcy5uZExlZnQgPSBudWxsO1xuICAgIHRoaXMubmRSaWdodCA9IG51bGw7XG5cbiAgICB0aGlzLm5kU2tpcCA9IG51bGw7XG5cbiAgICB0aGlzLmxiM05ldyA9IG51bGw7XG4gICAgdGhpcy5sYjNNdWx0aXBsZSA9IG51bGw7XG5cbiAgICB0aGlzLm5kRGlhbW9uZE5ldyA9IG51bGw7XG4gICAgdGhpcy5uZERpYW1vbmRNdWx0aXBsZSA9IG51bGw7XG5cbiAgICB0aGlzLmxiRGlhbW9uZE5ldyA9IG51bGw7XG4gICAgdGhpcy5sYkRpYW1vbmRNdWx0aSA9IG51bGw7XG5cbiAgICB0aGlzLm5kR2lmdCA9IG51bGw7XG5cbiAgICB0aGlzLm5kU3RhciA9IG51bGw7XG5cbiAgICB0aGlzLm5kQ2hhbGxlbmdlID0gbnVsbDtcblxuICAgIHRoaXMubmRMZXZlbFRpdGxlID0gbnVsbDtcblxuICAgIHRoaXMubmRGbHlHaWZ0ID0gbnVsbDtcblxuICAgIHRoaXMuc3BZZWxsb3dzID0gW107XG4gICAgdGhpcy5zcEJsYWNrcyA9IFtdO1xuXG4gICAgdGhpcy5uZENvdW50RG93biA9IG51bGw7XG4gICAgdGhpcy5sYkNoYWxsZW5nZUNvdW50RG93biA9IG51bGw7XG4gICAgdGhpcy5sYkNoYWxsZW5nZUxldmVsID0gbnVsbDtcbiAgICB0aGlzLm5kS2V5Tm9kZSA9IG51bGw7XG5cbiAgICB0aGlzLnNob3dlZFNraXBBbmltID0gZmFsc2U7XG4gICAgdGhpcy5jb25maWcgPSBudWxsO1xuICAgIHRoaXMubmRMYXNlciA9IG51bGw7XG5cbiAgICB0aGlzLnNwTGV2ZWxzID0gW107XG5cbiAgICB0aGlzLm5kTGFzZXJzID0gW107XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKEdhbWVDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbkdhbWVDb250cm9sbGVyLnByb3RvdHlwZS5vbkVudGVyID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLmFkZEV2ZW50TGlzdGVuZXIoRXZlbnRzTmFtZS5VUERBVEVfTEVWRUwsIHRoaXMub25VcGRhdGVMZXZlbCwgdGhpcyk7XG4gICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuYWRkRXZlbnRMaXN0ZW5lcihFdmVudHNOYW1lLlJFRlJFU0hfQk9PU1QsIHRoaXMub25VcGRhdGVCb29zdCwgdGhpcyk7XG4gICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuYWRkRXZlbnRMaXN0ZW5lcihFdmVudHNOYW1lLlVQREFURV9BSU1fSVRFTSwgdGhpcy5vblVwZGF0ZUFpbUl0ZW0sIHRoaXMpO1xuICAgIC8vIGdhbWUuZXZlbnREaXNwYXRjaGVyLmFkZEV2ZW50TGlzdGVuZXIoRXZlbnRzTmFtZS5VUERBVEVfQk9BUkRfU0tJTl9JVEVNLCB0aGlzLm9uVXBkYXRlQm9hcmRTa2luSXRlbSwgdGhpcyk7XG5cbn07XG5cbkdhbWVDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5ldmVudERpc3BhdGNoZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihFdmVudHNOYW1lLlJFRlJFU0hfQk9PU1QsIHRoaXMub25VcGRhdGVCb29zdCwgdGhpcyk7XG4gICAgZ2FtZS5ldmVudERpc3BhdGNoZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihFdmVudHNOYW1lLlVQREFURV9MRVZFTCwgdGhpcy5vblVwZGF0ZUxldmVsLCB0aGlzKTtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5yZW1vdmVFdmVudExpc3RlbmVyKEV2ZW50c05hbWUuVVBEQVRFX0FJTV9JVEVNLCB0aGlzLm9uVXBkYXRlQWltSXRlbSwgdGhpcyk7XG4gICAgLy8gZ2FtZS5ldmVudERpc3BhdGNoZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihFdmVudHNOYW1lLlVQREFURV9CT0FSRF9TS0lOX0lURU0sIHRoaXMub25VcGRhdGVCb2FyZFNraW5JdGVtLCB0aGlzKTtcbiAgICB0aGlzLl9nYW1lQ29yZU5vZGUgPSBudWxsO1xufTtcblxuR2FtZUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcblxuICAgIHRoaXMubmRMaWZlTm9kZXMgPSBbXTtcbiAgICB0aGlzLm5kS2V5Tm9kZXMgPSBbXTtcbiAgICB0aGlzLm5kS2V5Tm9Ob2RlcyA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5MSUZFX0NPVU5UOyArK2kpIHtcbiAgICAgICAgdmFyIGxpZmVOb2RlID0gdGhpcy5uZExpZmVOb2RlLmdldENoaWxkQnlUYWcodGhpcy5MSUZFX1NUQVJUX1RBRyArIGkpO1xuICAgICAgICB0aGlzLm5kTGlmZU5vZGVzLnB1c2gobGlmZU5vZGUpO1xuICAgIH1cbiAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5LRVlfQ09VTlQ7ICsraSkge1xuICAgICAgICB2YXIga2V5Tm9kZSA9IHRoaXMubmRLZXlOb2RlLmdldENoaWxkQnlUYWcodGhpcy5LRVlfU1RBUlRfVEFHICsgaSk7XG4gICAgICAgIHZhciBrZXlOb05vZGUgPSB0aGlzLm5kS2V5Tm9kZS5nZXRDaGlsZEJ5VGFnKHRoaXMuS0VZX1NUQVJUX05PX1RBRyArIGkpO1xuICAgICAgICB0aGlzLm5kS2V5Tm9kZXMucHVzaChrZXlOb2RlKTtcbiAgICAgICAgdGhpcy5uZEtleU5vTm9kZXMucHVzaChrZXlOb05vZGUpO1xuICAgIH1cblxuICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLkxBU0VSX0NPVU5UOyArK2kpIHtcbiAgICAgICAgdmFyIG5vZGUgPSB0aGlzLm5kTGFzZXIuZ2V0Q2hpbGRCeVRhZyh0aGlzLkxBU0VSX1NUQVJUX1RBRyArIGkpO1xuICAgICAgICB0aGlzLm5kTGFzZXJzLnB1c2gobm9kZSk7XG4gICAgfVxuXG4gICAgdGhpcy5zcFllbGxvd3MgPSBbdGhpcy5zcFllbGxvdzEsIHRoaXMuc3BZZWxsb3cyLCB0aGlzLnNwWWVsbG93M107XG4gICAgdGhpcy5zcEJsYWNrcyA9IFt0aGlzLnNwQmxhY2sxLCB0aGlzLnNwQmxhY2syLCB0aGlzLnNwQmxhY2szXTtcblxuICAgIHZhciBjb25maWcgPSBudWxsO1xuICAgIHZhciBsZXZlbElkID0gbnVsbDtcbiAgICBpZiAod2luZG93LmlzRWRpdG9yKSB7XG4gICAgICAgIGNvbmZpZyA9IGdhbWUuZ2FtZU1hbi5sZXZlbENmZztcbiAgICAgICAgbGV2ZWxJZCA9IDA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY29uZmlnID0gR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmdldEN1ckNvbmZpZygpO1xuICAgICAgICBsZXZlbElkID0gR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmxldmVsSWQ7XG4gICAgfVxuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuXG4gICAgdGhpcy5fZ2FtZUNvcmVOb2RlID0gbmV3IEJyaWNrc1ZpZXcoY29uZmlnLCB0aGlzKTtcbiAgICB0aGlzLl9nYW1lTm9kZS5hZGRDaGlsZCh0aGlzLl9nYW1lQ29yZU5vZGUpO1xuXG4gICAgaWYgKGdhbWUuZ2FtZU1hbi5pc0NoYWxsZW5nZUxldmVsKSB7XG4gICAgICAgIHRoaXMubGJMZXZlbC5zZXRTdHJpbmcoZ2FtZS51dGlscy5zcHJpbnRmKF8oXCJjaGFsbGVuZ2VfdGl0bGVcIiksIGxldmVsSWQpKTtcbiAgICAgICAgdGhpcy5sYkNoYWxsZW5nZUxldmVsLnNldFN0cmluZyhnYW1lLnV0aWxzLnNwcmludGYoXyhcImNoYWxsZW5nZV90aXRsZVwiKSwgbGV2ZWxJZCkpO1xuICAgICAgICB0aGlzLm5kS2V5Tm9kZS52aXNpYmxlID0gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5sYkxldmVsLnNldFN0cmluZyhnYW1lLnV0aWxzLnNwcmludGYoXyhcImxldmVsX3RpdGxlXCIpLCBsZXZlbElkKSk7XG4gICAgICAgIHRoaXMubmRLZXlOb2RlLnZpc2libGUgPSB0cnVlO1xuICAgIH1cblxuICAgIHRoaXMudXBkYXRlTGlmZUNvdW50KCk7XG4gICAgdGhpcy51cGRhdGVCb29zdCgpO1xuICAgIHRoaXMudXBkYXRlS2V5Q291bnQoKTtcblxuICAgIHRoaXMubmRIZWxwLnZpc2libGUgPSBmYWxzZTtcblxuICAgIGlmIChnYW1lLnBsYXllck1hbi5wbGF5ZXIuaXNBaW1WZXJzaW9uKSB7XG4gICAgICAgIHZhciBmaXJzdEVudGVyID0gZ2FtZS5zdG9yYWdlQ29udHJvbGxlci5nZXRJdGVtKFwiZmlyc3RfZW50ZXJcIiwgXCJ0cnVlXCIpO1xuICAgICAgICBpZiAoZmlyc3RFbnRlciA9PT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgIHRoaXMubmRBaW1IZWxwLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5fZ2FtZUNvcmVOb2RlLnNob3dBaW1HdWlkZUFuaW1hdGlvbigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5uZEFpbUhlbHAudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5uZEFpbUhlbHAudmlzaWJsZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIHRoaXMudXBkYXRlVGltZSgpO1xuXG4gICAgaWYgKGdhbWUudXRpbHMuaXNJT1NOb3RjaFNjcmVlbigpKSB7XG4gICAgICAgIHRoaXMubmRUb3BDb250YWluZXIuaGVpZ2h0ICs9IDcwO1xuICAgICAgICB0aGlzLm5kVG9wQmcuaGVpZ2h0ICs9IDcwO1xuICAgIH0gZWxzZSBpZiAoZ2FtZS51dGlscy5pc1BhZCgpKSB7XG4gICAgICAgIHRoaXMubmRUb3BDb250YWluZXIuaGVpZ2h0IC09IDQwO1xuICAgICAgICB0aGlzLm5kVG9wQmcuaGVpZ2h0IC09IDQwO1xuICAgIH1cblxuICAgIGlmIChnYW1lLmdhbWVNYW4uaXNDaGFsbGVuZ2VMZXZlbCAmJiBnYW1lLmNoYWxsZW5nZU1hbi5jdXJyZW50Q2hhbGxlbmdlSWQgPT09IENoYWxsZW5nZUlkLkxhc2VyKSB7XG4gICAgICAgIHRoaXMubmRUb3BCZy5oZWlnaHQgKz0gNDI7XG4gICAgfVxuICAgIGlmICh3aW5kb3cuaXNFZGl0b3IpIHtcbiAgICAgICAgdmFyIHhPZmZzZXQgPSBjYy53aW5TaXplLndpZHRoIC0gNjQwO1xuICAgICAgICB0aGlzLm5kTGVmdC53aWR0aCA9IHRoaXMubmRMZWZ0LndpZHRoICsgeE9mZnNldCAqIDAuNTtcbiAgICAgICAgdGhpcy5uZFJpZ2h0LndpZHRoID0gdGhpcy5uZFJpZ2h0LndpZHRoICsgeE9mZnNldCAqIDAuNTtcbiAgICB9XG4gICAgdGhpcy5sYkRpYW1vbmRNdWx0aS5zZXRTdHJpbmcoXCIyMFwiKTtcbiAgICB0aGlzLmxiRGlhbW9uZE5ldy5zZXRTdHJpbmcoXCIyMFwiKTtcbiAgICB0aGlzLm9uVXBkYXRlQWltSXRlbSgpO1xuICAgIHRoaXMub25VcGRhdGVCb2FyZFNraW5JdGVtKGxldmVsSWQpO1xuICAgIC8vIHRoaXMubmRBaW1IZWxwLnZpc2libGUgPSBmYWxzZTtcblxuICAgIHRoaXMubmRTa2lwLnZpc2libGUgPSBmYWxzZTtcblxuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgZ2lmdEJveCA9IEdpZnRCb3hDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICBnaWZ0Qm94LmNvbnRyb2xsZXIuc2V0Q2FsbGJhY2soZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgIGlmIChzdGF0ZSA9PT0gXCJzdGFydFwiKSB7XG4gICAgICAgICAgICBzZWxmLl9nYW1lQ29yZU5vZGUuc3RvcCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2VsZi5fZ2FtZUNvcmVOb2RlLnJlc3VtZSgpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy5uZEdpZnQuYWRkQ2hpbGQoZ2lmdEJveCk7XG4gICAgdGhpcy5uZENvdW50RG93bi52aXNpYmxlID0gZmFsc2U7XG5cbiAgICB0aGlzLm5kTGV2ZWxUaXRsZS52aXNpYmxlID0gdHJ1ZTtcblxuICAgIHRoaXMubmRMYXNlci52aXNpYmxlID0gZmFsc2U7XG5cbiAgICBpZiAoZ2FtZS5nYW1lTWFuLmlzQ2hhbGxlbmdlTGV2ZWwpIHtcbiAgICAgICAgdGhpcy5uZFN0YXIudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLm5kQ2hhbGxlbmdlLnZpc2libGUgPSB0cnVlO1xuICAgICAgICB0aGlzLnNwTGV2ZWxzID0gW3RoaXMuc3BMZXZlbDEsIHRoaXMuc3BMZXZlbDIsIHRoaXMuc3BMZXZlbDMsIHRoaXMuc3BMZXZlbDQsIHRoaXMuc3BMZXZlbDVdO1xuICAgICAgICB2YXIgbGV2ZWwgPSAoZ2FtZS5jaGFsbGVuZ2VNYW4uZ2V0Q2hhbGxlbmdlTGV2ZWwoKSAtIDEpICUgNTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNwTGV2ZWxzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB2YXIgc3BMZXZlbCA9IHRoaXMuc3BMZXZlbHNbaV07XG4gICAgICAgICAgICBpZiAoaSA8PSBsZXZlbCkge1xuICAgICAgICAgICAgICAgIHNwTGV2ZWwuc2V0U3ByaXRlRnJhbWUoXCJpY29uX2NvbXBsZXRlZF80LnBuZ1wiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc3BMZXZlbC5zZXRTcHJpdGVGcmFtZShcImljb25fbG9ja2VkXzQucG5nXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGdhbWUuY2hhbGxlbmdlTWFuLmN1cnJlbnRDaGFsbGVuZ2VJZCA9PT0gQ2hhbGxlbmdlSWQuVGltZUxpbWl0KSB7XG4gICAgICAgICAgICB0aGlzLm5kQ291bnREb3duLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5uZExldmVsVGl0bGUudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5uZExldmVsVGl0bGUueCA9IHRoaXMubmRMZXZlbFRpdGxlLnBhcmVudC53aWR0aCAqIDAuNTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZ2FtZS5jaGFsbGVuZ2VNYW4uY3VycmVudENoYWxsZW5nZUlkID09PSBDaGFsbGVuZ2VJZC5MYXNlcikge1xuICAgICAgICAgICAgdGhpcy5uZExhc2VyLnZpc2libGUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5uZFN0YXIudmlzaWJsZSA9IHRydWU7XG4gICAgICAgIHRoaXMubmRDaGFsbGVuZ2UudmlzaWJsZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIHRoaXMubmRGbHlHaWZ0LnZpc2libGUgPSBmYWxzZTtcbn07XG5cbkdhbWVDb250cm9sbGVyLnByb3RvdHlwZS5zaG93TGFzZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGxpc3QgPSBbXTtcbiAgICB2YXIgY29uZmlnID0gdGhpcy5jb25maWc7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb25maWcuY29udGludW91c0xhemVycy5sZW5ndGg7ICsraSkge1xuICAgICAgICB2YXIgY29udGludW91c0NvdW50ID0gY29uZmlnLmNvbnRpbnVvdXNMYXplcnNbaV07XG4gICAgICAgIHZhciByYW5kb21OdW0gPSBnYW1lLnV0aWxzLnJhbmRvbU5leHRJbnQodGhpcy5MQVNFUl9DT1VOVCAtIGNvbnRpbnVvdXNDb3VudCk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY29udGludW91c0NvdW50OyArK2kpIHtcbiAgICAgICAgICAgIGxpc3QucHVzaChyYW5kb21OdW0gKyBpKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHdoaWxlIChsaXN0Lmxlbmd0aCA8IGNvbmZpZy5ub25lTGF6ZXJDb3VudCkge1xuICAgICAgICB2YXIgcmFuZG9tTnVtID0gZ2FtZS51dGlscy5yYW5kb21OZXh0SW50KHRoaXMuTEFTRVJfQ09VTlQpO1xuICAgICAgICBpZiAobGlzdC5pbmRleE9mKHJhbmRvbU51bSkgPT09IC0xKSB7XG4gICAgICAgICAgICBsaXN0LnB1c2gocmFuZG9tTnVtKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubmRMYXNlcnMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgaWYgKGxpc3QuaW5kZXhPZihpKSA9PT0gLTEpIHtcbiAgICAgICAgICAgIHRoaXMubmRMYXNlcnNbaV0uY29udHJvbGxlci5zaG93TGFzZXIoKTtcbiAgICAgICAgfVxuICAgIH1cbn07XG5cbkdhbWVDb250cm9sbGVyLnByb3RvdHlwZS5pc0NvbGxpc2lvbldpdGhMYXNlciA9IGZ1bmN0aW9uIChib2FyZCkge1xuICAgIHZhciBib2FyZEJvdW5kaW5nQm94ID0gYm9hcmQuZ2V0Qm91bmRpbmdCb3goKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubmRMYXNlcnMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgaWYgKHRoaXMubmRMYXNlcnNbaV0uY29udHJvbGxlci5pc1Nob3dlZExhc2VyKCkpIHtcbiAgICAgICAgICAgIGlmIChjYy5yZWN0SW50ZXJzZWN0c1JlY3QodGhpcy5uZExhc2Vyc1tpXS5jb250cm9sbGVyLmdldExhc2VyQm91bmRpbmdCb3goKSwgYm9hcmRCb3VuZGluZ0JveCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59O1xuXG5HYW1lQ29udHJvbGxlci5wcm90b3R5cGUuc2hvd1NraXBCdG5BbmltID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChnYW1lLmdhbWVNYW4uaXNDaGFsbGVuZ2VMZXZlbCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aGlzLnNob3dlZFNraXBBbmltKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5zaG93ZWRTa2lwQW5pbSA9IHRydWU7XG4gICAgdGhpcy5uZFNraXAudmlzaWJsZSA9IHRydWU7XG4gICAgdmFyIHRpbWUgPSAwLjU7XG4gICAgdGhpcy5uZFNraXAucnVuQWN0aW9uKGNjLnNlcXVlbmNlKCBjYy5zY2FsZVRvKHRpbWUsIDEuMiksIGNjLnNjYWxlVG8odGltZSwgMSksXG4gICAgICAgIGNjLnNjYWxlVG8odGltZSwgMC44KSwgY2Muc2NhbGVUbyh0aW1lLCAxKSkucmVwZWF0Rm9yZXZlcigpKTtcbn07XG5cbkdhbWVDb250cm9sbGVyLnByb3RvdHlwZS5zaG93QWltSGVscCA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLm5kQWltSGVscC52aXNpYmxlID0gdHJ1ZTtcbn07XG5cbkdhbWVDb250cm9sbGVyLnByb3RvdHlwZS5vblVwZGF0ZUFpbUl0ZW0gPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKGdhbWUuZ2FtZU1hbi5jYW5UcnlBaW1JdGVtKCkpIHtcbiAgICAgICAgdGhpcy5uZEFuaW1JdGVtLnZpc2libGUgPSB0cnVlO1xuICAgICAgICBjYy5sb2coXCJnYW1lIGNvbnRyb2xsZXIgY2FuIHVzZSBhaW0gaXRlbVwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLm5kQW5pbUl0ZW0udmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICBjYy5sb2coXCJnYW1lIGNvbnRyb2xsZXIgbm90IHVzZSBhaW0gaXRlbVwiKTtcbiAgICB9XG59O1xuXG5HYW1lQ29udHJvbGxlci5wcm90b3R5cGUub25VcGRhdGVCb2FyZFNraW5JdGVtID0gZnVuY3Rpb24gKGxldmVsSWQpIHtcbiAgICBpZiAobGV2ZWxJZCA8IDIpIHtcbiAgICAgICAgdGhpcy5uZEdldEJvYXJkU2tpbi52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIHJhbmRvbUJvYXJkU2tpbkNmZyA9IGdhbWUuZ2FtZU1hbi5nZXRSYW5kb21Cb2FyZChTa2luVHlwZS5XYXRjaEFkcyk7XG4gICAgaWYgKHJhbmRvbUJvYXJkU2tpbkNmZykge1xuICAgICAgICB0aGlzLm5kR2V0Qm9hcmRTa2luLnZpc2libGUgPSB0cnVlO1xuICAgICAgICB0aGlzLm5kR2V0Qm9hcmRTa2luLmNvbnRyb2xsZXIuaW5pdFdpdGgocmFuZG9tQm9hcmRTa2luQ2ZnKTtcbiAgICAgICAgaWYgKGdhbWUudXRpbHMuaXNJT1NOb3RjaFNjcmVlbigpKSB7XG4gICAgICAgICAgICB0aGlzLm5kR2V0Qm9hcmRTa2luLnkgKz0gNDA7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLm5kR2V0Qm9hcmRTa2luLnZpc2libGUgPSBmYWxzZTtcbiAgICB9XG4gICAgLy8gaWYgKGdhbWUuZ2FtZU1hbi5jYW5UcnlBaW1JdGVtKCkpIHtcbiAgICAvLyAgICAgdGhpcy5uZEdldEJvYXJkU2tpbi52aXNpYmxlID0gdHJ1ZTtcbiAgICAvLyAgICAgLy8gY2MubG9nKFwiZ2FtZSBjb250cm9sbGVyIGNhbiB1c2UgYWltIGl0ZW1cIik7XG4gICAgLy8gfSBlbHNlIHtcbiAgICAvLyAgICAgdGhpcy5uZEdldEJvYXJkU2tpbi52aXNpYmxlID0gZmFsc2U7XG4gICAgLy8gICAgIC8vIGNjLmxvZyhcImdhbWUgY29udHJvbGxlciBub3QgdXNlIGFpbSBpdGVtXCIpO1xuICAgIC8vIH1cbn07XG5cblxuXG5HYW1lQ29udHJvbGxlci5wcm90b3R5cGUudXBkYXRlS2V5Q291bnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGtleUNvdW50ID0gZ2FtZS5wbGF5ZXJNYW4ucGxheWVyLmN1cnJlbnRLZXlDb3VudDtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuS0VZX0NPVU5UOyArK2kpIHtcbiAgICAgICAgdmFyIG5vZGUgPSB0aGlzLm5kS2V5Tm9kZXNbaV07XG4gICAgICAgIG5vZGUudmlzaWJsZSA9IChrZXlDb3VudCA+IGkpO1xuICAgIH1cbn07XG5cbkdhbWVDb250cm9sbGVyLnByb3RvdHlwZS51cGRhdGVMaWZlQ291bnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIG5vd0xpZmVDb3VudCA9IHRoaXMuX2dhbWVDb3JlTm9kZS5saWZlQ291bnQ7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLkxJRkVfQ09VTlQ7ICsraSkge1xuICAgICAgICB2YXIgbGlmZU5vZGUgPSB0aGlzLm5kTGlmZU5vZGVzW2ldO1xuICAgICAgICBpZiAobGlmZU5vZGUpIHtcbiAgICAgICAgICAgIGxpZmVOb2RlLnZpc2libGUgPSAobm93TGlmZUNvdW50ID4gaSk7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG5HYW1lQ29udHJvbGxlci5wcm90b3R5cGUub25VcGRhdGVCb29zdCA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnVwZGF0ZUJvb3N0KCk7XG59O1xuXG5HYW1lQ29udHJvbGxlci5wcm90b3R5cGUudXBkYXRlQ291bnREb3duVGltZSA9IGZ1bmN0aW9uIChsZWZ0VGltZSkge1xuICAgIGNjLmxvZyhcImxiQ2hhbGxlbmdlQ291bnREb3duOlwiICsgbGVmdFRpbWUpO1xuICAgIHRoaXMubGJDaGFsbGVuZ2VDb3VudERvd24uc2V0U3RyaW5nKE1hdGguZmxvb3IobGVmdFRpbWUpKTtcbn07XG5cbkdhbWVDb250cm9sbGVyLnByb3RvdHlwZS51cGRhdGVCb29zdCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgdGhyZWVCYWxsQm9vc3RDb3VudCA9IGdhbWUucGxheWVyTWFuLmdldEJvb3N0Q291bnQoQm9vc3RUeXBlLlRIUkVFX0JBTEwpO1xuICAgIHZhciBzcGxpdEJhbGxCb29zdENvdW50ID0gZ2FtZS5wbGF5ZXJNYW4uZ2V0Qm9vc3RDb3VudChCb29zdFR5cGUuU1BMSVQpO1xuICAgIHRoaXMubGIzTmV3LnNldFN0cmluZyhcInhcIiArIHRocmVlQmFsbEJvb3N0Q291bnQpO1xuICAgIHRoaXMubGIzTXVsdGlwbGUuc2V0U3RyaW5nKFwieFwiICsgc3BsaXRCYWxsQm9vc3RDb3VudCk7XG5cbiAgICB0aGlzLmxiM05ldy52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5sYjNNdWx0aXBsZS52aXNpYmxlID0gZmFsc2U7XG5cbiAgICB0aGlzLm5kRGlhbW9uZE11bHRpcGxlLnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLm5kRGlhbW9uZE5ldy52aXNpYmxlID0gZmFsc2U7XG4gICAgaWYgKHRocmVlQmFsbEJvb3N0Q291bnQgPiAwKSB7XG4gICAgICAgIHRoaXMubGIzTmV3LnZpc2libGUgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubmREaWFtb25kTmV3LnZpc2libGUgPSB0cnVlO1xuICAgIH1cblxuICAgIGlmIChzcGxpdEJhbGxCb29zdENvdW50ID4gMCkge1xuICAgICAgICB0aGlzLmxiM011bHRpcGxlLnZpc2libGUgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubmREaWFtb25kTXVsdGlwbGUudmlzaWJsZSA9IHRydWU7XG4gICAgfVxuXG59O1xuXG5HYW1lQ29udHJvbGxlci5wcm90b3R5cGUudXBkYXRlVGltZSA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgY29zdFRpbWUgPSAwO1xuICAgIGlmICh0aGlzLl9nYW1lQ29yZU5vZGUuZWNsaXBzZWRUaW1lKSB7XG4gICAgICAgIGNvc3RUaW1lID0gdGhpcy5fZ2FtZUNvcmVOb2RlLmVjbGlwc2VkVGltZSAvIDEwMDA7XG4gICAgfVxuICAgIHRoaXMubGJUaW1lLnNldFN0cmluZyhnYW1lLnV0aWxzLmdldExvbmdGb3JtYXRUaW1lKGNvc3RUaW1lKSk7XG5cbiAgICB2YXIgcGVyY2VudCA9IEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5nZXRQcm9ncmVzc1BlcmNlbnQoY29zdFRpbWUpO1xuICAgIHRoaXMuc3BUb3BQcm9ncmVzcy5zZXRQcmVmZXJyZWRTaXplKGNjLnNpemUoMTUwICogcGVyY2VudCAqIDAuMDEsIDgpKTtcbiAgICB2YXIgc3RhciA9IEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5nZXRDdXJyZW50U3Rhcihjb3N0VGltZSk7XG4gICAgdGhpcy51cGRhdGVTdGFyKHN0YXIpO1xuXG4gICAgaWYgKGNvc3RUaW1lID49IHRoaXMuY29uZmlnLnN0YXJUaW1lICogMS41KSB7XG4gICAgICAgIHRoaXMuc2hvd1NraXBCdG5BbmltKCk7XG4gICAgfVxufTtcblxuR2FtZUNvbnRyb2xsZXIucHJvdG90eXBlLnVwZGF0ZVN0YXIgPSBmdW5jdGlvbiAoc3Rhcikge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMzsgKytpKSB7XG4gICAgICAgIHRoaXMuc3BZZWxsb3dzW2ldLnZpc2libGUgPSAoc3RhciA+PSBpICsgMSk7XG4gICAgICAgIHRoaXMuc3BCbGFja3NbaV0udmlzaWJsZSA9IChzdGFyIDwgaSArIDEpO1xuICAgIH1cbn07XG5cbkdhbWVDb250cm9sbGVyLnByb3RvdHlwZS5wYXVzZUNsaWNrZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgaWYgKHdpbmRvdy5pc0VkaXRvcikge1xuICAgICAgICB2YXIgRWRpdG9yU2NlbmUgPSByZXF1aXJlKFwiLi4vZWRpdG9yL3NjZW5lL0VkaXRvclNjZW5lXCIpO1xuICAgICAgICBjYy5kaXJlY3Rvci5ydW5TY2VuZShuZXcgRWRpdG9yU2NlbmUoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zaG93UGF1c2UoKTtcbiAgICB9XG59O1xuXG5HYW1lQ29udHJvbGxlci5wcm90b3R5cGUuc2hvd1BhdXNlID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuX2dhbWVDb3JlTm9kZS5zdG9wKCk7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIGdhbWUucG9wdXBNYW4ucG9wdXBQYXVzZURsZyhmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNlbGYuX2dhbWVDb3JlTm9kZS5yZXN1bWUoKTtcbiAgICB9KTtcbn07XG5cbi8vR2FtZUNvbnRyb2xsZXIucHJvdG90eXBlLnN0b3JlQ2xpY2tlZCA9IGZ1bmN0aW9uICgpIHtcbi8vICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuLy8gICAgdGhpcy5fZ2FtZUNvcmVOb2RlLnN0b3AoKTtcbi8vICAgIHZhciBzZWxmID0gdGhpcztcbi8vICAgIGdhbWUucG9wdXBNYW4ucG9wdXBTdG9yZURsZyhTdG9yZVR5cGUuRElBTU9ORCwgZnVuY3Rpb24gKCkge1xuLy8gICAgICAgIHNlbGYuX2dhbWVDb3JlTm9kZS5yZXN1bWUoKTtcbi8vICAgIH0pO1xuLy99O1xuXG5HYW1lQ29udHJvbGxlci5wcm90b3R5cGUubmV3M0NsaWNrZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgaWYgKCF0aGlzLl9nYW1lQ29yZU5vZGUuY2FuVXNlQm9vc3QoKSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChnYW1lLnBsYXllck1hbi51c2VCb29zdChCb29zdFR5cGUuVEhSRUVfQkFMTCkgfHxcbiAgICAgICAgKFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuYnV5T25lQm9vc3QoKSAmJiBnYW1lLnBsYXllck1hbi51c2VCb29zdChCb29zdFR5cGUuVEhSRUVfQkFMTCkpKSB7XG4gICAgICAgIHRoaXMuX2dhbWVDb3JlTm9kZS51c2VOZXczQmFsbEJvb3N0KCk7XG4gICAgICAgIHRoaXMudXBkYXRlQm9vc3QoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl9nYW1lQ29yZU5vZGUuc3RvcCgpO1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBTdG9yZURsZyhTdG9yZVR5cGUuRElBTU9ORCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc2VsZi5fZ2FtZUNvcmVOb2RlLnJlc3VtZSgpO1xuICAgICAgICB9KTtcbiAgICB9XG59O1xuXG5HYW1lQ29udHJvbGxlci5wcm90b3R5cGUubXVsdGlwbGUzQ2xpY2tlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBpZiAoIXRoaXMuX2dhbWVDb3JlTm9kZS5jYW5Vc2VCb29zdCgpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGdhbWUucGxheWVyTWFuLnVzZUJvb3N0KEJvb3N0VHlwZS5TUExJVCkgfHxcbiAgICAgICAgKFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuYnV5T25lQm9vc3QoKSAmJiBnYW1lLnBsYXllck1hbi51c2VCb29zdChCb29zdFR5cGUuU1BMSVQpKSkge1xuICAgICAgICB0aGlzLl9nYW1lQ29yZU5vZGUudXNlU3BsaXRCYWxsQm9vc3QoKTtcbiAgICAgICAgdGhpcy51cGRhdGVCb29zdCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX2dhbWVDb3JlTm9kZS5zdG9wKCk7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFN0b3JlRGxnKFN0b3JlVHlwZS5ESUFNT05ELCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzZWxmLl9nYW1lQ29yZU5vZGUucmVzdW1lKCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn07XG5cbkdhbWVDb250cm9sbGVyLnByb3RvdHlwZS5zdG9yZUNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiQ2xpY2tTdG9yZUluR2FtZVwiKTtcbiAgICB0aGlzLl9nYW1lQ29yZU5vZGUuc3RvcCgpO1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBnYW1lLnBvcHVwTWFuLnBvcHVwU3RvcmVEbGcoU3RvcmVUeXBlLkRJQU1PTkQsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2VsZi5fZ2FtZUNvcmVOb2RlLnJlc3VtZSgpO1xuICAgIH0pO1xufTtcblxuR2FtZUNvbnRyb2xsZXIucHJvdG90eXBlLnNraW5DbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcIkNsaWNrU2tpbnNJbkdhbWVcIik7XG4gICAgdGhpcy5fZ2FtZUNvcmVOb2RlLnN0b3AoKTtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFN0b3JlRGxnKFN0b3JlVHlwZS5TS0lOLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNlbGYuX2dhbWVDb3JlTm9kZS5yZXN1bWUoKTtcbiAgICB9KTtcbn07XG5cbkdhbWVDb250cm9sbGVyLnByb3RvdHlwZS5za2lwQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICB0aGlzLl9nYW1lQ29yZU5vZGUuc3RvcCgpO1xuICAgIHZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcbiAgICBTdG9yZUhlbHBlci5nZXRJbnN0YW5jZSgpLmNoZWNrQW5kU2hvd1Jld2FyZFZpZGVvKFwic2tpcF9nYW1lXCIsIGZ1bmN0aW9uIChyZXdhcmRlZCkge1xuICAgICAgICBpZiAocmV3YXJkZWQpIHtcbiAgICAgICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcIldhdGNoQWRzVG9Ta2lwTGV2ZWxHYW1lXCIsIHtcImxldmVsXCI6IEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5sZXZlbElkfSk7XG4gICAgICAgICAgICBHYW1lTWFuLmdldEluc3RhbmNlKCkuc2tpcExldmVsKCk7XG4gICAgICAgICAgICBnYW1lLnNjZW5lTWFuLnN3aXRjaFNjZW5lKGdhbWUuc2NlbmVUeXBlLkdBTUUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fZ2FtZUNvcmVOb2RlLnJlc3VtZSgpO1xuICAgICAgICB9XG4gICAgfS5iaW5kKHRoaXMpKTtcbn07XG5cbkdhbWVDb250cm9sbGVyLnByb3RvdHlwZS5mbHlHaWZ0Q2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICB0aGlzLm5kRmx5R2lmdC52aXNpYmxlID0gZmFsc2U7XG4gICAgaWYgKGdhbWUuYWRzTWFuYWdlci5pc1Jld2FyZFZpZGVvUmVhZHkoKSkge1xuICAgICAgICB0aGlzLl9nYW1lQ29yZU5vZGUuc3RvcCgpO1xuICAgIH1cbiAgICB2YXIgU3RvcmVIZWxwZXIgPSByZXF1aXJlKFwiLi4vbW9kZWwvU3RvcmVIZWxwZXJcIik7XG4gICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5jaGVja0FuZEdldFJhbmRvbURpYW1vbmRzKFwiZmx5X2dpZnRcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9nYW1lQ29yZU5vZGUucmVzdW1lKCk7XG4gICAgfS5iaW5kKHRoaXMpKTtcbn07XG5cbkdhbWVDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICBnYW1lLnV0aWxzLnJlZ2lzdGVyQ29udHJvbGxlcihcIkhlbHBDb250cm9sbGVyXCIsIG5ldyBIZWxwQ29udHJvbGxlcigpKTtcbiAgICBnYW1lLnV0aWxzLnJlZ2lzdGVyQ29udHJvbGxlcihcIkFpbUhlbHBDb250cm9sbGVyXCIsIG5ldyBBaW1IZWxwQ29udHJvbGxlcigpKTtcbiAgICBnYW1lLnV0aWxzLnJlZ2lzdGVyQ29udHJvbGxlcihcIkFpbUl0ZW1Db250cm9sbGVyXCIsIG5ldyBBaW1JdGVtQ29udHJvbGxlcigpKTtcbiAgICBnYW1lLnV0aWxzLnJlZ2lzdGVyQ29udHJvbGxlcihcIkJvYXJkR2V0Q29udHJvbGxlclwiLCBuZXcgQm9hcmRHZXRDb250cm9sbGVyKCkpO1xuICAgIGdhbWUudXRpbHMucmVnaXN0ZXJDb250cm9sbGVyKFwiTGFzZXJDb250cm9sbGVyXCIsIG5ldyBMYXNlckNvbnRyb2xsZXIoKSk7XG5cbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL2dhbWUvZ2FtZV92aWV3LmNjYmlcIiwgbnVsbCwgXCJHYW1lQ29udHJvbGxlclwiLCBuZXcgR2FtZUNvbnRyb2xsZXIoKSk7XG4gICAgZ2FtZS51dGlscy51blJlZ2lzdGVyQ29udHJvbGxlcihcIkFpbUl0ZW1Db250cm9sbGVyXCIpO1xuICAgIGdhbWUudXRpbHMudW5SZWdpc3RlckNvbnRyb2xsZXIoXCJIZWxwQ29udHJvbGxlclwiKTtcbiAgICBnYW1lLnV0aWxzLnVuUmVnaXN0ZXJDb250cm9sbGVyKFwiQWltSGVscENvbnRyb2xsZXJcIik7XG4gICAgZ2FtZS51dGlscy51blJlZ2lzdGVyQ29udHJvbGxlcihcIkJvYXJkR2V0Q29udHJvbGxlclwiKTtcbiAgICBnYW1lLnV0aWxzLnVuUmVnaXN0ZXJDb250cm9sbGVyKFwiTGFzZXJDb250cm9sbGVyXCIpO1xuICAgIHJldHVybiBub2RlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBHYW1lQ29udHJvbGxlcjsiLCJ2YXIgR2FtZU1hbiA9IHJlcXVpcmUoXCIuLi9tb2RlbC9HYW1lTWFuXCIpO1xudmFyIEdhbWVNb2RlID0gcmVxdWlyZShcIi4uL2VudW0vR2FtZU1vZGVcIik7XG5cbnZhciBHYW1lT3ZlckNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcbiAgICB0aGlzLl9iZXN0U2NvcmVMYWJlbCA9IG51bGw7XG4gICAgdGhpcy5fc2NvcmVMYWJlbCA9IG51bGw7XG5cbiAgICB0aGlzLl9pY29uRW5nbGlzaCA9IG51bGw7XG4gICAgdGhpcy5faWNvbkNoaW5lc2UgPSBudWxsO1xuICAgIHRoaXMuX25ld1JlY29yZExhYmVsID0gbnVsbDtcblxuICAgIHRoaXMuX3JlcGxheUNhbGxiYWNrID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoR2FtZU92ZXJDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbkdhbWVPdmVyQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuICAgIHRoaXMuX25ld1JlY29yZExhYmVsLnZpc2libGUgPSBmYWxzZTtcbn07XG5cbkdhbWVPdmVyQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdFdpdGggPSBmdW5jdGlvbiAocGVyY2VudCwgY2FsbGJhY2spIHtcbiAgICBpZiAoR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmdhbWVNb2RlID09PSBHYW1lTW9kZS5HQU1FX01PREVfRU5ETEVTUykge1xuICAgICAgICB0aGlzLl9iZXN0U2NvcmVMYWJlbC5zZXRTdHJpbmcoZ2FtZS51dGlscy5zcHJpbnRmKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJiZXN0X3Njb3JlX3RpdGxlXCIpLCBnYW1lLnBsYXllck1hbi5nZXRCZXN0U2NvcmUoKSkpO1xuICAgICAgICB0aGlzLl9zY29yZUxhYmVsLnNldFN0cmluZyhwZXJjZW50KTtcbiAgICAgICAgdGhpcy5fbmV3UmVjb3JkTGFiZWwuc2V0U3RyaW5nKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJuZXdfcmVjb3JkX3RpdGxlXCIpKTtcbiAgICAgICAgaWYgKEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5pc05ld1JlY29yZCkge1xuICAgICAgICAgICAgdGhpcy5fbmV3UmVjb3JkTGFiZWwudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLl9uZXdSZWNvcmRMYWJlbC5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoY2MuZmFkZU91dCgwLjMpLCBjYy5mYWRlSW4oMC4zKSkucmVwZWF0Rm9yZXZlcigpKTtcbiAgICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX2Jlc3RTY29yZUxhYmVsLnNldFN0cmluZyhnYW1lLnV0aWxzLnNwcmludGYoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcImxldmVsX3RpdGxlXCIpLCBHYW1lTWFuLmdldEluc3RhbmNlKCkubGV2ZWxDb25maWcuaWQpKTtcbiAgICAgICAgdGhpcy5fc2NvcmVMYWJlbC5zZXRTdHJpbmcoZ2FtZS51dGlscy5zcHJpbnRmKFwiJWQlJVwiLCBwZXJjZW50KSk7XG4gICAgfVxuICAgIHRoaXMuX3JlcGxheUNhbGxiYWNrID0gY2FsbGJhY2s7XG59O1xuXG5HYW1lT3ZlckNvbnRyb2xsZXIucHJvdG90eXBlLmhvbWVDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIHZhciByZVNjZW5lID0gbmV3IGNjLlRyYW5zaXRpb25GYWRlKDAuNSwgR2FtZUJyaWRnZS5nZXRNZW51U2NlbmUoKSwgY2MuY29sb3IoMjU1LCAyNTUsIDI1NSkpO1xuICAgIGNjLmRpcmVjdG9yLnJ1blNjZW5lKHJlU2NlbmUpO1xufTtcblxuR2FtZU92ZXJDb250cm9sbGVyLnByb3RvdHlwZS5yZXBsYXlDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGlmICh0aGlzLl9yZXBsYXlDYWxsYmFjaykge1xuICAgICAgICB0aGlzLl9yZXBsYXlDYWxsYmFjaygpO1xuICAgIH1cbiAgICB0aGlzLmNsb3NlKCk7XG59O1xuXG5HYW1lT3ZlckNvbnRyb2xsZXIucHJvdG90eXBlLnJhbmtDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGdhbWUuZ2NNYW5hZ2VyLnNob3dMZWFkZXJib2FyZChnYW1lLmNvbmZpZy5nZXRMZWFkZXJCb2FyZEtleSgpKTtcbn07XG5cbkdhbWVPdmVyQ29udHJvbGxlci5wcm90b3R5cGUuc2hhcmVDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGdhbWUuc2hhcmVNYW5hZ2VyLnNoYXJlV2l0aFN5c3RlbShnYW1lLnV0aWxzLnNwcmludGYoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcInNoYXJlX3RpcHNcIiksXG4gICAgICAgIGdhbWUucGxheWVyTWFuLmdldEJlc3RTY29yZSgpLCBnYW1lLmNvbmZpZy5nZXRQbGF0Zm9ybURvd25sb2FkVXJsKCkpKTtcbn07XG5cbkdhbWVPdmVyQ29udHJvbGxlci5wcm90b3R5cGUucG9wdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgLy9nYW1lLmRpYWxvZ01hbmFnZXIucG9wdXAodGhpcy5yb290Tm9kZSk7XG4gICAgLy9nYW1lLmRpYWxvZ01hbmFnZXIucG9wdXAodGhpcy5yb290Tm9kZSwge1wib3ZlcmxheU9wYWNpdHlcIjogMTAwfSk7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLnBvcHVwKHRoaXMucm9vdE5vZGUsIHtcIm92ZXJsYXlDb2xvclwiOiBjYy5jb2xvcigyNDMsIDI0MywgMjQzKSwgXCJvdmVybGF5T3BhY2l0eVwiOiAyMTB9KTtcbn07XG5cbkdhbWVPdmVyQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLmNsb3NlKHRoaXMucm9vdE5vZGUpO1xufTtcblxuR2FtZU92ZXJDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL21lbnUvZ2FtZV9vdmVyX3ZpZXcuY2NiaVwiLCBudWxsLCBcIkdhbWVPdmVyQ29udHJvbGxlclwiLCBuZXcgR2FtZU92ZXJDb250cm9sbGVyKCkpO1xuICAgIHJldHVybiBub2RlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBHYW1lT3ZlckNvbnRyb2xsZXI7IiwidmFyIEdhbWVNYW4gPSByZXF1aXJlKFwiLi4vbW9kZWwvR2FtZU1hblwiKTtcblxudmFyIEdhbWVXaW5Db250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG4gICAgdGhpcy5ZRUxMT1dfQ09MT1IgPSBjYy5jb2xvcigyNTQsIDE3NSwgMjUpO1xuXG4gICAgdGhpcy5fbmV4dE5vZGUgPSBudWxsO1xuXG4gICAgdGhpcy5fcmVzdWx0TGFiZWwgPSBudWxsO1xuXG4gICAgdGhpcy5fcmVwbGF5Q2FsbGJhY2sgPSBudWxsO1xuICAgIHRoaXMuX25leHRDYWxsYmFjayA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKEdhbWVXaW5Db250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbkdhbWVXaW5Db250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG5cbiAgICB0aGlzLl9yZXN1bHRMYWJlbC5zZXRTdHJpbmcoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcIm1pc3Npb25fY29tcGxldGVkX3RpdGxlXCIpKTtcbiAgICB2YXIgaGFzTmV4dExldmVsID0gR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmhhc05leHRMZXZlbCgpO1xuICAgIGlmICghaGFzTmV4dExldmVsKSB7XG4gICAgICAgIHRoaXMuX25leHROb2RlLnZpc2libGUgPSBmYWxzZTtcbiAgICB9XG59O1xuXG5HYW1lV2luQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdFdpdGggPSBmdW5jdGlvbiAoY2FsbGJhY2ssIG5leHRDYWxsYmFjaykge1xuICAgIHRoaXMuX3JlcGxheUNhbGxiYWNrID0gY2FsbGJhY2s7XG4gICAgdGhpcy5fbmV4dENhbGxiYWNrID0gbmV4dENhbGxiYWNrO1xufTtcblxuR2FtZVdpbkNvbnRyb2xsZXIucHJvdG90eXBlLmhvbWVDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIHZhciByZVNjZW5lID0gbmV3IGNjLlRyYW5zaXRpb25GYWRlKDAuNSwgR2FtZUJyaWRnZS5nZXRNZW51U2NlbmUoKSwgY2MuY29sb3IoMjU1LCAyNTUsIDI1NSkpO1xuICAgIGNjLmRpcmVjdG9yLnJ1blNjZW5lKHJlU2NlbmUpO1xufTtcblxuR2FtZVdpbkNvbnRyb2xsZXIucHJvdG90eXBlLm5leHRDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGlmICh0aGlzLl9uZXh0Q2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5fbmV4dENhbGxiYWNrKCk7XG4gICAgfVxuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cbkdhbWVXaW5Db250cm9sbGVyLnByb3RvdHlwZS5yZXBsYXlDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIGlmICh0aGlzLl9yZXBsYXlDYWxsYmFjaykge1xuICAgICAgICB0aGlzLl9yZXBsYXlDYWxsYmFjaygpO1xuICAgIH1cbiAgICB0aGlzLmNsb3NlKCk7XG59O1xuXG5HYW1lV2luQ29udHJvbGxlci5wcm90b3R5cGUucmFua0NsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgZ2FtZS5nY01hbmFnZXIuc2hvd0xlYWRlcmJvYXJkKGdhbWUuY29uZmlnLmdldExlYWRlckJvYXJkS2V5KCkpO1xufTtcblxuR2FtZVdpbkNvbnRyb2xsZXIucHJvdG90eXBlLnNoYXJlQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBnYW1lLnNoYXJlTWFuYWdlci5zaGFyZVdpdGhTeXN0ZW0oZ2FtZS51dGlscy5zcHJpbnRmKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJzaGFyZV90aXBzXCIpLFxuICAgICAgICBnYW1lLnBsYXllck1hbi5nZXRCZXN0U2NvcmUoKSwgZ2FtZS5jb25maWcuZ2V0UGxhdGZvcm1Eb3dubG9hZFVybCgpKSk7XG59O1xuXG5HYW1lV2luQ29udHJvbGxlci5wcm90b3R5cGUucG9wdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLnBvcHVwKHRoaXMucm9vdE5vZGUsIHtcIm92ZXJsYXlDb2xvclwiOiBjYy5jb2xvcigyNDMsIDI0MywgMjQzKSwgXCJvdmVybGF5T3BhY2l0eVwiOiAyMTB9KTtcbn07XG5cbkdhbWVXaW5Db250cm9sbGVyLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIuY2xvc2UodGhpcy5yb290Tm9kZSk7XG59O1xuXG5HYW1lV2luQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9tZW51L2dhbWVfd2luX3ZpZXcuY2NiaVwiLCBudWxsLCBcIkdhbWVXaW5Db250cm9sbGVyXCIsIG5ldyBHYW1lV2luQ29udHJvbGxlcigpKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gR2FtZVdpbkNvbnRyb2xsZXI7IiwidmFyIEdpZnRCb3hDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG4gICAgdGhpcy5jYWxsYmFjayA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKEdpZnRCb3hDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbkdpZnRCb3hDb250cm9sbGVyLnByb3RvdHlwZS5vbkVudGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkVudGVyLmNhbGwodGhpcyk7XG59O1xuXG5HaWZ0Qm94Q29udHJvbGxlci5wcm90b3R5cGUub25FeGl0ID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQuY2FsbCh0aGlzKTtcbiAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lb3V0S2V5KTtcbn07XG5cbkdpZnRCb3hDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG4gICAgdGhpcy5yb290Tm9kZS52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy50aW1lb3V0S2V5ID0gc2V0VGltZW91dCh0aGlzLm9uVGltZW91dC5iaW5kKHRoaXMpLCA1MDAwKTtcbn07XG5cbkdpZnRCb3hDb250cm9sbGVyLnByb3RvdHlwZS5zZXRDYWxsYmFjayA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgIHRoaXMuY2FsbGJhY2sgPSBjYWxsYmFjaztcbn07XG5cbkdpZnRCb3hDb250cm9sbGVyLnByb3RvdHlwZS5vblRpbWVvdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKGdhbWUuZ2FtZU1hbi5jYW5TaG93R2lmdEJveCgpKSB7XG4gICAgICAgIHRoaXMucm9vdE5vZGUudmlzaWJsZSA9IHRydWU7XG4gICAgICAgIGdhbWUuZ2FtZU1hbi5hZGRHaWZ0Q291bnQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnJvb3ROb2RlLnZpc2libGUgPSBmYWxzZTtcbiAgICB9XG59O1xuXG5HaWZ0Qm94Q29udHJvbGxlci5wcm90b3R5cGUuZ2lmdENsaWNrZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIGlmIChnYW1lLmFkc01hbmFnZXIuaXNSZXdhcmRWaWRlb1JlYWR5KCkpIHtcbiAgICAgICAgdGhpcy5yb290Tm9kZS52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIGlmIChzZWxmLmNhbGxiYWNrKSB7XG4gICAgICAgICAgICBzZWxmLmNhbGxiYWNrKFwic3RhcnRcIik7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xuICAgICAgICBTdG9yZUhlbHBlci5nZXRJbnN0YW5jZSgpLmNoZWNrQW5kU2hvd1Jld2FyZFZpZGVvKFwiZ2lmdF9ib3hcIiwgZnVuY3Rpb24gKHdhdGNoZWQpIHtcbiAgICAgICAgICAgIGlmICh3YXRjaGVkKSB7XG4gICAgICAgICAgICAgICAgZ2FtZS5nYW1lTWFuLm9uR2lmdEJveE9wZW5lZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLmNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmNhbGxiYWNrKFwiZW5kXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChzZWxmLmNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuY2FsbGJhY2soXCJlbmRcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59O1xuXG5HaWZ0Qm94Q29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9tZW51L2dpZnRfYm94X3ZpZXcuY2NiaVwiLCBudWxsLCBcIkdpZnRCb3hDb250cm9sbGVyXCIsIG5ldyBHaWZ0Qm94Q29udHJvbGxlcigpLCB0cnVlKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gR2lmdEJveENvbnRyb2xsZXI7IiwiXG5cbnZhciBIZWxwQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuICAgIHRoaXMubGJIZWxwSW5mbyA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKEhlbHBDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbkhlbHBDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG4gICAgaWYgKGdhbWUucGxheWVyTWFuLnBsYXllci5pc0FpbVZlcnNpb24pIHtcbiAgICAgICAgdGhpcy5sYkhlbHBJbmZvLnNldFN0cmluZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwiaGVscF9jb250ZW50X25ld1wiKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5sYkhlbHBJbmZvLnNldFN0cmluZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwiaGVscF9jb250ZW50XCIpKTtcbiAgICB9XG4gICAgdGhpcy5sYkhlbHBJbmZvLnNldEFsaWdubWVudChjYy5URVhUX0FMSUdOTUVOVF9DRU5URVIpO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBIZWxwQ29udHJvbGxlcjsiLCJ2YXIgTGFzZXJDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG4gICAgdGhpcy5uZExhc2VyID0gbnVsbDtcbiAgICB0aGlzLm5kTGFzZXJSZWdpb24gPSBudWxsO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhMYXNlckNvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuTGFzZXJDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG59O1xuXG5MYXNlckNvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlci5jYWxsKHRoaXMpO1xufTtcblxuTGFzZXJDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0LmNhbGwodGhpcyk7XG59O1xuXG5MYXNlckNvbnRyb2xsZXIucHJvdG90eXBlLnNob3dMYXNlciA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLm5kTGFzZXIudmlzaWJsZSA9IHRydWU7XG4gICAgZ2FtZS51dGlscy5wbGF5Q0NCQW5pbWF0aW9uKHRoaXMucm9vdE5vZGUsIFwic2hvd1wiKTtcbn07XG5cbkxhc2VyQ29udHJvbGxlci5wcm90b3R5cGUub25TaG93TGFzZXJFbmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5uZExhc2VyLnZpc2libGUgPSBmYWxzZTtcbn07XG5cbkxhc2VyQ29udHJvbGxlci5wcm90b3R5cGUuaXNTaG93ZWRMYXNlciA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5uZExhc2VyLnZpc2libGU7XG59O1xuXG5MYXNlckNvbnRyb2xsZXIucHJvdG90eXBlLmdldExhc2VyQm91bmRpbmdCb3ggPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMubmRMYXNlclJlZ2lvbi5nZXRCb3VuZGluZ0JveFRvV29ybGQoKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gTGFzZXJDb250cm9sbGVyOyIsInZhciBHYW1lU2NlbmUgPSByZXF1aXJlKFwiLi4vc2NlbmUvR2FtZVNjZW5lXCIpO1xudmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xudmFyIE11bHRpQ29sVGFibGVWaWV3ID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi9leHQvTXVsdGlDb2xUYWJsZVZpZXdcIik7XG52YXIgTGV2ZWxJdGVtQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuL0xldmVsSXRlbUNvbnRyb2xsZXJcIik7XG52YXIgTGV2ZWxDb25maWdNYW4gPSByZXF1aXJlKFwiLi4vY29uZmlnL0NvbmZpZ01hblwiKTtcbnZhciBMb2NrU3RhdHVzID0gcmVxdWlyZShcIi4uL2VudW0vTG9ja1N0YXR1c1wiKTtcbnZhciBHYW1lTWFuID0gcmVxdWlyZShcIi4uL21vZGVsL0dhbWVNYW5cIik7XG52YXIgVGl0bGVDb250cm9sbGVyID0gcmVxdWlyZShcIi4vVGl0bGVDb250cm9sbGVyXCIpO1xuXG52YXIgR1JJRF9TSVpFID0gWzEzNy41LCAxMjBdO1xuXG52YXIgTGV2ZWxJdGVtQ2VsbFZpZXcgPSBjYy5UYWJsZVZpZXdDZWxsLmV4dGVuZCh7XG4gICAgbGV2ZWxFbnRpdHk6IG51bGwsXG4gICAgbGV2ZWxJdGVtTm9kZTogbnVsbCxcbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICAgIHRoaXMubGV2ZWxJdGVtTm9kZSA9IExldmVsSXRlbUNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICB0aGlzLmFkZENoaWxkKHRoaXMubGV2ZWxJdGVtTm9kZSk7XG5cbiAgICAgICAgdGhpcy5sZXZlbEl0ZW1Ob2RlLnNldFBvc2l0aW9uKGNjLnAoR1JJRF9TSVpFWzBdICogMC41LCBHUklEX1NJWkVbMV0gKiAwLjUpKTtcbiAgICB9LFxuXG4gICAgaW5pdFdpdGg6IGZ1bmN0aW9uIChsZXZlbEVudGl0eSwgaWR4KSB7XG4gICAgICAgIHRoaXMubGV2ZWxFbnRpdHkgPSBsZXZlbEVudGl0eTtcbiAgICAgICAgdGhpcy5sZXZlbEl0ZW1Ob2RlLmNvbnRyb2xsZXIuaW5pdFdpdGgobGV2ZWxFbnRpdHksIGlkeCk7XG4gICAgfSxcblxuICAgIHNob3dBcHBlYXJBbmltOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMubGV2ZWxJdGVtTm9kZS5jb250cm9sbGVyLnNob3dBcHBlYXJBbmltKCk7XG4gICAgfSxcblxuICAgIHNob3dEaXNhcHBlYXJBbmltOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMubGV2ZWxJdGVtTm9kZS5jb250cm9sbGVyLnNob3dEaXNhcHBlYXJBbmltKCk7XG4gICAgfVxufSk7XG5cbnZhciBMZXZlbENvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcbiAgICB0aGlzLm5kQ29udGFpbmVyID0gbnVsbDtcbiAgICB0aGlzLmxiTGV2ZWxOYW1lID0gbnVsbDtcblxuICAgIC8vdXNlciBkYXRhLlxuICAgIHRoaXMuX2xldmVsTGlzdCA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKExldmVsQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5MZXZlbENvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcblxuICAgIHRoaXMuX2xldmVsTGlzdCA9IEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5nZXRMZXZlbExpc3QoKTtcbiAgICB0aGlzLnNob3dMZXZlbFRhYmxlVmlldygpO1xuXG4gICAgdmFyIHVzZXJMZXZlbCA9IEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5nZXRQbGF5ZXJMZXZlbCgpO1xuICAgIGlmICh1c2VyTGV2ZWwgPiB0aGlzLl9sZXZlbExpc3QubGVuZ3RoKSB7XG4gICAgICAgIHVzZXJMZXZlbCA9IHRoaXMuX2xldmVsTGlzdC5sZW5ndGg7XG4gICAgfVxuICAgIHZhciBjdXJSb3cgPSAwO1xuICAgIGlmICh1c2VyTGV2ZWwgJSB0aGlzLm51bWJlck9mR3JpZHNJbkNlbGwoKSA9PT0gMCkge1xuICAgICAgICBjdXJSb3cgPSBNYXRoLmZsb29yKHVzZXJMZXZlbCAvIHRoaXMubnVtYmVyT2ZHcmlkc0luQ2VsbCgpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBjdXJSb3cgPSBNYXRoLmZsb29yKHVzZXJMZXZlbCAvIHRoaXMubnVtYmVyT2ZHcmlkc0luQ2VsbCgpKSArIDE7XG4gICAgfVxuXG4gICAgdmFyIHlPZmZzZXQgPSAtKHRoaXMubnVtYmVyT2ZDZWxsc0luVGFibGVWaWV3KCkgLSBjdXJSb3cgKyAxKSAqIHRoaXMuZ3JpZFNpemVGb3JUYWJsZSgpLmhlaWdodCArXG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5nZXRWaWV3U2l6ZSgpLmhlaWdodDtcblxuICAgIGlmICh5T2Zmc2V0IDwgdGhpcy5fdGFibGVWaWV3Lm1pbkNvbnRhaW5lck9mZnNldCgpLnkpIHtcbiAgICAgICAgeU9mZnNldCA9IHRoaXMuX3RhYmxlVmlldy5taW5Db250YWluZXJPZmZzZXQoKS55O1xuICAgIH0gZWxzZSBpZiAoeU9mZnNldCA+PSB0aGlzLl90YWJsZVZpZXcubWF4Q29udGFpbmVyT2Zmc2V0KCkueSkge1xuICAgICAgICB5T2Zmc2V0ID0gdGhpcy5fdGFibGVWaWV3Lm1heENvbnRhaW5lck9mZnNldCgpLnk7XG4gICAgfVxuXG4gICAgdGhpcy5fdGFibGVWaWV3LnNldENvbnRlbnRPZmZzZXQoY2MucCgwLCB5T2Zmc2V0KSk7XG59O1xuXG5MZXZlbENvbnRyb2xsZXIucHJvdG90eXBlLnNob3dMZXZlbFRhYmxlVmlldyA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgc2l6ZSA9IHRoaXMubmRDb250YWluZXIuZ2V0Q29udGVudFNpemUoKTtcbiAgICB0aGlzLl90YWJsZVZpZXcgPSBuZXcgTXVsdGlDb2xUYWJsZVZpZXcodGhpcywgc2l6ZSwgbnVsbCk7XG4gICAgdGhpcy5fdGFibGVWaWV3LnNldERpcmVjdGlvbihjYy5TQ1JPTExWSUVXX0RJUkVDVElPTl9WRVJUSUNBTCk7XG4gICAgdGhpcy5fdGFibGVWaWV3LnNldFZlcnRpY2FsRmlsbE9yZGVyKGNjLlRBQkxFVklFV19GSUxMX1RPUERPV04pO1xuICAgIHRoaXMuX3RhYmxlVmlldy5zZXRNdWx0aVRhYmxlVmlld0RlbGVnYXRlKHRoaXMpO1xuICAgIHRoaXMuX3RhYmxlVmlldy5pZ25vcmVBbmNob3JQb2ludEZvclBvc2l0aW9uKGZhbHNlKTtcbiAgICB0aGlzLl90YWJsZVZpZXcuc2V0QW5jaG9yUG9pbnQoY2MucCgwLCAwKSk7XG4gICAgdGhpcy5uZENvbnRhaW5lci5hZGRDaGlsZCh0aGlzLl90YWJsZVZpZXcpO1xuICAgIHRoaXMuX3RhYmxlVmlldy5yZWxvYWREYXRhKCk7XG59O1xuXG5MZXZlbENvbnRyb2xsZXIucHJvdG90eXBlLnNjcm9sbFZpZXdEaWRTY3JvbGwgPSBmdW5jdGlvbiAodmlldykge1xufTtcblxuTGV2ZWxDb250cm9sbGVyLnByb3RvdHlwZS5zY3JvbGxWaWV3RGlkWm9vbSA9IGZ1bmN0aW9uICh2aWV3KSB7XG59O1xuXG5MZXZlbENvbnRyb2xsZXIucHJvdG90eXBlLmdyaWRBdEluZGV4ID0gZnVuY3Rpb24obXVsdGlUYWJsZSwgIGlkeCkge1xuICAgIHZhciBjZWxsID0gbXVsdGlUYWJsZS5kZXF1ZXVlR3JpZCgpO1xuICAgIGlmICghY2VsbCkge1xuICAgICAgICBjZWxsID0gbmV3IExldmVsSXRlbUNlbGxWaWV3KCk7XG4gICAgfVxuXG4gICAgaWYgKGlkeCA8IHRoaXMuX2xldmVsTGlzdC5sZW5ndGgpIHtcbiAgICAgICAgdmFyIGxldmVsRW50aXR5ID0gdGhpcy5fbGV2ZWxMaXN0W2lkeF07XG4gICAgICAgIGNlbGwuaW5pdFdpdGgobGV2ZWxFbnRpdHksIGlkeCk7XG4gICAgICAgIGNlbGwudmlzaWJsZSA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY2VsbC52aXNpYmxlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIGNlbGw7XG59O1xuXG5MZXZlbENvbnRyb2xsZXIucHJvdG90eXBlLm51bWJlck9mQ2VsbHNJblRhYmxlVmlldyA9IGZ1bmN0aW9uKG11bHRpVGFibGUpIHtcbiAgICB2YXIgZ3JpZHNJbkNlbGwgPSB0aGlzLm51bWJlck9mR3JpZHNJbkNlbGwobXVsdGlUYWJsZSk7XG4gICAgaWYgKHRoaXMuX2xldmVsTGlzdC5sZW5ndGggJSBncmlkc0luQ2VsbCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gTWF0aC5mbG9vcih0aGlzLl9sZXZlbExpc3QubGVuZ3RoIC8gZ3JpZHNJbkNlbGwpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBNYXRoLmZsb29yKHRoaXMuX2xldmVsTGlzdC5sZW5ndGggLyBncmlkc0luQ2VsbCkgKyAxO1xuICAgIH1cbn07XG5cbkxldmVsQ29udHJvbGxlci5wcm90b3R5cGUubnVtYmVyT2ZHcmlkc0luQ2VsbCA9IGZ1bmN0aW9uKG11bHRpVGFibGUsIGNvbElkeCkge1xuICAgIHJldHVybiA0O1xufTtcblxuTGV2ZWxDb250cm9sbGVyLnByb3RvdHlwZS5ncmlkU2l6ZUZvclRhYmxlID0gZnVuY3Rpb24odGFibGUsIGNvbElkeCkge1xuICAgIHJldHVybiBjYy5zaXplKEdSSURfU0laRVswXSwgR1JJRF9TSVpFWzFdKTtcbn07XG5cbkxldmVsQ29udHJvbGxlci5wcm90b3R5cGUuZ3JpZFRvdWNoZWQgPSBmdW5jdGlvbih0YWJsZSwgZ3JpZCkge1xuICAgIC8vY29uc29sZS5sb2coXCJncmlkIHRvdWNoZWQgYXQgaW5kZXg6IFwiICsgZ3JpZC5nZXRJZHgoKSk7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgaWYgKGdyaWQuZ2V0SWR4KCkgPCBHYW1lTWFuLmdldEluc3RhbmNlKCkuZ2V0UGxheWVyTGV2ZWwoKSkge1xuICAgICAgICBpZiAodGhpcy5jbGlja2VkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jbGlja2VkID0gdHJ1ZTtcbiAgICAgICAgR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmNob29zZUxldmVsKGdyaWQuZ2V0SWR4KCkgKyAxKTtcbiAgICAgICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5HQU1FKTtcbiAgICB9XG59O1xuXG5MZXZlbENvbnRyb2xsZXIucHJvdG90eXBlLmJhY2tDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGdhbWUuc2NlbmVNYW4uc3dpdGNoU2NlbmUoZ2FtZS5zY2VuZVR5cGUuTUVOVSk7XG59O1xuXG5MZXZlbENvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBub2RlID0gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvbWVudS9sZXZlbF92aWV3LmNjYmlcIiwgbnVsbCwgXCJMZXZlbENvbnRyb2xsZXJcIiwgbmV3IExldmVsQ29udHJvbGxlcigpKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gTGV2ZWxDb250cm9sbGVyOyIsInZhciBMb2NrU3RhdHVzID0gcmVxdWlyZShcIi4uL2VudW0vTG9ja1N0YXR1c1wiKTtcbnZhciBHYW1lTWFuID0gcmVxdWlyZShcIi4uL21vZGVsL0dhbWVNYW5cIik7XG5cbnZhciBMZXZlbEl0ZW1Db250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG5cbiAgICB0aGlzLkdSQVlfQ09MT1IgPSBjYy5jb2xvcig3OCwgMTAwLCAxNjkpO1xuICAgIHRoaXMuTElHSFRfQ09MT1IgPSBjYy5jb2xvcigyNTEsIDI1MiwgMjU1KTtcblxuICAgIHRoaXMubGJMZXZlbCA9IG51bGw7XG4gICAgdGhpcy5zcFBsYXllZCA9IG51bGw7XG4gICAgdGhpcy5zcExvY2tlZCA9IG51bGw7XG5cbiAgICB0aGlzLnNwQ3VycmVudCA9IG51bGw7XG5cbiAgICB0aGlzLm5kU3RhciA9IG51bGw7XG5cbiAgICB0aGlzLnNwWWVsbG93MSA9IG51bGw7XG4gICAgdGhpcy5zcFllbGxvdzIgPSBudWxsO1xuICAgIHRoaXMuc3BZZWxsb3czID0gbnVsbDtcblxuICAgIHRoaXMuc3BCbGFjazEgPSBudWxsO1xuICAgIHRoaXMuc3BCbGFjazIgPSBudWxsO1xuICAgIHRoaXMuc3BCbGFjazMgPSBudWxsO1xuXG4gICAgdGhpcy5zcFllbGxvd3MgPSBbXTtcbiAgICB0aGlzLnNwQmxhY2tzID0gW107XG5cbiAgICB0aGlzLmlkeCA9IDA7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKExldmVsSXRlbUNvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuTGV2ZWxJdGVtQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuICAgIHRoaXMuc3BZZWxsb3dzID0gW3RoaXMuc3BZZWxsb3cxLCB0aGlzLnNwWWVsbG93MiwgdGhpcy5zcFllbGxvdzNdO1xuICAgIHRoaXMuc3BCbGFja3MgPSBbdGhpcy5zcEJsYWNrMSwgdGhpcy5zcEJsYWNrMiwgdGhpcy5zcEJsYWNrM107XG59O1xuXG5MZXZlbEl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5zaG93QXBwZWFyQW5pbSA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLnV0aWxzLnJhbmRvbVNjYWxlQW5pbSh0aGlzLnJvb3ROb2RlLCAxLCAwLjgpO1xufTtcblxuTGV2ZWxJdGVtQ29udHJvbGxlci5wcm90b3R5cGUuc2hvd0Rpc2FwcGVhckFuaW0gPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5yb290Tm9kZS5ydW5BY3Rpb24oY2Muc2NhbGVUbygwLjQsIDApKTtcbn07XG5cbi8qKlxuICogQHBhcmFtIHtMZXZlbENvbmZpZ30gZGF0YVxuICogQHBhcmFtIHtudW1iZXJ9IGlkeFxuICovXG5MZXZlbEl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aCA9IGZ1bmN0aW9uIChkYXRhLCBpZHgpIHtcbiAgICBjYy5sb2coXCJMZXZlbEl0ZW1Db250cm9sbGVyIGluaXRXaXRoXCIpO1xuICAgIHRoaXMuaWR4ID0gaWR4O1xuICAgIHRoaXMubGJMZXZlbC5zZXRTdHJpbmcoaWR4ICsgMSk7XG4gICAgdmFyIGxldmVsID0gaWR4ICsgMTtcblxuICAgIHRoaXMuc3BDdXJyZW50LnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLnNwTG9ja2VkLnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLnNwUGxheWVkLnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLm5kU3Rhci52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5sYkxldmVsLnZpc2libGUgPSB0cnVlO1xuICAgIHZhciBjdXJMZXZlbCA9IEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5nZXRQbGF5ZXJMZXZlbCgpO1xuICAgIGlmIChjdXJMZXZlbCA9PT0gaWR4ICsgMSkge1xuICAgICAgICB0aGlzLnNwQ3VycmVudC52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5sYkxldmVsLnkgPSAwO1xuICAgICAgICB0aGlzLmxiTGV2ZWwuc2V0Q29sb3IodGhpcy5MSUdIVF9DT0xPUik7XG4gICAgfSBlbHNlIGlmIChjdXJMZXZlbCA+IGlkeCArIDEpIHtcbiAgICAgICAgdGhpcy5zcFBsYXllZC52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5uZFN0YXIudmlzaWJsZSA9IHRydWU7XG4gICAgICAgIHZhciBzdGFyID0gMDtcbiAgICAgICAgaWYgKEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5pc05ld0hhcmRNb2RlKCkpIHtcbiAgICAgICAgICAgIHN0YXIgPSBnYW1lLnBsYXllck1hbi5nZXROZXdIYXJkTGV2ZWxTdGFyKGxldmVsKSB8fCAwO1xuICAgICAgICB9IGVsc2VcbiAgICAgICAgaWYgKEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5pc0hhcmRNb2RlKCkpIHtcbiAgICAgICAgICAgIHN0YXIgPSBnYW1lLnBsYXllck1hbi5nZXRIYXJkTGV2ZWxTdGFyKGxldmVsKSB8fCAwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3RhciA9IGdhbWUucGxheWVyTWFuLmdldExldmVsU3RhcihsZXZlbCkgfHwgMDtcbiAgICAgICAgfVxuICAgICAgICBjYy5sb2coXCJMZXZlbEl0ZW1Db250cm9sbGVyIHN0YXI6XCIgKyBzdGFyKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAzOyArK2kpIHtcbiAgICAgICAgICAgIHRoaXMuc3BZZWxsb3dzW2ldLnZpc2libGUgPSAoc3RhciA+PSBpICsgMSk7XG4gICAgICAgICAgICB0aGlzLnNwQmxhY2tzW2ldLnZpc2libGUgPSAoc3RhciA8IGkgKyAxKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxiTGV2ZWwueSA9IDExO1xuICAgICAgICB0aGlzLmxiTGV2ZWwuc2V0Q29sb3IodGhpcy5MSUdIVF9DT0xPUik7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5sYkxldmVsLnkgPSAwO1xuICAgICAgICAvL3RoaXMubGJMZXZlbC52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc3BMb2NrZWQudmlzaWJsZSA9IHRydWU7XG4gICAgICAgIHRoaXMubGJMZXZlbC5zZXRDb2xvcih0aGlzLkdSQVlfQ09MT1IpO1xuICAgIH1cbn07XG5cbkxldmVsSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLmxldmVsQ2xpY2tlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBpZiAodGhpcy5pZHggPCBHYW1lTWFuLmdldEluc3RhbmNlKCkuZ2V0UGxheWVyTGV2ZWwoKSkge1xuICAgICAgICBHYW1lTWFuLmdldEluc3RhbmNlKCkuY2hvb3NlTGV2ZWwodGhpcy5pZHggKyAxKTtcbiAgICAgICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5HQU1FKTtcbiAgICB9XG59O1xuXG5MZXZlbEl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5nZXRDb250ZW50U2l6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5zcFBsYXllZC5nZXRDb250ZW50U2l6ZSgpO1xufTtcblxuTGV2ZWxJdGVtQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL21lbnUvbGV2ZWxfaXRlbV92aWV3LmNjYmlcIiwgbnVsbCwgXCJMZXZlbEl0ZW1Db250cm9sbGVyXCIsIG5ldyBMZXZlbEl0ZW1Db250cm9sbGVyKCkpO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBMZXZlbEl0ZW1Db250cm9sbGVyOyIsInZhciBNZW51U2NlbmUgPSByZXF1aXJlKFwiLi4vc2NlbmUvTWVudVNjZW5lXCIpO1xudmFyIFBsYXllck1hbiA9IHJlcXVpcmUoXCIuLi9tb2RlbC9QbGF5ZXJNYW5cIik7XG52YXIgU3RvcmVIZWxwZXIgPSByZXF1aXJlKFwiLi4vbW9kZWwvU3RvcmVIZWxwZXJcIik7XG52YXIgR2FtZVNjZW5lID0gcmVxdWlyZShcIi4uL3NjZW5lL0dhbWVTY2VuZVwiKTtcbnZhciBTY2VuZVR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9TY2VuZVR5cGVcIik7XG52YXIgR2FtZU1hbiA9IHJlcXVpcmUoXCIuLi9tb2RlbC9HYW1lTWFuXCIpO1xudmFyIFNjZW5lTWFuID0gcmVxdWlyZShcIi4uL21vZGVsL1NjZW5lTWFuXCIpO1xudmFyIEFkc1JlbWluZGVyQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL0Fkc1JlbWluZGVyQ29udHJvbGxlclwiKTtcbnZhciBEaWFtb25kc0NvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9EaWFtb25kc0NvbnRyb2xsZXJcIik7XG52YXIgQWN0aXZpdHlUYXNrVGlwc0NvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9BY3Rpdml0eVRhc2tUaXBzQ29udHJvbGxlclwiKTtcbnZhciBEYWlseVRhc2tFbnRyYW5jZUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9EYWlseVRhc2tFbnRyYW5jZUNvbnRyb2xsZXJcIik7XG5cbnZhciBMb2FkaW5nQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuICAgIHRoaXMuYmdFblNwcml0ZSA9IG51bGw7XG4gICAgdGhpcy5iZ0NuU3ByaXRlID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoTG9hZGluZ0NvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuTG9hZGluZ0NvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIuY2FsbCh0aGlzKTtcblxuICAgIGNjLkJ1aWxkZXJSZWFkZXIucmVnaXN0ZXJDb250cm9sbGVyKFwiQWRzUmVtaW5kZXJDb250cm9sbGVyXCIsIG5ldyBBZHNSZW1pbmRlckNvbnRyb2xsZXIoKSk7XG4gICAgY2MuQnVpbGRlclJlYWRlci5yZWdpc3RlckNvbnRyb2xsZXIoXCJEaWFtb25kc0NvbnRyb2xsZXJcIiwgbmV3IERpYW1vbmRzQ29udHJvbGxlcigpKTtcbiAgICBjYy5CdWlsZGVyUmVhZGVyLnJlZ2lzdGVyQ29udHJvbGxlcihcIkFjdGl2aXR5VGFza1RpcHNDb250cm9sbGVyXCIsIG5ldyBBY3Rpdml0eVRhc2tUaXBzQ29udHJvbGxlcigpKTtcbiAgICBjYy5CdWlsZGVyUmVhZGVyLnJlZ2lzdGVyQ29udHJvbGxlcihcIkRhaWx5VGFza0VudHJhbmNlQ29udHJvbGxlclwiLCBuZXcgRGFpbHlUYXNrRW50cmFuY2VDb250cm9sbGVyKCkpO1xuXG4gICAgZ2FtZS5wbGF5ZXJNYW4gPSBQbGF5ZXJNYW4uZ2V0SW5zdGFuY2UoKTtcbiAgICBnYW1lLnBsYXllck1hbi5pbml0RGF0YSgpO1xuXG4gICAgdmFyIExvZ2ljTWFuID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi9tb2RlbC9Mb2dpY01hblwiKTtcbiAgICBMb2dpY01hbi5nZXRJbnN0YW5jZSgpLnN0YXJ0R2FtZSh0cnVlKTtcblxuICAgIHZhciBSZXNvdXJjZXNNYW4gPSByZXF1aXJlKFwiLi4vbW9kZWwvUmVzb3VyY2VzTWFuXCIpO1xuXG4gICAgZ2FtZS5zY2VuZU1hbiA9IFNjZW5lTWFuLmdldEluc3RhbmNlKCk7XG4gICAgZ2FtZS5zY2VuZVR5cGUgPSBTY2VuZVR5cGU7XG5cbiAgICBnYW1lLmdhbWVNYW4uaW5pdCgpO1xuICAgIGdhbWUuZ2FtZU1hbi5yZWdpc3RlclJlbW90ZUNvbmZpZygpO1xuICAgIC8vZ2FtZS5nYW1lTWFuLmFkanVzdFNraW5Db25maWdzKCk7XG5cbiAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRXZlbnQoXCJMb2FkaW5nXCIpO1xuICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcIlRlc3RCb29zdFByb2JhYmlsaXR5XCIpO1xuICAgIHZhciBpc0ZpcnN0RW50ZXJHYW1lID0gdHJ1ZTtcbiAgICB2YXIgZmlyc3RPcGVuR2FtZSA9IGdhbWUuc3RvcmFnZUNvbnRyb2xsZXIuZ2V0SXRlbShcImZpcnN0T3BlbkdhbWVcIiwgXCJ0cnVlXCIpO1xuICAgIGlmIChmaXJzdE9wZW5HYW1lICE9IFwidHJ1ZVwiKSB7XG4gICAgICAgIGlzRmlyc3RFbnRlckdhbWUgPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBnYW1lLnN0b3JhZ2VDb250cm9sbGVyLnNldEl0ZW0oXCJmaXJzdE9wZW5HYW1lXCIsIFwiZmFsc2VcIik7XG4gICAgfVxuXG4gICAgdmFyIG15TG9nbyA9IGdhbWUudXRpbHMuaXNTZWxmR2FtZSgpO1xuXG4gICAgY2MubG9nKFwiaXNGaXJzdEVudGVyR2FtZTpcIiArIGlzRmlyc3RFbnRlckdhbWUpO1xuXG4gICAgdGhpcy5iZ0NuU3ByaXRlLnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLmJnRW5TcHJpdGUudmlzaWJsZSA9IGZhbHNlO1xuICAgIHZhciBzcHJpdGUgPSBteUxvZ28gPyB0aGlzLmJnQ25TcHJpdGUgOiB0aGlzLmJnRW5TcHJpdGU7XG4gICAgc3ByaXRlLnZpc2libGUgPSB0cnVlO1xuICAgIHNwcml0ZS5vcGFjaXR5ID0gMDtcbiAgICB2YXIgV0FJVF9USU1FID0gMjAwMDtcbiAgICBzcHJpdGUucnVuQWN0aW9uKGNjLnNlcXVlbmNlKGNjLmZhZGVJbigwLjUpLCBjYy5jYWxsRnVuYyhmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0aW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgUmVzb3VyY2VzTWFuLmdldEluc3RhbmNlKCkucHJlbG9hZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgbG9hZFRpbWUgPSBEYXRlLm5vdygpIC0gdGltZTtcbiAgICAgICAgICAgIGNjLmxvZyhcImxvYWRUaW1lOlwiICsgbG9hZFRpbWUpO1xuICAgICAgICAgICAgdmFyIGRlbGF5VGltZSA9IE1hdGgubWF4KFdBSVRfVElNRSAtIGxvYWRUaW1lLCAyMDApO1xuICAgICAgICAgICAgc3ByaXRlLnJ1bkFjdGlvbihjYy5zZXF1ZW5jZShjYy5kZWxheVRpbWUoZGVsYXlUaW1lIC8gMTAwMCksIGNjLmZhZGVPdXQoMC41KSwgY2MuY2FsbEZ1bmMoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChpc0ZpcnN0RW50ZXJHYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5jaG9vc2VMYXRlc3RMZXZlbCgpO1xuICAgICAgICAgICAgICAgICAgICBnYW1lLnNjZW5lTWFuLnN3aXRjaFNjZW5lKGdhbWUuc2NlbmVUeXBlLkdBTUUpO1xuICAgICAgICAgICAgICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRXZlbnQoXCJFbnRlckZpcnN0TGV2ZWxcIik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY2MuZGlyZWN0b3IucnVuU2NlbmUobmV3IE1lbnVTY2VuZSgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB0aGlzKSkpO1xuICAgICAgICB9KTtcbiAgICB9LCB0aGlzKSkpO1xufTtcblxuTG9hZGluZ0NvbnRyb2xsZXIucHJvdG90eXBlLm9uRXhpdCA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0LmNhbGwodGhpcyk7XG59O1xuXG5Mb2FkaW5nQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xufTtcblxuTG9hZGluZ0NvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBub2RlID0gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvbWVudS9sb2FkaW5nX3ZpZXcuY2NiaVwiLCBudWxsLCBcIkxvYWRpbmdDb250cm9sbGVyXCIsIG5ldyBMb2FkaW5nQ29udHJvbGxlcigpKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gTG9hZGluZ0NvbnRyb2xsZXI7IiwidmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xuXG52YXIgTHVja3lTcGluQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuXG4gICAgdGhpcy5sYmxNdWx0aSA9IG51bGw7XG4gICAgdGhpcy5yYW5kb21FbmRDYWxsYmFjayA9IG51bGw7XG5cbiAgICB0aGlzLm11bHRpTnVtID0gMTtcbiAgICB0aGlzLnJhbmdlID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoTHVja3lTcGluQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5MdWNreVNwaW5Db250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRXhpdC5jYWxsKHRoaXMpO1xufTtcblxuTHVja3lTcGluQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xufTtcblxuTHVja3lTcGluQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdFdpdGggPSBmdW5jdGlvbiAobXVsdGksIHJhbmdlLCBlbmRDYWxsYmFjaykge1xuICAgIHRoaXMubXVsdGlOdW0gPSBtdWx0aTtcbiAgICB0aGlzLnJhbmdlID0gcmFuZ2U7XG4gICAgdGhpcy5yYW5kb21FbmRDYWxsYmFjayA9IGVuZENhbGxiYWNrO1xuICAgIHRoaXMuc3RhcnRTcGluQW5pbSgpO1xufTtcblxuTHVja3lTcGluQ29udHJvbGxlci5wcm90b3R5cGUuc3RhcnRTcGluQW5pbSA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnNwaW5Db3VudCA9IDEwO1xuICAgIHRoaXMuc2hvd1JhbmRvbU11bHRpKCk7XG59O1xuXG5MdWNreVNwaW5Db250cm9sbGVyLnByb3RvdHlwZS5zaG93UmFuZG9tTXVsdGkgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5zcGluQ291bnQtLTtcbiAgICBpZiAodGhpcy5zcGluQ291bnQgPD0gMCkge1xuICAgICAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImJvbnVzXCIpO1xuICAgICAgICB0aGlzLmxibE11bHRpLnNldFN0cmluZyhcIlhcIiArIHRoaXMubXVsdGlOdW0pO1xuICAgICAgICB0aGlzLnJvb3ROb2RlLnNjaGVkdWxlT25jZSh0aGlzLmNsb3NlLmJpbmQodGhpcyksIDEpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGdhbWUuYXVkaW9QbGF5ZXIucGxheUVmZmVjdEJ5S2V5KFwiYm9udXNcIik7XG4gICAgICAgIHZhciByYW5kb21OdW0gPSBnYW1lLnV0aWxzLnJhbmRvbU5leHRJbnRJblJhbmdlKHRoaXMucmFuZ2VbMF0sIHRoaXMucmFuZ2VbMV0pO1xuICAgICAgICB0aGlzLmxibE11bHRpLnNldFN0cmluZyhcIlhcIiArIHJhbmRvbU51bSk7XG4gICAgICAgIHRoaXMucm9vdE5vZGUuc2NoZWR1bGVPbmNlKHRoaXMuc2hvd1JhbmRvbU11bHRpLmJpbmQodGhpcyksIDAuMyk7XG4gICAgfVxufTtcblxuTHVja3lTcGluQ29udHJvbGxlci5wcm90b3R5cGUucG9wdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLnBvcHVwKHRoaXMucm9vdE5vZGUsIHtwb3B1cEFuaW06IGZhbHNlfSk7XG59O1xuXG5MdWNreVNwaW5Db250cm9sbGVyLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIuY2xvc2UodGhpcy5yb290Tm9kZSk7XG4gICAgaWYgKHRoaXMucmFuZG9tRW5kQ2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5yYW5kb21FbmRDYWxsYmFjaygpO1xuICAgICAgICB0aGlzLnJhbmRvbUVuZENhbGxiYWNrID0gbnVsbDtcbiAgICB9XG59O1xuXG5MdWNreVNwaW5Db250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL25vdGljZS9sdWNreV9zcGluX3ZpZXcuY2NiaVwiLCBudWxsLCBcIkx1Y2t5U3BpbkNvbnRyb2xsZXJcIiwgbmV3IEx1Y2t5U3BpbkNvbnRyb2xsZXIoKSk7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEx1Y2t5U3BpbkNvbnRyb2xsZXI7IiwiLy92YXIgUGFja2FnZVNjZW5lID0gcmVxdWlyZShcIi4uL3NjZW5lL1BhY2thZ2VTY2VuZVwiKTtcbi8vdmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xuLy92YXIgTGV2ZWxTY2VuZSA9IHJlcXVpcmUoXCIuLi9zY2VuZS9MZXZlbFNjZW5lXCIpO1xuLy92YXIgR2FtZVNjZW5lID0gcmVxdWlyZShcIi4uL3NjZW5lL0dhbWVTY2VuZVwiKTtcbnZhciBHYW1lTWFuID0gcmVxdWlyZShcIi4uL21vZGVsL0dhbWVNYW5cIik7XG52YXIgU3RvcmVIZWxwZXIgPSByZXF1aXJlKFwiLi4vbW9kZWwvU3RvcmVIZWxwZXJcIik7XG52YXIgRXZlbnRzTmFtZSA9IHJlcXVpcmUoXCIuLi9ldmVudHMvRXZlbnRzTmFtZVwiKTtcbnZhciBDcm9zc0Fkc0NvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uL2NvbnRyb2xsZXIvQ3Jvc3NBZHNDb250cm9sbGVyXCIpO1xuXG5nYW1lLmZpcnN0RW50ZXIgPSB0cnVlO1xuXG52YXIgTWVudUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcblxuICAgIHRoaXMuRkxZX0dJRlRfTUlOX1ggPSA1MDtcblxuICAgIC8vdGhpcy5zcFBsYXlFbiA9IG51bGw7XG4gICAgLy90aGlzLnNwUGxheUNuID0gbnVsbDtcbiAgICAvL3RoaXMuc3BMZXZlbHNFbiA9IG51bGw7XG4gICAgLy90aGlzLnNwTGV2ZWxzQ24gPSBudWxsO1xuICAgIHRoaXMuc3BJY29uRW4gPSBudWxsO1xuICAgIHRoaXMuc3BJY29uQ24gPSBudWxsO1xuXG4gICAgdGhpcy5fcmFua0l0ZW0gPSBudWxsO1xuICAgIHRoaXMuX3N1cHBvcnRJdGVtID0gbnVsbDtcbiAgICB0aGlzLl9zdG9yZUl0ZW0gPSBudWxsO1xuICAgIHRoaXMuX3JhdGVJdGVtID0gbnVsbDtcbiAgICB0aGlzLl9zb3VuZEl0ZW0gPSBudWxsO1xuXG4gICAgLy90aGlzLnNwSGFyZENuID0gbnVsbDtcbiAgICAvL3RoaXMuc3BIYXJkRW4gPSBudWxsO1xuXG4gICAgdGhpcy5zcEhhcmRIaW50ID0gbnVsbDtcblxuICAgIC8vdGhpcy5idG5HaWZ0RW4gPSBudWxsO1xuICAgIC8vdGhpcy5idG5HaWZ0Q24gPSBudWxsO1xuICAgIC8vXG4gICAgLy90aGlzLmJ0bldoZWVsQ24gPSBudWxsO1xuICAgIC8vdGhpcy5idG5XaGVlbEVuID0gbnVsbDtcblxuICAgIHRoaXMuc3BHaWZ0QmcgPSBudWxsO1xuICAgIHRoaXMubmRTcGVjaWFsT2ZmZXIgPSBudWxsO1xuXG4gICAgdGhpcy5uZEdpZnRzID0gbnVsbDtcblxuICAgIHRoaXMuc3BUYXNrUmVtaW5kZXIgPSBudWxsO1xuICAgIHRoaXMuc3BTa2luUmVtaW5kZXIgPSBudWxsO1xuXG4gICAgdGhpcy5sYlN0YXJDb3VudCA9IG51bGw7XG5cbiAgICB0aGlzLm5kQ3Jvc3NBZCA9IG51bGw7XG5cbiAgICB0aGlzLm5kQ2hhbGxlbmdlTm9ybWFsID0gbnVsbDtcbiAgICB0aGlzLm5kQ2hhbGxlbmdlR3JheSA9IG51bGw7XG5cbiAgICB0aGlzLnNwQ2hhbGxlbmdlUmVtaW5kZXIgPSBudWxsO1xuXG4gICAgdGhpcy5uZFJlbW92ZUFkcyA9IG51bGw7XG5cbiAgICAvLyB0aGlzLm5kQ2hyaXN0bWFzID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoTWVudUNvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuTWVudUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIuY2FsbCh0aGlzKTtcbiAgICAvLyBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAvLyAgICAgdmFyIGZpcnN0T3BlbkdhbWUgPSBnYW1lLnN0b3JhZ2VDb250cm9sbGVyLmdldEl0ZW0oXCJmaXJzdE9wZW5HYW1lXCIsIFwidHJ1ZVwiKTtcbiAgICAvLyAgICAgaWYgKGZpcnN0T3BlbkdhbWUgIT0gXCJ0cnVlXCIpIHtcbiAgICAvLyAgICAgICAgIGlmIChnYW1lLmZpcnN0RW50ZXIpIHtcbiAgICAvLyAgICAgICAgICAgICBHYW1lTWFuLmdldEluc3RhbmNlKCkuYWRkQ2hlY2soKTtcbiAgICAvLyAgICAgICAgICAgICBHYW1lTWFuLmdldEluc3RhbmNlKCkub25DaGVja05leHQoKTtcbiAgICAvLyAgICAgICAgIH0gZWxzZSB7XG4gICAgLy8gICAgICAgICAgICAgR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmNoZWNrQXV0b1BvcHVwKGdhbWUuZmlyc3RFbnRlcik7XG4gICAgLy8gICAgICAgICB9XG4gICAgLy8gICAgIH0gZWxzZSB7XG4gICAgLy8gICAgICAgICBnYW1lLnN0b3JhZ2VDb250cm9sbGVyLnNldEl0ZW0oXCJmaXJzdE9wZW5HYW1lXCIsIFwiZmFsc2VcIik7XG4gICAgLy8gICAgIH1cbiAgICAvLyAgICAgZ2FtZS5maXJzdEVudGVyID0gZmFsc2U7XG4gICAgLy8gfSwgMzAwKTtcbiAgICB0aGlzLnVwZGF0ZVRhc2tSZW1pbmRlcigpO1xuICAgIHRoaXMuaW50ZXJ2YWxLZXkgPSBzZXRJbnRlcnZhbCh0aGlzLm9uVXBkYXRlLmJpbmQodGhpcyksIDEwMDApO1xuICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLmFkZEV2ZW50TGlzdGVuZXIoRXZlbnRzTmFtZS5VUERBVEVfU1BFQ0lBTF9PRkZFUiwgdGhpcy51cGRhdGVTcGVpY2lhbE9mZmVyLCB0aGlzKTtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5hZGRFdmVudExpc3RlbmVyKEV2ZW50c05hbWUuVEFTS19VUERBVEUsIHRoaXMudXBkYXRlVGFza1JlbWluZGVyLCB0aGlzKTtcbn07XG5cbk1lbnVDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsS2V5KTtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5yZW1vdmVFdmVudExpc3RlbmVyKEV2ZW50c05hbWUuVEFTS19VUERBVEUsIHRoaXMudXBkYXRlVGFza1JlbWluZGVyLCB0aGlzKTtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5yZW1vdmVFdmVudExpc3RlbmVyKEV2ZW50c05hbWUuVVBEQVRFX1NQRUNJQUxfT0ZGRVIsIHRoaXMudXBkYXRlU3BlaWNpYWxPZmZlciwgdGhpcyk7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRXhpdC5jYWxsKHRoaXMpO1xufTtcblxuTWVudUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcblxuICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcIkVudGVyTWVudVwiKTtcbiAgICAvL3RoaXMuY3JlYXRlQ2x1YkJ1dHRvbigpO1xuICAgIHRoaXMudXBkYXRlU291bmRJdGVtKCk7XG4gICAgdGhpcy51cGRhdGVHaWZ0SXRlbSgpO1xuICAgIC8vdGhpcy5zcFBsYXlFbi52aXNpYmxlID0gZmFsc2U7XG4gICAgLy90aGlzLnNwUGxheUNuLnZpc2libGUgPSBmYWxzZTtcbiAgICAvL3RoaXMuc3BMZXZlbHNFbi52aXNpYmxlID0gZmFsc2U7XG4gICAgLy90aGlzLnNwTGV2ZWxzQ24udmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMuc3BJY29uRW4udmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMuc3BJY29uQ24udmlzaWJsZSA9IGZhbHNlO1xuICAgIC8vdGhpcy5zcEhhcmRDbi52aXNpYmxlID0gZmFsc2U7XG4gICAgLy90aGlzLnNwSGFyZEVuLnZpc2libGUgPSBmYWxzZTtcbiAgICAvL3RoaXMuYnRuR2lmdEVuLnZpc2libGUgPSBmYWxzZTtcbiAgICAvL3RoaXMuYnRuR2lmdENuLnZpc2libGUgPSBmYWxzZTtcbiAgICAvL3RoaXMuYnRuV2hlZWxDbi52aXNpYmxlID0gZmFsc2U7XG4gICAgLy90aGlzLmJ0bldoZWVsRW4udmlzaWJsZSA9IGZhbHNlO1xuXG4gICAgaWYgKGdhbWUubG9jYWwuaXNDaGluZXNlKCkpIHtcbiAgICAgICAgLy90aGlzLnNwUGxheUNuLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAvL3RoaXMuc3BMZXZlbHNDbi52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zcEljb25Dbi52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgLy90aGlzLnNwSGFyZENuLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAvL3RoaXMuYnRuR2lmdENuLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAvL3RoaXMuYnRuV2hlZWxDbi52aXNpYmxlID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvL3RoaXMuc3BQbGF5RW4udmlzaWJsZSA9IHRydWU7XG4gICAgICAgIC8vdGhpcy5zcExldmVsc0VuLnZpc2libGUgPSB0cnVlO1xuICAgICAgICB0aGlzLnNwSWNvbkVuLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAvL3RoaXMuc3BIYXJkRW4udmlzaWJsZSA9IHRydWU7XG4gICAgICAgIC8vdGhpcy5idG5HaWZ0RW4udmlzaWJsZSA9IHRydWU7XG4gICAgICAgIC8vdGhpcy5idG5XaGVlbEVuLnZpc2libGUgPSB0cnVlO1xuICAgIH1cbiAgICB0aGlzLm5kR2lmdHMudmlzaWJsZSA9IHRydWU7XG5cbiAgICB0aGlzLnNwR2lmdEJnLnJ1bkFjdGlvbihjYy5yb3RhdGVCeSgzLCAzNjApLnJlcGVhdEZvcmV2ZXIoKSk7XG4gICAgdGhpcy51cGRhdGVTcGVpY2lhbE9mZmVyKCk7XG4gICAgdGhpcy51cGRhdGVTa2luUmVtaW5kZXIoKTtcbiAgICB0aGlzLm5kUmVtb3ZlQWRzLnZpc2libGUgPSBmYWxzZTtcblxuICAgIHRoaXMubGJTdGFyQ291bnQuc2V0U3RyaW5nKGdhbWUuZ2FtZU1hbi5nZXRUb3RhbFN0YXJDb3VudCgpKTtcblxuICAgIHRoaXMubmRDaGFsbGVuZ2VOb3JtYWwudmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMubmRDaGFsbGVuZ2VHcmF5LnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLnNwQ2hhbGxlbmdlUmVtaW5kZXIudmlzaWJsZSA9IGZhbHNlO1xuICAgIC8vIGlmIChnYW1lLmNoYWxsZW5nZU1hbi5pc0NoYWxsZW5nZVVubG9ja2VkKCkpIHtcbiAgICAvLyAgICAgdGhpcy5uZENoYWxsZW5nZU5vcm1hbC52aXNpYmxlID0gdHJ1ZTtcbiAgICAvLyAgICAgaWYgKCFnYW1lLnBsYXllck1hbi5wbGF5ZXIuY2hhbGxlbmdlRW50ZXJlZCAmJiBnYW1lLnBsYXllck1hbi5nZXRPckNyZWF0ZUNoYWxsZW5nZSgxKS5jaGFsbGVuZ2VMZXZlbCA9PT0gMSkge1xuICAgIC8vICAgICAgICAgdGhpcy5zcENoYWxsZW5nZVJlbWluZGVyLnZpc2libGUgPSB0cnVlO1xuICAgIC8vICAgICB9IGVsc2Uge1xuICAgIC8vICAgICAgICAgdGhpcy5zcENoYWxsZW5nZVJlbWluZGVyLnZpc2libGUgPSBmYWxzZTtcbiAgICAvLyAgICAgfVxuICAgIC8vIH0gZWxzZSB7XG4gICAgLy8gICAgIHRoaXMubmRDaGFsbGVuZ2VHcmF5LnZpc2libGUgPSB0cnVlO1xuICAgIC8vIH1cbiAgICB0aGlzLm5kQ2hhbGxlbmdlTm9ybWFsLnZpc2libGUgPSB0cnVlO1xuICAgIGlmICghZ2FtZS5wbGF5ZXJNYW4ucGxheWVyLmNoYWxsZW5nZUVudGVyZWQgJiYgZ2FtZS5wbGF5ZXJNYW4uZ2V0T3JDcmVhdGVDaGFsbGVuZ2UoMSkuY2hhbGxlbmdlTGV2ZWwgPT09IDEpIHtcbiAgICAgICAgdGhpcy5zcENoYWxsZW5nZVJlbWluZGVyLnZpc2libGUgPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNwQ2hhbGxlbmdlUmVtaW5kZXIudmlzaWJsZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIHRoaXMuc2hvd2VkRmx5R2lmdCA9IGZhbHNlO1xuICAgIHRoaXMubmRGbHlHaWZ0LnZpc2libGUgPSBmYWxzZTtcblxuICAgIHRoaXMuY2hlY2tBbmRTaG93Rmx5R2lmdCgpO1xuXG4gICAgdmFyIERhaWx5VGFza1BvcyA9IHJlcXVpcmUoXCIuLi9lbnVtL0RhaWx5VGFza1Bvc1wiKTtcbiAgICB0aGlzLm5kQWN0aXZpdHkuY29udHJvbGxlci5pbml0V2l0aChEYWlseVRhc2tQb3MuTWVudSk7XG5cbiAgICB0aGlzLmRvd25sb2FkU2VydmVyTGV2ZWxzKGZhbHNlKTtcbn07XG5cbk1lbnVDb250cm9sbGVyLnByb3RvdHlwZS51cGRhdGVTcGVpY2lhbE9mZmVyID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMubmRTcGVjaWFsT2ZmZXIudmlzaWJsZSA9ICFHYW1lTWFuLmdldEluc3RhbmNlKCkuaXNTcGVjaWFsT2ZmZXJQdXJjaGFzZWQoKTtcbn07XG5cbk1lbnVDb250cm9sbGVyLnByb3RvdHlwZS5vblVwZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnVwZGF0ZUdpZnRJdGVtKCk7XG4gICAgdGhpcy5jaGVja0FuZFNob3dGbHlHaWZ0KCk7XG59O1xuXG5NZW51Q29udHJvbGxlci5wcm90b3R5cGUudXBkYXRlR2lmdEl0ZW0gPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKGdhbWUuYWRzTWFuYWdlci5pc1Jld2FyZFZpZGVvUmVhZHkoKSkge1xuICAgICAgICB0aGlzLm5kR2lmdHMudmlzaWJsZSA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5uZEdpZnRzLnZpc2libGUgPSBmYWxzZTtcbiAgICB9XG59O1xuXG5NZW51Q29udHJvbGxlci5wcm90b3R5cGUudXBkYXRlU291bmRJdGVtID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBpc1NvdW5kT24gPSBnYW1lLmF1ZGlvUGxheWVyLmlzRWZmZWN0T24oKTtcbiAgICBpZiAoaXNTb3VuZE9uKSB7XG4gICAgICAgIHRoaXMuX3NvdW5kSXRlbS5zZXROb3JtYWxJbWFnZShuZXcgY2MuU3ByaXRlKFwiI2J0bl9zb3VuZF9vbi5wbmdcIikpO1xuICAgICAgICB0aGlzLl9zb3VuZEl0ZW0uc2V0U2VsZWN0ZWRJbWFnZShuZXcgY2MuU3ByaXRlKFwiI2J0bl9zb3VuZF9vbi5wbmdcIikpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX3NvdW5kSXRlbS5zZXROb3JtYWxJbWFnZShuZXcgY2MuU3ByaXRlKFwiI2J0bl9zb3VuZF9vZmYucG5nXCIpKTtcbiAgICAgICAgdGhpcy5fc291bmRJdGVtLnNldFNlbGVjdGVkSW1hZ2UobmV3IGNjLlNwcml0ZShcIiNidG5fc291bmRfb2ZmLnBuZ1wiKSk7XG4gICAgfVxufTtcblxuTWVudUNvbnRyb2xsZXIucHJvdG90eXBlLnN0b3JlQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB2YXIgU3RvcmVUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vU3RvcmVUeXBlXCIpO1xuICAgIGdhbWUucG9wdXBNYW4ucG9wdXBTdG9yZURsZyhTdG9yZVR5cGUuRElBTU9ORCk7XG59O1xuXG5NZW51Q29udHJvbGxlci5wcm90b3R5cGUuc2hhcmVDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGdhbWUuc2hhcmVNYW5hZ2VyLnNoYXJlV2l0aFN5c3RlbShnYW1lLnV0aWxzLnNwcmludGYoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcInNoYXJlX3RpcHNcIiksXG4gICAgICAgIGdhbWUucGxheWVyTWFuLmdldExldmVsKCksIGdhbWUuY29uZmlnLmdldFBsYXRmb3JtRG93bmxvYWRVcmwoKSksIGdhbWUuY29uZmlnLmdldFNoYXJlVXJsKCkpO1xufTtcblxuTWVudUNvbnRyb2xsZXIucHJvdG90eXBlLnJhbmtDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGdhbWUuZ2NNYW5hZ2VyLnNob3dMZWFkZXJib2FyZChnYW1lLmNvbmZpZy5nZXRMZWFkZXJCb2FyZEtleSgpKTtcbn07XG5cbk1lbnVDb250cm9sbGVyLnByb3RvdHlwZS5zdXBwb3J0Q2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBnYW1lLnNoYXJlTWFuYWdlci5zZW5kRW1haWwoZ2FtZS5jb25maWcuZ2V0RW1haWwoKSxcbiAgICAgICAgZ2FtZS5sb2NhbC5nZXRWYWx1ZShcImZlZWRfYmFja190aXRsZVwiKSwgZ2FtZS5sb2NhbC5nZXRWYWx1ZShcImZlZWRfYmFja19jb250ZW50XCIpKTtcbn07XG5cbk1lbnVDb250cm9sbGVyLnByb3RvdHlwZS5yYXRlQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBjYy5zeXMub3BlblVSTChnYW1lLmNvbmZpZy5nZXRQbGF0Zm9ybURvd25sb2FkVXJsKCkpO1xufTtcblxuTWVudUNvbnRyb2xsZXIucHJvdG90eXBlLnBsYXlDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGdhbWUuZ2FtZU1hbi5pc0NoYWxsZW5nZUxldmVsID0gZmFsc2U7XG4gICAgaWYgKEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5jaG9vc2VMYXRlc3RMZXZlbCgpKSB7XG4gICAgICAgIGlmICh0aGlzLnBsYXllZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucGxheWVkID0gdHJ1ZTtcbiAgICAgICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5HQU1FKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwQ29tbW9uRGxnKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJhbGxfY29tcGxldGVkXCIpKTtcbiAgICB9XG59O1xuXG5NZW51Q29udHJvbGxlci5wcm90b3R5cGUucGFja2FnZUNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgaWYgKHRoaXMucGxheWVkKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5wbGF5ZWQgPSB0cnVlO1xuICAgIGdhbWUuZ2FtZU1hbi5pc0NoYWxsZW5nZUxldmVsID0gZmFsc2U7XG4gICAgR2FtZU1hbi5nZXRJbnN0YW5jZSgpLnNldEhhcmRNb2RlKGZhbHNlKTtcbiAgICBHYW1lTWFuLmdldEluc3RhbmNlKCkuc2V0TmV3SGFyZE1vZGUoZmFsc2UpO1xuICAgIGdhbWUuc2NlbmVNYW4uc3dpdGNoU2NlbmUoZ2FtZS5zY2VuZVR5cGUuTEVWRUwpO1xufTtcblxuTWVudUNvbnRyb2xsZXIucHJvdG90eXBlLmNoYWxsZW5nZUNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5DSEFMTEVOR0VfTElTVCk7XG4gICAgcmV0dXJuO1xuICAgIC8qXG4gICAgaWYgKGdhbWUuY2hhbGxlbmdlTWFuLmlzQ2hhbGxlbmdlVW5sb2NrZWQoKSkge1xuICAgICAgICBnYW1lLmdhbWVNYW4uaXNDaGFsbGVuZ2VMZXZlbCA9IHRydWU7XG4gICAgICAgIGdhbWUuc2NlbmVNYW4uc3dpdGNoU2NlbmUoZ2FtZS5zY2VuZVR5cGUuQ0hBTExFTkdFX0xJU1QpO1xuICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRXZlbnQoXCJDaGFsbGVuZ2VFbnRlclwiLCB7XCJzb3VyY2VcIjogXCJtZW51XCJ9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwQ29tbW9uRGxnKGdhbWUudXRpbHMuc3ByaW50ZihfKFwiY2hhbGxlbmdlX3VubG9ja190aXBzXCIpLCBnYW1lLmNoYWxsZW5nZU1hbi5nZXRVbmxvY2tMZXZlbCgpKSk7XG4gICAgfSovXG59O1xuXG5NZW51Q29udHJvbGxlci5wcm90b3R5cGUuc291bmRDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGdhbWUuYXVkaW9QbGF5ZXIuc2V0RWZmZWN0T24oIWdhbWUuYXVkaW9QbGF5ZXIuaXNFZmZlY3RPbigpKTtcbiAgICBnYW1lLmF1ZGlvUGxheWVyLnNldE11c2ljT24oIWdhbWUuYXVkaW9QbGF5ZXIuaXNNdXNpY09uKCkpO1xuICAgIHRoaXMudXBkYXRlU291bmRJdGVtKCk7XG59O1xuXG5NZW51Q29udHJvbGxlci5wcm90b3R5cGUud2hlZWxDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIHZhciBXaGVlbFR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9XaGVlbFR5cGVcIik7XG4gICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFdoZWVsRGxnKFdoZWVsVHlwZS5EYWlseUJvbnVzKTtcbn07XG5cbk1lbnVDb250cm9sbGVyLnByb3RvdHlwZS5kYWlseUJvbnVzQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBnYW1lLnBvcHVwTWFuLnBvcHVwRGFpbHlCb251cygpO1xufTtcblxuTWVudUNvbnRyb2xsZXIucHJvdG90eXBlLmhhcmRDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGlmICh0aGlzLnBsYXllZCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMucGxheWVkID0gdHJ1ZTtcbiAgICBnYW1lLmdhbWVNYW4uaXNDaGFsbGVuZ2VMZXZlbCA9IGZhbHNlO1xuICAgIGdhbWUuc3RvcmFnZUNvbnRyb2xsZXIuc2V0SXRlbShcImhhcmRfcmVtaW5kZWRcIiwgXCJmYWxzZVwiKTtcbiAgICAvLyB0aGlzLnNwSGFyZEhpbnQudmlzaWJsZSA9IGZhbHNlO1xuICAgIEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5zZXRIYXJkTW9kZSh0cnVlKTtcbiAgICBHYW1lTWFuLmdldEluc3RhbmNlKCkuc2V0TmV3SGFyZE1vZGUoZmFsc2UpO1xuICAgIGdhbWUuc2NlbmVNYW4uc3dpdGNoU2NlbmUoZ2FtZS5zY2VuZVR5cGUuTEVWRUwpO1xufTtcblxuTWVudUNvbnRyb2xsZXIucHJvdG90eXBlLmhhcmRNb2RlQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBpZiAodGhpcy5wbGF5ZWQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnBsYXllZCA9IHRydWU7XG4gICAgZ2FtZS5nYW1lTWFuLmlzQ2hhbGxlbmdlTGV2ZWwgPSBmYWxzZTtcbiAgICBnYW1lLnN0b3JhZ2VDb250cm9sbGVyLnNldEl0ZW0oXCJoYXJkX3JlbWluZGVkXCIsIFwiZmFsc2VcIik7XG4gICAgR2FtZU1hbi5nZXRJbnN0YW5jZSgpLnNldEhhcmRNb2RlKGZhbHNlKTtcbiAgICBHYW1lTWFuLmdldEluc3RhbmNlKCkuc2V0TmV3SGFyZE1vZGUodHJ1ZSk7XG4gICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5MRVZFTCk7XG59O1xuXG5NZW51Q29udHJvbGxlci5wcm90b3R5cGUuZmV0Y2hMZXZlbENsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG5cbn07XG5cbk1lbnVDb250cm9sbGVyLnByb3RvdHlwZS5naWZ0Q2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBTdG9yZUhlbHBlci5nZXRJbnN0YW5jZSgpLmNoZWNrQW5kU2hvd1Jld2FyZFZpZGVvKGdhbWUudXRpbHMuaXNJT1MoKSA/IFwic2hvdXllXCIgOiBcImppbGkwNFwiKTtcbn07XG5cbk1lbnVDb250cm9sbGVyLnByb3RvdHlwZS50YXNrQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB0aGlzLmRvd25sb2FkU2VydmVyTGV2ZWxzKHRydWUpO1xufTtcblxuTWVudUNvbnRyb2xsZXIucHJvdG90eXBlLmRvd25sb2FkU2VydmVyTGV2ZWxzID0gZnVuY3Rpb24gKG5vdGlmeSkge1xuICAgIHZhciBIdHRwQ2xpZW50ID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi9uZXQvSHR0cENsaWVudFwiKTtcbiAgICB2YXIgZGljdCA9IHtcIkNvbnRlbnQtdHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIn07XG4gICAgSHR0cENsaWVudC5kb1Bvc3QoXCJodHRwOi8vc2VydmVyLm1pbmlnYW1lLmlvOjcwMDAvdG9vbHMvZmV0Y2hfbGV2ZWxzXCIsIFwiXCIsIGRpY3QsIGZ1bmN0aW9uIChlcnJvciwgdGV4dCkge1xuICAgICAgICBpZiAoIWVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInJlc3VsdHM6XCIgKyB0ZXh0KTtcbiAgICAgICAgICAgIHZhciBqc29uID0gSlNPTi5wYXJzZSh0ZXh0KTtcbiAgICAgICAgICAgIGlmIChqc29uLmVycm5vID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIGxldmVscyA9IGpzb24uZGF0YTtcbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0cyA9IFtdO1xuICAgICAgICAgICAgICAgIHZhciBMZXZlbENvbmZpZyA9IHJlcXVpcmUoXCIuLi9jb25maWcvTGV2ZWxDb25maWdcIik7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZXZlbHMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxldmVsID0gbGV2ZWxzW2ldO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gSlNPTi5wYXJzZShsZXZlbC5jb250ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxldmVsQ29uZmlnID0gbmV3IExldmVsQ29uZmlnKCk7XG4gICAgICAgICAgICAgICAgICAgIGxldmVsQ29uZmlnLnVubWFyc2hhbChyZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2gobGV2ZWxDb25maWcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgQ29uZmlnTWFuID0gcmVxdWlyZShcIi4uL2NvbmZpZy9Db25maWdNYW5cIik7XG4gICAgICAgICAgICAgICAgQ29uZmlnTWFuLmdldEluc3RhbmNlKCkuYWRkSGFyZExldmVsTGlzdChyZXN1bHRzKTtcbiAgICAgICAgICAgICAgICBpZiAobm90aWZ5KSB7XG4gICAgICAgICAgICAgICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBDb21tb25EbGcoXCJEb3dubG9hZCBTdWNjZXNzXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKG5vdGlmeSkge1xuICAgICAgICAgICAgICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwQ29tbW9uRGxnKFwiRG93bmxvYWQgRmFpbDpcIiArIGpzb24uZXJybXNnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAobm90aWZ5KSB7XG4gICAgICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cENvbW1vbkRsZyhcIkRvd25sb2FkIEZhaWw6XCIgKyB0ZXh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufTtcblxuTWVudUNvbnRyb2xsZXIucHJvdG90eXBlLnVwZGF0ZVRhc2tSZW1pbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgY2xpY2tTa2luID0gZ2FtZS5zdG9yYWdlQ29udHJvbGxlci5nZXRJdGVtKFwiY2xpY2tfdGFza1wiLCBcImZhbHNlXCIpO1xuICAgIGlmIChjbGlja1NraW4gPT0gXCJmYWxzZVwiKSB7XG4gICAgICAgIHRoaXMuc3BUYXNrUmVtaW5kZXIudmlzaWJsZSA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5oYXNDb21wbGV0ZWRUYXNrKCkpIHtcbiAgICAgICAgICAgIHRoaXMuc3BUYXNrUmVtaW5kZXIudmlzaWJsZSA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNwVGFza1JlbWluZGVyLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbn07XG5cbk1lbnVDb250cm9sbGVyLnByb3RvdHlwZS51cGRhdGVTa2luUmVtaW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGNsaWNrU2tpbiA9IGdhbWUuc3RvcmFnZUNvbnRyb2xsZXIuZ2V0SXRlbShcImNsaWNrX3NraW5fbmV3XCIsIFwiZmFsc2VcIik7XG4gICAgaWYgKGNsaWNrU2tpbiA9PSBcImZhbHNlXCIpIHtcbiAgICAgICAgdGhpcy5zcFNraW5SZW1pbmRlci52aXNpYmxlID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNwU2tpblJlbWluZGVyLnZpc2libGUgPSBmYWxzZTtcbiAgICB9XG59O1xuXG5NZW51Q29udHJvbGxlci5wcm90b3R5cGUuc3BlY2lhbE9mZmVyQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBnYW1lLnBvcHVwTWFuLnBvcHVwU3BlaWNpYWxPZmZlcigpO1xufTtcblxuTWVudUNvbnRyb2xsZXIucHJvdG90eXBlLnNraW5DbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcIkNsaWNrU2tpbnNcIik7XG4gICAgdmFyIFN0b3JlVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1N0b3JlVHlwZVwiKTtcbiAgICBnYW1lLnBvcHVwTWFuLnBvcHVwU3RvcmVEbGcoU3RvcmVUeXBlLlNLSU4pO1xuICAgIGdhbWUuc3RvcmFnZUNvbnRyb2xsZXIuc2V0SXRlbShcImNsaWNrX3NraW5fbmV3XCIsIFwidHJ1ZVwiKTtcbiAgICB0aGlzLnVwZGF0ZVNraW5SZW1pbmRlcigpO1xufTtcblxuTWVudUNvbnRyb2xsZXIucHJvdG90eXBlLnNldHRpbmdDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGdhbWUucG9wdXBNYW4ucG9wdXBTZXR0aW5nRGxnKCk7XG59O1xuXG5NZW51Q29udHJvbGxlci5wcm90b3R5cGUucmVtb3ZlQWRzQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB2YXIgU3RvcmVUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vU3RvcmVUeXBlXCIpO1xuICAgIHZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcbiAgICB2YXIgcmVtb3ZlQWRFbnRpdHkgPSBTdG9yZUhlbHBlci5nZXRJbnN0YW5jZSgpLmdldFN0b3JlRW50aXR5QnlUeXBlKFN0b3JlVHlwZS5SRU1PVkVfQURTKTtcbiAgICBTdG9yZUhlbHBlci5nZXRJbnN0YW5jZSgpLmJ1eVByb2R1Y3QocmVtb3ZlQWRFbnRpdHkpO1xufTtcblxuTWVudUNvbnRyb2xsZXIucHJvdG90eXBlLmZseUdpZnRDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGlmICghZ2FtZS5hZHNNYW5hZ2VyLmlzUmV3YXJkVmlkZW9SZWFkeSgpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5uZEZseUdpZnQuc3RvcEFsbEFjdGlvbnMoKTtcbiAgICB0aGlzLm5kRmx5R2lmdC52aXNpYmxlID0gZmFsc2U7XG4gICAgdmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xuICAgIFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuY2hlY2tBbmRHZXRSYW5kb21EaWFtb25kcyhcIm1lbnVfZmx5X2dpZnRcIik7XG59O1xuXG5NZW51Q29udHJvbGxlci5wcm90b3R5cGUuY2hlY2tBbmRTaG93Rmx5R2lmdCA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAodGhpcy5zaG93ZWRGbHlHaWZ0KSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgcmV0dXJuO1xuICAgIGlmIChnYW1lLmdhbWVNYW4uZ2V0UGxheWVyTGV2ZWwoKSA8PSBnYW1lLmFkc01hbmFnZXIuZmx5R2lmdE9wZW5MZXZlbCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICghZ2FtZS5hZHNNYW5hZ2VyLmlzUmV3YXJkVmlkZW9SZWFkeSgpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5zaG93ZWRGbHlHaWZ0ID0gdHJ1ZTtcbiAgICB0aGlzLm5kRmx5R2lmdC52aXNpYmxlID0gdHJ1ZTtcblxuICAgIHRoaXMubmRGbHlHaWZ0LnggPSAtMTAgLSB0aGlzLkZMWV9HSUZUX01JTl9YO1xuICAgIHRoaXMubmRGbHlHaWZ0LnkgPSBnYW1lLnV0aWxzLnJhbmRvbU5leHRJbnRJblJhbmdlKGNjLndpblNpemUuaGVpZ2h0ICogMC4zLCBjYy53aW5TaXplLmhlaWdodCAqIDAuOSk7XG4gICAgdGhpcy5zdGFydEZseUdpZnQoKTtcbn07XG5cbk1lbnVDb250cm9sbGVyLnByb3RvdHlwZS5zdGFydEZseUdpZnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHJhbmRvbVkxID0gZ2FtZS51dGlscy5yYW5kb21OZXh0SW50SW5SYW5nZShjYy53aW5TaXplLmhlaWdodCAqIDAuMywgY2Mud2luU2l6ZS5oZWlnaHQgKiAwLjkpO1xuICAgIHZhciByYW5kb21ZMiA9IGdhbWUudXRpbHMucmFuZG9tTmV4dEludEluUmFuZ2UoY2Mud2luU2l6ZS5oZWlnaHQgKiAwLjMsIGNjLndpblNpemUuaGVpZ2h0ICogMC45KTtcbiAgICB0aGlzLm5kRmx5R2lmdC5zdG9wQWxsQWN0aW9ucygpO1xuICAgIHRoaXMubmRGbHlHaWZ0LnJ1bkFjdGlvbihcbiAgICAgICAgY2Muc2VxdWVuY2UoXG4gICAgICAgICAgICBjYy5zaG93KCksXG4gICAgICAgICAgICBjYy5tb3ZlVG8oMTAsIGNjLnAoY2Mud2luU2l6ZS53aWR0aCAtIHRoaXMuRkxZX0dJRlRfTUlOX1ggKyAxMCwgcmFuZG9tWTEpKSxcbiAgICAgICAgICAgIGNjLm1vdmVUbygxMCwgY2MucCgtdGhpcy5GTFlfR0lGVF9NSU5fWCAqIDAuNSAtIDIwLCByYW5kb21ZMikpLFxuICAgICAgICAgICAgY2MuaGlkZSgpLFxuICAgICAgICAgICAgY2MuZGVsYXlUaW1lKDEyKSxcbiAgICAgICAgICAgIGNjLmNhbGxGdW5jKHRoaXMuc3RhcnRGbHlHaWZ0LCB0aGlzKVxuICAgICAgICApKTtcbn07XG5cbk1lbnVDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL21lbnUvbWVudV92aWV3LmNjYmlcIiwgbnVsbCwgXCJNZW51Q29udHJvbGxlclwiLCBuZXcgTWVudUNvbnRyb2xsZXIoKSk7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5NZW51Q29udHJvbGxlci50aW1lID0gMDtcblxubW9kdWxlLmV4cG9ydHMgPSBNZW51Q29udHJvbGxlcjsiLCJcblxudmFyIE5vdGljZUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcbiAgICB0aGlzLl9va0l0ZW0gPSBudWxsO1xuICAgIHRoaXMuX2NhbmNlbEl0ZW0gPSBudWxsO1xuICAgIHRoaXMuX2NvbmZpcm1JdGVtID0gbnVsbDtcbiAgICB0aGlzLl9jbG9zZUl0ZW0gPSBudWxsO1xuICAgIHRoaXMuX2luZm9MYWJlbCA9IG51bGw7XG5cbiAgICB0aGlzLl9va0xhYmVsID0gbnVsbDtcbiAgICB0aGlzLl9jYW5jZWxMYWJlbCA9IG51bGw7XG4gICAgdGhpcy5fY29uZmlybUxhYmVsID0gbnVsbDtcblxuICAgIHRoaXMubmRSZXdhcmQxID0gbnVsbDtcbiAgICB0aGlzLm5kUmV3YXJkMiA9IG51bGw7XG5cbiAgICB0aGlzLnNwUmV3YXJkMSA9IG51bGw7XG4gICAgdGhpcy5sYlJld2FyZDEgPSBudWxsO1xuICAgIHRoaXMuc3BSZXdhcmQyID0gbnVsbDtcbiAgICB0aGlzLmxiUmV3YXJkMiA9IG51bGw7XG4gICAgdGhpcy5sYlJld2FyZDJJbmZvID0gbnVsbDtcblxuICAgIHRoaXMuc3BSZXdhcmQgPSBudWxsO1xuICAgIHRoaXMubGJSZXdhcmQgPSBudWxsO1xuICAgIHRoaXMubGJSZXdhcmRJbmZvID0gbnVsbDtcblxuICAgIHRoaXMuc3ByQWQgPSBudWxsO1xuXG4gICAgdGhpcy5fb2tDYWxsRnVuYyA9IG51bGw7XG4gICAgdGhpcy5fZmFpbENhbGxGdW5jID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoTm90aWNlQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5Ob3RpY2VDb250cm9sbGVyLnByb3RvdHlwZS5vbkVudGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkVudGVyLmNhbGwodGhpcyk7XG4gICAgLy9nYW1lLmFkc01hbmFnZXIuc2hvd05hdGl2ZUFkKFwibm90aWNlXCIsIDAsIDApO1xufTtcblxuTm90aWNlQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0ID0gZnVuY3Rpb24gKCkge1xuICAgIC8vZ2FtZS5hZHNNYW5hZ2VyLnJlbW92ZU5hdGl2ZUFkKFwibm90aWNlXCIpO1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQuY2FsbCh0aGlzKTtcbn07XG5cbk5vdGljZUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcbiAgICB0aGlzLl90aXRsZUxhYmVsLnNldFN0cmluZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwibm90aWNlX3RpdGxlXCIpKTtcbiAgICB0aGlzLm5kUmV3YXJkMS52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5uZFJld2FyZDIudmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMuX2luZm9MYWJlbC52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5zcHJBZC52aXNpYmxlID0gZmFsc2U7XG59O1xuXG5Ob3RpY2VDb250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aFllcyA9IGZ1bmN0aW9uIChpbmZvLCBva0NhbGxGdW5jKSB7XG4gICAgdGhpcy5faW5mb0xhYmVsLnZpc2libGUgPSB0cnVlO1xuICAgIHRoaXMuX2luZm9MYWJlbC5zZXRTdHJpbmcoaW5mbyk7XG4gICAgdGhpcy5faW5mb0xhYmVsLnNldEFsaWdubWVudChjYy5URVhUX0FMSUdOTUVOVF9DRU5URVIpO1xuICAgIHRoaXMuX29rQ2FsbEZ1bmMgPSBva0NhbGxGdW5jO1xuICAgIHRoaXMuX2NvbmZpcm1JdGVtLnZpc2libGUgPSB0cnVlO1xuICAgIHRoaXMuX29rSXRlbS52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5fY2FuY2VsSXRlbS52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5fb2tMYWJlbC52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5fY2FuY2VsTGFiZWwudmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMuX2Nsb3NlSXRlbS52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5fY29uZmlybUxhYmVsLnZpc2libGUgPSB0cnVlO1xuICAgIHRoaXMuX2NvbmZpcm1MYWJlbC5zZXRTdHJpbmcoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcImNvbmZpcm1faW5mb1wiKSk7XG4gICAgdGhpcy5fY29uZmlybUxhYmVsLnNldEFsaWdubWVudChjYy5URVhUX0FMSUdOTUVOVF9DRU5URVIpO1xufTtcblxuTm90aWNlQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdFdpdGhZZXNObyA9IGZ1bmN0aW9uIChpbmZvLCB5ZXNJbmZvLCBjYW5jZWxJbmZvLCBva0NhbGxGdW5jLCBmYWlsQ2FsbEZ1bmMsIHNob3dDbG9zZSwgaXNTaG93QWRzKSB7XG4gICAgdGhpcy5faW5mb0xhYmVsLnZpc2libGUgPSB0cnVlO1xuICAgIHRoaXMuX2luZm9MYWJlbC5zZXRTdHJpbmcoaW5mbyk7XG4gICAgdGhpcy5faW5mb0xhYmVsLnNldEFsaWdubWVudChjYy5URVhUX0FMSUdOTUVOVF9DRU5URVIpO1xuICAgIHRoaXMuX29rQ2FsbEZ1bmMgPSBva0NhbGxGdW5jO1xuICAgIHRoaXMuX2ZhaWxDYWxsRnVuYyA9IGZhaWxDYWxsRnVuYztcbiAgICBpZiAodGhpcy5fY29uZmlybUl0ZW0pIHtcbiAgICAgICAgdGhpcy5fY29uZmlybUl0ZW0udmlzaWJsZSA9IGZhbHNlO1xuICAgIH1cbiAgICB0aGlzLl9va0l0ZW0udmlzaWJsZSA9IHRydWU7XG4gICAgdGhpcy5fY2FuY2VsSXRlbS52aXNpYmxlID0gdHJ1ZTtcbiAgICB0aGlzLl9va0xhYmVsLnZpc2libGUgPSB0cnVlO1xuICAgIHRoaXMuX2NhbmNlbExhYmVsLnZpc2libGUgPSB0cnVlO1xuICAgIGlmICh0aGlzLl9jb25maXJtTGFiZWwpIHtcbiAgICAgICAgdGhpcy5fY29uZmlybUxhYmVsLnZpc2libGUgPSBmYWxzZTtcbiAgICB9XG4gICAgdGhpcy5fb2tMYWJlbC5zZXRTdHJpbmcoeWVzSW5mbyk7XG4gICAgdGhpcy5fY2FuY2VsTGFiZWwuc2V0U3RyaW5nKGNhbmNlbEluZm8pO1xuICAgIHRoaXMuX29rTGFiZWwuc2V0QWxpZ25tZW50KGNjLlRFWFRfQUxJR05NRU5UX0NFTlRFUik7XG4gICAgdGhpcy5fY2FuY2VsTGFiZWwuc2V0QWxpZ25tZW50KGNjLlRFWFRfQUxJR05NRU5UX0NFTlRFUik7XG4gICAgdGhpcy5fY2xvc2VJdGVtLnZpc2libGUgPSBzaG93Q2xvc2U7XG4gICAgdGhpcy5zcHJBZC52aXNpYmxlID0gISFpc1Nob3dBZHM7XG4gICAgaWYgKGlzU2hvd0Fkcykge1xuICAgICAgICB0aGlzLnJvb3ROb2RlLnNjaGVkdWxlT25jZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBnYW1lLnV0aWxzLnBsYXlDQ0JBbmltYXRpb24odGhpcy5yb290Tm9kZSwgXCJsb29wXCIpO1xuICAgICAgICB9LmJpbmQodGhpcyksIDEpO1xuICAgIH1cbn07XG5cbk5vdGljZUNvbnRyb2xsZXIucHJvdG90eXBlLmluaXRXaXRoUmV3YXJkWWVzID0gZnVuY3Rpb24gKGluZm8sIG9rQ2FsbEZ1bmMsIHJld2FyZDFTcHJpdGUsIHJld2FyZDFDb3VudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJld2FyZDJTcHJpdGUsIHJld2FyZDJDb3VudCkge1xuICAgIHRoaXMuX2luZm9MYWJlbC52aXNpYmxlID0gZmFsc2U7XG4gICAgdmFyIHNwcml0ZUZyYW1lO1xuICAgIGlmIChyZXdhcmQxU3ByaXRlICYmIHJld2FyZDJTcHJpdGUpIHtcbiAgICAgICAgdGhpcy5uZFJld2FyZDIudmlzaWJsZSA9IHRydWU7XG4gICAgICAgIHRoaXMubGJSZXdhcmQySW5mby5zZXRTdHJpbmcoaW5mbyk7XG4gICAgICAgIHRoaXMubGJSZXdhcmQySW5mby5zZXRBbGlnbm1lbnQoY2MuVEVYVF9BTElHTk1FTlRfQ0VOVEVSKTtcbiAgICAgICAgc3ByaXRlRnJhbWUgPSBjYy5zcHJpdGVGcmFtZUNhY2hlLmdldFNwcml0ZUZyYW1lKHJld2FyZDFTcHJpdGUpO1xuICAgICAgICBpZiAoc3ByaXRlRnJhbWUpIHtcbiAgICAgICAgICAgIHRoaXMuc3BSZXdhcmQxLnNldFNwcml0ZUZyYW1lKHNwcml0ZUZyYW1lKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxiUmV3YXJkMS5zZXRTdHJpbmcoXCJ4XCIgKyByZXdhcmQxQ291bnQpO1xuICAgICAgICBzcHJpdGVGcmFtZSA9IGNjLnNwcml0ZUZyYW1lQ2FjaGUuZ2V0U3ByaXRlRnJhbWUocmV3YXJkMlNwcml0ZSk7XG4gICAgICAgIGlmIChzcHJpdGVGcmFtZSkge1xuICAgICAgICAgICAgdGhpcy5zcFJld2FyZDIuc2V0U3ByaXRlRnJhbWUoc3ByaXRlRnJhbWUpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubGJSZXdhcmQyLnNldFN0cmluZyhcInhcIiArIHJld2FyZDJDb3VudCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5uZFJld2FyZDEudmlzaWJsZSA9IHRydWU7XG4gICAgICAgIHRoaXMubGJSZXdhcmRJbmZvLnNldFN0cmluZyhpbmZvKTtcbiAgICAgICAgdGhpcy5sYlJld2FyZEluZm8uc2V0QWxpZ25tZW50KGNjLlRFWFRfQUxJR05NRU5UX0NFTlRFUik7XG4gICAgICAgIHNwcml0ZUZyYW1lID0gY2Muc3ByaXRlRnJhbWVDYWNoZS5nZXRTcHJpdGVGcmFtZShyZXdhcmQxU3ByaXRlKTtcbiAgICAgICAgaWYgKHNwcml0ZUZyYW1lKSB7XG4gICAgICAgICAgICB0aGlzLnNwUmV3YXJkLnNldFNwcml0ZUZyYW1lKHNwcml0ZUZyYW1lKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxiUmV3YXJkLnNldFN0cmluZyhcInhcIiArIHJld2FyZDFDb3VudCk7XG4gICAgfVxuXG4gICAgdGhpcy5fb2tDYWxsRnVuYyA9IG9rQ2FsbEZ1bmM7XG4gICAgdGhpcy5fY29uZmlybUl0ZW0udmlzaWJsZSA9IHRydWU7XG4gICAgdGhpcy5fb2tJdGVtLnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLl9jYW5jZWxJdGVtLnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLl9va0xhYmVsLnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLl9jYW5jZWxMYWJlbC52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5fY2xvc2VJdGVtLnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLl9jb25maXJtTGFiZWwudmlzaWJsZSA9IHRydWU7XG4gICAgdGhpcy5fY29uZmlybUxhYmVsLnNldFN0cmluZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwiY29uZmlybV9pbmZvXCIpKTtcbiAgICB0aGlzLl9jb25maXJtTGFiZWwuc2V0QWxpZ25tZW50KGNjLlRFWFRfQUxJR05NRU5UX0NFTlRFUik7XG59O1xuXG5Ob3RpY2VDb250cm9sbGVyLnByb3RvdHlwZS5va0NsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgaWYgKHRoaXMuX29rQ2FsbEZ1bmMpIHtcbiAgICAgICAgdGhpcy5fb2tDYWxsRnVuYygpO1xuICAgIH1cbiAgICB0aGlzLmNsb3NlKCk7XG59O1xuXG5Ob3RpY2VDb250cm9sbGVyLnByb3RvdHlwZS5jYW5jZWxDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGlmICh0aGlzLl9mYWlsQ2FsbEZ1bmMpIHtcbiAgICAgICAgdGhpcy5fZmFpbENhbGxGdW5jKCk7XG4gICAgfVxuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cbk5vdGljZUNvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB0aGlzLmNsb3NlKCk7XG59O1xuXG5Ob3RpY2VDb250cm9sbGVyLnByb3RvdHlwZS5jb25maXJtQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBpZiAodGhpcy5fb2tDYWxsRnVuYykge1xuICAgICAgICB0aGlzLl9va0NhbGxGdW5jKCk7XG4gICAgfVxuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cbk5vdGljZUNvbnRyb2xsZXIucHJvdG90eXBlLnBvcHVwID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5wb3B1cCh0aGlzLnJvb3ROb2RlLCB7cG9wdXBBbmltOiB0cnVlfSk7XG59O1xuXG5Ob3RpY2VDb250cm9sbGVyLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIuY2xvc2UodGhpcy5yb290Tm9kZSk7XG59O1xuXG5cbk5vdGljZUNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBub2RlID0gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvbm90aWNlL25vdGljZV92aWV3LmNjYmlcIiwgbnVsbCwgXCJOb3RpY2VDb250cm9sbGVyXCIsIG5ldyBOb3RpY2VDb250cm9sbGVyKCkpO1xuICAgIHJldHVybiBub2RlO1xufTtcblxuTm90aWNlQ29udHJvbGxlci5jcmVhdGVHdWlkZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL25vdGljZS9uZXdfdGlwX3ZpZXcuY2NiaVwiLCBudWxsLCBcIk5vdGljZUNvbnRyb2xsZXJcIiwgbmV3IE5vdGljZUNvbnRyb2xsZXIoKSk7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IE5vdGljZUNvbnRyb2xsZXI7IiwidmFyIEdhbWVTY2VuZSA9IHJlcXVpcmUoXCIuLi9zY2VuZS9HYW1lU2NlbmVcIik7XG52YXIgU3RvcmVIZWxwZXIgPSByZXF1aXJlKFwiLi4vbW9kZWwvU3RvcmVIZWxwZXJcIik7XG52YXIgTXVsdGlDb2xUYWJsZVZpZXcgPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uL2V4dC9NdWx0aUNvbFRhYmxlVmlld1wiKTtcbnZhciBQYWNrYWdlSXRlbUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi9QYWNrYWdlSXRlbUNvbnRyb2xsZXJcIik7XG52YXIgTGV2ZWxDb25maWdNYW4gPSByZXF1aXJlKFwiLi4vY29uZmlnL0NvbmZpZ01hblwiKTtcbnZhciBMb2NrU3RhdHVzID0gcmVxdWlyZShcIi4uL2VudW0vTG9ja1N0YXR1c1wiKTtcbnZhciBHYW1lTWFuID0gcmVxdWlyZShcIi4uL21vZGVsL0dhbWVNYW5cIik7XG52YXIgTGV2ZWxTY2VuZSA9IHJlcXVpcmUoXCIuLi9zY2VuZS9MZXZlbFNjZW5lXCIpO1xudmFyIFRpdGxlQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuL1RpdGxlQ29udHJvbGxlclwiKTtcblxuLy92YXIgQ0VMTF9XSURUSCA9IDUyMDtcblxudmFyIFBhY2thZ2VJdGVtQ2VsbFZpZXcgPSBjYy5UYWJsZVZpZXdDZWxsLmV4dGVuZCh7XG4gICAgcGFja2FnZUVudGl0eTogbnVsbCxcbiAgICBwYWNrYWdlSXRlbU5vZGU6IG51bGwsXG5cbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICAgIHRoaXMucGFja2FnZUl0ZW1Ob2RlID0gUGFja2FnZUl0ZW1Db250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgdGhpcy5hZGRDaGlsZCh0aGlzLnBhY2thZ2VJdGVtTm9kZSk7XG4gICAgICAgIHZhciBzaXplID0gdGhpcy5wYWNrYWdlSXRlbU5vZGUuY29udHJvbGxlci5nZXRDb250ZW50U2l6ZSgpO1xuICAgICAgICB0aGlzLnBhY2thZ2VJdGVtTm9kZS5zZXRQb3NpdGlvbihjYy5wKGNjLndpblNpemUud2lkdGggKiAwLjUsIHNpemUuaGVpZ2h0ICogMC41KSk7XG4gICAgfSxcblxuICAgIGluaXRXaXRoOiBmdW5jdGlvbiAocGFja2FnZUVudGl0eSwgaWR4KSB7XG4gICAgICAgIGNjLmxvZyhcIlBhY2thZ2VJdGVtQ2VsbFZpZXcgaW5pdFdpdGg6aWR4OlwiICsgaWR4KTtcbiAgICAgICAgdGhpcy5wYWNrYWdlRW50aXR5ID0gcGFja2FnZUVudGl0eTtcbiAgICAgICAgdGhpcy5wYWNrYWdlSXRlbU5vZGUuY29udHJvbGxlci5pbml0V2l0aChwYWNrYWdlRW50aXR5LCBpZHgpO1xuICAgIH0sXG5cbiAgICByZWZyZXNoOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucGFja2FnZUl0ZW1Ob2RlLmNvbnRyb2xsZXIucmVmcmVzaCgpO1xuICAgIH0sXG5cbiAgICBzaG93QXBwZWFyQW5pbTogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnBhY2thZ2VJdGVtTm9kZS5jb250cm9sbGVyLnNob3dBcHBlYXJBbmltKGZhbHNlKTtcbiAgICB9LFxuXG4gICAgc2hvd0Rpc2FwcGVhckFuaW06IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5wYWNrYWdlSXRlbU5vZGUuY29udHJvbGxlci5zaG93RGlzYXBwZWFyQW5pbSgpO1xuICAgIH1cbn0pO1xuXG52YXIgUGFja2FnZUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcbiAgICB0aGlzLmxiQ2hhcHRlck5hbWUgPSBudWxsO1xuICAgIHRoaXMubmRDb250YWluZXIgPSBudWxsO1xuICAgIHRoaXMubGJMZXZlbE5hbWUgPSBudWxsO1xuICAgIHRoaXMuX3RhYmxlVmlldyA9IG51bGw7XG5cbiAgICAvL3VzZXIgZGF0YS5cbiAgICB0aGlzLnBhY2thZ2VDb25maWdzID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoUGFja2FnZUNvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuUGFja2FnZUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcblxuICAgIHRoaXMucGFja2FnZUNvbmZpZ3MgPSBMZXZlbENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldFBhY2thZ2VMaXN0KCk7XG5cbiAgICB0aGlzLnNob3dMZXZlbFRhYmxlVmlldygpO1xuXG4gICAgdmFyIHBhY2thZ2VJZCA9IDE7XG4gICAgdmFyIHBhY2thZ2VJbmZvID0gR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmdldE1pblVuQ29tcGxldGVkUGFja2FnZSgpO1xuICAgIGlmICghcGFja2FnZUluZm8gfHwgKHBhY2thZ2VJbmZvLmlkID4gdGhpcy5wYWNrYWdlQ29uZmlncy5sZW5ndGgpKSB7XG4gICAgICAgIHBhY2thZ2VJZCA9IDE7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcGFja2FnZUlkID0gcGFja2FnZUluZm8uaWQ7XG4gICAgfVxuICAgIGNjLmxvZyhcInBhY2thZ2VJZDpcIiArIHBhY2thZ2VJZCk7XG4gICAgdmFyIGN1clJvdyA9IDA7XG4gICAgaWYgKHBhY2thZ2VJZCAlIHRoaXMubnVtYmVyT2ZHcmlkc0luQ2VsbCgpID09PSAwKSB7XG4gICAgICAgIGN1clJvdyA9IE1hdGguZmxvb3IocGFja2FnZUlkIC8gdGhpcy5udW1iZXJPZkdyaWRzSW5DZWxsKCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGN1clJvdyA9IE1hdGguZmxvb3IocGFja2FnZUlkIC8gdGhpcy5udW1iZXJPZkdyaWRzSW5DZWxsKCkpICsgMTtcbiAgICB9XG5cbiAgICB2YXIgeU9mZnNldCA9IC0odGhpcy5udW1iZXJPZkNlbGxzSW5UYWJsZVZpZXcoKSAtIGN1clJvdyArIDEpICogdGhpcy5ncmlkU2l6ZUZvclRhYmxlKCkuaGVpZ2h0ICtcbiAgICAgICAgdGhpcy5fdGFibGVWaWV3LmdldFZpZXdTaXplKCkuaGVpZ2h0O1xuXG4gICAgaWYgKHlPZmZzZXQgPCB0aGlzLl90YWJsZVZpZXcubWluQ29udGFpbmVyT2Zmc2V0KCkueSkge1xuICAgICAgICB5T2Zmc2V0ID0gdGhpcy5fdGFibGVWaWV3Lm1pbkNvbnRhaW5lck9mZnNldCgpLnk7XG4gICAgfSBlbHNlIGlmICh5T2Zmc2V0ID49IHRoaXMuX3RhYmxlVmlldy5tYXhDb250YWluZXJPZmZzZXQoKS55KSB7XG4gICAgICAgIHlPZmZzZXQgPSB0aGlzLl90YWJsZVZpZXcubWF4Q29udGFpbmVyT2Zmc2V0KCkueTtcbiAgICB9XG5cbiAgICB0aGlzLl90YWJsZVZpZXcuc2V0Q29udGVudE9mZnNldChjYy5wKDAsIHlPZmZzZXQpKTtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5udW1iZXJPZkNlbGxzSW5UYWJsZVZpZXcoKTsgKytpKSB7XG4gICAgICAgIHZhciBjZWxsID0gdGhpcy5fdGFibGVWaWV3LmdldEdyaWRBdEluZGV4KGkpO1xuICAgICAgICBpZiAoY2VsbCkge1xuICAgICAgICAgICAgY2VsbC5zaG93QXBwZWFyQW5pbSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5sYkxldmVsTmFtZS5zZXRTdHJpbmcoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcInBhY2thZ2VfdGl0bGVcIikpO1xufTtcblxuUGFja2FnZUNvbnRyb2xsZXIucHJvdG90eXBlLnNob3dMZXZlbFRhYmxlVmlldyA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLl90YWJsZVZpZXcgPSBuZXcgTXVsdGlDb2xUYWJsZVZpZXcodGhpcywgdGhpcy5uZENvbnRhaW5lci5nZXRDb250ZW50U2l6ZSgpLCBudWxsKTtcbiAgICB0aGlzLl90YWJsZVZpZXcuc2V0RGlyZWN0aW9uKGNjLlNDUk9MTFZJRVdfRElSRUNUSU9OX1ZFUlRJQ0FMKTtcbiAgICB0aGlzLl90YWJsZVZpZXcuc2V0VmVydGljYWxGaWxsT3JkZXIoY2MuVEFCTEVWSUVXX0ZJTExfVE9QRE9XTik7XG4gICAgdGhpcy5fdGFibGVWaWV3LnNldE11bHRpVGFibGVWaWV3RGVsZWdhdGUodGhpcyk7XG4gICAgdGhpcy5fdGFibGVWaWV3Lmlnbm9yZUFuY2hvclBvaW50Rm9yUG9zaXRpb24oZmFsc2UpO1xuICAgIHRoaXMuX3RhYmxlVmlldy5zZXRBbmNob3JQb2ludChjYy5wKDAsIDApKTtcbiAgICB0aGlzLm5kQ29udGFpbmVyLmFkZENoaWxkKHRoaXMuX3RhYmxlVmlldyk7XG4gICAgdGhpcy5fdGFibGVWaWV3LnJlbG9hZERhdGEoKTtcbn07XG5cblBhY2thZ2VDb250cm9sbGVyLnByb3RvdHlwZS5zY3JvbGxWaWV3RGlkU2Nyb2xsID0gZnVuY3Rpb24gKHZpZXcpIHtcbn07XG5cblBhY2thZ2VDb250cm9sbGVyLnByb3RvdHlwZS5zY3JvbGxWaWV3RGlkWm9vbSA9IGZ1bmN0aW9uICh2aWV3KSB7XG59O1xuXG5QYWNrYWdlQ29udHJvbGxlci5wcm90b3R5cGUuZ3JpZEF0SW5kZXggPSBmdW5jdGlvbihtdWx0aVRhYmxlLCAgaWR4KSB7XG4gICAgdmFyIGNlbGwgPSBtdWx0aVRhYmxlLmRlcXVldWVHcmlkKCk7XG4gICAgaWYgKCFjZWxsKSB7XG4gICAgICAgIGNlbGwgPSBuZXcgUGFja2FnZUl0ZW1DZWxsVmlldygpO1xuICAgIH1cblxuICAgIGlmIChpZHggPCB0aGlzLnBhY2thZ2VDb25maWdzLmxlbmd0aCkge1xuICAgICAgICB2YXIgcGFja2FnZUNvbmZpZyA9IHRoaXMucGFja2FnZUNvbmZpZ3NbaWR4XTtcbiAgICAgICAgY2VsbC5pbml0V2l0aChwYWNrYWdlQ29uZmlnLCBpZHgsIHRoaXMuaW5pdGVkKTtcbiAgICAgICAgY2VsbC52aXNpYmxlID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBjZWxsLnZpc2libGUgPSBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gY2VsbDtcbn07XG5cblBhY2thZ2VDb250cm9sbGVyLnByb3RvdHlwZS5udW1iZXJPZkNlbGxzSW5UYWJsZVZpZXcgPSBmdW5jdGlvbihtdWx0aVRhYmxlKSB7XG4gICAgcmV0dXJuIHRoaXMucGFja2FnZUNvbmZpZ3MubGVuZ3RoO1xufTtcblxuUGFja2FnZUNvbnRyb2xsZXIucHJvdG90eXBlLm51bWJlck9mR3JpZHNJbkNlbGwgPSBmdW5jdGlvbihtdWx0aVRhYmxlLCBjb2xJZHgpIHtcbiAgICByZXR1cm4gMTtcbn07XG5cblBhY2thZ2VDb250cm9sbGVyLnByb3RvdHlwZS5ncmlkU2l6ZUZvclRhYmxlID0gZnVuY3Rpb24odGFibGUsIGNvbElkeCkge1xuICAgIHJldHVybiBjYy5zaXplKGNjLndpblNpemUud2lkdGgsIDE0Myk7XG59O1xuXG5QYWNrYWdlQ29udHJvbGxlci5wcm90b3R5cGUuZ3JpZFRvdWNoZWQgPSBmdW5jdGlvbih0YWJsZSwgZ3JpZCkge1xuICAgIGNjLmxvZyhcImdyaWQgdG91Y2hlZCBhdCBpbmRleDogXCIgKyBncmlkLmdldElkeCgpKTtcbiAgICB2YXIgcGFja2FnZUVudGl0eSA9IGdyaWQucGFja2FnZUVudGl0eTtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBpZiAocGFja2FnZUVudGl0eS5pc0xvY2tlZCgpKSB7XG4gICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBZZXNOb0NvbW1vbkRsZyhnYW1lLnV0aWxzLnNwcmludGYoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcInVubG9ja19pbmZvXCIpLCBwYWNrYWdlRW50aXR5LnVubG9ja0NvdW50KSxcbiAgICAgICAgICAgIGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJ1bmxvY2tfdGl0bGVcIiksXG4gICAgICAgICAgICBnYW1lLmxvY2FsLmdldFZhbHVlKFwiY2FuY2VsX3RpdGxlXCIpLFxuICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKGdhbWUucGxheWVyTWFuLnBsYXllci5jb2lucyA+PSBwYWNrYWdlRW50aXR5LnVubG9ja0NvdW50KSB7XG4gICAgICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uYWRkQ29pbnMoLXBhY2thZ2VFbnRpdHkudW5sb2NrQ291bnQpO1xuICAgICAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLnNldFBhY2thZ2VVbmxvY2tlZChwYWNrYWdlRW50aXR5LmlkKTtcbiAgICAgICAgICAgICAgICBncmlkLnJlZnJlc2goKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFN0b3JlRGxnKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2hvd0Nsb3NlQW5pbShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBHYW1lTWFuLmdldEluc3RhbmNlKCkuc2V0UGFja2FnZUVudGl0eShwYWNrYWdlRW50aXR5KTtcbiAgICAgICAgICAgIGdhbWUuc2NlbmVNYW4uc3dpdGNoU2NlbmUoZ2FtZS5zY2VuZVR5cGUuTEVWRUwpO1xuICAgICAgICB9KTtcbiAgICB9XG59O1xuXG5QYWNrYWdlQ29udHJvbGxlci5wcm90b3R5cGUuYmFja0NsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgdGhpcy5zaG93Q2xvc2VBbmltKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5NRU5VKTtcbiAgICB9KTtcbn07XG5cblBhY2thZ2VDb250cm9sbGVyLnByb3RvdHlwZS5zaG93Q2xvc2VBbmltID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm51bWJlck9mQ2VsbHNJblRhYmxlVmlldygpOyArK2kpIHtcbiAgICAgICAgdmFyIGNlbGwgPSB0aGlzLl90YWJsZVZpZXcuZ2V0R3JpZEF0SW5kZXgoaSk7XG4gICAgICAgIGlmIChjZWxsKSB7XG4gICAgICAgICAgICBjZWxsLnNob3dEaXNhcHBlYXJBbmltKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5yb290Tm9kZS5zY2hlZHVsZU9uY2UoZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgIH1cbiAgICB9LmJpbmQodGhpcyksIDAuOCk7XG59O1xuXG5QYWNrYWdlQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgY2MuQnVpbGRlclJlYWRlci5yZWdpc3RlckNvbnRyb2xsZXIoXCJUaXRsZUNvbnRyb2xsZXJcIiwgbmV3IFRpdGxlQ29udHJvbGxlcigpKTtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL21lbnUvcGFja2FnZV92aWV3LmNjYmlcIiwgbnVsbCwgXCJQYWNrYWdlQ29udHJvbGxlclwiLCBuZXcgUGFja2FnZUNvbnRyb2xsZXIoKSk7XG4gICAgY2MuQnVpbGRlclJlYWRlci5fY29udHJvbGxlckNsYXNzQ2FjaGVbXCJUaXRsZUNvbnRyb2xsZXJcIl0gPSB1bmRlZmluZWQ7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFBhY2thZ2VDb250cm9sbGVyOyIsInZhciBMb2NrU3RhdHVzID0gcmVxdWlyZShcIi4uL2VudW0vTG9ja1N0YXR1c1wiKTtcblxudmFyIFBhY2thZ2VJdGVtQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuICAgIHRoaXMubGJOYW1lID0gbnVsbDtcbiAgICB0aGlzLmxiQ291bnQgPSBudWxsO1xuXG4gICAgdGhpcy5zcEJnID0gbnVsbDtcblxuICAgIHRoaXMuc3BDb21wbGV0ZWQgPSBudWxsO1xuICAgIHRoaXMuc3BVbkNvbXBsZXRlZCA9IG51bGw7XG5cbiAgICB0aGlzLm5kTG9jayA9IG51bGw7XG4gICAgdGhpcy5sYlVubG9ja0NvdW50ID0gbnVsbDtcblxuICAgIHRoaXMucGFja2FnZUVudGl0eSA9IG51bGw7XG5cbiAgICB0aGlzLmlkeCA9IDA7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKFBhY2thZ2VJdGVtQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5QYWNrYWdlSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcbn07XG5cblBhY2thZ2VJdGVtQ29udHJvbGxlci5wcm90b3R5cGUuc2hvd0FwcGVhckFuaW0gPSBmdW5jdGlvbiAoaW5pdGVkKSB7XG4gICAgLy9pZiAoIWluaXRlZCkge1xuICAgICAgICB0aGlzLnJvb3ROb2RlLnN0b3BBbGxBY3Rpb25zKCk7XG4gICAgICAgIGdhbWUudXRpbHMucGxheUNDQkFuaW1hdGlvbih0aGlzLnJvb3ROb2RlLCBcImxlZnRcIik7XG4gICAgICAgIHRoaXMucm9vdE5vZGUuc2NoZWR1bGVPbmNlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGdhbWUudXRpbHMucGxheUNDQkFuaW1hdGlvbih0aGlzLnJvb3ROb2RlLCBcIm5vcm1hbFwiKTtcbiAgICAgICAgfS5iaW5kKHRoaXMpLCB0aGlzLmlkeCAqIDAuMDUpO1xuICAgIC8vfSBlbHNlIHtcbiAgICAvLyAgICBnYW1lLnV0aWxzLnBsYXlDQ0JBbmltYXRpb24odGhpcy5yb290Tm9kZSwgXCJub25lXCIpO1xuICAgIC8vfVxufTtcblxuUGFja2FnZUl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5zaG93RGlzYXBwZWFyQW5pbSA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnJvb3ROb2RlLnN0b3BBbGxBY3Rpb25zKCk7XG4gICAgdGhpcy5yb290Tm9kZS5zY2hlZHVsZU9uY2UoZnVuY3Rpb24gKCkge1xuICAgICAgICBnYW1lLnV0aWxzLnBsYXlDQ0JBbmltYXRpb24odGhpcy5yb290Tm9kZSwgXCJkaXNhcHBlYXJcIik7XG4gICAgfS5iaW5kKHRoaXMpLCB0aGlzLmlkeCAqIDAuMDUpO1xufTtcblxuLyoqXG4gKiBAcGFyYW0ge1BhY2thZ2VDb25maWd9IGRhdGFcbiAqIEBwYXJhbSB7bnVtYmVyfSBpZHhcbiAqL1xuUGFja2FnZUl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aCA9IGZ1bmN0aW9uIChkYXRhLCBpZHgpIHtcbiAgICB0aGlzLnBhY2thZ2VFbnRpdHkgPSBkYXRhO1xuICAgIHRoaXMuaWR4ID0gaWR4O1xuICAgIHRoaXMucmVmcmVzaCgpO1xuICAgIGdhbWUudXRpbHMucGxheUNDQkFuaW1hdGlvbih0aGlzLnJvb3ROb2RlLCBcIm5vbmVcIik7XG59O1xuXG5QYWNrYWdlSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLnJlZnJlc2ggPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5sYk5hbWUuc2V0U3RyaW5nKGdhbWUubG9jYWwuZ2V0VmFsdWUoZ2FtZS51dGlscy5zcHJpbnRmKFwicGFja2FnZV8lZFwiLCB0aGlzLmlkeCArIDEpKSk7XG4gICAgdmFyIG1heExldmVsID0gZ2FtZS5wbGF5ZXJNYW4uZ2V0UGFja2FnZVVubG9ja0xldmVsKHRoaXMucGFja2FnZUVudGl0eS5pZCkgKyAxO1xuICAgIGlmIChtYXhMZXZlbCA+IHRoaXMucGFja2FnZUVudGl0eS5jb3VudCkge1xuICAgICAgICBtYXhMZXZlbCA9IHRoaXMucGFja2FnZUVudGl0eS5jb3VudDtcbiAgICB9XG4gICAgdGhpcy5sYkNvdW50LnNldFN0cmluZyhtYXhMZXZlbCArIFwiL1wiICsgdGhpcy5wYWNrYWdlRW50aXR5LmNvdW50KTtcbiAgICB0aGlzLnNwQmcuc2V0U3ByaXRlRnJhbWUoY2Muc3ByaXRlRnJhbWVDYWNoZS5nZXRTcHJpdGVGcmFtZSh0aGlzLnBhY2thZ2VFbnRpdHkuaW1hZ2UpKTtcbiAgICB0aGlzLnNwQ29tcGxldGVkLnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLnNwVW5Db21wbGV0ZWQudmlzaWJsZSA9IGZhbHNlO1xuICAgIGlmIChtYXhMZXZlbCA9PT0gdGhpcy5wYWNrYWdlRW50aXR5LmNvdW50KSB7XG4gICAgICAgIHRoaXMuc3BDb21wbGV0ZWQudmlzaWJsZSA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zcFVuQ29tcGxldGVkLnZpc2libGUgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAodGhpcy5wYWNrYWdlRW50aXR5LmlzTG9ja2VkKCkpIHtcbiAgICAgICAgdGhpcy5uZExvY2sudmlzaWJsZSA9IHRydWU7XG4gICAgICAgIHRoaXMubGJVbmxvY2tDb3VudC5zZXRTdHJpbmcodGhpcy5wYWNrYWdlRW50aXR5LnVubG9ja0NvdW50KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLm5kTG9jay52aXNpYmxlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKCFnYW1lLmxvY2FsLmlzQ2hpbmVzZSgpKSB7XG4gICAgICAgIHRoaXMubGJOYW1lLnNldFNjYWxlKDEuMCk7XG4gICAgfVxufTtcblxuUGFja2FnZUl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5nZXRDb250ZW50U2l6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5zcEJnLmdldENvbnRlbnRTaXplKCk7XG59O1xuXG5QYWNrYWdlSXRlbUNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9tZW51L3BhY2thZ2VfaXRlbV92aWV3LmNjYmlcIiwgbnVsbCwgXCJQYWNrYWdlSXRlbUNvbnRyb2xsZXJcIiwgbmV3IFBhY2thZ2VJdGVtQ29udHJvbGxlcigpKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUGFja2FnZUl0ZW1Db250cm9sbGVyOyIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDIwMTcvMTIvMTUuXG4gKi9cbnZhciBHYW1lTWFuID0gcmVxdWlyZShcIi4uL21vZGVsL0dhbWVNYW5cIik7XG52YXIgRXZlbnRzTmFtZSA9IHJlcXVpcmUoXCIuLi9ldmVudHMvRXZlbnRzTmFtZVwiKTtcbnZhciBSZW1vdmVBZHNDb250cm9sbGVyID0gcmVxdWlyZShcIi4vUmVtb3ZlQWRzQ29udHJvbGxlclwiKTtcblxudmFyIFBhc3NDbkNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcbiAgICB0aGlzLl9yZXBsYXlDYWxsYmFjayA9IG51bGw7XG4gICAgdGhpcy5fbmV4dENhbGxiYWNrID0gbnVsbDtcblxuICAgIC8vdGhpcy5zcFdpbkNuID0gbnVsbDtcbiAgICAvL3RoaXMuc3BXaW5FbiA9IG51bGw7XG5cbiAgICB0aGlzLm5kV2hlZWwgPSBudWxsO1xuICAgIHRoaXMubmRDbGFpbURpYW1vbmRzID0gbnVsbDtcbiAgICB0aGlzLm5kRGlhbW9uZHMgPSBudWxsO1xuICAgIHRoaXMubGJsRGlhbW9uZFJld2FyZCA9IG51bGw7XG4gICAgdGhpcy5zcFJld2FyZERpYW1vbmRzID0gbnVsbDtcblxuICAgIHRoaXMubGJsUmV3YXJkID0gbnVsbDtcbiAgICB0aGlzLmxibE11bHRpRGlhbW9uZHMgPSBudWxsO1xuICAgIC8vIHRoaXMubGJsV2hlZWwgPSBudWxsO1xuXG4gICAgdGhpcy5zcFllbGxvdzEgPSBudWxsO1xuICAgIHRoaXMuc3BZZWxsb3cyID0gbnVsbDtcbiAgICB0aGlzLnNwWWVsbG93MyA9IG51bGw7XG5cbiAgICB0aGlzLnNwQmxhY2sxID0gbnVsbDtcbiAgICB0aGlzLnNwQmxhY2syID0gbnVsbDtcbiAgICB0aGlzLnNwQmxhY2szID0gbnVsbDtcblxuICAgIHRoaXMubmRSZWZyZXNoID0gbnVsbDtcblxuICAgIHRoaXMubmRDb250aW51ZUIgPSBudWxsO1xuICAgIHRoaXMubmRDb250aW51ZVMgPSBudWxsO1xuXG4gICAgdGhpcy5uZE5vcm1hbCA9IG51bGw7XG4gICAgdGhpcy5uZENoYWxsZW5nZSA9IG51bGw7XG5cbiAgICB0aGlzLmxiQ2hhbGxlbmdlID0gbnVsbDtcblxuICAgIHRoaXMubGJsQmFzZVJld2FyZCA9IG51bGw7XG4gICAgdGhpcy5sYmxNdWx0aSA9IG51bGw7XG5cbiAgICB0aGlzLm5kQ2hhbGxlbmdlQnRuID0gbnVsbDtcblxuICAgIHRoaXMuc3BZZWxsb3dzID0gW107XG5cbiAgICB0aGlzLnNwQ2hhbGxlbmdlTGluZXMgPSBbXTtcbiAgICB0aGlzLnNwQ2hhbGxlbmdlSWNvbnMgPSBbXTtcblxuICAgIC8vdGhpcy5zcEJsYWNrcyA9IFtdO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhQYXNzQ25Db250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cblBhc3NDbkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRXhpdCA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLl9yZXBsYXlDYWxsYmFjayA9IG51bGw7XG4gICAgdGhpcy5fbmV4dENhbGxiYWNrID0gbnVsbDtcbiAgICBjYy5kaXJlY3Rvci5nZXRTY2hlZHVsZXIoKS51bnNjaGVkdWxlQ2FsbGJhY2tGb3JUYXJnZXQodGhpcywgdGhpcy5vblVwZGF0ZSk7XG4gICAgaWYgKHRoaXMubnVtYmVyQW5pbWF0aW9uKSB7XG4gICAgICAgIHRoaXMubnVtYmVyQW5pbWF0aW9uLmRlc3Ryb3koKTtcbiAgICB9XG4gICAgLy8gZ2FtZS5ldmVudERpc3BhdGNoZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImRpYWxvZ19wb3BlZFwiLCB0aGlzLm9uRGlhbG9nUG9wZWQsIHRoaXMpO1xuICAgIC8vIGdhbWUuZXZlbnREaXNwYXRjaGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJkaWFsb2dfY2xvc2VkXCIsIHRoaXMub25EaWFsb2dDbG9zZWQsIHRoaXMpO1xuICAgIC8vIHRoaXMucmVtb3ZlTmF0aXZlQWQoKTtcbn07XG5cblBhc3NDbkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgLy8gZ2FtZS5ldmVudERpc3BhdGNoZXIuYWRkRXZlbnRMaXN0ZW5lcihcImRpYWxvZ19wb3BlZFwiLCB0aGlzLm9uRGlhbG9nUG9wZWQsIHRoaXMpO1xuICAgIC8vIGdhbWUuZXZlbnREaXNwYXRjaGVyLmFkZEV2ZW50TGlzdGVuZXIoXCJkaWFsb2dfY2xvc2VkXCIsIHRoaXMub25EaWFsb2dDbG9zZWQsIHRoaXMpO1xuICAgIGNjLmRpcmVjdG9yLmdldFNjaGVkdWxlcigpLnNjaGVkdWxlQ2FsbGJhY2tGb3JUYXJnZXQodGhpcywgdGhpcy5vblVwZGF0ZSwgMC4wNSwgY2MuUkVQRUFUX0ZPUkVWRVIsIDAsIGZhbHNlKTtcbiAgICBpZiAoZ2FtZS5hZHNNYW5hZ2VyLnNob3dUb3BCYW5uZXIpIHtcbiAgICAgICAgZ2FtZS5hZHNNYW5hZ2VyLnJlbW92ZUJhbm5lckFkcyhcInRvcFwiKTtcbiAgICB9XG59O1xuLy9cbi8vIFBhc3NDbkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlhbG9nUG9wZWQgPSBmdW5jdGlvbiAoKSB7XG4vLyAgICAgdGhpcy51cGRhdGVOYXRpdmVBZCgpO1xuLy8gfTtcbi8vXG4vLyBQYXNzQ25Db250cm9sbGVyLnByb3RvdHlwZS5vbkRpYWxvZ0Nsb3NlZCA9IGZ1bmN0aW9uICgpIHtcbi8vICAgICB0aGlzLnVwZGF0ZU5hdGl2ZUFkKCk7XG4vLyB9O1xuLy9cbi8vIFBhc3NDbkNvbnRyb2xsZXIucHJvdG90eXBlLnVwZGF0ZU5hdGl2ZUFkID0gZnVuY3Rpb24gKCkge1xuLy8gICAgIGlmIChnYW1lLmRpYWxvZ01hbmFnZXIuaXNUb3Blc3REaWFsb2codGhpcy5yb290Tm9kZSkpIHtcbi8vICAgICAgICAgdGhpcy5zaG93TmF0aXZlQWQoKTtcbi8vICAgICB9IGVsc2Uge1xuLy8gICAgICAgICB0aGlzLnJlbW92ZU5hdGl2ZUFkKCk7XG4vLyAgICAgfVxuLy8gfTtcbi8vXG4vLyBQYXNzQ25Db250cm9sbGVyLnByb3RvdHlwZS5zaG93TmF0aXZlQWQgPSBmdW5jdGlvbiAoKSB7XG4vLyAgICAgZ2FtZS5hZHNNYW5hZ2VyLnNob3dOYXRpdmVBZChcInBhc3NcIiwgMCwgMCk7XG4vLyB9O1xuLy9cbi8vIFBhc3NDbkNvbnRyb2xsZXIucHJvdG90eXBlLnJlbW92ZU5hdGl2ZUFkID0gZnVuY3Rpb24gKCkge1xuLy8gICAgIGdhbWUuYWRzTWFuYWdlci5yZW1vdmVOYXRpdmVBZChcInBhc3NcIik7XG4vLyB9O1xuXG5QYXNzQ25Db250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG5cbiAgICAvLyB0aGlzLmxibFJld2FyZC5zZXRTdHJpbmcoXyhcIndhdGNoX2Fkc19nZXRfYm9vc3RzXCIpKTtcbiAgICAvLyB0aGlzLmxibFdoZWVsLnNldFN0cmluZyhfKFwibHVja3lfd2hlZWxfdGl0bGVcIikpO1xuXG4gICAgaWYgKCFnYW1lLmdhbWVNYW4uaXNDaGFsbGVuZ2VMZXZlbCkge1xuXG4gICAgICAgIHRoaXMuc3BZZWxsb3dzID0gW3RoaXMuc3BZZWxsb3cxLCB0aGlzLnNwWWVsbG93MiwgdGhpcy5zcFllbGxvdzNdO1xuXG4gICAgICAgIHZhciBzdGFyID0gR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmN1cnJlbnRTdGFyO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDM7ICsraSkge1xuICAgICAgICAgICAgdGhpcy5zcFllbGxvd3NbaV0udmlzaWJsZSA9IChzdGFyID49IGkgKyAxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBzdGFyOyArK2kpIHtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJzdGFyX1wiICsgKGluZGV4ICsgMSkpO1xuICAgICAgICAgICAgICAgICAgICBnYW1lLmF1ZGlvUGxheWVyLnZpYnJhdGVTaG9ydCgpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KGkpLCAyNTAgKiAoaSArIDEpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMubmRDbGFpbURpYW1vbmRzLnZpc2libGUgPSB0cnVlO1xuICAgICAgICBpZiAoZ2FtZS5nYW1lTWFuLmdldEN1cnJlbnRSZXdhcmREaWFtb25kcygpID4gMCkge1xuICAgICAgICAgICAgdGhpcy5sYmxCYXNlUmV3YXJkLnNldFN0cmluZyhcIitcIiArIGdhbWUuZ2FtZU1hbi5nZXRDdXJyZW50UmV3YXJkRGlhbW9uZHMoKSk7XG4gICAgICAgICAgICB0aGlzLmxibERpYW1vbmRSZXdhcmQuc2V0U3RyaW5nKFwiK1wiICsgZ2FtZS5nYW1lTWFuLmdldEN1cnJlbnRSZXdhcmREaWFtb25kcygpKTtcbiAgICAgICAgICAgIC8vIHNldFRpbWVvdXQodGhpcy5kb0NsYWltRGlhbW9uZHMuYmluZCh0aGlzKSwgOTAwKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubmRDbGFpbURpYW1vbmRzLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNldFRpbWVvdXQodGhpcy5kb0FkZEFjdGl2aXR5VGFzay5iaW5kKHRoaXMpLCA2MDApO1xuXG4gICAgICAgIHRoaXMubGJsTXVsdGkuc2V0U3RyaW5nKGdhbWUudXRpbHMuc3ByaW50ZihfKFwibXVsdGlfY2xhaW1fdGl0bGVcIiksXG4gICAgICAgICAgICBnYW1lLmNvbmZpZy5tdWx0aUNsYWltUmFuZ2VbMF0sXG4gICAgICAgICAgICBnYW1lLmNvbmZpZy5tdWx0aUNsYWltUmFuZ2VbMV0pKTtcblxuICAgICAgICBpZiAoZ2FtZS5jaGFsbGVuZ2VNYW4uaXNBbGxDaGFsbGVuZ2VVbmxvY2tlZCgpKSB7XG4gICAgICAgICAgICB0aGlzLm5kQ2hhbGxlbmdlQnRuLnZpc2libGUgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5uZENoYWxsZW5nZUJ0bi52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLm5kQ2hhbGxlbmdlQnRuLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJjaGFsbGVuZ2Vfc3VjY2Vzc1wiKTtcbiAgICAgICAgdGhpcy5zcENoYWxsZW5nZUxpbmVzID0gW3RoaXMuc3BMaW5lMSwgdGhpcy5zcExpbmUyLCB0aGlzLnNwTGluZTMsIHRoaXMuc3BMaW5lNF07XG4gICAgICAgIHRoaXMuc3BDaGFsbGVuZ2VJY29ucyA9IFt0aGlzLnNwTGV2ZWwxLCB0aGlzLnNwTGV2ZWwyLCB0aGlzLnNwTGV2ZWwzLCB0aGlzLnNwTGV2ZWw0XTtcblxuICAgICAgICB2YXIgbGV2ZWwgPSAoZ2FtZS5jaGFsbGVuZ2VNYW4uZ2V0Q2hhbGxlbmdlTGV2ZWwoKSAtIDIpICUgNTtcblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc3BDaGFsbGVuZ2VJY29ucy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdmFyIGljb24gPSB0aGlzLnNwQ2hhbGxlbmdlSWNvbnNbaV07XG4gICAgICAgICAgICB2YXIgbGluZSA9IHRoaXMuc3BDaGFsbGVuZ2VMaW5lc1tpXTtcbiAgICAgICAgICAgIGlmIChpIDw9IGxldmVsKSB7XG4gICAgICAgICAgICAgICAgaWNvbi5zZXRTcHJpdGVGcmFtZShcImljb25fY29tcGxldGVkXzMucG5nXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpY29uLnNldFNwcml0ZUZyYW1lKFwiaWNvbl9sb2NrZWRfMy5wbmdcIik7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpIDwgbGV2ZWwpIHtcbiAgICAgICAgICAgICAgICBsaW5lICYmIGxpbmUuc2V0U3ByaXRlRnJhbWUoXCJpY29uX2xpbmVfeWVsbG93LnBuZ1wiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbGluZSAmJiBsaW5lLnNldFNwcml0ZUZyYW1lKFwiaWNvbl9saW5lX3doaXRlLnBuZ1wiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGdhbWUudXRpbHMucGxheUNDQkFuaW1hdGlvbih0aGlzLnJvb3ROb2RlLCBcImNoYWxsZW5nZVwiKTtcblxuICAgICAgICB0aGlzLmxibE11bHRpRGlhbW9uZHMuc2V0U3RyaW5nKGdhbWUudXRpbHMuc3ByaW50ZihfKFwibXVsdGlfZGlhbW9uZHNfdGl0bGVcIiksXG4gICAgICAgICAgICBnYW1lLmNvbmZpZy5tdWx0aURpYW1vbmRzUmFuZ2VbMF0sXG4gICAgICAgICAgICBnYW1lLmNvbmZpZy5tdWx0aURpYW1vbmRzUmFuZ2VbMV0pKTtcbiAgICB9XG5cbiAgICBpZiAoIWdhbWUudXRpbHMuaXNQYWQoKSkge1xuICAgICAgICB2YXIgbm9kZSA9IFJlbW92ZUFkc0NvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICB0aGlzLnJvb3ROb2RlLmFkZENoaWxkKG5vZGUpO1xuICAgICAgICBpZiAoZ2FtZS51dGlscy5pc0lPU05vdGNoU2NyZWVuKCkpIHtcbiAgICAgICAgICAgIG5vZGUueSArPSA0MDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMubmROb3JtYWwudmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMubmRDaGFsbGVuZ2UudmlzaWJsZSA9IGZhbHNlO1xuICAgIGlmIChnYW1lLmdhbWVNYW4uaXNDaGFsbGVuZ2VMZXZlbCkge1xuICAgICAgICB0aGlzLm5kQ2hhbGxlbmdlLnZpc2libGUgPSB0cnVlO1xuICAgICAgICB0aGlzLmxiQ2hhbGxlbmdlLnNldFN0cmluZyhnYW1lLnV0aWxzLnNwcmludGYoXyhcImNoYWxsZW5nZV90aXRsZVwiKSwgZ2FtZS5nYW1lTWFuLmxldmVsSWQgLSAxKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5uZE5vcm1hbC52aXNpYmxlID0gdHJ1ZTtcbiAgICB9XG5cbiAgICB2YXIgUmV3YXJkUmVtb3ZlQWRDb250cm9sbGVyID0gcmVxdWlyZShcIi4vUmV3YXJkUmVtb3ZlQWRDb250cm9sbGVyXCIpO1xuICAgIHRoaXMubmRSZXdhcmRSZW1vdmVBZHMuYWRkQ2hpbGQoUmV3YXJkUmVtb3ZlQWRDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKSk7XG5cbiAgICB2YXIgRGFpbHlUYXNrUG9zID0gcmVxdWlyZShcIi4uL2VudW0vRGFpbHlUYXNrUG9zXCIpO1xuICAgIHRoaXMubmRBY3Rpdml0eS5jb250cm9sbGVyLmluaXRXaXRoKERhaWx5VGFza1Bvcy5QYXNzQ24pO1xufTtcblxuUGFzc0NuQ29udHJvbGxlci5wcm90b3R5cGUuZG9BZGRBY3Rpdml0eVRhc2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCFnYW1lLmdhbWVNYW4uaXNIYXJkTW9kZSgpKSB7XG4gICAgICAgIGdhbWUuYWN0aXZpdHlNYW4uYWRkQWN0aXZpdHlUYXNrQ291bnQoZ2FtZS5hY3Rpdml0eVRhc2tUeXBlLkxldmVsKTtcbiAgICB9XG59O1xuXG5QYXNzQ25Db250cm9sbGVyLnByb3RvdHlwZS5hY3Rpdml0eUNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiRGFpbHlUYXNrUGFzc0NsaWNrXCIpO1xuICAgIGdhbWUucG9wdXBNYW4ucG9wdXBBY3Rpdml0eVRhc2soKTtcbn07XG5cblBhc3NDbkNvbnRyb2xsZXIucHJvdG90eXBlLmRvQ2xhaW1EaWFtb25kcyA9IGZ1bmN0aW9uIChyZXdhcmREaWFtb25kcywgZW5kQ2FsbGJhY2spIHtcbiAgICBpZiAodGhpcy5jbGFpbWluZylcbiAgICB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5jbGFpbWluZyA9IHRydWU7XG5cbiAgICAvL2dhbWUuYXVkaW9QbGF5ZXIucGxheUVmZmVjdEJ5S2V5KFwiY29pbnNfZmx5XCIpO1xuICAgIHZhciBkaWFtb25kUG9zID0gdGhpcy5zcFJld2FyZERpYW1vbmRzLnBhcmVudC5jb252ZXJ0VG9Xb3JsZFNwYWNlKHRoaXMuc3BSZXdhcmREaWFtb25kcy5nZXRQb3NpdGlvbigpKTtcbiAgICB2YXIgZGlhbW5kRW5kUG9zID0gdGhpcy5uZERpYW1vbmRzLnBhcmVudC5jb252ZXJ0VG9Xb3JsZFNwYWNlKHRoaXMubmREaWFtb25kcy5nZXRQb3NpdGlvbigpKTtcbiAgICBnYW1lLmVmZmVjdE1hbi5wbGF5Rmx5Q29pbnMoZGlhbW9uZFBvcywgZGlhbW5kRW5kUG9zLCAxMCwgODAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdhbWUucGxheWVyTWFuLmFkZERpYW1vbmRzKHJld2FyZERpYW1vbmRzLCBcInBhc3NfbGV2ZWxcIik7XG4gICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAvL3RoaXMubmRDbGFpbURpYW1vbmRzLnJ1bkFjdGlvbihjYy5zZXF1ZW5jZShjYy5kZWxheVRpbWUoMSksIGNjLmZhZGVPdXQoMC4zKSkpO1xuICAgICAgICBlbmRDYWxsYmFjayAmJiBlbmRDYWxsYmFjaygpO1xuICAgIH0uYmluZCh0aGlzKSk7XG59O1xuXG5QYXNzQ25Db250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aCA9IGZ1bmN0aW9uIChyZXBsYXlDYWxsYmFjaywgbmV4dENhbGxiYWNrKSB7XG4gICAgdGhpcy5fcmVwbGF5Q2FsbGJhY2sgPSByZXBsYXlDYWxsYmFjaztcbiAgICB0aGlzLl9uZXh0Q2FsbGJhY2sgPSBuZXh0Q2FsbGJhY2s7XG59O1xuXG5QYXNzQ25Db250cm9sbGVyLnByb3RvdHlwZS5vbkFuaW1FbmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCFnYW1lLmNoYWxsZW5nZU1hbi5jaGVja0FuZFNob3dDaGFsbGVuZ2UoKSkge1xuICAgICAgICBpZiAoIWdhbWUuZ2FtZU1hbi5jaGVja0FuZFNob3dCb3goKSkge1xuICAgICAgICAgICAgdmFyIHNob3dlZFJhdGUgPSBHYW1lTWFuLmdldEluc3RhbmNlKCkuc2hvd1JhdGUoKTtcbiAgICAgICAgICAgIGlmICghc2hvd2VkUmF0ZSkge1xuICAgICAgICAgICAgICAgIGlmICghZ2FtZS5nYW1lTWFuLnRyeVNob3dQYXNzUG9wdXAoKSkge1xuICAgICAgICAgICAgICAgICAgICBnYW1lLmFkc0hlbHBlci5zaG93UGFzc0FkcygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn07XG5cblBhc3NDbkNvbnRyb2xsZXIucHJvdG90eXBlLm9uVXBkYXRlRGlhbW9uZHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5sYkRpYW1vbmRzLnNldFN0cmluZyhnYW1lLnBsYXllck1hbi5nZXREaWFtb25kcygpKTtcbn07XG5cblBhc3NDbkNvbnRyb2xsZXIucHJvdG90eXBlLm9uVXBkYXRlID0gZnVuY3Rpb24gKGR0KSB7XG4gICAgaWYgKHRoaXMubnVtYmVyQW5pbWF0aW9uKSB7XG4gICAgICAgIHRoaXMubnVtYmVyQW5pbWF0aW9uLnVwZGF0ZShkdCk7XG4gICAgfVxufTtcblxuUGFzc0NuQ29udHJvbGxlci5wcm90b3R5cGUubmV4dENsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJlbnRlclwiKTtcbiAgICB0aGlzLnNob3dDbGFpbURpYW1vbmRzQW5kRW50ZXJOZXh0TGV2ZWwoZ2FtZS5nYW1lTWFuLmdldEN1cnJlbnRSZXdhcmREaWFtb25kcygpKTtcbn07XG5cblBhc3NDbkNvbnRyb2xsZXIucHJvdG90eXBlLmNoYWxsZW5nZU5leHRDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIGdhbWUuYXVkaW9QbGF5ZXIucGxheUVmZmVjdEJ5S2V5KFwiZW50ZXJcIik7XG4gICAgaWYgKHRoaXMuX25leHRDYWxsYmFjaykge1xuICAgICAgICB0aGlzLl9uZXh0Q2FsbGJhY2soKTtcbiAgICB9XG4gICAgdGhpcy5jbG9zZSgpO1xufTtcblxuUGFzc0NuQ29udHJvbGxlci5wcm90b3R5cGUucGtDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIGdhbWUuYXVkaW9QbGF5ZXIucGxheUVmZmVjdEJ5S2V5KFwiZW50ZXJcIik7XG4gICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5DSEFMTEVOR0VfTElTVCk7XG59O1xuXG5QYXNzQ25Db250cm9sbGVyLnByb3RvdHlwZS5za2luQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImVudGVyXCIpO1xuICAgIHZhciBTdG9yZVR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9TdG9yZVR5cGVcIik7XG4gICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFN0b3JlRGxnKFN0b3JlVHlwZS5TS0lOKTtcbn07XG5cblBhc3NDbkNvbnRyb2xsZXIucHJvdG90eXBlLnNob3dDbGFpbURpYW1vbmRzQW5kRW50ZXJOZXh0TGV2ZWwgPSBmdW5jdGlvbiAoZGlhbW9uZHMpIHtcbiAgICB0aGlzLmRvQ2xhaW1EaWFtb25kcyhkaWFtb25kcywgZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fbmV4dENhbGxiYWNrKSB7XG4gICAgICAgICAgICB0aGlzLl9uZXh0Q2FsbGJhY2soKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWdhbWUuZ2FtZU1hbi5pc0NoYWxsZW5nZUxldmVsKSB7XG4gICAgICAgICAgICBnYW1lLmFkc0hlbHBlci5zaG93UGFzc0FkcygpO1xuICAgICAgICAgICAgR2FtZU1hbi5nZXRJbnN0YW5jZSgpLnNob3dSZWdpc3Rlck5vdGlmaWNhdGlvbigpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9LmJpbmQodGhpcykpO1xufTtcblxuLy8gUGFzc0NuQ29udHJvbGxlci5wcm90b3R5cGUucmVzdGFydENsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4vLyAgICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJlbnRlclwiKTtcbi8vICAgICBnYW1lLmFkc0hlbHBlci5zaG93UGFzc0FkcygpO1xuLy8gICAgIGlmICh0aGlzLl9yZXBsYXlDYWxsYmFjaykge1xuLy8gICAgICAgICB0aGlzLl9yZXBsYXlDYWxsYmFjaygpO1xuLy8gICAgIH1cbi8vICAgICB0aGlzLmNsb3NlKCk7XG4vLyB9O1xuXG5QYXNzQ25Db250cm9sbGVyLnByb3RvdHlwZS5ob21lQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImVudGVyXCIpO1xuICAgIGlmIChnYW1lLmdhbWVNYW4uaXNDaGFsbGVuZ2VMZXZlbCkge1xuICAgICAgICBnYW1lLnNjZW5lTWFuLnN3aXRjaFNjZW5lKGdhbWUuc2NlbmVUeXBlLkNIQUxMRU5HRSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5NRU5VKTtcbiAgICB9XG4gICAgZ2FtZS5hZHNIZWxwZXIuc2hvd0JhY2tIb21lQWRzKCk7XG59O1xuXG5QYXNzQ25Db250cm9sbGVyLnByb3RvdHlwZS53YXRjaEFkc011bHRpQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImVudGVyXCIpO1xuICAgIHZhciB3aW5NdWx0aSA9IGdhbWUuZ2FtZU1hbi5nZXRQYXNzV2luTXVsdGkoKTtcbiAgICB2YXIgU3RvcmVIZWxwZXIgPSByZXF1aXJlKFwiLi4vbW9kZWwvU3RvcmVIZWxwZXJcIik7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuY2hlY2tBbmRTaG93UmV3YXJkVmlkZW8oXCJ3aW5fbXVsdGlcIiwgZnVuY3Rpb24gKHdhdGNoZWQpIHtcbiAgICAgICAgaWYgKHdhdGNoZWQpIHtcbiAgICAgICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBMdWNreVNwaW4od2luTXVsdGksIGdhbWUuY29uZmlnLm11bHRpQ2xhaW1SYW5nZSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHNlbGYub25HZXRXaW5NdWx0aURpYW1vbmRzKHdpbk11bHRpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG59O1xuXG5QYXNzQ25Db250cm9sbGVyLnByb3RvdHlwZS53YXRjaEFkc011bHRpRGlhbW9uZHNDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIGdhbWUuYXVkaW9QbGF5ZXIucGxheUVmZmVjdEJ5S2V5KFwiZW50ZXJcIik7XG4gICAgdmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xuICAgIFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuY2hlY2tBbmRHZXRSYW5kb21EaWFtb25kcyhcImRpYW1vbmRzX3JhbmRvbV9wYXVzZVwiKTtcbn07XG5cblBhc3NDbkNvbnRyb2xsZXIucHJvdG90eXBlLm9uR2V0V2luTXVsdGlEaWFtb25kcyA9IGZ1bmN0aW9uIChtdWx0aSkge1xuICAgIHZhciBOdW1iZXJBbmltYXRpb24gPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uL2VudGl0eS9OdW1iZXJBbmltYXRpb25cIik7XG4gICAgdGhpcy5udW1iZXJBbmltYXRpb24gPSBuZXcgTnVtYmVyQW5pbWF0aW9uKHRoaXMubGJsRGlhbW9uZFJld2FyZCwgXCIrXCIpO1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB0aGlzLm51bWJlckFuaW1hdGlvbi5wbGF5TnVtQW5pbShnYW1lLmdhbWVNYW4uZ2V0Q3VycmVudFJld2FyZERpYW1vbmRzKCksIGdhbWUuZ2FtZU1hbi5nZXRDdXJyZW50UmV3YXJkRGlhbW9uZHMoKSAqIG11bHRpLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNlbGYuc2hvd0NsYWltRGlhbW9uZHNBbmRFbnRlck5leHRMZXZlbChnYW1lLmdhbWVNYW4uZ2V0Q3VycmVudFJld2FyZERpYW1vbmRzKCkgKiBtdWx0aSk7XG4gICAgfSk7XG59O1xuXG4vLyBQYXNzQ25Db250cm9sbGVyLnByb3RvdHlwZS53aGVlbENsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4vLyAgICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4vLyAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiUGFzc1doZWVsXCIpO1xuLy8gICAgIHZhciBXaGVlbFR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9XaGVlbFR5cGVcIik7XG4vLyAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFdoZWVsRGxnKFdoZWVsVHlwZS5EYWlseUJvbnVzKTtcbi8vIH07XG5cblBhc3NDbkNvbnRyb2xsZXIucHJvdG90eXBlLnBvcHVwID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5wb3B1cCh0aGlzLnJvb3ROb2RlKTtcbn07XG5cblBhc3NDbkNvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5jbG9zZSh0aGlzLnJvb3ROb2RlKTtcbn07XG5cblBhc3NDbkNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBub2RlID0gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvbm90aWNlL3Bhc3Nfdmlld18xLmNjYmlcIiwgbnVsbCwgXCJQYXNzQ25Db250cm9sbGVyXCIsIG5ldyBQYXNzQ25Db250cm9sbGVyKCkpO1xuICAgIHJldHVybiBub2RlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBQYXNzQ25Db250cm9sbGVyOyIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDIwMTcvMTIvMTUuXG4gKi9cbnZhciBHYW1lTWFuID0gcmVxdWlyZShcIi4uL21vZGVsL0dhbWVNYW5cIik7XG52YXIgRXZlbnRzTmFtZSA9IHJlcXVpcmUoXCIuLi9ldmVudHMvRXZlbnRzTmFtZVwiKTtcbnZhciBSZW1vdmVBZHNDb250cm9sbGVyID0gcmVxdWlyZShcIi4vUmVtb3ZlQWRzQ29udHJvbGxlclwiKTtcblxudmFyIFBhc3NDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG4gICAgdGhpcy5fcmVwbGF5Q2FsbGJhY2sgPSBudWxsO1xuICAgIHRoaXMuX25leHRDYWxsYmFjayA9IG51bGw7XG5cbiAgICAvL3RoaXMuc3BXaW5DbiA9IG51bGw7XG4gICAgLy90aGlzLnNwV2luRW4gPSBudWxsO1xuXG4gICAgdGhpcy5uZFdoZWVsID0gbnVsbDtcbiAgICB0aGlzLm5kQ2xhaW1EaWFtb25kcyA9IG51bGw7XG4gICAgdGhpcy5uZERpYW1vbmRzID0gbnVsbDtcbiAgICB0aGlzLmxibERpYW1vbmRSZXdhcmQgPSBudWxsO1xuICAgIHRoaXMuc3BSZXdhcmREaWFtb25kcyA9IG51bGw7XG5cbiAgICB0aGlzLmxibFJld2FyZCA9IG51bGw7XG4gICAgLy8gdGhpcy5sYmxXaGVlbCA9IG51bGw7XG5cbiAgICB0aGlzLnNwWWVsbG93MSA9IG51bGw7XG4gICAgdGhpcy5zcFllbGxvdzIgPSBudWxsO1xuICAgIHRoaXMuc3BZZWxsb3czID0gbnVsbDtcblxuICAgIHRoaXMuc3BCbGFjazEgPSBudWxsO1xuICAgIHRoaXMuc3BCbGFjazIgPSBudWxsO1xuICAgIHRoaXMuc3BCbGFjazMgPSBudWxsO1xuXG4gICAgdGhpcy5uZFJlZnJlc2ggPSBudWxsO1xuXG4gICAgLy8gdGhpcy5uZENvbnRpbnVlQiA9IG51bGw7XG4gICAgLy8gdGhpcy5uZENvbnRpbnVlUyA9IG51bGw7XG5cbiAgICB0aGlzLm5kU3RhciA9IG51bGw7XG4gICAgdGhpcy5uZENoYWxsZW5nZSA9IG51bGw7XG5cbiAgICB0aGlzLmxiQ2hhbGxlbmdlID0gbnVsbDtcblxuICAgIHRoaXMuc3BZZWxsb3dzID0gW107XG5cbiAgICB0aGlzLnNwQ2hhbGxlbmdlTGluZXMgPSBbXTtcbiAgICB0aGlzLnNwQ2hhbGxlbmdlSWNvbnMgPSBbXTtcblxuICAgIHRoaXMubmRGcmVlRGlhbW9uZFNob3J0ID0gbnVsbDtcbiAgICB0aGlzLm5kRnJlZURpYW1vbmRMb25nID0gbnVsbDtcblxuICAgIC8vIHRoaXMuc2tpbk1hc2sgPSBudWxsO1xuICAgIHRoaXMubmRTa2luID0gbnVsbDtcbiAgICB0aGlzLnNwU2tpbiA9IG51bGw7XG4gICAgdGhpcy5zcFRvcFNraW4gPSBudWxsO1xuICAgIHRoaXMubGJsUHJvZ3Jlc3MgPSBudWxsO1xuICAgIC8vIHRoaXMuc3BTa2luMiA9IG51bGw7XG5cbiAgICAvL3RoaXMuc3BCbGFja3MgPSBbXTtcblxuICAgIHRoaXMuY2xhaW1pbmcgPSBmYWxzZTtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoUGFzc0NvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuUGFzc0NvbnRyb2xsZXIucHJvdG90eXBlLm9uRXhpdCA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLl9yZXBsYXlDYWxsYmFjayA9IG51bGw7XG4gICAgdGhpcy5fbmV4dENhbGxiYWNrID0gbnVsbDtcbn07XG5cblBhc3NDb250cm9sbGVyLnByb3RvdHlwZS5vbkVudGVyID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChnYW1lLmFkc01hbmFnZXIuc2hvd1RvcEJhbm5lcikge1xuICAgICAgICBnYW1lLmFkc01hbmFnZXIucmVtb3ZlQmFubmVyQWRzKFwidG9wXCIpO1xuICAgIH1cbn07XG5cblBhc3NDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG5cbiAgICB0aGlzLmxibFJld2FyZC5zZXRTdHJpbmcoXyhcIndhdGNoX2Fkc19nZXRfYm9vc3RzXCIpKTtcbiAgICAvLyB0aGlzLmxibFdoZWVsLnNldFN0cmluZyhfKFwibHVja3lfd2hlZWxfdGl0bGVcIikpO1xuXG4gICAgaWYgKCFnYW1lLmdhbWVNYW4uaXNDaGFsbGVuZ2VMZXZlbCkge1xuXG4gICAgICAgIHRoaXMuc3BZZWxsb3dzID0gW3RoaXMuc3BZZWxsb3cxLCB0aGlzLnNwWWVsbG93MiwgdGhpcy5zcFllbGxvdzNdO1xuXG4gICAgICAgIHZhciBzdGFyID0gR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmN1cnJlbnRTdGFyO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDM7ICsraSkge1xuICAgICAgICAgICAgdGhpcy5zcFllbGxvd3NbaV0udmlzaWJsZSA9IChzdGFyID49IGkgKyAxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBzdGFyOyArK2kpIHtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJzdGFyX1wiICsgKGluZGV4ICsgMSkpO1xuICAgICAgICAgICAgICAgICAgICBnYW1lLmF1ZGlvUGxheWVyLnZpYnJhdGVTaG9ydCgpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KGkpLCAyNTAgKiAoaSArIDEpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChnYW1lLmdhbWVNYW4uZ2V0Q3VycmVudFJld2FyZERpYW1vbmRzKCkgPiAwKSB7XG4gICAgICAgICAgICB0aGlzLm5kQ2xhaW1EaWFtb25kcy52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMubGJsRGlhbW9uZFJld2FyZC5zZXRTdHJpbmcoZ2FtZS5nYW1lTWFuLmdldEN1cnJlbnRSZXdhcmREaWFtb25kcygpKTtcbiAgICAgICAgICAgIGlmICghZ2FtZS5nYW1lTWFuLmlzTmV3UG9wdXAoKSkge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQodGhpcy5kb0NsYWltRGlhbW9uZHMuYmluZCh0aGlzKSwgOTAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubmRDbGFpbURpYW1vbmRzLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNldFRpbWVvdXQodGhpcy5kb0FkZEFjdGl2aXR5VGFzay5iaW5kKHRoaXMpLCAxMDAwKTtcblxuICAgICAgICBpZiAoZ2FtZS5nYW1lTWFuLmlzTmV3UG9wdXAoKSkge1xuICAgICAgICAgICAgdGhpcy5uZFNraW4udmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB2YXIgc2tpbklkID0gZ2FtZS5nYW1lTWFuLmdldE9yR2VuZXJhdGVTa2luSWQoKTtcbiAgICAgICAgICAgIGlmIChza2luSWQgPiAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNraW5DZmcgPSBnYW1lLmNvbmZpZ01hbi5nZXRTa2luQ2ZnKHNraW5JZCk7XG4gICAgICAgICAgICAgICAgdmFyIHNwcml0ZUZyYW1lID0gY2Muc3ByaXRlRnJhbWVDYWNoZS5nZXRTcHJpdGVGcmFtZShza2luQ2ZnLmltYWdlICsgXCJfbC5wbmdcIik7XG4gICAgICAgICAgICAgICAgaWYgKHNwcml0ZUZyYW1lICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zcFNraW4uc2V0U3ByaXRlRnJhbWUoc3ByaXRlRnJhbWUpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNwVG9wU2tpbi5zZXRTcHJpdGVGcmFtZShzcHJpdGVGcmFtZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlU2tpblByb2dyZXNzKDAuMyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLm5kU2tpbi52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm5kU2tpbi52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIH1cblxuICAgIH0gZWxzZSB7XG4gICAgICAgIGdhbWUuYXVkaW9QbGF5ZXIucGxheUVmZmVjdEJ5S2V5KFwiY2hhbGxlbmdlX3N1Y2Nlc3NcIik7XG4gICAgICAgIHRoaXMuc3BDaGFsbGVuZ2VMaW5lcyA9IFt0aGlzLnNwTGluZTEsIHRoaXMuc3BMaW5lMiwgdGhpcy5zcExpbmUzLCB0aGlzLnNwTGluZTRdO1xuICAgICAgICB0aGlzLnNwQ2hhbGxlbmdlSWNvbnMgPSBbdGhpcy5zcExldmVsMSwgdGhpcy5zcExldmVsMiwgdGhpcy5zcExldmVsMywgdGhpcy5zcExldmVsNF07XG5cbiAgICAgICAgdmFyIGxldmVsID0gKGdhbWUuY2hhbGxlbmdlTWFuLmdldENoYWxsZW5nZUxldmVsKCkgLSAyKSAlIDU7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNwQ2hhbGxlbmdlSWNvbnMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciBpY29uID0gdGhpcy5zcENoYWxsZW5nZUljb25zW2ldO1xuICAgICAgICAgICAgdmFyIGxpbmUgPSB0aGlzLnNwQ2hhbGxlbmdlTGluZXNbaV07XG4gICAgICAgICAgICBpZiAoaSA8PSBsZXZlbCkge1xuICAgICAgICAgICAgICAgIGljb24uc2V0U3ByaXRlRnJhbWUoXCJpY29uX2NvbXBsZXRlZF8zLnBuZ1wiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWNvbi5zZXRTcHJpdGVGcmFtZShcImljb25fbG9ja2VkXzMucG5nXCIpO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaSA8IGxldmVsKSB7XG4gICAgICAgICAgICAgICAgbGluZSAmJiBsaW5lLnNldFNwcml0ZUZyYW1lKFwiaWNvbl9saW5lX3llbGxvdy5wbmdcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGxpbmUgJiYgbGluZS5zZXRTcHJpdGVGcmFtZShcImljb25fbGluZV93aGl0ZS5wbmdcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBnYW1lLnV0aWxzLnBsYXlDQ0JBbmltYXRpb24odGhpcy5yb290Tm9kZSwgXCJjaGFsbGVuZ2VcIik7XG4gICAgICAgIHRoaXMubmRTa2luLnZpc2libGUgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAoIWdhbWUudXRpbHMuaXNQYWQoKSkge1xuICAgICAgICB2YXIgbm9kZSA9IFJlbW92ZUFkc0NvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICB0aGlzLnJvb3ROb2RlLmFkZENoaWxkKG5vZGUpO1xuICAgICAgICBpZiAoZ2FtZS51dGlscy5pc0lPU05vdGNoU2NyZWVuKCkpIHtcbiAgICAgICAgICAgIG5vZGUueSArPSA0MDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmIChnYW1lLmdhbWVNYW4uaXNDaGFsbGVuZ2VMZXZlbCkge1xuICAgICAgICB0aGlzLm5kUmVmcmVzaC52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMubmRDb250aW51ZUIudmlzaWJsZSA9IHRydWU7XG4gICAgICAgIHRoaXMubmRDb250aW51ZVMudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLm5kU3Rhci52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMubmRDbGFpbURpYW1vbmRzLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5uZENoYWxsZW5nZS52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5sYkNoYWxsZW5nZS5zZXRTdHJpbmcoZ2FtZS51dGlscy5zcHJpbnRmKF8oXCJjaGFsbGVuZ2VfdGl0bGVcIiksIGdhbWUuZ2FtZU1hbi5sZXZlbElkIC0gMSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubmRSZWZyZXNoLnZpc2libGUgPSB0cnVlO1xuICAgICAgICB0aGlzLm5kQ29udGludWVCLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5uZENvbnRpbnVlUy52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5uZFN0YXIudmlzaWJsZSA9IHRydWU7XG4gICAgICAgIHRoaXMubmRDaGFsbGVuZ2UudmlzaWJsZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIHZhciBEYWlseVRhc2tQb3MgPSByZXF1aXJlKFwiLi4vZW51bS9EYWlseVRhc2tQb3NcIik7XG4gICAgdGhpcy5uZEFjdGl2aXR5LmNvbnRyb2xsZXIuaW5pdFdpdGgoRGFpbHlUYXNrUG9zLlBhc3NFbik7XG5cbiAgICB0aGlzLm5kRnJlZURpYW1vbmRTaG9ydC52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5uZEZyZWVEaWFtb25kTG9uZy52aXNpYmxlID0gZmFsc2U7XG4gICAgaWYgKGdhbWUuYWN0aXZpdHlNYW4uaXNPcGVuKCkpIHtcbiAgICAgICAgdGhpcy5uZEZyZWVEaWFtb25kU2hvcnQudmlzaWJsZSA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5uZEZyZWVEaWFtb25kTG9uZy52aXNpYmxlID0gdHJ1ZTtcbiAgICB9XG59O1xuXG5QYXNzQ29udHJvbGxlci5wcm90b3R5cGUudXBkYXRlU2tpblByb2dyZXNzID0gZnVuY3Rpb24gKHBlcmNlbnQpIHtcbiAgICB2YXIgbGFzdFBlcmNlbnQgPSBnYW1lLnBsYXllck1hbi5wbGF5ZXIuc2tpblBlcmNlbnQ7XG4gICAgdmFyIG5vd1BlcmNlbnQgPSBNYXRoLm1pbihsYXN0UGVyY2VudCArIHBlcmNlbnQsIDEpO1xuICAgIC8vIHZhciBudW1BbmltID0gbGJsUHJvZ3Jlc3MuR2V0Q29tcG9uZW50PE51bWJlckFuaW1hdGlvbj4oKTtcbiAgICAvLyBudW1BbmltLkluaXQoXCJcIiwgXCIlXCIpO1xuICAgIHRoaXMuc3BUb3BTa2luID0gZ2FtZS51dGlscy5jcmVhdGVQcm9ncmVzc1RpbWVyKHRoaXMuc3BUb3BTa2luLCBmYWxzZSwgZmFsc2UpO1xuICAgIHRoaXMuc3BUb3BTa2luLnNldFBlcmNlbnRhZ2UobGFzdFBlcmNlbnQgKiAxMDApO1xuICAgIHRoaXMuc3BUb3BTa2luLnJ1bkFjdGlvbihjYy5wcm9ncmVzc1RvKDAuOCwgbm93UGVyY2VudCAqIDEwMCkpO1xuICAgIHRoaXMubGJsUHJvZ3Jlc3Muc2V0U3RyaW5nKFwiXCIgKyBNYXRoLnJvdW5kKG5vd1BlcmNlbnQgKiAxMDApICsgXCIlXCIpO1xuICAgIC8vIG51bUFuaW0uUGxheU51bUFuaW0oKGludCkobGFzdFBlcmNlbnQgKiAxMDApLCAoaW50KShub3dQZXJjZW50ICogMTAwKSwgKCkgPT4ge30pO1xuICAgIGdhbWUucGxheWVyTWFuLnNldFNraW5QZXJjZW50KG5vd1BlcmNlbnQpO1xufTtcblxuUGFzc0NvbnRyb2xsZXIucHJvdG90eXBlLmRvQWRkQWN0aXZpdHlUYXNrID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICghZ2FtZS5nYW1lTWFuLmlzSGFyZE1vZGUoKSkge1xuICAgICAgICBnYW1lLmFjdGl2aXR5TWFuLmFkZEFjdGl2aXR5VGFza0NvdW50KGdhbWUuYWN0aXZpdHlUYXNrVHlwZS5MZXZlbCk7XG4gICAgfVxufTtcblxuUGFzc0NvbnRyb2xsZXIucHJvdG90eXBlLmFjdGl2aXR5Q2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRXZlbnQoXCJEYWlseVRhc2tQYXNzQ2xpY2tcIik7XG4gICAgZ2FtZS5wb3B1cE1hbi5wb3B1cEFjdGl2aXR5VGFzaygpO1xufTtcblxuUGFzc0NvbnRyb2xsZXIucHJvdG90eXBlLmRvQ2xhaW1EaWFtb25kcyA9IGZ1bmN0aW9uIChjYikge1xuICAgIC8vZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJjb2luc19mbHlcIik7XG4gICAgdmFyIGRpYW1vbmRQb3MgPSB0aGlzLnNwUmV3YXJkRGlhbW9uZHMucGFyZW50LmNvbnZlcnRUb1dvcmxkU3BhY2UodGhpcy5zcFJld2FyZERpYW1vbmRzLmdldFBvc2l0aW9uKCkpO1xuICAgIHZhciBkaWFtbmRFbmRQb3MgPSB0aGlzLm5kRGlhbW9uZHMucGFyZW50LmNvbnZlcnRUb1dvcmxkU3BhY2UodGhpcy5uZERpYW1vbmRzLmdldFBvc2l0aW9uKCkpO1xuICAgIGdhbWUuZWZmZWN0TWFuLnBsYXlGbHlDb2lucyhkaWFtb25kUG9zLCBkaWFtbmRFbmRQb3MsIDEwLCA1MDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uYWRkRGlhbW9uZHMoZ2FtZS5nYW1lTWFuLmdldEN1cnJlbnRSZXdhcmREaWFtb25kcygpLCBcInBhc3NfbGV2ZWxcIik7XG4gICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAvL3RoaXMubmRDbGFpbURpYW1vbmRzLnJ1bkFjdGlvbihjYy5zZXF1ZW5jZShjYy5kZWxheVRpbWUoMSksIGNjLmZhZGVPdXQoMC4zKSkpO1xuICAgICAgICBjYiAmJiBjYigpO1xuICAgIH0uYmluZCh0aGlzKSk7XG59O1xuXG5QYXNzQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdFdpdGggPSBmdW5jdGlvbiAocmVwbGF5Q2FsbGJhY2ssIG5leHRDYWxsYmFjaykge1xuICAgIHRoaXMuX3JlcGxheUNhbGxiYWNrID0gcmVwbGF5Q2FsbGJhY2s7XG4gICAgdGhpcy5fbmV4dENhbGxiYWNrID0gbmV4dENhbGxiYWNrO1xufTtcblxuUGFzc0NvbnRyb2xsZXIucHJvdG90eXBlLm9uQW5pbUVuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm47XG4gICAgaWYgKCFnYW1lLmdhbWVNYW4uaXNOZXdQb3B1cCgpKSB7XG4gICAgICAgIGlmICghZ2FtZS5jaGFsbGVuZ2VNYW4uY2hlY2tBbmRTaG93Q2hhbGxlbmdlKCkpIHtcbiAgICAgICAgICAgIGlmICghZ2FtZS5nYW1lTWFuLmNoZWNrQW5kU2hvd0JveCgpKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNob3dlZFJhdGUgPSBHYW1lTWFuLmdldEluc3RhbmNlKCkuc2hvd1JhdGUoKTtcbiAgICAgICAgICAgICAgICBpZiAoIXNob3dlZFJhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFnYW1lLmdhbWVNYW4udHJ5U2hvd1Bhc3NQb3B1cCgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWdhbWUuZ2FtZU1hbi5pc05ld1Jlc3VsdCgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5hZHNIZWxwZXIuc2hvd1Bhc3NBZHMoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICghZ2FtZS5nYW1lTWFuLmlzTmV3UmVzdWx0KCkpIHtcbiAgICAgICAgICAgIHZhciBzaG93ZWRSYXRlID0gR2FtZU1hbi5nZXRJbnN0YW5jZSgpLnNob3dSYXRlKCk7XG4gICAgICAgICAgICBpZiAoIXNob3dlZFJhdGUpIHtcbiAgICAgICAgICAgICAgICBnYW1lLmFkc0hlbHBlci5zaG93UGFzc0FkcygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgR2FtZU1hbi5nZXRJbnN0YW5jZSgpLnNob3dSYXRlKCk7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG5QYXNzQ29udHJvbGxlci5wcm90b3R5cGUub25VcGRhdGVEaWFtb25kcyA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmxiRGlhbW9uZHMuc2V0U3RyaW5nKGdhbWUucGxheWVyTWFuLmdldERpYW1vbmRzKCkpO1xufTtcblxuUGFzc0NvbnRyb2xsZXIucHJvdG90eXBlLm5leHRDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIGdhbWUuYXVkaW9QbGF5ZXIucGxheUVmZmVjdEJ5S2V5KFwiZW50ZXJcIik7XG4gICAgaWYgKGdhbWUuZ2FtZU1hbi5pc05ld1BvcHVwKCkgJiYgIWdhbWUuZ2FtZU1hbi5pc0NoYWxsZW5nZUxldmVsKSB7XG4gICAgICAgIGlmICh0aGlzLmNsYWltaW5nKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jbGFpbWluZyA9IHRydWU7XG4gICAgICAgIHRoaXMuZG9DbGFpbURpYW1vbmRzKHRoaXMuYWZ0ZXJDbGFpbURpYW1vbmQuYmluZCh0aGlzKSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAodGhpcy5fbmV4dENhbGxiYWNrKSB7XG4gICAgICAgICAgICB0aGlzLl9uZXh0Q2FsbGJhY2soKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWdhbWUuZ2FtZU1hbi5pc0NoYWxsZW5nZUxldmVsKSB7XG4gICAgICAgICAgICBnYW1lLmFkc0hlbHBlci5zaG93UGFzc0FkcygpO1xuICAgICAgICAgICAgR2FtZU1hbi5nZXRJbnN0YW5jZSgpLnNob3dSZWdpc3Rlck5vdGlmaWNhdGlvbigpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG59O1xuXG5QYXNzQ29udHJvbGxlci5wcm90b3R5cGUuYWZ0ZXJDbGFpbURpYW1vbmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIGlmIChnYW1lLnBsYXllck1hbi5wbGF5ZXIuc2tpblBlcmNlbnQgPj0gMSkge1xuICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwU2tpblVubG9jayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRTa2luUGVyY2VudCgwKTtcbiAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLnNldFdhaXRTa2luSWQoMCk7XG4gICAgICAgICAgICBzZWxmLmFmdGVyR2V0U2tpbigpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHNlbGYuYWZ0ZXJHZXRTa2luKCk7XG4gICAgfVxufTtcblxuUGFzc0NvbnRyb2xsZXIucHJvdG90eXBlLmFmdGVyR2V0U2tpbiA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmNoYWxsZW5nZU1hbi5jaGVja0FuZFNob3dDaGFsbGVuZ2UobnVsbCwgdGhpcy5hZnRlckNoZWNrQ2hhbGxlbmdlLmJpbmQodGhpcykpO1xufTtcblxuUGFzc0NvbnRyb2xsZXIucHJvdG90eXBlLmFmdGVyQ2hlY2tDaGFsbGVuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKGdhbWUucGxheWVyTWFuLnBsYXllci5jdXJyZW50S2V5Q291bnQgPj0gMykge1xuICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwQm94KHRoaXMuYWZ0ZXJDbGFpbUJveC5iaW5kKHRoaXMpKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHRoaXMuYWZ0ZXJDbGFpbUJveCgpO1xuICAgIH1cbn07XG5cblBhc3NDb250cm9sbGVyLnByb3RvdHlwZS5hZnRlckNsYWltQm94ID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICh0aGlzLl9uZXh0Q2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5fbmV4dENhbGxiYWNrKCk7XG4gICAgfVxuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cblBhc3NDb250cm9sbGVyLnByb3RvdHlwZS5yZXN0YXJ0Q2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImVudGVyXCIpO1xuICAgIGdhbWUuYWRzSGVscGVyLnNob3dQYXNzQWRzKCk7XG4gICAgaWYgKHRoaXMuX3JlcGxheUNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX3JlcGxheUNhbGxiYWNrKCk7XG4gICAgfVxuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cblBhc3NDb250cm9sbGVyLnByb3RvdHlwZS5ob21lQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImVudGVyXCIpO1xuICAgIGlmIChnYW1lLmdhbWVNYW4uaXNDaGFsbGVuZ2VMZXZlbCkge1xuICAgICAgICBnYW1lLnNjZW5lTWFuLnN3aXRjaFNjZW5lKGdhbWUuc2NlbmVUeXBlLkNIQUxMRU5HRSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5NRU5VKTtcbiAgICB9XG4gICAgZ2FtZS5hZHNIZWxwZXIuc2hvd0JhY2tIb21lQWRzKCk7XG59O1xuXG5QYXNzQ29udHJvbGxlci5wcm90b3R5cGUucGtDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIGdhbWUuYXVkaW9QbGF5ZXIucGxheUVmZmVjdEJ5S2V5KFwiZW50ZXJcIik7XG4gICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5DSEFMTEVOR0VfTElTVCk7XG59O1xuXG5QYXNzQ29udHJvbGxlci5wcm90b3R5cGUuc2tpbkNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJlbnRlclwiKTtcbiAgICB2YXIgU3RvcmVUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vU3RvcmVUeXBlXCIpO1xuICAgIGdhbWUucG9wdXBNYW4ucG9wdXBTdG9yZURsZyhTdG9yZVR5cGUuU0tJTik7XG59O1xuXG5QYXNzQ29udHJvbGxlci5wcm90b3R5cGUud2F0Y2hBZHNDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIGdhbWUuYXVkaW9QbGF5ZXIucGxheUVmZmVjdEJ5S2V5KFwiZW50ZXJcIik7XG4gICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiUGFzc0ZyZWVEaWFtb25kc1wiKTtcbiAgICB2YXIgU3RvcmVIZWxwZXIgPSByZXF1aXJlKFwiLi4vbW9kZWwvU3RvcmVIZWxwZXJcIik7XG4gICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5jaGVja0FuZFNob3dSZXdhcmRWaWRlbyhnYW1lLnV0aWxzLmlzSU9TKCkgPyBcIndpbmdpZnRcIiA6IFwiamlsaTA1XCIsIG51bGwsIFwiV2luQW5kV2F0Y2hEaWFtb25kc0Fkc1wiKTtcbn07XG5cblBhc3NDb250cm9sbGVyLnByb3RvdHlwZS53aGVlbENsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiUGFzc1doZWVsXCIpO1xuICAgIHZhciBXaGVlbFR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9XaGVlbFR5cGVcIik7XG4gICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFdoZWVsRGxnKFdoZWVsVHlwZS5EYWlseUJvbnVzKTtcbn07XG5cblBhc3NDb250cm9sbGVyLnByb3RvdHlwZS5wb3B1cCA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIucG9wdXAodGhpcy5yb290Tm9kZSk7XG59O1xuXG5QYXNzQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLmNsb3NlKHRoaXMucm9vdE5vZGUpO1xufTtcblxuUGFzc0NvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBub2RlID0gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvbm90aWNlL3Bhc3Nfdmlldy5jY2JpXCIsIG51bGwsIFwiUGFzc0NvbnRyb2xsZXJcIiwgbmV3IFBhc3NDb250cm9sbGVyKCkpO1xuICAgIHJldHVybiBub2RlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBQYXNzQ29udHJvbGxlcjsiLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAyMDE3LzEyLzE1LlxuICovXG52YXIgQWRzUGxhY2UgPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uL2VudW0vQWRzUGxhY2VcIik7XG52YXIgRGlhbW9uZHNDb250cm9sbGVyID0gcmVxdWlyZShcIi4uL2NvbnRyb2xsZXIvRGlhbW9uZHNDb250cm9sbGVyXCIpO1xudmFyIEFkc1JlbWluZGVyQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL0Fkc1JlbWluZGVyQ29udHJvbGxlclwiKTtcblxudmFyIFBhdXNlQ25Db250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG4gICAgLy8gdGhpcy5sYmxSZXdhcmQgPSBudWxsO1xuXG4gICAgLy8gdGhpcy5uZEFkUmVtaW5kZXIgPSBudWxsO1xuICAgIHRoaXMubmREaWFtb25kcyA9IG51bGw7XG5cbiAgICB0aGlzLm5kUmVmcmVzaCA9IG51bGw7XG5cbiAgICB0aGlzLm5kQ29udGludWVCID0gbnVsbDtcbiAgICB0aGlzLm5kQ29udGludWVTID0gbnVsbDtcblxuICAgIHRoaXMubGJsTXVsdGkgPSBudWxsO1xuXG4gICAgdGhpcy5fcmVwbGF5Q2FsbGJhY2sgPSBudWxsO1xuICAgIHRoaXMuX25leHRDYWxsYmFjayA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKFBhdXNlQ25Db250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cblBhdXNlQ25Db250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5fcmVzdW1lQ2FsbGJhY2sgPSBudWxsO1xuICAgIC8vIGdhbWUuZXZlbnREaXNwYXRjaGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJkaWFsb2dfcG9wZWRcIiwgdGhpcy5vbkRpYWxvZ1BvcGVkLCB0aGlzKTtcbiAgICAvLyBnYW1lLmV2ZW50RGlzcGF0Y2hlci5yZW1vdmVFdmVudExpc3RlbmVyKFwiZGlhbG9nX2Nsb3NlZFwiLCB0aGlzLm9uRGlhbG9nQ2xvc2VkLCB0aGlzKTtcbiAgICAvLyB0aGlzLnJlbW92ZU5hdGl2ZUFkKCk7XG59O1xuXG5QYXVzZUNuQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAvLyBnYW1lLmV2ZW50RGlzcGF0Y2hlci5hZGRFdmVudExpc3RlbmVyKFwiZGlhbG9nX3BvcGVkXCIsIHRoaXMub25EaWFsb2dQb3BlZCwgdGhpcyk7XG4gICAgLy8gZ2FtZS5ldmVudERpc3BhdGNoZXIuYWRkRXZlbnRMaXN0ZW5lcihcImRpYWxvZ19jbG9zZWRcIiwgdGhpcy5vbkRpYWxvZ0Nsb3NlZCwgdGhpcyk7XG4gICAgLy90aGlzLnNob3dOYXRpdmVBZCgpO1xufTtcbi8vXG4vLyBQYXVzZUNuQ29udHJvbGxlci5wcm90b3R5cGUub25EaWFsb2dQb3BlZCA9IGZ1bmN0aW9uICgpIHtcbi8vICAgICB0aGlzLnVwZGF0ZU5hdGl2ZUFkKCk7XG4vLyB9O1xuLy9cbi8vIFBhdXNlQ25Db250cm9sbGVyLnByb3RvdHlwZS5vbkRpYWxvZ0Nsb3NlZCA9IGZ1bmN0aW9uICgpIHtcbi8vICAgICB0aGlzLnVwZGF0ZU5hdGl2ZUFkKCk7XG4vLyB9O1xuLy9cbi8vIFBhdXNlQ25Db250cm9sbGVyLnByb3RvdHlwZS51cGRhdGVOYXRpdmVBZCA9IGZ1bmN0aW9uICgpIHtcbi8vICAgICBpZiAoZ2FtZS5kaWFsb2dNYW5hZ2VyLmlzVG9wZXN0RGlhbG9nKHRoaXMucm9vdE5vZGUpKSB7XG4vLyAgICAgICAgIHRoaXMuc2hvd05hdGl2ZUFkKCk7XG4vLyAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgdGhpcy5yZW1vdmVOYXRpdmVBZCgpO1xuLy8gICAgIH1cbi8vIH07XG4vL1xuLy8gUGF1c2VDbkNvbnRyb2xsZXIucHJvdG90eXBlLnNob3dOYXRpdmVBZCA9IGZ1bmN0aW9uICgpIHtcbi8vICAgICBnYW1lLmFkc01hbmFnZXIuc2hvd05hdGl2ZUFkKFwicGF1c2VcIiwgMCwgOTkpO1xuLy8gICAgIC8vIGdhbWUuY3Jvc3NQcm9tTWFuLnNob3dDcm9zc1Byb21BZChjYy5wKGNjLndpblNpemUud2lkdGggKiAwLjUsIGNjLndpblNpemUuaGVpZ2h0ICogMC41ICsgOTkpLCBjYy5zaXplKDMwMCwgMzAwKSk7XG4vLyB9O1xuLy9cbi8vIFBhdXNlQ25Db250cm9sbGVyLnByb3RvdHlwZS5yZW1vdmVOYXRpdmVBZCA9IGZ1bmN0aW9uICgpIHtcbi8vICAgICBnYW1lLmFkc01hbmFnZXIucmVtb3ZlTmF0aXZlQWQoXCJwYXVzZVwiKTtcbi8vICAgICAvLyBnYW1lLmNyb3NzUHJvbU1hbi5yZW1vdmVDcm9zc1Byb21BZCgpO1xuLy8gfTtcblxuUGF1c2VDbkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcbiAgICAvLyB0aGlzLmxibFJld2FyZC5zZXRTdHJpbmcoXyhcIndhdGNoX2Fkc19nZXRfYm9vc3RzXCIpKTtcbiAgICAvLyB0aGlzLm5kQWRSZW1pbmRlci5hZGRDaGlsZChBZHNSZW1pbmRlckNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpKTtcbiAgICB0aGlzLm5kRGlhbW9uZHMuYWRkQ2hpbGQoRGlhbW9uZHNDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKSk7XG5cbiAgICB0aGlzLmxibE11bHRpLnNldFN0cmluZyhnYW1lLnV0aWxzLnNwcmludGYoXyhcIm11bHRpX2RpYW1vbmRzX3RpdGxlXCIpLFxuICAgICAgICBnYW1lLmNvbmZpZy5tdWx0aURpYW1vbmRzUmFuZ2VbMF0sXG4gICAgICAgIGdhbWUuY29uZmlnLm11bHRpRGlhbW9uZHNSYW5nZVsxXSkpO1xuXG4gICAgaWYgKGdhbWUuZ2FtZU1hbi5pc0NoYWxsZW5nZUxldmVsKSB7XG4gICAgICAgIHRoaXMubmRSZWZyZXNoLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5uZENvbnRpbnVlQi52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5uZENvbnRpbnVlUy52aXNpYmxlID0gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5uZFJlZnJlc2gudmlzaWJsZSA9IHRydWU7XG4gICAgICAgIHRoaXMubmRDb250aW51ZUIudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLm5kQ29udGludWVTLnZpc2libGUgPSB0cnVlO1xuICAgIH1cbiAgICB2YXIgUmV3YXJkUmVtb3ZlQWRDb250cm9sbGVyID0gcmVxdWlyZShcIi4vUmV3YXJkUmVtb3ZlQWRDb250cm9sbGVyXCIpO1xuICAgIHRoaXMubmRSZXdhcmRSZW1vdmVBZHMuYWRkQ2hpbGQoUmV3YXJkUmVtb3ZlQWRDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKSk7XG59O1xuXG5QYXVzZUNuQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdFdpdGggPSBmdW5jdGlvbiAocmVzdW1lQ2FsbGJhY2spIHtcbiAgICB0aGlzLl9yZXN1bWVDYWxsYmFjayA9IHJlc3VtZUNhbGxiYWNrO1xufTtcblxuUGF1c2VDbkNvbnRyb2xsZXIucHJvdG90eXBlLnJlc3VtZUNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJlbnRlclwiKTtcbiAgICBpZiAodGhpcy5fcmVzdW1lQ2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5fcmVzdW1lQ2FsbGJhY2soKTtcbiAgICB9XG4gICAgdGhpcy5jbG9zZSgpO1xufTtcblxuUGF1c2VDbkNvbnRyb2xsZXIucHJvdG90eXBlLmhvbWVDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIGdhbWUuYXVkaW9QbGF5ZXIucGxheUVmZmVjdEJ5S2V5KFwiZW50ZXJcIik7XG4gICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiUGF1c2VIb21lXCIpO1xuICAgIGlmIChnYW1lLmdhbWVNYW4uaXNDaGFsbGVuZ2VMZXZlbCkge1xuICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwWWVzTm9Db21tb25EbGcoXyhcImNoYWxsZW5nZV9sZWF2ZV90aXBzXCIpLCBfKFwieWVzX3RpdGxlXCIpLCBfKFwibm9fdGl0bGVcIiksIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGdhbWUuYWRzSGVscGVyLnNob3dCYWNrSG9tZUFkcygpO1xuICAgICAgICAgICAgZ2FtZS5jaGFsbGVuZ2VNYW4ucm9sbEJhY2tQcm9ncmVzcygpO1xuICAgICAgICAgICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5DSEFMTEVOR0UpO1xuICAgICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwWWVzTm9Db21tb25EbGcoXyhcImV4aXRfZ2FtZV9jb25maXJtXCIpLCBfKFwieWVzX3RpdGxlXCIpLCBfKFwibm9fdGl0bGVcIiksIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGdhbWUuYWRzSGVscGVyLnNob3dCYWNrSG9tZUFkcygpO1xuICAgICAgICAgICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5NRU5VKTtcbiAgICAgICAgfSk7XG4gICAgfVxufTtcblxuUGF1c2VDbkNvbnRyb2xsZXIucHJvdG90eXBlLnJlc3RhcnRDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIGdhbWUuYXVkaW9QbGF5ZXIucGxheUVmZmVjdEJ5S2V5KFwiZW50ZXJcIik7XG4gICAgZ2FtZS5nYW1lTWFuLmFkZEZhaWxDb3VudCgpO1xuICAgIGdhbWUuc2NlbmVNYW4uc3dpdGNoU2NlbmUoZ2FtZS5zY2VuZVR5cGUuR0FNRSk7XG4gICAgZ2FtZS5hZHNIZWxwZXIuc2hvd1JlZnJlc2hBZHMoKTtcbiAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRXZlbnQoXCJQYXVzZVJldHJ5XCIpO1xufTtcblxuUGF1c2VDbkNvbnRyb2xsZXIucHJvdG90eXBlLndhdGNoQWRzTXVsdGlDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIGdhbWUuYXVkaW9QbGF5ZXIucGxheUVmZmVjdEJ5S2V5KFwiZW50ZXJcIik7XG4gICAgdmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xuICAgIFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuY2hlY2tBbmRHZXRSYW5kb21EaWFtb25kcyhcImRpYW1vbmRzX3JhbmRvbV9wYXVzZVwiKTtcbn07XG5cblBhdXNlQ25Db250cm9sbGVyLnByb3RvdHlwZS5wb3B1cCA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIucG9wdXAodGhpcy5yb290Tm9kZSk7XG59O1xuXG5QYXVzZUNuQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLmNsb3NlKHRoaXMucm9vdE5vZGUpO1xufTtcblxuUGF1c2VDbkNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBub2RlID0gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvbm90aWNlL3BhdXNlX3ZpZXdfMS5jY2JpXCIsIG51bGwsIFwiUGF1c2VDbkNvbnRyb2xsZXJcIiwgbmV3IFBhdXNlQ25Db250cm9sbGVyKCkpO1xuICAgIHJldHVybiBub2RlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBQYXVzZUNuQ29udHJvbGxlcjsiLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAyMDE3LzEyLzE1LlxuICovXG52YXIgQWRzUGxhY2UgPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uL2VudW0vQWRzUGxhY2VcIik7XG52YXIgRGlhbW9uZHNDb250cm9sbGVyID0gcmVxdWlyZShcIi4uL2NvbnRyb2xsZXIvRGlhbW9uZHNDb250cm9sbGVyXCIpO1xudmFyIEFkc1JlbWluZGVyQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL0Fkc1JlbWluZGVyQ29udHJvbGxlclwiKTtcblxudmFyIFBhdXNlQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuICAgIHRoaXMubGJsUmV3YXJkID0gbnVsbDtcblxuICAgIHRoaXMubmRBZFJlbWluZGVyID0gbnVsbDtcbiAgICB0aGlzLm5kRGlhbW9uZHMgPSBudWxsO1xuXG4gICAgdGhpcy5uZFJlZnJlc2ggPSBudWxsO1xuXG4gICAgdGhpcy5uZENvbnRpbnVlQiA9IG51bGw7XG4gICAgdGhpcy5uZENvbnRpbnVlUyA9IG51bGw7XG5cbiAgICB0aGlzLl9yZXBsYXlDYWxsYmFjayA9IG51bGw7XG4gICAgdGhpcy5fbmV4dENhbGxiYWNrID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoUGF1c2VDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cblBhdXNlQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0ID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuX3Jlc3VtZUNhbGxiYWNrID0gbnVsbDtcbn07XG5cblBhdXNlQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlciA9IGZ1bmN0aW9uICgpIHtcbn07XG5cblBhdXNlQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuICAgIHRoaXMubGJsUmV3YXJkLnNldFN0cmluZyhfKFwid2F0Y2hfYWRzX2dldF9ib29zdHNcIikpO1xuICAgIHRoaXMubmRBZFJlbWluZGVyLmFkZENoaWxkKEFkc1JlbWluZGVyQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCkpO1xuICAgIHRoaXMubmREaWFtb25kcy5hZGRDaGlsZChEaWFtb25kc0NvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpKTtcblxuICAgIGlmIChnYW1lLmdhbWVNYW4uaXNDaGFsbGVuZ2VMZXZlbCkge1xuICAgICAgICB0aGlzLm5kUmVmcmVzaC52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMubmRDb250aW51ZUIudmlzaWJsZSA9IHRydWU7XG4gICAgICAgIHRoaXMubmRDb250aW51ZVMudmlzaWJsZSA9IGZhbHNlO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubmRSZWZyZXNoLnZpc2libGUgPSB0cnVlO1xuICAgICAgICB0aGlzLm5kQ29udGludWVCLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5uZENvbnRpbnVlUy52aXNpYmxlID0gdHJ1ZTtcbiAgICB9XG59O1xuXG5QYXVzZUNvbnRyb2xsZXIucHJvdG90eXBlLmluaXRXaXRoID0gZnVuY3Rpb24gKHJlc3VtZUNhbGxiYWNrKSB7XG4gICAgdGhpcy5fcmVzdW1lQ2FsbGJhY2sgPSByZXN1bWVDYWxsYmFjaztcbn07XG5cblBhdXNlQ29udHJvbGxlci5wcm90b3R5cGUucmVzdW1lQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImVudGVyXCIpO1xuICAgIGlmICh0aGlzLl9yZXN1bWVDYWxsYmFjaykge1xuICAgICAgICB0aGlzLl9yZXN1bWVDYWxsYmFjaygpO1xuICAgIH1cbiAgICB0aGlzLmNsb3NlKCk7XG59O1xuXG5QYXVzZUNvbnRyb2xsZXIucHJvdG90eXBlLmhvbWVDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIGdhbWUuYXVkaW9QbGF5ZXIucGxheUVmZmVjdEJ5S2V5KFwiZW50ZXJcIik7XG4gICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiUGF1c2VIb21lXCIpO1xuICAgIGlmIChnYW1lLmdhbWVNYW4uaXNDaGFsbGVuZ2VMZXZlbCkge1xuICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwWWVzTm9Db21tb25EbGcoXyhcImNoYWxsZW5nZV9sZWF2ZV90aXBzXCIpLCBfKFwieWVzX3RpdGxlXCIpLCBfKFwibm9fdGl0bGVcIiksIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGdhbWUuYWRzSGVscGVyLnNob3dCYWNrSG9tZUFkcygpO1xuICAgICAgICAgICAgZ2FtZS5jaGFsbGVuZ2VNYW4ucm9sbEJhY2tQcm9ncmVzcygpO1xuICAgICAgICAgICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5DSEFMTEVOR0UpO1xuICAgICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwWWVzTm9Db21tb25EbGcoXyhcImV4aXRfZ2FtZV9jb25maXJtXCIpLCBfKFwieWVzX3RpdGxlXCIpLCBfKFwibm9fdGl0bGVcIiksIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGdhbWUuYWRzSGVscGVyLnNob3dCYWNrSG9tZUFkcygpO1xuICAgICAgICAgICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5NRU5VKTtcbiAgICAgICAgfSk7XG4gICAgfVxufTtcblxuUGF1c2VDb250cm9sbGVyLnByb3RvdHlwZS5yZXN0YXJ0Q2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImVudGVyXCIpO1xuICAgIGdhbWUuZ2FtZU1hbi5hZGRGYWlsQ291bnQoKTtcbiAgICBnYW1lLnNjZW5lTWFuLnN3aXRjaFNjZW5lKGdhbWUuc2NlbmVUeXBlLkdBTUUpO1xuICAgIGdhbWUuYWRzSGVscGVyLnNob3dSZWZyZXNoQWRzKCk7XG4gICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiUGF1c2VSZXRyeVwiKTtcbn07XG5cblBhdXNlQ29udHJvbGxlci5wcm90b3R5cGUud2F0Y2hBZHNDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIGdhbWUuYXVkaW9QbGF5ZXIucGxheUVmZmVjdEJ5S2V5KFwiZW50ZXJcIik7XG4gICAgdmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xuICAgIFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuY2hlY2tBbmRTaG93UmV3YXJkVmlkZW8oZ2FtZS51dGlscy5pc0lPUygpID8gXCJwYXVzZVwiIDogXCJwYXVzZVwiKTtcbn07XG5cblBhdXNlQ29udHJvbGxlci5wcm90b3R5cGUucG9wdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLnBvcHVwKHRoaXMucm9vdE5vZGUpO1xufTtcblxuUGF1c2VDb250cm9sbGVyLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIuY2xvc2UodGhpcy5yb290Tm9kZSk7XG59O1xuXG5QYXVzZUNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBub2RlID0gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvbm90aWNlL3BhdXNlX3ZpZXcuY2NiaVwiLCBudWxsLCBcIlBhdXNlQ29udHJvbGxlclwiLCBuZXcgUGF1c2VDb250cm9sbGVyKCkpO1xuICAgIHJldHVybiBub2RlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBQYXVzZUNvbnRyb2xsZXI7IiwiLy92YXIgU2tpbkl0ZW1Db250cm9sbGVyID0gcmVxdWlyZShcIi4vU2tpbkl0ZW1Db250cm9sbGVyXCIpO1xuLy92YXIgQ29uZmlnTWFuID0gcmVxdWlyZShcIi4uL2NvbmZpZy9Db25maWdNYW5cIik7XG4vL3ZhciBFdmVudHNOYW1lID0gcmVxdWlyZShcIi4uL2V2ZW50cy9FdmVudHNOYW1lXCIpO1xuLy9cbi8vdmFyIEdSSURfU0laRSA9IGNjLnNpemUoMzUwLCA1MDApO1xuLy9cbi8vdmFyIFN0b3JlSXRlbUNlbGxWaWV3ID0gY2MuVGFibGVWaWV3Q2VsbC5leHRlbmQoe1xuLy8gICAgZW50aXR5OiBudWxsLFxuLy8gICAgaXRlbU5vZGU6IG51bGwsXG4vLyAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4vLyAgICAgICAgdGhpcy5fc3VwZXIoKTtcbi8vICAgICAgICB0aGlzLml0ZW1Ob2RlID0gU2tpbkl0ZW1Db250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbi8vICAgICAgICB0aGlzLmFkZENoaWxkKHRoaXMuaXRlbU5vZGUpO1xuLy8gICAgICAgIHRoaXMuaXRlbU5vZGUuc2V0UG9zaXRpb24oY2MucChHUklEX1NJWkUud2lkdGggKiAwLjUsIEdSSURfU0laRS5oZWlnaHQgKiAwLjUpKTtcbi8vICAgIH0sXG4vL1xuLy8gICAgaW5pdFdpdGg6IGZ1bmN0aW9uIChlbnRpdHksIGlkeCwgaW5pdGVkKSB7XG4vLyAgICAgICAgdGhpcy5lbnRpdHkgPSBlbnRpdHk7XG4vLyAgICAgICAgdGhpcy5pdGVtTm9kZS5jb250cm9sbGVyLmluaXRXaXRoKGVudGl0eSwgaWR4KTtcbi8vICAgIH1cbi8vfSk7XG52YXIgUmFua1R5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9SYW5rVHlwZVwiKTtcblxudmFyIFJhbmtDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG4gICAgdGhpcy5uZENvbnRhaW5lciA9IG51bGw7XG4gICAgdGhpcy5sYmxUaXRsZSA9IG51bGw7XG5cbiAgICB0aGlzLnJhbmtUeXBlID0gMDtcblxuICAgIHRoaXMudXBkYXRlQ291bnQgPSAwO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhSYW5rQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5SYW5rQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlci5jYWxsKHRoaXMpO1xuICAgIC8vdGhpcy5yb290Tm9kZS5zY2hlZHVsZSh0aGlzLm9uVXBkYXRlLmJpbmQodGhpcykpO1xuICAgIHRoaXMuaW50ZXJ2YWxLZXkgPSBzZXRJbnRlcnZhbCh0aGlzLm9uVXBkYXRlLmJpbmQodGhpcyksIDUwMCk7XG59O1xuXG5SYW5rQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0ID0gZnVuY3Rpb24gKCkge1xuICAgIC8vdGhpcy5yb290Tm9kZS51bnNjaGVkdWxlKHRoaXMub25VcGRhdGUuYmluZCh0aGlzKSk7XG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsS2V5KTtcbiAgICBpZiAodGhpcy5jbG9zZUNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuY2xvc2VDYWxsYmFjaygpO1xuICAgIH1cbiAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBudWxsO1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQuY2FsbCh0aGlzKTtcbn07XG5cblJhbmtDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG4gICAgLy8vL29uZXd4LnNvY2lhbC5sb2FkU2hhcmVDYW52YXModGhpcy5uZENvbnRhaW5lcik7XG4gICAgLy90aGlzLm9uVXBkYXRlKDApO1xufTtcblxuUmFua0NvbnRyb2xsZXIucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAocmFua1R5cGUsIGNsb3NlQ2FsbGJhY2spIHtcbiAgICB0aGlzLnJhbmtUeXBlID0gcmFua1R5cGU7XG4gICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gY2xvc2VDYWxsYmFjaztcbiAgICBpZiAocmFua1R5cGUgPT09IFJhbmtUeXBlLkZyaWVuZHMpIHtcbiAgICAgICAgdGhpcy5sYmxUaXRsZS5zZXRTdHJpbmcoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcImZyaWVuZHNfcmFua190aXRsZVwiKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5sYmxUaXRsZS5zZXRTdHJpbmcoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcImdyb3VwX3JhbmtfdGl0bGVcIikpO1xuICAgIH1cbiAgICBpZiAodGhpcy5yYW5rVHlwZSA9PT0gUmFua1R5cGUuRnJpZW5kcykge1xuICAgICAgICBvbmV3eC5zb2NpYWwuaW5pdEZyaWVuZCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIG9uZXd4LnNvY2lhbC5pbml0R3JvdXAoKTtcbiAgICB9XG4gICAgdGhpcy5yZWZyZXNoUmFuaygpO1xufTtcblxuUmFua0NvbnRyb2xsZXIucHJvdG90eXBlLnJlZnJlc2hSYW5rID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMudXBkYXRlQ291bnQgPSAwO1xuICAgIHRoaXMub25VcGRhdGUoMCk7XG59O1xuXG5SYW5rQ29udHJvbGxlci5wcm90b3R5cGUub25VcGRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHRoaXMudXBkYXRlQ291bnQgPD0gMTApIHtcbiAgICAgICAgb25ld3guc29jaWFsLmxvYWRTaGFyZUNhbnZhcyh0aGlzLm5kQ29udGFpbmVyKTtcbiAgICAgICAgdGhpcy51cGRhdGVDb3VudCsrO1xuICAgIH1cbn07XG5cblJhbmtDb250cm9sbGVyLnByb3RvdHlwZS5wcmV2Q2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBvbmV3eC5zb2NpYWwub25QYWdlQ2hhbmdlKHRoaXMubmRDb250YWluZXIsIC0xKTtcbiAgICB0aGlzLnJlZnJlc2hSYW5rKCk7XG59O1xuXG5SYW5rQ29udHJvbGxlci5wcm90b3R5cGUubmV4dENsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgb25ld3guc29jaWFsLm9uUGFnZUNoYW5nZSh0aGlzLm5kQ29udGFpbmVyLCAxKTtcbiAgICB0aGlzLnJlZnJlc2hSYW5rKCk7XG59O1xuXG5SYW5rQ29udHJvbGxlci5wcm90b3R5cGUuYmFja0NsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG5cbiAgICB0aGlzLmNsb3NlKCk7XG59O1xuXG5SYW5rQ29udHJvbGxlci5wcm90b3R5cGUuY2hhbGxlbmdlQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICBnYW1lLnNjZW5lTWFuLnN3aXRjaFNjZW5lKGdhbWUuc2NlbmVUeXBlLkdBTUUpO1xufTtcblxuUmFua0NvbnRyb2xsZXIucHJvdG90eXBlLnBvcHVwID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5wb3B1cCh0aGlzLnJvb3ROb2RlKTtcbn07XG5cblJhbmtDb250cm9sbGVyLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIuY2xvc2UodGhpcy5yb290Tm9kZSk7XG59O1xuXG5SYW5rQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9tZW51L3Jhbmtfdmlldy5jY2JpXCIsIG51bGwsIFwiUmFua0NvbnRyb2xsZXJcIiwgbmV3IFJhbmtDb250cm9sbGVyKCkpO1xuICAgIHJldHVybiBub2RlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBSYW5rQ29udHJvbGxlcjsiLCJ2YXIgRXZlbnRzTmFtZSA9IHJlcXVpcmUoXCIuLi9ldmVudHMvRXZlbnRzTmFtZVwiKTtcblxudmFyIFJlbW92ZUFkc0NvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoUmVtb3ZlQWRzQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5SZW1vdmVBZHNDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG4gICAgdGhpcy5yb290Tm9kZS52aXNpYmxlID0gZmFsc2U7XG59O1xuXG5SZW1vdmVBZHNDb250cm9sbGVyLnByb3RvdHlwZS5yZW1vdmVBZHNDbGlja2VkID0gZnVuY3Rpb24gKCkge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIHZhciBTdG9yZVR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9TdG9yZVR5cGVcIik7XG4gICAgdmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xuICAgIHZhciByZW1vdmVBZEVudGl0eSA9IFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuZ2V0U3RvcmVFbnRpdHlCeVR5cGUoU3RvcmVUeXBlLlJFTU9WRV9BRFMpO1xuICAgIFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuYnV5UHJvZHVjdChyZW1vdmVBZEVudGl0eSk7XG59O1xuXG5SZW1vdmVBZHNDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL21lbnUvcmVtb3ZlX2Fkc192aWV3LmNjYmlcIiwgbnVsbCwgXCJSZW1vdmVBZHNDb250cm9sbGVyXCIsIG5ldyBSZW1vdmVBZHNDb250cm9sbGVyKCksIHRydWUpO1xuICAgIHJldHVybiBub2RlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBSZW1vdmVBZHNDb250cm9sbGVyOyIsInZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcblxudmFyIFJld2FyZERvdWJsZUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcblxuICAgIHRoaXMuX3RpdGxlTGFiZWwgPSBudWxsO1xuXG4gICAgdGhpcy5sYlJld2FyZCA9IG51bGw7XG4gICAgdGhpcy5zcFJld2FyZCA9IG51bGw7XG4gICAgdGhpcy5zcFJld2FyZEJnID0gbnVsbDtcblxuICAgIC8vdGhpcy5idG5DbG9zZUNuID0gbnVsbDtcbiAgICAvL3RoaXMuYnRuQ2xvc2VFbiA9IG51bGw7XG5cbiAgICB0aGlzLmxiRG91YmxlID0gbnVsbDtcblxuICAgIHRoaXMuY2xvc2VDYWxsYmFjayA9IG51bGw7XG5cbiAgICB0aGlzLmRvdWJsZWQgPSBmYWxzZTtcbiAgICB0aGlzLnJld2FyZE5hbWUgPSBcIlwiO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhSZXdhcmREb3VibGVDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cblJld2FyZERvdWJsZUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcbiAgICAvL3RoaXMuYnRuQ2xvc2VDbi52aXNpYmxlID0gZmFsc2U7XG4gICAgLy90aGlzLmJ0bkNsb3NlRW4udmlzaWJsZSA9IGZhbHNlO1xuICAgIC8vdGhpcy5zcFRpdGxlQ24udmlzaWJsZSA9IGZhbHNlO1xuICAgIC8vdGhpcy5zcFRpdGxlRW4udmlzaWJsZSA9IGZhbHNlO1xuICAgIC8vaWYgKGdhbWUubG9jYWwuaXNDaGluZXNlKCkpIHtcbiAgICAvLyAgICB0aGlzLmJ0bkNsb3NlQ24udmlzaWJsZSA9IHRydWU7XG4gICAgLy8gICAgLy90aGlzLnNwVGl0bGVDbi52aXNpYmxlID0gdHJ1ZTtcbiAgICAvL30gZWxzZSB7XG4gICAgLy8gICAgdGhpcy5idG5DbG9zZUVuLnZpc2libGUgPSB0cnVlO1xuICAgIC8vICAgIC8vdGhpcy5zcFRpdGxlRW4udmlzaWJsZSA9IHRydWU7XG4gICAgLy99XG4gICAgdGhpcy5sYkRvdWJsZS5zZXRTdHJpbmcoXyhcImRvdWJsZV9yZXdhcmRzXCIpKTtcblxuICAgIGdhbWUuYXVkaW9QbGF5ZXIucGxheUVmZmVjdEJ5S2V5KFwiZ2V0X2RpYW1vbmRzXCIpO1xufTtcblxuUmV3YXJkRG91YmxlQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uIChpbWFnZSwgY291bnQsIHJld2FyZE5hbWUsIGNsb3NlQ2FsbGJhY2spIHtcbiAgICBjb25zb2xlLmxvZyhcIlJld2FyZERvdWJsZUNvbnRyb2xsZXIucHJvdG90eXBlLmluaXRcIik7XG4gICAgdGhpcy5zcFJld2FyZC5zZXRTcHJpdGVGcmFtZShpbWFnZSk7XG4gICAgdGhpcy5sYlJld2FyZC5zZXRTdHJpbmcoXCJYXCIgKyBjb3VudCk7XG4gICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gY2xvc2VDYWxsYmFjaztcbiAgICB0aGlzLnJld2FyZE5hbWUgPSByZXdhcmROYW1lO1xuXG4gICAgdGhpcy5zcFJld2FyZEJnLnJ1bkFjdGlvbihjYy5yb3RhdGVCeSgyLCAzNjApLnJlcGVhdEZvcmV2ZXIoKSk7XG59O1xuXG5SZXdhcmREb3VibGVDb250cm9sbGVyLnByb3RvdHlwZS5jbG9zZUNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgdGhpcy5jbG9zZSgpO1xufTtcblxuUmV3YXJkRG91YmxlQ29udHJvbGxlci5wcm90b3R5cGUud2F0Y2hBZHNDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBTdG9yZUhlbHBlci5nZXRJbnN0YW5jZSgpLmNoZWNrQW5kU2hvd1Jld2FyZFZpZGVvKHRoaXMucmV3YXJkTmFtZSwgZnVuY3Rpb24gKHJld2FyZGVkKSB7XG4gICAgICAgIGlmIChyZXdhcmRlZCkge1xuICAgICAgICAgICAgc2VsZi5kb3VibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHNlbGYuY2xvc2UoKTtcbiAgICAgICAgfVxuICAgIH0pO1xufTtcblxuUmV3YXJkRG91YmxlQ29udHJvbGxlci5wcm90b3R5cGUucG9wdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLnBvcHVwKHRoaXMucm9vdE5vZGUsIHtvdmVybGF5T3BhY2l0eTogMjEwfSk7XG59O1xuXG5SZXdhcmREb3VibGVDb250cm9sbGVyLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIuY2xvc2UodGhpcy5yb290Tm9kZSk7XG4gICAgaWYgKHRoaXMuY2xvc2VDYWxsYmFjaykge1xuICAgICAgICB0aGlzLmNsb3NlQ2FsbGJhY2sodGhpcy5kb3VibGVkKTtcbiAgICAgICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gbnVsbDtcbiAgICB9XG59O1xuXG5SZXdhcmREb3VibGVDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL25vdGljZS9yZXdhcmRfZG91YmxlX3ZpZXcuY2NiaVwiLCBudWxsLCBcIlJld2FyZERvdWJsZUNvbnRyb2xsZXJcIiwgbmV3IFJld2FyZERvdWJsZUNvbnRyb2xsZXIoKSk7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFJld2FyZERvdWJsZUNvbnRyb2xsZXI7IiwidmFyIFdoZWVsID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi93aGVlbC9XaGVlbFwiKTtcbnZhciBDb25maWdNYW4gPSByZXF1aXJlKFwiLi4vY29uZmlnL0NvbmZpZ01hblwiKTtcbnZhciBCb29zdFR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9Cb29zdFR5cGVcIik7XG52YXIgU3RvcmVIZWxwZXIgPSByZXF1aXJlKFwiLi4vbW9kZWwvU3RvcmVIZWxwZXJcIik7XG52YXIgR2FtZU1hbiA9IHJlcXVpcmUoXCIuLi9tb2RlbC9HYW1lTWFuXCIpO1xudmFyIFdoZWVsVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1doZWVsVHlwZVwiKTtcbnZhciBDYXJkSXRlbUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi9DYXJkSXRlbUNvbnRyb2xsZXJcIik7XG52YXIgUmV3YXJkVmlldyA9IHJlcXVpcmUoXCIuLi92aWV3L1Jld2FyZFZpZXdcIik7XG52YXIgUmV3YXJkSXRlbUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi9SZXdhcmRJdGVtQ29udHJvbGxlclwiKTtcblxudmFyIFJld2FyZEdldENvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcbiAgICB0aGlzLm5kUmV3YXJkID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoUmV3YXJkR2V0Q29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5SZXdhcmRHZXRDb250cm9sbGVyLnByb3RvdHlwZS5vbkVudGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkVudGVyLmNhbGwodGhpcyk7XG59O1xuXG5SZXdhcmRHZXRDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRXhpdC5jYWxsKHRoaXMpO1xuICAgIGlmICh0aGlzLmNsb3NlQ2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5jbG9zZUNhbGxiYWNrKCk7XG4gICAgfVxufTtcblxuUmV3YXJkR2V0Q29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG4gICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJnZXRfZGlhbW9uZHNcIik7XG59O1xuXG5SZXdhcmRHZXRDb250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aFJld2FyZHMgPSBmdW5jdGlvbiAocmV3YXJkcywgY2xvc2VDYWxsYmFjaykge1xuICAgIHRoaXMucmV3YXJkcyA9IHJld2FyZHM7XG4gICAgdmFyIHZpZXcgPSBuZXcgUmV3YXJkVmlldyhyZXdhcmRzLCAxMDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIFJld2FyZEl0ZW1Db250cm9sbGVyLmNyZWF0ZUZyb21SZWNlaXZlQ0NCKCk7XG4gICAgfSk7XG4gICAgdGhpcy5uZFJld2FyZC5hZGRDaGlsZCh2aWV3KTtcbiAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBjbG9zZUNhbGxiYWNrO1xufTtcblxuUmV3YXJkR2V0Q29udHJvbGxlci5wcm90b3R5cGUub2tDbGlja2VkID0gZnVuY3Rpb24gKCkge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cblJld2FyZEdldENvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlQ2xpY2tlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB0aGlzLmNsb3NlKCk7XG59O1xuXG5SZXdhcmRHZXRDb250cm9sbGVyLnByb3RvdHlwZS5wb3B1cCA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIucG9wdXAodGhpcy5yb290Tm9kZSwge3BvcHVwQW5pbTogdHJ1ZX0pO1xufTtcblxuUmV3YXJkR2V0Q29udHJvbGxlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLmNsb3NlKHRoaXMucm9vdE5vZGUpO1xufTtcblxuUmV3YXJkR2V0Q29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9hY3Rpdml0eS9yZXdhcmRfZ2V0X3ZpZXcuY2NiaVwiLCBudWxsLCBcIlJld2FyZEdldENvbnRyb2xsZXJcIiwgbmV3IFJld2FyZEdldENvbnRyb2xsZXIoKSk7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFJld2FyZEdldENvbnRyb2xsZXI7IiwidmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xudmFyIEdhbWVNYW4gPSByZXF1aXJlKFwiLi4vbW9kZWwvR2FtZU1hblwiKTtcbnZhciBCb29zdFR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9Cb29zdFR5cGVcIik7XG5cbnZhciBSZXdhcmRHaWZ0Q29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuXG4gICAgdGhpcy5sYlRpdGxlID0gbnVsbDtcblxuICAgIHRoaXMubGJUaXBzID0gbnVsbDtcbiAgICB0aGlzLmxiQnV0dG9uID0gbnVsbDtcblxuICAgIHRoaXMuY2xvc2VDYWxsYmFjayA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKFJld2FyZEdpZnRDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cblJld2FyZEdpZnRDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG4gICAgdGhpcy5sYlRpdGxlLnNldFN0cmluZyhfKFwiZ2lmdF90aXRsZVwiKSk7XG4gICAgdGhpcy5sYlRpcHMuc2V0U3RyaW5nKF8oXCJnaWZ0X3RpcHNcIikpO1xuICAgIHRoaXMubGJCdXR0b24uc2V0U3RyaW5nKF8oXCJnaWZ0X2J1dHRvblwiKSk7XG5cbiAgICAvL3RoaXMubGJUaXBzLnNldEFsaWdubWVudChjYy5URVhUX0FMSUdOTUVOVF9DRU5URVIpO1xufTtcblxuUmV3YXJkR2lmdENvbnRyb2xsZXIucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoY2xvc2VDYWxsYmFjaykge1xuICAgIHRoaXMuY2xvc2VDYWxsYmFjayA9IGNsb3NlQ2FsbGJhY2s7XG59O1xuXG5SZXdhcmRHaWZ0Q29udHJvbGxlci5wcm90b3R5cGUuY2xvc2VDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cblJld2FyZEdpZnRDb250cm9sbGVyLnByb3RvdHlwZS5naWZ0Q2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIHNoYXJlID0gR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmdldFNoYXJlQ29uZmlnKCk7XG4gICAgZ2FtZS5zaGFyZU1hbmFnZXIud3hHcm91cFNoYXJlKHNoYXJlLCBcImdpZnRfc2hhcmVcIiwgZnVuY3Rpb24gKHNoYXJlZCkge1xuICAgICAgICBpZiAoc2hhcmVkKSB7XG4gICAgICAgICAgICB2YXIgc3BsaXRDb3VudCA9IGdhbWUudXRpbHMucmFuZG9tTmV4dEludEluUmFuZ2UoMiwgMyk7XG4gICAgICAgICAgICB2YXIgdGhyZWVCYWxsQ291bnQgPSBnYW1lLnV0aWxzLnJhbmRvbU5leHRJbnRJblJhbmdlKDIsIDMpO1xuICAgICAgICAgICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5wb3B1cEJvb3N0UmV3YXJkRGxnKHNwbGl0Q291bnQsIHRocmVlQmFsbENvdW50LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5jbG9zZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBnYW1lLnV0aWxzLnNob3dXWFRvYXN0KFwi6ZyA6KaB5YiG5Lqr5Yiw576kXCIpO1xuICAgICAgICB9XG4gICAgfSk7XG59O1xuXG5SZXdhcmRHaWZ0Q29udHJvbGxlci5wcm90b3R5cGUucG9wdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLnBvcHVwKHRoaXMucm9vdE5vZGUsIHtvdmVybGF5T3BhY2l0eTogMjEwfSk7XG59O1xuXG5SZXdhcmRHaWZ0Q29udHJvbGxlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLmNsb3NlKHRoaXMucm9vdE5vZGUpO1xuICAgIGlmICh0aGlzLmNsb3NlQ2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5jbG9zZUNhbGxiYWNrKCk7XG4gICAgICAgIHRoaXMuY2xvc2VDYWxsYmFjayA9IG51bGw7XG4gICAgfVxufTtcblxuUmV3YXJkR2lmdENvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBub2RlID0gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvbm90aWNlL3Jld2FyZF9naWZ0X3ZpZXcuY2NiaVwiLCBudWxsLCBcIlJld2FyZEdpZnRDb250cm9sbGVyXCIsIG5ldyBSZXdhcmRHaWZ0Q29udHJvbGxlcigpKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUmV3YXJkR2lmdENvbnRyb2xsZXI7IiwiXG5cbnZhciBSZXdhcmRJdGVtQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuICAgIHRoaXMuc3ByUmV3YXJkID0gbnVsbDtcbiAgICB0aGlzLmxiQ291bnQgPSBudWxsO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhSZXdhcmRJdGVtQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5SZXdhcmRJdGVtQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xufTtcblxuUmV3YXJkSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLmluaXRSZXdhcmQgPSBmdW5jdGlvbiAocmV3YXJkKSB7XG4gICAgdGhpcy5yZXdhcmQgPSByZXdhcmQ7XG4gICAgY2MubG9nKFwicmV3YXJkLmltYWdlOlwiICsgcmV3YXJkLmltYWdlKTtcbiAgICBnYW1lLnV0aWxzLnNjYWxlU3ByaXRlRnJhbWUodGhpcy5zcHJSZXdhcmQsIHJld2FyZC5pbWFnZSk7XG4gICAgLy8gdGhpcy5zcHJSZXdhcmQuc2V0U3ByaXRlRnJhbWUocmV3YXJkLmltYWdlKTtcbiAgICB0aGlzLmxiQ291bnQuc2V0U3RyaW5nKFwieFwiICsgcmV3YXJkLmNvdW50KTtcbn07XG5cblJld2FyZEl0ZW1Db250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL2FjdGl2aXR5L3Jld2FyZF9pdGVtX3ZpZXcuY2NiaVwiLCBudWxsLCBcIlJld2FyZEl0ZW1Db250cm9sbGVyXCIsIG5ldyBSZXdhcmRJdGVtQ29udHJvbGxlcigpKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cblJld2FyZEl0ZW1Db250cm9sbGVyLmNyZWF0ZUZyb21SZWNlaXZlQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9hY3Rpdml0eS9yZXdhcmRfcmVjZWl2ZV92aWV3LmNjYmlcIiwgbnVsbCwgXCJSZXdhcmRJdGVtQ29udHJvbGxlclwiLCBuZXcgUmV3YXJkSXRlbUNvbnRyb2xsZXIoKSk7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFJld2FyZEl0ZW1Db250cm9sbGVyOyIsIlxuXG52YXIgUmV3YXJkTm90aWNlQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuICAgIHRoaXMubmRSZXdhcmQxID0gbnVsbDtcbiAgICB0aGlzLm5kUmV3YXJkMiA9IG51bGw7XG5cbiAgICB0aGlzLnNwUmV3YXJkMSA9IG51bGw7XG4gICAgdGhpcy5sYlJld2FyZDEgPSBudWxsO1xuICAgIHRoaXMuc3BSZXdhcmQyID0gbnVsbDtcbiAgICB0aGlzLmxiUmV3YXJkMiA9IG51bGw7XG5cbiAgICB0aGlzLnNwUmV3YXJkID0gbnVsbDtcbiAgICB0aGlzLmxiUmV3YXJkID0gbnVsbDtcblxuICAgIHRoaXMubGJsT2sgPSBudWxsO1xuXG4gICAgdGhpcy5fb2tDYWxsRnVuYyA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKFJld2FyZE5vdGljZUNvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuUmV3YXJkTm90aWNlQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuICAgIHRoaXMubmRSZXdhcmQxLnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLm5kUmV3YXJkMi52aXNpYmxlID0gZmFsc2U7XG5cbiAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImdldF9kaWFtb25kc1wiKTtcblxuICAgIC8vdGhpcy5zcEJnLnJ1bkFjdGlvbihjYy5yb3RhdGVCeSgyLCAzNjApLnJlcGVhdEZvcmV2ZXIoKSk7XG59O1xuXG5SZXdhcmROb3RpY2VDb250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aFJld2FyZFllcyA9IGZ1bmN0aW9uIChpbmZvLCBva0NhbGxGdW5jLCByZXdhcmQxU3ByaXRlLCByZXdhcmQxQ291bnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXdhcmQyU3ByaXRlLCByZXdhcmQyQ291bnQpIHtcbiAgICB2YXIgc3ByaXRlRnJhbWU7XG4gICAgaWYgKHJld2FyZDFTcHJpdGUgJiYgcmV3YXJkMlNwcml0ZSkge1xuICAgICAgICB0aGlzLm5kUmV3YXJkMi52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgLy90aGlzLmxiUmV3YXJkMkluZm8uc2V0U3RyaW5nKGluZm8pO1xuICAgICAgICAvL3RoaXMubGJSZXdhcmQySW5mby5zZXRBbGlnbm1lbnQoY2MuVEVYVF9BTElHTk1FTlRfQ0VOVEVSKTtcbiAgICAgICAgc3ByaXRlRnJhbWUgPSBjYy5zcHJpdGVGcmFtZUNhY2hlLmdldFNwcml0ZUZyYW1lKHJld2FyZDFTcHJpdGUpO1xuICAgICAgICBpZiAoc3ByaXRlRnJhbWUpIHtcbiAgICAgICAgICAgIHRoaXMuc3BSZXdhcmQxLnNldFNwcml0ZUZyYW1lKHNwcml0ZUZyYW1lKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxiUmV3YXJkMS5zZXRTdHJpbmcoXCJ4XCIgKyByZXdhcmQxQ291bnQpO1xuICAgICAgICBzcHJpdGVGcmFtZSA9IGNjLnNwcml0ZUZyYW1lQ2FjaGUuZ2V0U3ByaXRlRnJhbWUocmV3YXJkMlNwcml0ZSk7XG4gICAgICAgIGlmIChzcHJpdGVGcmFtZSkge1xuICAgICAgICAgICAgdGhpcy5zcFJld2FyZDIuc2V0U3ByaXRlRnJhbWUoc3ByaXRlRnJhbWUpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubGJSZXdhcmQyLnNldFN0cmluZyhcInhcIiArIHJld2FyZDJDb3VudCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5uZFJld2FyZDEudmlzaWJsZSA9IHRydWU7XG4gICAgICAgIC8vdGhpcy5sYlJld2FyZEluZm8uc2V0U3RyaW5nKGluZm8pO1xuICAgICAgICAvL3RoaXMubGJSZXdhcmRJbmZvLnNldEFsaWdubWVudChjYy5URVhUX0FMSUdOTUVOVF9DRU5URVIpO1xuICAgICAgICBzcHJpdGVGcmFtZSA9IGNjLnNwcml0ZUZyYW1lQ2FjaGUuZ2V0U3ByaXRlRnJhbWUocmV3YXJkMVNwcml0ZSk7XG4gICAgICAgIGlmIChzcHJpdGVGcmFtZSkge1xuICAgICAgICAgICAgdGhpcy5zcFJld2FyZC5zZXRTcHJpdGVGcmFtZShzcHJpdGVGcmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sYlJld2FyZC5zZXRTdHJpbmcoXCJ4XCIgKyByZXdhcmQxQ291bnQpO1xuICAgIH1cblxuICAgIHRoaXMubGJsT2suc2V0U3RyaW5nKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJjb25maXJtX2luZm9cIikpO1xuICAgIHRoaXMuX29rQ2FsbEZ1bmMgPSBva0NhbGxGdW5jO1xufTtcblxuUmV3YXJkTm90aWNlQ29udHJvbGxlci5wcm90b3R5cGUub2tDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGlmICh0aGlzLl9va0NhbGxGdW5jKSB7XG4gICAgICAgIHRoaXMuX29rQ2FsbEZ1bmMoKTtcbiAgICB9XG4gICAgdGhpcy5jbG9zZSgpO1xufTtcblxuUmV3YXJkTm90aWNlQ29udHJvbGxlci5wcm90b3R5cGUucG9wdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLnBvcHVwKHRoaXMucm9vdE5vZGUpO1xufTtcblxuUmV3YXJkTm90aWNlQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLmNsb3NlKHRoaXMucm9vdE5vZGUpO1xufTtcblxuUmV3YXJkTm90aWNlQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9ub3RpY2UvcmV3YXJkX25vdGljZV92aWV3LmNjYmlcIiwgbnVsbCwgXCJSZXdhcmROb3RpY2VDb250cm9sbGVyXCIsIG5ldyBSZXdhcmROb3RpY2VDb250cm9sbGVyKCkpO1xuICAgIHJldHVybiBub2RlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBSZXdhcmROb3RpY2VDb250cm9sbGVyOyIsInZhciBSZXdhcmRWaWV3ID0gcmVxdWlyZShcIi4uL3ZpZXcvUmV3YXJkVmlld1wiKTtcbnZhciBSZXdhcmRJdGVtQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL1Jld2FyZEl0ZW1Db250cm9sbGVyXCIpO1xuXG52YXIgUmV3YXJkUG9wdXBDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG4gICAgdGhpcy5uZFJld2FyZCA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKFJld2FyZFBvcHVwQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5SZXdhcmRQb3B1cENvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcbn07XG5cblJld2FyZFBvcHVwQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdFJld2FyZHMgPSBmdW5jdGlvbiAocmV3YXJkcykge1xuICAgIHZhciB2aWV3ID0gbmV3IFJld2FyZFZpZXcocmV3YXJkcywgNTAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIFJld2FyZEl0ZW1Db250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICB9KTtcbiAgICB0aGlzLm5kUmV3YXJkLmFkZENoaWxkKHZpZXcpO1xufTtcblxuUmV3YXJkUG9wdXBDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL2FjdGl2aXR5L3Jld2FyZF9wb3B1cF92aWV3LmNjYmlcIiwgbnVsbCwgXCJSZXdhcmRQb3B1cENvbnRyb2xsZXJcIiwgbmV3IFJld2FyZFBvcHVwQ29udHJvbGxlcigpKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cblJld2FyZFBvcHVwQ29udHJvbGxlci5jcmVhdGVBbmRQb3AgPSBmdW5jdGlvbiAocmV3YXJkcywgcGFyZW50LCBwb3MpIHtcbiAgICB2YXIgbm9kZSA9IFJld2FyZFBvcHVwQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG4gICAgbm9kZS5jb250cm9sbGVyLmluaXRSZXdhcmRzKHJld2FyZHMpO1xuICAgIHBhcmVudC5hZGRDaGlsZChub2RlKTtcbiAgICBub2RlLnNldFBvc2l0aW9uKHBvcyk7XG4gICAgbm9kZS5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoY2MuZGVsYXlUaW1lKDMpLCBjYy5yZW1vdmVTZWxmKCkpKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUmV3YXJkUG9wdXBDb250cm9sbGVyOyIsInZhciBFdmVudHNOYW1lID0gcmVxdWlyZShcIi4uL2V2ZW50cy9FdmVudHNOYW1lXCIpO1xuXG52YXIgUmV3YXJkUmVtb3ZlQWRDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG5cbiAgICB0aGlzLnNwUmVtaW5kZXIgPSBudWxsO1xuICAgIHRoaXMubGJSZW1pbmRlciA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKFJld2FyZFJlbW92ZUFkQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5SZXdhcmRSZW1vdmVBZENvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIuY2FsbCh0aGlzKTtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5hZGRFdmVudExpc3RlbmVyKEV2ZW50c05hbWUuUkVXQVJEX1JFTU9WRV9BRCwgdGhpcy5vblVwZGF0ZVJlbWluZGVyLCB0aGlzKTtcbn07XG5cblJld2FyZFJlbW92ZUFkQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0ID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoRXZlbnRzTmFtZS5SRVdBUkRfUkVNT1ZFX0FELCB0aGlzLm9uVXBkYXRlUmVtaW5kZXIsIHRoaXMpO1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQuY2FsbCh0aGlzKTtcbn07XG5cblJld2FyZFJlbW92ZUFkQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuICAgIHRoaXMub25VcGRhdGVSZW1pbmRlcigpO1xufTtcblxuUmV3YXJkUmVtb3ZlQWRDb250cm9sbGVyLnByb3RvdHlwZS5vblVwZGF0ZVJlbWluZGVyID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMucm9vdE5vZGUudmlzaWJsZSA9IGZhbHNlO1xuXG4gICAgaWYgKGdhbWUuYWRzTWFuYWdlci5pc1JlbW92ZWRBZHMoKSkge1xuICAgICAgICAvLyB0aGlzLnJvb3ROb2RlLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoZ2FtZS5hZHNNYW5hZ2VyLmlzSW50ZXJzdGl0aWFsRGlzYWJsZWQoKSkge1xuICAgICAgICAvLyB0aGlzLnJvb3ROb2RlLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChnYW1lLmdhbWVNYW4uZ2V0UGxheWVyTGV2ZWwoKSA8IGdhbWUuYWRzTWFuYWdlci5yZXdhcmRSZW1vdmVBZHNMZXZlbExpbWl0KSB7XG4gICAgICAgIC8vIHRoaXMucm9vdE5vZGUudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5yb290Tm9kZS52aXNpYmxlID0gdHJ1ZTtcbn07XG5cblJld2FyZFJlbW92ZUFkQ29udHJvbGxlci5wcm90b3R5cGUucmV3YXJkUmVtb3ZlQWRzQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImVudGVyXCIpO1xuICAgIGdhbWUucG9wdXBNYW4ucG9wdXBSZXdhcmRSZW1vdmVBZHMoKTtcbn07XG5cblJld2FyZFJlbW92ZUFkQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9tZW51L3Jld2FyZF9yZW1vdmVfYWRzLmNjYmlcIiwgbnVsbCwgXCJSZXdhcmRSZW1vdmVBZENvbnRyb2xsZXJcIiwgbmV3IFJld2FyZFJlbW92ZUFkQ29udHJvbGxlcigpLCB0cnVlKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUmV3YXJkUmVtb3ZlQWRDb250cm9sbGVyOyIsInZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcblxudmFyIFJld2FyZFJlbW92ZUFkc0NvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcblxuICAgIHRoaXMubGJJbmZvID0gbnVsbDtcbiAgICB0aGlzLmxiUmV3YXJkMSA9IG51bGw7XG4gICAgdGhpcy5sYlJld2FyZDIgPSBudWxsO1xuXG4gICAgdGhpcy5yZW1vdmVkID0gZmFsc2U7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKFJld2FyZFJlbW92ZUFkc0NvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuUmV3YXJkUmVtb3ZlQWRzQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0ID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQuY2FsbCh0aGlzKTtcbiAgICBpZiAodGhpcy5jbG9zZUNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuY2xvc2VDYWxsYmFjayh0aGlzLnJlbW92ZWQpO1xuICAgICAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBudWxsO1xuICAgIH1cbn07XG5cblJld2FyZFJlbW92ZUFkc0NvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcbiAgICB0aGlzLmxiSW5mby5zZXRTdHJpbmcoZ2FtZS51dGlscy5zcHJpbnRmKF8oXCJyZXdhcmRfdmlkZW9fcmVtb3ZlX2Fkc1wiKSwgZ2FtZS5jb25maWcucmV3YXJkUmVtb3ZlQWRzQ2ZnLnRpbWVJbk1pbnV0ZSkpO1xuICAgIHRoaXMubGJSZXdhcmQxLnNldFN0cmluZyhcInhcIiArIGdhbWUuY29uZmlnLnJld2FyZFJlbW92ZUFkc0NmZy5tdWx0aSk7XG4gICAgdGhpcy5sYlJld2FyZDIuc2V0U3RyaW5nKFwieFwiICsgZ2FtZS5jb25maWcucmV3YXJkUmVtb3ZlQWRzQ2ZnLmFkZCk7XG59O1xuXG5SZXdhcmRSZW1vdmVBZHNDb250cm9sbGVyLnByb3RvdHlwZS51c2luZ0NsaWNrZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuY2hlY2tBbmRTaG93UmV3YXJkVmlkZW8oXCJyZXdhcmRfcmVtb3ZlX2Fkc1wiLCBmdW5jdGlvbiAod2F0Y2hlZCkge1xuICAgICAgICBpZiAod2F0Y2hlZCkge1xuICAgICAgICAgICAgc2VsZi5yZW1vdmVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHNlbGYuY2xvc2UoKTtcbiAgICAgICAgICAgIGdhbWUuYWRzTWFuYWdlci5kaXNhYmxlSW50ZXJzdGl0aWFsV2l0aFRpbWUoZ2FtZS5jb25maWcucmV3YXJkUmVtb3ZlQWRzQ2ZnLnRpbWVJbk1pbnV0ZSAqIDYwKTtcbiAgICAgICAgICAgIHZhciBFdmVudHNOYW1lID0gcmVxdWlyZShcIi4uL2V2ZW50cy9FdmVudHNOYW1lXCIpO1xuICAgICAgICAgICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChFdmVudHNOYW1lLlJFV0FSRF9SRU1PVkVfQUQpO1xuICAgICAgICAgICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5wb3B1cEJvb3N0UmV3YXJkRGxnKGdhbWUuY29uZmlnLnJld2FyZFJlbW92ZUFkc0NmZy5tdWx0aSwgZ2FtZS5jb25maWcucmV3YXJkUmVtb3ZlQWRzQ2ZnLmFkZCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn07XG5cblJld2FyZFJlbW92ZUFkc0NvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlQ2xpY2tlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB0aGlzLmNsb3NlKCk7XG59O1xuXG5SZXdhcmRSZW1vdmVBZHNDb250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aCA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgIHRoaXMuY2xvc2VDYWxsYmFjayA9IGNhbGxiYWNrO1xufTtcblxuUmV3YXJkUmVtb3ZlQWRzQ29udHJvbGxlci5wcm90b3R5cGUucG9wdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLnBvcHVwKHRoaXMucm9vdE5vZGUsIHtwb3B1cEFuaW06IHRydWV9KTtcbn07XG5cblJld2FyZFJlbW92ZUFkc0NvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5jbG9zZSh0aGlzLnJvb3ROb2RlKTtcbn07XG5cblJld2FyZFJlbW92ZUFkc0NvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBub2RlID0gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvbm90aWNlL25vdGljZV92aWV3X2FkLmNjYmlcIiwgbnVsbCwgXCJSZXdhcmRSZW1vdmVBZHNDb250cm9sbGVyXCIsIG5ldyBSZXdhcmRSZW1vdmVBZHNDb250cm9sbGVyKCkpO1xuICAgIHJldHVybiBub2RlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBSZXdhcmRSZW1vdmVBZHNDb250cm9sbGVyOyIsInZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcblxudmFyIFJld2FyZFZpZGVvQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuXG4gICAgdGhpcy5fdGl0bGVMYWJlbCA9IG51bGw7XG5cbiAgICB0aGlzLnNwUmV3YXJkMSA9IG51bGw7XG4gICAgdGhpcy5sYlJld2FyZDEgPSBudWxsO1xuICAgIHRoaXMuc3BSZXdhcmQyID0gbnVsbDtcbiAgICB0aGlzLmxiUmV3YXJkMiA9IG51bGw7XG4gICAgdGhpcy5sYlJld2FyZDJJbmZvID0gbnVsbDtcbiAgICB0aGlzLmxibEZyZWUgPSBudWxsO1xuXG4gICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoUmV3YXJkVmlkZW9Db250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cblJld2FyZFZpZGVvQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuICAgIHRoaXMubGJSZXdhcmQxLnNldFN0cmluZyhcIlgxXCIpO1xuICAgIHRoaXMubGJSZXdhcmQyLnNldFN0cmluZyhcIlgxXCIpO1xuICAgIHRoaXMubGJSZXdhcmQySW5mby5zZXRTdHJpbmcoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcIndhdGNoX2Fkc190aXBzXCIpKTtcbiAgICB0aGlzLl90aXRsZUxhYmVsLnNldFN0cmluZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwid2F0Y2hfYWRzX3RpdGxlXCIpKTtcbiAgICB0aGlzLmxibEZyZWUuc2V0U3RyaW5nKF8oXCJmcmVlX2NvaW5zX3RpdGxlXCIpKTtcbn07XG5cblJld2FyZFZpZGVvQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uIChjbG9zZUNhbGxiYWNrKSB7XG4gICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gY2xvc2VDYWxsYmFjaztcbn07XG5cblJld2FyZFZpZGVvQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2VDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cblJld2FyZFZpZGVvQ29udHJvbGxlci5wcm90b3R5cGUud2F0Y2hBZHNDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuY2hlY2tBbmRTaG93UmV3YXJkVmlkZW8oZ2FtZS51dGlscy5pc0lPUygpID8gXCJqaWxpMDMtSU9TXCIgOiBcImppbGkwM1wiKTtcbn07XG5cblJld2FyZFZpZGVvQ29udHJvbGxlci5wcm90b3R5cGUucG9wdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLnBvcHVwKHRoaXMucm9vdE5vZGUpO1xufTtcblxuUmV3YXJkVmlkZW9Db250cm9sbGVyLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIuY2xvc2UodGhpcy5yb290Tm9kZSk7XG4gICAgaWYgKHRoaXMuY2xvc2VDYWxsYmFjaykge1xuICAgICAgICB0aGlzLmNsb3NlQ2FsbGJhY2soKTtcbiAgICAgICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gbnVsbDtcbiAgICB9XG59O1xuXG5SZXdhcmRWaWRlb0NvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBub2RlID0gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvbm90aWNlL3Jld2FyZF92aWRlb192aWV3LmNjYmlcIiwgbnVsbCwgXCJSZXdhcmRWaWRlb0NvbnRyb2xsZXJcIiwgbmV3IFJld2FyZFZpZGVvQ29udHJvbGxlcigpKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUmV3YXJkVmlkZW9Db250cm9sbGVyOyIsInZhciBTa2luSXRlbUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi9Ta2luSXRlbUNvbnRyb2xsZXJcIik7XG52YXIgQ29uZmlnTWFuID0gcmVxdWlyZShcIi4uL2NvbmZpZy9Db25maWdNYW5cIik7XG52YXIgRXZlbnRzTmFtZSA9IHJlcXVpcmUoXCIuLi9ldmVudHMvRXZlbnRzTmFtZVwiKTtcblxuXG52YXIgU2V0dGluZ0NvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcbiAgICB0aGlzLnNwQXVkaW9PZmYgPSBudWxsO1xuICAgIHRoaXMuc3BBdWRpb09uID0gbnVsbDtcbiAgICB0aGlzLmxiQXVkaW8gPSBudWxsO1xuICAgIHRoaXMubGJWZXJzaW9uID0gbnVsbDtcbiAgICB0aGlzLm5kUmFuayA9IG51bGw7XG4gICAgdGhpcy5uZFZpYnJhdGUgPSBudWxsO1xuXG4gICAgdGhpcy5zcFZpYnJhdGVPbiA9IG51bGw7XG4gICAgdGhpcy5zcFZpYnJhdGVPZmYgPSBudWxsO1xuICAgIHRoaXMubGJsVmlicmF0ZSA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKFNldHRpbmdDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cblNldHRpbmdDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG4gICAgdGhpcy51cGRhdGVTb3VuZEl0ZW0oKTtcbiAgICB0aGlzLnVwZGF0ZVZpYnJhdGVJdGVtKCk7XG4gICAgdmFyIHZlcnNpb24gPSBcIndlYlwiO1xuICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgdmVyc2lvbiA9IGpzYl9kcC5vbmVTZGtCcmlkZ2UuZ2V0VmVyc2lvbigpO1xuICAgIH1cbiAgICB0aGlzLmxiVmVyc2lvbi5zZXRTdHJpbmcoZ2FtZS51dGlscy5zcHJpbnRmKF8oXCJ2ZXJzaW9uX3RpdGxlXCIpLCB2ZXJzaW9uKSk7XG4gICAgaWYgKGNjLnN5cy5vcyA9PT0gY2Muc3lzLk9TX0FORFJPSUQpIHtcbiAgICAgICAgdGhpcy5uZFJhbmsudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLm5kVmlicmF0ZS52aXNpYmxlID0gZmFsc2U7XG4gICAgfVxufTtcblxuU2V0dGluZ0NvbnRyb2xsZXIucHJvdG90eXBlLnVwZGF0ZVNvdW5kSXRlbSA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgaXNTb3VuZE9uID0gZ2FtZS5hdWRpb1BsYXllci5pc0VmZmVjdE9uKCk7XG4gICAgdGhpcy5zcEF1ZGlvT2ZmLnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLnNwQXVkaW9Pbi52aXNpYmxlID0gZmFsc2U7XG4gICAgaWYgKGlzU291bmRPbikge1xuICAgICAgICB0aGlzLnNwQXVkaW9Pbi52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5sYkF1ZGlvLnNldFN0cmluZyhfKFwiYXVkaW9fb25fdGl0bGVcIikpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc3BBdWRpb09mZi52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5sYkF1ZGlvLnNldFN0cmluZyhfKFwiYXVkaW9fb2ZmX3RpdGxlXCIpKTtcbiAgICB9XG59O1xuXG5TZXR0aW5nQ29udHJvbGxlci5wcm90b3R5cGUudXBkYXRlVmlicmF0ZUl0ZW0gPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGlzU291bmRPbiA9IGdhbWUuYXVkaW9QbGF5ZXIuaXNWaWJyYXRlT24oKTtcbiAgICB0aGlzLnNwVmlicmF0ZU9mZi52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5zcFZpYnJhdGVPbi52aXNpYmxlID0gZmFsc2U7XG4gICAgaWYgKGlzU291bmRPbikge1xuICAgICAgICB0aGlzLnNwVmlicmF0ZU9uLnZpc2libGUgPSB0cnVlO1xuICAgICAgICB0aGlzLmxibFZpYnJhdGUuc2V0U3RyaW5nKF8oXCJ2aWJyYXRlX29uX3RpdGxlXCIpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNwVmlicmF0ZU9mZi52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5sYmxWaWJyYXRlLnNldFN0cmluZyhfKFwidmlicmF0ZV9vZmZfdGl0bGVcIikpO1xuICAgIH1cbn07XG5cblNldHRpbmdDb250cm9sbGVyLnByb3RvdHlwZS5zb3VuZENsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgZ2FtZS5hdWRpb1BsYXllci5zZXRFZmZlY3RPbighZ2FtZS5hdWRpb1BsYXllci5pc0VmZmVjdE9uKCkpO1xuICAgIGdhbWUuYXVkaW9QbGF5ZXIuc2V0TXVzaWNPbighZ2FtZS5hdWRpb1BsYXllci5pc011c2ljT24oKSk7XG4gICAgdGhpcy51cGRhdGVTb3VuZEl0ZW0oKTtcbn07XG5cblNldHRpbmdDb250cm9sbGVyLnByb3RvdHlwZS5zaGFyZUNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiU2V0dGluZ1NoYXJlXCIpO1xuICAgIGdhbWUuc2hhcmVNYW5hZ2VyLnNoYXJlV2l0aFN5c3RlbShnYW1lLnV0aWxzLnNwcmludGYoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcInNoYXJlX3RpcHNcIiksXG4gICAgICAgIGdhbWUucGxheWVyTWFuLmdldExldmVsKCksIGdhbWUuY29uZmlnLmdldFNob3J0UGxhdGZvcm1Eb3dubG9hZFVybCgpKSwgZ2FtZS5jb25maWcuZ2V0U2hhcmVVcmwoKSk7XG59O1xuXG5TZXR0aW5nQ29udHJvbGxlci5wcm90b3R5cGUucmFua0NsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgZ2FtZS5nY01hbmFnZXIuc2hvd0xlYWRlcmJvYXJkKGdhbWUuY29uZmlnLmdldExlYWRlckJvYXJkS2V5KCkpO1xufTtcblxuU2V0dGluZ0NvbnRyb2xsZXIucHJvdG90eXBlLnN1cHBvcnRDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGdhbWUuc2hhcmVNYW5hZ2VyLnNlbmRFbWFpbChnYW1lLmNvbmZpZy5nZXRFbWFpbCgpLFxuICAgICAgICBnYW1lLmxvY2FsLmdldFZhbHVlKFwiZmVlZF9iYWNrX3RpdGxlXCIpLCBnYW1lLmxvY2FsLmdldFZhbHVlKFwiZmVlZF9iYWNrX2NvbnRlbnRcIikpO1xufTtcblxuU2V0dGluZ0NvbnRyb2xsZXIucHJvdG90eXBlLnJhdGVDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGNjLnN5cy5vcGVuVVJMKGdhbWUuY29uZmlnLmdldFBsYXRmb3JtRG93bmxvYWRVcmwoKSk7XG59O1xuXG5TZXR0aW5nQ29udHJvbGxlci5wcm90b3R5cGUuZmFuUGFnZUNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgY2Muc3lzLm9wZW5VUkwoZ2FtZS5jb25maWcuZ2V0RmFuc1VybCgpKTtcbn07XG5cblNldHRpbmdDb250cm9sbGVyLnByb3RvdHlwZS5saWtlVXNDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGNjLnN5cy5vcGVuVVJMKGdhbWUuY29uZmlnLmdldFBsYXRmb3JtRG93bmxvYWRVcmwoKSk7XG59O1xuXG5TZXR0aW5nQ29udHJvbGxlci5wcm90b3R5cGUudmlicmF0ZUNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgZ2FtZS5hdWRpb1BsYXllci5zZXRWaWJyYXRlT24oIWdhbWUuYXVkaW9QbGF5ZXIuaXNWaWJyYXRlT24oKSk7XG4gICAgdGhpcy51cGRhdGVWaWJyYXRlSXRlbSgpO1xufTtcblxuU2V0dGluZ0NvbnRyb2xsZXIucHJvdG90eXBlLmJhY2tDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuXG4gICAgdGhpcy5jbG9zZSgpO1xufTtcblxuU2V0dGluZ0NvbnRyb2xsZXIucHJvdG90eXBlLnBvcHVwID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5wb3B1cCh0aGlzLnJvb3ROb2RlLCB7cG9wdXBBbmltOiB0cnVlfSk7XG59O1xuXG5TZXR0aW5nQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLmNsb3NlKHRoaXMucm9vdE5vZGUpO1xufTtcblxuU2V0dGluZ0NvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBub2RlID0gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvbm90aWNlL3NldHRpbmdfdmlldy5jY2JpXCIsIG51bGwsIFwiU2V0dGluZ0NvbnRyb2xsZXJcIiwgbmV3IFNldHRpbmdDb250cm9sbGVyKCkpO1xuICAgIHJldHVybiBub2RlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBTZXR0aW5nQ29udHJvbGxlcjsiLCJ2YXIgU2tpbkl0ZW1Db250cm9sbGVyID0gcmVxdWlyZShcIi4vU2tpbkl0ZW1Db250cm9sbGVyXCIpO1xudmFyIENvbmZpZ01hbiA9IHJlcXVpcmUoXCIuLi9jb25maWcvQ29uZmlnTWFuXCIpO1xudmFyIEV2ZW50c05hbWUgPSByZXF1aXJlKFwiLi4vZXZlbnRzL0V2ZW50c05hbWVcIik7XG52YXIgTXVsdGlDb2xUYWJsZVZpZXcgPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uL2V4dC9NdWx0aUNvbFRhYmxlVmlld1wiKTtcblxudmFyIEdSSURfU0laRSA9IGNjLnNpemUoMjcwLCAyMDApO1xuXG52YXIgU3RvcmVJdGVtQ2VsbFZpZXcgPSBjYy5UYWJsZVZpZXdDZWxsLmV4dGVuZCh7XG4gICAgZW50aXR5OiBudWxsLFxuICAgIGl0ZW1Ob2RlOiBudWxsLFxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICAgICAgdGhpcy5pdGVtTm9kZSA9IFNraW5JdGVtQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG4gICAgICAgIHRoaXMuYWRkQ2hpbGQodGhpcy5pdGVtTm9kZSk7XG4gICAgICAgIHRoaXMuaXRlbU5vZGUuc2V0UG9zaXRpb24oY2MucChHUklEX1NJWkUud2lkdGggKiAwLjUsIEdSSURfU0laRS5oZWlnaHQgKiAwLjUpKTtcbiAgICB9LFxuXG4gICAgaW5pdFdpdGg6IGZ1bmN0aW9uIChlbnRpdHksIGlkeCkge1xuICAgICAgICB0aGlzLmVudGl0eSA9IGVudGl0eTtcbiAgICAgICAgdGhpcy5pdGVtTm9kZS5jb250cm9sbGVyLmluaXRXaXRoKGVudGl0eSwgaWR4KTtcbiAgICB9XG59KTtcblxudmFyIFNraW5Db250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG4gICAgdGhpcy5uZENvbnRhaW5lciA9IG51bGw7XG5cbiAgICB0aGlzLmxibFRpdGxlID0gbnVsbDtcblxuICAgIHRoaXMuX3RhYmxlVmlldyA9IG51bGw7XG5cbiAgICAvL3VzZXIgZGF0YS5cbiAgICB0aGlzLmNvbmZpZ3MgPSBudWxsO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhTa2luQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5Ta2luQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlci5jYWxsKHRoaXMpO1xuICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLmFkZEV2ZW50TGlzdGVuZXIoRXZlbnRzTmFtZS5VUERBVEVfU0tJTiwgdGhpcy5vblVwZGF0ZVNraW4sIHRoaXMpO1xufTtcblxuU2tpbkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRXhpdCA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5yZW1vdmVFdmVudExpc3RlbmVyKEV2ZW50c05hbWUuVVBEQVRFX1NLSU4sIHRoaXMub25VcGRhdGVTa2luLCB0aGlzKTtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0LmNhbGwodGhpcyk7XG59O1xuXG5Ta2luQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuICAgIHRoaXMubGJsVGl0bGUuc2V0U3RyaW5nKF8oXCJza2luX3RpdGxlXCIpKTtcblxuICAgIHRoaXMuY29uZmlncyA9IENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldFNraW5MaXN0KCk7XG4gICAgdGhpcy5zaG93VGFibGVWaWV3KCk7XG59O1xuXG5Ta2luQ29udHJvbGxlci5wcm90b3R5cGUub25VcGRhdGVTa2luID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgdGhpcy5zaG93VGFibGVWaWV3KCk7XG59O1xuXG5Ta2luQ29udHJvbGxlci5wcm90b3R5cGUuc2hvd1RhYmxlVmlldyA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoIXRoaXMuX3RhYmxlVmlldykge1xuICAgICAgICB2YXIgc2l6ZSA9IHRoaXMubmRDb250YWluZXIuZ2V0Q29udGVudFNpemUoKTtcbiAgICAgICAgdGhpcy5fdGFibGVWaWV3ID0gbmV3IE11bHRpQ29sVGFibGVWaWV3KHRoaXMsIHNpemUsIG51bGwpO1xuICAgICAgICB0aGlzLl90YWJsZVZpZXcuc2V0RGlyZWN0aW9uKGNjLlNDUk9MTFZJRVdfRElSRUNUSU9OX1ZFUlRJQ0FMKTtcbiAgICAgICAgdGhpcy5fdGFibGVWaWV3LnNldFZlcnRpY2FsRmlsbE9yZGVyKGNjLlRBQkxFVklFV19GSUxMX1RPUERPV04pO1xuICAgICAgICB0aGlzLl90YWJsZVZpZXcuc2V0TXVsdGlUYWJsZVZpZXdEZWxlZ2F0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5fdGFibGVWaWV3Lmlnbm9yZUFuY2hvclBvaW50Rm9yUG9zaXRpb24oZmFsc2UpO1xuICAgICAgICB0aGlzLl90YWJsZVZpZXcuc2V0QW5jaG9yUG9pbnQoY2MucCgwLCAwKSk7XG4gICAgICAgIHRoaXMubmRDb250YWluZXIuYWRkQ2hpbGQodGhpcy5fdGFibGVWaWV3KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl9vZmZzZXQgPSB0aGlzLl90YWJsZVZpZXcuZ2V0Q29udGVudE9mZnNldCgpO1xuICAgIH1cbiAgICB0aGlzLl90YWJsZVZpZXcucmVsb2FkRGF0YSgpO1xuICAgIGlmICh0aGlzLl9vZmZzZXQpIHtcbiAgICAgICAgdGhpcy5fdGFibGVWaWV3LnNldENvbnRlbnRPZmZzZXQodGhpcy5fb2Zmc2V0KTtcbiAgICAgICAgdGhpcy5fb2Zmc2V0ID0gbnVsbDtcbiAgICB9XG59O1xuXG5Ta2luQ29udHJvbGxlci5wcm90b3R5cGUuc2Nyb2xsVmlld0RpZFNjcm9sbCA9IGZ1bmN0aW9uICh2aWV3KSB7XG59O1xuXG5Ta2luQ29udHJvbGxlci5wcm90b3R5cGUuc2Nyb2xsVmlld0RpZFpvb20gPSBmdW5jdGlvbiAodmlldykge1xufTtcblxuU2tpbkNvbnRyb2xsZXIucHJvdG90eXBlLmdyaWRBdEluZGV4ID0gZnVuY3Rpb24obXVsdGlUYWJsZSwgIGlkeCkge1xuICAgIHZhciBjZWxsID0gbXVsdGlUYWJsZS5kZXF1ZXVlR3JpZCgpO1xuICAgIGlmICghY2VsbCkge1xuICAgICAgICBjZWxsID0gbmV3IFN0b3JlSXRlbUNlbGxWaWV3KCk7XG4gICAgfVxuXG4gICAgaWYgKGlkeCA8IHRoaXMuY29uZmlncy5sZW5ndGgpIHtcbiAgICAgICAgdmFyIHNraW5DZmcgPSB0aGlzLmNvbmZpZ3NbaWR4XTtcbiAgICAgICAgY2VsbC5pbml0V2l0aChza2luQ2ZnLCBpZHgpO1xuICAgICAgICBjZWxsLnZpc2libGUgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGNlbGwudmlzaWJsZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiBjZWxsO1xufTtcblxuU2tpbkNvbnRyb2xsZXIucHJvdG90eXBlLm51bWJlck9mQ2VsbHNJblRhYmxlVmlldyA9IGZ1bmN0aW9uKG11bHRpVGFibGUpIHtcbiAgICB2YXIgZ3JpZHNJbkNlbGwgPSB0aGlzLm51bWJlck9mR3JpZHNJbkNlbGwobXVsdGlUYWJsZSk7XG4gICAgcmV0dXJuIE1hdGguY2VpbCh0aGlzLmNvbmZpZ3MubGVuZ3RoIC8gZ3JpZHNJbkNlbGwpO1xufTtcblxuU2tpbkNvbnRyb2xsZXIucHJvdG90eXBlLm51bWJlck9mR3JpZHNJbkNlbGwgPSBmdW5jdGlvbihtdWx0aVRhYmxlLCBjb2xJZHgpIHtcbiAgICByZXR1cm4gMjtcbn07XG5cblNraW5Db250cm9sbGVyLnByb3RvdHlwZS5ncmlkU2l6ZUZvclRhYmxlID0gZnVuY3Rpb24odGFibGUsIGNvbElkeCkge1xuICAgIHJldHVybiBjYy5zaXplKDI3MCwgMjIwKTtcbn07XG5cblNraW5Db250cm9sbGVyLnByb3RvdHlwZS5ncmlkVG91Y2hlZCA9IGZ1bmN0aW9uKHRhYmxlLCBncmlkKSB7XG59O1xuXG5Ta2luQ29udHJvbGxlci5wcm90b3R5cGUuYmFja0NsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG5cbiAgICB0aGlzLmNsb3NlKCk7XG59O1xuXG5Ta2luQ29udHJvbGxlci5wcm90b3R5cGUucG9wdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLnBvcHVwKHRoaXMucm9vdE5vZGUpO1xufTtcblxuU2tpbkNvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5jbG9zZSh0aGlzLnJvb3ROb2RlKTtcbn07XG5cblNraW5Db250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgLy9pZiAodGhpcy5jbG9zZUNhbGxiYWNrKSB7XG4gICAgLy8gICAgdGhpcy5jbG9zZUNhbGxiYWNrKCk7XG4gICAgLy8gICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gbnVsbDtcbiAgICAvL31cbn07XG5cblNraW5Db250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL21lbnUvc2tpbl92aWV3LmNjYmlcIiwgbnVsbCwgXCJTa2luQ29udHJvbGxlclwiLCBuZXcgU2tpbkNvbnRyb2xsZXIoKSk7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNraW5Db250cm9sbGVyOyIsInZhciBTa2luUmV3YXJkVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1NraW5SZXdhcmRUeXBlXCIpO1xudmFyIEV2ZW50c05hbWUgPSByZXF1aXJlKFwiLi4vZXZlbnRzL0V2ZW50c05hbWVcIik7XG52YXIgU2tpblR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9Ta2luVHlwZVwiKTtcblxudmFyIFNraW5JdGVtQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuXG4gICAgdGhpcy5uZFB1cmNoYXNlID0gbnVsbDtcbiAgICB0aGlzLm5kT3duZWQgPSBudWxsO1xuICAgIHRoaXMubmRXYXRjaEFkcyA9IG51bGw7XG4gICAgdGhpcy5uZENoYWxsZW5nZSA9IG51bGw7XG4gICAgdGhpcy5uZEtleUFjdGl2aXR5ID0gbnVsbDtcbiAgICB0aGlzLm5kQ2hyaXN0bWFzID0gbnVsbDtcblxuICAgIHRoaXMubGJEaWFtb25kUHJpY2UgPSBudWxsO1xuICAgIHRoaXMubGJVc2luZyA9IG51bGw7XG4gICAgdGhpcy5sYlJld2FyZEFkc0NvdW50ID0gbnVsbDtcblxuICAgIHRoaXMuc3BTa2luID0gbnVsbDtcblxuICAgIHRoaXMuaWR4ID0gMDtcbiAgICB0aGlzLnNraW5DZmcgPSBudWxsO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhTa2luSXRlbUNvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuU2tpbkl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG59O1xuXG5Ta2luSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlci5jYWxsKHRoaXMpO1xuICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLmFkZEV2ZW50TGlzdGVuZXIoRXZlbnRzTmFtZS5VUERBVEVfU0tJTiwgdGhpcy5vblVwZGF0ZVNraW4sIHRoaXMpO1xufTtcblxuU2tpbkl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQgPSBmdW5jdGlvbigpIHtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5yZW1vdmVFdmVudExpc3RlbmVyKEV2ZW50c05hbWUuVVBEQVRFX1NLSU4sIHRoaXMub25VcGRhdGVTa2luLCB0aGlzKTtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0LmNhbGwodGhpcyk7XG59O1xuLyoqXG4gKiBAcGFyYW0ge1NraW5Db25maWd9IGRhdGFcbiAqIEBwYXJhbSB7bnVtYmVyfSBpZHhcbiAqL1xuU2tpbkl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aCA9IGZ1bmN0aW9uIChkYXRhLCBpZHgpIHtcbiAgICB0aGlzLmlkeCA9IGlkeDtcbiAgICB0aGlzLnNraW5DZmcgPSBkYXRhO1xuICAgIHRyeSB7XG4gICAgICAgIHZhciBzcHJpdGVGcmFtZSA9IGNjLnNwcml0ZUZyYW1lQ2FjaGUuZ2V0U3ByaXRlRnJhbWUoZGF0YS5pbWFnZSArIFwiLnBuZ1wiKTtcbiAgICAgICAgdGhpcy5zcFNraW4uc2V0U3ByaXRlRnJhbWUoc3ByaXRlRnJhbWUpO1xuXG4gICAgICAgIHRoaXMubmRQdXJjaGFzZS52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMubmRPd25lZC52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMubmRXYXRjaEFkcy52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMubmRDaGFsbGVuZ2UudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLm5kS2V5QWN0aXZpdHkudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLm5kQ2hyaXN0bWFzLnZpc2libGUgPSBmYWxzZTtcblxuICAgICAgICB2YXIgb3duZWQgPSBnYW1lLnBsYXllck1hbi5oYXNTa2luKHRoaXMuc2tpbkNmZy5pZCk7XG4gICAgICAgIGlmIChvd25lZCkge1xuICAgICAgICAgICAgdGhpcy5uZE93bmVkLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgaWYgKGRhdGEuaWQgPT09IGdhbWUucGxheWVyTWFuLmdldEN1cnJlbnRTa2luSWQoKSkge1xuICAgICAgICAgICAgICAgIHRoaXMubGJVc2luZy5zZXRTdHJpbmcoXyhcInNlbGVjdGVkX3RpdGxlXCIpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYlVzaW5nLnNldFN0cmluZyhfKFwic2VsZWN0X3RpdGxlXCIpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHN3aXRjaCAoZGF0YS50eXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBTa2luVHlwZS5XYXRjaEFkczpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNraW5SZXdhcmRDb3VudCA9IGdhbWUucGxheWVyTWFuLmdldFNraW5BZHNDb3VudChkYXRhLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5uZFdhdGNoQWRzLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxiUmV3YXJkQWRzQ291bnQuc2V0U3RyaW5nKGdhbWUudXRpbHMuc3ByaW50ZihcIiVkLyVkXCIsIHNraW5SZXdhcmRDb3VudCwgZGF0YS5jb3VudCkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFNraW5UeXBlLkRpYW1vbmRzOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLm5kUHVyY2hhc2UudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGJEaWFtb25kUHJpY2Uuc2V0U3RyaW5nKHRoaXMuc2tpbkNmZy5jb3VudCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgU2tpblR5cGUuQ2hhbGxlbmdlOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLm5kQ2hhbGxlbmdlLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFNraW5UeXBlLktleUFjdGl2aXR5OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLm5kS2V5QWN0aXZpdHkudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgU2tpblR5cGUuQ2hyaXN0bWFzOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLm5kQ2hyaXN0bWFzLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0gY2F0Y2ggKGV4KSB7XG4gICAgICAgIGNjLmVycm9yKGV4KTtcbiAgICB9XG59O1xuXG5Ta2luSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLm9uVXBkYXRlU2tpbiA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmluaXRXaXRoKHRoaXMuc2tpbkNmZywgdGhpcy5pZHgpO1xufTtcblxuU2tpbkl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5nZXRDb250ZW50U2l6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5zcEJnU2VsZWN0ZWQuZ2V0Q29udGVudFNpemUoKTtcbn07XG5cblNraW5JdGVtQ29udHJvbGxlci5wcm90b3R5cGUucHVyY2hhc2VDbGlja2VkID0gZnVuY3Rpb24gKCkge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIHZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcbiAgICBTdG9yZUhlbHBlci5nZXRJbnN0YW5jZSgpLmJ1eVNraW4odGhpcy5za2luQ2ZnLCBcImJ1eV9za2luX2luX3N0b3JlXCIpO1xufTtcblxuU2tpbkl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5zZWxlY3RDbGlja2VkID0gZnVuY3Rpb24gKCkge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGdhbWUucGxheWVyTWFuLnNldEN1cnJlbnRTa2luSWQodGhpcy5za2luQ2ZnLmlkKTtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KEV2ZW50c05hbWUuVVBEQVRFX1NLSU4pO1xufTtcblxuU2tpbkl0ZW1Db250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvbWVudS9za2luX2l0ZW1fdmlldy5jY2JpXCIsIG51bGwsIFwiU2tpbkl0ZW1Db250cm9sbGVyXCIsIG5ldyBTa2luSXRlbUNvbnRyb2xsZXIoKSk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNraW5JdGVtQ29udHJvbGxlcjsiLCJ2YXIgU2tpblJld2FyZFR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9Ta2luUmV3YXJkVHlwZVwiKTtcbnZhciBFdmVudHNOYW1lID0gcmVxdWlyZShcIi4uL2V2ZW50cy9FdmVudHNOYW1lXCIpO1xudmFyIFNraW5UeXBlID0gcmVxdWlyZShcIi4uL2VudW0vU2tpblR5cGVcIik7XG5cbnZhciBTa2luSXRlbVRpdGxlQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuXG4gICAgdGhpcy5sYlNraW5UaXRsZSA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKFNraW5JdGVtVGl0bGVDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cblNraW5JdGVtVGl0bGVDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG59O1xuXG4vKipcbiAqIEBwYXJhbSB7c3RyaW5nfSBjb250ZW50XG4gKi9cblNraW5JdGVtVGl0bGVDb250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aCA9IGZ1bmN0aW9uIChjb250ZW50KSB7XG4gICAgdGhpcy5sYlNraW5UaXRsZS5zZXRTdHJpbmcoY29udGVudCk7XG59O1xuXG5Ta2luSXRlbVRpdGxlQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL21lbnUvc2tpbl9pdGVtX3RpdGxlX3ZpZXcuY2NiaVwiLCBudWxsLCBcIlNraW5JdGVtVGl0bGVDb250cm9sbGVyXCIsIG5ldyBTa2luSXRlbVRpdGxlQ29udHJvbGxlcigpKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gU2tpbkl0ZW1UaXRsZUNvbnRyb2xsZXI7IiwidmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xuXG52YXIgU2tpblVubG9ja0NvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcblxuICAgIHRoaXMuc3BTa2luID0gbnVsbDtcbiAgICB0aGlzLmxiR2V0U2tpbiA9IG51bGw7XG4gICAgdGhpcy5sYlRpdGxlID0gbnVsbDtcbiAgICB0aGlzLnNwUmV3YXJkQmcgPSBudWxsO1xuXG4gICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gbnVsbDtcbiAgICB0aGlzLnNraW5DZmcgPSBudWxsO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhTa2luVW5sb2NrQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5Ta2luVW5sb2NrQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xufTtcblxuU2tpblVubG9ja0NvbnRyb2xsZXIucHJvdG90eXBlLmluaXRXaXRoID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgdmFyIHNraW5JZCA9IGdhbWUucGxheWVyTWFuLnBsYXllci53YWl0U2tpbklkO1xuICAgIHZhciBza2luQ2ZnID0gZ2FtZS5jb25maWdNYW4uZ2V0U2tpbkNmZyhza2luSWQpO1xuICAgIHZhciBzcHJpdGVGcmFtZSA9IGNjLnNwcml0ZUZyYW1lQ2FjaGUuZ2V0U3ByaXRlRnJhbWUoc2tpbkNmZy5pbWFnZSArIFwiX2wucG5nXCIpO1xuICAgIGlmIChzcHJpdGVGcmFtZSAhPSBudWxsKSB7XG4gICAgICAgIHRoaXMuc3BTa2luLnNldFNwcml0ZUZyYW1lKHNwcml0ZUZyYW1lKTtcbiAgICB9XG4gICAgdGhpcy5sYkdldFNraW4uc2V0U3RyaW5nKF8oXCJjbGFpbV90aXRsZVwiKSk7XG4gICAgdGhpcy5sYlRpdGxlLnNldFN0cmluZyhfKFwidW5sb2NrX3NraW5fdGl0bGVcIikpO1xuICAgIHRoaXMuY2xvc2VDYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgIHRoaXMuc3BSZXdhcmRCZy5ydW5BY3Rpb24oY2Mucm90YXRlQnkoMiwgMzYwKS5yZXBlYXRGb3JldmVyKCkpO1xufTtcblxuU2tpblVubG9ja0NvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB0aGlzLmNsb3NlKCk7XG59O1xuXG5Ta2luVW5sb2NrQ29udHJvbGxlci5wcm90b3R5cGUud2F0Y2hBZHNDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuY2hlY2tBbmRTaG93UmV3YXJkVmlkZW8oXCJ3YXRjaF9nZXRfc2tpbnNcIiwgZnVuY3Rpb24gKHB1cmNoYXNlZCkge1xuICAgICAgICBpZiAocHVyY2hhc2VkKSB7XG4gICAgICAgICAgICB2YXIgc2tpbklkID0gZ2FtZS5wbGF5ZXJNYW4ucGxheWVyLndhaXRTa2luSWQ7XG4gICAgICAgICAgICB2YXIgc2tpbkNmZyA9IGdhbWUuY29uZmlnTWFuLmdldFNraW5DZmcoc2tpbklkKTtcbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgIGdhbWUuc3RvcmVNYW4ub25Ta2luV2F0Y2hBZHNPd25lZChza2luQ2ZnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5jbG9zZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRTa2luUGVyY2VudCgwKTtcbiAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLnNldFdhaXRTa2luSWQoMCk7XG4gICAgICAgIH1cbiAgICB9LmJpbmQodGhpcykpO1xufTtcblxuU2tpblVubG9ja0NvbnRyb2xsZXIucHJvdG90eXBlLnBvcHVwID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5wb3B1cCh0aGlzLnJvb3ROb2RlLCB7b3ZlcmxheU9wYWNpdHk6IDIyNSwgcG9wdXBBbmltOiB0cnVlfSk7XG59O1xuXG5Ta2luVW5sb2NrQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLmNsb3NlKHRoaXMucm9vdE5vZGUpO1xuICAgIGlmICh0aGlzLmNsb3NlQ2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5jbG9zZUNhbGxiYWNrKCk7XG4gICAgICAgIHRoaXMuY2xvc2VDYWxsYmFjayA9IG51bGw7XG4gICAgfVxufTtcblxuU2tpblVubG9ja0NvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBub2RlID0gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvbm90aWNlL3dhdGNoX2Fkc19za2luX3VubG9ja192aWV3LmNjYmlcIiwgbnVsbCwgXCJTa2luVW5sb2NrQ29udHJvbGxlclwiLCBuZXcgU2tpblVubG9ja0NvbnRyb2xsZXIoKSk7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNraW5VbmxvY2tDb250cm9sbGVyOyIsInZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcbnZhciBDb25maWdNYW4gPSByZXF1aXJlKFwiLi4vY29uZmlnL0NvbmZpZ01hblwiKTtcbnZhciBFdmVudHNOYW1lID0gcmVxdWlyZShcIi4uL2V2ZW50cy9FdmVudHNOYW1lXCIpO1xuXG52YXIgU3BlY2lhbE9mZmVyQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuXG4gICAgdGhpcy5sYlRpdGxlID0gbnVsbDtcblxuICAgIHRoaXMuc3BSZXdhcmQxID0gbnVsbDtcbiAgICB0aGlzLmxiUmV3YXJkMSA9IG51bGw7XG4gICAgdGhpcy5sYlJld2FyZDIgPSBudWxsO1xuICAgIHRoaXMubGJSZXdhcmQzID0gbnVsbDtcbiAgICAvL3RoaXMuc3BSZXdhcmQyID0gbnVsbDtcbiAgICAvL3RoaXMubGJSZXdhcmQyID0gbnVsbDtcbiAgICAvL3RoaXMubGJMZWZ0VGltZSA9IG51bGw7XG5cbiAgICB0aGlzLmxibE9yaWdpbmFsUHJpY2UgPSBudWxsO1xuICAgIHRoaXMubGJQcmljZSA9IG51bGw7XG4gICAgdGhpcy5sYmxEaXNjb3VudCA9IG51bGw7XG5cbiAgICB0aGlzLmJ0blB1cmNoYXNlID0gbnVsbDtcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtTdG9yZUNvbmZpZ31cbiAgICAgKi9cbiAgICB0aGlzLnNwZWNpYWxPZmZlckNmZyA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKFNwZWNpYWxPZmZlckNvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuU3BlY2lhbE9mZmVyQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlci5jYWxsKHRoaXMpO1xuICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLmFkZEV2ZW50TGlzdGVuZXIoRXZlbnRzTmFtZS5QVVJDSEFTRV9FTkQsIHRoaXMub25QdXJjaGFzZUVuZCwgdGhpcyk7XG59O1xuXG5TcGVjaWFsT2ZmZXJDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5ldmVudERpc3BhdGNoZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihFdmVudHNOYW1lLlBVUkNIQVNFX0VORCwgdGhpcy5vblB1cmNoYXNlRW5kLCB0aGlzKTtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0LmNhbGwodGhpcyk7XG59O1xuXG5TcGVjaWFsT2ZmZXJDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG4gICAgdGhpcy5zcGVjaWFsT2ZmZXJDZmcgPSBDb25maWdNYW4uZ2V0SW5zdGFuY2UoKS5nZXRTcGVjaWFsT2ZmZXJDZmcoKTtcbiAgICB0aGlzLmxiVGl0bGUuc2V0U3RyaW5nKF8oXCJzcGVjaWFsX29mZmVyX3RpdGxlXCIpKTtcbiAgICB0aGlzLmxiUmV3YXJkMS5zZXRTdHJpbmcoXCJ4XCIgKyB0aGlzLnNwZWNpYWxPZmZlckNmZy5kYXRhLmRpYW1vbmRzKTtcbiAgICAvL3RoaXMubGJSZXdhcmQyLnNldFN0cmluZyhcInhcIiArIHRoaXMuc3BlY2lhbE9mZmVyQ2ZnLmRhdGEubXVsdGlwbGVfMyk7XG4gICAgLy90aGlzLmxiUmV3YXJkMy5zZXRTdHJpbmcoXCJ4XCIgKyB0aGlzLnNwZWNpYWxPZmZlckNmZy5kYXRhLm5ld18zKTtcblxuXG4gICAgdGhpcy5sYlByaWNlLnNldFN0cmluZyh0aGlzLnNwZWNpYWxPZmZlckNmZy5wcmljZSk7XG4gICAgdGhpcy5sYmxPcmlnaW5hbFByaWNlLnNldFN0cmluZyh0aGlzLnNwZWNpYWxPZmZlckNmZy5vcmlnaW5hbF9wcmljZSk7XG4gICAgdGhpcy5sYmxEaXNjb3VudC5zZXRTdHJpbmcoZ2FtZS51dGlscy5zcHJpbnRmKF8oXCJtb3JlX3RpdGxlXCIpLCBcIlwiICsgKHRoaXMuc3BlY2lhbE9mZmVyQ2ZnLmRpc2NvdW50X211bHRpICogMTAwKSkpO1xufTtcblxuU3BlY2lhbE9mZmVyQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uIChjbG9zZUNhbGxiYWNrKSB7XG4gICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gY2xvc2VDYWxsYmFjaztcbn07XG5cblNwZWNpYWxPZmZlckNvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB0aGlzLmNsb3NlKCk7XG59O1xuXG5TcGVjaWFsT2ZmZXJDb250cm9sbGVyLnByb3RvdHlwZS5vblB1cmNoYXNlRW5kID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgdmFyIHN1Y2Nlc3MgPSBldmVudC5nZXRVc2VyRGF0YSgpO1xuICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmJ0blB1cmNoYXNlLmVuYWJsZWQgPSB0cnVlO1xuICAgIH1cbn07XG5cblNwZWNpYWxPZmZlckNvbnRyb2xsZXIucHJvdG90eXBlLm9uUHVyY2hhc2UgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgdGhpcy5idG5QdXJjaGFzZS5lbmFibGVkID0gZmFsc2U7XG4gICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5idXlQcm9kdWN0KHRoaXMuc3BlY2lhbE9mZmVyQ2ZnKTtcbn07XG5cblNwZWNpYWxPZmZlckNvbnRyb2xsZXIucHJvdG90eXBlLnBvcHVwID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5wb3B1cCh0aGlzLnJvb3ROb2RlLCB7cG9wdXBBbmltOiB0cnVlfSk7XG59O1xuXG5TcGVjaWFsT2ZmZXJDb250cm9sbGVyLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIuY2xvc2UodGhpcy5yb290Tm9kZSk7XG4gICAgaWYgKHRoaXMuY2xvc2VDYWxsYmFjaykge1xuICAgICAgICB0aGlzLmNsb3NlQ2FsbGJhY2soKTtcbiAgICAgICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gbnVsbDtcbiAgICB9XG59O1xuXG5TcGVjaWFsT2ZmZXJDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL3N0b3JlL3NwZWNpYWxfb2ZmZXJfdmlldy5jY2JpXCIsIG51bGwsIFwiU3BlY2lhbE9mZmVyQ29udHJvbGxlclwiLCBuZXcgU3BlY2lhbE9mZmVyQ29udHJvbGxlcigpKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gU3BlY2lhbE9mZmVyQ29udHJvbGxlcjsiLCJ2YXIgTXVsdGlDb2xUYWJsZVZpZXcgPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uL2V4dC9NdWx0aUNvbFRhYmxlVmlld1wiKTtcbnZhciBTdG9yZUl0ZW1Db250cm9sbGVyID0gcmVxdWlyZShcIi4vU3RvcmVJdGVtQ29udHJvbGxlclwiKTtcbnZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcbnZhciBTa2luSXRlbUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi9Ta2luSXRlbUNvbnRyb2xsZXJcIik7XG52YXIgQm9hcmRJdGVtQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuL0JvYXJkSXRlbUNvbnRyb2xsZXJcIik7XG52YXIgU2tpbkl0ZW1UaXRsZUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi9Ta2luSXRlbVRpdGxlQ29udHJvbGxlclwiKTtcbnZhciBDb25maWdNYW4gPSByZXF1aXJlKFwiLi4vY29uZmlnL0NvbmZpZ01hblwiKTtcbnZhciBTdG9yZVR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9TdG9yZVR5cGVcIik7XG52YXIgRXZlbnRzTmFtZSA9IHJlcXVpcmUoXCIuLi9ldmVudHMvRXZlbnRzTmFtZVwiKTtcblxudmFyIFN0b3JlVGFiID0ge1xuICAgIERJQU1PTkRTOiAwLFxuICAgIFNLSU5TOiAxLFxuICAgIEJPQVJEOiAyXG59O1xuXG52YXIgVGFiVmlzdWFsQ29uZmlnID0ge307XG5UYWJWaXN1YWxDb25maWdbU3RvcmVUYWIuRElBTU9ORFNdID0ge1xuICAgIHRhYk5vZGU6IFwidGFiRGlhbW9uZHNMaWdodFwiLFxuICAgIHVuc2VsZWN0Tm9kZTogXCJ0YWJEaWFtb25kc0RhcmtcIixcbiAgICBjb250ZW50Tm9kZTpcImRpYW1vbmRzQ29udGVudE5vZGVcIlxufTtcblRhYlZpc3VhbENvbmZpZ1tTdG9yZVRhYi5TS0lOU10gPSB7XG4gICAgdGFiTm9kZTpcInRhYlNraW5MaWdodFwiLFxuICAgIHVuc2VsZWN0Tm9kZTpcInRhYlNraW5EYXJrXCIsXG4gICAgY29udGVudE5vZGU6XCJza2luQ29udGVudE5vZGVcIlxufTtcblRhYlZpc3VhbENvbmZpZ1tTdG9yZVRhYi5CT0FSRF0gPSB7XG4gICAgdGFiTm9kZTpcInRhYkJvYXJkTGlnaHRcIixcbiAgICB1bnNlbGVjdE5vZGU6XCJ0YWJCb2FyZERhcmtcIixcbiAgICBjb250ZW50Tm9kZTpcImJvYXJkQ29udGVudE5vZGVcIlxufTtcbnZhciBTdG9yZVNpemUgPSBjYy5zaXplKDU3MSwgMTEwKTtcbnZhciBTa2luU2l6ZSA9IGNjLnNpemUoMjg1LCAyMDApO1xudmFyIFNraW5UaXRsZVNpemUgPSBjYy5zaXplKDU3MSwgNTgpO1xuXG52YXIgU3RvcmVJdGVtQ2VsbFZpZXcgPSBjYy5UYWJsZVZpZXdDZWxsLmV4dGVuZCh7XG4gICAgZW50aXR5OiBudWxsLFxuICAgIGl0ZW1Ob2RlOiBudWxsLFxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICAgICAgdGhpcy5pdGVtTm9kZSA9IFN0b3JlSXRlbUNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICB0aGlzLmFkZENoaWxkKHRoaXMuaXRlbU5vZGUpO1xuICAgICAgICB0aGlzLml0ZW1Ob2RlLnNldFBvc2l0aW9uKGNjLnAoU3RvcmVTaXplLndpZHRoICogMC41LCBTdG9yZVNpemUuaGVpZ2h0ICogMC41KSk7XG4gICAgfSxcblxuICAgIGluaXRXaXRoOiBmdW5jdGlvbiAoZW50aXR5LCBpZHgpIHtcbiAgICAgICAgdGhpcy5lbnRpdHkgPSBlbnRpdHk7XG4gICAgICAgIHRoaXMuaXRlbU5vZGUuY29udHJvbGxlci5pbml0V2l0aChlbnRpdHksIGlkeCk7XG4gICAgfVxufSk7XG5cbnZhciBTa2luSXRlbUNlbGxWaWV3ID0gY2MuVGFibGVWaWV3Q2VsbC5leHRlbmQoe1xuICAgIGVudGl0eTogbnVsbCxcbiAgICBpdGVtTm9kZTogbnVsbCxcbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICAgIHRoaXMuaXRlbU5vZGUgPSBTa2luSXRlbUNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICB0aGlzLmFkZENoaWxkKHRoaXMuaXRlbU5vZGUpO1xuICAgICAgICB0aGlzLml0ZW1Ob2RlLnNldFBvc2l0aW9uKGNjLnAoU2tpblNpemUud2lkdGggKiAwLjUsIFNraW5TaXplLmhlaWdodCAqIDAuNSkpO1xuICAgIH0sXG5cbiAgICBpbml0V2l0aDogZnVuY3Rpb24gKGVudGl0eSwgaWR4KSB7XG4gICAgICAgIHRoaXMuZW50aXR5ID0gZW50aXR5O1xuICAgICAgICB0aGlzLml0ZW1Ob2RlLmNvbnRyb2xsZXIuaW5pdFdpdGgoZW50aXR5LCBpZHgpO1xuICAgIH1cbn0pO1xuXG52YXIgQm9hcmRJdGVtQ2VsbFZpZXcgPSBjYy5UYWJsZVZpZXdDZWxsLmV4dGVuZCh7XG4gICAgZW50aXR5OiBudWxsLFxuICAgIGl0ZW1Ob2RlOiBudWxsLFxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICAgICAgdGhpcy5pdGVtTm9kZSA9IEJvYXJkSXRlbUNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICB0aGlzLmFkZENoaWxkKHRoaXMuaXRlbU5vZGUpO1xuICAgICAgICB0aGlzLml0ZW1Ob2RlLnNldFBvc2l0aW9uKGNjLnAoU2tpblNpemUud2lkdGggKiAwLjUsIFNraW5TaXplLmhlaWdodCAqIDAuNSkpO1xuICAgIH0sXG5cbiAgICBpbml0V2l0aDogZnVuY3Rpb24gKGVudGl0eSwgaWR4KSB7XG4gICAgICAgIHRoaXMuZW50aXR5ID0gZW50aXR5O1xuICAgICAgICB0aGlzLml0ZW1Ob2RlLmNvbnRyb2xsZXIuaW5pdFdpdGgoZW50aXR5LCBpZHgpO1xuICAgIH1cbn0pO1xuXG52YXIgU2tpbkl0ZW1UaXRsZUNlbGxWaWV3ID0gY2MuVGFibGVWaWV3Q2VsbC5leHRlbmQoe1xuICAgIC8vZW50aXR5OiBudWxsLFxuICAgIGl0ZW1Ob2RlOiBudWxsLFxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICAgICAgdGhpcy5pdGVtTm9kZSA9IFNraW5JdGVtVGl0bGVDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgdGhpcy5hZGRDaGlsZCh0aGlzLml0ZW1Ob2RlKTtcbiAgICAgICAgdGhpcy5pdGVtTm9kZS5zZXRQb3NpdGlvbihjYy5wKFNraW5UaXRsZVNpemUud2lkdGggKiAwLjUsIFNraW5UaXRsZVNpemUuaGVpZ2h0ICogMC41KSk7XG4gICAgfSxcblxuICAgIGluaXRXaXRoOiBmdW5jdGlvbiAoY29udGVudCkge1xuICAgICAgICAvL3RoaXMuZW50aXR5ID0gZW50aXR5O1xuICAgICAgICB0aGlzLml0ZW1Ob2RlLmNvbnRyb2xsZXIuaW5pdFdpdGgoY29udGVudCk7XG4gICAgfVxufSk7XG5cbnZhciBTS0lOX1RJVExFX0NPTF9JTkRFWCA9IDEyO1xuXG52YXIgU3RvcmVDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG4gICAgLy90aGlzLmxiQ2hhcHRlck5hbWUgPSBudWxsO1xuICAgIHRoaXMubmRDb250YWluZXIgPSBudWxsO1xuXG4gICAgdGhpcy5uZFRpdGxlID0gbnVsbDtcbiAgICB0aGlzLmxiU3RvcmVOYW1lID0gbnVsbDtcblxuICAgIHRoaXMubGJEaWFtb25kcyA9IG51bGw7XG5cbiAgICAvL3VzZXIgZGF0YS5cbiAgICB0aGlzLmNvbmZpZ3MgPSBudWxsO1xuICAgIHRoaXMuY2xvc2VDYWxsYmFjayA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKFN0b3JlQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5TdG9yZUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRXhpdCA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5yZW1vdmVFdmVudExpc3RlbmVyKEV2ZW50c05hbWUuRElBTU9ORFNfVVBEQVRFLCB0aGlzLm9uVXBkYXRlRGlhbW9uZHMsIHRoaXMpO1xuICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoRXZlbnRzTmFtZS5VUERBVEVfQUlNX0lURU0sIHRoaXMub25VcGRhdGVBaW1JdGVtLCB0aGlzKTtcbiAgICBpZiAodGhpcy5jbG9zZUNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuY2xvc2VDYWxsYmFjaygpO1xuICAgICAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBudWxsO1xuICAgIH1cbn07XG5cblN0b3JlQ29udHJvbGxlci5wcm90b3R5cGUub25FbnRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5hZGRFdmVudExpc3RlbmVyKEV2ZW50c05hbWUuVVBEQVRFX0FJTV9JVEVNLCB0aGlzLm9uVXBkYXRlQWltSXRlbSwgdGhpcyk7XG4gICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuYWRkRXZlbnRMaXN0ZW5lcihFdmVudHNOYW1lLkRJQU1PTkRTX1VQREFURSwgdGhpcy5vblVwZGF0ZURpYW1vbmRzLCB0aGlzKTtcbiAgICAvL3RoaXMucmVmcmVzaFVJKCk7XG4gICAgdGhpcy5vblVwZGF0ZURpYW1vbmRzKCk7XG59O1xuXG5TdG9yZUNvbnRyb2xsZXIucHJvdG90eXBlLm9uVXBkYXRlRGlhbW9uZHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5sYkRpYW1vbmRzLnNldFN0cmluZyhnYW1lLnBsYXllck1hbi5nZXREaWFtb25kcygpKTtcbn07XG5cblN0b3JlQ29udHJvbGxlci5wcm90b3R5cGUub25VcGRhdGVBaW1JdGVtID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBkaWFtb25kc1RhYmxlVmlldyA9IHRoaXNbVGFiVmlzdWFsQ29uZmlnW1N0b3JlVGFiLkRJQU1PTkRTXS5jb250ZW50Tm9kZV07XG4gICAgaWYgKGRpYW1vbmRzVGFibGVWaWV3KSB7XG4gICAgICAgIGRpYW1vbmRzVGFibGVWaWV3LnJlbG9hZERhdGEoKTtcbiAgICB9XG59O1xuXG5TdG9yZUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcbiAgICB0aGlzLmxiU3RvcmVOYW1lLnNldFN0cmluZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwic3RvcmVfdGl0bGVcIikpO1xuICAgIHRoaXMuaW5pdFN0b3JlVUkoKTtcbn07XG5cblN0b3JlQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdFN0b3JlVUkgPSBmdW5jdGlvbiAoKSB7XG4gICAgLy92YXIgb3JpZ2luYWxUYWIgPSB0aGlzLmN1cnJlbnRUYWI7XG4gICAgdmFyIHNraW5Db25maWdzID0gQ29uZmlnTWFuLmdldEluc3RhbmNlKCkuZ2V0U2tpbkxpc3QoKTtcbiAgICBjYy5sb2coXCJza2luQ29uZmlncyBsZW5ndGg6XCIgKyBza2luQ29uZmlncy5sZW5ndGgpO1xuICAgIC8vdGhpcy5jdXJyZW50VGFiID0gU3RvcmVUYWIuU0tJTlM7XG4gICAgdGhpc1tUYWJWaXN1YWxDb25maWdbU3RvcmVUYWIuU0tJTlNdLmNvbnRlbnROb2RlXSA9IHRoaXMuZ2V0VGFibGVWaWV3KHtcbiAgICAgICAgZ3JpZEF0SW5kZXg6IGZ1bmN0aW9uIChtdWx0aVRhYmxlLCBpZHgpIHtcbiAgICAgICAgICAgIC8vdmFyIGNlbGwgPSBtdWx0aVRhYmxlLmRlcXVldWVHcmlkKCk7XG4gICAgICAgICAgICAvL2lmICghY2VsbCkge1xuICAgICAgICAgICAgLy8gICAgY2VsbCA9IG5ldyBTa2luSXRlbUNlbGxWaWV3KCk7XG4gICAgICAgICAgICAvL31cbiAgICAgICAgICAgIHZhciBza2luQ2VsbDtcbiAgICAgICAgICAgIHZhciBza2luVGl0bGVDZWxsO1xuICAgICAgICAgICAgaWYgKGlkeCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHNraW5UaXRsZUNlbGwgPSBuZXcgU2tpbkl0ZW1UaXRsZUNlbGxWaWV3KCk7XG4gICAgICAgICAgICAgICAgc2tpblRpdGxlQ2VsbC5pbml0V2l0aChfKFwid2F0Y2hfYWRzX2dldF9za2luX3RpdGxlXCIpKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaWR4ID09PSAxKSB7XG4gICAgICAgICAgICAgICAgc2tpblRpdGxlQ2VsbCA9IG5ldyBTa2luSXRlbVRpdGxlQ2VsbFZpZXcoKTtcbiAgICAgICAgICAgICAgICBza2luVGl0bGVDZWxsLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaWR4ID09PSBTS0lOX1RJVExFX0NPTF9JTkRFWCAqIDIpIHtcbiAgICAgICAgICAgICAgICBza2luVGl0bGVDZWxsID0gbmV3IFNraW5JdGVtVGl0bGVDZWxsVmlldygpO1xuICAgICAgICAgICAgICAgIHNraW5UaXRsZUNlbGwuaW5pdFdpdGgoXyhcImNvc3RfZGlhbW9uZHNfZ2V0X3NraW5fdGl0bGVcIikpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChpZHggPT09IFNLSU5fVElUTEVfQ09MX0lOREVYICogMiArIDEpIHtcbiAgICAgICAgICAgICAgICBza2luVGl0bGVDZWxsID0gbmV3IFNraW5JdGVtVGl0bGVDZWxsVmlldygpO1xuICAgICAgICAgICAgICAgIHNraW5UaXRsZUNlbGwudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBza2luQ2VsbCA9IG5ldyBTa2luSXRlbUNlbGxWaWV3KCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChza2luQ2VsbCkge1xuICAgICAgICAgICAgICAgIHZhciBjb25maWc7XG4gICAgICAgICAgICAgICAgaWYgKGlkeCA+IDEgJiYgaWR4IDwgU0tJTl9USVRMRV9DT0xfSU5ERVggKiAyKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZyA9IHNraW5Db25maWdzW2lkeCAtIDJdO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZyA9IHNraW5Db25maWdzW2lkeCAtIDRdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgICAgIHNraW5DZWxsLmluaXRXaXRoKGNvbmZpZywgaWR4KTtcbiAgICAgICAgICAgICAgICAgICAgc2tpbkNlbGwudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2tpbkNlbGwudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHNraW5DZWxsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNraW5DZWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHNraW5UaXRsZUNlbGw7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbnVtYmVyT2ZDZWxsc0luVGFibGVWaWV3OiBmdW5jdGlvbiAobXVsdGlUYWJsZSkge1xuICAgICAgICAgICAgdmFyIGdyaWRzSW5DZWxsID0gdGhpcy5udW1iZXJPZkdyaWRzSW5DZWxsKG11bHRpVGFibGUpO1xuICAgICAgICAgICAgcmV0dXJuIE1hdGguY2VpbChza2luQ29uZmlncy5sZW5ndGggLyBncmlkc0luQ2VsbCkgKyAyO1xuICAgICAgICB9LFxuXG4gICAgICAgIG51bWJlck9mR3JpZHNJbkNlbGw6IGZ1bmN0aW9uIChtdWx0aVRhYmxlLCBjb2xJZHgpIHtcbiAgICAgICAgICAgIHJldHVybiAyO1xuICAgICAgICB9LFxuXG4gICAgICAgIGdyaWRTaXplRm9yVGFibGU6IGZ1bmN0aW9uICh0YWJsZSwgY29sSWR4KSB7XG4gICAgICAgICAgICAvL3JldHVybiBjYy5zaXplKDIwMCwgMjAwKTtcbiAgICAgICAgICAgIGlmIChjb2xJZHggPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY2Muc2l6ZShTa2luVGl0bGVTaXplLndpZHRoLCBTa2luVGl0bGVTaXplLmhlaWdodCArIDE1KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29sSWR4ID09PSBTS0lOX1RJVExFX0NPTF9JTkRFWCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjYy5zaXplKFNraW5UaXRsZVNpemUud2lkdGgsIFNraW5UaXRsZVNpemUuaGVpZ2h0KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNjLnNpemUoU2tpblNpemUud2lkdGgsIFNraW5TaXplLmhlaWdodCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LCB7XG4gICAgICAgIGdyaWRUb3VjaGVkOiBmdW5jdGlvbiAodGFibGUsIGdyaWQpIHtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgdmFyIGJvYXJkQ29uZmlncyA9IENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldEJvYXJkTGlzdCgpO1xuXG4gICAgdGhpc1tUYWJWaXN1YWxDb25maWdbU3RvcmVUYWIuQk9BUkRdLmNvbnRlbnROb2RlXSA9IHRoaXMuZ2V0VGFibGVWaWV3KHtcbiAgICAgICAgZ3JpZEF0SW5kZXg6IGZ1bmN0aW9uIChtdWx0aVRhYmxlLCBpZHgpIHtcbiAgICAgICAgICAgIHZhciBjZWxsID0gbXVsdGlUYWJsZS5kZXF1ZXVlR3JpZCgpO1xuICAgICAgICAgICAgaWYgKCFjZWxsKSB7XG4gICAgICAgICAgICAgICBjZWxsID0gbmV3IEJvYXJkSXRlbUNlbGxWaWV3KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgY29uZmlnID0gYm9hcmRDb25maWdzW2lkeF07XG4gICAgICAgICAgICBpZiAoY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgY2VsbC5pbml0V2l0aChjb25maWcpO1xuICAgICAgICAgICAgICAgIGNlbGwudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNlbGwudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gY2VsbDtcbiAgICAgICAgfSxcblxuICAgICAgICBudW1iZXJPZkNlbGxzSW5UYWJsZVZpZXc6IGZ1bmN0aW9uIChtdWx0aVRhYmxlKSB7XG4gICAgICAgICAgICB2YXIgZ3JpZHNJbkNlbGwgPSB0aGlzLm51bWJlck9mR3JpZHNJbkNlbGwobXVsdGlUYWJsZSk7XG4gICAgICAgICAgICByZXR1cm4gTWF0aC5jZWlsKGJvYXJkQ29uZmlncy5sZW5ndGggLyBncmlkc0luQ2VsbCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbnVtYmVyT2ZHcmlkc0luQ2VsbDogZnVuY3Rpb24gKG11bHRpVGFibGUsIGNvbElkeCkge1xuICAgICAgICAgICAgcmV0dXJuIDI7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ3JpZFNpemVGb3JUYWJsZTogZnVuY3Rpb24gKHRhYmxlLCBjb2xJZHgpIHtcbiAgICAgICAgICAgIHJldHVybiBjYy5zaXplKFNraW5TaXplLndpZHRoLCBTa2luU2l6ZS5oZWlnaHQpO1xuICAgICAgICB9XG4gICAgfSwge1xuICAgICAgICBncmlkVG91Y2hlZDogZnVuY3Rpb24gKHRhYmxlLCBncmlkKSB7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIHZhciBkaWFtb25kQ29uZmlncztcbiAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4ucGxheWVyLmlzQWltVmVyc2lvbikge1xuICAgICAgICBkaWFtb25kQ29uZmlncyA9IENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldFN0b3JlTGlzdFdpdGhvdXRGaXJzdFB1cmNoYXNlQW5kQWltSXRlbSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGRpYW1vbmRDb25maWdzID0gQ29uZmlnTWFuLmdldEluc3RhbmNlKCkuZ2V0U3RvcmVMaXN0V2l0aG91dEZpcnN0UHVyY2hhc2UoKTtcbiAgICB9XG4gICAgLy90aGlzLmN1cnJlbnRUYWIgPSBTdG9yZVRhYi5ESUFNT05EUztcbiAgICB0aGlzW1RhYlZpc3VhbENvbmZpZ1tTdG9yZVRhYi5ESUFNT05EU10uY29udGVudE5vZGVdID0gdGhpcy5nZXRUYWJsZVZpZXcoe1xuICAgICAgICBncmlkQXRJbmRleDogZnVuY3Rpb24gKG11bHRpVGFibGUsIGlkeCkge1xuICAgICAgICAgICAgdmFyIGNlbGwgPSBtdWx0aVRhYmxlLmRlcXVldWVHcmlkKCk7XG4gICAgICAgICAgICBpZiAoIWNlbGwpIHtcbiAgICAgICAgICAgICAgICBjZWxsID0gbmV3IFN0b3JlSXRlbUNlbGxWaWV3KCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChpZHggPCBkaWFtb25kQ29uZmlncy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB2YXIgY29uZmlnID0gZGlhbW9uZENvbmZpZ3NbaWR4XTtcbiAgICAgICAgICAgICAgICBjZWxsLmluaXRXaXRoKGNvbmZpZywgaWR4KTtcbiAgICAgICAgICAgICAgICBjZWxsLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjZWxsLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGNlbGw7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbnVtYmVyT2ZDZWxsc0luVGFibGVWaWV3OiBmdW5jdGlvbiAobXVsdGlUYWJsZSkge1xuICAgICAgICAgICAgcmV0dXJuIGRpYW1vbmRDb25maWdzLmxlbmd0aDtcbiAgICAgICAgfSxcblxuICAgICAgICBudW1iZXJPZkdyaWRzSW5DZWxsOiBmdW5jdGlvbiAobXVsdGlUYWJsZSwgY29sSWR4KSB7XG4gICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgfSxcblxuICAgICAgICBncmlkU2l6ZUZvclRhYmxlOiBmdW5jdGlvbiAodGFibGUsIGNvbElkeCkge1xuICAgICAgICAgICAgcmV0dXJuIFN0b3JlU2l6ZTtcbiAgICAgICAgfVxuICAgIH0sIHtcbiAgICAgICAgZ3JpZFRvdWNoZWQ6IGZ1bmN0aW9uICh0YWJsZSwgZ3JpZCkge1xuICAgICAgICAgICAgLy9jYy5sb2coXCJncmlkIHRvdWNoZWQgYXQgaW5kZXg6IFwiICsgZ3JpZC5nZXRJZHgoKSk7XG4gICAgICAgICAgICAvL3ZhciBlbnRpdHkgPSBncmlkLmVudGl0eTtcbiAgICAgICAgICAgIC8vQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgICAgICAgICAvL1N0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuYnV5UHJvZHVjdChlbnRpdHkpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvL3RoaXMuY3VycmVudFRhYiA9IG9yaWdpbmFsVGFiO1xufTtcblxuU3RvcmVDb250cm9sbGVyLnByb3RvdHlwZS5yZWZyZXNoVUkgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmN1cnJlbnRUYWIgPSB0aGlzLmN1cnJlbnRUYWIgfHwgU3RvcmVUYWIuRElBTU9ORFM7XG4gICAgY2MubG9nKFwiU3RvcmVDb250cm9sbGVyLnByb3RvdHlwZS5yZWZyZXNoVUk6XCIgKyB0aGlzLmN1cnJlbnRUYWIpO1xuICAgIC8vdGhpcy5jdXJyZW50VGFiID0gU3RvcmVUYWIuU0tJTlM7XG4gICAgZm9yKHZhciBpIGluIFRhYlZpc3VhbENvbmZpZykge1xuICAgICAgICAvL3ZhciB0YWJOb2RlID0gdGhpc1tUYWJWaXN1YWxDb25maWdbaV0udGFiTm9kZV07XG4gICAgICAgIHZhciB1blNlbGVjdE5vZGUgPSB0aGlzW1RhYlZpc3VhbENvbmZpZ1tpXS51bnNlbGVjdE5vZGVdO1xuICAgICAgICB2YXIgY29udGVudE5vZGUgPSB0aGlzW1RhYlZpc3VhbENvbmZpZ1tpXS5jb250ZW50Tm9kZV07XG4gICAgICAgIC8vdGFiTm9kZSAmJiB0YWJOb2RlLnNldFZpc2libGUoTnVtYmVyKGkpID09PSB0aGlzLmN1cnJlbnRUYWIpO1xuICAgICAgICBjb250ZW50Tm9kZSAmJiBjb250ZW50Tm9kZS5zZXRWaXNpYmxlKE51bWJlcihpKSA9PT0gdGhpcy5jdXJyZW50VGFiKTtcbiAgICAgICAgdW5TZWxlY3ROb2RlICYmIHVuU2VsZWN0Tm9kZS5zZXRWaXNpYmxlKE51bWJlcihpKSAhPT0gdGhpcy5jdXJyZW50VGFiKTtcbiAgICB9XG59O1xuXG5TdG9yZUNvbnRyb2xsZXIucHJvdG90eXBlLmluaXRXaXRoID0gZnVuY3Rpb24gKHR5cGUsIGNhbGxiYWNrKSB7XG4gICAgY2MubG9nKFwiU3RvcmVDb250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aDpcIiArIHR5cGUpO1xuICAgIGlmICh0eXBlID09PSBTdG9yZVR5cGUuU0tJTikge1xuICAgICAgICB0aGlzLmN1cnJlbnRUYWIgPSBTdG9yZVRhYi5TS0lOUztcbiAgICB9IGVsc2UgaWYgKHR5cGUgPT09IFN0b3JlVHlwZS5ESUFNT05EKSB7XG4gICAgICAgIHRoaXMuY3VycmVudFRhYiA9IFN0b3JlVGFiLkRJQU1PTkRTO1xuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gU3RvcmVUeXBlLkJPQVJEX1NLSU4pIHtcbiAgICAgICAgdGhpcy5jdXJyZW50VGFiID0gU3RvcmVUYWIuQk9BUkQ7XG4gICAgfVxuICAgIHRoaXMucmVmcmVzaFVJKCk7XG4gICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gY2FsbGJhY2s7XG59O1xuXG5TdG9yZUNvbnRyb2xsZXIucHJvdG90eXBlLmdldFRhYmxlVmlldyA9IGZ1bmN0aW9uIChkYXRhU291cmNlLCBkZWxlZ2F0ZSkge1xuICAgIHZhciB0YWJsZVZpZXcgPSBuZXcgTXVsdGlDb2xUYWJsZVZpZXcoZGF0YVNvdXJjZSwgdGhpcy5uZENvbnRhaW5lci5nZXRDb250ZW50U2l6ZSgpLCBudWxsKTtcbiAgICB0YWJsZVZpZXcuc2V0RGlyZWN0aW9uKGNjLlNDUk9MTFZJRVdfRElSRUNUSU9OX1ZFUlRJQ0FMKTtcbiAgICB0YWJsZVZpZXcuc2V0VmVydGljYWxGaWxsT3JkZXIoY2MuVEFCTEVWSUVXX0ZJTExfVE9QRE9XTik7XG4gICAgdGFibGVWaWV3LnNldE11bHRpVGFibGVWaWV3RGVsZWdhdGUoZGVsZWdhdGUpO1xuICAgIHRhYmxlVmlldy5pZ25vcmVBbmNob3JQb2ludEZvclBvc2l0aW9uKGZhbHNlKTtcbiAgICB0YWJsZVZpZXcuc2V0QW5jaG9yUG9pbnQoY2MucCgwLCAwKSk7XG4gICAgdGFibGVWaWV3LnJlbG9hZERhdGEoKTtcbiAgICB0aGlzLm5kQ29udGFpbmVyLmFkZENoaWxkKHRhYmxlVmlldyk7XG4gICAgcmV0dXJuIHRhYmxlVmlldztcbn07XG5cblN0b3JlQ29udHJvbGxlci5wcm90b3R5cGUub25DbGlja1NraW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgdGhpcy5jdXJyZW50VGFiID0gU3RvcmVUYWIuU0tJTlM7XG4gICAgdGhpcy5yZWZyZXNoVUkoKTtcbn07XG5cblN0b3JlQ29udHJvbGxlci5wcm90b3R5cGUub25DbGlja0RpYW1vbmRzID0gZnVuY3Rpb24gKCkge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIHRoaXMuY3VycmVudFRhYiA9IFN0b3JlVGFiLkRJQU1PTkRTO1xuICAgIHRoaXMucmVmcmVzaFVJKCk7XG59O1xuXG5TdG9yZUNvbnRyb2xsZXIucHJvdG90eXBlLm9uQ2xpY2tCb2FyZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB0aGlzLmN1cnJlbnRUYWIgPSBTdG9yZVRhYi5CT0FSRDtcbiAgICB0aGlzLnJlZnJlc2hVSSgpO1xufTtcblxuU3RvcmVDb250cm9sbGVyLnByb3RvdHlwZS5iYWNrQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcblxuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cblN0b3JlQ29udHJvbGxlci5wcm90b3R5cGUucG9wdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLnBvcHVwKHRoaXMucm9vdE5vZGUsIHtwb3B1cEFuaW06IHRydWV9KTtcbn07XG5cblN0b3JlQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLmNsb3NlKHRoaXMucm9vdE5vZGUpO1xufTtcblxuU3RvcmVDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL3N0b3JlL3N0b3JlX3ZpZXcuY2NiaVwiLCBudWxsLCBcIlN0b3JlQ29udHJvbGxlclwiLCBuZXcgU3RvcmVDb250cm9sbGVyKCkpO1xuICAgIHJldHVybiBub2RlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBTdG9yZUNvbnRyb2xsZXI7IiwidmFyIFN0b3JlVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1N0b3JlVHlwZVwiKTtcbnZhciBFdmVudHNOYW1lID0gcmVxdWlyZShcIi4uL2V2ZW50cy9FdmVudHNOYW1lXCIpO1xuXG52YXIgU3RvcmVJdGVtQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuXG4gICAgLy9wcmljZVxuICAgIHRoaXMubGJQcmljZSA9IG51bGw7XG4gICAgdGhpcy5zcFJld2FyZGVkVmlkZW8gPSBudWxsO1xuICAgIHRoaXMubmREaWFtb25kUHJpY2UgPSBudWxsO1xuICAgIHRoaXMubGJEaWFtb25kUHJpY2UgPSBudWxsO1xuXG4gICAgLy9ub2RlXG4gICAgdGhpcy5uZFJlc3RvcmUgPSBudWxsO1xuICAgIHRoaXMubmRCb29zdHMgPSBudWxsO1xuICAgIHRoaXMubmREaWFtb25kID0gbnVsbDtcbiAgICB0aGlzLm5kUHVyY2hhc2UgPSBudWxsO1xuICAgIHRoaXMubmRPd25lZCA9IG51bGw7XG5cbiAgICAvL1xuICAgIHRoaXMubGJTcGxpdCA9IG51bGw7XG4gICAgdGhpcy5sYk5ld1RocmVlID0gbnVsbDtcbiAgICB0aGlzLmxiRGlhbW9uZCA9IG51bGw7XG4gICAgdGhpcy5zcERpYW1vbmQgPSBudWxsO1xuXG4gICAgLy90YWdcbiAgICB0aGlzLnNwSG90VGFnID0gbnVsbDtcbiAgICB0aGlzLnNwRnJlZVRhZyA9IG51bGw7XG4gICAgdGhpcy5zcFBlcmNlbnRUYWcgPSBudWxsO1xuXG4gICAgdGhpcy5zcFJlZEJnID0gbnVsbDtcblxuICAgIHRoaXMubGJUYWcgPSBudWxsO1xuXG4gICAgdGhpcy5idG5DbGFpbSA9IG51bGw7XG5cbiAgICB0aGlzLm5kUmVtaW5kZXIgPSBudWxsO1xuXG4gICAgdGhpcy5pZHggPSAwO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhTdG9yZUl0ZW1Db250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cblN0b3JlSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcbn07XG5cbi8qKlxuICogQHBhcmFtIHtTdG9yZUNvbmZpZ30gZGF0YVxuICogQHBhcmFtIHtudW1iZXJ9IGlkeFxuICovXG5TdG9yZUl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aCA9IGZ1bmN0aW9uIChkYXRhLCBpZHgpIHtcbiAgICB0aGlzLnN0b3JlRW50aXR5ID0gZGF0YTtcbiAgICB0aGlzLmlkeCA9IGlkeDtcbiAgICB0aGlzLmxiUHJpY2Uuc2V0U3RyaW5nKGRhdGEucHJpY2UpO1xuXG4gICAgdHJ5IHtcblxuICAgICAgICB0aGlzLm5kUmVzdG9yZS52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMubmRCb29zdHMudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLm5kRGlhbW9uZC52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMubmRQdXJjaGFzZS52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5uZE93bmVkLnZpc2libGUgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLmxiUHJpY2UudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLm5kRGlhbW9uZFByaWNlLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zcFJld2FyZGVkVmlkZW8udmlzaWJsZSA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMuc3BIb3RUYWcudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLnNwRnJlZVRhZy52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc3BQZXJjZW50VGFnLnZpc2libGUgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLmxiVGFnLnZpc2libGUgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLnNwUmVkQmcudmlzaWJsZSA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMuYnRuQ2xhaW0uZW5hYmxlZCA9IHRydWU7XG5cbiAgICAgICAgdGhpcy5uZFJlbWluZGVyLnZpc2libGUgPSBmYWxzZTtcblxuICAgICAgICB2YXIgc3ByaXRlRnJhbWU7XG4gICAgICAgIHN3aXRjaCAoZGF0YS50eXBlKSB7XG4gICAgICAgICAgICBjYXNlIFN0b3JlVHlwZS5GUkVFOlxuICAgICAgICAgICAgICAgIHRoaXMubmREaWFtb25kLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMubGJEaWFtb25kLnNldFN0cmluZyhkYXRhLmNvdW50KTtcbiAgICAgICAgICAgICAgICB0aGlzLnNwUmV3YXJkZWRWaWRlby52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBzcHJpdGVGcmFtZSA9IGNjLnNwcml0ZUZyYW1lQ2FjaGUuZ2V0U3ByaXRlRnJhbWUoZGF0YS5pbWFnZSk7XG4gICAgICAgICAgICAgICAgaWYgKHNwcml0ZUZyYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3BEaWFtb25kLnNldFNwcml0ZUZyYW1lKHNwcml0ZUZyYW1lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy90YWdcbiAgICAgICAgICAgICAgICB0aGlzLnNwRnJlZVRhZy52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmxiVGFnLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMubGJUYWcuc2V0U3RyaW5nKF8oXCJmcmVlX2NvaW5zX3RpdGxlXCIpKTtcbiAgICAgICAgICAgICAgICB0aGlzLm5kUmVtaW5kZXIudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFN0b3JlVHlwZS5SRU1PVkVfQURTOlxuICAgICAgICAgICAgICAgIHRoaXMubmREaWFtb25kLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMubGJEaWFtb25kLnNldFN0cmluZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwicmVtb3ZlX2Fkc190aXRsZVwiKSk7XG4gICAgICAgICAgICAgICAgc3ByaXRlRnJhbWUgPSBjYy5zcHJpdGVGcmFtZUNhY2hlLmdldFNwcml0ZUZyYW1lKGRhdGEuaW1hZ2UpO1xuICAgICAgICAgICAgICAgIGlmIChzcHJpdGVGcmFtZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNwRGlhbW9uZC5zZXRTcHJpdGVGcmFtZShzcHJpdGVGcmFtZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMubGJQcmljZS52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnNwSG90VGFnLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMubGJUYWcudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5sYlRhZy5zZXRTdHJpbmcoXyhcImhvdF90aXRsZVwiKSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFN0b3JlVHlwZS5BSU1fSVRFTTpcbiAgICAgICAgICAgICAgICB0aGlzLm5kRGlhbW9uZC52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmxiRGlhbW9uZC5zZXRTdHJpbmcoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcImFpbV9pdGVtX3RpdGxlXCIpKTtcbiAgICAgICAgICAgICAgICBzcHJpdGVGcmFtZSA9IGNjLnNwcml0ZUZyYW1lQ2FjaGUuZ2V0U3ByaXRlRnJhbWUoZGF0YS5pbWFnZSk7XG4gICAgICAgICAgICAgICAgaWYgKHNwcml0ZUZyYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3BEaWFtb25kLnNldFNwcml0ZUZyYW1lKHNwcml0ZUZyYW1lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy90aGlzLmxiUHJpY2UudmlzaWJsZSA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4ucGxheWVyLmhhc0FpbUl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5uZE93bmVkLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm5kUHVyY2hhc2UudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubmRQdXJjaGFzZS52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYlByaWNlLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyB0aGlzLnNwSG90VGFnLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIC8vIHRoaXMubGJUYWcudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgLy8gdGhpcy5sYlRhZy5zZXRTdHJpbmcoXyhcImhvdF90aXRsZVwiKSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFN0b3JlVHlwZS5SRVNUT1JFOlxuICAgICAgICAgICAgICAgIHRoaXMubmRSZXN0b3JlLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMubmRQdXJjaGFzZS52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5zcFJlZEJnLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBTdG9yZVR5cGUuTkVXX0FORF9TUExJVDpcbiAgICAgICAgICAgICAgICB0aGlzLm5kQm9vc3RzLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMubGJTcGxpdC5zZXRTdHJpbmcoXCJ4XCIgKyBkYXRhLmRhdGEubXVsdGlwbGVfMyk7XG4gICAgICAgICAgICAgICAgdGhpcy5sYk5ld1RocmVlLnNldFN0cmluZyhcInhcIiArIGRhdGEuZGF0YS5tdWx0aXBsZV8zKTtcbiAgICAgICAgICAgICAgICB0aGlzLm5kRGlhbW9uZFByaWNlLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMubGJEaWFtb25kUHJpY2Uuc2V0U3RyaW5nKGRhdGEuY291bnQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBTdG9yZVR5cGUuRElBTU9ORDpcbiAgICAgICAgICAgICAgICB0aGlzLm5kRGlhbW9uZC52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmxiRGlhbW9uZC5zZXRTdHJpbmcoZGF0YS5jb3VudCk7XG4gICAgICAgICAgICAgICAgdGhpcy5sYlByaWNlLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHNwcml0ZUZyYW1lID0gY2Muc3ByaXRlRnJhbWVDYWNoZS5nZXRTcHJpdGVGcmFtZShkYXRhLmltYWdlKTtcbiAgICAgICAgICAgICAgICBpZiAoc3ByaXRlRnJhbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zcERpYW1vbmQuc2V0U3ByaXRlRnJhbWUoc3ByaXRlRnJhbWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvL3RhZ1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLmV4dHJhID4gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNwUGVyY2VudFRhZy52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYlRhZy52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYlRhZy5zZXRTdHJpbmcoXCIrXCIgKyAoZGF0YS5leHRyYSAqIDEwMCkgKyBcIiVcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfSBjYXRjaCAoZXgpIHtcbiAgICAgICAgY2MuZXJyb3IoZXgpO1xuICAgIH1cbn07XG5cblN0b3JlSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLmdldENvbnRlbnRTaXplID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLnNwQmcuZ2V0Q29udGVudFNpemUoKTtcbn07XG5cblN0b3JlSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLnB1cmNoYXNlQ2xpY2tlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB2YXIgU3RvcmVIZWxwZXIgPSByZXF1aXJlKFwiLi4vbW9kZWwvU3RvcmVIZWxwZXJcIik7XG4gICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5idXlQcm9kdWN0KHRoaXMuc3RvcmVFbnRpdHkpO1xufTtcblxuU3RvcmVJdGVtQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9zdG9yZS9zdG9yZV9pdGVtX3ZpZXcuY2NiaVwiLCBudWxsLCBcIlN0b3JlSXRlbUNvbnRyb2xsZXJcIiwgbmV3IFN0b3JlSXRlbUNvbnRyb2xsZXIoKSk7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFN0b3JlSXRlbUNvbnRyb2xsZXI7IiwidmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xuXG52YXIgU3VwZXJCb2FyZENvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcblxuICAgIHRoaXMuX3RpdGxlTGFiZWwgPSBudWxsO1xuXG4gICAgdGhpcy5zcFJld2FyZEJnID0gbnVsbDtcblxuICAgIHRoaXMuY2xvc2VDYWxsYmFjayA9IG51bGw7XG5cbiAgICB0aGlzLnJld2FyZGVkID0gZmFsc2U7XG4gICAgdGhpcy5yZXdhcmROYW1lID0gXCJcIjtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoU3VwZXJCb2FyZENvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuU3VwZXJCb2FyZENvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcbn07XG5cblN1cGVyQm9hcmRDb250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aCA9IGZ1bmN0aW9uIChyZXdhcmROYW1lLCBjbG9zZUNhbGxiYWNrKSB7XG4gICAgY29uc29sZS5sb2coXCJTdXBlckJvYXJkQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdFwiKTtcbiAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBjbG9zZUNhbGxiYWNrO1xuICAgIHRoaXMucmV3YXJkTmFtZSA9IHJld2FyZE5hbWU7XG5cbiAgICB0aGlzLnNwUmV3YXJkQmcucnVuQWN0aW9uKGNjLnJvdGF0ZUJ5KDIsIDM2MCkucmVwZWF0Rm9yZXZlcigpKTtcbn07XG5cblN1cGVyQm9hcmRDb250cm9sbGVyLnByb3RvdHlwZS5jbG9zZUNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgdGhpcy5jbG9zZSgpO1xufTtcblxuU3VwZXJCb2FyZENvbnRyb2xsZXIucHJvdG90eXBlLndhdGNoQWRzQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5jaGVja0FuZFNob3dSZXdhcmRWaWRlbyh0aGlzLnJld2FyZE5hbWUsIGZ1bmN0aW9uIChyZXdhcmRlZCkge1xuICAgICAgICBpZiAocmV3YXJkZWQpIHtcbiAgICAgICAgICAgIHNlbGYucmV3YXJkZWQgPSB0cnVlO1xuICAgICAgICAgICAgc2VsZi5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgfSk7XG59O1xuXG5TdXBlckJvYXJkQ29udHJvbGxlci5wcm90b3R5cGUucG9wdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLnBvcHVwKHRoaXMucm9vdE5vZGUsIHtvdmVybGF5T3BhY2l0eTogMjEwfSk7XG59O1xuXG5TdXBlckJvYXJkQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLmNsb3NlKHRoaXMucm9vdE5vZGUpO1xuICAgIGlmICh0aGlzLmNsb3NlQ2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5jbG9zZUNhbGxiYWNrKHRoaXMucmV3YXJkZWQpO1xuICAgICAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBudWxsO1xuICAgIH1cbn07XG5cblN1cGVyQm9hcmRDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL25vdGljZS9yZXdhcmRfYmFmZmxlX3ZpZXcuY2NiaVwiLCBudWxsLCBcIlN1cGVyQm9hcmRDb250cm9sbGVyXCIsIG5ldyBTdXBlckJvYXJkQ29udHJvbGxlcigpKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gU3VwZXJCb2FyZENvbnRyb2xsZXI7IiwidmFyIFRhc2tJdGVtQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuL1Rhc2tJdGVtQ29udHJvbGxlclwiKTtcbnZhciBDb25maWdNYW4gPSByZXF1aXJlKFwiLi4vY29uZmlnL0NvbmZpZ01hblwiKTtcbnZhciBFdmVudHNOYW1lID0gcmVxdWlyZShcIi4uL2V2ZW50cy9FdmVudHNOYW1lXCIpO1xudmFyIE11bHRpQ29sVGFibGVWaWV3ID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi9leHQvTXVsdGlDb2xUYWJsZVZpZXdcIik7XG5cbnZhciBHUklEX1NJWkUgPSBjYy5zaXplKDI3MCwgMjAwKTtcblxudmFyIFN0b3JlSXRlbUNlbGxWaWV3ID0gY2MuVGFibGVWaWV3Q2VsbC5leHRlbmQoe1xuICAgIGVudGl0eTogbnVsbCxcbiAgICBpdGVtTm9kZTogbnVsbCxcbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICAgIHRoaXMuaXRlbU5vZGUgPSBUYXNrSXRlbUNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICB0aGlzLmFkZENoaWxkKHRoaXMuaXRlbU5vZGUpO1xuICAgICAgICB0aGlzLml0ZW1Ob2RlLnNldFBvc2l0aW9uKGNjLnAoR1JJRF9TSVpFLndpZHRoICogMC41LCBHUklEX1NJWkUuaGVpZ2h0ICogMC41KSk7XG4gICAgfSxcblxuICAgIGluaXRXaXRoOiBmdW5jdGlvbiAoZW50aXR5LCBpZHgpIHtcbiAgICAgICAgdGhpcy5lbnRpdHkgPSBlbnRpdHk7XG4gICAgICAgIHRoaXMuaXRlbU5vZGUuY29udHJvbGxlci5pbml0V2l0aChlbnRpdHksIGlkeCk7XG4gICAgfVxufSk7XG5cbnZhciBUYXNrQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuICAgIHRoaXMubmRDb250YWluZXIgPSBudWxsO1xuXG4gICAgdGhpcy5sYmxUaXRsZSA9IG51bGw7XG5cbiAgICB0aGlzLl90YWJsZVZpZXcgPSBudWxsO1xuXG4gICAgLy91c2VyIGRhdGEuXG4gICAgdGhpcy5jb25maWdzID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoVGFza0NvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuVGFza0NvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIuY2FsbCh0aGlzKTtcbiAgICAvL2dhbWUuZXZlbnREaXNwYXRjaGVyLmFkZEV2ZW50TGlzdGVuZXIoRXZlbnRzTmFtZS5VUERBVEVfU0tJTiwgdGhpcy5vblVwZGF0ZVNraW4sIHRoaXMpO1xufTtcblxuVGFza0NvbnRyb2xsZXIucHJvdG90eXBlLm9uRXhpdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAvL2dhbWUuZXZlbnREaXNwYXRjaGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoRXZlbnRzTmFtZS5VUERBVEVfU0tJTiwgdGhpcy5vblVwZGF0ZVNraW4sIHRoaXMpO1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQuY2FsbCh0aGlzKTtcbn07XG5cblRhc2tDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG4gICAgdGhpcy5sYmxUaXRsZS5zZXRTdHJpbmcoXyhcInRhc2tfdGl0bGVcIikpO1xuXG4gICAgdGhpcy5jb25maWdzID0gQ29uZmlnTWFuLmdldEluc3RhbmNlKCkuZ2V0VGFza0xpc3QoKTtcbiAgICB0aGlzLnNob3dUYWJsZVZpZXcoKTtcbn07XG5cblRhc2tDb250cm9sbGVyLnByb3RvdHlwZS5vblVwZGF0ZVNraW4gPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICB0aGlzLnNob3dUYWJsZVZpZXcoKTtcbn07XG5cblRhc2tDb250cm9sbGVyLnByb3RvdHlwZS5zaG93VGFibGVWaWV3ID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICghdGhpcy5fdGFibGVWaWV3KSB7XG4gICAgICAgIHZhciBzaXplID0gdGhpcy5uZENvbnRhaW5lci5nZXRDb250ZW50U2l6ZSgpO1xuICAgICAgICB0aGlzLl90YWJsZVZpZXcgPSBuZXcgTXVsdGlDb2xUYWJsZVZpZXcodGhpcywgc2l6ZSwgbnVsbCk7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5zZXREaXJlY3Rpb24oY2MuU0NST0xMVklFV19ESVJFQ1RJT05fVkVSVElDQUwpO1xuICAgICAgICB0aGlzLl90YWJsZVZpZXcuc2V0VmVydGljYWxGaWxsT3JkZXIoY2MuVEFCTEVWSUVXX0ZJTExfVE9QRE9XTik7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5zZXRNdWx0aVRhYmxlVmlld0RlbGVnYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLl90YWJsZVZpZXcuaWdub3JlQW5jaG9yUG9pbnRGb3JQb3NpdGlvbihmYWxzZSk7XG4gICAgICAgIHRoaXMuX3RhYmxlVmlldy5zZXRBbmNob3JQb2ludChjYy5wKDAsIDApKTtcbiAgICAgICAgdGhpcy5uZENvbnRhaW5lci5hZGRDaGlsZCh0aGlzLl90YWJsZVZpZXcpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX29mZnNldCA9IHRoaXMuX3RhYmxlVmlldy5nZXRDb250ZW50T2Zmc2V0KCk7XG4gICAgfVxuICAgIHRoaXMuX3RhYmxlVmlldy5yZWxvYWREYXRhKCk7XG4gICAgaWYgKHRoaXMuX29mZnNldCkge1xuICAgICAgICB0aGlzLl90YWJsZVZpZXcuc2V0Q29udGVudE9mZnNldCh0aGlzLl9vZmZzZXQpO1xuICAgICAgICB0aGlzLl9vZmZzZXQgPSBudWxsO1xuICAgIH1cbn07XG5cblRhc2tDb250cm9sbGVyLnByb3RvdHlwZS5zY3JvbGxWaWV3RGlkU2Nyb2xsID0gZnVuY3Rpb24gKHZpZXcpIHtcbn07XG5cblRhc2tDb250cm9sbGVyLnByb3RvdHlwZS5zY3JvbGxWaWV3RGlkWm9vbSA9IGZ1bmN0aW9uICh2aWV3KSB7XG59O1xuXG5UYXNrQ29udHJvbGxlci5wcm90b3R5cGUuZ3JpZEF0SW5kZXggPSBmdW5jdGlvbihtdWx0aVRhYmxlLCAgaWR4KSB7XG4gICAgdmFyIGNlbGwgPSBtdWx0aVRhYmxlLmRlcXVldWVHcmlkKCk7XG4gICAgaWYgKCFjZWxsKSB7XG4gICAgICAgIGNlbGwgPSBuZXcgU3RvcmVJdGVtQ2VsbFZpZXcoKTtcbiAgICB9XG5cbiAgICBpZiAoaWR4IDwgdGhpcy5jb25maWdzLmxlbmd0aCkge1xuICAgICAgICB2YXIgc2tpbkNmZyA9IHRoaXMuY29uZmlnc1tpZHhdO1xuICAgICAgICBjZWxsLmluaXRXaXRoKHNraW5DZmcsIGlkeCk7XG4gICAgICAgIGNlbGwudmlzaWJsZSA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY2VsbC52aXNpYmxlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIGNlbGw7XG59O1xuXG5UYXNrQ29udHJvbGxlci5wcm90b3R5cGUubnVtYmVyT2ZDZWxsc0luVGFibGVWaWV3ID0gZnVuY3Rpb24obXVsdGlUYWJsZSkge1xuICAgIHZhciBncmlkc0luQ2VsbCA9IHRoaXMubnVtYmVyT2ZHcmlkc0luQ2VsbChtdWx0aVRhYmxlKTtcbiAgICByZXR1cm4gTWF0aC5jZWlsKHRoaXMuY29uZmlncy5sZW5ndGggLyBncmlkc0luQ2VsbCk7XG59O1xuXG5UYXNrQ29udHJvbGxlci5wcm90b3R5cGUubnVtYmVyT2ZHcmlkc0luQ2VsbCA9IGZ1bmN0aW9uKG11bHRpVGFibGUsIGNvbElkeCkge1xuICAgIHJldHVybiAyO1xufTtcblxuVGFza0NvbnRyb2xsZXIucHJvdG90eXBlLmdyaWRTaXplRm9yVGFibGUgPSBmdW5jdGlvbih0YWJsZSwgY29sSWR4KSB7XG4gICAgcmV0dXJuIGNjLnNpemUoMjcwLCAyMjApO1xufTtcblxuVGFza0NvbnRyb2xsZXIucHJvdG90eXBlLmdyaWRUb3VjaGVkID0gZnVuY3Rpb24odGFibGUsIGdyaWQpIHtcbn07XG5cblRhc2tDb250cm9sbGVyLnByb3RvdHlwZS5iYWNrQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcblxuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cblRhc2tDb250cm9sbGVyLnByb3RvdHlwZS5wb3B1cCA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIucG9wdXAodGhpcy5yb290Tm9kZSwge3BvcHVwQW5pbTogdHJ1ZX0pO1xufTtcblxuVGFza0NvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5jbG9zZSh0aGlzLnJvb3ROb2RlKTtcbn07XG5cblRhc2tDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgLy9pZiAodGhpcy5jbG9zZUNhbGxiYWNrKSB7XG4gICAgLy8gICAgdGhpcy5jbG9zZUNhbGxiYWNrKCk7XG4gICAgLy8gICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gbnVsbDtcbiAgICAvL31cbn07XG5cblRhc2tDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL21lbnUvdGFza192aWV3LmNjYmlcIiwgbnVsbCwgXCJUYXNrQ29udHJvbGxlclwiLCBuZXcgVGFza0NvbnRyb2xsZXIoKSk7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFRhc2tDb250cm9sbGVyOyIsInZhciBTa2luUmV3YXJkVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1NraW5SZXdhcmRUeXBlXCIpO1xudmFyIEV2ZW50c05hbWUgPSByZXF1aXJlKFwiLi4vZXZlbnRzL0V2ZW50c05hbWVcIik7XG52YXIgQm9vc3RUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vQm9vc3RUeXBlXCIpO1xudmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xuXG52YXIgVGFza0l0ZW1Db250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG5cbiAgICB0aGlzLmxibEdvYWwgPSBudWxsO1xuICAgIHRoaXMubGJsR29hbEluZm8gPSBudWxsO1xuICAgIC8vdGhpcy5zcFNraW4gPSBudWxsO1xuICAgIHRoaXMuc3BCZ1NlbGVjdGVkID0gbnVsbDtcblxuICAgIHRoaXMubGJsU2VsZWN0ID0gbnVsbDtcbiAgICB0aGlzLmJ0blNlbGVjdCA9IG51bGw7XG4gICAgdGhpcy5uZFNlbGVjdCA9IG51bGw7XG5cbiAgICB0aGlzLmxibERpYW1vbmRzID0gbnVsbDtcblxuICAgIC8vdGhpcy5sYmxVc2luZyA9IG51bGw7XG5cbiAgICB0aGlzLmlkeCA9IDA7XG4gICAgdGhpcy50YXNrQ2ZnID0gbnVsbDtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoVGFza0l0ZW1Db250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cblRhc2tJdGVtQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xufTtcbi8qKlxuICogQHBhcmFtIHtUYXNrQ29uZmlnfSBkYXRhXG4gKiBAcGFyYW0ge251bWJlcn0gaWR4XG4gKi9cblRhc2tJdGVtQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdFdpdGggPSBmdW5jdGlvbiAoZGF0YSwgaWR4KSB7XG4gICAgdGhpcy5pZHggPSBpZHg7XG4gICAgdGhpcy50YXNrQ2ZnID0gZGF0YTtcbiAgICB0aGlzLnJlZnJlc2goKTtcbn07XG5cblRhc2tJdGVtQ29udHJvbGxlci5wcm90b3R5cGUucmVmcmVzaCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZGF0YSA9IHRoaXMudGFza0NmZztcbiAgICB2YXIgY29tcGxldGVkID0gZmFsc2U7XG4gICAgc3dpdGNoIChkYXRhLnR5cGUpIHtcbiAgICAgICAgY2FzZSBTa2luUmV3YXJkVHlwZS5Ob25lOlxuICAgICAgICAgICAgdGhpcy5sYmxHb2FsLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMubGJsR29hbEluZm8udmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgY29tcGxldGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFNraW5SZXdhcmRUeXBlLkxldmVsQ291bnQ6XG4gICAgICAgICAgICB0aGlzLmxibEdvYWwudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmxibEdvYWxJbmZvLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5sYmxHb2FsLnNldFN0cmluZyhnYW1lLnV0aWxzLnNwcmludGYoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcImxldmVsX2NvdW50X3RpdGxlXCIpLCBkYXRhLmNvdW50KSk7XG4gICAgICAgICAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4uZ2V0TGV2ZWwoKSA+PSBkYXRhLmNvdW50KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYmxHb2FsSW5mby5zZXRTdHJpbmcoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcImNvbXBsZXRlZF90aXRsZVwiKSk7XG4gICAgICAgICAgICAgICAgY29tcGxldGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYmxHb2FsSW5mby5zZXRTdHJpbmcoZ2FtZS51dGlscy5zcHJpbnRmKFwiJWQvJWRcIiwgZ2FtZS5wbGF5ZXJNYW4uZ2V0TGV2ZWwoKSwgZGF0YS5jb3VudCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgU2tpblJld2FyZFR5cGUuV2F0Y2hBZENvdW50OlxuICAgICAgICAgICAgdGhpcy5sYmxHb2FsLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5sYmxHb2FsSW5mby52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMubGJsR29hbC5zZXRTdHJpbmcoZ2FtZS51dGlscy5zcHJpbnRmKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJ3YXRjaF9hZF9jb3VudF90aXRsZVwiKSwgZGF0YS5jb3VudCkpO1xuICAgICAgICAgICAgaWYgKGdhbWUucGxheWVyTWFuLnBsYXllci5pbnRlcnN0aXRpYWxBZENvdW50ID49IGRhdGEuY291bnQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxibEdvYWxJbmZvLnNldFN0cmluZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwiY29tcGxldGVkX3RpdGxlXCIpKTtcbiAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxibEdvYWxJbmZvLnNldFN0cmluZyhnYW1lLnV0aWxzLnNwcmludGYoXCIlZC8lZFwiLCBnYW1lLnBsYXllck1hbi5wbGF5ZXIuaW50ZXJzdGl0aWFsQWRDb3VudCwgZGF0YS5jb3VudCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgU2tpblJld2FyZFR5cGUuV2F0Y2hSZXdhcmRBZENvdW50OlxuICAgICAgICAgICAgdGhpcy5sYmxHb2FsLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5sYmxHb2FsSW5mby52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMubGJsR29hbC5zZXRTdHJpbmcoZ2FtZS51dGlscy5zcHJpbnRmKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJ3YXRjaF9yZXdhcmRfYWRfY291bnRfdGl0bGVcIiksIGRhdGEuY291bnQpKTtcbiAgICAgICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5wbGF5ZXIucmV3YXJkZWRBZENvdW50ID49IGRhdGEuY291bnQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxibEdvYWxJbmZvLnNldFN0cmluZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwiY29tcGxldGVkX3RpdGxlXCIpKTtcbiAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxibEdvYWxJbmZvLnNldFN0cmluZyhnYW1lLnV0aWxzLnNwcmludGYoXCIlZC8lZFwiLCBnYW1lLnBsYXllck1hbi5wbGF5ZXIucmV3YXJkZWRBZENvdW50LCBkYXRhLmNvdW50KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBTa2luUmV3YXJkVHlwZS5DbGFpbWVkOlxuICAgICAgICAgICAgaWYgKGdhbWUucGxheWVyTWFuLmhhc1NraW4oZGF0YS5pZCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxibEdvYWwudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMubGJsR29hbEluZm8udmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGNvbXBsZXRlZCA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMubGJsR29hbC5zZXRTdHJpbmcoXyhcInNraW5fZ2lmdF90aXRsZVwiKSk7XG4gICAgICAgICAgICAgICAgdGhpcy5sYmxHb2FsSW5mby5zZXRTdHJpbmcoXCItLVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFNraW5SZXdhcmRUeXBlLlB1cmNoYXNlOlxuICAgICAgICAgICAgaWYgKGdhbWUucGxheWVyTWFuLmhhc1NraW4oZGF0YS5pZCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxibEdvYWwudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMubGJsR29hbEluZm8udmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGNvbXBsZXRlZCA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMubGJsR29hbC5zZXRTdHJpbmcoXyhcInNraW5fcHVyY2hhc2VfdGl0bGVcIikpO1xuICAgICAgICAgICAgICAgIHRoaXMubGJsR29hbEluZm8uc2V0U3RyaW5nKFwiLS1cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICB0aGlzLmxibERpYW1vbmRzLnNldFN0cmluZyhcInhcIiArIGRhdGEucmV3YXJkQ291bnQpO1xuXG4gICAgLy92YXIgc3ByaXRlRnJhbWUgPSBjYy5zcHJpdGVGcmFtZUNhY2hlLmdldFNwcml0ZUZyYW1lKGRhdGEuaW1hZ2UgKyBcIi5wbmdcIik7XG4gICAgLy90aGlzLnNwU2tpbi5zZXRTcHJpdGVGcmFtZShzcHJpdGVGcmFtZSk7XG4gICAgLy90aGlzLmxibFVzaW5nLnNldFN0cmluZyhfKFwic2VsZWN0ZWRfdGl0bGVcIikpO1xuXG4gICAgLy90aGlzLmxibFVzaW5nLnZpc2libGUgPSBmYWxzZTtcbiAgICAvL3RoaXMubmRTZWxlY3QudmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMuYnRuU2VsZWN0LmVuYWJsZWQgPSBmYWxzZTtcblxuICAgIHZhciBjbGFpbWVkID0gZ2FtZS5wbGF5ZXJNYW4uaXNUYXNrQ2xhaW1lZCh0aGlzLnRhc2tDZmcuaWQpO1xuICAgIHRoaXMubmRTZWxlY3QudmlzaWJsZSA9IHRydWU7XG5cbiAgICBpZiAoY29tcGxldGVkKSB7XG4gICAgICAgIGlmICghY2xhaW1lZCkge1xuICAgICAgICAgICAgdGhpcy5idG5TZWxlY3QuZW5hYmxlZCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmxibFNlbGVjdC5zZXRTdHJpbmcoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcImNsYWltX3RpdGxlXCIpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubGJsU2VsZWN0LnNldFN0cmluZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwiY2xhaW1lZF90aXRsZVwiKSk7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmxibFNlbGVjdC5zZXRTdHJpbmcoXyhcInVuY29tcGxldGVkX3RpdGxlXCIpKTtcbiAgICB9XG59O1xuXG5UYXNrSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLmdldENvbnRlbnRTaXplID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLnNwQmdTZWxlY3RlZC5nZXRDb250ZW50U2l6ZSgpO1xufTtcblxuVGFza0l0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5zZWxlY3RDbGlja2VkID0gZnVuY3Rpb24gKCkge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGNjLmxvZyhcInRhc2sgY2xhaW1lZDpcIiArIGdhbWUucGxheWVyTWFuLmlzVGFza0NsYWltZWQodGhpcy50YXNrQ2ZnLmlkKSk7XG4gICAgaWYgKCFnYW1lLnBsYXllck1hbi5pc1Rhc2tDbGFpbWVkKHRoaXMudGFza0NmZy5pZCkpIHtcbiAgICAgICAgY2MubG9nKFwidGFzayBzZXQgY2xhaW1lZDpcIiArIHRoaXMudGFza0NmZy5pZCk7XG4gICAgICAgIGdhbWUucGxheWVyTWFuLnNldFRhc2tDbGFpbWVkKHRoaXMudGFza0NmZy5pZCk7XG4gICAgICAgIHZhciByZXdhcmRDb3VudCA9IHRoaXMudGFza0NmZy5yZXdhcmRDb3VudDtcbiAgICAgICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5wb3B1cFJld2FyZERvdWJsZURsZyhyZXdhcmRDb3VudCwgQm9vc3RUeXBlLkRJQU1PTkQsICBnYW1lLnV0aWxzLmlzSU9TKCkgPyBcInRhc2tzXCIgOiBcInRhc2tzXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5yZWZyZXNoKCk7XG4gICAgICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQoRXZlbnRzTmFtZS5UQVNLX1VQREFURSk7XG4gICAgfVxufTtcblxuVGFza0l0ZW1Db250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gZ2FtZS51dGlscy5sb2FkTm9kZUZyb21DQ0IoXCJyZXMvbWVudS90YXNrX2l0ZW1fdmlldy5jY2JpXCIsIG51bGwsIFwiVGFza0l0ZW1Db250cm9sbGVyXCIsIG5ldyBUYXNrSXRlbUNvbnRyb2xsZXIoKSk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFRhc2tJdGVtQ29udHJvbGxlcjsiLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAyMDE3LzEyLzE1LlxuICovXG52YXIgRXZlbnRzTmFtZSA9IHJlcXVpcmUoXCIuLi9ldmVudHMvRXZlbnRzTmFtZVwiKTtcblxudmFyIENvbG9yTGlzdCA9IFtcbiAgICBjYy5jb2xvcigyNTUsIDEwNiwgMTA3KSxcbiAgICBjYy5jb2xvcig5MCwgMTgxLCAxMTApLFxuICAgIGNjLmNvbG9yKDgzLCAxODMsIDIwOSksXG4gICAgY2MuY29sb3IoMjQzLCA3NywgMTUxKSxcbiAgICBjYy5jb2xvcigxNTMsIDk1LCAyMDYpLFxuICAgIGNjLmNvbG9yKDU3LCAxMDMsIDI0OSksXG4gICAgY2MuY29sb3IoMjQ5LCAxMTIsIDQ5KSxcbiAgICBjYy5jb2xvcigyMzIsIDU5LCAyMCksXG4gICAgY2MuY29sb3IoODQsIDIzNSwgNDMpLFxuICAgIGNjLmNvbG9yKDUwLCA4NCwgMTE3KSxcbiAgICBjYy5jb2xvcigxMjcsIDEyNywgMTI3KVxuXTtcblxuXG52YXIgVGl0bGVDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG4gICAgdGhpcy5sYkNvaW5zID0gbnVsbDtcblxuICAgIHRoaXMuc3BDb2luc0FkZCA9IG51bGw7XG4gICAgdGhpcy5idG5BZGQgPSBudWxsO1xuXG4gICAgdGhpcy5iZ05vZGUgPSBudWxsO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhUaXRsZUNvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuVGl0bGVDb250cm9sbGVyLnByb3RvdHlwZS5vbkVudGVyID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLmFkZEV2ZW50TGlzdGVuZXIoRXZlbnRzTmFtZS5DT0lOU19VUERBVEUsIHRoaXMucmVmcmVzaCwgdGhpcyk7XG59O1xuXG5UaXRsZUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRXhpdCA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5yZW1vdmVFdmVudExpc3RlbmVyKEV2ZW50c05hbWUuQ09JTlNfVVBEQVRFLCB0aGlzLnJlZnJlc2gsIHRoaXMpO1xufTtcblxuVGl0bGVDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG4gICAgdGhpcy5yZWZyZXNoKCk7XG4gICAgdGhpcy5yYW5kb21TcXVhcmVzKCk7XG5cbiAgICBpZiAoVGl0bGVDb250cm9sbGVyLnRpbWUgPiAwKSB7XG4gICAgICAgIGdhbWUudXRpbHMucGxheUNDQkFuaW1hdGlvbih0aGlzLnJvb3ROb2RlLCBcIkRlZmF1bHQgVGltZWxpbmVcIik7XG4gICAgfVxuICAgIFRpdGxlQ29udHJvbGxlci50aW1lICsrO1xufTtcblxuVGl0bGVDb250cm9sbGVyLnByb3RvdHlwZS5yYW5kb21TcXVhcmVzID0gZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMjA7ICsraSkge1xuICAgICAgICB2YXIgc3F1YXJlID0gbmV3IGNjLlNwcml0ZShcIiNzcXVhcmVfY2lyY2xlLnBuZ1wiKTtcblxuICAgICAgICBzcXVhcmUuc2V0UG9zaXRpb24odGhpcy5nZXRSYW5kb21Qb3MoKSk7XG4gICAgICAgIHNxdWFyZS5zZXRDb2xvcihDb2xvckxpc3RbZ2FtZS51dGlscy5yYW5kb21OZXh0SW50KENvbG9yTGlzdC5sZW5ndGggLSAxKV0pO1xuICAgICAgICBzcXVhcmUuc2V0T3BhY2l0eSgxNSk7XG4gICAgICAgIHNxdWFyZS5zZXRTY2FsZSgxLjQpO1xuXG4gICAgICAgIHZhciBwb3MxID0gdGhpcy5nZXRSYW5kb21Qb3MoKTtcbiAgICAgICAgc3F1YXJlLnNldFBvc2l0aW9uKHBvczEpO1xuICAgICAgICB2YXIgcG9zMiA9IHRoaXMuZ2V0UmFuZG9tUG9zKCk7XG4gICAgICAgIHZhciB0ID0gdGhpcy5nZXRUaW1lKHBvczEsIHBvczIpO1xuICAgICAgICB2YXIgbW92ZVRvMSA9IGNjLm1vdmVUbyh0LCBwb3MyKTtcbiAgICAgICAgdmFyIG1vdmVUbzIgPSBjYy5tb3ZlVG8odCwgcG9zMSk7XG4gICAgICAgIHZhciBhY3Rpb24gPSBjYy5zZXF1ZW5jZShtb3ZlVG8xLCBtb3ZlVG8yKS5yZXBlYXRGb3JldmVyKCk7XG4gICAgICAgIHNxdWFyZS5ydW5BY3Rpb24oYWN0aW9uKTtcbiAgICAgICAgc3F1YXJlLnJ1bkFjdGlvbihjYy5yb3RhdGVCeSgyMCwgMzYwKS5yZXBlYXRGb3JldmVyKCkpO1xuICAgICAgICB0aGlzLmJnTm9kZS5hZGRDaGlsZChzcXVhcmUpO1xuICAgIH1cbn07XG5cblRpdGxlQ29udHJvbGxlci5wcm90b3R5cGUuZ2V0VGltZSA9IGZ1bmN0aW9uIChwb3MxLCBwb3MyKSB7XG4gICAgcmV0dXJuIGNjLnBEaXN0YW5jZShwb3MxLCBwb3MyKSAvIDIwO1xufTtcblxuVGl0bGVDb250cm9sbGVyLnByb3RvdHlwZS5nZXRSYW5kb21Qb3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGNjLnAoZ2FtZS51dGlscy5yYW5kb21OZXh0SW50KGNjLndpblNpemUud2lkdGggKiAxLjUpIC0gY2Mud2luU2l6ZS53aWR0aCAqIDAuMjUsXG4gICAgICAgIGdhbWUudXRpbHMucmFuZG9tTmV4dEludChjYy53aW5TaXplLmhlaWdodCAqIDEuNSkgLSBjYy53aW5TaXplLmhlaWdodCAqIDAuMjUpO1xufTtcblxuVGl0bGVDb250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aCA9IGZ1bmN0aW9uIChyZXBsYXlDYWxsYmFjaywgbmV4dENhbGxiYWNrKSB7XG4gICAgdGhpcy5fcmVwbGF5Q2FsbGJhY2sgPSByZXBsYXlDYWxsYmFjaztcbiAgICB0aGlzLl9uZXh0Q2FsbGJhY2sgPSBuZXh0Q2FsbGJhY2s7XG59O1xuXG5UaXRsZUNvbnRyb2xsZXIucHJvdG90eXBlLnJlZnJlc2ggPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5sYkNvaW5zLnNldFN0cmluZyhnYW1lLnBsYXllck1hbi5wbGF5ZXIuY29pbnMpO1xufTtcblxuVGl0bGVDb250cm9sbGVyLnByb3RvdHlwZS5kaXNhYmxlQWRkQ29pbnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5zcENvaW5zQWRkLnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLmJ0bkFkZC5lbmFibGVkID0gZmFsc2U7XG4gICAgZ2FtZS51dGlscy5wbGF5Q0NCQW5pbWF0aW9uKHRoaXMucm9vdE5vZGUsIFwibm9uZVwiKTtcbn07XG5cblRpdGxlQ29udHJvbGxlci5wcm90b3R5cGUuc3RvcmVDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGdhbWUucG9wdXBNYW4ucG9wdXBTdG9yZURsZygpO1xufTtcblxuVGl0bGVDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL21lbnUvdGl0bGVfdmlldy5jY2JpXCIsIG51bGwsIFwiVGl0bGVDb250cm9sbGVyXCIsIG5ldyBUaXRsZUNvbnRyb2xsZXIoKSk7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5UaXRsZUNvbnRyb2xsZXIudGltZSA9IDA7XG5cbm1vZHVsZS5leHBvcnRzID0gVGl0bGVDb250cm9sbGVyOyIsInZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcblxudmFyIFdhdGNoQWRzR2V0M1N0YXJDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG5cbiAgICAvL3RoaXMuYnRuQ2xvc2VDbiA9IG51bGw7XG4gICAgLy90aGlzLmJ0bkNsb3NlRW4gPSBudWxsO1xuXG4gICAgdGhpcy5zcFllbGxvdzEgPSBudWxsO1xuICAgIHRoaXMuc3BZZWxsb3cyID0gbnVsbDtcbiAgICB0aGlzLnNwWWVsbG93MyA9IG51bGw7XG5cbiAgICB0aGlzLnNwQmxhY2sxID0gbnVsbDtcbiAgICB0aGlzLnNwQmxhY2syID0gbnVsbDtcbiAgICB0aGlzLnNwQmxhY2szID0gbnVsbDtcblxuICAgIHRoaXMubGJDb2xsZWN0VGlwcyA9IG51bGw7XG5cbiAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBudWxsO1xuICAgIHRoaXMucmV3YXJkTmFtZSA9IG51bGw7XG4gICAgdGhpcy53YXRjaGVkID0gZmFsc2U7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKFdhdGNoQWRzR2V0M1N0YXJDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbldhdGNoQWRzR2V0M1N0YXJDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG4gICAgLy90aGlzLmJ0bkNsb3NlQ24udmlzaWJsZSA9IGZhbHNlO1xuICAgIC8vdGhpcy5idG5DbG9zZUVuLnZpc2libGUgPSBmYWxzZTtcbiAgICAvL2lmIChnYW1lLmxvY2FsLmlzQ2hpbmVzZSgpKSB7XG4gICAgLy8gICAgdGhpcy5idG5DbG9zZUNuLnZpc2libGUgPSB0cnVlO1xuICAgIC8vfSBlbHNlIHtcbiAgICAvLyAgICB0aGlzLmJ0bkNsb3NlRW4udmlzaWJsZSA9IHRydWU7XG4gICAgLy99XG4gICAgLy9nYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcIm9wZW5fYm94XCIpO1xuXG4gICAgdGhpcy5sYkNvbGxlY3RUaXBzLnNldEFsaWdubWVudChjYy5URVhUX0FMSUdOTUVOVF9DRU5URVIpO1xuXG4gICAgdGhpcy5zcFllbGxvd3MgPSBbdGhpcy5zcFllbGxvdzEsIHRoaXMuc3BZZWxsb3cyLCB0aGlzLnNwWWVsbG93M107XG5cbiAgICB2YXIgc3RhciA9IGdhbWUuZ2FtZU1hbi5jdXJyZW50U3RhcjtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IDM7ICsraSkge1xuICAgICAgICB0aGlzLnNwWWVsbG93c1tpXS52aXNpYmxlID0gKHN0YXIgPj0gaSArIDEpO1xuICAgIH1cbn07XG5cbldhdGNoQWRzR2V0M1N0YXJDb250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aCA9IGZ1bmN0aW9uIChyZXdhcmROYW1lLCBjbG9zZUNhbGxiYWNrKSB7XG4gICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gY2xvc2VDYWxsYmFjaztcbiAgICB0aGlzLnJld2FyZE5hbWUgPSByZXdhcmROYW1lO1xufTtcblxuV2F0Y2hBZHNHZXQzU3RhckNvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB0aGlzLmNsb3NlKCk7XG59O1xuXG5XYXRjaEFkc0dldDNTdGFyQ29udHJvbGxlci5wcm90b3R5cGUud2F0Y2hBZHNDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuY2hlY2tBbmRTaG93UmV3YXJkVmlkZW8odGhpcy5yZXdhcmROYW1lLCBmdW5jdGlvbiAod2F0Y2hlZCkge1xuICAgICAgICBpZiAod2F0Y2hlZCkge1xuICAgICAgICAgICAgdGhpcy53YXRjaGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgfVxuICAgIH0uYmluZCh0aGlzKSk7XG59O1xuXG5XYXRjaEFkc0dldDNTdGFyQ29udHJvbGxlci5wcm90b3R5cGUucG9wdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLnBvcHVwKHRoaXMucm9vdE5vZGUsIHtwb3B1cEFuaW06IHRydWV9KTtcbn07XG5cbldhdGNoQWRzR2V0M1N0YXJDb250cm9sbGVyLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIuY2xvc2UodGhpcy5yb290Tm9kZSk7XG4gICAgaWYgKHRoaXMuY2xvc2VDYWxsYmFjaykge1xuICAgICAgICB0aGlzLmNsb3NlQ2FsbGJhY2sodGhpcy53YXRjaGVkKTtcbiAgICAgICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gbnVsbDtcbiAgICB9XG59O1xuXG5XYXRjaEFkc0dldDNTdGFyQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9ub3RpY2Uvd2F0Y2hfYWRzX2dldF8zc3Rhcl92aWV3LmNjYmlcIiwgbnVsbCwgXCJXYXRjaEFkc0dldDNTdGFyQ29udHJvbGxlclwiLCBuZXcgV2F0Y2hBZHNHZXQzU3RhckNvbnRyb2xsZXIoKSk7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFdhdGNoQWRzR2V0M1N0YXJDb250cm9sbGVyOyIsInZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcblxudmFyIFdhdGNoQWRzR2V0RGlhbW9uZHNDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLmNhbGwodGhpcyk7XG5cbiAgICAvL3RoaXMuYnRuQ2xvc2VDbiA9IG51bGw7XG4gICAgLy90aGlzLmJ0bkNsb3NlRW4gPSBudWxsO1xuXG4gICAgLy90aGlzLnNwSXRlbSA9IG51bGw7XG4gICAgLy90aGlzLmxiQnRuVGl0bGUgPSBudWxsO1xuICAgIHRoaXMuc3BEaWFtb25kQmcgPSBudWxsO1xuXG4gICAgdGhpcy5sYkRpYW1vbmRzQ291bnQgPSBudWxsO1xuXG4gICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gbnVsbDtcbiAgICB0aGlzLnJld2FyZE5hbWUgPSBudWxsO1xuICAgIHRoaXMud2F0Y2hlZCA9IGZhbHNlO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhXYXRjaEFkc0dldERpYW1vbmRzQ29udHJvbGxlciwgQmFzZUNDQkNvbnRyb2xsZXIpO1xuXG5XYXRjaEFkc0dldERpYW1vbmRzQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuICAgIC8vdGhpcy5idG5DbG9zZUNuLnZpc2libGUgPSBmYWxzZTtcbiAgICAvL3RoaXMuYnRuQ2xvc2VFbi52aXNpYmxlID0gZmFsc2U7XG4gICAgLy9pZiAoZ2FtZS5sb2NhbC5pc0NoaW5lc2UoKSkge1xuICAgIC8vICAgIHRoaXMuYnRuQ2xvc2VDbi52aXNpYmxlID0gdHJ1ZTtcbiAgICAvL30gZWxzZSB7XG4gICAgLy8gICAgdGhpcy5idG5DbG9zZUVuLnZpc2libGUgPSB0cnVlO1xuICAgIC8vfVxuICAgIHRoaXMuc3BEaWFtb25kQmcucnVuQWN0aW9uKGNjLnJvdGF0ZUJ5KDMsIDM2MCkucmVwZWF0Rm9yZXZlcigpKTtcbiAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcIm9wZW5fYm94XCIpO1xufTtcblxuV2F0Y2hBZHNHZXREaWFtb25kc0NvbnRyb2xsZXIucHJvdG90eXBlLmluaXRXaXRoID0gZnVuY3Rpb24gKHJld2FyZE5hbWUsIGNsb3NlQ2FsbGJhY2spIHtcbiAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBjbG9zZUNhbGxiYWNrO1xuICAgIHRoaXMucmV3YXJkTmFtZSA9IHJld2FyZE5hbWU7XG4gICAgdGhpcy5sYkRpYW1vbmRzQ291bnQuc2V0U3RyaW5nKFwieFwiICsgZ2FtZS5jb25maWcuZGFpbHlEaWFtb25kcyk7XG59O1xuXG5XYXRjaEFkc0dldERpYW1vbmRzQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2VDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cbldhdGNoQWRzR2V0RGlhbW9uZHNDb250cm9sbGVyLnByb3RvdHlwZS53YXRjaEFkc0NsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5jaGVja0FuZFNob3dSZXdhcmRWaWRlbyh0aGlzLnJld2FyZE5hbWUsIGZ1bmN0aW9uICh3YXRjaGVkKSB7XG4gICAgICAgIGlmICh3YXRjaGVkKSB7XG4gICAgICAgICAgICB0aGlzLndhdGNoZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgfS5iaW5kKHRoaXMpKTtcbn07XG5cbldhdGNoQWRzR2V0RGlhbW9uZHNDb250cm9sbGVyLnByb3RvdHlwZS5wb3B1cCA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIucG9wdXAodGhpcy5yb290Tm9kZSwge292ZXJsYXlPcGFjaXR5OiAyMjUsIHBvcHVwQW5pbTogdHJ1ZX0pO1xufTtcblxuV2F0Y2hBZHNHZXREaWFtb25kc0NvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5jbG9zZSh0aGlzLnJvb3ROb2RlKTtcbiAgICBpZiAodGhpcy5jbG9zZUNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuY2xvc2VDYWxsYmFjayh0aGlzLndhdGNoZWQpO1xuICAgICAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBudWxsO1xuICAgIH1cbn07XG5cbldhdGNoQWRzR2V0RGlhbW9uZHNDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL25vdGljZS93YXRjaF9hZHNfZ2V0X2RpYW1vbmRzX3ZpZXcuY2NiaVwiLCBudWxsLCBcIldhdGNoQWRzR2V0RGlhbW9uZHNDb250cm9sbGVyXCIsIG5ldyBXYXRjaEFkc0dldERpYW1vbmRzQ29udHJvbGxlcigpKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gV2F0Y2hBZHNHZXREaWFtb25kc0NvbnRyb2xsZXI7IiwidmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xuXG52YXIgV2F0Y2hBZHNHZXRJdGVtQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuXG4gICAgLy90aGlzLmJ0bkNsb3NlQ24gPSBudWxsO1xuICAgIC8vdGhpcy5idG5DbG9zZUVuID0gbnVsbDtcblxuICAgIHRoaXMuc3BJdGVtID0gbnVsbDtcbiAgICB0aGlzLmxiQnRuVGl0bGUgPSBudWxsO1xuXG4gICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gbnVsbDtcbiAgICB0aGlzLnJld2FyZE5hbWUgPSBudWxsO1xuICAgIHRoaXMud2F0Y2hlZCA9IGZhbHNlO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhXYXRjaEFkc0dldEl0ZW1Db250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbldhdGNoQWRzR2V0SXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IgID0gZnVuY3Rpb24oKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRGlkTG9hZEZyb21DQ0IuY2FsbCh0aGlzKTtcbiAgICAvL3RoaXMuYnRuQ2xvc2VDbi52aXNpYmxlID0gZmFsc2U7XG4gICAgLy90aGlzLmJ0bkNsb3NlRW4udmlzaWJsZSA9IGZhbHNlO1xuICAgIC8vaWYgKGdhbWUubG9jYWwuaXNDaGluZXNlKCkpIHtcbiAgICAvLyAgICB0aGlzLmJ0bkNsb3NlQ24udmlzaWJsZSA9IHRydWU7XG4gICAgLy99IGVsc2Uge1xuICAgIC8vICAgIHRoaXMuYnRuQ2xvc2VFbi52aXNpYmxlID0gdHJ1ZTtcbiAgICAvL31cbiAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcIm9wZW5fYm94XCIpO1xufTtcblxuV2F0Y2hBZHNHZXRJdGVtQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdFdpdGggPSBmdW5jdGlvbiAodGl0bGUsIHNwcml0ZU5hbWUsIHJld2FyZE5hbWUsIGNsb3NlQ2FsbGJhY2spIHtcbiAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBjbG9zZUNhbGxiYWNrO1xuICAgIHRoaXMucmV3YXJkTmFtZSA9IHJld2FyZE5hbWU7XG4gICAgdGhpcy5sYkJ0blRpdGxlLnNldFN0cmluZyh0aXRsZSk7XG4gICAgdmFyIHNwcml0ZUZyYW1lID0gY2Muc3ByaXRlRnJhbWVDYWNoZS5nZXRTcHJpdGVGcmFtZShzcHJpdGVOYW1lKTtcbiAgICBpZiAoc3ByaXRlRnJhbWUpIHtcbiAgICAgICAgdGhpcy5zcEl0ZW0uc2V0U3ByaXRlRnJhbWUoc3ByaXRlRnJhbWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGNjLmVycm9yKFwic3ByaXRlIGZyYW1lIGlzIG51bGw6XCIgKyBzcHJpdGVOYW1lKTtcbiAgICB9XG59O1xuXG5XYXRjaEFkc0dldEl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5jbG9zZUNsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgdGhpcy5jbG9zZSgpO1xufTtcblxuV2F0Y2hBZHNHZXRJdGVtQ29udHJvbGxlci5wcm90b3R5cGUud2F0Y2hBZHNJdGVtQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICB0aGlzLndhdGNoQWRzQ2xpY2tlZChzZW5kZXIpO1xufTtcblxuV2F0Y2hBZHNHZXRJdGVtQ29udHJvbGxlci5wcm90b3R5cGUud2F0Y2hBZHNDbGlja2VkID0gZnVuY3Rpb24gKHNlbmRlcikge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuY2hlY2tBbmRTaG93UmV3YXJkVmlkZW8odGhpcy5yZXdhcmROYW1lLCBmdW5jdGlvbiAod2F0Y2hlZCkge1xuICAgICAgICBpZiAod2F0Y2hlZCkge1xuICAgICAgICAgICAgdGhpcy53YXRjaGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgfVxuICAgIH0uYmluZCh0aGlzKSk7XG59O1xuXG5XYXRjaEFkc0dldEl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5wb3B1cCA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIucG9wdXAodGhpcy5yb290Tm9kZSwge292ZXJsYXlPcGFjaXR5OiAyMjUsIHBvcHVwQW5pbTogdHJ1ZX0pO1xufTtcblxuV2F0Y2hBZHNHZXRJdGVtQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLmNsb3NlKHRoaXMucm9vdE5vZGUpO1xuICAgIGlmICh0aGlzLmNsb3NlQ2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5jbG9zZUNhbGxiYWNrKHRoaXMud2F0Y2hlZCk7XG4gICAgICAgIHRoaXMuY2xvc2VDYWxsYmFjayA9IG51bGw7XG4gICAgfVxufTtcblxuV2F0Y2hBZHNHZXRJdGVtQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9ub3RpY2Uvd2F0Y2hfYWRzX2dldF9pdGVtX3ZpZXcuY2NiaVwiLCBudWxsLCBcIldhdGNoQWRzR2V0SXRlbUNvbnRyb2xsZXJcIiwgbmV3IFdhdGNoQWRzR2V0SXRlbUNvbnRyb2xsZXIoKSk7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFdhdGNoQWRzR2V0SXRlbUNvbnRyb2xsZXI7IiwidmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xuXG52YXIgV2F0Y2hBZHNHZXRTa2luQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5jYWxsKHRoaXMpO1xuXG4gICAgLy90aGlzLmJ0bkNsb3NlQ24gPSBudWxsO1xuICAgIC8vdGhpcy5idG5DbG9zZUVuID0gbnVsbDtcblxuICAgIHRoaXMuc3BTa2luID0gbnVsbDtcbiAgICB0aGlzLmxiR2V0U2tpbiA9IG51bGw7XG5cbiAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBudWxsO1xuICAgIHRoaXMuc2tpbkNmZyA9IG51bGw7XG59O1xuXG5nYW1lLnV0aWxzLmluaGVyaXRzKFdhdGNoQWRzR2V0U2tpbkNvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuV2F0Y2hBZHNHZXRTa2luQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xuICAgIC8vdGhpcy5idG5DbG9zZUNuLnZpc2libGUgPSBmYWxzZTtcbiAgICAvL3RoaXMuYnRuQ2xvc2VFbi52aXNpYmxlID0gZmFsc2U7XG4gICAgLy9pZiAoZ2FtZS5sb2NhbC5pc0NoaW5lc2UoKSkgey5idG5DbG9zZUNuXG4gICAgLy8gICAgdGhpcy5idG5DbG9zZUNuLnZpc2libGUgPSB0cnVlO1xuICAgIC8vfSBlbHNlIHtcbiAgICAvLyAgICB0aGlzLmJ0bkNsb3NlRW4udmlzaWJsZSA9IHRydWU7XG4gICAgLy99XG4gICAgdGhpcy5sYkdldFNraW4uc2V0U3RyaW5nKF8oXCJyZXdhcmRfdmlkZW9fc2tpblwiKSk7XG5cbiAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcIm9wZW5fYm94XCIpO1xufTtcblxuV2F0Y2hBZHNHZXRTa2luQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdFdpdGggPSBmdW5jdGlvbiAoc2tpbkNmZywgY2FsbGJhY2spIHtcbiAgICB0aGlzLnNraW5DZmcgPSBza2luQ2ZnO1xuICAgIHZhciBzcHJpdGVGcmFtZSA9IGNjLnNwcml0ZUZyYW1lQ2FjaGUuZ2V0U3ByaXRlRnJhbWUoc2tpbkNmZy5pbWFnZSArIFwiX2wucG5nXCIpO1xuICAgIHRoaXMuc3BTa2luLnNldFNwcml0ZUZyYW1lKHNwcml0ZUZyYW1lKTtcbiAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBjYWxsYmFjaztcbn07XG5cbldhdGNoQWRzR2V0U2tpbkNvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB0aGlzLmNsb3NlKCk7XG59O1xuXG5XYXRjaEFkc0dldFNraW5Db250cm9sbGVyLnByb3RvdHlwZS53YXRjaEFkc0NsaWNrZWQgPSBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgQXVkaW9IZWxwZXIucGxheUJ0blNvdW5kKCk7XG4gICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5idXlTa2luKHRoaXMuc2tpbkNmZywgXCJidXlfc2tpbl9pbl9wYXNzXCIsIGZ1bmN0aW9uIChwdXJjaGFzZWQpIHtcbiAgICAgICAgaWYgKHB1cmNoYXNlZCkge1xuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgfS5iaW5kKHRoaXMpKTtcbn07XG5cbldhdGNoQWRzR2V0U2tpbkNvbnRyb2xsZXIucHJvdG90eXBlLnBvcHVwID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuZGlhbG9nTWFuYWdlci5wb3B1cCh0aGlzLnJvb3ROb2RlLCB7b3ZlcmxheU9wYWNpdHk6IDIyNSwgcG9wdXBBbmltOiB0cnVlfSk7XG59O1xuXG5XYXRjaEFkc0dldFNraW5Db250cm9sbGVyLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIuY2xvc2UodGhpcy5yb290Tm9kZSk7XG4gICAgaWYgKHRoaXMuY2xvc2VDYWxsYmFjaykge1xuICAgICAgICB0aGlzLmNsb3NlQ2FsbGJhY2soKTtcbiAgICAgICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gbnVsbDtcbiAgICB9XG59O1xuXG5XYXRjaEFkc0dldFNraW5Db250cm9sbGVyLmNyZWF0ZUZyb21DQ0IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbm9kZSA9IGdhbWUudXRpbHMubG9hZE5vZGVGcm9tQ0NCKFwicmVzL25vdGljZS93YXRjaF9hZHNfZ2V0X3NraW5fdmlldy5jY2JpXCIsIG51bGwsIFwiV2F0Y2hBZHNHZXRTa2luQ29udHJvbGxlclwiLCBuZXcgV2F0Y2hBZHNHZXRTa2luQ29udHJvbGxlcigpKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gV2F0Y2hBZHNHZXRTa2luQ29udHJvbGxlcjsiLCJ2YXIgU3RvcmVIZWxwZXIgPSByZXF1aXJlKFwiLi4vbW9kZWwvU3RvcmVIZWxwZXJcIik7XG5cbnZhciBXYXRjaEFkc1JlbGlmZUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcblxuICAgIHRoaXMuc3BDaXJjbGUgPSBudWxsO1xuXG4gICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gbnVsbDtcbiAgICAvL3RoaXMuc2tpbkNmZyA9IG51bGw7XG4gICAgdGhpcy5yZWxpZmUgPSBmYWxzZTtcbn07XG5cbmdhbWUudXRpbHMuaW5oZXJpdHMoV2F0Y2hBZHNSZWxpZmVDb250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbldhdGNoQWRzUmVsaWZlQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiAgPSBmdW5jdGlvbigpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQi5jYWxsKHRoaXMpO1xufTtcblxuV2F0Y2hBZHNSZWxpZmVDb250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aCA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgIHRoaXMuY2xvc2VDYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgIHRoaXMuc3BDaXJjbGUgPSBnYW1lLnV0aWxzLmNyZWF0ZVByb2dyZXNzVGltZXIodGhpcy5zcENpcmNsZSwgZmFsc2UsIHRydWUpO1xuICAgIHRoaXMuc3BDaXJjbGUuc2V0UGVyY2VudGFnZSgxMDApO1xuICAgIHRoaXMuc3BDaXJjbGUucnVuQWN0aW9uKGNjLnNlcXVlbmNlKGNjLnByb2dyZXNzVG8oNSwgMCksIGNjLmNhbGxGdW5jKHRoaXMuY2xvc2UsIHRoaXMpKSk7XG59O1xuXG5XYXRjaEFkc1JlbGlmZUNvbnRyb2xsZXIucHJvdG90eXBlLmNsb3NlQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB0aGlzLmNsb3NlKCk7XG59O1xuXG5XYXRjaEFkc1JlbGlmZUNvbnRyb2xsZXIucHJvdG90eXBlLndhdGNoQWRzQ2xpY2tlZCA9IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICBBdWRpb0hlbHBlci5wbGF5QnRuU291bmQoKTtcbiAgICB0aGlzLnJlbGlmZSA9IHRydWU7XG4gICAgdGhpcy5jbG9zZSgpO1xufTtcblxuV2F0Y2hBZHNSZWxpZmVDb250cm9sbGVyLnByb3RvdHlwZS5wb3B1cCA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIucG9wdXAodGhpcy5yb290Tm9kZSwge292ZXJsYXlPcGFjaXR5OiAyMjUsIHBvcHVwQW5pbTogdHJ1ZX0pO1xufTtcblxuV2F0Y2hBZHNSZWxpZmVDb250cm9sbGVyLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmRpYWxvZ01hbmFnZXIuY2xvc2UodGhpcy5yb290Tm9kZSk7XG4gICAgaWYgKHRoaXMuY2xvc2VDYWxsYmFjaykge1xuICAgICAgICB0aGlzLmNsb3NlQ2FsbGJhY2sodGhpcy5yZWxpZmUpO1xuICAgICAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBudWxsO1xuICAgIH1cbn07XG5cbldhdGNoQWRzUmVsaWZlQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy9ub3RpY2Uvd2F0Y2hfYWRzX3JlbGlmZV92aWV3LmNjYmlcIiwgbnVsbCwgXCJXYXRjaEFkc1JlbGlmZUNvbnRyb2xsZXJcIiwgbmV3IFdhdGNoQWRzUmVsaWZlQ29udHJvbGxlcigpKTtcbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gV2F0Y2hBZHNSZWxpZmVDb250cm9sbGVyOyIsInZhciBXaGVlbCA9IHJlcXVpcmUoXCIuLi8uLi9jb21tb24vd2hlZWwvV2hlZWxcIik7XG52YXIgQ29uZmlnTWFuID0gcmVxdWlyZShcIi4uL2NvbmZpZy9Db25maWdNYW5cIik7XG52YXIgQm9vc3RUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vQm9vc3RUeXBlXCIpO1xudmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xudmFyIEdhbWVNYW4gPSByZXF1aXJlKFwiLi4vbW9kZWwvR2FtZU1hblwiKTtcbnZhciBXaGVlbFR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9XaGVlbFR5cGVcIik7XG52YXIgV2hlZWxJdGVtQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuL1doZWVsSXRlbUNvbnRyb2xsZXJcIik7XG5cbnZhciBXaGVlbENvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcbiAgICB0aGlzLldIRUVMX1RJTUUgPSA1O1xuICAgIHRoaXMuV0hFRUxfSVRFTV9UQUcgPSAxMDA7XG5cbiAgICB0aGlzLldIRUVMX0NPVU5UID0gNjtcblxuICAgIHRoaXMuV0hFRUxfSVRFTV9BTkdMRSA9IDM2MCAvIHRoaXMuV0hFRUxfQ09VTlQ7XG5cbiAgICB0aGlzLm5kV2hlZWwgPSBudWxsO1xuXG4gICAgdGhpcy5uZERhaWx5V2hlZWwgPSBudWxsO1xuICAgIHRoaXMubmRCb3ggPSBudWxsO1xuXG4gICAgdGhpcy5idG5TcGluQWdhaW4gPSBudWxsO1xuXG4gICAgdGhpcy5idG5DbG9zZSA9IG51bGw7XG5cbiAgICB0aGlzLnNwVGl0bGVDbiA9IG51bGw7XG4gICAgdGhpcy5zcFRpdGxlRW4gPSBudWxsO1xuXG4gICAgdGhpcy5uZEZyZWUgPSBudWxsO1xuICAgIHRoaXMubmRXYXRjaEFkcyA9IG51bGw7XG4gICAgdGhpcy5idG5GcmVlID0gbnVsbDtcbiAgICB0aGlzLmJ0bldhdGNoQWRzID0gbnVsbDtcbiAgICB0aGlzLmxiRnJlZSA9IG51bGw7XG4gICAgdGhpcy5sYldhdGNoQWRzID0gbnVsbDtcblxuICAgIHRoaXMubGJsVGlwcyA9IG51bGw7XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7V2hlZWx9XG4gICAgICovXG4gICAgdGhpcy53aGVlbCA9IG51bGw7XG5cbiAgICB0aGlzLndoZWVsTm9kZXMgPSBudWxsO1xuXG4gICAgdGhpcy53aGVlbExpc3QgPSBudWxsO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhXaGVlbENvbnRyb2xsZXIsIEJhc2VDQ0JDb250cm9sbGVyKTtcblxuV2hlZWxDb250cm9sbGVyLnByb3RvdHlwZS5vbkVudGVyID0gZnVuY3Rpb24gKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkVudGVyLmNhbGwodGhpcyk7XG4gICAgdGhpcy5pbnRlcnZhbEtleSA9IHNldEludGVydmFsKHRoaXMub25VcGRhdGUuYmluZCh0aGlzKSwgMTAwMCk7XG59O1xuXG5XaGVlbENvbnRyb2xsZXIucHJvdG90eXBlLm9uRXhpdCA9IGZ1bmN0aW9uICgpIHtcbiAgICBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWxLZXkpO1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkV4aXQuY2FsbCh0aGlzKTtcbn07XG5cbldoZWVsQ29udHJvbGxlci5wcm90b3R5cGUub25EaWRMb2FkRnJvbUNDQiA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG5cbiAgICAvL3RoaXMuYnRuQ2xvc2VDbi52aXNpYmxlID0gZmFsc2U7XG4gICAgLy90aGlzLmJ0bkNsb3NlRW4udmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMuc3BUaXRsZUNuLnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLnNwVGl0bGVFbi52aXNpYmxlID0gZmFsc2U7XG4gICAgaWYgKGdhbWUubG9jYWwuaXNDaGluZXNlKCkpIHtcbiAgICAgICAgLy90aGlzLmJ0bkNsb3NlQ24udmlzaWJsZSA9IHRydWU7XG4gICAgICAgIHRoaXMuc3BUaXRsZUNuLnZpc2libGUgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vdGhpcy5idG5DbG9zZUVuLnZpc2libGUgPSB0cnVlO1xuICAgICAgICB0aGlzLnNwVGl0bGVFbi52aXNpYmxlID0gdHJ1ZTtcbiAgICB9XG5cbiAgICB0aGlzLndoZWVsTm9kZXMgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuV0hFRUxfQ09VTlQ7ICsraSkge1xuICAgICAgICB2YXIgd2hlZWxOb2RlID0gZ2FtZS51dGlscy5zZWVrTm9kZUJ5VGFnKHRoaXMubmRXaGVlbCwgdGhpcy5XSEVFTF9JVEVNX1RBRyArIGkpO1xuICAgICAgICB0aGlzLndoZWVsTm9kZXMucHVzaCh3aGVlbE5vZGUpO1xuICAgIH1cblxufTtcblxuV2hlZWxDb250cm9sbGVyLnByb3RvdHlwZS5pc0RhaWx5V2hlZWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuICh0aGlzLndoZWVsVHlwZSA9PT0gV2hlZWxUeXBlLkRhaWx5Qm9udXMpO1xufTtcblxuV2hlZWxDb250cm9sbGVyLnByb3RvdHlwZS5pbml0V2l0aCA9IGZ1bmN0aW9uICh3aGVlbFR5cGUsIGNhbGxiYWNrKSB7XG4gICAgdGhpcy53aGVlbFR5cGUgPSB3aGVlbFR5cGU7XG4gICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gY2FsbGJhY2s7XG4gICAgdGhpcy5uZEJveC52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5uZERhaWx5V2hlZWwudmlzaWJsZSA9IGZhbHNlO1xuICAgIHN3aXRjaCAod2hlZWxUeXBlKSB7XG4gICAgICAgIGNhc2UgV2hlZWxUeXBlLkRhaWx5Qm9udXM6XG4gICAgICAgICAgICB0aGlzLm5kRGFpbHlXaGVlbC52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMud2hlZWxMaXN0ID0gQ29uZmlnTWFuLmdldEluc3RhbmNlKCkuZ2V0V2hlZWxMaXN0KCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBXaGVlbFR5cGUuQm94OlxuICAgICAgICAgICAgdGhpcy5uZEJveC52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMud2hlZWxMaXN0ID0gQ29uZmlnTWFuLmdldEluc3RhbmNlKCkuZ2V0Qm94V2hlZWxMaXN0KCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICBpZiAodGhpcy5pc0RhaWx5V2hlZWwoKSkge1xuICAgICAgICBpZiAodGhpcy5pc0ZyZWVXaGVlbCgpKSB7XG4gICAgICAgICAgICBnYW1lLnBsYXllck1hbi5yZXNldFdoZWVsTG9ja2VkKCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gcmVwbGFjZVxuICAgICAgICAvL3JlcGxhY2Ugc2tpbiBjb25maWcuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy53aGVlbExpc3QubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciB3aGVlbCA9IHRoaXMud2hlZWxMaXN0W2ldO1xuICAgICAgICAgICAgaWYgKHdoZWVsLnR5cGUgPT09IEJvb3N0VHlwZS5TS0lOKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNraW5DZmcgPSBnYW1lLmdhbWVNYW4uZ2V0V2hlZWxSYW5kb21Ta2luKCk7XG4gICAgICAgICAgICAgICAgaWYgKHNraW5DZmcpIHtcbiAgICAgICAgICAgICAgICAgICAgd2hlZWwuZXh0cmEgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBCb29zdFR5cGUuU0tJTixcbiAgICAgICAgICAgICAgICAgICAgICAgIGNmZzogc2tpbkNmZyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlOiBza2luQ2ZnLmltYWdlICsgXCIucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3VudDogMVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHdoZWVsLnR5cGUgPSBCb29zdFR5cGUuRElBTU9ORDtcbiAgICAgICAgICAgICAgICAgICAgd2hlZWwuaW1hZ2UgPSBcImljb25fZGlhbW9uZF8xLnBuZ1wiO1xuICAgICAgICAgICAgICAgICAgICB3aGVlbC5jb3VudCA9IDEwMDtcbiAgICAgICAgICAgICAgICAgICAgd2hlZWwuc2NhbGUgPSAxLjI7XG4gICAgICAgICAgICAgICAgICAgIHdoZWVsLnByb2JhYmlsaXR5ID0gNTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmluaXRXaGVlbFVJKCk7XG4gICAgdGhpcy51cGRhdGVXaGVlbEl0ZW1zKCk7XG4gICAgdGhpcy53aGVlbCA9IG5ldyBXaGVlbCh0aGlzLm5kV2hlZWwsIGdhbWUudXRpbHMuZ2V0Q3VycmVudEZQUygpKTtcbiAgICBpZiAod2hlZWxUeXBlID09PSBXaGVlbFR5cGUuQm94KSB7XG4gICAgICAgIHRoaXMuc3RhcnRXaGVlbCgpO1xuICAgIH1cbn07XG5cbldoZWVsQ29udHJvbGxlci5wcm90b3R5cGUuaW5pdFdoZWVsVUkgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHdoZWVscyA9IHRoaXMud2hlZWxMaXN0O1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgd2hlZWxzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgIHRoaXMud2hlZWxOb2Rlc1tpXS5jb250cm9sbGVyLmluaXRXaXRoKHdoZWVsc1tpXSwgdGhpcy53aGVlbFR5cGUpO1xuICAgIH1cbn07XG5cbldoZWVsQ29udHJvbGxlci5wcm90b3R5cGUuaXNTaG93UmV3YXJkZWRWaWRlbyA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZ2FtZS5hZHNNYW5hZ2VyLmlzUmV3YXJkVmlkZW9SZWFkeSgpO1xufTtcblxuV2hlZWxDb250cm9sbGVyLnByb3RvdHlwZS5vblVwZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAvLyB0aGlzLnVwZGF0ZVdoZWVsSXRlbXMoKTtcbn07XG5cbldoZWVsQ29udHJvbGxlci5wcm90b3R5cGUuaXNGcmVlV2hlZWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGxlZnRUaW1lID0gR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmdldFdoZWVsTGVmdFRpbWUoKTtcbiAgICBpZiAobGVmdFRpbWUgPD0gMCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufTtcblxuV2hlZWxDb250cm9sbGVyLnByb3RvdHlwZS5nZXRMZWZ0SG91ciA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgbGVmdFRpbWUgPSBHYW1lTWFuLmdldEluc3RhbmNlKCkuZ2V0V2hlZWxMZWZ0VGltZSgpO1xuICAgIHJldHVybiBNYXRoLmNlaWwobGVmdFRpbWUgLyAoNjAgKiA2MCAqIDEwMDApKTtcbn07XG5cbldoZWVsQ29udHJvbGxlci5wcm90b3R5cGUudXBkYXRlV2hlZWxJdGVtcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAvL3RoaXMubGJsTGVmdC5zZXRTdHJpbmcoXyhcIndoZWVsX3Jld2FyZF92aWRlb19idG5cIikpO1xuICAgIC8vdGhpcy5sYmxMZWZ0VGlwcy5zZXRTdHJpbmcoXyhcIndoZWVsX3Jld2FyZF92aWRlb190aXBzXCIpKTtcblxuICAgIC8vdGhpcy5sYmxSaWdodC5zZXRTdHJpbmcoXyhcIndoZWVsX2ZyZWVfYnRuXCIpKTtcbiAgICBpZiAoIXRoaXMuaXNEYWlseVdoZWVsKCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgZnJlZVdoZWVsID0gdGhpcy5pc0ZyZWVXaGVlbCgpO1xuICAgIHRoaXMubmRGcmVlLnZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLm5kV2F0Y2hBZHMudmlzaWJsZSA9IGZhbHNlO1xuICAgIHZhciBsZWZ0Q291bnQgPSBnYW1lLmNvbmZpZy5kYWlseVdoZWVsTWF4Q291bnQgLSBnYW1lLnBsYXllck1hbi5nZXRXaGVlbGVkQ291bnQoKTtcbiAgICB2YXIgdG90YWxDb3VudCA9IGdhbWUuY29uZmlnLmRhaWx5V2hlZWxNYXhDb3VudDtcbiAgICB2YXIgdGlwcyA9IF8oXCJmcmVlX2NvaW5zX3RpdGxlXCIpICsgXCIoXCIgKyBsZWZ0Q291bnQgKyBcIi9cIiArIHRvdGFsQ291bnQgKyBcIilcIjtcbiAgICB0aGlzLmxibFRpcHMuc2V0U3RyaW5nKFwiXCIpO1xuICAgIGlmIChmcmVlV2hlZWwpIHtcbiAgICAgICAgdGhpcy5uZEZyZWUudmlzaWJsZSA9IHRydWU7XG4gICAgICAgIHRoaXMubGJGcmVlLnNldFN0cmluZyh0aXBzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLm5kV2F0Y2hBZHMudmlzaWJsZSA9IHRydWU7XG4gICAgICAgIHRoaXMubGJXYXRjaEFkcy5zZXRTdHJpbmcodGlwcyk7XG4gICAgICAgIGlmIChsZWZ0Q291bnQgPD0gMCkge1xuICAgICAgICAgICAgdGhpcy5idG5XYXRjaEFkcy5lbmFibGVkID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmxibFRpcHMuc2V0U3RyaW5nKGdhbWUudXRpbHMuc3ByaW50ZihfKFwid2hlZWxfZnJlZV90aXBzXCIpLCB0aGlzLmdldExlZnRIb3VyKCkpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuYnRuV2F0Y2hBZHMuZW5hYmxlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG5XaGVlbENvbnRyb2xsZXIucHJvdG90eXBlLnNob3dXaGVlbFNvbGRPdXRBbmltID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgdmFyIHdoZWVsTm9kZSA9IHRoaXMud2hlZWxOb2Rlc1tpZCAtIDFdO1xuICAgIHdoZWVsTm9kZS5jb250cm9sbGVyLnBsYXlTb2xkT3V0QW5pbSgpO1xufTtcblxuV2hlZWxDb250cm9sbGVyLnByb3RvdHlwZS5nZXRSYW5kb21XaGVlbCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgd2hlZWxzID0gdGhpcy53aGVlbExpc3Q7XG4gICAgdmFyIGNvdW50ID0gMDtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHdoZWVscy5sZW5ndGg7ICsraSkge1xuICAgICAgICBpZiAoIXRoaXMuaXNXaGVlbExvY2tlZCh3aGVlbHNbaV0uaWQpKSB7XG4gICAgICAgICAgICBjb3VudCArPSB3aGVlbHNbaV0ucHJvYmFiaWxpdHk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2MubG9nKFwiY291bnQ6XCIgKyBjb3VudCk7XG4gICAgdmFyIHJhbmRvbU51bSA9IGdhbWUudXRpbHMucmFuZG9tTmV4dEludChjb3VudCk7XG4gICAgY2MubG9nKFwicmFuZG9tTnVtOlwiICsgcmFuZG9tTnVtKTtcbiAgICB2YXIgc3VtUHJvYmFiaWxpdHkgPSAwO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgd2hlZWxzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgIGlmICh0aGlzLmlzV2hlZWxMb2NrZWQod2hlZWxzW2ldLmlkKSkge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHN1bVByb2JhYmlsaXR5ICsgd2hlZWxzW2ldLnByb2JhYmlsaXR5ID4gcmFuZG9tTnVtKSB7XG4gICAgICAgICAgICByZXR1cm4gd2hlZWxzW2ldO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3VtUHJvYmFiaWxpdHkgKz0gd2hlZWxzW2ldLnByb2JhYmlsaXR5O1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xufTtcblxuV2hlZWxDb250cm9sbGVyLnByb3RvdHlwZS5pc1doZWVsTG9ja2VkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgaWYgKCF0aGlzLmlzRGFpbHlXaGVlbCgpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKGdhbWUucGxheWVyTWFuLmlzV2hlZWxMb2NrZWQoaWQpKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59O1xuXG5XaGVlbENvbnRyb2xsZXIucHJvdG90eXBlLnN0YXJ0V2hlZWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy53aGVlbENvbmZpZyA9IHRoaXMuZ2V0UmFuZG9tV2hlZWwoKTtcbiAgICB2YXIgd2hlZWxJZCA9IHRoaXMud2hlZWxDb25maWcuaWQ7XG4gICAgY29uc29sZS5sb2coXCJyYW5kb20gd2hlZWwgaWQ6XCIgKyB3aGVlbElkKTtcbiAgICB0aGlzLndoZWVsLnJvdGF0ZSh0aGlzLldIRUVMX1RJTUUsIDM2MCAqIDMgKyAod2hlZWxJZCAtIDEpICogdGhpcy5XSEVFTF9JVEVNX0FOR0xFLCB0aGlzLldIRUVMX0lURU1fQU5HTEUsIHRoaXMub25Sb3RhdGVFbmQuYmluZCh0aGlzKSk7XG4gICAgdGhpcy5idG5DbG9zZS5lbmFibGVkID0gZmFsc2U7XG4gICAgdGhpcy5idG5TcGluQWdhaW4uZW5hYmxlZCA9IGZhbHNlO1xuICAgIHRoaXMud2hlZWxJbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJ3aGVlbF9waW5cIik7XG4gICAgfSwgMTAwKTtcbiAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlNdXNpY0J5S2V5KFwid2hlZWxfYmdcIik7XG4gICAgZ2FtZS5hY3Rpdml0eU1hbi5hZGRBY3Rpdml0eVRhc2tDb3VudChnYW1lLmFjdGl2aXR5VGFza1R5cGUuV2hlZWwpO1xufTtcblxuV2hlZWxDb250cm9sbGVyLnByb3RvdHlwZS5vblJvdGF0ZUVuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBjbGVhckludGVydmFsKHRoaXMud2hlZWxJbnRlcnZhbCk7XG4gICAgZ2FtZS5hdWRpb1BsYXllci5zdG9wTXVzaWMoKTtcbiAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcIndoZWVsX3N0b3BcIik7XG4gICAgc2V0VGltZW91dCh0aGlzLm9uU2hvd1Jld2FyZC5iaW5kKHRoaXMpLCAxMDAwKTtcbn07XG5cbldoZWVsQ29udHJvbGxlci5wcm90b3R5cGUub25TaG93UmV3YXJkID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciB3aGVlbCA9IHRoaXMud2hlZWxDb25maWc7XG4gICAgaWYgKCF0aGlzLmlzRGFpbHlXaGVlbCgpKSB7XG4gICAgICAgIFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkucG9wdXBSZXdhcmREb3VibGVEbGcod2hlZWwuY291bnQsIHdoZWVsLnR5cGUsIGdhbWUudXRpbHMuaXNJT1MoKSA/IFwiemh1YW5wYW4wMlwiIDogXCJqaWxpMDJcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5idG5DbG9zZS5lbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuYnRuU3BpbkFnYWluLmVuYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVXaGVlbEl0ZW1zKCk7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBnYW1lLnBsYXllck1hbi5zZXRXaGVlbExvY2tlZCh3aGVlbC5pZCk7XG4gICAgdmFyIGNvdW50ID0gd2hlZWwuY291bnQ7XG4gICAgdmFyIHR5cGUgPSB3aGVlbC50eXBlO1xuICAgIHZhciBpc1NraW5SZXdhcmQgPSBmYWxzZTtcbiAgICBpZiAod2hlZWwudHlwZSA9PT0gQm9vc3RUeXBlLlNLSU4pIHtcbiAgICAgICAgaXNTa2luUmV3YXJkID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGlzU2tpblJld2FyZCkge1xuICAgICAgICBTdG9yZUhlbHBlci5nZXRJbnN0YW5jZSgpLmNsYWltU2tpblJld2FyZCh3aGVlbC5leHRyYS5jZmcsIHRydWUsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMub25XaGVlbFJld2FyZENsYWltZWQod2hlZWwuaWQpO1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkucG9wdXBSZXdhcmREb3VibGVEbGcoY291bnQsIHR5cGUsIGdhbWUudXRpbHMuaXNJT1MoKSA/IFwiemh1YW5wYW4wMlwiIDogXCJqaWxpMDJcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5vbldoZWVsUmV3YXJkQ2xhaW1lZCh3aGVlbC5pZCk7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfVxufTtcblxuV2hlZWxDb250cm9sbGVyLnByb3RvdHlwZS5vbldoZWVsUmV3YXJkQ2xhaW1lZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgIHRoaXMuYnRuQ2xvc2UuZW5hYmxlZCA9IHRydWU7XG4gICAgdGhpcy51cGRhdGVXaGVlbEl0ZW1zKCk7XG4gICAgdGhpcy5zaG93V2hlZWxTb2xkT3V0QW5pbShpZCk7XG59O1xuXG5XaGVlbENvbnRyb2xsZXIucHJvdG90eXBlLndhdGNoQWRzV2hlZWxDbGlja2VkID0gZnVuY3Rpb24gKCkge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBpZiAodGhpcy5pc1Nob3dSZXdhcmRlZFZpZGVvKCkpIHtcbiAgICAgICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5jaGVja0FuZFNob3dSZXdhcmRWaWRlbyhnYW1lLnV0aWxzLmlzSU9TKCkgPyBcInpodWFucGFuMDFcIiA6IFwiamlsaTAxXCIsIGZ1bmN0aW9uIChyZXdhcmRlZCkge1xuICAgICAgICAgICAgaWYgKHJld2FyZGVkKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5zdGFydFdoZWVsKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBzZWxmLnVwZGF0ZVdoZWVsSXRlbXMoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMuYnRuV2F0Y2hBZHMuZW5hYmxlZCA9IGZhbHNlO1xufTtcblxuV2hlZWxDb250cm9sbGVyLnByb3RvdHlwZS5zcGluQWdhaW5DbGlja2VkID0gZnVuY3Rpb24gKCkge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBpZiAodGhpcy5pc1Nob3dSZXdhcmRlZFZpZGVvKCkpIHtcbiAgICAgICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5jaGVja0FuZFNob3dSZXdhcmRWaWRlbyhcInNwaW5fYWdhaW5cIiwgZnVuY3Rpb24gKHJld2FyZGVkKSB7XG4gICAgICAgICAgICBpZiAocmV3YXJkZWQpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnN0YXJ0V2hlZWwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufTtcblxuV2hlZWxDb250cm9sbGVyLnByb3RvdHlwZS5mcmVlV2hlZWxDbGlja2VkID0gZnVuY3Rpb24gKCkge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIGdhbWUucGxheWVyTWFuLnNldExhc3RXaGVlbFRpbWUoRGF0ZS5ub3coKSk7XG4gICAgdGhpcy5idG5GcmVlLmVuYWJsZWQgPSBmYWxzZTtcbiAgICB0aGlzLnN0YXJ0V2hlZWwoKTtcbn07XG5cbldoZWVsQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2VDbGlja2VkID0gZnVuY3Rpb24gKCkge1xuICAgIEF1ZGlvSGVscGVyLnBsYXlCdG5Tb3VuZCgpO1xuICAgIHRoaXMuY2xvc2UoKTtcbn07XG5cbldoZWVsQ29udHJvbGxlci5wcm90b3R5cGUucG9wdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLnBvcHVwKHRoaXMucm9vdE5vZGUsIHtwb3B1cEFuaW06IHRydWV9KTtcbn07XG5cbldoZWVsQ29udHJvbGxlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLmNsb3NlKHRoaXMucm9vdE5vZGUpO1xuICAgIGlmICh0aGlzLmNsb3NlQ2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5jbG9zZUNhbGxiYWNrKCk7XG4gICAgICAgIHRoaXMuY2xvc2VDYWxsYmFjayA9IG51bGw7XG4gICAgfVxuICAgIHdpbmRvdy5sYXN0V2hlZWxOb2RlID0gbnVsbDtcbn07XG5cbldoZWVsQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHdpbmRvdy5sYXN0V2hlZWxOb2RlKSB7XG4gICAgICAgIHdpbmRvdy5sYXN0V2hlZWxOb2RlLmNvbnRyb2xsZXIuY2xvc2UoKTtcbiAgICAgICAgd2luZG93Lmxhc3RXaGVlbE5vZGUgPSBudWxsO1xuICAgIH1cbiAgICBnYW1lLnV0aWxzLnJlZ2lzdGVyQ29udHJvbGxlcihcIldoZWVsSXRlbUNvbnRyb2xsZXJcIiwgbmV3IFdoZWVsSXRlbUNvbnRyb2xsZXIoKSk7XG4gICAgdmFyIG5vZGUgPSBnYW1lLnV0aWxzLmxvYWROb2RlRnJvbUNDQihcInJlcy93aGVlbC93aGVlbF92aWV3LmNjYmlcIiwgbnVsbCwgXCJXaGVlbENvbnRyb2xsZXJcIiwgbmV3IFdoZWVsQ29udHJvbGxlcigpKTtcbiAgICBnYW1lLnV0aWxzLnVuUmVnaXN0ZXJDb250cm9sbGVyKFwiV2hlZWxJdGVtQ29udHJvbGxlclwiKTtcbiAgICB3aW5kb3cubGFzdFdoZWVsTm9kZSA9IG5vZGU7XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFdoZWVsQ29udHJvbGxlcjsiLCJ2YXIgQm9vc3RUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vQm9vc3RUeXBlXCIpO1xudmFyIFdoZWVsVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1doZWVsVHlwZVwiKTtcblxudmFyIFdoZWVsSXRlbUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIuY2FsbCh0aGlzKTtcbiAgICB0aGlzLm5kU29sZE91dCA9IG51bGw7XG4gICAgdGhpcy5zcFNvbGRPdXRDbiA9IG51bGw7XG4gICAgdGhpcy5zcFNvbGRPdXRFbiA9IG51bGw7XG4gICAgdGhpcy5zcHJJY29uID0gbnVsbDtcbiAgICB0aGlzLmxiQ291bnQgPSBudWxsO1xufTtcblxuZ2FtZS51dGlscy5pbmhlcml0cyhXaGVlbEl0ZW1Db250cm9sbGVyLCBCYXNlQ0NCQ29udHJvbGxlcik7XG5cbldoZWVsSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgQmFzZUNDQkNvbnRyb2xsZXIucHJvdG90eXBlLm9uRW50ZXIuY2FsbCh0aGlzKTtcbn07XG5cbldoZWVsSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLm9uRXhpdCA9IGZ1bmN0aW9uICgpIHtcbiAgICBCYXNlQ0NCQ29udHJvbGxlci5wcm90b3R5cGUub25FeGl0LmNhbGwodGhpcyk7XG59O1xuXG5XaGVlbEl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCICA9IGZ1bmN0aW9uKCkge1xuICAgIEJhc2VDQ0JDb250cm9sbGVyLnByb3RvdHlwZS5vbkRpZExvYWRGcm9tQ0NCLmNhbGwodGhpcyk7XG4gICAgdGhpcy5zcFNvbGRPdXRDbi52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5zcFNvbGRPdXRFbi52aXNpYmxlID0gZmFsc2U7XG4gICAgaWYgKGdhbWUubG9jYWwuaXNDaGluZXNlKCkpIHtcbiAgICAgICAgdGhpcy5zcFNvbGRPdXRDbi52aXNpYmxlID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNwU29sZE91dEVuLnZpc2libGUgPSB0cnVlO1xuICAgIH1cbn07XG5cbldoZWVsSXRlbUNvbnRyb2xsZXIucHJvdG90eXBlLmluaXRXaXRoID0gZnVuY3Rpb24gKGRhdGEsIHdoZWVsVHlwZSkge1xuICAgIHRoaXMuc3BySWNvbi5zY2FsZSAqPSBkYXRhLnNjYWxlO1xuICAgIGlmICh3aGVlbFR5cGUgPT09IFdoZWVsVHlwZS5EYWlseUJvbnVzICYmIGdhbWUucGxheWVyTWFuLmlzV2hlZWxMb2NrZWQoZGF0YS5pZCkpIHtcbiAgICAgICAgdGhpcy5uZFNvbGRPdXQudmlzaWJsZSA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5uZFNvbGRPdXQudmlzaWJsZSA9IGZhbHNlO1xuICAgIH1cbiAgICBpZiAoZGF0YS50eXBlID09PSBCb29zdFR5cGUuU0tJTikge1xuICAgICAgICBpZiAoZGF0YS5leHRyYS50eXBlID09PSBCb29zdFR5cGUuU0tJTikge1xuICAgICAgICAgICAgdGhpcy5zcHJJY29uLnNldFNwcml0ZUZyYW1lKGRhdGEuZXh0cmEuaW1hZ2UpO1xuICAgICAgICAgICAgdGhpcy5sYkNvdW50LnNldFN0cmluZyhcInhcIiArIGRhdGEuZXh0cmEuY291bnQpO1xuICAgICAgICAgICAgdGhpcy5zcHJJY29uLnNjYWxlICo9IDEuNjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc3BySWNvbi5zZXRTcHJpdGVGcmFtZShkYXRhLmV4dHJhLmltYWdlKTtcbiAgICAgICAgICAgIHRoaXMubGJDb3VudC5zZXRTdHJpbmcoXCJ4XCIgKyBkYXRhLmV4dHJhLmNvdW50KTtcbiAgICAgICAgICAgIHRoaXMuc3BySWNvbi5zY2FsZSAqPSAxLjI7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNwckljb24uc2V0U3ByaXRlRnJhbWUoZGF0YS5pbWFnZSk7XG4gICAgICAgIHRoaXMubGJDb3VudC5zZXRTdHJpbmcoXCJ4XCIgKyBkYXRhLmNvdW50KTtcbiAgICB9XG59O1xuXG5XaGVlbEl0ZW1Db250cm9sbGVyLnByb3RvdHlwZS5wbGF5U29sZE91dEFuaW0gPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5uZFNvbGRPdXQudmlzaWJsZSA9IHRydWU7XG4gICAgZ2FtZS51dGlscy5wbGF5Q0NCQW5pbWF0aW9uKHRoaXMucm9vdE5vZGUsIFwic29sZFwiKTtcbiAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcInNvbGRfb3V0XCIpO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBXaGVlbEl0ZW1Db250cm9sbGVyOyIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDIwMTcvMTIvMi5cbiAqL1xuXG52YXIgR3JpZCA9IGNjLkxheWVyQ29sb3IuZXh0ZW5kKHtcblxuICAgIGNvbDogMCxcbiAgICByb3c6IDAsXG5cbiAgICBlZGl0aW5nOiBmYWxzZSxcbiAgICB1c2VkOiBmYWxzZSxcblxuICAgIGN0b3I6IGZ1bmN0aW9uIChjb2xvciwgd2lkdGgsIGhlaWdodCwgY29sLCByb3cpIHtcbiAgICAgICAgdGhpcy5fc3VwZXIoY29sb3IsIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICB0aGlzLmlnbm9yZUFuY2hvciA9IGZhbHNlO1xuICAgICAgICAvL3RoaXMudHlwZSA9IHR5cGU7XG4gICAgICAgIHRoaXMuY29sID0gY29sO1xuICAgICAgICB0aGlzLnJvdyA9IHJvdztcbiAgICB9LFxuXG4gICAgc2V0Q29sb3I6IGZ1bmN0aW9uIChjb2xvcikge1xuICAgICAgICB0aGlzLl9zdXBlcihjb2xvcik7XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gR3JpZDsiLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAyMDE4LzkvMjZcbiAqKi9cbnZhciBDb25maWdNYW4gPSByZXF1aXJlKFwiLi4vLi4vY29uZmlnL0NvbmZpZ01hblwiKTtcblxudmFyIEVkaXRvckhlbHBlciA9IHtcbiAgICAvKipcbiAgICAgKiBAdHlwZSB7Q29tbW9uRXZlbnR9XG4gICAgICovXG4gICAgQ29tbW9uRXZlbnQ6IG51bGwsXG4gICAgLyoqXG4gICAgICogQHR5cGUge01hcERpc3BsYXlUeXBlfVxuICAgICAqL1xuICAgIE1hcERpc3BsYXlUeXBlOiBudWxsLFxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtFZGl0b3JIdHRwQ29uc3R9XG4gICAgICovXG4gICAgRWRpdG9ySHR0cENvbnN0OiBudWxsLFxuICAgIGxvY2FsU2VydmVyUGF0aDogXCJodHRwOi8vbG9jYWxob3N0Ojg4ODhcIixcblxuICAgIHBvc3REYXRhOiBmdW5jdGlvbiAodXJsLCBjYWxsYmFjaywgcGFyYSkge1xuICAgICAgICB1cmwgPSB0aGlzLmxvY2FsU2VydmVyUGF0aCArIHVybDtcbiAgICAgICAgdmFyIHhodHRwID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgIHhodHRwLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGNhbGxiYWNrKHhodHRwKTtcbiAgICAgICAgeGh0dHAub3BlbihcIlBPU1RcIiwgdXJsLCB0cnVlKTtcbiAgICAgICAgaWYgKHR5cGVvZiBwYXJhICE9IFwidW5kaWZpbmVkXCIpIHtcbiAgICAgICAgICAgIHhodHRwLnNldFJlcXVlc3RIZWFkZXIoXCJDb250ZW50LXR5cGVcIiwgXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIik7XG4gICAgICAgICAgICB4aHR0cC5zZW5kKHBhcmEpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgeGh0dHAuc2VuZCgpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNhdmVMZXZlbENvbmZpZzogZnVuY3Rpb24gKGxldmVsQ2ZnKSB7XG4gICAgICAgIHZhciBsZXZlbENvbmZpZ3MgPSBDb25maWdNYW4uZ2V0SW5zdGFuY2UoKS5vcmlnaW5hbExldmVsTGlzdDtcbiAgICAgICAgaWYgKGxldmVsQ2ZnLmlkID4gMCkge1xuICAgICAgICAgICAgbGV2ZWxDb25maWdzW2xldmVsQ2ZnLmlkIC0gMV0gPSBsZXZlbENmZztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxldmVsQ29uZmlncy5wdXNoKGxldmVsQ2ZnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciByZXN1bHRzID0gJ3tcImxldmVsc1wiOiBbXFxuJztcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZXZlbENvbmZpZ3MubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHJlc3VsdHMgKz0gSlNPTi5zdHJpbmdpZnkobGV2ZWxDb25maWdzW2ldKTtcbiAgICAgICAgICAgIGlmIChpICE9PSBsZXZlbENvbmZpZ3MubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdHMgKz0gXCIsXFxuXCI7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdHMgKz0gXCJcXG5cIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXN1bHRzICs9ICddfSc7XG5cbiAgICAgICAgdGhpcy5wb3N0RGF0YShcIi9zYXZlX2xldmVsX2NvbmZpZ3NcIiwgZnVuY3Rpb24oeGh0dHApIHtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAoeGh0dHAucmVhZHlTdGF0ZSA9PSA0ICYmIHhodHRwLnN0YXR1cyA9PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgYWxlcnQoXCJzYXZlIGxldmVsIGNvbmZpZyBzdWNjZXNzXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sIHJlc3VsdHMpO1xuICAgIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gRWRpdG9ySGVscGVyOyIsInZhciBDb25maWdNYW4gPSByZXF1aXJlKFwiLi4vLi4vY29uZmlnL0NvbmZpZ01hblwiKTtcbnZhciBQbGF5ZXJNYW4gPSByZXF1aXJlKFwiLi4vLi4vbW9kZWwvUGxheWVyTWFuXCIpO1xudmFyIExldmVsQ29uZmlnID0gcmVxdWlyZShcIi4uLy4uL2NvbmZpZy9MZXZlbENvbmZpZ1wiKTtcbnZhciBFZGl0b3JIZWxwZXIgPSByZXF1aXJlKFwiLi4vaGVscGVyL0VkaXRvckhlbHBlclwiKTtcbnZhciBIdHRwQ2xpZW50ID0gcmVxdWlyZShcIi4uLy4uLy4uL2NvbW1vbi9uZXQvSHR0cENsaWVudFwiKVxuLy92YXIgQWRzUmVtaW5kZXJDb250cm9sbGVyID0gcmVxdWlyZShcIi4uLy4uL2NvbnRyb2xsZXIvQWRzUmVtaW5kZXJDb250cm9sbGVyXCIpO1xuXG52YXIgQ29sb3JDb25maWdzID0gW1xuICAgIGNjLmNvbG9yKDI1MiwgMTc4LCAwKSxcbiAgICBjYy5jb2xvcig3NCwgMjMzLCAwKSxcbiAgICBjYy5jb2xvcigyNywgMjI2LCAyNTUpLFxuICAgIGNjLmNvbG9yKDI1NSwgMjUyLCAyOSksXG4gICAgY2MuY29sb3IoMjU1LCA1NiwgNTYpLFxuICAgIGNjLmNvbG9yKDI0OCwgNzAsIDI1NSksXG4gICAgY2MuY29sb3IoMjU1LCAxMjksIDE3KSxcbiAgICBjYy5jb2xvcig1NywgMTAzLCAyNDkpLFxuICAgIGNjLmNvbG9yKDkwLCAxODEsIDExMCksXG5cbiAgICBjYy5jb2xvcigyNTUsIDkwLCAxNDEpLFxuICAgIGNjLmNvbG9yKDI0MiwgODYsIDkpLFxuICAgIGNjLmNvbG9yKDg5LCA1OSwgMjU1KSxcbiAgICBjYy5jb2xvcigxNTcsIDgzLCAyNTUpLFxuICAgIGNjLmNvbG9yKDQ1LCAyMzIsIDE1MCksXG4gICAgY2MuY29sb3IoMTc2LCA3MiwgMjA2KSxcbiAgICBjYy5jb2xvcigxNjgsIDI0NiwgMzIpLFxuICAgIGNjLmNvbG9yKDQ2LCA3NiwgMjU1KSxcbiAgICBjYy5jb2xvcigyMzksIDIyMSwgMjAxKSxcbiAgICBjYy5jb2xvcigyNTMsIDIwOSwgMTMzKSxcbiAgICBjYy5jb2xvcigyNDksIDc0LCAxNTUpLFxuICAgIGNjLmNvbG9yKDI5LCA2MCwgOTQpXG5dO1xuXG52YXIgR3JpZFR5cGUgPSB7XG4gICAgTm9uZTogMCxcbiAgICBHcmlkOiAxLFxuICAgIFdhbGw6IDJcbn1cblxudmFyIEdyYXlDb2xvciA9IGNjLmNvbG9yLkdSQVk7XG52YXIgTGlnaHRHcmF5Q29sb3IgPSBjYy5jb2xvcigxMzAsIDEzMCwgMTMwKTtcbnZhciBTdGF0dXNMaXN0ID0gW1wiYnJpY2tcIiwgXCJvYnN0YWNsZVwiLCBcImRlbGV0ZVwiXTtcblxudmFyIEVkaXRvclNjZW5lID0gY2MuU2NlbmUuZXh0ZW5kKHtcblxuICAgIENPTlRFTlRfV0lEVEg6IDYwMCxcbiAgICBDT05URU5UX0hFSUdIVDogNjAwLFxuXG4gICAgQ09MOiA1MCxcbiAgICBST1c6IDUwLFxuXG4gICAgR1JJRF9XSURUSDogOSxcbiAgICBHUklEX0hFSUdIVDogOSxcblxuICAgIEdBUF9XSURUSDogMyxcbiAgICBHQVBfSEVJR0hUOiAzLFxuXG4gICAgYnJpY2tSZWN0czogbnVsbCxcblxuICAgIG9ic3RhY2xlUmVjdHM6IG51bGwsXG5cbiAgICAvL19pc0JyaWNrOiB0cnVlLFxuICAgIF9zdGF0dXM6IFwiYnJpY2tcIixcblxuICAgIF9icmlja0l0ZW06IG51bGwsXG5cbiAgICBfbGV2ZWxFZGl0Qm94OiBudWxsLFxuXG4gICAgY3RvcjogZnVuY3Rpb24gKCkge1xuICAgICAgICBnYW1lLnBsYXllck1hbiA9IFBsYXllck1hbi5nZXRJbnN0YW5jZSgpO1xuICAgICAgICBnYW1lLnBsYXllck1hbi5pbml0RGF0YSgpO1xuXG4gICAgICAgIGdhbWUucGxheWVyTWFuLnNldEJvb3N0KDIsIDQwMCk7XG4gICAgICAgIGdhbWUucGxheWVyTWFuLnNldEJvb3N0KDMsIDQwMCk7XG5cbiAgICAgICAgLy92YXIgTG9naWNNYW4gPSByZXF1aXJlKFwiLi4vLi4vLi4vY29tbW9uL21vZGVsL0xvZ2ljTWFuXCIpO1xuICAgICAgICAvL0xvZ2ljTWFuLmdldEluc3RhbmNlKCkuc3RhcnRHYW1lKHRydWUpO1xuICAgICAgICAvL2NjLkJ1aWxkZXJSZWFkZXIucmVnaXN0ZXJDb250cm9sbGVyKFwiQWRzUmVtaW5kZXJDb250cm9sbGVyXCIsIG5ldyBBZHNSZW1pbmRlckNvbnRyb2xsZXIoKSk7XG5cbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcblxuICAgICAgICB2YXIgc2NhbGUgPSAxLjU7XG4gICAgICAgIHRoaXMueE9mZnNldCA9IChjYy53aW5TaXplLndpZHRoIC0gdGhpcy5DT05URU5UX1dJRFRIICogc2NhbGUpICogMC41O1xuICAgICAgICB0aGlzLnlPZmZzZXQgPSAoY2Mud2luU2l6ZS5oZWlnaHQgLSB0aGlzLkNPTlRFTlRfSEVJR0hUICogc2NhbGUpICogMC41O1xuXG4gICAgICAgIHRoaXMuYnJpY2tSZWN0cyA9IFtdO1xuICAgICAgICB0aGlzLm9ic3RhY2xlUmVjdHMgPSBbXTtcblxuICAgICAgICB0aGlzLmN1cnJlbnRSZWN0cyA9IHRoaXMuYnJpY2tSZWN0cztcbiAgICAgICAgdGhpcy5zZWxlY3RDb2xvciA9IENvbG9yQ29uZmlnc1swXTtcbiAgICAgICAgdGhpcy5zZWxlY3RDb2xvckluZGV4ID0gMDtcblxuICAgICAgICB0aGlzLmdyaWROb2RlID0gbmV3IGNjLk5vZGUoKTtcbiAgICAgICAgdGhpcy5hZGRDaGlsZCh0aGlzLmdyaWROb2RlKTtcbiAgICAgICAgdGhpcy5ncmlkTm9kZS54ID0gdGhpcy54T2Zmc2V0O1xuICAgICAgICB0aGlzLmdyaWROb2RlLnkgPSB0aGlzLnlPZmZzZXQ7XG4gICAgICAgIHRoaXMuZ3JpZE5vZGUuc2NhbGUgPSBzY2FsZTtcblxuICAgICAgICB0aGlzLmluaXRHcmlkcygpO1xuICAgICAgICB0aGlzLmluaXRCdXR0b25zKCk7XG4gICAgICAgIHRoaXMuaW5pdENvbG9yQnV0dG9ucygpO1xuICAgICAgICB0aGlzLmluaXRFZGl0Qm94KCk7XG5cbiAgICAgICAgaWYgKGdhbWUuZ2FtZU1hbi5sZXZlbENmZykge1xuICAgICAgICAgICAgdGhpcy5sb2FkQ29uZmlnKGdhbWUuZ2FtZU1hbi5sZXZlbENmZy5vcmlnaW5hbENvbmZpZyk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgaW5pdEVkaXRCb3g6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHhPZmZzZXQgPSAyMDA7XG4gICAgICAgIHRoaXMuX2xldmVsRWRpdEJveCA9IHRoaXMuY3JlYXRlRWRpdEJveChcIlwiLCBcIklucHV0IExldmVsSWRcIiwgY2MucChjYy53aW5TaXplLndpZHRoICogMC41IC0geE9mZnNldCwgMTAwKSk7XG4gICAgICAgIHRoaXMuX2Jvb3N0RWRpdEJveCA9IHRoaXMuY3JlYXRlRWRpdEJveChcIjFcIiwgXCJJbnB1dCBCb29zdCBQcm9iYWJpbGl0eVwiLCBjYy5wKGNjLndpblNpemUud2lkdGggKiAwLjUsIDEwMCkpO1xuICAgICAgICB0aGlzLl9zdGFyM0VkaXRCb3ggPSB0aGlzLmNyZWF0ZUVkaXRCb3goXCI5MFwiLCBcIklucHV0IDNTdGFyIFRpbWVcIiwgY2MucChjYy53aW5TaXplLndpZHRoICogMC41ICsgeE9mZnNldCwgMTAwKSk7XG4gICAgfSxcblxuICAgIGNyZWF0ZUVkaXRCb3g6IGZ1bmN0aW9uIChjb250ZW50LCBwbGFjZUhvbGRlciwgcG9zaXRpb24pIHtcbiAgICAgICAgdmFyIGVkaXRCb3ggPSBuZXcgY2MuRWRpdEJveChjYy5zaXplKDI3MCwgMTAwKSwgbmV3IGNjLlNjYWxlOVNwcml0ZShcInJlcy9jb21tb24vYmxhbmsucG5nXCIpLFxuICAgICAgICAgICAgbmV3IGNjLlNjYWxlOVNwcml0ZShcInJlcy9jb21tb24vYmxhbmsucG5nXCIpKTtcbiAgICAgICAgZWRpdEJveC5zZXRTdHJpbmcoY29udGVudCk7XG4gICAgICAgIGVkaXRCb3guc2V0UG9zaXRpb24ocG9zaXRpb24pO1xuICAgICAgICBlZGl0Qm94LnNldEZvbnRDb2xvcihjYy5jb2xvcigyNTUsIDI1NSwgMjU1KSk7XG4gICAgICAgIC8vZWRpdEJveC5zZXRIaW50Q29cbiAgICAgICAgZWRpdEJveC5zZXRQbGFjZWhvbGRlckZvbnRDb2xvcihjYy5jb2xvcigyNTUsIDAsIDApKTtcbiAgICAgICAgZWRpdEJveC5zZXRQbGFjZUhvbGRlcihwbGFjZUhvbGRlcik7XG4gICAgICAgIGVkaXRCb3guc2V0RGVsZWdhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuYWRkQ2hpbGQoZWRpdEJveCk7XG4gICAgICAgIHJldHVybiBlZGl0Qm94O1xuICAgIH0sXG5cbiAgICBpbml0QnV0dG9uczogZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyBCdWdzIEl0ZW1cbiAgICAgICAgdmFyIGJyaWNrSXRlbSA9IG5ldyBjYy5NZW51SXRlbUZvbnQoXCJCcmlja1wiLCB0aGlzLm9uQnJpY2tUeXBlQ2hhbmdlLCB0aGlzKTtcbiAgICAgICAgLy8gdmFyIHNhdmVJdGVtID0gbmV3IGNjLk1lbnVJdGVtRm9udChcIlNhdmVcIiwgdGhpcy5vblNhdmUsIHRoaXMpO1xuICAgICAgICB2YXIgZGVsZXRlSXRlbSA9IG5ldyBjYy5NZW51SXRlbUZvbnQoXCJVbmRvXCIsIHRoaXMub25EZWxldGUsIHRoaXMpO1xuICAgICAgICAvL3ZhciByZWZyZXNoSXRlbSA9IG5ldyBjYy5NZW51SXRlbUZvbnQoXCJSZWZyZXNoXCIsIHRoaXMub25SZWZyZXNoLCB0aGlzKTtcbiAgICAgICAgdmFyIGFkZEl0ZW0gPSBuZXcgY2MuTWVudUl0ZW1Gb250KFwiQWRkXCIsIHRoaXMub25BZGQsIHRoaXMpO1xuICAgICAgICB2YXIgcmVkdWNlSXRlbSA9IG5ldyBjYy5NZW51SXRlbUZvbnQoXCJSZWR1Y2VcIiwgdGhpcy5vblJlZHVjZSwgdGhpcyk7XG4gICAgICAgIC8vIHZhciBsb2FkSXRlbSA9IG5ldyBjYy5NZW51SXRlbUZvbnQoXCJMb2FkXCIsIHRoaXMub25Mb2FkLCB0aGlzKTtcbiAgICAgICAgLy8gdmFyIHByZXZpZXdJdGVtID0gbmV3IGNjLk1lbnVJdGVtRm9udChcIlByZXZpZXdcIiwgdGhpcy5vblByZXZpZXcsIHRoaXMpO1xuICAgICAgICAvLyB2YXIgZHVwbGljYXRlSXRlbSA9IG5ldyBjYy5NZW51SXRlbUZvbnQoXCJEdXBsaWNhdGVcIiwgdGhpcy5vbkR1cGxpY2F0ZUNoZWNrLCB0aGlzKTtcbiAgICAgICAgLy8gdmFyIHJlYWNoSXRlbSA9IG5ldyBjYy5NZW51SXRlbUZvbnQoXCJSZWFjaFwiLCB0aGlzLm9uUmVhY2hUZXN0LCB0aGlzKTtcbiAgICAgICAgLy8gdmFyIG5leHRJdGVtID0gbmV3IGNjLk1lbnVJdGVtRm9udChcIk5leHRcIiwgdGhpcy5vbk5leHQsIHRoaXMpO1xuICAgICAgICB2YXIgdXBsb2FkSXRlbSA9IG5ldyBjYy5NZW51SXRlbUZvbnQoXCJVcGxvYWRcIiwgdGhpcy5vblVwbG9hZCwgdGhpcyk7XG4gICAgICAgIHZhciBtZW51ID0gbmV3IGNjLk1lbnUoYnJpY2tJdGVtLCBkZWxldGVJdGVtLCBhZGRJdGVtLCByZWR1Y2VJdGVtLCB1cGxvYWRJdGVtKTtcblxuXG4gICAgICAgIG1lbnUuYWxpZ25JdGVtc0hvcml6b250YWxseSgpO1xuICAgICAgICB0aGlzLmFkZENoaWxkKG1lbnUpO1xuICAgICAgICBtZW51LnNldFBvc2l0aW9uKGNjLnAoY2Mud2luU2l6ZS53aWR0aCAqIDAuNSwgY2Mud2luU2l6ZS5oZWlnaHQgLSAyMCkpO1xuICAgICAgICB0aGlzLl9icmlja0l0ZW0gPSBicmlja0l0ZW07XG5cbiAgICAgICAgdGhpcy5fZ3JpZExhYmVsID0gbmV3IGNjLkxhYmVsVFRGKFwiXCIsIFwiQXJpYWxcIiwgNDApO1xuICAgICAgICB0aGlzLmFkZENoaWxkKHRoaXMuX2dyaWRMYWJlbCk7XG5cbiAgICAgICAgdGhpcy5fZ3JpZExhYmVsLnNldEFuY2hvclBvaW50KGNjLnAoMCwgMC41KSk7XG5cbiAgICAgICAgdGhpcy5fZ3JpZExhYmVsLnNldFBvc2l0aW9uKGNjLnAoMTAwLCBjYy53aW5TaXplLmhlaWdodCAtIDgwKSk7XG5cbiAgICAgICAgdGhpcy5fZ3JpZExhYmVsLnNldFN0cmluZyh0aGlzLkNPTCArIFwieFwiICsgdGhpcy5ST1cpO1xuICAgIH0sXG5cbiAgICBpbml0Q29sb3JCdXR0b25zOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgdmFyIGl0ZW1zID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgQ29sb3JDb25maWdzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB2YXIgY29sb3JJdGVtID0gbmV3IGNjLk1lbnVJdGVtRm9udChcIiBPIFwiLCB0aGlzLm9uU2VsZWN0Q29sb3IsIHRoaXMpO1xuICAgICAgICAgICAgY29sb3JJdGVtLnNldENvbG9yKENvbG9yQ29uZmlnc1tpXSk7XG4gICAgICAgICAgICBjb2xvckl0ZW0uc2V0VGFnKGkpO1xuICAgICAgICAgICAgaXRlbXMucHVzaChjb2xvckl0ZW0pO1xuICAgICAgICB9XG4gICAgICAgIHZhciBtZW51ID0gbmV3IGNjLk1lbnUoaXRlbXMuc2xpY2UoMCwgaXRlbXMubGVuZ3RoIC8gMiArIDEpKTtcbiAgICAgICAgbWVudS5hbGlnbkl0ZW1zSG9yaXpvbnRhbGx5KCk7XG4gICAgICAgIG1lbnUuc2V0UG9zaXRpb24oY2MucChjYy53aW5TaXplLndpZHRoICogMC41LCBjYy53aW5TaXplLmhlaWdodCAtIDU1KSk7XG4gICAgICAgIHRoaXMuYWRkQ2hpbGQobWVudSk7XG5cbiAgICAgICAgdmFyIGJvdHRvbU1lbnUgPSBuZXcgY2MuTWVudShpdGVtcy5zbGljZShpdGVtcy5sZW5ndGggLyAyICsgMSkpO1xuICAgICAgICBib3R0b21NZW51LmFsaWduSXRlbXNIb3Jpem9udGFsbHkoKTtcbiAgICAgICAgYm90dG9tTWVudS5zZXRQb3NpdGlvbihjYy5wKGNjLndpblNpemUud2lkdGggKiAwLjUsIGNjLndpblNpemUuaGVpZ2h0IC0gOTApKTtcbiAgICAgICAgdGhpcy5hZGRDaGlsZChib3R0b21NZW51KTtcbiAgICB9LFxuXG4gICAgb25Mb2FkOiBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgICAgIHZhciBsZXZlbFN0cmluZyA9IHRoaXMuX2xldmVsRWRpdEJveC5nZXRTdHJpbmcoKTtcbiAgICAgICAgdmFyIGxldmVsSWQgPSBwYXJzZUludChsZXZlbFN0cmluZyk7XG4gICAgICAgIGlmIChpc05hTihsZXZlbElkKSkge1xuICAgICAgICAgICAgYWxlcnQoXCJsZXZlbCBpZCBub3QgZm91bmQ6XCIgKyBsZXZlbFN0cmluZyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgbGV2ZWxDb25maWcgPSBDb25maWdNYW4uZ2V0SW5zdGFuY2UoKS5nZXRPcmlnaW5hbExldmVsQ29uZmlnKGxldmVsSWQpO1xuICAgICAgICAgICAgaWYgKCFsZXZlbENvbmZpZykge1xuICAgICAgICAgICAgICAgIGFsZXJ0KFwibGV2ZWwgaWQgbm90IGZvdW5kOlwiICsgbGV2ZWxTdHJpbmcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvYWRDb25maWcobGV2ZWxDb25maWcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uUHJldmlldzogZnVuY3Rpb24gKHNlbmRlcikge1xuICAgICAgICB2YXIgb2JqID0gdGhpcy5nZW5lcmF0ZUxldmVsT2JqKCk7XG4gICAgICAgIHZhciBsZXZlbENvbmZpZyA9IG5ldyBMZXZlbENvbmZpZygpO1xuICAgICAgICBsZXZlbENvbmZpZy51bm1hcnNoYWwob2JqKTtcbiAgICAgICAgbGV2ZWxDb25maWcub3JpZ2luYWxDb25maWcgPSBvYmo7XG4gICAgICAgIGdhbWUuZ2FtZU1hbi5sZXZlbENmZyA9IGxldmVsQ29uZmlnO1xuICAgICAgICBnYW1lLmdhbWVNYW4uc3RhdHVzID0gdGhpcy5fc3RhdHVzO1xuICAgICAgICAvL3ZhciBzY2VuZSA9IG5ldyBHYW1lU2NlbmUoKTtcbiAgICAgICAgdmFyIEdhbWVTY2VuZSA9IHJlcXVpcmUoXCIuL0dhbWVTY2VuZVwiKTtcbiAgICAgICAgLy9jYy53aW5TaXplLndpZHRoID0gY2Mud2luU2l6ZS5oZWlnaHQgKiAwLjU7XG4gICAgICAgIGNjLmRpcmVjdG9yLnJ1blNjZW5lKG5ldyBHYW1lU2NlbmUoKSk7XG4gICAgfSxcblxuICAgIG9uRHVwbGljYXRlQ2hlY2s6IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICAgICAgdmFyIG9yaWdpbmFsTGV2ZWxMaXN0ID0gQ29uZmlnTWFuLmdldEluc3RhbmNlKCkub3JpZ2luYWxMZXZlbExpc3Q7XG4gICAgICAgIHZhciBmb3VuZER1cGxpY2F0ZSA9IGZhbHNlO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9yaWdpbmFsTGV2ZWxMaXN0Lmxlbmd0aCAtIDE7ICsraSkge1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IGkgKyAxOyBqIDwgb3JpZ2luYWxMZXZlbExpc3QubGVuZ3RoOyArK2opIHtcbiAgICAgICAgICAgICAgICB2YXIgbGV2ZWxDZmcxID0gb3JpZ2luYWxMZXZlbExpc3RbaV07XG4gICAgICAgICAgICAgICAgdmFyIGxldmVsQ2ZnMiA9IG9yaWdpbmFsTGV2ZWxMaXN0W2pdO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzRXF1YWxMZXZlbENmZ3MobGV2ZWxDZmcxLCBsZXZlbENmZzIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGFsZXJ0KFwiZm91bmQgZHVwbGljYXRlIGxldmVsOlwiICsgKGkgKyAxKSArIFwiIGFuZCBcIiArIChqICsgMSkpO1xuICAgICAgICAgICAgICAgICAgICBmb3VuZER1cGxpY2F0ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChmb3VuZER1cGxpY2F0ZSkge1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghZm91bmREdXBsaWNhdGUpIHtcbiAgICAgICAgICAgIGFsZXJ0KFwiYWxsIGlzIG9rXCIpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uUmVhY2hUZXN0OiBmdW5jdGlvbiAoc2VuZGVyKSB7XG4gICAgICAgIHZhciBsZXZlbExpc3QgPSBDb25maWdNYW4uZ2V0SW5zdGFuY2UoKS5sZXZlbExpc3Q7XG4gICAgICAgIC8vaWYgKHRoaXMuaXNMZXZlbFJlYWNoYWJsZShsZXZlbExpc3RbMjNdKSkge1xuICAgICAgICAvLyAgICBhbGVydChcImFsbCBpcyBva1wiKTtcbiAgICAgICAgLy99IGVsc2Uge1xuICAgICAgICAvLyAgICBhbGVydChcInVucmVhY2hhYmxlIGxldmVsXCIpO1xuICAgICAgICAvL31cbiAgICAgICAgdmFyIGZpbmRVblJlYWNoYWJsZSA9IGZhbHNlO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxldmVsTGlzdC5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzTGV2ZWxSZWFjaGFibGUobGV2ZWxMaXN0W2ldKSkge1xuICAgICAgICAgICAgICAgIGZpbmRVblJlYWNoYWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgYWxlcnQoXCJmaW5kIHVucmVhY2hhYmxlIGxldmVsOlwiICsgKGkgKyAxKSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFmaW5kVW5SZWFjaGFibGUpIHtcbiAgICAgICAgICAgIGFsZXJ0KFwiYWxsIGlzIG9rXCIpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uTmV4dDogZnVuY3Rpb24gKHNlbmRlcikge1xuICAgICAgICB2YXIgbGV2ZWxTdHJpbmcgPSB0aGlzLl9sZXZlbEVkaXRCb3guZ2V0U3RyaW5nKCk7XG4gICAgICAgIHZhciBsZXZlbElkID0gcGFyc2VJbnQobGV2ZWxTdHJpbmcpO1xuICAgICAgICBpZiAoaXNOYU4obGV2ZWxJZCkpIHtcbiAgICAgICAgICAgIGFsZXJ0KFwibGV2ZWwgaWQgbm90IGZvdW5kOlwiICsgbGV2ZWxTdHJpbmcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIGxldmVsQ29uZmlnID0gQ29uZmlnTWFuLmdldEluc3RhbmNlKCkuZ2V0T3JpZ2luYWxMZXZlbENvbmZpZyhsZXZlbElkICsgMSk7XG4gICAgICAgICAgICBpZiAoIWxldmVsQ29uZmlnKSB7XG4gICAgICAgICAgICAgICAgYWxlcnQoXCJsZXZlbCBpZCBub3QgZm91bmQ6XCIgKyBsZXZlbFN0cmluZyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX2xldmVsRWRpdEJveC5zZXRTdHJpbmcobGV2ZWxJZCArIDEpO1xuICAgICAgICAgICAgICAgIHRoaXMubG9hZENvbmZpZyhsZXZlbENvbmZpZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgaXNMZXZlbFJlYWNoYWJsZTogZnVuY3Rpb24gKGxldmVsQ2ZnKSB7XG4gICAgICAgIHZhciBncmlkcyA9IFtdO1xuICAgICAgICB2YXIgaSwgaiwgYnJpY2tDZmcsIHgsIHk7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZXZlbENmZy53aWR0aDsgKytpKSB7XG4gICAgICAgICAgICBncmlkc1tpXSA9IFtdO1xuICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IGxldmVsQ2ZnLmhlaWdodDsgKytqKSB7XG4gICAgICAgICAgICAgICAgZ3JpZHNbaV1bal0gPSB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IEdyaWRUeXBlLk5vbmUsXG4gICAgICAgICAgICAgICAgICAgIGZpbmQ6IGZhbHNlXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGV2ZWxDZmcuYnJpY2tzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBicmlja0NmZyA9IGxldmVsQ2ZnLmJyaWNrc1tpXTtcbiAgICAgICAgICAgIGZvciAoeCA9IDA7IHggPCBicmlja0NmZy53aWR0aDsgKyt4KSB7XG4gICAgICAgICAgICAgICAgZm9yICh5ID0gMDsgeSA8IGJyaWNrQ2ZnLmhlaWdodDsgKyt5KSB7XG4gICAgICAgICAgICAgICAgICAgIGdyaWRzW2JyaWNrQ2ZnLnggKyB4XVticmlja0NmZy55ICsgeV0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBHcmlkVHlwZS5HcmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmluZDogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxldmVsQ2ZnLm9ic3RhY2xlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgYnJpY2tDZmcgPSBsZXZlbENmZy5vYnN0YWNsZXNbaV07XG4gICAgICAgICAgICBmb3IgKHggPSAwOyB4IDwgYnJpY2tDZmcud2lkdGg7ICsreCkge1xuICAgICAgICAgICAgICAgIGZvciAoeSA9IDA7IHkgPCBicmlja0NmZy5oZWlnaHQ7ICsreSkge1xuICAgICAgICAgICAgICAgICAgICBncmlkc1ticmlja0NmZy54ICsgeF1bYnJpY2tDZmcueSArIHldID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogR3JpZFR5cGUuV2FsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbmQ6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGZpbmRGaXJzdEdyaWRQb3NzID0gdGhpcy5maW5kRmlyc3RHcmlkcyhsZXZlbENmZywgZ3JpZHMpO1xuICAgICAgICBpZiAoZmluZEZpcnN0R3JpZFBvc3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZm9yICh4ID0gMDsgeCA8IGZpbmRGaXJzdEdyaWRQb3NzLmxlbmd0aDsgKyt4KSB7XG4gICAgICAgICAgICB2YXIgZmlyc3RHcmlkUG9zID0gZmluZEZpcnN0R3JpZFBvc3NbeF07XG4gICAgICAgICAgICB0aGlzLnNlYXJjaEdyaWQoZ3JpZHMsIGxldmVsQ2ZnLCBmaXJzdEdyaWRQb3MueCwgZmlyc3RHcmlkUG9zLnkpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBmaW5kR3JpZCA9IGZhbHNlO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZ3JpZHMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBncmlkc1tpXS5sZW5ndGg7ICsraikge1xuICAgICAgICAgICAgICAgIGlmIChncmlkc1tpXVtqXS50eXBlID09PSBHcmlkVHlwZS5HcmlkKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbmRHcmlkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGZpbmRHcmlkKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZpbmRHcmlkKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIGZpbmRGaXJzdEdyaWRzOiBmdW5jdGlvbiAobGV2ZWxDZmcsIGdyaWRzKSB7XG4gICAgICAgIHZhciBpO1xuICAgICAgICB2YXIgcmVzdWx0cyA9IFtdO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGV2ZWxDZmcud2lkdGg7ICsraSkge1xuICAgICAgICAgICAgaWYgKGdyaWRzW2ldWzBdLnR5cGUgIT09IEdyaWRUeXBlLldhbGwpIHtcbiAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2goY2MucChpLCAwKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfSxcblxuICAgIHNlYXJjaEdyaWQ6IGZ1bmN0aW9uIChncmlkcywgbGV2ZWxDZmcsIHgsIHkpIHtcbiAgICAgICAgaWYgKHggPj0gMCAmJiB4IDwgbGV2ZWxDZmcud2lkdGggJiYgeSA+PSAwICYmIHkgPCBsZXZlbENmZy5oZWlnaHQpIHtcbiAgICAgICAgICAgIHZhciBncmlkID0gZ3JpZHNbeF1beV07XG4gICAgICAgICAgICBpZiAoZ3JpZC50eXBlID09PSBHcmlkVHlwZS5XYWxsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyaWQuZmluZCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGdyaWQuZmluZCA9IHRydWU7XG4gICAgICAgICAgICBpZiAoZ3JpZC50eXBlID09PSBHcmlkVHlwZS5HcmlkKSB7XG4gICAgICAgICAgICAgICAgZ3JpZC50eXBlID0gR3JpZFR5cGUuTm9uZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc2VhcmNoR3JpZChncmlkcywgbGV2ZWxDZmcsIHggLSAxLCB5KTtcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoR3JpZChncmlkcywgbGV2ZWxDZmcsIHggKyAxLCB5KTtcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoR3JpZChncmlkcywgbGV2ZWxDZmcsIHgsIHkgKyAxKTtcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoR3JpZChncmlkcywgbGV2ZWxDZmcsIHgsIHkgLSAxKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBpc0VxdWFsTGV2ZWxDZmdzOiBmdW5jdGlvbiAobGV2ZWxDZmcxLCBsZXZlbENmZzIpIHtcbiAgICAgICAgaWYgKEpTT04uc3RyaW5naWZ5KGxldmVsQ2ZnMS5icmlja3MpID09PSBKU09OLnN0cmluZ2lmeShsZXZlbENmZzIuYnJpY2tzKSAmJlxuICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkobGV2ZWxDZmcxLm9ic3RhY2xlcykgPT09IEpTT04uc3RyaW5naWZ5KGxldmVsQ2ZnMi5vYnN0YWNsZXMpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIGdlbmVyYXRlTGV2ZWxPYmo6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGJvb3N0UHJvYmFiaWxpdHkgPSBOdW1iZXIodGhpcy5fYm9vc3RFZGl0Qm94LmdldFN0cmluZygpKTtcbiAgICAgICAgaWYgKGlzTmFOKGJvb3N0UHJvYmFiaWxpdHkpKSB7XG4gICAgICAgICAgICBib29zdFByb2JhYmlsaXR5ID0gMTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBzdGFyVGltZSA9IE51bWJlcih0aGlzLl9zdGFyM0VkaXRCb3guZ2V0U3RyaW5nKCkpO1xuICAgICAgICBpZiAoaXNOYU4oc3RhclRpbWUpKSB7XG4gICAgICAgICAgICBzdGFyVGltZSA9IDkwO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGlkID0gcGFyc2VJbnQodGhpcy5fbGV2ZWxFZGl0Qm94LmdldFN0cmluZygpKTtcbiAgICAgICAgaWYgKGlzTmFOKGlkKSkge1xuICAgICAgICAgICAgaWQgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgb2JqID0ge1xuICAgICAgICAgICAgaWQ6IGlkLFxuICAgICAgICAgICAgYjogYm9vc3RQcm9iYWJpbGl0eSxcbiAgICAgICAgICAgIHN0YXJUaW1lOiBzdGFyVGltZSxcbiAgICAgICAgICAgIHBpeGVsV2lkdGg6IHRoaXMuQ09OVEVOVF9XSURUSCxcbiAgICAgICAgICAgIHBpeGVsSGVpZ2h0OiB0aGlzLkNPTlRFTlRfSEVJR0hULFxuICAgICAgICAgICAgd2lkdGg6IHRoaXMuQ09MLFxuICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLlJPVyxcbiAgICAgICAgICAgIGJyaWNrczogdGhpcy5icmlja1JlY3RzLFxuICAgICAgICAgICAgb2JzdGFjbGVzOiB0aGlzLm9ic3RhY2xlUmVjdHNcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIG9iajtcbiAgICB9LFxuXG4gICAgbG9hZENvbmZpZzogZnVuY3Rpb24gKGNvbmZpZykge1xuICAgICAgICB0aGlzLnJlc2V0T2xkVmlldygpO1xuXG4gICAgICAgIHRoaXMuQ09OVEVOVF9XSURUSCA9IGNvbmZpZy5waXhlbFdpZHRoO1xuICAgICAgICB0aGlzLkNPTlRFTlRfSEVJR0hUID0gY29uZmlnLnBpeGVsSGVpZ2h0O1xuICAgICAgICB0aGlzLkNPTCA9IGNvbmZpZy53aWR0aDtcbiAgICAgICAgdGhpcy5ST1cgPSBjb25maWcuaGVpZ2h0O1xuICAgICAgICB0aGlzLmJyaWNrUmVjdHMgPSBjb25maWcuYnJpY2tzO1xuICAgICAgICB0aGlzLm9ic3RhY2xlUmVjdHMgPSBjb25maWcub2JzdGFjbGVzO1xuXG4gICAgICAgIC8vdGhpcy51cGRhdGVWaWV3KCk7XG4gICAgICAgIHZhciB3aWR0aCA9IHRoaXMuQ09OVEVOVF9XSURUSCAvIHRoaXMuQ09MO1xuICAgICAgICB2YXIgaGVpZ2h0ID0gdGhpcy5DT05URU5UX0hFSUdIVCAvIHRoaXMuUk9XO1xuICAgICAgICB0aGlzLkdSSURfV0lEVEggPSB3aWR0aCAqIDAuNzU7XG4gICAgICAgIHRoaXMuR1JJRF9IRUlHSFQgPSBoZWlnaHQgKiAwLjc1O1xuICAgICAgICB0aGlzLkdBUF9XSURUSCA9IHdpZHRoIC0gdGhpcy5HUklEX1dJRFRIO1xuICAgICAgICB0aGlzLkdBUF9IRUlHSFQgPSBoZWlnaHQgLSB0aGlzLkdSSURfSEVJR0hUO1xuXG4gICAgICAgIHRoaXMuaW5pdEdyaWRzKCk7XG5cbiAgICAgICAgLy90aGlzLmJyaWNrUmVjdHMgPSBbXTtcbiAgICAgICAgLy90aGlzLm9ic3RhY2xlUmVjdHMgPSBbXTtcbiAgICAgICAgLy90aGlzLmN1cnJlbnRSZWN0cyA9IHRoaXMuYnJpY2tSZWN0cztcbiAgICAgICAgLy90aGlzLl9pc0JyaWNrID0gdHJ1ZTtcbiAgICAgICAgLy90aGlzLl9zdGF0dXMgPSBcImJyaWNrXCI7XG4gICAgICAgIC8vdGhpcy5fYnJpY2tJdGVtLnNldFN0cmluZyhcIkJyaWNrXCIpO1xuICAgICAgICBpZiAoZ2FtZS5nYW1lTWFuLnN0YXR1cykge1xuICAgICAgICAgICAgdGhpcy5fc3RhdHVzID0gZ2FtZS5nYW1lTWFuLnN0YXR1cztcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnVwZGF0ZUJyaWNrVHlwZSgpO1xuICAgICAgICB0aGlzLl9ncmlkTGFiZWwuc2V0U3RyaW5nKHRoaXMuQ09MICsgXCJ4XCIgKyB0aGlzLlJPVyk7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmJyaWNrUmVjdHMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciBicmlja1JlY3QgPSB0aGlzLmJyaWNrUmVjdHNbaV07XG4gICAgICAgICAgICB0aGlzLm1hcmtPY2N1cGllZFdpdGhSZWN0KGJyaWNrUmVjdCwgQ29sb3JDb25maWdzW2JyaWNrUmVjdFs0XSAtIDFdKTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMub2JzdGFjbGVSZWN0cy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdmFyIGJyaWNrUmVjdCA9IHRoaXMub2JzdGFjbGVSZWN0c1tpXTtcbiAgICAgICAgICAgIHRoaXMubWFya09jY3VwaWVkV2l0aFJlY3QoYnJpY2tSZWN0LCAgY2MuY29sb3IuV0hJVEUpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2xldmVsRWRpdEJveC5zZXRTdHJpbmcoY29uZmlnLmlkKTtcbiAgICAgICAgdGhpcy5fYm9vc3RFZGl0Qm94LnNldFN0cmluZyhjb25maWcuYik7XG4gICAgICAgIHRoaXMuX3N0YXIzRWRpdEJveC5zZXRTdHJpbmcoY29uZmlnLnN0YXJUaW1lKTtcbiAgICAgICAgLy90aGlzLmN1cnJlbnRSZWN0cyA9XG4gICAgfSxcblxuICAgIG9uU2VsZWN0Q29sb3I6IGZ1bmN0aW9uIChzZW5kZXIpIHtcbiAgICAgICAgdGhpcy5zZWxlY3RDb2xvciA9IENvbG9yQ29uZmlnc1tzZW5kZXIuZ2V0VGFnKCldO1xuICAgICAgICB0aGlzLnNlbGVjdENvbG9ySW5kZXggPSBzZW5kZXIuZ2V0VGFnKCk7XG4gICAgfSxcblxuICAgIHJlc2V0T2xkVmlldzogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmZvckVhY2hHcmlkcyhmdW5jdGlvbiAoZ3JpZCkge1xuICAgICAgICAgICAgZ3JpZC5yZW1vdmVGcm9tUGFyZW50KCk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmdyaWRzID0gW107XG4gICAgfSxcblxuICAgIHVwZGF0ZVZpZXc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHdpZHRoID0gdGhpcy5DT05URU5UX1dJRFRIIC8gdGhpcy5DT0w7XG4gICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLkNPTlRFTlRfSEVJR0hUIC8gdGhpcy5ST1c7XG4gICAgICAgIHRoaXMuR1JJRF9XSURUSCA9IHdpZHRoICogMC43NTtcbiAgICAgICAgdGhpcy5HUklEX0hFSUdIVCA9IGhlaWdodCAqIDAuNzU7XG4gICAgICAgIHRoaXMuR0FQX1dJRFRIID0gd2lkdGggLSB0aGlzLkdSSURfV0lEVEg7XG4gICAgICAgIHRoaXMuR0FQX0hFSUdIVCA9IGhlaWdodCAtIHRoaXMuR1JJRF9IRUlHSFQ7XG5cbiAgICAgICAgdGhpcy5pbml0R3JpZHMoKTtcblxuICAgICAgICB0aGlzLmJyaWNrUmVjdHMgPSBbXTtcbiAgICAgICAgdGhpcy5vYnN0YWNsZVJlY3RzID0gW107XG4gICAgICAgIHRoaXMuY3VycmVudFJlY3RzID0gdGhpcy5icmlja1JlY3RzO1xuICAgICAgICAvL3RoaXMuX2lzQnJpY2sgPSB0cnVlO1xuICAgICAgICB0aGlzLl9zdGF0dXMgPSBcImJyaWNrXCI7XG4gICAgICAgIHRoaXMuX2JyaWNrSXRlbS5zZXRTdHJpbmcoXCJCcmlja1wiKTtcblxuICAgICAgICB0aGlzLl9ncmlkTGFiZWwuc2V0U3RyaW5nKHRoaXMuQ09MICsgXCJ4XCIgKyB0aGlzLlJPVyk7XG4gICAgfSxcblxuICAgIG9uQWRkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucmVzZXRPbGRWaWV3KCk7XG4gICAgICAgIHRoaXMuQ09MICs9IDQ7XG4gICAgICAgIHRoaXMuUk9XICs9IDQ7XG4gICAgICAgIHRoaXMudXBkYXRlVmlldygpO1xuICAgIH0sXG5cbiAgICBvblJlZHVjZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnJlc2V0T2xkVmlldygpO1xuICAgICAgICB0aGlzLkNPTCAtPSA0O1xuICAgICAgICB0aGlzLlJPVyAtPSA0O1xuICAgICAgICB0aGlzLnVwZGF0ZVZpZXcoKTtcbiAgICB9LFxuXG4gICAgb25VcGxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGRpY3QgPSB7XCJDb250ZW50LXR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJ9O1xuICAgICAgICB2YXIgb2JqID0gdGhpcy5nZW5lcmF0ZUxldmVsT2JqKCk7XG4gICAgICAgIHZhciBjb250ZW50ID0ge1wiY29udGVudFwiOiBKU09OLnN0cmluZ2lmeShvYmopfTtcbiAgICAgICAgSHR0cENsaWVudC5kb1Bvc3QoXCJodHRwOi8vc2VydmVyLm1pbmlnYW1lLmlvOjcwMDAvdG9vbHMvdXBsb2FkX2xldmVsXCIsIEpTT04uc3RyaW5naWZ5KGNvbnRlbnQpLCBkaWN0LCBmdW5jdGlvbiAoZXJyb3IsIHRleHQpIHtcbiAgICAgICAgICAgIGlmICghZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBhbGVydChcInVwbG9hZCBzdWNjZXNzOlwiICsgdGV4dCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGFsZXJ0KFwidXBsb2FkIGZhaWxlZDpcIiArIHRleHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgb25TYXZlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBvYmogPSB0aGlzLmdlbmVyYXRlTGV2ZWxPYmooKTtcblxuICAgICAgICBjYy5sb2coXCJyZXN1bHRzOlwiICsgSlNPTi5zdHJpbmdpZnkob2JqKSk7XG5cbiAgICAgICAgRWRpdG9ySGVscGVyLnNhdmVMZXZlbENvbmZpZyhvYmopO1xuICAgIH0sXG5cbiAgICBvbkRlbGV0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fc3RhdHVzICE9PSBcImRlbGV0ZVwiKSB7XG4gICAgICAgICAgICB0aGlzLmRlbGV0ZUxhdGVzdFJlY3QoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvblJlZnJlc2g6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5yZXNldCgpO1xuICAgIH0sXG5cbiAgICBvbkJyaWNrVHlwZUNoYW5nZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9zdGF0dXMgPSBTdGF0dXNMaXN0WyhTdGF0dXNMaXN0LmluZGV4T2YodGhpcy5fc3RhdHVzKSArIDEpICUgU3RhdHVzTGlzdC5sZW5ndGhdO1xuICAgICAgICAvL3RoaXMuX2lzQnJpY2sgPSAhdGhpcy5faXNCcmljaztcbiAgICAgICAgdGhpcy51cGRhdGVCcmlja1R5cGUoKTtcbiAgICB9LFxuXG4gICAgdXBkYXRlQnJpY2tUeXBlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX2JyaWNrSXRlbS5zZXRTdHJpbmcodGhpcy5fc3RhdHVzKTtcbiAgICAgICAgaWYgKHRoaXMuX3N0YXR1cyA9PT0gXCJvYnN0YWNsZVwiKSB7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRSZWN0cyA9IHRoaXMub2JzdGFjbGVSZWN0cztcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9zdGF0dXMgPT09IFwiYnJpY2tcIikge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50UmVjdHMgPSB0aGlzLmJyaWNrUmVjdHM7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRSZWN0cyA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgaW5pdEdyaWRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuZ3JpZHMgPSBbXTtcbiAgICAgICAgdmFyIEdyaWQgPSByZXF1aXJlKFwiLi4vZW50aXR5L0dyaWRcIik7XG4gICAgICAgIGZvciAodmFyIGxvY2FsQ29sID0gMDsgbG9jYWxDb2wgPCB0aGlzLkNPTDsgKytsb2NhbENvbCkge1xuICAgICAgICAgICAgdGhpcy5ncmlkcy5wdXNoKFtdKTtcbiAgICAgICAgICAgIGZvciAodmFyIGxvY2FsUm93ID0gMDsgbG9jYWxSb3cgPCB0aGlzLlJPVzsgKytsb2NhbFJvdykge1xuICAgICAgICAgICAgICAgIHZhciBncmlkID0gbmV3IEdyaWQoTGlnaHRHcmF5Q29sb3IsIHRoaXMuR1JJRF9XSURUSCwgdGhpcy5HUklEX0hFSUdIVCwgbG9jYWxDb2wsIGxvY2FsUm93KTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyaWROb2RlLmFkZENoaWxkKGdyaWQpO1xuICAgICAgICAgICAgICAgIGdyaWQuc2V0UG9zaXRpb24odGhpcy5nZXRHcmlkUG9zKGxvY2FsQ29sLCBsb2NhbFJvdykpO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JpZHNbbG9jYWxDb2xdLnB1c2goZ3JpZCk7XG4gICAgICAgICAgICAgICAgdGhpcy5tYXJrR3JheUhpbnQoZ3JpZCwgbG9jYWxDb2wsIGxvY2FsUm93KTtcbiAgICAgICAgICAgICAgICBncmlkLl9jb2xvciA9IGdyaWQuY29sb3I7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgbWFya0dyYXlIaW50OiBmdW5jdGlvbiAoZ3JpZCwgbG9jYWxDb2wsIGxvY2FsUm93KSB7XG4gICAgICAgIHZhciBncmF5Q29sb3IgPSBHcmF5Q29sb3I7XG4gICAgICAgIHZhciBpc0xlZnQgPSAodGhpcy5DT0wgLyBsb2NhbENvbCkgPiAyO1xuICAgICAgICB2YXIgaXNCb3R0b20gPSAodGhpcy5ST1cgLyBsb2NhbFJvdykgPiAyO1xuICAgICAgICBpZiAobG9jYWxDb2wgPT09IE1hdGguZmxvb3IodGhpcy5DT0wgLyAyKSB8fFxuICAgICAgICAgICAgbG9jYWxDb2wgPT09IE1hdGguZmxvb3IodGhpcy5DT0wgLyAyKSAtIDEgfHxcbiAgICAgICAgICAgIGxvY2FsUm93ID09PSBNYXRoLmZsb29yKHRoaXMuUk9XIC8gMikgfHxcbiAgICAgICAgICAgIGxvY2FsUm93ID09PSBNYXRoLmZsb29yKHRoaXMuUk9XIC8gMikgLSAxXG4gICAgICAgICkge1xuICAgICAgICAgICAgZ3JpZC5zZXRDb2xvcihncmF5Q29sb3IpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGlpaSA9IGlzTGVmdCA/IDQgOiAwO1xuXG4gICAgICAgIGlmIChsb2NhbENvbCAlIDUgPT09IGlpaSkge1xuICAgICAgICAgICAgZ3JpZC5zZXRDb2xvcihncmF5Q29sb3IpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGpqaiA9IGlzQm90dG9tID8gNCA6IDA7XG5cbiAgICAgICAgaWYgKGxvY2FsUm93ICUgNSA9PT0gampqKSB7XG4gICAgICAgICAgICBncmlkLnNldENvbG9yKGdyYXlDb2xvcik7XG4gICAgICAgIH1cblxuICAgICAgICAvL2lpaSA9IGlzTGVmdCA/IDkgOiAwO1xuICAgICAgICAvL2pqaiA9IGlzQm90dG9tID8gOSA6IDA7XG4gICAgICAgIC8vXG4gICAgICAgIC8vaWYgKGxvY2FsQ29sICUgMTAgPT09IGlpaSAmJiBsb2NhbFJvdyAlIDEwID09PSBqamopIHtcbiAgICAgICAgLy8gICAgZ3JpZC5zZXRDb2xvcihjYy5jb2xvci5ZRUxMT1cpO1xuICAgICAgICAvL31cbiAgICB9LFxuXG4gICAgcmVzZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZm9yICh2YXIgbG9jYWxDb2wgPSAwOyBsb2NhbENvbCA8IHRoaXMuQ09MOyArK2xvY2FsQ29sKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBsb2NhbFJvdyA9IDA7IGxvY2FsUm93IDwgdGhpcy5ST1c7ICsrbG9jYWxSb3cpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyaWRzW2xvY2FsQ29sXVtsb2NhbFJvd10uZWRpdGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JpZHNbbG9jYWxDb2xdW2xvY2FsUm93XS5zZXRDb2xvcihMaWdodEdyYXlDb2xvcik7XG4gICAgICAgICAgICAgICAgdGhpcy5ncmlkc1tsb2NhbENvbF1bbG9jYWxSb3ddLnVzZWQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIHRoaXMubWFya0dyYXlIaW50KHRoaXMuZ3JpZHNbbG9jYWxDb2xdW2xvY2FsUm93XSwgbG9jYWxDb2wsIGxvY2FsUm93KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmJyaWNrUmVjdHMgPSBbXTtcbiAgICAgICAgdGhpcy5vYnN0YWNsZVJlY3RzID0gW107XG4gICAgICAgIHRoaXMuY3VycmVudFJlY3RzID0gdGhpcy5icmlja1JlY3RzO1xuICAgICAgICAvL3RoaXMuX2lzQnJpY2sgPSB0cnVlO1xuICAgICAgICB0aGlzLl9zdGF0dXMgPSBcImJyaWNrXCI7XG4gICAgICAgIHRoaXMuX2JyaWNrSXRlbS5zZXRTdHJpbmcoXCJCcmlja1wiKTtcbiAgICB9LFxuXG4gICAgb25FbnRlcjpmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICAgIGNjLmV2ZW50TWFuYWdlci5hZGRMaXN0ZW5lcih7XG4gICAgICAgICAgICBldmVudDogY2MuRXZlbnRMaXN0ZW5lci5UT1VDSF9PTkVfQllfT05FLFxuICAgICAgICAgICAgc3dhbGxvd1RvdWNoZXM6IHRydWUsXG4gICAgICAgICAgICBvblRvdWNoQmVnYW46IHRoaXMub25Ub3VjaEJlZ2FuLmJpbmQodGhpcyksXG4gICAgICAgICAgICBvblRvdWNoTW92ZWQ6IHRoaXMub25Ub3VjaE1vdmVkLmJpbmQodGhpcyksXG4gICAgICAgICAgICBvblRvdWNoRW5kZWQ6IHRoaXMub25Ub3VjaEVuZGVkLmJpbmQodGhpcyksXG4gICAgICAgICAgICBvblRvdWNoQ2FuY2VsbGVkOiB0aGlzLm9uVG91Y2hDYW5jZWxsZWQuYmluZCh0aGlzKVxuICAgICAgICB9LCB0aGlzLmdyaWROb2RlKTtcblxuICAgICAgICAvL2NjLmV2ZW50TWFuYWdlci5hZGRMaXN0ZW5lcih7XG4gICAgICAgIC8vICAgIGV2ZW50OiBjYy5FdmVudExpc3RlbmVyLktFWUJPQVJELFxuICAgICAgICAvLyAgICBvbktleVJlbGVhc2VkOiBmdW5jdGlvbiAoa2V5Q29kZSwgZXZlbnQpIHtcbiAgICAgICAgLy8gICAgICAgIGlmIChrZXlDb2RlID09PSBjYy5LRVkuYmFja3NwYWNlKSB7XG4gICAgICAgIC8vICAgICAgICAgICAgLy9jYy5kaXJlY3Rvci5lbmQoKTtcbiAgICAgICAgLy8gICAgICAgICAgICB0aGlzLmRlbGV0ZUxhdGVzdFJlY3QoKTtcbiAgICAgICAgLy8gICAgICAgIH1cbiAgICAgICAgLy8gICAgfS5iaW5kKHRoaXMpXG4gICAgICAgIC8vfSwgdGhpcyk7XG4gICAgfSxcblxuICAgIG9uRXhpdDogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgIH0sXG5cbiAgICBnZXRHcmlkUG9zOiBmdW5jdGlvbiAobG9jYWxDb2wsIGxvY2FsUm93KSB7XG4gICAgICAgIHZhciBncmlkU2l6ZSA9IHRoaXMuZ2V0R3JpZFNpemUoKTtcbiAgICAgICAgcmV0dXJuIGNjLnAoKGdyaWRTaXplLndpZHRoICsgdGhpcy5HQVBfV0lEVEgpICogKGxvY2FsQ29sICsgMC41KSxcbiAgICAgICAgICAgIChncmlkU2l6ZS5oZWlnaHQgKyB0aGlzLkdBUF9IRUlHSFQpICogKGxvY2FsUm93ICsgMC41KSk7XG4gICAgfSxcblxuICAgIGdldEdyaWRTaXplOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBjYy5zaXplKHRoaXMuR1JJRF9XSURUSCwgdGhpcy5HUklEX0hFSUdIVCk7XG4gICAgfSxcblxuICAgIGdldEZ1bGxHcmlkU2l6ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gY2Muc2l6ZSh0aGlzLkdSSURfV0lEVEggKyB0aGlzLkdBUF9XSURUSCwgdGhpcy5HUklEX0hFSUdIVCArIHRoaXMuR0FQX0hFSUdIVCk7XG4gICAgfSxcblxuICAgIG9uVG91Y2hCZWdhbjpmdW5jdGlvbih0b3VjaCwgZXZlbnQpIHtcbiAgICAgICAgdmFyIGdyaWQgPSB0aGlzLmdldENsb3Nlc3RHcmlkKHRvdWNoKTtcbiAgICAgICAgaWYgKCFncmlkKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuX3N0YXR1cyA9PT0gXCJkZWxldGVcIikge1xuICAgICAgICAgICAgdGhpcy5maXJzdEdyaWQgPSBncmlkO1xuICAgICAgICAgICAgLy8gZ3JpZC5zZXRDb2xvcihncmlkLl9jb2xvcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoZ3JpZC51c2VkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5maXJzdEdyaWQgPSBncmlkO1xuICAgICAgICAgICAgZ3JpZC5zZXRDb2xvcih0aGlzLmdldEN1cnJlbnRDb2xvcigpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgb25Ub3VjaE1vdmVkOmZ1bmN0aW9uKHRvdWNoLCBldmVudCkge1xuICAgICAgICBpZiAodGhpcy5fc3RhdHVzID09PSBcImRlbGV0ZVwiKSB7XG4gICAgICAgICAgICB0aGlzLnRvdWNoRGVsZXRlKHRvdWNoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudG91Y2hEcmF3KHRvdWNoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgb25Ub3VjaEVuZGVkOmZ1bmN0aW9uKHRvdWNoLCBldmVudCkge1xuICAgICAgICBpZiAodGhpcy5fc3RhdHVzID09PSBcImRlbGV0ZVwiKSB7XG4gICAgICAgICAgICB0aGlzLnRvdWNoRGVsZXRlKHRvdWNoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudG91Y2hEcmF3KHRvdWNoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmZpcnN0R3JpZCAmJiB0aGlzLmxhc3RHcmlkKSB7XG4gICAgICAgICAgICB2YXIgcmVnaW9uID0gdGhpcy5nZXRSZWdpb24odGhpcy5maXJzdEdyaWQsIHRoaXMubGFzdEdyaWQpO1xuICAgICAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5zZWxlY3RDb2xvckluZGV4ICsgMTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9zdGF0dXMgIT09IFwiYnJpY2tcIikge1xuICAgICAgICAgICAgICAgIGluZGV4ID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciByZWN0ID0gW3JlZ2lvbi5taW5Db2wsIHJlZ2lvbi5taW5Sb3csXG4gICAgICAgICAgICAgICAgcmVnaW9uLm1heENvbCAtIHJlZ2lvbi5taW5Db2wgKyAxLCByZWdpb24ubWF4Um93IC0gcmVnaW9uLm1pblJvdyArIDEsIGluZGV4XTtcbiAgICAgICAgICAgIHZhciBjY1JlY3QgPSBjYy5yZWN0KHJlY3RbMF0sIHJlY3RbMV0sIHJlY3RbMl0sIHJlY3RbM10pO1xuICAgICAgICAgICAgaWYgKHRoaXMuX3N0YXR1cyA9PT0gXCJkZWxldGVcIikge1xuICAgICAgICAgICAgICAgIHRoaXMuZGVsZXRlUmVjdEZyb21SZWN0cyhjY1JlY3QsIHRoaXMuYnJpY2tSZWN0cyk7XG4gICAgICAgICAgICAgICAgdGhpcy5kZWxldGVSZWN0RnJvbVJlY3RzKGNjUmVjdCwgdGhpcy5vYnN0YWNsZVJlY3RzKTtcbiAgICAgICAgICAgICAgICB0aGlzLmZvckVhY2hHcmlkcyhmdW5jdGlvbiAoZ3JpZCkge1xuICAgICAgICAgICAgICAgICAgICBncmlkLmRlbGV0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50UmVjdHMucHVzaChyZWN0KTtcbiAgICAgICAgICAgICAgICB0aGlzLm1hcmtPY2N1cGllZFdpdGhSZWN0KHJlY3QsIG51bGwpO1xuICAgICAgICAgICAgICAgIHRoaXMuZm9yRWFjaEdyaWRzKGZ1bmN0aW9uIChncmlkKSB7XG4gICAgICAgICAgICAgICAgICAgIGdyaWQuZWRpdGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5maXJzdEdyaWQgPSBudWxsO1xuICAgICAgICB0aGlzLmxhc3RHcmlkID0gbnVsbDtcbiAgICB9LFxuXG4gICAgZGVsZXRlUmVjdEZyb21SZWN0czogZnVuY3Rpb24gKGNjUmVjdCwgcmVjdHMpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IHJlY3RzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7XG4gICAgICAgICAgICB2YXIgYnJpY2tSZWN0ID0gcmVjdHNbaV07XG4gICAgICAgICAgICB2YXIgY2NCcmlja1JlY3QgPSBjYy5yZWN0KGJyaWNrUmVjdFswXSwgYnJpY2tSZWN0WzFdLCBicmlja1JlY3RbMl0sIGJyaWNrUmVjdFszXSk7XG4gICAgICAgICAgICB2YXIgb3ZlcmxhcHNSZWN0ID0gY2MucmVjdEludGVyc2VjdGlvbihjY1JlY3QsIGNjQnJpY2tSZWN0KTtcbiAgICAgICAgICAgIGlmIChvdmVybGFwc1JlY3Qud2lkdGggPD0gMCB8fCBvdmVybGFwc1JlY3QuaGVpZ2h0IDw9IDApIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciByZXN1bHRSZWN0cyA9IHRoaXMuZ2V0T3ZlcmxhcHNSZWN0cyhvdmVybGFwc1JlY3QsIGNjQnJpY2tSZWN0KTtcbiAgICAgICAgICAgIHJlY3RzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgcmVzdWx0UmVjdHMubGVuZ3RoOyArK2opIHtcbiAgICAgICAgICAgICAgICByZWN0cy5wdXNoKHRoaXMuY29udmVydFRvSnNvbkxpc3QocmVzdWx0UmVjdHNbal0sIGJyaWNrUmVjdFs0XSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGNvbnZlcnRUb0pzb25MaXN0OiBmdW5jdGlvbiAocmVjdCwgY29sb3IpIHtcbiAgICAgICAgcmV0dXJuIFtyZWN0LngsIHJlY3QueSwgcmVjdC53aWR0aCwgcmVjdC5oZWlnaHQsIGNvbG9yXTtcbiAgICB9LFxuXG4gICAgZ2V0T3ZlcmxhcHNSZWN0czogZnVuY3Rpb24gKG92ZXJsYXBzUmVjdCwgYnJpY2tSZWN0KSB7XG4gICAgICAgIHZhciByZXN1bHRzID0gW1xuICAgICAgICAgICAgY2MucmVjdChicmlja1JlY3QueCwgYnJpY2tSZWN0LnksIGJyaWNrUmVjdC53aWR0aCwgb3ZlcmxhcHNSZWN0LnkgLSBicmlja1JlY3QueSksXG4gICAgICAgICAgICBjYy5yZWN0KGJyaWNrUmVjdC54LCBjYy5yZWN0R2V0TWF4WShvdmVybGFwc1JlY3QpLCBicmlja1JlY3Qud2lkdGgsIGNjLnJlY3RHZXRNYXhZKGJyaWNrUmVjdCkgLSBjYy5yZWN0R2V0TWF4WShvdmVybGFwc1JlY3QpKSxcbiAgICAgICAgICAgIGNjLnJlY3QoYnJpY2tSZWN0LngsIG92ZXJsYXBzUmVjdC55LCBvdmVybGFwc1JlY3QueCAtIGJyaWNrUmVjdC54LCBvdmVybGFwc1JlY3QuaGVpZ2h0KSxcbiAgICAgICAgICAgIGNjLnJlY3QoY2MucmVjdEdldE1heFgob3ZlcmxhcHNSZWN0KSwgb3ZlcmxhcHNSZWN0LnksIGNjLnJlY3RHZXRNYXhYKGJyaWNrUmVjdCkgLSBjYy5yZWN0R2V0TWF4WChvdmVybGFwc1JlY3QpLCBvdmVybGFwc1JlY3QuaGVpZ2h0KVxuICAgICAgICBdO1xuICAgICAgICBjb25zb2xlLmxvZyhcInJlc3VsdHM6XCIgKyBKU09OLnN0cmluZ2lmeShyZXN1bHRzKSk7XG4gICAgICAgIHZhciByZWN0cyA9IFtdO1xuICAgICAgICBmb3IgKHZhciBpID0gcmVzdWx0cy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICAgICAgdmFyIHJlY3QgPSByZXN1bHRzW2ldO1xuICAgICAgICAgICAgaWYgKHJlY3Qud2lkdGggPD0gMCB8fCByZWN0LmhlaWdodCA8PSAwKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZWN0cy5wdXNoKHJlY3QpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZWN0cztcbiAgICB9LFxuXG4gICAgLy9tYXJrT2NjdXBpZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAvLyAgICB2YXIgcmVnaW9uID0gdGhpcy5nZXRSZWdpb24odGhpcy5maXJzdEdyaWQsIHRoaXMubGFzdEdyaWQpO1xuICAgIC8vXG4gICAgLy8gICAgZm9yICh2YXIgbG9jYWxDb2wgPSByZWdpb24ubWluQ29sOyBsb2NhbENvbCA8PSByZWdpb24ubWF4Q29sOyArK2xvY2FsQ29sKSB7XG4gICAgLy8gICAgICAgIGZvciAodmFyIGxvY2FsUm93ID0gcmVnaW9uLm1pblJvdzsgbG9jYWxSb3cgPD0gcmVnaW9uLm1heFJvdzsgKytsb2NhbFJvdykge1xuICAgIC8vICAgICAgICAgICAgdGhpcy5ncmlkc1tsb2NhbENvbF1bbG9jYWxSb3ddLnVzZWQgPSB0cnVlO1xuICAgIC8vICAgICAgICB9XG4gICAgLy8gICAgfVxuICAgIC8vfSxcblxuICAgIG1hcmtPY2N1cGllZFdpdGhSZWN0OiBmdW5jdGlvbiAocmVjdCwgY29sb3IpIHtcbiAgICAgICAgZm9yICh2YXIgbG9jYWxDb2wgPSByZWN0WzBdOyBsb2NhbENvbCA8IHJlY3RbMF0gKyByZWN0WzJdOyArK2xvY2FsQ29sKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBsb2NhbFJvdyA9IHJlY3RbMV07IGxvY2FsUm93IDwgcmVjdFsxXSArIHJlY3RbM107ICsrbG9jYWxSb3cpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5ncmlkc1tsb2NhbENvbF0pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmlkc1tsb2NhbENvbF1bbG9jYWxSb3ddLmVkaXRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmlkc1tsb2NhbENvbF1bbG9jYWxSb3ddLnVzZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY29sb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JpZHNbbG9jYWxDb2xdW2xvY2FsUm93XS5zZXRDb2xvcihjb2xvcik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBpc09jY3VwaWVkOiBmdW5jdGlvbiAoZ3JpZCkge1xuICAgICAgICB2YXIgcmVnaW9uID0gdGhpcy5nZXRSZWdpb24odGhpcy5maXJzdEdyaWQsIGdyaWQpO1xuICAgICAgICBmb3IgKHZhciBsb2NhbENvbCA9IHJlZ2lvbi5taW5Db2w7IGxvY2FsQ29sIDw9IHJlZ2lvbi5tYXhDb2w7ICsrbG9jYWxDb2wpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGxvY2FsUm93ID0gcmVnaW9uLm1pblJvdzsgbG9jYWxSb3cgPD0gcmVnaW9uLm1heFJvdzsgKytsb2NhbFJvdykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmdyaWRzW2xvY2FsQ29sXVtsb2NhbFJvd10udXNlZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICB0b3VjaERyYXc6IGZ1bmN0aW9uICh0b3VjaCkge1xuICAgICAgICBpZiAoIXRoaXMuZmlyc3RHcmlkKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGdyaWQgPSB0aGlzLmdldENsb3Nlc3RHcmlkKHRvdWNoKTtcblxuICAgICAgICBpZiAoIWdyaWQpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChncmlkID09PSB0aGlzLmxhc3RHcmlkKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5pc09jY3VwaWVkKGdyaWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sYXN0R3JpZCA9IGdyaWQ7XG4gICAgICAgIHRoaXMuY2xlYXJSZWN0KCk7XG4gICAgICAgIHRoaXMuZHJhd1JlY3QoZ3JpZCk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG5cbiAgICB0b3VjaERlbGV0ZTogZnVuY3Rpb24gKHRvdWNoKSB7XG4gICAgICAgaWYgKCF0aGlzLmZpcnN0R3JpZCkge1xuICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgfVxuICAgICAgIHZhciBncmlkID0gdGhpcy5nZXRDbG9zZXN0R3JpZCh0b3VjaCk7XG5cbiAgICAgICBpZiAoIWdyaWQpIHtcbiAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgIH1cblxuICAgICAgIGlmIChncmlkID09PSB0aGlzLmxhc3RHcmlkKSB7XG4gICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICB9XG5cbiAgICAgICAvLyBpZiAodGhpcy5pc09jY3VwaWVkKGdyaWQpKSB7XG4gICAgICAgLy8gICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAvLyB9XG4gICAgICAgdGhpcy5sYXN0R3JpZCA9IGdyaWQ7XG4gICAgICAgLy8gdGhpcy5jbGVhclJlY3QoKTtcbiAgICAgICAvLyB0aGlzLmRyYXdSZWN0KGdyaWQpO1xuICAgICAgICB0aGlzLmRyYXdEZWxldGVSZWN0KGdyaWQpO1xuICAgIH0sXG5cbiAgICBkZWxldGVMYXRlc3RSZWN0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciByZWN0ID0gdGhpcy5jdXJyZW50UmVjdHMucG9wKCk7XG4gICAgICAgIGlmIChyZWN0KSB7XG4gICAgICAgICAgICBmb3IgKHZhciBsb2NhbENvbCA9IHJlY3RbMF07IGxvY2FsQ29sIDwgcmVjdFswXSArIHJlY3RbMl07ICsrbG9jYWxDb2wpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBsb2NhbFJvdyA9IHJlY3RbMV07IGxvY2FsUm93IDwgcmVjdFsxXSArIHJlY3RbM107ICsrbG9jYWxSb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGdyaWQgPSB0aGlzLmdyaWRzW2xvY2FsQ29sXVtsb2NhbFJvd107XG4gICAgICAgICAgICAgICAgICAgIGdyaWQuc2V0Q29sb3IoZ3JpZC5fY29sb3IpO1xuICAgICAgICAgICAgICAgICAgICBncmlkLnVzZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgY2xlYXJSZWN0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuZm9yRWFjaEdyaWRzKGZ1bmN0aW9uIChncmlkKSB7XG4gICAgICAgICAgICBpZiAoZ3JpZC5lZGl0aW5nICYmICFncmlkLnVzZWQpIHtcbiAgICAgICAgICAgICAgICBncmlkLnNldENvbG9yKGdyaWQuX2NvbG9yKTtcbiAgICAgICAgICAgICAgICBncmlkLmVkaXRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGRyYXdSZWN0OiBmdW5jdGlvbiAoZ3JpZCkge1xuICAgICAgICB2YXIgcmVnaW9uID0gdGhpcy5nZXRSZWdpb24odGhpcy5maXJzdEdyaWQsIGdyaWQpO1xuXG4gICAgICAgIGZvciAodmFyIGxvY2FsQ29sID0gcmVnaW9uLm1pbkNvbDsgbG9jYWxDb2wgPD0gcmVnaW9uLm1heENvbDsgKytsb2NhbENvbCkge1xuICAgICAgICAgICAgZm9yICh2YXIgbG9jYWxSb3cgPSByZWdpb24ubWluUm93OyBsb2NhbFJvdyA8PSByZWdpb24ubWF4Um93OyArK2xvY2FsUm93KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncmlkc1tsb2NhbENvbF1bbG9jYWxSb3ddLmVkaXRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JpZHNbbG9jYWxDb2xdW2xvY2FsUm93XS5zZXRDb2xvcih0aGlzLmdldEN1cnJlbnRDb2xvcigpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBmb3JFYWNoR3JpZHM6IGZ1bmN0aW9uIChjYikge1xuICAgICAgICBmb3IgKHZhciBsb2NhbENvbCA9IDA7IGxvY2FsQ29sIDwgdGhpcy5DT0w7ICsrbG9jYWxDb2wpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGxvY2FsUm93ID0gMDsgbG9jYWxSb3cgPCB0aGlzLlJPVzsgKytsb2NhbFJvdykge1xuICAgICAgICAgICAgICAgIHZhciBncmlkID0gdGhpcy5ncmlkc1tsb2NhbENvbF1bbG9jYWxSb3ddO1xuICAgICAgICAgICAgICAgIGNiKGdyaWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGRyYXdEZWxldGVSZWN0OiBmdW5jdGlvbiAoZ3JpZCkge1xuICAgICAgICB2YXIgcmVnaW9uID0gdGhpcy5nZXRSZWdpb24odGhpcy5maXJzdEdyaWQsIGdyaWQpO1xuXG4gICAgICAgIHRoaXMuZm9yRWFjaEdyaWRzKGZ1bmN0aW9uIChncmlkKSB7XG4gICAgICAgICAgICBpZiAoZ3JpZC5kZWxldGVkKSB7XG4gICAgICAgICAgICAgICAgZ3JpZC5zZXRDb2xvcihncmlkLl9zaG93Q29sb3IpO1xuICAgICAgICAgICAgICAgIGdyaWQuZGVsZXRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBmb3IgKHZhciBsb2NhbENvbCA9IHJlZ2lvbi5taW5Db2w7IGxvY2FsQ29sIDw9IHJlZ2lvbi5tYXhDb2w7ICsrbG9jYWxDb2wpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGxvY2FsUm93ID0gcmVnaW9uLm1pblJvdzsgbG9jYWxSb3cgPD0gcmVnaW9uLm1heFJvdzsgKytsb2NhbFJvdykge1xuICAgICAgICAgICAgICAgIHZhciBncmlkID0gdGhpcy5ncmlkc1tsb2NhbENvbF1bbG9jYWxSb3ddO1xuICAgICAgICAgICAgICAgIC8vIGdyaWQuZWRpdGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGdyaWQudXNlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGdyaWQuZGVsZXRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgZ3JpZC5fc2hvd0NvbG9yID0gZ3JpZC5nZXRDb2xvcigpO1xuICAgICAgICAgICAgICAgIGdyaWQuc2V0Q29sb3IoZ3JpZC5fY29sb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldFJlZ2lvbjogZnVuY3Rpb24gKGdyaWQxLCBncmlkMikge1xuICAgICAgICB2YXIgbWluUm93ID0gTWF0aC5taW4oZ3JpZDEucm93LCBncmlkMi5yb3cpO1xuICAgICAgICB2YXIgbWF4Um93ID0gTWF0aC5tYXgoZ3JpZDEucm93LCBncmlkMi5yb3cpO1xuICAgICAgICB2YXIgbWluQ29sID0gTWF0aC5taW4oZ3JpZDEuY29sLCBncmlkMi5jb2wpO1xuICAgICAgICB2YXIgbWF4Q29sID0gTWF0aC5tYXgoZ3JpZDEuY29sLCBncmlkMi5jb2wpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbWluUm93OiBtaW5Sb3csXG4gICAgICAgICAgICBtYXhSb3c6IG1heFJvdyxcbiAgICAgICAgICAgIG1pbkNvbDogbWluQ29sLFxuICAgICAgICAgICAgbWF4Q29sOiBtYXhDb2xcbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgb25Ub3VjaENhbmNlbGxlZDpmdW5jdGlvbih0b3VjaCwgZXZlbnQpIHtcbiAgICB9LFxuXG4gICAgZ2V0Q2xvc2VzdEdyaWQ6IGZ1bmN0aW9uICh0b3VjaCkge1xuICAgICAgICB2YXIgbG9jYWxQb3MgPSB0aGlzLmdyaWROb2RlLmNvbnZlcnRUb05vZGVTcGFjZSh0b3VjaC5nZXRMb2NhdGlvbigpKTtcbiAgICAgICAgdmFyIGdyaWRTaXplID0gdGhpcy5nZXRGdWxsR3JpZFNpemUoKTtcblxuICAgICAgICBjYy5sb2coXCJsb2NhbFBvczpcIiArIEpTT04uc3RyaW5naWZ5KGxvY2FsUG9zKSk7XG5cbiAgICAgICAgdmFyIHJvdyA9IE1hdGguZmxvb3IobG9jYWxQb3MueCAvIGdyaWRTaXplLndpZHRoKTtcbiAgICAgICAgdmFyIGNvbCA9IE1hdGguZmxvb3IobG9jYWxQb3MueSAvIGdyaWRTaXplLmhlaWdodCk7XG5cbiAgICAgICAgY2MubG9nKFwicm93OlwiICsgcm93ICsgXCIsY29sOlwiICsgY29sKTtcblxuICAgICAgICBpZiAodGhpcy5ncmlkc1tyb3ddKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5ncmlkc1tyb3ddW2NvbF07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSxcblxuICAgIGdldEN1cnJlbnRDb2xvcjogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fc3RhdHVzID09PSBcImJyaWNrXCIpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNlbGVjdENvbG9yO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGNjLmNvbG9yLldISVRFO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vXG4gICAgLy9kcmF3UmVjdDogZnVuY3Rpb24ocmVnaW9uLCBjb2xvciwgY2xlYXIpIHtcbiAgICAvLyAgICBpZiAoY2xlYXIpe1xuICAgIC8vICAgICAgICB0aGlzLl9kcmF3Tm9kZS5jbGVhcigpO1xuICAgIC8vICAgIH1cbiAgICAvLyAgICBpZiAocmVnaW9uID09IG51bGwpIHtcbiAgICAvLyAgICAgICAgcmV0dXJuO1xuICAgIC8vICAgIH1cbiAgICAvLyAgICB2YXIgbWluID0gcmVnaW9uLmdldE1pbigpO1xuICAgIC8vICAgIHZhciBtYXggPSByZWdpb24uZ2V0TWF4KCk7XG4gICAgLy8gICAgbWF4LnggKz0gMTtcbiAgICAvLyAgICBtYXgueSArPSAxO1xuICAgIC8vICAgIHRoaXMuX2RyYXdOb2RlLmRyYXdTZWdtZW50KGNjLnAobWluLngsIG1pbi55KSxcbiAgICAvLyAgICAgICAgY2MucChtaW4ueCwgbWF4LnkpLCAxLCBjb2xvcik7XG4gICAgLy8gICAgdGhpcy5fZHJhd05vZGUuZHJhd1NlZ21lbnQoY2MucChtaW4ueCwgbWF4LnkpLFxuICAgIC8vICAgICAgICBjYy5wKG1heC54LCBtYXgueSksIDEsIGNvbG9yKTtcbiAgICAvLyAgICB0aGlzLl9kcmF3Tm9kZS5kcmF3U2VnbWVudChjYy5wKG1heC54LCBtYXgueSksXG4gICAgLy8gICAgICAgIGNjLnAobWF4LngsIG1pbi55KSwgMSwgY29sb3IpO1xuICAgIC8vICAgIHRoaXMuX2RyYXdOb2RlLmRyYXdTZWdtZW50KGNjLnAobWF4LngsIG1pbi55KSxcbiAgICAvLyAgICAgICAgY2MucChtaW4ueCwgbWluLnkpLCAxLCBjb2xvcik7XG4gICAgLy99LFxuICAgIC8vXG4gICAgLy9kcmF3UmVjdEZpbGw6IGZ1bmN0aW9uIChyZWdpb24sIGNvbG9yKSB7XG4gICAgLy8gICAgaWYgKHJlZ2lvbiA9PSBudWxsKSB7XG4gICAgLy8gICAgICAgIHJldHVybjtcbiAgICAvLyAgICB9XG4gICAgLy8gICAgdGhpcy5fZHJhd05vZGUuZHJhd1JlY3QocmVnaW9uLmdldE1pbigpLCByZWdpb24uZ2V0TWF4KCksIGNvbG9yLCAxLCBjb2xvcik7XG4gICAgLy99XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBFZGl0b3JTY2VuZTsiLCJ2YXIgR2FtZUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vLi4vY29udHJvbGxlci9HYW1lQ29udHJvbGxlclwiKTtcblxudmFyIEdhbWVTY2VuZSA9IGNjLlNjZW5lLmV4dGVuZCh7XG5cbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICAgIHZhciBnYW1lTm9kZSA9IEdhbWVDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgdGhpcy5hZGRDaGlsZChnYW1lTm9kZSk7XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gR2FtZVNjZW5lO1xuIiwidmFyIEdyaWRUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vR3JpZFR5cGVcIik7XG52YXIgU2hhcGVUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vU2hhcGVUeXBlXCIpO1xudmFyIEdhbWVNYW4gPSByZXF1aXJlKFwiLi4vbW9kZWwvR2FtZU1hblwiKTtcbnZhciBJdGVtQ2F0ZWdvcnkgPSByZXF1aXJlKFwiLi4vZW51bS9JdGVtQ2F0ZWdvcnlcIik7XG5cbnZhciBCYWxsID0gY2MuTm9kZS5leHRlbmQoe1xuXG4gICAgdHlwZTogR3JpZFR5cGUuQkFMTCxcbiAgICBib2R5OiBudWxsLFxuICAgIHNwcml0ZTogbnVsbCxcbiAgICBhZGRTY2FsZTogMSxcbiAgICBicmVha2luZzogZmFsc2UsXG4gICAgY3RvcjogZnVuY3Rpb24gKHdpZHRoKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICAgIHRoaXMuYm9keVdpZHRoID0gd2lkdGg7XG4gICAgICAgIHZhciBza2luQ2ZnID0gR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmdldEN1cnJlbnRTa2luQ2ZnKCk7XG4gICAgICAgIHZhciBpbWFnZSA9IHNraW5DZmcuaW1hZ2UgKyBcIi5wbmdcIjtcbiAgICAgICAgdmFyIHNwcml0ZSA9IG5ldyBjYy5QaHlzaWNzU3ByaXRlKFwiI1wiICsgaW1hZ2UpO1xuICAgICAgICB0aGlzLmFkZFNjYWxlID0gc2tpbkNmZy5zY2FsZTtcbiAgICAgICAgdGhpcy5hZGRDaGlsZChzcHJpdGUpO1xuICAgICAgICB0aGlzLnNwcml0ZSA9IHNwcml0ZTtcbiAgICAgICAgdGhpcy5yZXNldCh3aWR0aCk7XG4gICAgfSxcblxuICAgIHJlc2V0OiBmdW5jdGlvbiAod2lkdGgpIHtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2NhbGVYID0gd2lkdGggLyB0aGlzLnNwcml0ZS53aWR0aCAqIHRoaXMuYWRkU2NhbGU7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNjYWxlWSA9IHdpZHRoIC8gdGhpcy5zcHJpdGUud2lkdGggKiB0aGlzLmFkZFNjYWxlO1xuICAgICAgICB0aGlzLmJyZWFraW5nID0gZmFsc2U7XG4gICAgfSxcblxuICAgIHVwZGF0ZVNraW46IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNraW5DZmcgPSBHYW1lTWFuLmdldEluc3RhbmNlKCkuZ2V0Q3VycmVudFNraW5DZmcoKTtcbiAgICAgICAgdmFyIGltYWdlID0gc2tpbkNmZy5pbWFnZSArIFwiLnBuZ1wiO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRTcHJpdGVGcmFtZShjYy5zcHJpdGVGcmFtZUNhY2hlLmdldFNwcml0ZUZyYW1lKGltYWdlKSk7XG4gICAgICAgIHRoaXMuYWRkU2NhbGUgPSBza2luQ2ZnLnNjYWxlO1xuICAgICAgICB0aGlzLnJlc2V0KHRoaXMuYm9keVdpZHRoKTtcbiAgICB9LFxuXG4gICAgb25FeGl0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICAgIHRoaXMucmVtb3ZlQm9keSgpO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uIChkdCkge1xuICAgIH0sXG5cbiAgICBzZXRBbmdsZVZlbDogZnVuY3Rpb24gKHcpIHtcbiAgICAgICAgdGhpcy5ib2R5LnNldEFuZ1ZlbCgtY2MucmFkaWFuc1RvRGVncmVlcyh3KSk7XG4gICAgfSxcblxuICAgIGdldEJvZHlBbmdsZTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gLWNjLnJhZGlhbnNUb0RlZ3JlZXModGhpcy5ib2R5LmEpO1xuICAgIH0sXG5cbiAgICBpbml0Qm9keTogZnVuY3Rpb24gKHNwYWNlLCBwb3MpIHtcbiAgICAgICAgdGhpcy5zcGFjZSA9IHNwYWNlO1xuICAgICAgICB2YXIgYm9keVdpZHRoID0gdGhpcy5ib2R5V2lkdGggLSAyO1xuICAgICAgICB2YXIgYm9keSA9IG5ldyBjcC5Cb2R5KDEsIGNwLm1vbWVudEZvckNpcmNsZSgxLCAwLCBib2R5V2lkdGgsIGNwLnYoMCwgMCkpKTtcbiAgICAgICAgdmFyIHNoYXBlID0gbmV3IGNwLkNpcmNsZVNoYXBlKGJvZHksIGJvZHlXaWR0aCAvIDIsIGNwLnYoMCwgMCkpO1xuICAgICAgICBzaGFwZS5zZXRFbGFzdGljaXR5KDEpO1xuICAgICAgICBzaGFwZS5zZXRGcmljdGlvbigwKTtcbiAgICAgICAgdGhpcy5zcGFjZS5hZGRTaGFwZShzaGFwZSk7XG4gICAgICAgIHRoaXMuc3BhY2UuYWRkQm9keShib2R5KTtcbiAgICAgICAgc2hhcGUuc2V0Q29sbGlzaW9uVHlwZShTaGFwZVR5cGUuQkFMTCk7XG4gICAgICAgIGJvZHkudXNlckRhdGEgPSB0aGlzO1xuICAgICAgICB0aGlzLmJvZHkgPSBib2R5O1xuICAgICAgICB0aGlzLnNoYXBlID0gc2hhcGU7XG4gICAgICAgIHRoaXMuYm9keS5zZXRQb3MocG9zKTtcbiAgICAgICAgYm9keS5zZXRBbmdWZWwoMyk7XG5cbiAgICAgICAgLy90aGlzLnVwZGF0ZSgwKTtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAgc2hhcGUuc2V0RmlsdGVyKHtcbiAgICAgICAgICAgICAgICBncm91cDogY3AuTk9fR1JPVVAsXG4gICAgICAgICAgICAgICAgY2F0ZWdvcmllczogSXRlbUNhdGVnb3J5LkJhbGwsXG4gICAgICAgICAgICAgICAgbWFzazogSXRlbUNhdGVnb3J5Lk9ic3RhY2xlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNoYXBlLmdyb3VwID0gMTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNwcml0ZS5zZXRCb2R5KGJvZHkpO1xuICAgIH0sXG5cbiAgICBnZXRQb3NpdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zcHJpdGUuZ2V0UG9zaXRpb24oKTtcbiAgICB9LFxuXG4gICAgcmVtb3ZlQm9keTogZnVuY3Rpb24gKCkge1xuICAgICAgICAvL2NvbnNvbGUubG9nKFwiQmFsbCByZW1vdmVCb2R5XCIpO1xuICAgICAgICBpZiAodGhpcy5ib2R5KSB7XG4gICAgICAgICAgICB0aGlzLnNwYWNlLnJlbW92ZUJvZHkodGhpcy5ib2R5KTtcbiAgICAgICAgICAgIHRoaXMuc3BhY2UucmVtb3ZlU2hhcGUodGhpcy5zaGFwZSk7XG4gICAgICAgICAgICAvL3RoaXMuc3ByaXRlLnNldEJvZHkobnVsbCk7XG4gICAgICAgICAgICB0aGlzLmJvZHkgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5zaGFwZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2V0VmVsOiBmdW5jdGlvbiAoZGlyZWN0aW9uUG9zKSB7XG4gICAgICAgIHRoaXMuYm9keS5zZXRWZWwoZGlyZWN0aW9uUG9zKTtcbiAgICB9LFxuXG4gICAgZ2V0VmVsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJvZHkuZ2V0VmVsKCk7XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gQmFsbDsiLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAyMDE3LzExLzguXG4gKi9cbnZhciBVdGlscyA9IHJlcXVpcmUoXCIuLi8uLi9jb21tb24vdXRpbC9VdGlsc1wiKTtcblxudmFyIEJhbGxQb29sID0ge1xuICAgIE1BWF9QT09MX1NJWkU6IDMwMCxcbiAgICBfcG9vbFNpemU6IHt9LFxuICAgIF9wb29sOiB7fSxcblxuICAgIHNldE1heFBvb2xTaXplOiBmdW5jdGlvbiAobmFtZSwgY291bnQpIHtcbiAgICAgICAgdGhpcy5fcG9vbFNpemVbbmFtZV0gPSBjb3VudDtcbiAgICB9LFxuXG4gICAgZ2V0TWF4UG9vbFNpemU6IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9wb29sU2l6ZVtuYW1lXSB8fCB0aGlzLk1BWF9QT09MX1NJWkU7XG4gICAgfSxcblxuICAgIHB1dEluUG9vbDogZnVuY3Rpb24gKG5hbWUsIG9iaikge1xuICAgICAgICBpZiAoIXRoaXMuX3Bvb2xbbmFtZV0pIHtcbiAgICAgICAgICAgIHRoaXMuX3Bvb2xbbmFtZV0gPSBbXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fcG9vbFtuYW1lXS5sZW5ndGggPCB0aGlzLmdldE1heFBvb2xTaXplKG5hbWUpKSB7XG4gICAgICAgICAgICBvYmoucmV0YWluICYmIG9iai5yZXRhaW4oKTtcbiAgICAgICAgICAgIHRoaXMuX3Bvb2xbbmFtZV0ucHVzaChvYmopO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2MubG9nKFwiU3ltYm9sIHBvb2wgaXMgZnVsbCwgdGhyb3cgYXdheSB0aGlzIHN5bWJvbDpcIiArIG5hbWUgKyBcIixtYXggcG9vbCBzaXplOlwiICsgdGhpcy5nZXRNYXhQb29sU2l6ZShuYW1lKSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgaGFzT2JqZWN0OiBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICByZXR1cm4gKHRoaXMuX3Bvb2xbbmFtZV0gJiYgdGhpcy5fcG9vbFtuYW1lXS5sZW5ndGggPiAwKTtcbiAgICB9LFxuXG4gICAgcmVtb3ZlT2JqZWN0OiBmdW5jdGlvbiAobmFtZSwgb2JqKSB7XG4gICAgICAgIHZhciBsaXN0ID0gdGhpcy5fcG9vbFtuYW1lXTtcbiAgICAgICAgaWYgKGxpc3QpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmIChvYmogPT09IGxpc3RbaV0pIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gSlNCIHJlbGVhc2UgdG8gYXZvaWQgbWVtb3J5IGxlYWtcbiAgICAgICAgICAgICAgICAgICAgb2JqLnJlbGVhc2UgJiYgb2JqLnJlbGVhc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgbGlzdC5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldEZyb21Qb29sOiBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICBpZiAodGhpcy5oYXNPYmplY3QobmFtZSkpIHtcbiAgICAgICAgICAgIHZhciBvYmogPSB0aGlzLl9wb29sW25hbWVdLnBvcCgpO1xuICAgICAgICAgICAgY2Muc3lzLmlzTmF0aXZlICYmIG9iai5yZWxlYXNlICYmIFV0aWxzLmF1dG9SZWxlYXNlKG9iaik7XG4gICAgICAgICAgICByZXR1cm4gb2JqO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGRyYWluQWxsUG9vbHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLl9wb29sKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fcG9vbC5oYXNPd25Qcm9wZXJ0eShpKSkge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgdGhpcy5fcG9vbFtpXS5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgb2JqID0gdGhpcy5fcG9vbFtpXVtqXTtcbiAgICAgICAgICAgICAgICAgICAgLy8gSlNCIHJlbGVhc2UgdG8gYXZvaWQgbWVtb3J5IGxlYWtcbiAgICAgICAgICAgICAgICAgICAgb2JqLnJlbGVhc2UgJiYgb2JqLnJlbGVhc2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fcG9vbCA9IHt9O1xuICAgIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQmFsbFBvb2w7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMjAxNy8xMi8yLlxuICovXG5cbnZhciBHcmlkVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL0dyaWRUeXBlXCIpO1xudmFyIEJvYXJkQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL0JvYXJkQ29udHJvbGxlclwiKTtcbnZhciBTaGFwZVR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9TaGFwZVR5cGVcIik7XG52YXIgSXRlbUNhdGVnb3J5ID0gcmVxdWlyZShcIi4uL2VudW0vSXRlbUNhdGVnb3J5XCIpO1xuXG52YXIgQm9hcmQgPSBjYy5Ob2RlLmV4dGVuZCh7XG5cbiAgICB0eXBlOiBHcmlkVHlwZS5CT0FSRCxcblxuICAgIG5vZGU6IG51bGwsXG5cbiAgICBzaGFwZTogbnVsbCxcblxuICAgIGN0b3I6IGZ1bmN0aW9uICh3aWR0aCkge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgICAgICB0aGlzLm5vZGUgPSBCb2FyZENvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQih3aWR0aCk7XG4gICAgICAgIHRoaXMuYWRkQ2hpbGQodGhpcy5ub2RlKTtcblxuICAgICAgICB0aGlzLndpZHRoID0gdGhpcy5ub2RlLmNvbnRyb2xsZXIubmRCb2FyZC53aWR0aCArIDE2O1xuICAgICAgICB0aGlzLmhlaWdodCA9IHRoaXMubm9kZS5jb250cm9sbGVyLm5kQm9hcmQuaGVpZ2h0O1xuICAgIH0sXG5cbiAgICBvbkV4aXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICAgICAgdGhpcy5yZW1vdmVCb2R5KCk7XG4gICAgfSxcblxuICAgIHJlbW92ZUJvZHk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy9jb25zb2xlLmxvZyhcIkJvYXJkIHJlbW92ZUJvZHlcIik7XG4gICAgICAgIGlmICh0aGlzLmJvZHkpIHtcbiAgICAgICAgICAgIC8vdGhpcy5zcGFjZS5yZW1vdmVCb2R5KHRoaXMuYm9keSk7XG4gICAgICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zcGFjZS5yZW1vdmVTaGFwZSh0aGlzLnNoYXBlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zcGFjZS5yZW1vdmVTdGF0aWNTaGFwZSh0aGlzLnNoYXBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuYm9keSA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLnNoYXBlID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBpbml0Qm9keTogZnVuY3Rpb24gKHNwYWNlLCBwb3MpIHtcbiAgICAgICAgdGhpcy5zZXRQb3NpdGlvbihwb3MpO1xuICAgICAgICB0aGlzLnNwYWNlID0gc3BhY2U7XG5cbiAgICAgICAgdmFyIGJvZHk7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGJvZHkgPSBuZXcgY3AuQm9keSgwLCBJbmZpbml0eSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBib2R5ID0gbmV3IGNwLkJvZHkoSW5maW5pdHksIEluZmluaXR5KTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgc2hhcGUgPSBuZXcgY3AuQm94U2hhcGUoYm9keSwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgICAgICBzaGFwZS5zZXRFbGFzdGljaXR5KDEpO1xuICAgICAgICBzaGFwZS5zZXRGcmljdGlvbigwKTtcbiAgICAgICAgc2hhcGUuc2V0Q29sbGlzaW9uVHlwZShTaGFwZVR5cGUuQk9BUkQpO1xuICAgICAgICAvL3NoYXBlLmxheWVycyA9IDE7XG4gICAgICAgIHRoaXMuc3BhY2UuYWRkU3RhdGljU2hhcGUoc2hhcGUpO1xuICAgICAgICBib2R5LnNldFBvcyhwb3MpO1xuICAgICAgICBib2R5LnVzZXJEYXRhID0gdGhpcztcbiAgICAgICAgdGhpcy5ib2R5ID0gYm9keTtcbiAgICAgICAgdGhpcy5zaGFwZSA9IHNoYXBlO1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBzaGFwZS5zZXRGaWx0ZXIoe1xuICAgICAgICAgICAgICAgIGdyb3VwOiBjcC5OT19HUk9VUCxcbiAgICAgICAgICAgICAgICBjYXRlZ29yaWVzOiBJdGVtQ2F0ZWdvcnkuT2JzdGFjbGUsXG4gICAgICAgICAgICAgICAgbWFzazogSXRlbUNhdGVnb3J5LkJhbGxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zcGFjZS5yZWluZGV4U2hhcGUodGhpcy5zaGFwZSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2V0UG9zWDogZnVuY3Rpb24gKHBvc1gpIHtcbiAgICAgICAgdGhpcy54ID0gcG9zWDtcbiAgICAgICAgdGhpcy5ib2R5LnNldFBvcyhjYy5wKHRoaXMueCwgdGhpcy55KSk7XG4gICAgICAgIGlmICghY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICB0aGlzLnNwYWNlLnJlaW5kZXhTaGFwZSh0aGlzLnNoYXBlKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRCb3VuZGluZ0JveDogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ub2RlLmNvbnRyb2xsZXIubmRCb2FyZC5nZXRCb3VuZGluZ0JveFRvV29ybGQoKTtcbiAgICB9LFxuXG4gICAgaGlkZUJhbGw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5ub2RlLmNvbnRyb2xsZXIuaGlkZUJhbGwoKTtcbiAgICB9LFxuXG4gICAgc2hvd0JhbGw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5ub2RlLmNvbnRyb2xsZXIuc2hvd0JhbGwoKTtcbiAgICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBCb2FyZDsiLCJ2YXIgQm9vc3RUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vQm9vc3RUeXBlXCIpO1xuXG52YXIgQm9vc3QgPSBjYy5TcHJpdGUuZXh0ZW5kKHtcblxuICAgIHR5cGU6IDAsXG4gICAgY3RvcjogZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgICAgICBjYXNlIEJvb3N0VHlwZS5MSUZFOlxuICAgICAgICAgICAgICAgIHRoaXMuX3N1cGVyKFwiI2ljb25fbmV3X2xpZmUucG5nXCIpO1xuICAgICAgICAgICAgICAgIC8vdGhpcy5zZXRDb2xvcihjYy5jb2xvci5SRUQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBCb29zdFR5cGUuU1BMSVQ6XG4gICAgICAgICAgICAgICAgdGhpcy5fc3VwZXIoXCIjaWNvbl8zX211bHRpcGxlLnBuZ1wiKTtcbiAgICAgICAgICAgICAgICAvL3RoaXMuc2V0Q29sb3IoY2MuY29sb3IuQkxVRSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEJvb3N0VHlwZS5USFJFRV9CQUxMOlxuICAgICAgICAgICAgICAgIHRoaXMuX3N1cGVyKFwiI2ljb25fM19uZXcucG5nXCIpO1xuICAgICAgICAgICAgICAgIC8vdGhpcy5zZXRDb2xvcihjYy5jb2xvci5HUkVFTik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEJvb3N0VHlwZS5CT01COlxuICAgICAgICAgICAgICAgIHRoaXMuX3N1cGVyKFwiI2ljb25fYm9tYi5wbmdcIik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEJvb3N0VHlwZS5TVVBFUl9CT0FSRDpcbiAgICAgICAgICAgICAgICB0aGlzLl9zdXBlcihcIiNpY29uXzNfYmFmZmxlLnBuZ1wiKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJvb3N0OyIsIlxudmFyIENoYWxsZW5nZURhdGEgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5jaGFsbGVuZ2VMZXZlbCA9IDE7XG4gICAgdGhpcy5jaGFsbGVuZ2VNaWxlc3RvbmVDbGFpbUlkID0gMDtcbiAgICB0aGlzLmNoYWxsZW5nZVJldml2ZUNvdW50ID0gMDtcbiAgICAvLyB0aGlzLmNoYWxsZW5nZVVubG9ja1RpcHMgPSBmYWxzZTtcbiAgICB0aGlzLmNoYWxsZW5nZUxldmVsTWFwID0ge307XG4gICAgdGhpcy5jaGFsbGVuZ2VQbGF5aW5nID0gZmFsc2U7XG4gICAgLy8gdGhpcy5jaGFsbGVuZ2VFbnRlcmVkID0gZmFsc2U7XG59O1xuXG5DaGFsbGVuZ2VEYXRhLnByb3RvdHlwZS51bm1hcnNoYWwgPSBmdW5jdGlvbiAoanNvbikge1xuICAgIHRoaXMuY2hhbGxlbmdlTGV2ZWwgPSBqc29uW1wiY2hhbGxlbmdlTGV2ZWxcIl0gfHwgMTtcbiAgICB0aGlzLmNoYWxsZW5nZU1pbGVzdG9uZUNsYWltSWQgPSBqc29uW1wiY2hhbGxlbmdlTWlsZXN0b25lQ2xhaW1JZFwiXSB8fCAwO1xuICAgIHRoaXMuY2hhbGxlbmdlUmV2aXZlQ291bnQgPSBqc29uW1wiY2hhbGxlbmdlUmV2aXZlQ291bnRcIl0gfHwgMDtcbiAgICAvLyB0aGlzLmNoYWxsZW5nZVVubG9ja1RpcHMgPSBqc29uW1wiY2hhbGxlbmdlVW5sb2NrVGlwc1wiXSB8fCBmYWxzZTtcbiAgICB0aGlzLmNoYWxsZW5nZUxldmVsTWFwID0ganNvbltcImNoYWxsZW5nZUxldmVsTWFwXCJdIHx8IHt9O1xuICAgIHRoaXMuY2hhbGxlbmdlUGxheWluZyA9IGpzb25bXCJjaGFsbGVuZ2VQbGF5aW5nXCJdIHx8IGZhbHNlO1xuICAgIC8vIHRoaXMuY2hhbGxlbmdlRW50ZXJlZCA9IGpzb25bXCJjaGFsbGVuZ2VFbnRlcmVkXCJdIHx8IGZhbHNlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBDaGFsbGVuZ2VEYXRhOyIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDIwMTcvMTIvMi5cbiAqL1xuXG52YXIgU2hhcGVUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vU2hhcGVUeXBlXCIpO1xudmFyIEl0ZW1DYXRlZ29yeSA9IHJlcXVpcmUoXCIuLi9lbnVtL0l0ZW1DYXRlZ29yeVwiKTtcblxudmFyIEdyaWQgPSBjYy5Ob2RlLmV4dGVuZCh7XG5cbiAgICBpc0dpZnQ6IGZhbHNlLFxuICAgIHR5cGU6IDAsXG4gICAgcmVtb3ZlYWJsZTogZmFsc2UsXG5cbiAgICBzcHJpdGU6IG51bGwsXG5cbiAgICBiYWxsOiBudWxsLFxuXG4gICAgY3RvcjogZnVuY3Rpb24gKGNvbG9yLCB3aWR0aCwgaGVpZ2h0LCB0eXBlKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICAgIHRoaXMuaWdub3JlQW5jaG9yID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc3ByaXRlID0gbmV3IGNjLlNwcml0ZShcIiNncmlkLnBuZ1wiKTtcbiAgICAgICAgdGhpcy5hZGRDaGlsZCh0aGlzLnNwcml0ZSk7XG4gICAgICAgIHRoaXMucmVzZXQoY29sb3IsIHdpZHRoLCBoZWlnaHQsIHR5cGUpO1xuICAgIH0sXG5cbiAgICByZXNldDogZnVuY3Rpb24gKGNvbG9yLCB3aWR0aCwgaGVpZ2h0LCB0eXBlKSB7XG4gICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNjYWxlWCA9IHdpZHRoIC8gdGhpcy5zcHJpdGUud2lkdGg7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNjYWxlWSA9IGhlaWdodCAvIHRoaXMuc3ByaXRlLmhlaWdodDtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0Q29sb3IoY29sb3IpO1xuICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7XG4gICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0O1xuICAgIH0sXG5cbiAgICBvbkV4aXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICAgICAgdGhpcy5yZW1vdmVCb2R5KCk7XG4gICAgfSxcblxuICAgIHNldEdpZnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pc0dpZnQgPSB0cnVlO1xuICAgICAgICB2YXIgc3ByaXRlRnJhbWUgPSBjYy5zcHJpdGVGcmFtZUNhY2hlLmdldFNwcml0ZUZyYW1lKFwiZ3JpZF9naWZ0LnBuZ1wiKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0U3ByaXRlRnJhbWUoc3ByaXRlRnJhbWUpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRDb2xvcihjYy5jb2xvci5XSElURSk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNjYWxlWCA9ICh0aGlzLndpZHRoICsgNCkgLyB0aGlzLnNwcml0ZS53aWR0aDtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2NhbGVZID0gKHRoaXMuaGVpZ2h0ICsgNCkgLyB0aGlzLnNwcml0ZS5oZWlnaHQ7XG4gICAgfSxcblxuICAgIHNldENvbG9yOiBmdW5jdGlvbiAoY29sb3IpIHtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICAgICAgaWYgKCF0aGlzLmlzR2lmdCkge1xuICAgICAgICAgICAgdGhpcy5zcHJpdGUuc2V0Q29sb3IoY29sb3IpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGluaXRCb2R5OiBmdW5jdGlvbiAoc3BhY2UsIHBvcywgZ3JpZFdpZHRoLCBncmlkSGVpZ2h0KSB7XG4gICAgICAgIHRoaXMuc2V0UG9zaXRpb24ocG9zKTtcbiAgICAgICAgdGhpcy5zcGFjZSA9IHNwYWNlO1xuXG4gICAgICAgIHZhciBib2R5ID0gbmV3IGNwLkJvZHkoSW5maW5pdHksIEluZmluaXR5KTtcbiAgICAgICAgdmFyIHNoYXBlID0gbmV3IGNwLkJveFNoYXBlKGJvZHksIGdyaWRXaWR0aCwgZ3JpZEhlaWdodCk7XG4gICAgICAgIHNoYXBlLnNldEVsYXN0aWNpdHkoMSk7XG4gICAgICAgIHNoYXBlLnNldEZyaWN0aW9uKDApO1xuICAgICAgICAvL3NoYXBlLmxheWVycyA9IDE7XG4gICAgICAgIHRoaXMuc3BhY2UuYWRkU3RhdGljU2hhcGUoc2hhcGUpO1xuICAgICAgICBzaGFwZS5zZXRDb2xsaXNpb25UeXBlKFNoYXBlVHlwZS5CUklDSyk7XG4gICAgICAgIGJvZHkuc2V0UG9zKHBvcyk7XG4gICAgICAgIHRoaXMuYm9keSA9IGJvZHk7XG4gICAgICAgIGJvZHkudXNlckRhdGEgPSB0aGlzO1xuICAgICAgICB0aGlzLnNoYXBlID0gc2hhcGU7XG4gICAgICAgIHRoaXMuc3BhY2UucmVpbmRleFNoYXBlKHNoYXBlKTtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAgc2hhcGUuc2V0RmlsdGVyKHtcbiAgICAgICAgICAgICAgICBncm91cDogY3AuTk9fR1JPVVAsXG4gICAgICAgICAgICAgICAgY2F0ZWdvcmllczogSXRlbUNhdGVnb3J5Lk9ic3RhY2xlLFxuICAgICAgICAgICAgICAgIG1hc2s6IEl0ZW1DYXRlZ29yeS5CYWxsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByZW1vdmVCb2R5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vY29uc29sZS5sb2coXCJHcmlkIHJlbW92ZUJvZHlcIik7XG4gICAgICAgIGlmICh0aGlzLnNoYXBlKSB7XG4gICAgICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zcGFjZS5yZW1vdmVTaGFwZSh0aGlzLnNoYXBlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zcGFjZS5yZW1vdmVTdGF0aWNTaGFwZSh0aGlzLnNoYXBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc2hhcGUgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5ib2R5ID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlYWJsZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmJhbGwpIHtcbiAgICAgICAgICAgIHRoaXMuYmFsbC5icmVha2luZyA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gR3JpZDsiLCJ2YXIgQm9vc3RUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vQm9vc3RUeXBlXCIpO1xudmFyIFNoYXBlVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1NoYXBlVHlwZVwiKTtcbnZhciBJdGVtQ2F0ZWdvcnkgPSByZXF1aXJlKFwiLi4vZW51bS9JdGVtQ2F0ZWdvcnlcIik7XG5cbnZhciBLZXkgPSBjYy5TcHJpdGUuZXh0ZW5kKHtcblxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fc3VwZXIoXCIjaWNvbl9rZXkucG5nXCIpO1xuICAgIH1cblxuICAgIC8vIGluaXRCb2R5OiBmdW5jdGlvbiAoc3BhY2UsIHBvcykge1xuICAgIC8vICAgICB0aGlzLnNldFBvc2l0aW9uKHBvcyk7XG4gICAgLy8gICAgIHRoaXMuc3BhY2UgPSBzcGFjZTtcbiAgICAvL1xuICAgIC8vICAgICB2YXIgYm9keSA9IG5ldyBjcC5Cb2R5KEluZmluaXR5LCBJbmZpbml0eSk7XG4gICAgLy8gICAgIHZhciBzaGFwZSA9IG5ldyBjcC5Cb3hTaGFwZShib2R5LCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XG4gICAgLy8gICAgIHNoYXBlLnNldEVsYXN0aWNpdHkoMSk7XG4gICAgLy8gICAgIHNoYXBlLnNldEZyaWN0aW9uKDApO1xuICAgIC8vICAgICAvL3NoYXBlLmxheWVycyA9IDE7XG4gICAgLy8gICAgIHRoaXMuc3BhY2UuYWRkU3RhdGljU2hhcGUoc2hhcGUpO1xuICAgIC8vICAgICBzaGFwZS5zZXRDb2xsaXNpb25UeXBlKFNoYXBlVHlwZS5LRVkpO1xuICAgIC8vICAgICBib2R5LnNldFBvcyhwb3MpO1xuICAgIC8vICAgICB0aGlzLmJvZHkgPSBib2R5O1xuICAgIC8vICAgICBib2R5LnVzZXJEYXRhID0gdGhpcztcbiAgICAvLyAgICAgdGhpcy5zaGFwZSA9IHNoYXBlO1xuICAgIC8vICAgICB0aGlzLnNwYWNlLnJlaW5kZXhTaGFwZShzaGFwZSk7XG4gICAgLy8gICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAvLyAgICAgICAgIHNoYXBlLnNldEZpbHRlcih7XG4gICAgLy8gICAgICAgICAgICAgZ3JvdXA6IGNwLk5PX0dST1VQLFxuICAgIC8vICAgICAgICAgICAgIGNhdGVnb3JpZXM6IEl0ZW1DYXRlZ29yeS5LZXksXG4gICAgLy8gICAgICAgICAgICAgbWFzazogSXRlbUNhdGVnb3J5LkJhbGxcbiAgICAvLyAgICAgICAgIH0pO1xuICAgIC8vICAgICB9XG4gICAgLy8gfSxcbiAgICAvL1xuICAgIC8vIHJlbW92ZUJvZHk6IGZ1bmN0aW9uICgpIHtcbiAgICAvLyAgICAgLy9jb25zb2xlLmxvZyhcIkdyaWQgcmVtb3ZlQm9keVwiKTtcbiAgICAvLyAgICAgaWYgKHRoaXMuc2hhcGUpIHtcbiAgICAvLyAgICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAvLyAgICAgICAgICAgICB0aGlzLnNwYWNlLnJlbW92ZVNoYXBlKHRoaXMuc2hhcGUpO1xuICAgIC8vICAgICAgICAgfSBlbHNlIHtcbiAgICAvLyAgICAgICAgICAgICB0aGlzLnNwYWNlLnJlbW92ZVN0YXRpY1NoYXBlKHRoaXMuc2hhcGUpO1xuICAgIC8vICAgICAgICAgfVxuICAgIC8vICAgICAgICAgdGhpcy5zaGFwZSA9IG51bGw7XG4gICAgLy8gICAgICAgICB0aGlzLmJvZHkgPSBudWxsO1xuICAgIC8vICAgICB9XG4gICAgLy8gfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gS2V5OyIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDIwMTcvMTIvMi5cbiAqL1xuXG52YXIgT2JzdGFjbGUgPSBjYy5Ob2RlLmV4dGVuZCh7XG5cbiAgICBjdG9yOiBmdW5jdGlvbiAoY29sb3IsIHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgICAgdGhpcy5fc3VwZXIoY29sb3IsIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICB0aGlzLmlnbm9yZUFuY2hvciA9IGZhbHNlO1xuICAgICAgICB0aGlzLnNwcml0ZSA9IG5ldyBjYy5TcHJpdGUoXCIjZ3JpZC5wbmdcIik7XG4gICAgICAgIHRoaXMuYWRkQ2hpbGQodGhpcy5zcHJpdGUpO1xuICAgICAgICB0aGlzLnJlc2V0KGNvbG9yLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICB9LFxuXG4gICAgcmVzZXQ6IGZ1bmN0aW9uIChjb2xvciwgd2lkdGgsIGhlaWdodCkge1xuICAgICAgICB0aGlzLnNwcml0ZS5zY2FsZVggPSB3aWR0aCAvIHRoaXMuc3ByaXRlLndpZHRoO1xuICAgICAgICB0aGlzLnNwcml0ZS5zY2FsZVkgPSBoZWlnaHQgLyB0aGlzLnNwcml0ZS5oZWlnaHQ7XG4gICAgICAgIHRoaXMud2lkdGggPSB3aWR0aDtcbiAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldENvbG9yKGNvbG9yKTtcbiAgICB9LFxuXG4gICAgc2V0Q29sb3I6IGZ1bmN0aW9uIChjb2xvcikge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRDb2xvcihjb2xvcik7XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gT2JzdGFjbGU7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IG95ZSBvbiAxNS01LTE3LlxuICovXG52YXIgQm9vc3RUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vQm9vc3RUeXBlXCIpO1xudmFyIENoYWxsZW5nZURhdGEgPSByZXF1aXJlKFwiLi4vZW50aXR5L0NoYWxsZW5nZURhdGFcIik7XG5cbnZhciBQbGF5ZXJJbmZvID0gZnVuY3Rpb24oKXtcbiAgICB0aGlzLnBsYXllcklkID0gXCJcIjtcbiAgICB0aGlzLmJlc3RTY29yZSA9IDA7XG4gICAgdGhpcy5yZW1vdmVkQWRzID0gZmFsc2U7XG4gICAgdGhpcy5sZXZlbCA9IDA7XG4gICAgdGhpcy5wcm9ncmVzcyA9IDA7XG4gICAgdGhpcy5sZXZlbE1hcCA9IG51bGw7XG4gICAgdGhpcy5yYXRlZCA9IGZhbHNlO1xuXG4gICAgdGhpcy5ib29zdE1hcCA9IG51bGw7XG4gICAgdGhpcy5jb2lucyA9IDA7XG4gICAgdGhpcy5ndWlkZWQgPSBmYWxzZTtcblxuICAgIHRoaXMuaGFyZExldmVsID0gMDtcbiAgICB0aGlzLmxhc3RXaGVlbFRpbWUgPSAwO1xuICAgIHRoaXMuY3VycmVudFNraW5JZCA9IDA7XG4gICAgdGhpcy5pbnRlcnN0aXRpYWxBZENvdW50ID0gMDtcbiAgICB0aGlzLnJld2FyZGVkQWRDb3VudCA9IDA7XG5cbiAgICB0aGlzLmNyZWF0ZUR0ID0gMDtcblxuICAgIHRoaXMubGV2ZWxzTWFwID0ge307XG5cbiAgICB0aGlzLmxhc3RMb2dpbkRheSA9IDA7XG4gICAgdGhpcy5jb25zZWN1dGl2ZUxvZ2luRGF5cyA9IDE7XG4gICAgdGhpcy5sYXN0Q2xhaW1EYWlseUJvbnVzRGF5ID0gMDtcbiAgICB0aGlzLm5leHREYXlUaXBzID0gZmFsc2U7XG5cbiAgICB0aGlzLnNraW5NYXAgPSB7fTtcbiAgICB0aGlzLnNraW5BZHNDb3VudE1hcCA9IHt9O1xuICAgIHRoaXMuc3BlY2lhbE9mZmVyTWFwID0ge307XG5cbiAgICB0aGlzLmRpYW1vbmRzID0gMDtcblxuICAgIHRoaXMudGFza01hcCA9IHt9O1xuICAgIHRoaXMuc2tpbkFkanVzdGVkID0gZmFsc2U7XG4gICAgdGhpcy5sYXN0U2hvd1JhdGVUaW1lID0gMDtcblxuICAgIHRoaXMucmV3YXJkQWRDb3VudFBlckRheSA9IHt9O1xuICAgIHRoaXMucmV3YXJkQWRSZWNvcmREYXkgPSAwO1xuICAgIHRoaXMuaWFwQ291bnQgPSAwO1xuICAgIHRoaXMuZmFpbENvdW50TWFwID0ge307XG4gICAgdGhpcy5sYXN0TG9naW5UaW1lID0gMDtcbiAgICB0aGlzLmhhc0FpbUl0ZW0gPSBmYWxzZTtcbiAgICB0aGlzLmxhc3REYWlseURpYW1vbmRUaW1lID0gMDtcbiAgICB0aGlzLmlzQWltVmVyc2lvbiA9IGZhbHNlO1xuXG4gICAgdGhpcy5jaGFsbGVuZ2VVbmxvY2tUaXBzID0gZmFsc2U7XG4gICAgdGhpcy5jaGFsbGVuZ2VFbnRlcmVkID0gZmFsc2U7XG5cbiAgICB0aGlzLmNoYWxsZW5nZURhdGFNYXAgPSB7fTtcblxuICAgIHRoaXMud2hlZWxMb2NrSWRzID0gW107XG4gICAgdGhpcy51bmxvY2tlZFN1cGVyQm9hcmQgPSBmYWxzZTtcbiAgICB0aGlzLmJvYXJkTWFwID0ge307XG4gICAgdGhpcy5jdXJyZW50Qm9hcmRJZCA9IDA7XG4gICAgdGhpcy5ib2FyZEFkc0NvdW50TWFwID0ge307XG4gICAgdGhpcy5jdXJyZW50S2V5Q291bnQgPSAwO1xuXG4gICAgdGhpcy5hY3Rpdml0eVRhc2tTY29yZU1hcCA9IHt9O1xuICAgIHRoaXMuYWN0aXZpdHlUYXNrQ2xhaW1NYXAgPSB7fTtcblxuICAgIHRoaXMuYWN0aXZpdHlTdGFydFRpbWUgPSAwO1xuXG4gICAgdGhpcy5kYWlseVRhc2tDb3VudE1hcCA9IHt9O1xuICAgIHRoaXMuZGFpbHlUYXNrQ2xhaW1NYXAgPSB7fTtcbiAgICB0aGlzLmN1cnJlbnREYXkgPSAwO1xuICAgIHRoaXMuZGFpbHlUYXNrUG9wZWQgPSBmYWxzZTtcblxuICAgIHRoaXMuYWJUZXN0R3JvdXAgPSB7fTtcbiAgICB0aGlzLnNraW5QZXJjZW50ID0gMDtcbiAgICB0aGlzLndhaXRTa2luSWQgPSAwO1xuXG4gICAgdGhpcy5uZXdIYXJkTGV2ZWwgPSAwO1xufTtcblxuUGxheWVySW5mby5wcm90b3R5cGUudW5tYXJzaGFsbCA9IGZ1bmN0aW9uIChqc29uKSB7XG4gICAgdGhpcy5wbGF5ZXJJZCA9IGpzb25bXCJwbGF5ZXJJZFwiXTtcbiAgICB0aGlzLmJlc3RTY29yZSA9IGpzb25bXCJiZXN0U2NvcmVcIl0gfHwgMDtcbiAgICB0aGlzLnJlbW92ZWRBZHMgPSBqc29uW1wicmVtb3ZlZEFkc1wiXSB8fCBmYWxzZTtcbiAgICB0aGlzLmxldmVsID0ganNvbltcImxldmVsXCJdIHx8IDE7XG4gICAgdGhpcy5wcm9ncmVzcyA9IGpzb25bXCJwcm9ncmVzc1wiXSB8fCAwO1xuICAgIHRoaXMubGV2ZWxNYXAgPSBqc29uW1wibGV2ZWxNYXBcIl0gfHwge307XG4gICAgdGhpcy5yYXRlZCA9IGpzb25bXCJyYXRlZFwiXSB8fCBmYWxzZTtcbiAgICB0aGlzLmNvaW5zID0ganNvbltcImNvaW5zXCJdIHx8IDA7XG4gICAgdGhpcy5ndWlkZWQgPSBqc29uW1wiZ3VpZGVkXCJdIHx8IGZhbHNlO1xuICAgIHRoaXMuYm9vc3RNYXAgPSBqc29uW1wiYm9vc3RNYXBcIl0gfHwge307XG4gICAgdGhpcy5oYXJkTGV2ZWwgPSBqc29uW1wiaGFyZExldmVsXCJdIHx8IDE7XG4gICAgdGhpcy5sYXN0V2hlZWxUaW1lID0ganNvbltcImxhc3RXaGVlbFRpbWVcIl0gfHwgMDtcbiAgICB0aGlzLmN1cnJlbnRTa2luSWQgPSBqc29uW1wiY3VycmVudFNraW5JZFwiXSB8fCAwO1xuICAgIHRoaXMuaW50ZXJzdGl0aWFsQWRDb3VudCA9IGpzb25bXCJpbnRlcnN0aXRpYWxBZENvdW50XCJdIHx8IDA7XG4gICAgdGhpcy5yZXdhcmRlZEFkQ291bnQgPSBqc29uW1wicmV3YXJkZWRBZENvdW50XCJdIHx8IDA7XG4gICAgdGhpcy5jcmVhdGVEdCA9IGpzb25bXCJjcmVhdGVEdFwiXSB8fCBEYXRlLm5vdygpO1xuICAgIHRoaXMubGV2ZWxzTWFwID0ganNvbltcImxldmVsc01hcFwiXSB8fCB7fTtcbiAgICB0aGlzLmxhc3RMb2dpbkRheSA9IGpzb25bXCJsYXN0TG9naW5EYXlcIl0gfHwgMDtcbiAgICB0aGlzLmNvbnNlY3V0aXZlTG9naW5EYXlzID0ganNvbltcImNvbnNlY3V0aXZlTG9naW5EYXlzXCJdIHx8IDE7XG4gICAgdGhpcy5sYXN0Q2xhaW1EYWlseUJvbnVzRGF5ID0ganNvbltcImxhc3RDbGFpbURhaWx5Qm9udXNEYXlcIl0gfHwgMDtcbiAgICB0aGlzLm5leHREYXlUaXBzID0ganNvbltcIm5leHREYXlUaXBzXCJdIHx8IGZhbHNlO1xuICAgIHRoaXMuc2tpbk1hcCA9IGpzb25bXCJza2luTWFwXCJdIHx8IHtcbiAgICAgICAgXCIwXCI6IHRydWVcbiAgICB9O1xuICAgIHRoaXMuc2tpbkFkc0NvdW50TWFwID0ganNvbltcInNraW5BZHNDb3VudE1hcFwiXSB8fCB7fTtcbiAgICB0aGlzLnNwZWNpYWxPZmZlck1hcCA9IGpzb25bXCJzcGVjaWFsT2ZmZXJNYXBcIl0gfHwge307XG4gICAgdGhpcy5kaWFtb25kcyA9IGpzb25bXCJkaWFtb25kc1wiXSB8fCA1MDtcbiAgICB0aGlzLnRhc2tNYXAgPSBqc29uW1widGFza01hcFwiXSB8fCB7fTtcbiAgICB0aGlzLnNraW5BZGp1c3RlZCA9IGpzb25bXCJza2luQWRqdXN0ZWRcIl0gfHwgZmFsc2U7XG4gICAgdGhpcy5sYXN0U2hvd1JhdGVUaW1lID0ganNvbltcImxhc3RTaG93UmF0ZVRpbWVcIl0gfHwgMDtcbiAgICB0aGlzLnJld2FyZEFkQ291bnRQZXJEYXkgPSBqc29uW1wicmV3YXJkQWRDb3VudFBlckRheVwiXSB8fCAwO1xuICAgIHRoaXMucmV3YXJkQWRSZWNvcmREYXkgPSBqc29uW1wicmV3YXJkQWRSZWNvcmREYXlcIl0gfHwgMDtcbiAgICB0aGlzLmlhcENvdW50ID0ganNvbltcImlhcENvdW50XCJdIHx8IDA7XG4gICAgdGhpcy5mYWlsQ291bnRNYXAgPSBqc29uW1wiZmFpbENvdW50TWFwXCJdIHx8IHt9O1xuICAgIHRoaXMubGFzdExvZ2luVGltZSA9IGpzb25bXCJsYXN0TG9naW5UaW1lXCJdIHx8IERhdGUubm93KCk7XG4gICAgdGhpcy5oYXNBaW1JdGVtID0ganNvbltcImhhc0FpbUl0ZW1cIl0gfHwgZmFsc2U7XG4gICAgdGhpcy5sYXN0RGFpbHlEaWFtb25kVGltZSA9IGpzb25bXCJsYXN0RGFpbHlEaWFtb25kVGltZVwiXSB8fCAwO1xuICAgIHRoaXMuaXNBaW1WZXJzaW9uID0ganNvbltcImlzQWltVmVyc2lvblwiXSB8fCBmYWxzZTtcblxuICAgIHRoaXMuY2hhbGxlbmdlVW5sb2NrVGlwcyA9IGpzb25bXCJjaGFsbGVuZ2VVbmxvY2tUaXBzXCJdIHx8IGZhbHNlO1xuICAgIHRoaXMuY2hhbGxlbmdlRW50ZXJlZCA9IGpzb25bXCJjaGFsbGVuZ2VFbnRlcmVkXCJdIHx8IGZhbHNlO1xuXG4gICAgdGhpcy5jaGFsbGVuZ2VEYXRhTWFwID0ganNvbltcImNoYWxsZW5nZURhdGFNYXBcIl0gfHwge307XG4gICAgaWYgKGpzb25bXCJjaGFsbGVuZ2VMZXZlbFwiXSkge1xuICAgICAgICB2YXIgY2hhbGxlbmdlMURhdGEgPSBuZXcgQ2hhbGxlbmdlRGF0YSgpO1xuICAgICAgICBjaGFsbGVuZ2UxRGF0YS51bm1hcnNoYWwoanNvbik7XG4gICAgICAgIHRoaXMuY2hhbGxlbmdlRGF0YU1hcFtcIjFcIl0gPSBjaGFsbGVuZ2UxRGF0YTtcbiAgICB9XG4gICAgdGhpcy53aGVlbExvY2tJZHMgPSBqc29uW1wid2hlZWxMb2NrSWRzXCJdIHx8IFtdO1xuICAgIHRoaXMudW5sb2NrZWRTdXBlckJvYXJkID0ganNvbltcInVubG9ja2VkU3VwZXJCb2FyZFwiXSB8fCBmYWxzZTtcbiAgICB0aGlzLmJvYXJkTWFwID0ganNvbltcImJvYXJkTWFwXCJdIHx8IHtcbiAgICAgICAgXCIwXCI6IHRydWVcbiAgICB9O1xuICAgIHRoaXMuY3VycmVudEJvYXJkSWQgPSBqc29uW1wiY3VycmVudEJvYXJkSWRcIl0gfHwgMDtcbiAgICB0aGlzLmJvYXJkQWRzQ291bnRNYXAgPSBqc29uW1wiYm9hcmRBZHNDb3VudE1hcFwiXSB8fCB7fTtcbiAgICB0aGlzLmN1cnJlbnRLZXlDb3VudCA9IGpzb25bXCJjdXJyZW50S2V5Q291bnRcIl0gfHwgMDtcbiAgICB0aGlzLmFjdGl2aXR5VGFza1Njb3JlTWFwID0ganNvbltcImFjdGl2aXR5VGFza1Njb3JlTWFwXCJdIHx8IHt9O1xuICAgIHRoaXMuYWN0aXZpdHlUYXNrQ2xhaW1NYXAgPSBqc29uW1wiYWN0aXZpdHlUYXNrQ2xhaW1NYXBcIl0gfHwge307XG4gICAgdGhpcy5hY3Rpdml0eVN0YXJ0VGltZSA9IGpzb25bXCJhY3Rpdml0eVN0YXJ0VGltZVwiXSB8fCAwO1xuXG4gICAgdGhpcy5kYWlseVRhc2tDb3VudE1hcCA9IGpzb25bXCJkYWlseVRhc2tDb3VudE1hcFwiXSB8fCB7fTtcbiAgICB0aGlzLmRhaWx5VGFza0NsYWltTWFwID0ganNvbltcImRhaWx5VGFza0NsYWltTWFwXCJdIHx8IHt9O1xuICAgIHRoaXMuZGFpbHlUYXNrUG9wZWQgPSBqc29uW1wiZGFpbHlUYXNrUG9wZWRcIl0gfHwgZmFsc2U7XG4gICAgdGhpcy5jdXJyZW50RGF5ID0ganNvbltcImN1cnJlbnREYXlcIl0gfHwgZ2FtZS51dGlscy5nZXRDdXJyZW50RGF5KCk7XG4gICAgdGhpcy5hYlRlc3RHcm91cCA9IGpzb25bXCJhYlRlc3RHcm91cFwiXSB8fCB7fTtcbiAgICB0aGlzLnNraW5QZXJjZW50ID0ganNvbltcInNraW5QZXJjZW50XCJdIHx8IDA7XG4gICAgdGhpcy53YWl0U2tpbklkID0ganNvbltcIndhaXRTa2luSWRcIl0gfHwgMDtcbiAgICB0aGlzLm5ld0hhcmRMZXZlbCA9IGpzb25bXCJuZXdIYXJkTGV2ZWxcIl0gfHwgMDtcbn07XG5cblBsYXllckluZm8uY3JlYXRlRGVmYXVsdCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgcGxheWVySW5mbyA9IG5ldyBQbGF5ZXJJbmZvKCk7XG4gICAgcGxheWVySW5mby5oaW50c0NvdW50ID0gNTtcbiAgICBwbGF5ZXJJbmZvLmJlc3RTY29yZSA9IDA7XG4gICAgcGxheWVySW5mby5yZW1vdmVkQWRzID0gZmFsc2U7XG4gICAgcGxheWVySW5mby5sZXZlbCA9IDczMDtcbiAgICBwbGF5ZXJJbmZvLnByb2dyZXNzID0gMDtcbiAgICBwbGF5ZXJJbmZvLmxldmVsTWFwID0ge307XG4gICAgcGxheWVySW5mby5yYXRlZCA9IGZhbHNlO1xuICAgIHBsYXllckluZm8uY29pbnMgPSAwO1xuICAgIHBsYXllckluZm8uZ3VpZGVkID0gZmFsc2U7XG4gICAgcGxheWVySW5mby5ib29zdE1hcCA9IHt9O1xuICAgIHBsYXllckluZm8uYm9vc3RNYXBbQm9vc3RUeXBlLlNQTElUXSA9IDUwMDtcbiAgICBwbGF5ZXJJbmZvLmJvb3N0TWFwW0Jvb3N0VHlwZS5USFJFRV9CQUxMXSA9IDUwMDtcbiAgICBwbGF5ZXJJbmZvLmhhcmRMZXZlbCA9IDczMDtcbiAgICBwbGF5ZXJJbmZvLmxhc3RXaGVlbFRpbWUgPSAwO1xuICAgIHBsYXllckluZm8uY3VycmVudFNraW5JZCA9IDA7XG4gICAgcGxheWVySW5mby5pbnRlcnN0aXRpYWxBZENvdW50ID0gMDtcbiAgICBwbGF5ZXJJbmZvLnJld2FyZGVkQWRDb3VudCA9IDA7XG4gICAgcGxheWVySW5mby5jcmVhdGVEdCA9IERhdGUubm93KCk7XG4gICAgcGxheWVySW5mby5sZXZlbHNNYXAgPSB7fTtcbiAgICBwbGF5ZXJJbmZvLmRhaWx5Qm9udXNEdCA9IERhdGUubm93KCk7XG4gICAgcGxheWVySW5mby5sYXN0TG9naW5EYXkgPSAwO1xuICAgIHBsYXllckluZm8uY29uc2VjdXRpdmVMb2dpbkRheXMgPSAxO1xuICAgIHBsYXllckluZm8ubGFzdENsYWltRGFpbHlCb251c0RheSA9IDA7XG4gICAgcGxheWVySW5mby5uZXh0RGF5VGlwcyA9IGZhbHNlO1xuICAgIHBsYXllckluZm8uc2tpbk1hcCA9IHtcbiAgICAgICAgXCIwXCI6IHRydWVcbiAgICB9O1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDw9IDEwMDsgKytpKSB7XG4gICAgICAgIHBsYXllckluZm8uc2tpbk1hcFtpXSA9IHRydWU7XG4gICAgfVxuICAgIHBsYXllckluZm8uc2tpbkFkc0NvdW50TWFwID0ge307XG4gICAgcGxheWVySW5mby5zcGVjaWFsT2ZmZXJNYXAgPSB7fTtcbiAgICBwbGF5ZXJJbmZvLmRpYW1vbmRzID0gNTA7XG4gICAgcGxheWVySW5mby50YXNrTWFwID0ge307XG4gICAgcGxheWVySW5mby5za2luQWRqdXN0ZWQgPSBmYWxzZTtcbiAgICBwbGF5ZXJJbmZvLmxhc3RTaG93UmF0ZVRpbWUgPSAwO1xuICAgIHBsYXllckluZm8ucmV3YXJkQWRDb3VudFBlckRheSA9IDA7XG4gICAgcGxheWVySW5mby5yZXdhcmRBZFJlY29yZERheSA9IDA7XG4gICAgcGxheWVySW5mby5pYXBDb3VudCA9IDA7XG4gICAgcGxheWVySW5mby5mYWlsQ291bnRNYXAgPSB7fTtcbiAgICBwbGF5ZXJJbmZvLmxhc3RMb2dpblRpbWUgPSBEYXRlLm5vdygpO1xuICAgIHBsYXllckluZm8uaGFzQWltSXRlbSA9IGZhbHNlO1xuICAgIHBsYXllckluZm8ubGFzdERhaWx5RGlhbW9uZFRpbWUgPSAwO1xuICAgIHBsYXllckluZm8uaXNBaW1WZXJzaW9uID0gZmFsc2U7XG4gICAgLy8gcGxheWVySW5mby5jaGFsbGVuZ2VMZXZlbCA9IDE7XG4gICAgLy8gcGxheWVySW5mby5jaGFsbGVuZ2VNaWxlc3RvbmVDbGFpbUlkID0gMDtcbiAgICAvLyBwbGF5ZXJJbmZvLmNoYWxsZW5nZVJldml2ZUNvdW50ID0gMDtcbiAgICBwbGF5ZXJJbmZvLmNoYWxsZW5nZVVubG9ja1RpcHMgPSBmYWxzZTtcbiAgICAvLyBwbGF5ZXJJbmZvLmNoYWxsZW5nZUxldmVsTWFwID0ge307XG4gICAgLy8gcGxheWVySW5mby5jaGFsbGVuZ2VQbGF5aW5nID0gZmFsc2U7XG4gICAgcGxheWVySW5mby5jaGFsbGVuZ2VFbnRlcmVkID0gZmFsc2U7XG4gICAgLy8gcGxheWVySW5mby5jaGFsbGVuZ2UyRGF0YSA9IG5ldyBDaGFsbGVuZ2VEYXRhKCk7XG4gICAgcGxheWVySW5mby5jaGFsbGVuZ2VEYXRhTWFwID0ge307XG4gICAgcGxheWVySW5mby53aGVlbExvY2tJZHMgPSBbXTtcbiAgICBwbGF5ZXJJbmZvLnVubG9ja2VkU3VwZXJCb2FyZCA9IGZhbHNlO1xuICAgIHBsYXllckluZm8uYm9hcmRNYXAgPSB7XG4gICAgICAgIFwiMFwiOiB0cnVlXG4gICAgfTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8PSAxMDA7ICsraSkge1xuICAgICAgICBwbGF5ZXJJbmZvLmJvYXJkTWFwW2ldID0gdHJ1ZTtcbiAgICB9XG4gICAgcGxheWVySW5mby5jdXJyZW50Qm9hcmRJZCA9IDA7XG4gICAgcGxheWVySW5mby5ib2FyZEFkc0NvdW50TWFwID0ge307XG4gICAgcGxheWVySW5mby5jdXJyZW50S2V5Q291bnQgPSAwO1xuICAgIHBsYXllckluZm8uYWN0aXZpdHlUYXNrU2NvcmVNYXAgPSB7fTtcbiAgICBwbGF5ZXJJbmZvLmFjdGl2aXR5VGFza0NsYWltTWFwID0ge307XG4gICAgcGxheWVySW5mby5hY3Rpdml0eVN0YXJ0VGltZSA9IDA7XG4gICAgcGxheWVySW5mby5kYWlseVRhc2tDb3VudE1hcCA9IHt9O1xuICAgIHBsYXllckluZm8uZGFpbHlUYXNrQ2xhaW1NYXAgPSB7fTtcbiAgICBwbGF5ZXJJbmZvLmRhaWx5VGFza1BvcGVkID0gZmFsc2U7XG4gICAgcGxheWVySW5mby5jdXJyZW50RGF5ID0gZ2FtZS51dGlscy5nZXRDdXJyZW50RGF5KCk7XG4gICAgcGxheWVySW5mby5hYlRlc3RHcm91cCA9IHt9O1xuICAgIHBsYXllckluZm8uc2tpblBlcmNlbnQgPSAwO1xuICAgIHBsYXllckluZm8ud2FpdFNraW5JZCA9IDA7XG4gICAgcGxheWVySW5mby5uZXdIYXJkTGV2ZWwgPSA1NTtcbiAgICByZXR1cm4gcGxheWVySW5mbztcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUGxheWVySW5mbztcbiIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDIwMTcvMTIvMi5cbiAqL1xuXG52YXIgU2hhcGVUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vU2hhcGVUeXBlXCIpO1xudmFyIEl0ZW1DYXRlZ29yeSA9IHJlcXVpcmUoXCIuLi9lbnVtL0l0ZW1DYXRlZ29yeVwiKTtcblxudmFyIFdhbGwgPSBjYy5Ob2RlLmV4dGVuZCh7XG5cbiAgICBib2R5OiBudWxsLFxuICAgIHNoYXBlOiBudWxsLFxuICAgIGluaXRCb2R5OiBmdW5jdGlvbiAoc3BhY2UsIHBvcykge1xuICAgICAgICB0aGlzLnNldFBvc2l0aW9uKHBvcyk7XG4gICAgICAgIHRoaXMuc3BhY2UgPSBzcGFjZTtcblxuICAgICAgICB2YXIgYm9keSA9IG5ldyBjcC5Cb2R5KEluZmluaXR5LCBJbmZpbml0eSk7XG4gICAgICAgIHZhciBzaGFwZSA9IG5ldyBjcC5Cb3hTaGFwZShib2R5LCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XG4gICAgICAgIHNoYXBlLnNldEVsYXN0aWNpdHkoMSk7XG4gICAgICAgIHNoYXBlLnNldEZyaWN0aW9uKDApO1xuICAgICAgICAvL3NoYXBlLmxheWVycyA9IDE7XG4gICAgICAgIHRoaXMuc3BhY2UuYWRkU2hhcGUoc2hhcGUpO1xuICAgICAgICBzaGFwZS5zZXRDb2xsaXNpb25UeXBlKFNoYXBlVHlwZS5XQUxMKTtcbiAgICAgICAgYm9keS5zZXRQb3MoY2MucEFkZChwb3MsIGNjLnAodGhpcy53aWR0aCAqIDAuNSwgdGhpcy5oZWlnaHQgKiAwLjUpKSk7XG4gICAgICAgIGJvZHkudXNlckRhdGEgPSB0aGlzO1xuICAgICAgICB0aGlzLnNwYWNlLnJlaW5kZXhTaGFwZShzaGFwZSk7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIHNoYXBlLnNldEZpbHRlcih7XG4gICAgICAgICAgICAgICAgZ3JvdXA6IGNwLk5PX0dST1VQLFxuICAgICAgICAgICAgICAgIGNhdGVnb3JpZXM6IEl0ZW1DYXRlZ29yeS5PYnN0YWNsZSxcbiAgICAgICAgICAgICAgICBtYXNrOiBJdGVtQ2F0ZWdvcnkuQmFsbFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5ib2R5ID0gYm9keTtcbiAgICAgICAgdGhpcy5zaGFwZSA9IHNoYXBlO1xuICAgIH0sXG5cbiAgICByZW1vdmVCb2R5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vY29uc29sZS5sb2coXCJCYWxsIHJlbW92ZUJvZHlcIik7XG4gICAgICAgIGlmICh0aGlzLmJvZHkpIHtcbiAgICAgICAgICAgIHRoaXMuc3BhY2UucmVtb3ZlU2hhcGUodGhpcy5zaGFwZSk7XG4gICAgICAgICAgICB0aGlzLmJvZHkgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5zaGFwZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBXYWxsOyIsInZhciBBQlRlc3RUeXBlID0ge1xuICAgIC8vIFBvcHVwOiAzLFxuICAgIC8vIERhaWx5VGFzazogMTQsXG4gICAgLy8gTGlmZTogNSxcbiAgICAvLyBBZHNJbnRlcnZhbDogNixcbiAgICAvLyBQcm9iYWJpbGl0eTogMTcsXG4gICAgLy8gQWRzUGxhY2VtZW50OiAxOCxcbiAgICBMZXZlbDogMjksXG4gICAgLy8gUmVzdWx0OiAxMCxcbiAgICAvLyBDaGFsbGVuZ2U6IDExLFxuICAgIE5VTTogOFxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBBQlRlc3RUeXBlOyIsInZhciBBY3Rpdml0eVRhc2tUeXBlID0ge1xuICAgIExldmVsOiAxLFxuICAgIENoYWxsZW5nZUxldmVsOiAyLFxuICAgIE9wZW5Cb3g6IDMsXG4gICAgV2hlZWw6IDQsXG4gICAgVXNlQm9vc3Q6IDUsXG4gICAgQ2hlc3RPcGVuOiA2XG59O1xuXG5BY3Rpdml0eVRhc2tUeXBlLmdldE5hbWUgPSBmdW5jdGlvbiAodHlwZSkge1xuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICBjYXNlIEFjdGl2aXR5VGFza1R5cGUuTGV2ZWw6XG4gICAgICAgICAgICByZXR1cm4gXCJMZXZlbFwiO1xuICAgICAgICBjYXNlIEFjdGl2aXR5VGFza1R5cGUuQ2hhbGxlbmdlTGV2ZWw6XG4gICAgICAgICAgICByZXR1cm4gXCJDaGFsbGVuZ2VMZXZlbFwiO1xuICAgICAgICBjYXNlIEFjdGl2aXR5VGFza1R5cGUuT3BlbkJveDpcbiAgICAgICAgICAgIHJldHVybiBcIk9wZW5Cb3hcIjtcbiAgICAgICAgY2FzZSBBY3Rpdml0eVRhc2tUeXBlLlVzZUJvb3N0OlxuICAgICAgICAgICAgcmV0dXJuIFwiVXNlQm9vc3RcIjtcbiAgICAgICAgY2FzZSBBY3Rpdml0eVRhc2tUeXBlLldoZWVsOlxuICAgICAgICAgICAgcmV0dXJuIFwiV2hlZWxcIjtcbiAgICAgICAgY2FzZSBBY3Rpdml0eVRhc2tUeXBlLkNoZXN0T3BlbjpcbiAgICAgICAgICAgIHJldHVybiBcIkNoZXN0T3BlblwiO1xuICAgIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQWN0aXZpdHlUYXNrVHlwZTsiLCJcbnZhciBCb29zdFR5cGUgPSB7XG4gICAgTElGRTogMSxcbiAgICBUSFJFRV9CQUxMOiAyLFxuICAgIFNQTElUOiAzLFxuICAgIEdJRlQ6IDQsXG4gICAgU0tJTjogNSxcbiAgICBESUFNT05EOiA2LFxuICAgIEJPTUI6IDcsXG4gICAgQUlNX0lURU06IDgsXG4gICAgU1VQRVJfQk9BUkQ6IDksXG4gICAgQk9BUkRfU0tJTjogMTAsXG4gICAgQ0hSSVNUTUFTX1NLSU46IDExLFxuICAgIE9QRU5fQk9YOiAxMixcbiAgICBOVU06IDEyXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJvb3N0VHlwZTsiLCJcbnZhciBDaGFsbGVuZ2VJZCA9IHtcbiAgICBOb3JtYWw6IDEsXG4gICAgQm9tYjogMixcbiAgICBUaW1lTGltaXQ6IDMsXG4gICAgTGVzc0dyaWQ6IDQsXG4gICAgTGFzZXI6IDVcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQ2hhbGxlbmdlSWQ7IiwiXG52YXIgRGFpbHlUYXNrUG9zID0ge1xuICAgIE1lbnU6IDEsXG4gICAgUGFzc0NuOiAyLFxuICAgIFBhc3NFbjogM1xufTtcblxuRGFpbHlUYXNrUG9zLmdldE5hbWUgPSBmdW5jdGlvbiAocG9zKSB7XG4gICAgc3dpdGNoIChwb3MpIHtcbiAgICAgICAgY2FzZSBEYWlseVRhc2tQb3MuTWVudTpcbiAgICAgICAgICAgIHJldHVybiBcIk1lbnVcIjtcbiAgICAgICAgY2FzZSBEYWlseVRhc2tQb3MuUGFzc0VuOlxuICAgICAgICAgICAgcmV0dXJuIFwiUGFzc1wiO1xuICAgICAgICBjYXNlIERhaWx5VGFza1Bvcy5QYXNzQ246XG4gICAgICAgICAgICByZXR1cm4gXCJQYXNzXCI7XG4gICAgfVxuICAgIHJldHVybiBcIk5vbmVcIjtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBEYWlseVRhc2tQb3M7IiwidmFyIEZhaWxSZWFzb24gPSB7XG4gICAgVGltZW91dDogMSxcbiAgICBCb21iOiAyLFxuICAgIE5vcm1hbDogMyxcbiAgICBMYXNlcjogNFxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBGYWlsUmVhc29uOyIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDIwMTcvNS83LlxuICovXG5cbnZhciBHYW1lTW9kZSA9IHtcbiAgICBHQU1FX01PREVfRU5ETEVTUzogMCxcbiAgICBHQU1FX01PREVfTEVWRUw6IDFcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gR2FtZU1vZGU7IiwiXG52YXIgR3JpZFR5cGUgPSB7XG4gICAgT0JTVEFDTEU6IDAsXG4gICAgQlJJQ0s6IDEsXG4gICAgQkFMTDogMixcbiAgICBCT0FSRDogM1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBHcmlkVHlwZTsiLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAyMDE5LzIvMjVcbiAqKi9cblxudmFyIEl0ZW1DYXRlZ29yeSA9IHtcbiAgICBCYWxsOiAxIDw8IDAsXG4gICAgT2JzdGFjbGU6IDEgPDwgMSxcbiAgICBXYWxsOiAxIDw8IDIsXG4gICAgS2V5OiAxIDw8IDNcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gSXRlbUNhdGVnb3J5OyIsIi8qKlxuICogQ3JlYXRlZCBieSBxaW5uaW5nIG9uIDIwMTcvMy8yNS5cbiAqL1xuXG52YXIgTG9ja1N0YXR1cyA9IHtcbiAgICBMT0NLX1NUQVRVU19MT0NLOiAwLFxuICAgIExPQ0tfU1RBVFVTX1VOTE9DSzogMSxcbiAgICBMT0NLX1NUQVRVU19ET0lORzogMlxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBMb2NrU3RhdHVzOyIsIlxudmFyIFJhbmtUeXBlID0ge1xuICAgIEZyaWVuZHM6IDAsXG4gICAgR3JvdXA6IDEsXG4gICAgR2xvYmFsOjJcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUmFua1R5cGU7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMjAxOC8xLzEuXG4gKi9cblxuXG52YXIgU2NlbmVUeXBlID0ge1xuICAgIE5PTkU6IC0xLFxuICAgIExPQURJTkc6IDAsXG4gICAgTUVOVTogMSxcbiAgICBQQUNLQUdFOiAyLFxuICAgIExFVkVMOiAzLFxuICAgIEdBTUU6IDQsXG4gICAgQ0hBTExFTkdFOiA1LFxuICAgIENIQUxMRU5HRV9MSVNUOiA2XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNjZW5lVHlwZTsiLCJcbnZhciBTaGFwZVR5cGUgPSB7XG4gICAgQkFMTDogMSxcbiAgICBCUklDSzogMixcbiAgICBCT0FSRDogMyxcbiAgICBXQUxMOiA0LFxuICAgIEtFWTogNVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBTaGFwZVR5cGU7IiwiXG52YXIgU2tpblJld2FyZFR5cGUgPSB7XG4gICAgTm9uZTogMCxcbiAgICBMZXZlbENvdW50OiAxLFxuICAgIFdhdGNoQWRDb3VudDogMixcbiAgICBXYXRjaFJld2FyZEFkQ291bnQ6IDMsXG4gICAgQ2xhaW1lZDogNCxcbiAgICBQdXJjaGFzZTogNVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBTa2luUmV3YXJkVHlwZTsiLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAyMDE5LzIvMjFcbiAqKi9cblxudmFyIFNraW5UeXBlID0ge1xuICAgIFdhdGNoQWRzOiAxLFxuICAgIERpYW1vbmRzOiAyLFxuICAgIENoYWxsZW5nZTogMyxcbiAgICBLZXlBY3Rpdml0eTogNCxcbiAgICBDaHJpc3RtYXM6IDVcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gU2tpblR5cGU7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMjAxNy8xMi8xNi5cbiAqL1xuXG52YXIgU3RvcmVUeXBlID0ge1xuICAgIEZSRUU6IDEsXG4gICAgTkVXXzM6IDIsXG4gICAgU1BMSVQ6IDMsXG4gICAgUkVNT1ZFX0FEUzogNCxcbiAgICBSRVNUT1JFOiA1LFxuICAgIEZJUlNUX1BVUkNIQVNFOiA2LFxuICAgIE5FV19BTkRfU1BMSVQ6IDcsXG4gICAgRElBTU9ORDogOCxcbiAgICBTS0lOOiA5LFxuICAgIEFJTV9JVEVNOiAxMCxcbiAgICBCT0FSRF9TS0lOOiAxMVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBTdG9yZVR5cGU7IiwiXG52YXIgV2hlZWxUeXBlID0ge1xuICAgIERhaWx5Qm9udXM6IDAsXG4gICAgQm94OiAxXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFdoZWVsVHlwZTsiLCIvKipcbiAqIENyZWF0ZWQgYnkgb3llIG9uIDE1LzExLzIxLlxuICovXG5cbnZhciBFdmVudHNOYW1lID0ge1xuICAgIEVWRU5UX05BTUVfR0FNRV9TVEFSVDogXCJldmVudF9uYW1lX3N0YXJ0XCIsXG4gICAgRVZFTlRfTkFNRV9HQU1FX09WRVI6IFwiZXZlbnRfbmFtZV9nYW1lX292ZXJcIixcbiAgICBFVkVOVF9OQU1FX1VQREFURV9TQ09SRTogXCJldmVudF9uYW1lX3VwZGF0ZV9zY29yZVwiLFxuICAgIEVWRU5UX05BTUVfVVBEQVRFX0xFRlRfQlVMTEVUOiBcImV2ZW50X25hbWVfdXBkYXRlX2xlZnRfYnVsbGV0XCIsXG4gICAgRVZFTlRfTkFNRV9VUERBVEVfQkVTVF9TQ09SRTogXCJldmVudF9uYW1lX3VwZGF0ZV9iZXN0X3Njb3JlXCIsXG4gICAgRVZFTlRfTkFNRV9VUERBVEVfQVVESU86IFwiZXZlbnRfbmFtZV91cGRhdGVfYXVkaW9cIixcbiAgICBVUERBVEVfTEVWRUw6IFwidXBkYXRlX2xldmVsXCIsXG4gICAgQ09JTlNfVVBEQVRFOiBcImNvaW5zX3VwZGF0ZVwiLFxuICAgIFJFRlJFU0hfQk9PU1Q6IFwicmVmcmVzaF9ib29zdFwiLFxuICAgIFVQREFURV9TS0lOOiBcInVwZGF0ZV9za2luXCIsXG4gICAgVVBEQVRFX1NQRUNJQUxfT0ZGRVI6IFwidXBkYXRlX3NwZWNpYWxfb2ZmZXJcIixcbiAgICBQVVJDSEFTRV9FTkQ6IFwicHVyY2hhc2VfZW5kXCIsXG4gICAgRElBTE9HX1BPUEVEOiBcImRpYWxvZ19wb3BlZFwiLFxuICAgIERJQUxPR19DTE9TRUQ6IFwiZGlhbG9nX2Nsb3NlZFwiLFxuICAgIERJQU1PTkRTX1VQREFURTogXCJkaWFtb25kc191cGRhdGVcIixcbiAgICBUQVNLX1VQREFURTogXCJ0YXNrX3VwZGF0ZVwiLFxuICAgIFJFV0FSREVEX1ZJREVPX0NPVU5UOiBcInJld2FyZGVkX3ZpZGVvX2NvdW50XCIsXG4gICAgVVBEQVRFX0FJTV9JVEVNOiBcInVwZGF0ZV9haW1faXRlbVwiLFxuICAgIFNIT1dfQUlNX0dVSURFOiBcInNob3dfYWltX2d1aWRlXCIsXG4gICAgUkVXQVJEX1JFTU9WRV9BRDogXCJyZXdhcmRfcmVtb3ZlX2FkXCIsXG4gICAgVVBEQVRFX0JPQVJEOiBcInVwZGF0ZV9ib2FyZFwiLFxuICAgIE9QRU5fS0VZX0JPWDogXCJvcGVuX2tleV9ib3hcIixcbiAgICBVUERBVEVfQk9BUkRfU0tJTl9JVEVNOiBcInVwZGF0ZV9ib2FyZF9za2luX2l0ZW1cIixcbiAgICBVUERBVEVfQUNUSVZJVFlfVEFTS19TQ09SRTogXCJ1cGRhdGVfYWN0aXZpdHlfdGFza19zY29yZVwiLFxuICAgIENMT1NFX0FDVElWSVRZX1RBU0s6IFwiY2xvc2VfYWN0aXZpdHlfdGFza1wiXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEV2ZW50c05hbWU7IiwidmFyIENvbmZpZ01hbiA9IHJlcXVpcmUoXCIuLi9jb25maWcvQ29uZmlnTWFuXCIpO1xudmFyIEJvb3N0VHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL0Jvb3N0VHlwZVwiKTtcbnZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcbnZhciBTa2luVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1NraW5UeXBlXCIpO1xudmFyIEV2ZW50c05hbWUgPSByZXF1aXJlKFwiLi4vZXZlbnRzL0V2ZW50c05hbWVcIik7XG5cbnZhciBBY3Rpdml0eU1hbiA9IGNjLkNsYXNzLmV4dGVuZCh7XG5cbiAgICBhZGRBY3Rpdml0eVRhc2tDb3VudDogZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzT3BlbigpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gdmFyIGNvbmZpZyA9IENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldEFjdGl2aXR5VGFza0NvbmZpZyh0eXBlKTtcbiAgICAgICAgLy8gdmFyIGxhc3RTY29yZSA9IGdhbWUucGxheWVyTWFuLmdldEFjdGl2aXR5VGFza1Njb3JlKHR5cGUpO1xuICAgICAgICAvLyB2YXIgbmV3U2NvcmUgPSBsYXN0U2NvcmUgKyBjb25maWcuc2NvcmU7XG4gICAgICAgIC8vIGlmIChuZXdTY29yZSA+IGNvbmZpZy5saW1pdCkge1xuICAgICAgICAvLyAgICAgbmV3U2NvcmUgPSBjb25maWcubGltaXQ7XG4gICAgICAgIC8vIH1cbiAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiRGFpbHlUYXNrQ291bnRcIiwge1widHlwZVwiOiBnYW1lLmFjdGl2aXR5VGFza1R5cGUuZ2V0TmFtZSh0eXBlKX0pO1xuXG4gICAgICAgIC8vIGdhbWUucGxheWVyTWFuLnNldEFjdGl2aXR5VGFza1Njb3JlKHR5cGUsIG5ld1Njb3JlKTtcbiAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uYWRkQWN0aXZpdHlUYXNrQ291bnQodHlwZSk7XG5cbiAgICAgICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChFdmVudHNOYW1lLlVQREFURV9BQ1RJVklUWV9UQVNLX1NDT1JFKTtcbiAgICB9LFxuXG4gICAgZ2V0VG90YWxBY3Rpdml0eVRhc2tQZXJjZW50OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBNYXRoLm1pbigxLCAodGhpcy5nZXRUb3RhbEFjdGl2aXR5VGFza0NvdW50KCkgLyB0aGlzLmdldFRvdGFsQWN0aXZpdHlUYXNrTGltaXRDb3VudCgpKSk7XG4gICAgfSxcblxuICAgIGdldFRvdGFsQWN0aXZpdHlUYXNrQ291bnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGFjdGl2aXR5VGFza0xpc3QgPSBDb25maWdNYW4uZ2V0SW5zdGFuY2UoKS5nZXRBY3Rpdml0eVRhc2tMaXN0KCk7XG4gICAgICAgIHZhciBjdXJyZW50U2NvcmUgPSAwO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFjdGl2aXR5VGFza0xpc3QubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciBjb25maWcgPSBhY3Rpdml0eVRhc2tMaXN0W2ldO1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRDb3VudCA9IGdhbWUuYWN0aXZpdHlNYW4uZ2V0QWN0aXZpdHlUYXNrQ291bnQoY29uZmlnLnR5cGUpO1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRDb3VudCA+PSBjb25maWcubGltaXQpIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50U2NvcmUrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY3VycmVudFNjb3JlO1xuICAgIH0sXG5cbiAgICBnZXRBY3Rpdml0eVRhc2tDb3VudDogZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgICAgaWYgKHR5cGUgPT09IGdhbWUuYWN0aXZpdHlUYXNrVHlwZS5DaGFsbGVuZ2VMZXZlbCkge1xuICAgICAgICAgICAgaWYgKGdhbWUuY2hhbGxlbmdlTWFuLmlzQWxsQ2hhbGxlbmdlRmluaXNoZWQoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBnYW1lLnBsYXllck1hbi5nZXRBY3Rpdml0eVRhc2tDb3VudCh0eXBlKTtcbiAgICB9LFxuXG4gICAgZ2V0VG90YWxBY3Rpdml0eVRhc2tMaW1pdENvdW50OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjb25maWdzID0gQ29uZmlnTWFuLmdldEluc3RhbmNlKCkuZ2V0QWN0aXZpdHlUYXNrUmV3YXJkcygpO1xuICAgICAgICByZXR1cm4gY29uZmlnc1tjb25maWdzLmxlbmd0aCAtIDFdLnNjb3JlO1xuICAgIH0sXG5cbiAgICBnZXRBY3Rpdml0eUxlZnRUaW1lOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpO1xuICAgICAgICByZXR1cm4gKDI0ICogMzYwMCAtIG5vdy5nZXRIb3VycygpICogMzYwMCAtIG5vdy5nZXRNaW51dGVzKCkgKiA2MCAtIG5vdy5nZXRTZWNvbmRzKCkpO1xuICAgIH0sXG5cbiAgICBpc0FjdGl2aXR5VGFza0NvbXBsZXRlZDogZnVuY3Rpb24gKGFjdGl2aXR5UmV3YXJkQ2ZnKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFRvdGFsQWN0aXZpdHlUYXNrQ291bnQoKSA+PSBhY3Rpdml0eVJld2FyZENmZy5zY29yZTtcbiAgICB9LFxuXG4gICAgY2xhaW1BY3Rpdml0eVRhc2tSZXdhcmQ6IGZ1bmN0aW9uIChhY3Rpdml0eVRhc2tSZXdhcmQpIHtcbiAgICAgICAgc3dpdGNoIChhY3Rpdml0eVRhc2tSZXdhcmQudHlwZSkge1xuICAgICAgICAgICAgY2FzZSBCb29zdFR5cGUuRElBTU9ORDpcbiAgICAgICAgICAgICAgICBTdG9yZUhlbHBlci5nZXRJbnN0YW5jZSgpLnBvcHVwQWRkRGlhbW9uZHNEbGcoYWN0aXZpdHlUYXNrUmV3YXJkLmNvdW50LCBcImFjdGl2aXR5X3Rhc2tfcmV3YXJkXCIsIG51bGwpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBCb29zdFR5cGUuU0tJTjpcbiAgICAgICAgICAgICAgICB2YXIgc2tpbkNmZyA9IGdhbWUuZ2FtZU1hbi5nZXRXaGVlbFJhbmRvbVNraW4oKTtcbiAgICAgICAgICAgICAgICBpZiAoc2tpbkNmZyAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBTdG9yZUhlbHBlci5nZXRJbnN0YW5jZSgpLmNsYWltU2tpblJld2FyZChza2luQ2ZnLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEJvb3N0VHlwZS5DSFJJU1RNQVNfU0tJTjpcbiAgICAgICAgICAgICAgICB2YXIgc2tpbkNmZ3MgPSBDb25maWdNYW4uZ2V0SW5zdGFuY2UoKS5nZXRTa2luTGlzdEJ5VHlwZShTa2luVHlwZS5DaHJpc3RtYXMpO1xuICAgICAgICAgICAgICAgIGlmIChza2luQ2ZncyAmJiBza2luQ2Zncy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuY2xhaW1Ta2luUmV3YXJkKHNraW5DZmdzWzBdLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIGJvYXJkQ2ZncyA9IENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldEJvYXJkTGlzdEJ5VHlwZShTa2luVHlwZS5DaHJpc3RtYXMpO1xuICAgICAgICAgICAgICAgIGlmIChib2FyZENmZ3MgJiYgYm9hcmRDZmdzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5jbGFpbUJvYXJkUmV3YXJkKGJvYXJkQ2Znc1swXSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBCb29zdFR5cGUuT1BFTl9CT1g6XG4gICAgICAgICAgICAgICAgdmFyIGxhc3RLZXlDb3VudCA9IGdhbWUucGxheWVyTWFuLnBsYXllci5jdXJyZW50S2V5Q291bnQ7XG4gICAgICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uc2V0Q3VycmVudEtleUNvdW50KDMpO1xuICAgICAgICAgICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBCb3goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRDdXJyZW50S2V5Q291bnQobGFzdEtleUNvdW50KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRBY3Rpdml0eVRhc2tDbGFpbWVkKGFjdGl2aXR5VGFza1Jld2FyZC5pZCk7XG4gICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcIkRhaWx5VGFza1Jld2FyZENsYWltXCIsIHtcImlkXCI6IGFjdGl2aXR5VGFza1Jld2FyZC5pZH0pO1xuICAgICAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KEV2ZW50c05hbWUuVVBEQVRFX0FDVElWSVRZX1RBU0tfU0NPUkUpO1xuICAgIH0sXG5cbiAgICBpc0FsbFJld2FyZENsYWltZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGNvbmZpZ3MgPSBDb25maWdNYW4uZ2V0SW5zdGFuY2UoKS5nZXRBY3Rpdml0eVRhc2tSZXdhcmRzKCk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY29uZmlncy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgaWYgKCFnYW1lLnBsYXllck1hbi5pc0FjdGl2aXR5VGFza0NsYWltZWQoY29uZmlnc1tpXS5pZCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIGdldFVuQ29tcGxldGVkVGFzazogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYWN0aXZpdHlUYXNrTGlzdCA9IENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldEFjdGl2aXR5VGFza0xpc3QoKTtcbiAgICAgICAgdmFyIGN1cnJlbnRTY29yZSA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYWN0aXZpdHlUYXNrTGlzdC5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdmFyIGNvbmZpZyA9IGFjdGl2aXR5VGFza0xpc3RbaV07XG4gICAgICAgICAgICB2YXIgY3VycmVudENvdW50ID0gZ2FtZS5hY3Rpdml0eU1hbi5nZXRBY3Rpdml0eVRhc2tDb3VudChjb25maWcudHlwZSk7XG4gICAgICAgICAgICBpZiAoY3VycmVudENvdW50IDwgY29uZmlnLmxpbWl0KSB7XG4gICAgICAgICAgICAgICAgY3VycmVudFNjb3JlKys7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGN1cnJlbnRTY29yZTtcbiAgICB9LFxuXG4gICAgY2FuU2hvd0FjdGl2aXR5RW50cmFuY2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNPcGVuKCkgJiYgIXRoaXMuaXNBbGxSZXdhcmRDbGFpbWVkKCk7XG4gICAgfSxcblxuICAgIGdldE5leHRTdGFnZVJld2FyZENmZzogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgY3VycmVudFNjb3JlID0gdGhpcy5nZXRUb3RhbEFjdGl2aXR5VGFza0NvdW50KCk7XG4gICAgICAgIHZhciBjb25maWdzID0gQ29uZmlnTWFuLmdldEluc3RhbmNlKCkuZ2V0QWN0aXZpdHlUYXNrUmV3YXJkcygpO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvbmZpZ3MubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciBjb25maWcgPSBjb25maWdzW2ldO1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRTY29yZSA8IGNvbmZpZy5zY29yZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjb25maWc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbmZpZ3NbY29uZmlncy5sZW5ndGggLSAxXTtcbiAgICB9LFxuXG4gICAgZ2V0Q3VycmVudFN0YWdlUmV3YXJkQ2ZnOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjdXJyZW50U2NvcmUgPSB0aGlzLmdldFRvdGFsQWN0aXZpdHlUYXNrQ291bnQoKTtcbiAgICAgICAgdmFyIGNvbmZpZ3MgPSBDb25maWdNYW4uZ2V0SW5zdGFuY2UoKS5nZXRBY3Rpdml0eVRhc2tSZXdhcmRzKCk7XG4gICAgICAgIHZhciBpbmRleCA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY29uZmlncy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdmFyIGNvbmZpZyA9IGNvbmZpZ3NbaV07XG4gICAgICAgICAgICBpZiAoY3VycmVudFNjb3JlIDwgY29uZmlnLnNjb3JlKSB7XG4gICAgICAgICAgICAgICAgaW5kZXggPSBpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb25maWdzW2luZGV4IC0gMV07XG4gICAgfSxcblxuICAgIGlzT3BlbjogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZ2FtZS5nYW1lTWFuLmdldE1heExldmVsKCkgPiB0aGlzLmdldERhaWx5VGFza1VubG9ja0xldmVsKCk7XG4gICAgfSxcblxuICAgIGdldERhaWx5VGFza1VubG9ja0xldmVsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAyMDtcbiAgICB9LFxuXG4gICAgY2FuQ2xhaW1SZXdhcmQ6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIGlmIChnYW1lLmFjdGl2aXR5TWFuLmlzQWN0aXZpdHlUYXNrQ29tcGxldGVkKGRhdGEpICYmICFnYW1lLnBsYXllck1hbi5pc0FjdGl2aXR5VGFza0NsYWltZWQoZGF0YS5pZCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgaXNSZXdhcmRDbGFpbWVkOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICByZXR1cm4gZ2FtZS5wbGF5ZXJNYW4uaXNBY3Rpdml0eVRhc2tDbGFpbWVkKGRhdGEuaWQpO1xuICAgIH0sXG5cbiAgICBoYXNVbkNsYWltZWRSZXdhcmQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGNvbmZpZ3MgPSBDb25maWdNYW4uZ2V0SW5zdGFuY2UoKS5nZXRBY3Rpdml0eVRhc2tSZXdhcmRzKCk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY29uZmlncy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuY2FuQ2xhaW1SZXdhcmQoY29uZmlnc1tpXSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufSk7XG5cbkFjdGl2aXR5TWFuLl9pbnN0YW5jZSA9IG51bGw7XG5BY3Rpdml0eU1hbi5fZmlyc3RVc2VJbnN0YW5jZSA9IHRydWU7XG5cbi8qKlxuICpcbiAqIEByZXR1cm5zIHtBY3Rpdml0eU1hbn1cbiAqL1xuQWN0aXZpdHlNYW4uZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKEFjdGl2aXR5TWFuLl9maXJzdFVzZUluc3RhbmNlKSB7XG4gICAgICAgIEFjdGl2aXR5TWFuLl9maXJzdFVzZUluc3RhbmNlID0gZmFsc2U7XG4gICAgICAgIEFjdGl2aXR5TWFuLl9pbnN0YW5jZSA9IG5ldyBBY3Rpdml0eU1hbigpO1xuICAgIH1cbiAgICByZXR1cm4gQWN0aXZpdHlNYW4uX2luc3RhbmNlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBBY3Rpdml0eU1hbjsiLCJ2YXIgQWRzUGxhY2UgPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uL2VudW0vQWRzUGxhY2VcIik7XG5cbnZhciBBZHNIZWxwZXIgPSBjYy5DbGFzcy5leHRlbmQoe1xuXG4gICAgY3RvcjogZnVuY3Rpb24gKCkge1xuICAgIH0sXG5cbiAgICBzaG93UGFzc0FkczogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoZ2FtZS5nYW1lTWFuLmdldE1heExldmVsKCkgPj0gZ2FtZS5hZHNNYW5hZ2VyLnN0YXJ0TGV2ZWxMaW1pdCkge1xuICAgICAgICAgICAgZ2FtZS5hZHNNYW5hZ2VyLnNob3dJbnRlcnN0aXRpYWwoQWRzUGxhY2UuUGFzcyk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2hvd0JhY2tncm91bmRBZHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGdhbWUuZ2FtZU1hbi5nZXRNYXhMZXZlbCgpID49IGdhbWUuYWRzTWFuYWdlci5zdGFydExldmVsTGltaXQpIHtcbiAgICAgICAgICAgIGdhbWUuYWRzTWFuYWdlci5zaG93SW50ZXJzdGl0aWFsKEFkc1BsYWNlLkJhY2tHcm91bmQpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNob3dCYWNrSG9tZUFkczogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoZ2FtZS5nYW1lTWFuLmdldE1heExldmVsKCkgPj0gZ2FtZS5hZHNNYW5hZ2VyLnN0YXJ0TGV2ZWxMaW1pdCkge1xuICAgICAgICAgICAgZ2FtZS5hZHNNYW5hZ2VyLnNob3dJbnRlcnN0aXRpYWwoQWRzUGxhY2UuSG9tZSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2hvd1JlZnJlc2hBZHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGdhbWUuZ2FtZU1hbi5nZXRNYXhMZXZlbCgpID49IGdhbWUuYWRzTWFuYWdlci5zdGFydExldmVsTGltaXQpIHtcbiAgICAgICAgICAgIGdhbWUuYWRzTWFuYWdlci5zaG93SW50ZXJzdGl0aWFsKEFkc1BsYWNlLlJlZnJlc2gpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gb25FbnRlckJhY2tncm91bmQ6IGZ1bmN0aW9uICgpIHtcbiAgICAvLyAgICAgZ2FtZS5hZHNNYW5hZ2VyLnNldEludGVyc3RpdGlhbFNob3dlZChBZHNQbGFjZS5CYWNrR3JvdW5kKTtcbiAgICAvLyB9XG59KTtcblxuQWRzSGVscGVyLnNoYXJlZERpcmVjdG9yID0gbnVsbDtcbkFkc0hlbHBlci5maXJzdFVzZURpcmVjdG9yID0gdHJ1ZTtcblxuQWRzSGVscGVyLmdldEluc3RhbmNlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChBZHNIZWxwZXIuZmlyc3RVc2VEaXJlY3Rvcikge1xuICAgICAgICBBZHNIZWxwZXIuZmlyc3RVc2VEaXJlY3RvciA9IGZhbHNlO1xuICAgICAgICBBZHNIZWxwZXIuc2hhcmVkRGlyZWN0b3IgPSBuZXcgQWRzSGVscGVyKCk7XG4gICAgfVxuICAgIHJldHVybiBBZHNIZWxwZXIuc2hhcmVkRGlyZWN0b3I7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEFkc0hlbHBlcjsiLCJ2YXIgQ29uZmlnTWFuID0gcmVxdWlyZShcIi4uL2NvbmZpZy9Db25maWdNYW5cIik7XG52YXIgQm9vc3RUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vQm9vc3RUeXBlXCIpO1xudmFyIENoYWxsZW5nZUlkID0gcmVxdWlyZShcIi4uL2VudW0vQ2hhbGxlbmdlSWRcIik7XG5cbnZhciBDaGFsbGVuZ2VNYW4gPSBjYy5DbGFzcy5leHRlbmQoe1xuXG4gICAgVE9UQUxfTElGRV9DT1VOVDogMyxcblxuICAgIGN1cnJlbnRDaGFsbGVuZ2VJZDogLTEsXG5cbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgfSxcblxuICAgIGNoZWNrQW5kU2hvd0NoYWxsZW5nZTogZnVuY3Rpb24gKGdvQ0IsIGNhbmNlbENCKSB7XG4gICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5wbGF5ZXIuY2hhbGxlbmdlVW5sb2NrVGlwcykge1xuICAgICAgICAgICAgY2FuY2VsQ0IgJiYgY2FuY2VsQ0IoKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZ2FtZS5nYW1lTWFuLmdldE1heExldmVsKCkgPiB0aGlzLmdldFVubG9ja0xldmVsKENoYWxsZW5nZUlkLk5vcm1hbCkgJiYgZ2FtZS5wbGF5ZXJNYW4uZ2V0UmVnaXN0ZXJEYXkoKSA+IGdhbWUuYWRzTWFuYWdlci5jaGFsbGVuZ2VUaXBzRGF5KSB7XG4gICAgICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRDaGFsbGVuZ2VVbmxvY2tUaXBzU2hvd2VkKCk7XG4gICAgICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwWWVzTm9Db21tb25EbGcoXyhcImNoYWxsZW5nZV90aXBzXCIpLCBfKFwiY29uZmlybV9pbmZvXCIpLCBfKFwibm9fdGl0bGVcIiksIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBnYW1lLmdhbWVNYW4uaXNDaGFsbGVuZ2VMZXZlbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgZ2FtZS5jaGFsbGVuZ2VNYW4uY3VycmVudENoYWxsZW5nZUlkID0gQ2hhbGxlbmdlSWQuTm9ybWFsO1xuICAgICAgICAgICAgICAgIGdhbWUuc2NlbmVNYW4uc3dpdGNoU2NlbmUoZ2FtZS5zY2VuZVR5cGUuQ0hBTExFTkdFKTtcbiAgICAgICAgICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRXZlbnQoXCJDaGFsbGVuZ2VFbnRlclwiLCB7XCJzb3VyY2VcIjogXCJyZWNvbW1lbmRcIn0pO1xuICAgICAgICAgICAgICAgIGdvQ0IgJiYgZ29DQigpO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGNhbmNlbENCICYmIGNhbmNlbENCKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY2FuY2VsQ0IgJiYgY2FuY2VsQ0IoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRDaGFsbGVuZ2VJbmZvQ2ZnOiBmdW5jdGlvbiAoY2hhbGxlbmdlSWQpIHtcbiAgICAgICAgcmV0dXJuIENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldENoYWxsZW5nZSgpLmdldENoYWxsZW5nZUluZm9DZmcoY2hhbGxlbmdlSWQpO1xuICAgIH0sXG5cbiAgICBnZXRVbmxvY2tMZXZlbDogZnVuY3Rpb24gKGNoYWxsZW5nZUlkKSB7XG4gICAgICAgIHZhciBjaGFsbGVuZ2VJbmZvQ2ZnID0gQ29uZmlnTWFuLmdldEluc3RhbmNlKCkuZ2V0Q2hhbGxlbmdlKCkuZ2V0Q2hhbGxlbmdlSW5mb0NmZyhjaGFsbGVuZ2VJZCk7XG4gICAgICAgIHJldHVybiBjaGFsbGVuZ2VJbmZvQ2ZnLmxldmVsTGltaXQ7XG4gICAgfSxcblxuICAgIGlzQ2hhbGxlbmdlVW5sb2NrZWQ6IGZ1bmN0aW9uIChjaGFsbGVuZ2VJZCkge1xuICAgICAgICBpZiAoZ2FtZS5nYW1lTWFuLmdldE1heExldmVsKCkgPiB0aGlzLmdldFVubG9ja0xldmVsKGNoYWxsZW5nZUlkKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICBpc0FsbENoYWxsZW5nZVVubG9ja2VkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjaGFsbGVuZ2VzID0gQ29uZmlnTWFuLmdldEluc3RhbmNlKCkuZ2V0Q2hhbGxlbmdlKCkuY2hhbGxlbmdlcztcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGFsbGVuZ2VzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5pc0NoYWxsZW5nZVVubG9ja2VkKGNoYWxsZW5nZXNbaV0uaWQpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICBpc0FsbENoYWxsZW5nZUZpbmlzaGVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjaGFsbGVuZ2VzID0gQ29uZmlnTWFuLmdldEluc3RhbmNlKCkuZ2V0Q2hhbGxlbmdlKCkuY2hhbGxlbmdlcztcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGFsbGVuZ2VzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB2YXIgY2hhbGxlbmdlTGV2ZWwgPSBnYW1lLnBsYXllck1hbi5nZXRPckNyZWF0ZUNoYWxsZW5nZShjaGFsbGVuZ2VzW2ldLmlkKS5jaGFsbGVuZ2VMZXZlbDtcbiAgICAgICAgICAgIHZhciBjaGFsbGVuZ2VMZXZlbExpc3QgPSBDb25maWdNYW4uZ2V0SW5zdGFuY2UoKS5nZXRDaGFsbGVuZ2VMZXZlbExpc3QoY2hhbGxlbmdlc1tpXS5pZCk7XG4gICAgICAgICAgICBpZiAoY2hhbGxlbmdlTGV2ZWwgPD0gY2hhbGxlbmdlTGV2ZWxMaXN0Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgLy8gaXNDaGFsbGVuZ2VBbGxGaW5pc2hlZDogZnVuY3Rpb24gKCkge1xuICAgIC8vICAgICB2YXIgbGV2ZWxDZmcgPSB0aGlzLmdldExldmVsQ29uZmlnKGdhbWUucGxheWVyTWFuLnBsYXllci5jaGFsbGVuZ2VMZXZlbCk7XG4gICAgLy8gICAgIGlmICghbGV2ZWxDZmcpIHtcbiAgICAvLyAgICAgICAgIHJldHVybiB0cnVlO1xuICAgIC8vICAgICB9XG4gICAgLy8gICAgIHJldHVybiBmYWxzZTtcbiAgICAvLyB9LFxuXG4gICAgZ2V0TGV2ZWxDb25maWc6IGZ1bmN0aW9uIChsZXZlbElkKSB7XG4gICAgICAgIHZhciBjaGFsbGVuZ2VMZXZlbExpc3QgPSBDb25maWdNYW4uZ2V0SW5zdGFuY2UoKS5nZXRDaGFsbGVuZ2VMZXZlbExpc3QodGhpcy5jdXJyZW50Q2hhbGxlbmdlSWQpO1xuICAgICAgICByZXR1cm4gY2hhbGxlbmdlTGV2ZWxMaXN0W2xldmVsSWQgLSAxXTtcbiAgICB9LFxuXG4gICAgZ2V0Q2hhbGxlbmdlOiBmdW5jdGlvbiAobWlsZXN0b25lSWQpIHtcbiAgICAgICAgdmFyIGNoYWxsZW5nZXMgPSBDb25maWdNYW4uZ2V0SW5zdGFuY2UoKS5nZXRDaGFsbGVuZ2UoKS5nZXRDaGFsbGVuZ2VMaXN0KHRoaXMuY3VycmVudENoYWxsZW5nZUlkKTtcbiAgICAgICAgY2MubG9nKFwiY2NjLS0tY2hhbGxlbmdlcyBjb3VudDpcIiArIGNoYWxsZW5nZXMubGVuZ3RoKTtcbiAgICAgICAgY2MubG9nKFwiY2NjLS0tbWlsZXN0b25lSWQ6XCIgKyBtaWxlc3RvbmVJZCk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hhbGxlbmdlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdmFyIGNoYWxsZWdlID0gY2hhbGxlbmdlc1tpXTtcbiAgICAgICAgICAgIGlmIChjaGFsbGVnZS5pZCA9PT0gbWlsZXN0b25lSWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY2hhbGxlZ2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSxcblxuICAgIGlzTWlsZXN0b25lUGFzc2VkOiBmdW5jdGlvbiAobWlsZXN0b25lSWQpIHtcbiAgICAgICAgdmFyIGNoYWxsZW5nZSA9IHRoaXMuZ2V0Q2hhbGxlbmdlKG1pbGVzdG9uZUlkKTtcbiAgICAgICAgaWYgKHRoaXMuZ2V0Q2hhbGxlbmdlTGV2ZWwoKSA+IGNoYWxsZW5nZS5sZXZlbCkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICBnZXRDdXJyZW50TWlsZXN0b25lSWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGN1cnJlbnRMZXZlbCA9IHRoaXMuZ2V0Q2hhbGxlbmdlTGV2ZWwoKTtcbiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoKGN1cnJlbnRMZXZlbCAtIDEpIC8gNSkgKyAxO1xuICAgIH0sXG5cbiAgICBpc01pbGVzdG9uZVJld2FyZENsYWltZWQ6IGZ1bmN0aW9uIChtaWxlc3RvbmVJZCkge1xuICAgICAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4uZ2V0T3JDcmVhdGVDaGFsbGVuZ2UodGhpcy5jdXJyZW50Q2hhbGxlbmdlSWQpLmNoYWxsZW5nZU1pbGVzdG9uZUNsYWltSWQgPj0gbWlsZXN0b25lSWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgY2hlY2tBbmRTaG93Um9sbGJhY2s6IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICB2YXIgcGxheWluZyA9IGdhbWUucGxheWVyTWFuLmdldE9yQ3JlYXRlQ2hhbGxlbmdlKGdhbWUuY2hhbGxlbmdlTWFuLmN1cnJlbnRDaGFsbGVuZ2VJZCkuY2hhbGxlbmdlUGxheWluZztcbiAgICAgICAgY2MubG9nKFwiY2hhbGxlbmdlUGxheWluZzpcIiArIHBsYXlpbmcpO1xuICAgICAgICBpZiAocGxheWluZykge1xuICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cENvbW1vbkRsZyhnYW1lLnV0aWxzLnNwcmludGYoXyhcImNoYWxsZW5nZV9yZXN0YXJ0X3RpcHNcIiksIGdhbWUuY2hhbGxlbmdlTWFuLmdldFJvbGxiYWNrTGV2ZWwoKSksIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIGdhbWUuY2hhbGxlbmdlTWFuLnJvbGxCYWNrUHJvZ3Jlc3MoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgY2hlY2tBbmRTaG93UmV3YXJkczogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgY2hhbGxlbmdlcyA9IENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldENoYWxsZW5nZSgpLmdldENoYWxsZW5nZUxpc3QodGhpcy5jdXJyZW50Q2hhbGxlbmdlSWQpO1xuICAgICAgICB2YXIgd2FpdGluZ0NsYWltQ2hhbGxlbmdlID0gbnVsbDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGFsbGVuZ2VzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB2YXIgY2hhbGxlZ2UgPSBjaGFsbGVuZ2VzW2ldO1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNNaWxlc3RvbmVQYXNzZWQoY2hhbGxlZ2UuaWQpICYmICF0aGlzLmlzTWlsZXN0b25lUmV3YXJkQ2xhaW1lZChjaGFsbGVnZS5pZCkpIHtcbiAgICAgICAgICAgICAgICB3YWl0aW5nQ2xhaW1DaGFsbGVuZ2UgPSBjaGFsbGVnZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh3YWl0aW5nQ2xhaW1DaGFsbGVuZ2UpIHtcbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgIHZhciBjaGFsbGVuZ2VJZCA9IHRoaXMuY3VycmVudENoYWxsZW5nZUlkO1xuICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cEdldFJld2FyZHMod2FpdGluZ0NsYWltQ2hhbGxlbmdlLnJld2FyZHMsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHdhaXRpbmdDbGFpbUNoYWxsZW5nZS5yZXdhcmRzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuY2xhaW1SZXdhcmQod2FpdGluZ0NsYWltQ2hhbGxlbmdlLnJld2FyZHNbaV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRDaGFsbGVuZ2VNaWxlc3RvbmVSZXdhcmRDbGFpbWVkKHdhaXRpbmdDbGFpbUNoYWxsZW5nZS5pZCwgY2hhbGxlbmdlSWQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgY2xhaW1SZXdhcmQ6IGZ1bmN0aW9uIChyZXdhcmRDZmcpIHtcbiAgICAgICAgc3dpdGNoIChyZXdhcmRDZmcudHlwZSkge1xuICAgICAgICAgICAgY2FzZSBCb29zdFR5cGUuU0tJTjpcbiAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRDbGFpbWVkU2tpbihyZXdhcmRDZmcucGFyYW0xKTtcbiAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRDdXJyZW50U2tpbklkKHJld2FyZENmZy5wYXJhbTEpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBCb29zdFR5cGUuRElBTU9ORDpcbiAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5hZGREaWFtb25kcyhyZXdhcmRDZmcuY291bnQsIFwiY2hhbGxlbmdlXCIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBCb29zdFR5cGUuVEhSRUVfQkFMTDpcbiAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5hZGRCb29zdChCb29zdFR5cGUuVEhSRUVfQkFMTCwgcmV3YXJkQ2ZnLmNvdW50KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgQm9vc3RUeXBlLlNQTElUOlxuICAgICAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLmFkZEJvb3N0KEJvb3N0VHlwZS5TUExJVCwgcmV3YXJkQ2ZnLmNvdW50KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgQm9vc3RUeXBlLkJPQVJEX1NLSU46XG4gICAgICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uc2V0Q2xhaW1lZEJvYXJkKHJld2FyZENmZy5wYXJhbTEpO1xuICAgICAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLnNldEN1cnJlbnRCb2FyZElkKHJld2FyZENmZy5wYXJhbTEpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHBvcHVwUXVpdFRpcHM6IGZ1bmN0aW9uIChxdWl0Q2FsbGJhY2ssIGNhbmNlbENhbGxiYWNrKSB7XG4gICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBZZXNOb0NvbW1vbkRsZyhnYW1lLnV0aWxzLnNwcmludGYoXyhcImNoYWxsZW5nZV9yZXN0YXJ0X3RpcHNcIiksIHRoaXMuZ2V0Um9sbGJhY2tMZXZlbCgpKSxcbiAgICAgICAgICAgIF8oXCJyZXN0YXJ0X3RpdGxlXCIpLCBfKFwicmVsaWZlX3RpdGxlXCIpLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBxdWl0Q2FsbGJhY2sgJiYgcXVpdENhbGxiYWNrKCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNhbmNlbENhbGxiYWNrICYmIGNhbmNlbENhbGxiYWNrKCk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBnZXRSb2xsYmFja0xldmVsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjdXJyZW50TGV2ZWwgPSB0aGlzLmdldENoYWxsZW5nZUxldmVsKCk7XG4gICAgICAgIHZhciByb2xsQmFja0xldmVsID0gTWF0aC5mbG9vcigoY3VycmVudExldmVsIC0gMSkgLyA1KSAqIDUgKyAxO1xuICAgICAgICByZXR1cm4gcm9sbEJhY2tMZXZlbDtcbiAgICB9LFxuXG4gICAgcm9sbEJhY2tQcm9ncmVzczogZnVuY3Rpb24gKCkge1xuICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRDaGFsbGVuZ2VMZXZlbCh0aGlzLmdldFJvbGxiYWNrTGV2ZWwoKSwgdGhpcy5jdXJyZW50Q2hhbGxlbmdlSWQpO1xuICAgICAgICBnYW1lLnBsYXllck1hbi5yb2xsYmFja0NoYWxsZW5nZVJldml2ZUNvdW50KHRoaXMuY3VycmVudENoYWxsZW5nZUlkKTtcbiAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uc2V0Q2hhbGxlbmdlUGxheWluZyhmYWxzZSwgZ2FtZS5jaGFsbGVuZ2VNYW4uY3VycmVudENoYWxsZW5nZUlkKTtcbiAgICB9LFxuXG4gICAgY2FuUmV2aXZlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBnYW1lLnBsYXllck1hbi5nZXRPckNyZWF0ZUNoYWxsZW5nZShnYW1lLmNoYWxsZW5nZU1hbi5jdXJyZW50Q2hhbGxlbmdlSWQpLmNoYWxsZW5nZVJldml2ZUNvdW50IDwgdGhpcy5UT1RBTF9MSUZFX0NPVU5UO1xuICAgIH0sXG5cbiAgICBnZXRDaGFsbGVuZ2VMZXZlbDogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZ2FtZS5wbGF5ZXJNYW4uZ2V0T3JDcmVhdGVDaGFsbGVuZ2UoZ2FtZS5jaGFsbGVuZ2VNYW4uY3VycmVudENoYWxsZW5nZUlkKS5jaGFsbGVuZ2VMZXZlbDtcbiAgICB9XG59KTtcblxuQ2hhbGxlbmdlTWFuLl9pbnN0YW5jZSA9IG51bGw7XG5DaGFsbGVuZ2VNYW4uX2ZpcnN0VXNlSW5zdGFuY2UgPSB0cnVlO1xuXG4vKipcbiAqXG4gKiBAcmV0dXJucyB7Q2hhbGxlbmdlTWFufVxuICovXG5DaGFsbGVuZ2VNYW4uZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKENoYWxsZW5nZU1hbi5fZmlyc3RVc2VJbnN0YW5jZSkge1xuICAgICAgICBDaGFsbGVuZ2VNYW4uX2ZpcnN0VXNlSW5zdGFuY2UgPSBmYWxzZTtcbiAgICAgICAgQ2hhbGxlbmdlTWFuLl9pbnN0YW5jZSA9IG5ldyBDaGFsbGVuZ2VNYW4oKTtcbiAgICB9XG4gICAgcmV0dXJuIENoYWxsZW5nZU1hbi5faW5zdGFuY2U7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IENoYWxsZW5nZU1hbjsiLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAxNS81LzEyLlxuICovXG52YXIgRXZlbnRzTmFtZSA9IHJlcXVpcmUoXCIuLi9ldmVudHMvRXZlbnRzTmFtZVwiKTtcbnZhciBDb25maWdNYW4gPSByZXF1aXJlKFwiLi4vY29uZmlnL0NvbmZpZ01hblwiKTtcbnZhciBBZHNQbGFjZSA9IHJlcXVpcmUoXCIuLi8uLi9jb21tb24vZW51bS9BZHNQbGFjZVwiKTtcbnZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcbnZhciBDaGFsbGVuZ2VJZCA9IHJlcXVpcmUoXCIuLi9lbnVtL0NoYWxsZW5nZUlkXCIpO1xudmFyIEJvb3N0VHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL0Jvb3N0VHlwZVwiKTtcbnZhciBTa2luVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1NraW5UeXBlXCIpO1xuLy92YXIgU2hhcmVDb25maWcgPSByZXF1aXJlKFwiLi4vY29uZmlnL1NoYXJlQ29uZmlnXCIpO1xuLy92YXIgQ29uZmlnTWFuID0gcmVxdWlyZShcIi4uL2NvbmZpZy9Db25maWdNYW5cIik7XG5cbi8vdmFyIEJvb3N0UHJvYmFiaWxpdHlNYXAgPSB7XG4vL1xuLy99O1xuXG52YXIgR2FtZU1hbiA9IGNjLkNsYXNzLmV4dGVuZCh7XG4gICAgRlJFRV9XSEVFTF9IT1VSUzogMTIsXG5cbiAgICBPTkVfSE9VUl9TRUNPTkRTOiA2MCAqIDYwICogMTAwMCxcbiAgICBzdGFydFRpbWU6IDAsXG4gICAgcmVzdWx0Q291bnQ6IDAsXG4gICAgcmF0ZWQ6IGZhbHNlLFxuICAgIGVuZFRpbWU6IDAsXG4gICAgY2FuUmVMaWZlOiB0cnVlLFxuICAgIGRpc3RhbmNlOiAwLFxuICAgIGxldmVsSWQ6IDEsXG4gICAgaGFyZE1vZGU6IGZhbHNlLFxuICAgIG5ld0hhcmRNb2RlOiBmYWxzZSxcbiAgICBnaWZ0Q291bnQ6IDAsXG4gICAgbGFzdFNob3dMZXZlbDogMCxcblxuICAgIHRvdGFsRmFpbENvdW50OiAwLFxuICAgIHBvcGVkM1N0YXJUaXBzOiBmYWxzZSxcbiAgICBmaXJzdEVudGVyQWRTaG93ZWQ6IGZhbHNlLFxuXG4gICAgaXNUcnlBaW1JdGVtOiBmYWxzZSxcbiAgICB3YXRjaEFkc01hcDogbnVsbCxcblxuICAgIGlzQ2hhbGxlbmdlTGV2ZWw6IGZhbHNlLFxuXG4gICAgZmx5R2lmdEFwcGVhckNvdW50OiAwLFxuXG4gICAgY2FuVXNlQWltSXRlbTogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcHVyY2hhc2VkQWltSXRlbSA9IGdhbWUucGxheWVyTWFuLnBsYXllci5oYXNBaW1JdGVtO1xuICAgICAgICB2YXIgdHJ5QWltSXRlbSA9IHRoaXMuaXNUcnlBaW1JdGVtO1xuICAgICAgICByZXR1cm4gcHVyY2hhc2VkQWltSXRlbSB8fCB0cnlBaW1JdGVtO1xuICAgIH0sXG5cbiAgICBjYW5UcnlBaW1JdGVtOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBpc0xldmVsT0sgPSBnYW1lLnBsYXllck1hbi5nZXRMZXZlbCgpID49IDEwO1xuICAgICAgICB2YXIgcHVyY2hhc2VkQWltSXRlbSA9IGdhbWUucGxheWVyTWFuLnBsYXllci5oYXNBaW1JdGVtO1xuICAgICAgICByZXR1cm4gaXNMZXZlbE9LICYmICFwdXJjaGFzZWRBaW1JdGVtO1xuICAgIH0sXG5cbiAgICB0cnlBaW1JdGVtOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaXNUcnlBaW1JdGVtID0gdHJ1ZTtcbiAgICAgICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChFdmVudHNOYW1lLlNIT1dfQUlNX0dVSURFKTtcbiAgICB9LFxuXG4gICAgcmVzZXRUcnlBbmltSXRlbTogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlzVHJ5QWltSXRlbSA9IGZhbHNlO1xuICAgIH0sXG5cbiAgICBnZXRCb29zdFByb2JhYmlsaXR5OiBmdW5jdGlvbiAoY29uZmlnKSB7XG4gICAgICAgIHZhciBmYWlsQ291bnQgPSBnYW1lLnBsYXllck1hbi5nZXRGYWlsQ291bnQoY29uZmlnLmxldmVsSWQpO1xuICAgICAgICB2YXIgYm9vc3RQcm9iYWJpbGl0eSA9IGNvbmZpZy5ib29zdFByb2JhYmlsaXR5O1xuICAgICAgICBpZiAoIXRoaXMuaXNMZXNzR3JpZENoYWxsZW5nZSgpKSB7XG4gICAgICAgICAgICBpZiAoZmFpbENvdW50ID09PSA0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGJvb3N0UHJvYmFiaWxpdHkgKyAwLjI7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGZhaWxDb3VudCA9PT0gNSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBib29zdFByb2JhYmlsaXR5ICsgMC40O1xuICAgICAgICAgICAgfSBlbHNlIGlmIChmYWlsQ291bnQgPiA1KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGJvb3N0UHJvYmFiaWxpdHkgKyAwLjU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJvb3N0UHJvYmFiaWxpdHk7XG4gICAgfSxcblxuICAgIGlzTGVzc0dyaWRDaGFsbGVuZ2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNDaGFsbGVuZ2VMZXZlbCAmJiBnYW1lLmNoYWxsZW5nZU1hbi5jdXJyZW50Q2hhbGxlbmdlSWQgPT09IENoYWxsZW5nZUlkLkxlc3NHcmlkKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIHNldEhhcmRNb2RlOiBmdW5jdGlvbiAoaGFyZE1vZGUpIHtcbiAgICAgICAgdGhpcy5oYXJkTW9kZSA9IGhhcmRNb2RlO1xuICAgIH0sXG5cbiAgICBzZXROZXdIYXJkTW9kZTogZnVuY3Rpb24gKG5ld0hhcmRNb2RlKSB7XG4gICAgICAgIHRoaXMubmV3SGFyZE1vZGUgPSBuZXdIYXJkTW9kZTtcbiAgICB9LFxuXG4gICAgY2FuUG9wM1N0YXJUaXBzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAhdGhpcy5wb3BlZDNTdGFyVGlwcztcbiAgICB9LFxuXG4gICAgc2V0UG9wM1N0YXJUaXBzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucG9wZWQzU3RhclRpcHMgPSB0cnVlO1xuICAgIH0sXG5cbiAgICBpc0hhcmRNb2RlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhhcmRNb2RlO1xuICAgIH0sXG5cbiAgICBpc05ld0hhcmRNb2RlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm5ld0hhcmRNb2RlO1xuICAgIH0sXG5cbiAgICBnZXRQbGF5ZXJMZXZlbDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5pc05ld0hhcmRNb2RlKCkpIHtcbiAgICAgICAgICAgIHJldHVybiBnYW1lLnBsYXllck1hbi5nZXROZXdIYXJkTGV2ZWwoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5pc0hhcmRNb2RlKCkpIHtcbiAgICAgICAgICAgIHJldHVybiBnYW1lLnBsYXllck1hbi5nZXRIYXJkTGV2ZWwoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBnYW1lLnBsYXllck1hbi5nZXRMZXZlbCgpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy53YXRjaEFkc01hcCA9IHtcbiAgICAgICAgICAgIHNraW46IHtcbiAgICAgICAgICAgICAgICBjb3VudDogMCxcbiAgICAgICAgICAgICAgICBjYWxsYmFjazogdGhpcy5jaGVja1dhdGNoQWRzR2V0U2tpbi5iaW5kKHRoaXMpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2FyZDoge1xuICAgICAgICAgICAgICAgIGNvdW50OiAwLFxuICAgICAgICAgICAgICAgIGNhbGxiYWNrOiB0aGlzLmNoZWNrV2F0Y2hBZHNGbGlwQ2FyZC5iaW5kKHRoaXMpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYm94OiB7XG4gICAgICAgICAgICAgICAgY291bnQ6IDAsXG4gICAgICAgICAgICAgICAgY2FsbGJhY2s6IHRoaXMuY2hlY2tXYXRjaEFkc09wZW5Cb3guYmluZCh0aGlzKVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLndhdGNoQWRzTGlzdCA9IFtdO1xuICAgICAgICBmb3IgKHZhciBrZXkgaW4gdGhpcy53YXRjaEFkc01hcCkge1xuICAgICAgICAgICAgaWYgKHRoaXMud2F0Y2hBZHNNYXAuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgICAgICAgIHRoaXMud2F0Y2hBZHNMaXN0LnB1c2godGhpcy53YXRjaEFkc01hcFtrZXldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBpbml0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucmF0ZWQgPSBnYW1lLnBsYXllck1hbi5wbGF5ZXIucmF0ZWQ7XG4gICAgICAgIHRoaXMuY2hvb3NlTGF0ZXN0TGV2ZWwoKTtcbiAgICB9LFxuXG4gICAgY2hvb3NlTGF0ZXN0TGV2ZWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNOZXdIYXJkTW9kZSgpKSB7XG4gICAgICAgICAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4uZ2V0TmV3SGFyZExldmVsKCkgPD0gdGhpcy5nZXRMZXZlbExpc3QoKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxldmVsSWQgPSBnYW1lLnBsYXllck1hbi5nZXROZXdIYXJkTGV2ZWwoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlXG4gICAgICAgIGlmICh0aGlzLmlzSGFyZE1vZGUoKSkge1xuICAgICAgICAgICAgaWYgKGdhbWUucGxheWVyTWFuLmdldEhhcmRMZXZlbCgpIDw9IHRoaXMuZ2V0TGV2ZWxMaXN0KCkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sZXZlbElkID0gZ2FtZS5wbGF5ZXJNYW4uZ2V0SGFyZExldmVsKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4uZ2V0TGV2ZWwoKSA8PSB0aGlzLmdldExldmVsTGlzdCgpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHRoaXMubGV2ZWxJZCA9IGdhbWUucGxheWVyTWFuLmdldExldmVsKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0SGFyZE1vZGUodHJ1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKGdhbWUucGxheWVyTWFuLmdldEhhcmRMZXZlbCgpIDw9IHRoaXMuZ2V0TGV2ZWxMaXN0KCkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGV2ZWxJZCA9IGdhbWUucGxheWVyTWFuLmdldEhhcmRMZXZlbCgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICBnZXRMZXZlbExpc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNDaGFsbGVuZ2VMZXZlbCkge1xuICAgICAgICAgICAgcmV0dXJuIENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldENoYWxsZW5nZUxldmVsTGlzdChnYW1lLmNoYWxsZW5nZU1hbi5jdXJyZW50Q2hhbGxlbmdlSWQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNOZXdIYXJkTW9kZSgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldE5ld0hhcmRMZXZlbExpc3QoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBDb25maWdNYW4uZ2V0SW5zdGFuY2UoKS5nZXRMZXZlbExpc3QoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICB1cGRhdGVTY29yZTogZnVuY3Rpb24gKCkge1xuICAgICAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KEV2ZW50c05hbWUuRVZFTlRfTkFNRV9VUERBVEVfU0NPUkUpO1xuICAgIH0sXG5cbiAgICAvL2dhbWVPdmVyOiBmdW5jdGlvbiAoKSB7XG4gICAgLy8gICAgLy9nYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRmFpbGVkUHJvZ3Jlc3Npb25FdmVudChcImxldmVsXCIsIGdhbWUucGxheWVyTWFuLmdldExldmVsKCkpO1xuICAgIC8vICAgIHRoaXMucmVzdWx0Q291bnQrKztcbiAgICAvL30sXG5cbiAgICBnZXRNaXNzaW9uS2V5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLmlzTmV3SGFyZE1vZGUoKSkge1xuICAgICAgICAgICAgcmV0dXJuIFwibmV3X2hhcmRfbGV2ZWxfXCIgKyB0aGlzLmxldmVsSWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLmlzSGFyZE1vZGUoKSkge1xuICAgICAgICAgICAgcmV0dXJuIFwibm9ybWFsX2xldmVsX1wiICsgdGhpcy5sZXZlbElkO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFwiaGFyZF9sZXZlbF9cIiArIHRoaXMubGV2ZWxJZDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvbkdhbWVTdGFydDogZnVuY3Rpb24gKCkge1xuICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLm1pc3Npb25CZWdhbih0aGlzLmdldE1pc3Npb25LZXkoKSk7XG4gICAgfSxcblxuICAgIGdldEN1cnJlbnRTdGFyOiBmdW5jdGlvbiAoY29zdFRpbWUpIHtcbiAgICAgICAgLy9jYy5sb2coXCJjb3N0VGltZTpcIiArIGNvc3RUaW1lKTtcbiAgICAgICAgdmFyIGxldmVsQ2ZnID0gdGhpcy5nZXRDdXJDb25maWcoKTtcbiAgICAgICAgdmFyIHN0YXIgPSAxO1xuICAgICAgICBpZiAoY29zdFRpbWUgPD0gbGV2ZWxDZmcuc3RhclRpbWUpIHtcbiAgICAgICAgICAgIHN0YXIgPSAzO1xuICAgICAgICB9IGVsc2UgaWYgKGNvc3RUaW1lIDw9IGxldmVsQ2ZnLnN0YXJUaW1lICogMikge1xuICAgICAgICAgICAgc3RhciA9IDI7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN0YXI7XG4gICAgfSxcblxuICAgIGdldFByb2dyZXNzUGVyY2VudDogZnVuY3Rpb24gKGNvc3RUaW1lKSB7XG4gICAgICAgIHZhciBsZXZlbENmZyA9IHRoaXMuZ2V0Q3VyQ29uZmlnKCk7XG4gICAgICAgIHJldHVybiBNYXRoLm1heCgwLCAxIC0gKGNvc3RUaW1lIC8gbGV2ZWxDZmcuc3RhclRpbWUgLyAzKSkgKiAxMDA7XG4gICAgfSxcblxuICAgIGdldEN1cnJlbnRSZXdhcmREaWFtb25kczogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5pc05ld1N0YXJEYXRhIHx8IHRoaXMubGFzdFN0YXIgPT09IDApIHtcbiAgICAgICAgICAgIHZhciBsYXN0UmV3YXJkRGlhbW9uZHMgPSBnYW1lLmNvbmZpZy5yZXdhcmREaWFtb25kTWFwW3RoaXMubGFzdFN0YXJdIHx8IDA7XG4gICAgICAgICAgICB2YXIgY3VycmVudFJld2FyZERpYW1vbmRzID0gZ2FtZS5jb25maWcucmV3YXJkRGlhbW9uZE1hcFt0aGlzLmN1cnJlbnRTdGFyXSB8fCAwO1xuICAgICAgICAgICAgcmV0dXJuIE1hdGgubWF4KGN1cnJlbnRSZXdhcmREaWFtb25kcyAtIGxhc3RSZXdhcmREaWFtb25kcywgMSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIDE7XG4gICAgfSxcblxuICAgIGhhc1N0YXJUYWc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGhhc1N0YXJUYWcgPSBmYWxzZTtcbiAgICAgICAgaWYgKHRoaXMuaXNOZXdIYXJkTW9kZSgpKSB7XG4gICAgICAgICAgICBoYXNTdGFyVGFnID0gZ2FtZS5wbGF5ZXJNYW4uZ2V0TGV2ZWxEYXRhKHRoaXMubGV2ZWxJZCwgXCJuZXdIYXJkU3RhclRhZ1wiKSB8fCBmYWxzZTtcbiAgICAgICAgfSBlbHNlXG4gICAgICAgIGlmICghdGhpcy5pc0hhcmRNb2RlKCkpIHtcbiAgICAgICAgICAgIGhhc1N0YXJUYWcgPSBnYW1lLnBsYXllck1hbi5nZXRMZXZlbERhdGEodGhpcy5sZXZlbElkLCBcInN0YXJUYWdcIikgfHwgZmFsc2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBoYXNTdGFyVGFnID0gZ2FtZS5wbGF5ZXJNYW4uZ2V0TGV2ZWxEYXRhKHRoaXMubGV2ZWxJZCwgXCJoYXJkU3RhclRhZ1wiKSB8fCBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaGFzU3RhclRhZztcbiAgICB9LFxuXG4gICAgb25XYXRjaEFkc0dldDNTdGFyOiBmdW5jdGlvbiAobGV2ZWxJZCkge1xuICAgICAgICB2YXIgc3RhciA9IDM7XG4gICAgICAgIGlmICh0aGlzLmlzTmV3SGFyZE1vZGUoKSkge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVOZXdIYXJkTGV2ZWxTdGFyKGxldmVsSWQsIHN0YXIpO1xuICAgICAgICB9IGVsc2VcbiAgICAgICAgaWYgKCF0aGlzLmlzSGFyZE1vZGUoKSkge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVMZXZlbFN0YXIobGV2ZWxJZCwgc3Rhcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUhhcmRMZXZlbFN0YXIobGV2ZWxJZCwgc3Rhcik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jdXJyZW50U3RhciA9IDM7XG4gICAgfSxcblxuICAgIGdhbWVXaW46IGZ1bmN0aW9uIChjb3N0VGltZSkge1xuICAgICAgICBpZiAodGhpcy5pc0NoYWxsZW5nZUxldmVsKSB7XG4gICAgICAgICAgICBpZiAoIWdhbWUucGxheWVyTWFuLmlzQ2hhbGxlbmdlTGV2ZWxTdWNjZXNzZWQodGhpcy5sZXZlbElkLCBnYW1lLmNoYWxsZW5nZU1hbi5jdXJyZW50Q2hhbGxlbmdlSWQpKSB7XG4gICAgICAgICAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiY2hhbGxlbmdlX2xldmVsX3Bhc3NfXCIgKyBnYW1lLmNoYWxsZW5nZU1hbi5jdXJyZW50Q2hhbGxlbmdlSWQsIHtcbiAgICAgICAgICAgICAgICAgICAgXCJsZXZlbFwiOiB0aGlzLmxldmVsSWRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLnNldENoYWxsZW5nZUxldmVsU3VjY2Vzc2VkKHRoaXMubGV2ZWxJZCwgZ2FtZS5jaGFsbGVuZ2VNYW4uY3VycmVudENoYWxsZW5nZUlkKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmxldmVsSWQgJSA1ID09PSAwKSB7XG4gICAgICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4ucm9sbGJhY2tDaGFsbGVuZ2VSZXZpdmVDb3VudChnYW1lLmNoYWxsZW5nZU1hbi5jdXJyZW50Q2hhbGxlbmdlSWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5yZXN1bHRDb3VudCsrO1xuICAgICAgICAgICAgdGhpcy5sZXZlbElkKys7XG4gICAgICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRDaGFsbGVuZ2VMZXZlbCh0aGlzLmxldmVsSWQsIGdhbWUuY2hhbGxlbmdlTWFuLmN1cnJlbnRDaGFsbGVuZ2VJZCk7XG4gICAgICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRDaGFsbGVuZ2VQbGF5aW5nKGZhbHNlLCBnYW1lLmNoYWxsZW5nZU1hbi5jdXJyZW50Q2hhbGxlbmdlSWQpO1xuICAgICAgICAgICAgZ2FtZS5hY3Rpdml0eU1hbi5hZGRBY3Rpdml0eVRhc2tDb3VudChnYW1lLmFjdGl2aXR5VGFza1R5cGUuQ2hhbGxlbmdlTGV2ZWwpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaXNOZXdIYXJkTW9kZSgpKSB7XG4gICAgICAgICAgICB0aGlzLmxhc3RTdGFyID0gZ2FtZS5wbGF5ZXJNYW4uZ2V0TmV3SGFyZExldmVsU3Rhcih0aGlzLmxldmVsSWQpO1xuICAgICAgICB9IGVsc2VcbiAgICAgICAgaWYgKCF0aGlzLmlzSGFyZE1vZGUoKSkge1xuICAgICAgICAgICAgdGhpcy5sYXN0U3RhciA9IGdhbWUucGxheWVyTWFuLmdldExldmVsU3Rhcih0aGlzLmxldmVsSWQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5sYXN0U3RhciA9IGdhbWUucGxheWVyTWFuLmdldEhhcmRMZXZlbFN0YXIodGhpcy5sZXZlbElkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIubWlzc2lvbkNvbXBsZXRlZCh0aGlzLmdldE1pc3Npb25LZXkoKSk7XG5cbiAgICAgICAgdGhpcy5pc05ld1N0YXJEYXRhID0gdGhpcy5oYXNTdGFyVGFnKCk7XG5cbiAgICAgICAgdmFyIHN0YXIgPSB0aGlzLmdldEN1cnJlbnRTdGFyKGNvc3RUaW1lKTtcblxuICAgICAgICAvL3RoaXMub25HYW1lV2luKHN0YXIpO1xuICAgICAgICB0aGlzLmN1cnJlbnRTdGFyID0gc3RhcjtcbiAgICAgICAgdmFyIGhhc1Bzc2VkID0gZmFsc2U7XG4gICAgICAgIHZhciBsZXZlbElkQW5kU3RhciA9IHRoaXMubGV2ZWxJZCArIFwiLVwiICsgc3RhcjtcbiAgICAgICAgaWYgKHRoaXMuaXNOZXdIYXJkTW9kZSgpKSB7XG4gICAgICAgICAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4uZ2V0TmV3SGFyZExldmVsU3Rhcih0aGlzLmxldmVsSWQpID4gMCkge1xuICAgICAgICAgICAgICAgIGhhc1Bzc2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudXBkYXRlTmV3SGFyZExldmVsU3Rhcih0aGlzLmxldmVsSWQsIHN0YXIpO1xuICAgICAgICAgICAgaWYgKCFoYXNQc3NlZCkge1xuICAgICAgICAgICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcImxldmVsX3Bhc3NfbmV3X2hhcmRcIiwge1xuICAgICAgICAgICAgICAgICAgICBcImxldmVsXCI6IHRoaXMubGV2ZWxJZFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcImxldmVsX3Bhc3NfbmV3X2hhcmRfc3RhclwiLCB7XG4gICAgICAgICAgICAgICAgICAgIGxldmVsU3RhcktleTogbGV2ZWxJZEFuZFN0YXJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB2YXIgbGV2ZWxHcm91cCA9IGdhbWUucGxheWVyTWFuLmdldFJlYWxHcm91cChnYW1lLmFiVGVzdFR5cGUuTGV2ZWwpO1xuICAgICAgICAgICAgICAgIGlmIChsZXZlbEdyb3VwICYmIGxldmVsR3JvdXAubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRXZlbnQoXCJsZXZlbF9wYXNzX25ld19oYXJkX1wiICsgbGV2ZWxHcm91cCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJsZXZlbFwiOiB0aGlzLmxldmVsSWRcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNjLmxvZyhcInRyYWNrIGV2ZW50IGxldmVsX3Bhc3NfaGFyZDpcIiArIHRoaXMubGV2ZWxJZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnJlc3VsdENvdW50Kys7XG4gICAgICAgICAgICB0aGlzLmxldmVsSWQrKztcbiAgICAgICAgICAgIGlmICh0aGlzLmxldmVsSWQgPD0gdGhpcy5nZXRMZXZlbExpc3QoKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBnYW1lLmdjTWFuYWdlci5yZXBvcnRTY29yZSh0aGlzLmxldmVsSWQsIGdhbWUuY29uZmlnLmdldEhhcmRCb2FyZEtleSgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLnNldE5ld0hhcmRMZXZlbCh0aGlzLmxldmVsSWQpO1xuICAgICAgICB9IGVsc2VcbiAgICAgICAgaWYgKCF0aGlzLmlzSGFyZE1vZGUoKSkge1xuICAgICAgICAgICAgaWYgKGdhbWUucGxheWVyTWFuLmdldExldmVsU3Rhcih0aGlzLmxldmVsSWQpID4gMCkge1xuICAgICAgICAgICAgICAgIGhhc1Bzc2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudXBkYXRlTGV2ZWxTdGFyKHRoaXMubGV2ZWxJZCwgc3Rhcik7XG4gICAgICAgICAgICBpZiAoIWhhc1Bzc2VkKSB7XG4gICAgICAgICAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwibGV2ZWxfcGFzc1wiLCB7XG4gICAgICAgICAgICAgICAgICAgIFwibGV2ZWxcIjogdGhpcy5sZXZlbElkXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwibGV2ZWxfcGFzc19zdGFyXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgXCJsZXZlbFwiOiBsZXZlbElkQW5kU3RhclxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHZhciBsZXZlbEdyb3VwID0gZ2FtZS5wbGF5ZXJNYW4uZ2V0UmVhbEdyb3VwKGdhbWUuYWJUZXN0VHlwZS5MZXZlbCk7XG4gICAgICAgICAgICAgICAgaWYgKGxldmVsR3JvdXAgJiYgbGV2ZWxHcm91cC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcImxldmVsX3Bhc3NfXCIgKyBsZXZlbEdyb3VwLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcImxldmVsXCI6IHRoaXMubGV2ZWxJZFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2MubG9nKFwidHJhY2sgZXZlbnQgbGV2ZWxfcGFzczpcIiArIHRoaXMubGV2ZWxJZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnJlc3VsdENvdW50Kys7XG4gICAgICAgICAgICB0aGlzLmxldmVsSWQrKztcbiAgICAgICAgICAgIGlmICh0aGlzLmxldmVsSWQgPD0gdGhpcy5nZXRMZXZlbExpc3QoKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBnYW1lLmdjTWFuYWdlci5yZXBvcnRTY29yZSh0aGlzLmxldmVsSWQsIGdhbWUuY29uZmlnLmdldExlYWRlckJvYXJkS2V5KCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uc2V0TGV2ZWwodGhpcy5sZXZlbElkKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5nZXRIYXJkTGV2ZWxTdGFyKHRoaXMubGV2ZWxJZCkgPiAwKSB7XG4gICAgICAgICAgICAgICAgaGFzUHNzZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy51cGRhdGVIYXJkTGV2ZWxTdGFyKHRoaXMubGV2ZWxJZCwgc3Rhcik7XG4gICAgICAgICAgICBpZiAoIWhhc1Bzc2VkKSB7XG4gICAgICAgICAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwibGV2ZWxfcGFzc19oYXJkXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgXCJsZXZlbFwiOiB0aGlzLmxldmVsSWRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRXZlbnQoXCJsZXZlbF9wYXNzX2hhcmRfc3RhclwiLCB7XG4gICAgICAgICAgICAgICAgICAgIGxldmVsU3RhcktleTogbGV2ZWxJZEFuZFN0YXJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB2YXIgbGV2ZWxHcm91cCA9IGdhbWUucGxheWVyTWFuLmdldFJlYWxHcm91cChnYW1lLmFiVGVzdFR5cGUuTGV2ZWwpO1xuICAgICAgICAgICAgICAgIGlmIChsZXZlbEdyb3VwICYmIGxldmVsR3JvdXAubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRXZlbnQoXCJsZXZlbF9wYXNzX2hhcmRfXCIgKyBsZXZlbEdyb3VwLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcImxldmVsXCI6IHRoaXMubGV2ZWxJZFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2MubG9nKFwidHJhY2sgZXZlbnQgbGV2ZWxfcGFzc19oYXJkOlwiICsgdGhpcy5sZXZlbElkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucmVzdWx0Q291bnQrKztcbiAgICAgICAgICAgIHRoaXMubGV2ZWxJZCsrO1xuICAgICAgICAgICAgaWYgKHRoaXMubGV2ZWxJZCA8PSB0aGlzLmdldExldmVsTGlzdCgpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGdhbWUuZ2NNYW5hZ2VyLnJlcG9ydFNjb3JlKHRoaXMubGV2ZWxJZCwgZ2FtZS5jb25maWcuZ2V0SGFyZEJvYXJkS2V5KCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uc2V0SGFyZExldmVsKHRoaXMubGV2ZWxJZCk7XG4gICAgICAgIH1cbiAgICAgICAgZ2FtZS5nY01hbmFnZXIucmVwb3J0U2NvcmUodGhpcy5nZXRUb3RhbFN0YXJDb3VudCgpLCBnYW1lLmNvbmZpZy5nZXRTdGFyTGVhZGVyQm9hcmRLZXkoKSk7XG4gICAgICAgIHRoaXMuaGFzUGFzc2VkID0gaGFzUHNzZWQ7XG4gICAgfSxcblxuICAgIHNraXBMZXZlbDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5pc05ld0hhcmRNb2RlKCkpIHtcbiAgICAgICAgICAgIHRoaXMubGV2ZWxJZCsrO1xuICAgICAgICAgICAgaWYgKHRoaXMubGV2ZWxJZCA8PSB0aGlzLmdldExldmVsTGlzdCgpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLnNldE5ld0hhcmRMZXZlbCh0aGlzLmxldmVsSWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2VcbiAgICAgICAgaWYgKCF0aGlzLmlzSGFyZE1vZGUoKSkge1xuICAgICAgICAgICAgdGhpcy5sZXZlbElkKys7XG4gICAgICAgICAgICBpZiAodGhpcy5sZXZlbElkIDw9IHRoaXMuZ2V0TGV2ZWxMaXN0KCkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uc2V0TGV2ZWwodGhpcy5sZXZlbElkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubGV2ZWxJZCsrO1xuICAgICAgICAgICAgaWYgKHRoaXMubGV2ZWxJZCA8PSB0aGlzLmdldExldmVsTGlzdCgpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLnNldEhhcmRMZXZlbCh0aGlzLmxldmVsSWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIHVwZGF0ZUxldmVsU3RhcjogZnVuY3Rpb24gKGxldmVsLCBzdGFyKSB7XG4gICAgICAgIHZhciBvbGRTdGFyID0gZ2FtZS5wbGF5ZXJNYW4uZ2V0TGV2ZWxEYXRhKHRoaXMubGV2ZWxJZCwgXCJzdGFyXCIpIHx8IDA7XG4gICAgICAgIGlmIChzdGFyID4gb2xkU3Rhcikge1xuICAgICAgICAgICAgY2MubG9nKFwidXBkYXRlTGV2ZWxTdGFyOm9sZFN0YXI6XCIgKyBvbGRTdGFyICsgXCIsc3RhcjpcIiArIHN0YXIpO1xuICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4udXBkYXRlTGV2ZWxEYXRhKGxldmVsLCBcInN0YXJcIiwgc3Rhcik7XG4gICAgICAgICAgICBnYW1lLnBsYXllck1hbi51cGRhdGVMZXZlbERhdGEobGV2ZWwsIFwic3RhclRhZ1wiLCB0cnVlKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICB1cGRhdGVIYXJkTGV2ZWxTdGFyOiBmdW5jdGlvbiAobGV2ZWwsIHN0YXIpIHtcbiAgICAgICAgdmFyIG9sZFN0YXIgPSBnYW1lLnBsYXllck1hbi5nZXRMZXZlbERhdGEodGhpcy5sZXZlbElkLCBcImhhcmRTdGFyXCIpIHx8IDA7XG4gICAgICAgIGlmIChzdGFyID4gb2xkU3Rhcikge1xuICAgICAgICAgICAgY2MubG9nKFwidXBkYXRlSGFyZExldmVsU3RhcjpvbGRTdGFyOlwiICsgb2xkU3RhciArIFwiLHN0YXI6XCIgKyBzdGFyKTtcbiAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLnVwZGF0ZUxldmVsRGF0YShsZXZlbCwgXCJoYXJkU3RhclwiLCBzdGFyKTtcbiAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLnVwZGF0ZUxldmVsRGF0YShsZXZlbCwgXCJoYXJkU3RhclRhZ1wiLCB0cnVlKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICB1cGRhdGVOZXdIYXJkTGV2ZWxTdGFyOiBmdW5jdGlvbiAobGV2ZWwsIHN0YXIpIHtcbiAgICAgICAgdmFyIG9sZFN0YXIgPSBnYW1lLnBsYXllck1hbi5nZXRMZXZlbERhdGEodGhpcy5sZXZlbElkLCBcIm5ld0hhcmRTdGFyXCIpIHx8IDA7XG4gICAgICAgIGlmIChzdGFyID4gb2xkU3Rhcikge1xuICAgICAgICAgICAgY2MubG9nKFwidXBkYXRlTmV3SGFyZExldmVsU3RhcjpvbGRTdGFyOlwiICsgb2xkU3RhciArIFwiLHN0YXI6XCIgKyBzdGFyKTtcbiAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLnVwZGF0ZUxldmVsRGF0YShsZXZlbCwgXCJuZXdIYXJkU3RhclwiLCBzdGFyKTtcbiAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLnVwZGF0ZUxldmVsRGF0YShsZXZlbCwgXCJuZXdIYXJkU3RhclRhZ1wiLCB0cnVlKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByZXN1bWVHYW1lOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMubGV2ZWxJZC0tO1xuICAgIH0sXG5cbiAgICBjaG9vc2VMZXZlbDogZnVuY3Rpb24gKGxldmVsSWQpIHtcbiAgICAgICAgdGhpcy5sZXZlbElkID0gbGV2ZWxJZDtcbiAgICB9LFxuXG4gICAgZ2V0RGlzcGxheUxldmVsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxldmVsSWQ7XG4gICAgfSxcblxuICAgIGdldEN1ckNvbmZpZzogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5pc0NoYWxsZW5nZUxldmVsKSB7XG4gICAgICAgICAgICByZXR1cm4gQ29uZmlnTWFuLmdldEluc3RhbmNlKCkuZ2V0Q2hhbGxlbmdlQ29uZmlnKGdhbWUuY2hhbGxlbmdlTWFuLmN1cnJlbnRDaGFsbGVuZ2VJZCwgdGhpcy5sZXZlbElkKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzTmV3SGFyZE1vZGUoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBDb25maWdNYW4uZ2V0SW5zdGFuY2UoKS5nZXROZXdIYXJkTGV2ZWxDb25maWcodGhpcy5sZXZlbElkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBDb25maWdNYW4uZ2V0SW5zdGFuY2UoKS5nZXRMZXZlbENvbmZpZyh0aGlzLmxldmVsSWQpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGhhc05leHRMZXZlbDogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbGV2ZWxMaXN0ID0gdGhpcy5nZXRMZXZlbExpc3QoKTtcbiAgICAgICAgaWYgKHRoaXMubGV2ZWxJZCA+IGxldmVsTGlzdC5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgb25HYW1lRmFpbDogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnRvdGFsRmFpbENvdW50Kys7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNDaGFsbGVuZ2VMZXZlbCkge1xuICAgICAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiY2hhbGxlbmdlX2xldmVsX2ZhaWxcIiwge1xuICAgICAgICAgICAgICAgIFwibGV2ZWxcIjogdGhpcy5sZXZlbElkXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuYWRkRmFpbENvdW50KCk7XG4gICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcImxldmVsX2ZhaWxcIiwge1xuICAgICAgICAgICAgXCJsZXZlbFwiOiB0aGlzLmxldmVsSWRcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciBsZXZlbEdyb3VwID0gZ2FtZS5wbGF5ZXJNYW4uZ2V0UmVhbEdyb3VwKGdhbWUuYWJUZXN0VHlwZS5MZXZlbCk7XG4gICAgICAgIGlmIChsZXZlbEdyb3VwICYmIGxldmVsR3JvdXAubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwibGV2ZWxfZmFpbF9cIiArIGxldmVsR3JvdXAsIHtcbiAgICAgICAgICAgICAgICBcImxldmVsXCI6IHRoaXMubGV2ZWxJZFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci5taXNzaW9uRmFpbGVkKHRoaXMuZ2V0TWlzc2lvbktleSgpLCBcIm5vcm1hbF9mYWlsXCIpO1xuICAgIH0sXG5cbiAgICBhZGRGYWlsQ291bnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uYWRkRmFpbENvdW50KHRoaXMubGV2ZWxJZCk7XG4gICAgfSxcblxuICAgIHNob3dSZWdpc3Rlck5vdGlmaWNhdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5yZXN1bHRDb3VudCA+IDAgJiYgdGhpcy5yZXN1bHRDb3VudCAlIDMgPT09IDApIHtcbiAgICAgICAgICAgIGdhbWUubG9naWNNYW4ucmVnaXN0ZXJOb3RpZmljYXRpb24oKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzaG93UmF0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgY291bnQgPSA0O1xuICAgICAgICB2YXIgY2FuU2hvd1JhdGUgPSBmYWxzZTtcbiAgICAgICAgdmFyIGxhc3RTaG93ZWRSYXRlRGF5ID0gTWF0aC5mbG9vcigoRGF0ZS5ub3coKSAtIGdhbWUucGxheWVyTWFuLnBsYXllci5sYXN0U2hvd1JhdGVUaW1lKSAvICgzNjAwICogMTAwMCkpO1xuICAgICAgICBjYW5TaG93UmF0ZSA9IGxhc3RTaG93ZWRSYXRlRGF5ID49IDY7XG4gICAgICAgIGlmICghdGhpcy5yYXRlZCAmJiAodGhpcy5yZXN1bHRDb3VudCA+IDAgJiYgdGhpcy5yZXN1bHRDb3VudCAlIGNvdW50ID09PSAwKSAmJiBjYW5TaG93UmF0ZSkge1xuICAgICAgICAgICAgaWYgKCFnYW1lLnJhdGVNYW5hZ2VyLmxhdW5jaEFwcFJldmlldygpKSB7XG4gICAgICAgICAgICAgICAgLy8gZ2FtZS5wb3B1cE1hbi5wb3B1cFJhdGVEbGcoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIC8vICAgICB0aGlzLnJhdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAvLyAgICAgZ2FtZS5wbGF5ZXJNYW4uc2V0UmF0ZWQodHJ1ZSk7XG4gICAgICAgICAgICAgICAgLy8gfS5iaW5kKHRoaXMpLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgLy8gICAgIHRoaXMucmF0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIC8vICAgICAvL3RoaXMuc2hvd0FkcyhzdWNjZXNzKTtcbiAgICAgICAgICAgICAgICAvLyB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yYXRlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRMYXN0U2hvd1JhdGVUaW1lKCk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByZXN0YXJ0R2FtZTogZnVuY3Rpb24gKCkge1xuICAgICAgICBnYW1lLmxvZ2ljTWFuLnJlZ2lzdGVyTm90aWZpY2F0aW9uKCk7XG4gICAgICAgIHRoaXMuc3RhcnRHYW1lKCk7XG4gICAgICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQoRXZlbnRzTmFtZS5FVkVOVF9OQU1FX1VQREFURV9TQ09SRSk7XG4gICAgICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQoRXZlbnRzTmFtZS5FVkVOVF9OQU1FX1VQREFURV9CR19TUFJJVEUpO1xuICAgIH0sXG5cbiAgICBzdGFydEdhbWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy9nYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrU3RhcnRQcm9ncmVzc2lvbkV2ZW50KFwibGV2ZWxcIiwgZ2FtZS5wbGF5ZXJNYW4uZ2V0TGV2ZWwoKSk7XG4gICAgfSxcblxuICAgIGVudGVyR2FtZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAvL2dhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tTdGFydFByb2dyZXNzaW9uRXZlbnQoXCJsZXZlbFwiLCBnYW1lLnBsYXllck1hbi5nZXRMZXZlbCgpKTtcbiAgICB9LFxuXG4gICAgbGVhdmVHYW1lOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuc3RhcnRUaW1lID0gMDtcbiAgICAgICAgdGhpcy5kaXN0YW5jZSA9IDA7XG4gICAgfSxcblxuICAgIGNhblNob3dSZXdhcmRlZFZpZGVvOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAodGhpcy5jYW5SZUxpZmUgJiYgZ2FtZS5hZHNNYW5hZ2VyLmlzUmV3YXJkVmlkZW9SZWFkeSgpKTtcbiAgICB9LFxuXG4gICAgZ2V0U2hhcmVDb25maWc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNoYXJlTGlzdCA9IENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldFNoYXJlTGlzdCgpO1xuICAgICAgICB2YXIgcmFuZG9tTnVtID0gZ2FtZS51dGlscy5yYW5kb21OZXh0SW50KHNoYXJlTGlzdC5sZW5ndGgpO1xuICAgICAgICByZXR1cm4gc2hhcmVMaXN0W3JhbmRvbU51bV07XG4gICAgfSxcblxuICAgIGdldEZyaWVuZEhlbHBTaGFyZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZGVzYyA9IGdhbWUudXRpbHMuc3ByaW50ZihcIuegluWdl+egtOWdj+iAheaIkeW3sue7jyVk5YWz5LqG77yM5biu5oiR57un57ut546p77yM6K6p5oiR5Yay5LiK5qac6aaW44CCXCIsIGdhbWUucGxheWVyTWFuLmdldExldmVsKCkpO1xuICAgICAgICB2YXIgc2hhcmVDb25maWcgPSB0aGlzLmdldFNoYXJlQ29uZmlnKCk7XG4gICAgICAgIHZhciBzaGFyZSA9IHNoYXJlQ29uZmlnLmNvcHkoKTtcbiAgICAgICAgc2hhcmUuZGVzYyA9IGRlc2M7XG4gICAgICAgIHJldHVybiBzaGFyZTtcbiAgICB9LFxuXG4gICAgZ2V0RnJpZW5kQ2hhbGxlbmdlU2hhcmU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGRlc2MgPSBnYW1lLnV0aWxzLnNwcmludGYoXCLnoJblnZfnoLTlnY/ogIXmiJHlt7Lnu48lZOWFs+S6hu+8jOS9oOiDvei2hei2iuaIkeWQl++8n1wiLCBnYW1lLnBsYXllck1hbi5nZXRMZXZlbCgpKTtcbiAgICAgICAgdmFyIHNoYXJlQ29uZmlnID0gdGhpcy5nZXRTaGFyZUNvbmZpZygpO1xuICAgICAgICB2YXIgc2hhcmUgPSBzaGFyZUNvbmZpZy5jb3B5KCk7XG4gICAgICAgIHNoYXJlLmRlc2MgPSBkZXNjO1xuICAgICAgICByZXR1cm4gc2hhcmU7XG4gICAgfSxcblxuICAgIGdldFdoZWVsTGVmdFRpbWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGxhc3RXaGVlbFRpbWUgPSBnYW1lLnBsYXllck1hbi5nZXRMYXN0V2hlZWxUaW1lKCk7XG4gICAgICAgIHJldHVybiAobGFzdFdoZWVsVGltZSArIHRoaXMuRlJFRV9XSEVFTF9IT1VSUyAqIHRoaXMuT05FX0hPVVJfU0VDT05EUyAtIERhdGUubm93KCkpO1xuICAgIH0sXG5cbiAgICBpc0ZyZWVXaGVlbDogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbGVmdFRpbWUgPSB0aGlzLmdldFdoZWVsTGVmdFRpbWUoKTtcbiAgICAgICAgaWYgKGxlZnRUaW1lIDw9IDApIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgLy8gYWRkR2lmdENvdW50OiBmdW5jdGlvbiAoKSB7XG4gICAgLy8gICAgIHRoaXMuZ2lmdENvdW50Kys7XG4gICAgLy8gfSxcbiAgICAvL1xuICAgIC8vIGNhblNob3dHaWZ0OiBmdW5jdGlvbiAoKSB7XG4gICAgLy8gICAgIHJldHVybiBmYWxzZTtcbiAgICAvLyAgICAgaWYgKHRoaXMubGV2ZWxJZCA+PSA5KSB7XG4gICAgLy8gICAgICAgICBpZiAodGhpcy5sZXZlbElkICUgMyA9PT0gMCkge1xuICAgIC8vICAgICAgICAgICAgIGlmICh0aGlzLmdpZnRDb3VudCA8IDMpIHtcbiAgICAvLyAgICAgICAgICAgICAgICAgdGhpcy5sYXN0U2hvd0xldmVsID0gdGhpcy5sZXZlbElkO1xuICAgIC8vICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAvLyAgICAgICAgICAgICB9XG4gICAgLy8gICAgICAgICB9XG4gICAgLy8gICAgIH1cbiAgICAvLyAgICAgcmV0dXJuIGZhbHNlO1xuICAgIC8vIH0sXG5cbiAgICBnZXRDdXJyZW50U2tpbkNmZzogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgY3VycmVudFNraW5JZCA9IGdhbWUucGxheWVyTWFuLmdldEN1cnJlbnRTa2luSWQoKTtcbiAgICAgICAgdmFyIHNraW5DZmcgPSBDb25maWdNYW4uZ2V0SW5zdGFuY2UoKS5nZXRTa2luQ2ZnKGN1cnJlbnRTa2luSWQpO1xuICAgICAgICByZXR1cm4gc2tpbkNmZztcbiAgICB9LFxuXG4gICAgZ2V0Q3VycmVudEJvYXJkQ2ZnOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjdXJyZW50Qm9hcmRJZCA9IGdhbWUucGxheWVyTWFuLmdldEN1cnJlbnRCb2FyZElkKCk7XG4gICAgICAgIHZhciBza2luQ2ZnID0gQ29uZmlnTWFuLmdldEluc3RhbmNlKCkuZ2V0Qm9hcmRDZmcoY3VycmVudEJvYXJkSWQpO1xuICAgICAgICByZXR1cm4gc2tpbkNmZztcbiAgICB9LFxuXG4gICAgdXBkYXRlU2tpbjogZnVuY3Rpb24gKHNwcml0ZSkge1xuICAgICAgICB2YXIgc2tpbkNmZyA9IHRoaXMuZ2V0Q3VycmVudFNraW5DZmcoKTtcbiAgICAgICAgdmFyIHNwcml0ZUZyYW1lID0gY2Muc3ByaXRlRnJhbWVDYWNoZS5nZXRTcHJpdGVGcmFtZShza2luQ2ZnLmltYWdlICsgXCIucG5nXCIpO1xuICAgICAgICBpZiAoc3ByaXRlRnJhbWUpIHtcbiAgICAgICAgICAgIHNwcml0ZS5zZXRTcHJpdGVGcmFtZShzcHJpdGVGcmFtZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgZGVmYXVsdFNwcml0ZUZyYW1lID0gY2Muc3ByaXRlRnJhbWVDYWNoZS5nZXRTcHJpdGVGcmFtZShcInNraW5fMC5wbmdcIik7XG4gICAgICAgICAgICBzcHJpdGUuc2V0U3ByaXRlRnJhbWUoZGVmYXVsdFNwcml0ZUZyYW1lKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBjaGVja0F1dG9Qb3B1cDogZnVuY3Rpb24gKGZpcnN0RW50ZXIpIHtcbiAgICAgICAgLy8gaWYgKCF0aGlzLmNoZWNrRGFpbHlCb251cygpKSB7XG4gICAgICAgIC8vICAgICBpZiAoIXRoaXMuY2hlY2tXaGVlbCgpKSB7XG4gICAgICAgIC8vICAgICAgICAgaWYgKCF0aGlzLmNoZWNrV2F0Y2hBZHNHZXREaWFtb25kcygpKSB7XG4gICAgICAgIC8vICAgICAgICAgICAgIGlmICghdGhpcy5jaGVja0FjdGl2aXR5VGFzaygpKSB7XG4gICAgICAgIC8vICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuY2hlY2tTcGVjaWFsT2ZmZXIoKSkge1xuICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIGlmICghZmlyc3RFbnRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL+esrOS6jOWkqeWlluWKsXRpcHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmNoZWNrTmV4dERheVRpcCgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL+eci+W5v+WRiuiOt+W+l+mSu+efs1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmNoZWNrV2F0Y2hBZHNHZXREaWFtb25kcygpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy/nnIvlub/lkYrojrflvpfnmq7ogqRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuY2hlY2tXYXRjaEFkc0dldFNraW4oKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL+eci+W5v+WRiuaJk+W8gOWuneeusVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNoZWNrV2F0Y2hBZHNPcGVuQm94KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgLy8gfVxuICAgICAgICAvLyB9XG4gICAgfSxcblxuICAgIGFkZENoZWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuY3VycmVudENoZWNrSW5kZXggPSAtMTtcblxuICAgICAgICB0aGlzLmNoZWNrQXJyYXkgPSBbXTtcbiAgICAgICAgdGhpcy5jaGVja0FycmF5LnB1c2godGhpcy5jaGVja0RhaWx5Qm9udXMuYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMuY2hlY2tBcnJheS5wdXNoKHRoaXMuY2hlY2tXaGVlbC5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5jaGVja0FycmF5LnB1c2godGhpcy5jaGVja0FjdGl2aXR5VGFzay5iaW5kKHRoaXMpKTtcbiAgICAgICAgLy8gdGhpcy5jaGVja0FycmF5LnB1c2godGhpcy5jaGVja1dhdGNoQWRzR2V0RGlhbW9uZHMuYmluZCh0aGlzKSk7XG4gICAgfSxcblxuICAgIG9uQ2hlY2tOZXh0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5jaGVja0FycmF5KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jdXJyZW50Q2hlY2tJbmRleCsrO1xuICAgICAgICBpZiAodGhpcy5jdXJyZW50Q2hlY2tJbmRleCA8IHRoaXMuY2hlY2tBcnJheS5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuY2hlY2tBcnJheVt0aGlzLmN1cnJlbnRDaGVja0luZGV4XSh0aGlzKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBjaGVja05leHREYXlUaXA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMucmVzdWx0Q291bnQgPj0gMykge1xuICAgICAgICAgICAgaWYgKCFnYW1lLnBsYXllck1hbi5wbGF5ZXIubmV4dERheVRpcHMpIHtcbiAgICAgICAgICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwUmV3YXJkRGxnKF8oXCJuZXh0X2RheV90aXBzXCIpLFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIH0sIFwiaWNvbl9naWZ0cy5wbmdcIiwgMSk7XG4gICAgICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uc2V0TmV4dERheVRpcHMoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIGNoZWNrRGFpbHlCb251czogZnVuY3Rpb24gKCkge1xuICAgICAgICBjYy5sb2coXCJnYW1lLmdhbWVNYW4uY2hlY2tEYWlseUJvbnVzXCIpO1xuICAgICAgICB2YXIgbGFzdENsYWltRGF5ID0gZ2FtZS5wbGF5ZXJNYW4ucGxheWVyLmxhc3RDbGFpbURhaWx5Qm9udXNEYXk7XG4gICAgICAgIHZhciBjdXJyZW50RGF5Q2xhaW1lZCA9IGxhc3RDbGFpbURheSA+PSBnYW1lLnV0aWxzLmdldERheUJ5VHMoRGF0ZS5ub3coKSk7XG4gICAgICAgIGlmICghY3VycmVudERheUNsYWltZWQpIHtcbiAgICAgICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBEYWlseUJvbnVzKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9uQ2hlY2tOZXh0KCk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5vbkNoZWNrTmV4dCgpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIGNoZWNrQWN0aXZpdHlUYXNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNjLmxvZyhcImdhbWUuZ2FtZU1hbi5jaGVja0FjdGl2aXR5VGFza1wiKTtcbiAgICAgICAgaWYgKGdhbWUuYWN0aXZpdHlNYW4uY2FuU2hvd0FjdGl2aXR5RW50cmFuY2UoKSAmJiAhZ2FtZS5wbGF5ZXJNYW4ucGxheWVyLmRhaWx5VGFza1BvcGVkKSB7XG4gICAgICAgICAgICBnYW1lLnBsYXllck1hbi5zZXREYWlseVRhc2tQb3BlZCgpO1xuICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cEFjdGl2aXR5VGFzayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vbkNoZWNrTmV4dCgpO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMub25DaGVja05leHQoKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICBjaGVja1NwZWNpYWxPZmZlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5pc1NwZWNpYWxPZmZlclB1cmNoYXNlZCgpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLnNob3dlZFNwZWNpYWxPZmZlcikge1xuICAgICAgICAgICAgdGhpcy5zaG93ZWRTcGVjaWFsT2ZmZXIgPSB0cnVlO1xuICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFNwZWljaWFsT2ZmZXIoKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgY2hlY2tXaGVlbDogZnVuY3Rpb24gKCkge1xuICAgICAgICBjYy5sb2coXCJnYW1lLmdhbWVNYW4uY2hlY2tXaGVlbFwiKTtcbiAgICAgICAgaWYgKCF0aGlzLnNob3dlZFdoZWVsKSB7XG4gICAgICAgICAgICB0aGlzLnNob3dlZFdoZWVsID0gdHJ1ZTtcbiAgICAgICAgICAgIHZhciBsZWZ0VGltZSA9IEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5nZXRXaGVlbExlZnRUaW1lKCk7XG4gICAgICAgICAgICBpZiAobGVmdFRpbWUgPD0gMCkge1xuICAgICAgICAgICAgICAgIHZhciBXaGVlbFR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9XaGVlbFR5cGVcIik7XG4gICAgICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFdoZWVsRGxnKFdoZWVsVHlwZS5EYWlseUJvbnVzLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25DaGVja05leHQoKTtcbiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMub25DaGVja05leHQoKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICBpc1NwZWNpYWxPZmZlclB1cmNoYXNlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgc3BlY2lhbE9mZmVyID0gQ29uZmlnTWFuLmdldEluc3RhbmNlKCkuZ2V0U3BlY2lhbE9mZmVyQ2ZnKCk7XG4gICAgICAgIGlmICghc3BlY2lhbE9mZmVyKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgcHVyY2hhc2VkID0gZ2FtZS5wbGF5ZXJNYW4uaXNTcGVjaWFsT2ZmZXJQdXJjaGFzZWQoc3BlY2lhbE9mZmVyLnBpZCk7XG4gICAgICAgIGNjLmxvZyhcImlzU3BlY2lhbE9mZmVyUHVyY2hhc2VkOlwiICsgcHVyY2hhc2VkKTtcbiAgICAgICAgcmV0dXJuIHB1cmNoYXNlZDtcbiAgICB9LFxuXG4gICAgYWRqdXN0U2tpbkNvbmZpZ3M6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy9pZiAoZ2FtZS5wbGF5ZXJNYW4ucGxheWVyLnNraW5BZGp1c3RlZCkge1xuICAgICAgICAvLyAgICByZXR1cm47XG4gICAgICAgIC8vfVxuICAgICAgICAvL2dhbWUucGxheWVyTWFuLnNldFNraW5BZGp1c3RlZCgpO1xuICAgICAgICAvL3ZhciBvbGRUYXNrQ29uZmlncyA9IENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldE9sZFRhc2tMaXN0KCk7XG4gICAgICAgIC8vZm9yICh2YXIgaSA9IDA7IGkgPCBvbGRUYXNrQ29uZmlncy5sZW5ndGg7ICsraSkge1xuICAgICAgICAvLyAgICB2YXIgb2xkVGFza0NvbmZpZyA9IG9sZFRhc2tDb25maWdzW2ldO1xuICAgICAgICAvLyAgICB0aGlzLmFkanVzdE9sZFRhc2tDb25maWcob2xkVGFza0NvbmZpZyk7XG4gICAgICAgIC8vfVxuICAgIH0sXG5cbiAgICBhZGp1c3RPbGRUYXNrQ29uZmlnOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICB2YXIgU2tpblJld2FyZFR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9Ta2luUmV3YXJkVHlwZVwiKTtcbiAgICAgICAgdmFyIGNvbXBsZXRlZCA9IGZhbHNlO1xuICAgICAgICBzd2l0Y2ggKGRhdGEudHlwZSkge1xuICAgICAgICAgICAgY2FzZSBTa2luUmV3YXJkVHlwZS5Ob25lOlxuICAgICAgICAgICAgICAgIGNvbXBsZXRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFNraW5SZXdhcmRUeXBlLkxldmVsQ291bnQ6XG4gICAgICAgICAgICAgICAgaWYgKGdhbWUucGxheWVyTWFuLmdldExldmVsKCkgPj0gZGF0YS5jb3VudCkge1xuICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgU2tpblJld2FyZFR5cGUuV2F0Y2hBZENvdW50OlxuICAgICAgICAgICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5wbGF5ZXIuaW50ZXJzdGl0aWFsQWRDb3VudCA+PSBkYXRhLmNvdW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBTa2luUmV3YXJkVHlwZS5XYXRjaFJld2FyZEFkQ291bnQ6XG4gICAgICAgICAgICAgICAgaWYgKGdhbWUucGxheWVyTWFuLnBsYXllci5yZXdhcmRlZEFkQ291bnQgPj0gZGF0YS5jb3VudCkge1xuICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgU2tpblJld2FyZFR5cGUuQ2xhaW1lZDpcbiAgICAgICAgICAgICAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4uaGFzU2tpbihkYXRhLmlkKSkge1xuICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgU2tpblJld2FyZFR5cGUuUHVyY2hhc2U6XG4gICAgICAgICAgICAgICAgaWYgKGdhbWUucGxheWVyTWFuLmhhc1NraW4oZGF0YS5pZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY29tcGxldGVkKSB7XG4gICAgICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRDbGFpbWVkU2tpbihkYXRhLmlkKTtcbiAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLnNldFRhc2tDbGFpbWVkKGRhdGEuaWQpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGhhc0NvbXBsZXRlZFRhc2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRhc2tDb25maWdzID0gQ29uZmlnTWFuLmdldEluc3RhbmNlKCkuZ2V0VGFza0xpc3QoKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0YXNrQ29uZmlncy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdmFyIHRhc2tDb25maWcgPSB0YXNrQ29uZmlnc1tpXTtcbiAgICAgICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5pc1Rhc2tDbGFpbWVkKHRhc2tDb25maWcuaWQpKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5pc1Rhc2tDb21wbGV0ZWQodGFza0NvbmZpZykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIGlzVGFza0NvbXBsZXRlZDogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgdmFyIFNraW5SZXdhcmRUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vU2tpblJld2FyZFR5cGVcIik7XG4gICAgICAgIHZhciBjb21wbGV0ZWQgPSBmYWxzZTtcbiAgICAgICAgc3dpdGNoIChkYXRhLnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgU2tpblJld2FyZFR5cGUuTm9uZTpcbiAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBTa2luUmV3YXJkVHlwZS5MZXZlbENvdW50OlxuICAgICAgICAgICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5nZXRMZXZlbCgpID49IGRhdGEuY291bnQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFNraW5SZXdhcmRUeXBlLldhdGNoQWRDb3VudDpcbiAgICAgICAgICAgICAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4ucGxheWVyLmludGVyc3RpdGlhbEFkQ291bnQgPj0gZGF0YS5jb3VudCkge1xuICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgU2tpblJld2FyZFR5cGUuV2F0Y2hSZXdhcmRBZENvdW50OlxuICAgICAgICAgICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5wbGF5ZXIucmV3YXJkZWRBZENvdW50ID49IGRhdGEuY291bnQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFNraW5SZXdhcmRUeXBlLkNsYWltZWQ6XG4gICAgICAgICAgICAgICAgaWYgKGdhbWUucGxheWVyTWFuLmhhc1NraW4oZGF0YS5pZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFNraW5SZXdhcmRUeXBlLlB1cmNoYXNlOlxuICAgICAgICAgICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5oYXNTa2luKGRhdGEuaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb21wbGV0ZWQ7XG4gICAgfSxcblxuICAgIGNhblNraXA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGZhaWxDb3VudCA9IGdhbWUucGxheWVyTWFuLmdldEZhaWxDb3VudCh0aGlzLmxldmVsSWQpO1xuICAgICAgICBjYy5sb2coXCJza2lwIGZhaWwgY291bnQ6XCIgKyBmYWlsQ291bnQpO1xuICAgICAgICBpZiAoZmFpbENvdW50IDw9IDMpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNob3dGaXJzdEVudGVySG9tZUFkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLmZpcnN0RW50ZXJBZFNob3dlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZmlyc3RFbnRlckFkU2hvd2VkID0gdHJ1ZTtcbiAgICAgICAgLy9jYy5sb2coXCJmaXJzdCBlbnRlciBhZHMgMVwiKTtcbiAgICAgICAgaWYgKGdhbWUucGxheWVyTWFuLmdldExldmVsKCkgPj0gNCkge1xuICAgICAgICAgICAgLy9jYy5sb2coXCJmaXJzdCBlbnRlciBhZHMgMlwiKTtcbiAgICAgICAgICAgIGlmIChnYW1lLmFkc01hbmFnZXIuc2hvd0ZpcnN0RW50ZXJBZCkge1xuICAgICAgICAgICAgICAgIC8vY2MubG9nKFwiZmlyc3QgZW50ZXIgYWRzIDM6IHJlZ2lzdGVyIGRheTpcIiArIGdhbWUuYWRzTWFuYWdlci5nZXRSZWdpc3RlckRheSgpKTtcbiAgICAgICAgICAgICAgICBpZiAoZ2FtZS5hZHNNYW5hZ2VyLmdldFJlZ2lzdGVyRGF5KCkgPj0gZ2FtZS5hZHNNYW5hZ2VyLmZpcnN0RW50ZXJTaG93QWREYXkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9jYy5sb2coXCJmaXJzdCBlbnRlciBhZHMgNFwiKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxhc3RMb2dpbkRheSA9IGdhbWUudXRpbHMuZ2V0RGF5QnlUcyhnYW1lLnBsYXllck1hbi5wbGF5ZXIubGFzdExvZ2luVGltZSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50RGF5ID0gZ2FtZS51dGlscy5nZXREYXlCeVRzKERhdGUubm93KCkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobGFzdExvZ2luRGF5ID09PSBjdXJyZW50RGF5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL2NjLmxvZyhcImZpcnN0IGVudGVyIGFkcyA1XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnREYXkgLSBsYXN0TG9naW5EYXkgPj0gNSAqIDEwMDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2NjLmxvZyhcImZpcnN0IGVudGVyIGFkcyA2XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuYWRzTWFuYWdlci5zaG93SW50ZXJzdGl0aWFsKEFkc1BsYWNlLkZpcnN0RW50ZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGdhbWUucGxheWVyTWFuLnNldExhc3RMb2dpblRpbWUoKTtcbiAgICB9LFxuXG4gICAgY2hlY2tXYXRjaEFkc0dldFNraW46IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMud2F0Y2hBZHNNYXAuc2tpbi5jb3VudCA+PSBnYW1lLmFkc01hbmFnZXIuc2tpbk1heFBvcENvdW50KSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIFNraW5UeXBlID0gcmVxdWlyZShcIi4uL2VudW0vU2tpblR5cGVcIik7XG4gICAgICAgIHZhciBza2luTGlzdCA9IENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldFNraW5MaXN0QnlUeXBlKFNraW5UeXBlLldhdGNoQWRzKTtcbiAgICAgICAgdmFyIHN1aXRhYmxlU2tpbkxpc3QgPSBbXTtcbiAgICAgICAgdmFyIHNraW5DZmc7XG4gICAgICAgIHZhciBsZWZ0V2F0Y2hBZHNDb3VudEVxdWFsMTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBza2luTGlzdC5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgc2tpbkNmZyA9IHNraW5MaXN0W2ldO1xuICAgICAgICAgICAgdmFyIG93bmVkID0gZ2FtZS5wbGF5ZXJNYW4uaGFzU2tpbihza2luQ2ZnLmlkKTtcbiAgICAgICAgICAgIHZhciBpc1dhdGNoQWRzVHlwZSA9IChza2luQ2ZnLnR5cGUgPT09IFNraW5UeXBlLldhdGNoQWRzKTtcbiAgICAgICAgICAgIGlmIChpc1dhdGNoQWRzVHlwZSkge1xuICAgICAgICAgICAgICAgIGxlZnRXYXRjaEFkc0NvdW50RXF1YWwxID0gKHNraW5DZmcuY291bnQgLSBnYW1lLnBsYXllck1hbi5nZXRTa2luQWRzQ291bnQoc2tpbkNmZy5pZCkpID09PSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFvd25lZCAmJiBpc1dhdGNoQWRzVHlwZSAmJiBsZWZ0V2F0Y2hBZHNDb3VudEVxdWFsMSkge1xuICAgICAgICAgICAgICAgIHN1aXRhYmxlU2tpbkxpc3QucHVzaChza2luQ2ZnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoc3VpdGFibGVTa2luTGlzdC5sZW5ndGggPD0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHZhciByYW5kb21JbmRleCA9IGdhbWUudXRpbHMucmFuZG9tTmV4dEludChzdWl0YWJsZVNraW5MaXN0Lmxlbmd0aCk7XG4gICAgICAgIHNraW5DZmcgPSBzdWl0YWJsZVNraW5MaXN0W3JhbmRvbUluZGV4XTtcbiAgICAgICAgaWYgKHNraW5DZmcpIHtcbiAgICAgICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBXYXRjaEFkc0dldFNraW4oc2tpbkNmZyk7XG4gICAgICAgICAgICB0aGlzLndhdGNoQWRzTWFwLnNraW4uY291bnQrKztcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgZ2V0V2hlZWxSYW5kb21Ta2luOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBTa2luVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1NraW5UeXBlXCIpO1xuICAgICAgICB2YXIgc2tpbkxpc3QgPSBDb25maWdNYW4uZ2V0SW5zdGFuY2UoKS5nZXRTa2luTGlzdEJ5VHlwZShTa2luVHlwZS5XYXRjaEFkcyk7XG4gICAgICAgIHNraW5MaXN0ID0gc2tpbkxpc3QuY29uY2F0KENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldFNraW5MaXN0QnlUeXBlKFNraW5UeXBlLkRpYW1vbmRzKSk7XG4gICAgICAgIHZhciBzdWl0YWJsZVNraW5MaXN0ID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2tpbkxpc3QubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciBza2luQ2ZnID0gc2tpbkxpc3RbaV07XG4gICAgICAgICAgICB2YXIgb3duZWQgPSBnYW1lLnBsYXllck1hbi5oYXNTa2luKHNraW5DZmcuaWQpO1xuICAgICAgICAgICAgaWYgKCFvd25lZCkge1xuICAgICAgICAgICAgICAgIHN1aXRhYmxlU2tpbkxpc3QucHVzaChza2luQ2ZnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoc3VpdGFibGVTa2luTGlzdC5sZW5ndGggPD0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN1aXRhYmxlU2tpbkxpc3RbZ2FtZS51dGlscy5yYW5kb21OZXh0SW50KHN1aXRhYmxlU2tpbkxpc3QubGVuZ3RoKV07XG4gICAgfSxcblxuXG5cbiAgICBsYXN0UG9wQ291bnQ6IDAsXG4gICAgY3VycmVudFN0ZXA6IDIsXG4gICAgLy8wIG1lYW4gc3RpbGwgY2FuIHBvcCwgPjAgbWVhbiBzdG9wIHBvcC5cbiAgICBhbGxQb3BlZFJlc3VsdDogMCxcblxuICAgIHRyeVNob3dQYXNzUG9wdXA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHBvcGVkID0gZmFsc2U7XG4gICAgICAgIGlmICh0aGlzLmxldmVsSWQgPiBnYW1lLmFkc01hbmFnZXIucG9wdXBMZXZlbExpbWl0ICYmIHRoaXMucmVzdWx0Q291bnQgPiAwKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5yZXN1bHRDb3VudCAtIHRoaXMubGFzdFBvcENvdW50ID49IHRoaXMuY3VycmVudFN0ZXApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxhc3RQb3BDb3VudCA9IHRoaXMucmVzdWx0Q291bnQ7XG4gICAgICAgICAgICAgICAgcG9wZWQgPSB0aGlzLmNoZWNrTWluUG9wRGlhbG9nKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnRyeVJlc2V0UG9wQ291bnQoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcG9wZWQ7XG4gICAgfSxcblxuICAgIHRyeVNob3dSZXdhcmRSZW1vdmVBZHM6IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAvLyBpZiAoZ2FtZS5hZHNNYW5hZ2VyLmlzUmVtb3ZlZEFkcygpKSB7XG4gICAgICAgIC8vICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIC8vIH1cbiAgICAgICAgLy9cbiAgICAgICAgLy8gaWYgKGdhbWUuYWRzTWFuYWdlci5pc0ludGVyc3RpdGlhbERpc2FibGVkKCkpIHtcbiAgICAgICAgLy8gICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgLy8gfVxuICAgICAgICAvL1xuICAgICAgICAvLyBpZiAoIXRoaXMuZGlzYWJsZUludGVyc3RpdGlhbFBvcHVwICYmIHRoaXMubGV2ZWxJZCA+IGdhbWUuYWRzTWFuYWdlci5yZXdhcmRSZW1vdmVBZHNMZXZlbExpbWl0KSB7XG4gICAgICAgIC8vICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIC8vICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwUmV3YXJkUmVtb3ZlQWRzKGZ1bmN0aW9uIChyZW1vdmVkKSB7XG4gICAgICAgIC8vICAgICAgICAgaWYgKCFyZW1vdmVkKSB7XG4gICAgICAgIC8vICAgICAgICAgICAgIHNlbGYuZGlzYWJsZUludGVyc3RpdGlhbFBvcHVwID0gdHJ1ZTtcbiAgICAgICAgLy8gICAgICAgICB9XG4gICAgICAgIC8vICAgICB9KTtcbiAgICAgICAgLy8gICAgIHJldHVybiB0cnVlO1xuICAgICAgICAvLyB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgdHJ5UmVzZXRQb3BDb3VudDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5hbGxQb3BlZFJlc3VsdCA+IDAgJiYgdGhpcy5yZXN1bHRDb3VudCAtIHRoaXMuYWxsUG9wZWRSZXN1bHQgPiBnYW1lLmFkc01hbmFnZXIucG9wdXBSZXNldExpbWl0KSB7XG4gICAgICAgICAgICB0aGlzLmFsbFBvcGVkUmVzdWx0ID0gMDtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy53YXRjaEFkc0xpc3QubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IHRoaXMud2F0Y2hBZHNMaXN0W2ldO1xuICAgICAgICAgICAgICAgIGl0ZW0uY291bnQgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGNoZWNrTWluUG9wRGlhbG9nOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMud2F0Y2hBZHNMaXN0LnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgICAgcmV0dXJuIChhLmNvdW50IC0gYi5jb3VudCk7XG4gICAgICAgIH0pO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMud2F0Y2hBZHNMaXN0Lmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB2YXIgaXRlbSA9IHRoaXMud2F0Y2hBZHNMaXN0W2ldO1xuICAgICAgICAgICAgaWYgKGl0ZW0uY2FsbGJhY2soKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuYWxsUG9wZWRSZXN1bHQgPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuYWxsUG9wZWRSZXN1bHQgPSB0aGlzLnJlc3VsdENvdW50O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgdHJ5U2hvd0ZhaWxQb3B1cDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5sZXZlbElkID4gZ2FtZS5hZHNNYW5hZ2VyLnBvcHVwTGV2ZWxMaW1pdCAmJiB0aGlzLnRvdGFsRmFpbENvdW50ID4gMCAmJiB0aGlzLnRvdGFsRmFpbENvdW50ICUgMiA9PT0gMCkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmNoZWNrV2F0Y2hBZHNHZXREaWFtb25kcygpKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmNoZWNrV2F0Y2hBZHNPcGVuQm94KCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tXYXRjaEFkc0ZsaXBDYXJkKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIGNoZWNrV2F0Y2hBZHNPcGVuQm94OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLndhdGNoQWRzTWFwLmJveC5jb3VudCA+PSBnYW1lLmFkc01hbmFnZXIuYm94TWF4UG9wQ291bnQpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwV2F0Y2hBZHNHZXRJdGVtKF8oXCJyZXdhcmRfdmlkZW9fb3Blbl9ib3hcIiksIFwiaWNvbl9naWZ0X2JveC5wbmdcIiwgXCJvcGVuX2JveFwiLCBmdW5jdGlvbiAod2F0Y2hlZCkge1xuICAgICAgICAgICAgaWYgKHdhdGNoZWQpIHtcbiAgICAgICAgICAgICAgICBTdG9yZUhlbHBlci5nZXRJbnN0YW5jZSgpLm9uT3BlbkJveCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy53YXRjaEFkc01hcC5ib3guY291bnQrKztcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIGNoZWNrV2F0Y2hBZHNGbGlwQ2FyZDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy53YXRjaEFkc01hcC5jYXJkLmNvdW50ID49IGdhbWUuYWRzTWFuYWdlci5jYXJkTWF4UG9wQ291bnQpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwV2F0Y2hBZHNHZXRJdGVtKF8oXCJvcGVuX3RpdGxlXCIpLCBcImljb25fY2FyZC5wbmdcIiwgXCJmbGlwX2NhcmRcIiwgZnVuY3Rpb24gKHdhdGNoZWQpIHtcbiAgICAgICAgICAgIGlmICh3YXRjaGVkKSB7XG4gICAgICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cENhcmQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMud2F0Y2hBZHNNYXAuY2FyZC5jb3VudCsrO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgY2hlY2tXYXRjaEFkc0dldERpYW1vbmRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNjLmxvZyhcImdhbWUuZ2FtZU1hbi5jaGVja1dhdGNoQWRzR2V0RGlhbW9uZHNcIik7XG4gICAgICAgIHZhciBsYXN0RGFpbHlEaWFtb25kVGltZSA9IGdhbWUucGxheWVyTWFuLnBsYXllci5sYXN0RGFpbHlEaWFtb25kVGltZTtcbiAgICAgICAgdmFyIGxhc3RQb3BEYXkgPSBnYW1lLnV0aWxzLmdldERheUJ5VHMobGFzdERhaWx5RGlhbW9uZFRpbWUpO1xuICAgICAgICB2YXIgY3VycmVudERheSA9IGdhbWUudXRpbHMuZ2V0RGF5QnlUcyhEYXRlLm5vdygpKTtcbiAgICAgICAgaWYgKGN1cnJlbnREYXkgPD0gbGFzdFBvcERheSkge1xuICAgICAgICAgICAgdGhpcy5vbkNoZWNrTmV4dCgpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGdhbWUucGxheWVyTWFuLnNldExhc3REYWlseURpYW1vbmRzVGltZSgpO1xuICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwV2F0Y2hBZHNHZXREaWFtb25kcyhcImRhaWx5X2RpYW1vbmRzXCIsIGZ1bmN0aW9uICh3YXRjaGVkKSB7XG4gICAgICAgICAgICBpZiAod2F0Y2hlZCkge1xuICAgICAgICAgICAgICAgIFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkucG9wdXBBZGREaWFtb25kc0RsZyhnYW1lLmNvbmZpZy5kYWlseURpYW1vbmRzLCBcImRhaWx5X2RpYW1vbmRzXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5vbkNoZWNrTmV4dCgpO1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgZ2V0VG90YWxTdGFyQ291bnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGxldmVsTGlzdCA9IENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldExldmVsTGlzdCgpO1xuICAgICAgICB2YXIgc3RhckNvdW50ID0gMDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZXZlbExpc3QubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciBsZXZlbFN0YXJDb3VudCA9IGdhbWUucGxheWVyTWFuLmdldExldmVsU3RhcihpICsgMSk7XG4gICAgICAgICAgICB2YXIgaGFyZExldmVsU3RhckNvdW50ID0gZ2FtZS5wbGF5ZXJNYW4uZ2V0SGFyZExldmVsU3RhcihpICsgMSk7XG4gICAgICAgICAgICBzdGFyQ291bnQgKz0gbGV2ZWxTdGFyQ291bnQ7XG4gICAgICAgICAgICBzdGFyQ291bnQgKz0gaGFyZExldmVsU3RhckNvdW50O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzdGFyQ291bnQ7XG4gICAgfSxcblxuICAgIGdldE1heExldmVsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBub3JtYWxMZXZlbCA9IGdhbWUucGxheWVyTWFuLmdldExldmVsKCk7XG4gICAgICAgIHZhciBoYXJkTGV2ZWwgPSBnYW1lLnBsYXllck1hbi5nZXRIYXJkTGV2ZWwoKTtcbiAgICAgICAgcmV0dXJuIE1hdGgubWF4KG5vcm1hbExldmVsLCBoYXJkTGV2ZWwpO1xuICAgIH0sXG5cbiAgICBjYW5TaG93R2lmdEJveDogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYWRzUmVhZHkgPSBnYW1lLmFkc01hbmFnZXIuaXNSZXdhcmRWaWRlb1JlYWR5KCk7XG4gICAgICAgIHZhciBpc0xldmVsT2sgPSB0aGlzLmxldmVsSWQgPj0gMyAmJiB0aGlzLmxldmVsSWQgJSAyID09PSAwO1xuICAgICAgICB2YXIgZ2lmdENvdW50T2sgPSB0aGlzLmdpZnRDb3VudCA8PSA1O1xuICAgICAgICByZXR1cm4gKGFkc1JlYWR5ICYmIGdpZnRDb3VudE9rICYmIGlzTGV2ZWxPayk7XG4gICAgfSxcblxuICAgIGFkZEdpZnRDb3VudDogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmdpZnRDb3VudCsrO1xuICAgIH0sXG5cbiAgICBvbkdpZnRCb3hPcGVuZWQ6IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICB2YXIgcmFuZG9tTnVtID0gZ2FtZS51dGlscy5yYW5kb21OZXh0SW50KDEwMCk7XG4gICAgICAgIGlmIChyYW5kb21OdW0gPCA1MCkge1xuICAgICAgICAgICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5vbk9wZW5Cb3goY2FsbGJhY2spO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cENhcmQoY2FsbGJhY2spO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldFJhbmRvbUNmZzogZnVuY3Rpb24gKHBvc3NpYmlsaXR5Q2ZnKSB7XG4gICAgICAgIHZhciByYW5kb21OdW0gPSBnYW1lLnV0aWxzLnJhbmRvbU5leHRJbnQoMTAwKTtcbiAgICAgICAgY2MubG9nKFwicmFuZG9tIG51bWJlcjpcIiArIHJhbmRvbU51bSk7XG4gICAgICAgIHZhciBzdW1Qcm9iYWJpbGl0eSA9IDA7XG4gICAgICAgIHZhciByZXN1bHRJdGVtID0gcG9zc2liaWxpdHlDZmdbMF07XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcG9zc2liaWxpdHlDZmcubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGlmIChzdW1Qcm9iYWJpbGl0eSArIHBvc3NpYmlsaXR5Q2ZnW2ldLnAgPiByYW5kb21OdW0pIHtcbiAgICAgICAgICAgICAgICByZXN1bHRJdGVtID0gcG9zc2liaWxpdHlDZmdbaV07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHN1bVByb2JhYmlsaXR5ICs9IHBvc3NpYmlsaXR5Q2ZnW2ldLnA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2MubG9nKFwicmFuZG9tIGl0ZW06XCIgKyBKU09OLnN0cmluZ2lmeShyZXN1bHRJdGVtKSk7XG4gICAgICAgIHJldHVybiBnYW1lLnV0aWxzLnJhbmRvbU5leHRJbnRJblJhbmdlKHJlc3VsdEl0ZW0uc3RhcnQsIHJlc3VsdEl0ZW0uZW5kICsgMSk7XG4gICAgfSxcblxuICAgIGdldFBhc3NXaW5NdWx0aTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRSYW5kb21DZmcoZ2FtZS5jb25maWcubXVsdGlDbGFpbVBvc3NpYmlsaXR5KTtcbiAgICB9LFxuXG4gICAgZ2V0RGlhbW9uZHNNdWx0aTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRSYW5kb21DZmcoZ2FtZS5jb25maWcubXVsdGlEaWFtb25kc1Bvc3NpYmlsaXR5KTtcbiAgICB9LFxuXG4gICAgaXNDb3VudERvd25DaGFsbGVuZ2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIENoYWxsZW5nZUlkID0gcmVxdWlyZShcIi4uL2VudW0vQ2hhbGxlbmdlSWRcIik7XG4gICAgICAgIHJldHVybiB0aGlzLmlzQ2hhbGxlbmdlTGV2ZWwgJiYgZ2FtZS5jaGFsbGVuZ2VNYW4uY3VycmVudENoYWxsZW5nZUlkID09PSBDaGFsbGVuZ2VJZC5UaW1lTGltaXQ7XG4gICAgfSxcblxuICAgIGlzU3VwZXJCb2FyZFVubG9ja2VkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5pc0NoYWxsZW5nZUxldmVsICYmIGdhbWUucGxheWVyTWFuLnBsYXllci51bmxvY2tlZFN1cGVyQm9hcmQpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgZ2V0UmFuZG9tU2tpbjogZnVuY3Rpb24gKHNraW5UeXBlKSB7XG4gICAgICAgIC8vIHZhciBTa2luVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1NraW5UeXBlXCIpO1xuICAgICAgICB2YXIgc2tpbkxpc3QgPSBDb25maWdNYW4uZ2V0SW5zdGFuY2UoKS5nZXRTa2luTGlzdEJ5VHlwZShza2luVHlwZSk7XG4gICAgICAgIC8vIHNraW5MaXN0ID0gc2tpbkxpc3QuY29uY2F0KENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldFNraW5MaXN0QnlUeXBlKFNraW5UeXBlLkRpYW1vbmRzKSk7XG4gICAgICAgIHZhciBzdWl0YWJsZVNraW5MaXN0ID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2tpbkxpc3QubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciBza2luQ2ZnID0gc2tpbkxpc3RbaV07XG4gICAgICAgICAgICB2YXIgb3duZWQgPSBnYW1lLnBsYXllck1hbi5oYXNTa2luKHNraW5DZmcuaWQpO1xuICAgICAgICAgICAgaWYgKCFvd25lZCkge1xuICAgICAgICAgICAgICAgIHN1aXRhYmxlU2tpbkxpc3QucHVzaChza2luQ2ZnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoc3VpdGFibGVTa2luTGlzdC5sZW5ndGggPD0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN1aXRhYmxlU2tpbkxpc3RbZ2FtZS51dGlscy5yYW5kb21OZXh0SW50KHN1aXRhYmxlU2tpbkxpc3QubGVuZ3RoKV07XG4gICAgfSxcblxuICAgIGdldFJhbmRvbUJvYXJkOiBmdW5jdGlvbiAoc2tpblR5cGUpIHtcbiAgICAgICAgdmFyIGJvYXJkTGlzdCA9IENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldEJvYXJkTGlzdEJ5VHlwZShza2luVHlwZSk7XG4gICAgICAgIHZhciBzdWl0YWJsZUJvYXJkTGlzdCA9IFtdO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJvYXJkTGlzdC5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdmFyIHNraW5DZmcgPSBib2FyZExpc3RbaV07XG4gICAgICAgICAgICB2YXIgb3duZWQgPSBnYW1lLnBsYXllck1hbi5oYXNCb2FyZChza2luQ2ZnLmlkKTtcbiAgICAgICAgICAgIGlmICghb3duZWQpIHtcbiAgICAgICAgICAgICAgICBzdWl0YWJsZUJvYXJkTGlzdC5wdXNoKHNraW5DZmcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChzdWl0YWJsZUJvYXJkTGlzdC5sZW5ndGggPD0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN1aXRhYmxlQm9hcmRMaXN0W2dhbWUudXRpbHMucmFuZG9tTmV4dEludChzdWl0YWJsZUJvYXJkTGlzdC5sZW5ndGgpXTtcbiAgICB9LFxuXG4gICAgZ2V0Qm94UmV3YXJkczogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYm94UmV3YXJkQ29uZmlnID0gQ29uZmlnTWFuLmdldEluc3RhbmNlKCkuYm94UmV3YXJkQ29uZmlnO1xuICAgICAgICB2YXIgYm94UmV3YXJkMSA9IGJveFJld2FyZENvbmZpZy5ib3hSZXdhcmQxO1xuICAgICAgICB2YXIgYm94UmV3YXJkMiA9IGJveFJld2FyZENvbmZpZy5ib3hSZXdhcmQyO1xuICAgICAgICB2YXIgYm94UmV3YXJkMyA9IGJveFJld2FyZENvbmZpZy5ib3hSZXdhcmQzO1xuXG4gICAgICAgIHZhciByZXN1bHRzID0gW107XG4gICAgICAgIHZhciBjb25maWcgPSBib3hSZXdhcmQxW2dhbWUudXRpbHMucmFuZG9tTmV4dEludChib3hSZXdhcmQxLmxlbmd0aCldO1xuICAgICAgICBzd2l0Y2ggKGNvbmZpZy50eXBlKSB7XG4gICAgICAgICAgICBjYXNlIEJvb3N0VHlwZS5TS0lOOlxuICAgICAgICAgICAgICAgIGNvbmZpZy5leHRyYSA9IHRoaXMuZ2V0UmFuZG9tU2tpbihTa2luVHlwZS5LZXlBY3Rpdml0eSk7XG4gICAgICAgICAgICAgICAgaWYgKCFjb25maWcuZXh0cmEpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnID0gYm94UmV3YXJkMVsxXTtcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnLmV4dHJhID0gdGhpcy5nZXRSYW5kb21Cb2FyZChTa2luVHlwZS5LZXlBY3Rpdml0eSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBCb29zdFR5cGUuQk9BUkRfU0tJTjpcbiAgICAgICAgICAgICAgICBjb25maWcuZXh0cmEgPSB0aGlzLmdldFJhbmRvbUJvYXJkKFNraW5UeXBlLktleUFjdGl2aXR5KTtcbiAgICAgICAgICAgICAgICBpZiAoIWNvbmZpZy5leHRyYSkge1xuICAgICAgICAgICAgICAgICAgICBjb25maWcgPSBib3hSZXdhcmQxWzBdO1xuICAgICAgICAgICAgICAgICAgICBjb25maWcuZXh0cmEgPSB0aGlzLmdldFJhbmRvbVNraW4oU2tpblR5cGUuS2V5QWN0aXZpdHkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgY2MubG9nKFwiZXJyb3I6cmV3YXJkIHR5cGU6XCIgKyBjb25maWcudHlwZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFjb25maWcuZXh0cmEpIHtcbiAgICAgICAgICAgIGNvbmZpZyA9IHtcbiAgICAgICAgICAgICAgICB0eXBlOiBCb29zdFR5cGUuRElBTU9ORCxcbiAgICAgICAgICAgICAgICBpbWFnZTogXCJpY29uX2RpYW1vbmQucG5nXCIsXG4gICAgICAgICAgICAgICAgY291bnQ6IDEwMFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXN1bHRzLnB1c2goY29uZmlnKTtcbiAgICAgICAgZ2FtZS51dGlscy5zaHVmZmxlKGJveFJld2FyZDIpO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDI7ICsraSkge1xuICAgICAgICAgICAgcmVzdWx0cy5wdXNoKGJveFJld2FyZDJbaV0pO1xuICAgICAgICB9XG4gICAgICAgIGdhbWUudXRpbHMuc2h1ZmZsZShib3hSZXdhcmQzKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA2OyArK2kpIHtcbiAgICAgICAgICAgIHJlc3VsdHMucHVzaChib3hSZXdhcmQzW2ldKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9LFxuXG4gICAgY2hlY2tBbmRTaG93Qm94OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5wbGF5ZXIuY3VycmVudEtleUNvdW50ID49IDMpIHtcbiAgICAgICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBCb3goKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgcmFuZG9tQm94OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjb25maWdzID0gdGhpcy5ib3hDb25maWdzO1xuICAgICAgICB2YXIgY291bnQgPSB0aGlzLnVubG9ja0JveENvdW50O1xuICAgICAgICB2YXIgcmFuZG9tSW5kZXggPSBnYW1lLnV0aWxzLnJhbmRvbU5leHRJbnQoY29uZmlncy5sZW5ndGgpO1xuICAgICAgICBpZiAoY291bnQgPCAzKSB7XG4gICAgICAgICAgICBpZiAocmFuZG9tSW5kZXggPT09IDApIHtcbiAgICAgICAgICAgICAgICByYW5kb21JbmRleCA9IGdhbWUudXRpbHMucmFuZG9tTmV4dEludChjb25maWdzLmxlbmd0aCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoY291bnQgPCA2KSB7XG4gICAgICAgICAgICBpZiAocmFuZG9tSW5kZXggPT09IDAgJiYgZ2FtZS51dGlscy5yYW5kb21OZXh0SW50KDEwMCkgPCA1MCkge1xuICAgICAgICAgICAgICAgIHJhbmRvbUluZGV4ID0gZ2FtZS51dGlscy5yYW5kb21OZXh0SW50KGNvbmZpZ3MubGVuZ3RoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB2YXIgY29uZmlnID0gY29uZmlnc1tyYW5kb21JbmRleF07XG4gICAgICAgIGNvbmZpZ3Muc3BsaWNlKHJhbmRvbUluZGV4LCAxKTtcbiAgICAgICAgcmV0dXJuIGNvbmZpZztcbiAgICB9LFxuXG4gICAgcmVnaXN0ZXJSZW1vdGVDb25maWc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICBnYW1lLnJlbW90ZUNvbmZpZy5zZXRSZW1vdGVDb25maWdSZWNlaXZlZENhbGxiYWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHNlbGYuZmx1c2hHcm91cCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgc2VsZi5mbHVzaEdyb3VwKCk7XG4gICAgfSxcblxuICAgIGZsdXNoR3JvdXA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGdhbWUucmVtb3RlQ29uZmlnLmlzUmVtb3RlQ29uZmlnUmVhZHkoKSkge1xuICAgICAgICAgICAgdmFyIGdyb3VwID0gZ2FtZS5yZW1vdGVDb25maWcuZ2V0UmVtb3RlQ29uZmlnKFwibHY0X2dyb3VwXCIpO1xuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwgJiYgZ3JvdXAubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5nZXRHcm91cChnYW1lLmFiVGVzdFR5cGUuTGV2ZWwpICE9PSBncm91cCkge1xuICAgICAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRHcm91cChnYW1lLmFiVGVzdFR5cGUuTGV2ZWwsIGdyb3VwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgaXNOZXdSZXN1bHQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIGlzTmV3UG9wdXA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICBpc05ld0Fkc1Nob3dUeXBlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG5cbiAgICBnZXRBZHNJbnRlcnZhbDogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gNDA7XG4gICAgfSxcblxuICAgIGdldExpZmVDb3VudDogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gMztcbiAgICB9LFxuXG4gICAgZ2V0SW5pdEJvb3N0UHJvYmFiaWxpdHk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGdhbWUuY29uZmlnLmJvb3N0UHJvYmFiaWxpdHk7XG4gICAgfSxcblxuICAgIGdldE9yR2VuZXJhdGVTa2luSWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNraW5JZCA9IGdhbWUucGxheWVyTWFuLnBsYXllci53YWl0U2tpbklkO1xuICAgICAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4uaGFzU2tpbihza2luSWQpKSB7XG4gICAgICAgICAgICBza2luSWQgPSAwO1xuICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uc2V0U2tpblBlcmNlbnQoMCk7XG4gICAgICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRXYWl0U2tpbklkKDApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChza2luSWQgPT09IDApIHtcbiAgICAgICAgICAgIHZhciBza2luQ2ZnID0gdGhpcy5nZXRSYW5kb21Ta2luKFNraW5UeXBlLldhdGNoQWRzKTtcbiAgICAgICAgICAgIGlmIChza2luQ2ZnICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRXYWl0U2tpbklkKHNraW5DZmcuaWQpO1xuICAgICAgICAgICAgICAgIHNraW5JZCA9IHNraW5DZmcuaWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHNraW5JZDtcbiAgICB9XG59KTtcblxuR2FtZU1hbi5faW5zdGFuY2UgPSBudWxsO1xuR2FtZU1hbi5fZmlyc3RVc2VJbnN0YW5jZSA9IHRydWU7XG5cbi8qKlxuICpcbiAqIEByZXR1cm5zIHtHYW1lTWFufVxuICovXG5HYW1lTWFuLmdldEluc3RhbmNlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChHYW1lTWFuLl9maXJzdFVzZUluc3RhbmNlKSB7XG4gICAgICAgIEdhbWVNYW4uX2ZpcnN0VXNlSW5zdGFuY2UgPSBmYWxzZTtcbiAgICAgICAgR2FtZU1hbi5faW5zdGFuY2UgPSBuZXcgR2FtZU1hbigpO1xuICAgIH1cbiAgICByZXR1cm4gR2FtZU1hbi5faW5zdGFuY2U7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEdhbWVNYW47IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHFpbm5pbmcgb24gMTUvNS8xMi5cbiAqL1xudmFyIFBsYXllckluZm8gPSByZXF1aXJlKFwiLi4vZW50aXR5L1BsYXllckluZm9cIik7XG52YXIgRXZlbnRzTmFtZSA9IHJlcXVpcmUoXCIuLi9ldmVudHMvRXZlbnRzTmFtZVwiKTtcbnZhciBCb29zdFR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9Cb29zdFR5cGVcIik7XG5cbnZhciBQTEFZRVJfS0VZID0gXCJwbGF5ZXJfa2V5XCI7XG5cbnZhciBQbGF5ZXJNYW4gPSBjYy5DbGFzcy5leHRlbmQoe1xuICAgIHBsYXllcjogbnVsbCxcbiAgICBiZXN0U2NvcmVLZXk6IG51bGwsXG4gICAgbGV2ZWxCb2FyZEtleTogbnVsbCxcblxuICAgIGluaXRlZDogZmFsc2UsXG4gICAgY3RvcjogZnVuY3Rpb24gKCkge1xuICAgIH0sXG5cbiAgICBpbml0RGF0YTogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5pbml0ZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmluaXRlZCA9IGZhbHNlO1xuICAgICAgICB2YXIgcGxheWVySW5mb1N0ciA9IGdhbWUuc3RvcmFnZUNvbnRyb2xsZXIuZ2V0SXRlbShQTEFZRVJfS0VZLCBudWxsKTtcbiAgICAgICAgdmFyIHBsYXllcjtcbiAgICAgICAgaWYgKHBsYXllckluZm9TdHIgPT0gbnVsbCB8fCBwbGF5ZXJJbmZvU3RyID09IFwiXCIpIHtcbiAgICAgICAgICAgIHBsYXllciA9IFBsYXllckluZm8uY3JlYXRlRGVmYXVsdCgpO1xuICAgICAgICAgICAgZ2FtZS5zdG9yYWdlQ29udHJvbGxlci5zZXRJdGVtKFBMQVlFUl9LRVksIEpTT04uc3RyaW5naWZ5KHBsYXllcikpO1xuICAgICAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci5hZGRWaXJ0dWFsQ3VycmVuY3koXCJpbml0X3BsYXllclwiLCBwbGF5ZXIuZGlhbW9uZHMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcGxheWVyID0gbmV3IFBsYXllckluZm8oKTtcbiAgICAgICAgICAgIHBsYXllci51bm1hcnNoYWxsKEpTT04ucGFyc2UocGxheWVySW5mb1N0cikpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucGxheWVyID0gcGxheWVyO1xuICAgIH0sXG5cbiAgICByZW1vdmVkQWRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucGxheWVyLnJlbW92ZWRBZHMgPSB0cnVlO1xuICAgICAgICBnYW1lLmFkc01hbmFnZXIucmVtb3ZlQmFubmVyQWRzKFwidG9wXCIpO1xuICAgICAgICBnYW1lLmFkc01hbmFnZXIucmVtb3ZlQmFubmVyQWRzKFwiYm90dG9tXCIpO1xuICAgICAgICBnYW1lLmFkc01hbmFnZXIucmVtb3ZlTmF0aXZlQWQoXCJwYXNzXCIpO1xuICAgICAgICB0aGlzLl9mbHVzaFRvU3RvcmFnZSgpO1xuICAgIH0sXG5cbiAgICBzZXRSYXRlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnBsYXllci5yYXRlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuX2ZsdXNoVG9TdG9yYWdlKCk7XG4gICAgfSxcblxuICAgIGdldExldmVsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChjYy5pc1VuZGVmaW5lZCh0aGlzLnBsYXllci5sZXZlbCkpIHtcbiAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucGxheWVyLmxldmVsO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNldExldmVsOiBmdW5jdGlvbiAobGV2ZWwpIHtcbiAgICAgICAgaWYgKHRoaXMucGxheWVyLmxldmVsIDwgbGV2ZWwpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLmxldmVsID0gbGV2ZWw7XG4gICAgICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrUGxheWVyTGV2ZWwobGV2ZWwpO1xuICAgICAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICB1cGRhdGVMZXZlbERhdGE6IGZ1bmN0aW9uIChsZXZlbCwgbmFtZSwgZGF0YSkge1xuICAgICAgICBpZiAoY2MuaXNVbmRlZmluZWQodGhpcy5wbGF5ZXIubGV2ZWxzTWFwW2xldmVsXSkpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLmxldmVsc01hcFtsZXZlbF0gPSB7fTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBsYXllci5sZXZlbHNNYXBbbGV2ZWxdW25hbWVdID0gZGF0YTtcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgZ2V0TGV2ZWxEYXRhOiBmdW5jdGlvbiAobGV2ZWwsIG5hbWUpIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLnBsYXllci5sZXZlbHNNYXBbbGV2ZWxdIHx8IHt9KVtuYW1lXTtcbiAgICB9LFxuXG4gICAgZ2V0TGV2ZWxTdGFyOiBmdW5jdGlvbiAobGV2ZWwpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TGV2ZWxEYXRhKGxldmVsLCBcInN0YXJcIikgfHwgMDtcbiAgICB9LFxuXG4gICAgZ2V0SGFyZExldmVsU3RhcjogZnVuY3Rpb24gKGxldmVsKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldExldmVsRGF0YShsZXZlbCwgXCJoYXJkU3RhclwiKSB8fCAwO1xuICAgIH0sXG5cbiAgICBnZXROZXdIYXJkTGV2ZWxTdGFyOiBmdW5jdGlvbiAobGV2ZWwpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TGV2ZWxEYXRhKGxldmVsLCBcIm5ld0hhcmRTdGFyXCIpIHx8IDA7XG4gICAgfSxcblxuICAgIGFkZEludGVyc3RpdGlhbEFkQ291bnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5wbGF5ZXIuaW50ZXJzdGl0aWFsQWRDb3VudCsrO1xuICAgICAgICB0aGlzLl9mbHVzaFRvU3RvcmFnZSgpO1xuICAgIH0sXG5cbiAgICBhZGRSZXdhcmRlZEFkQ291bnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5wbGF5ZXIucmV3YXJkZWRBZENvdW50Kys7XG4gICAgICAgIHRoaXMuX2ZsdXNoVG9TdG9yYWdlKCk7XG4gICAgfSxcblxuICAgIHNldEhhcmRMZXZlbDogZnVuY3Rpb24gKGxldmVsKSB7XG4gICAgICAgIGlmICh0aGlzLnBsYXllci5oYXJkTGV2ZWwgPCBsZXZlbCkge1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuaGFyZExldmVsID0gbGV2ZWw7XG4gICAgICAgICAgICB0aGlzLl9mbHVzaFRvU3RvcmFnZSgpO1xuICAgICAgICB9XG4gICAgfSxcblxuXG5cbiAgICBnZXRIYXJkTGV2ZWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNjLmlzVW5kZWZpbmVkKHRoaXMucGxheWVyLmhhcmRMZXZlbCkpIHtcbiAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucGxheWVyLmhhcmRMZXZlbDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXROZXdIYXJkTGV2ZWw6IGZ1bmN0aW9uIChsZXZlbCkge1xuICAgICAgICBpZiAodGhpcy5wbGF5ZXIubmV3SGFyZExldmVsIDwgbGV2ZWwpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLm5ld0hhcmRMZXZlbCA9IGxldmVsO1xuICAgICAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXROZXdIYXJkTGV2ZWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNjLmlzVW5kZWZpbmVkKHRoaXMucGxheWVyLm5ld0hhcmRMZXZlbCkpIHtcbiAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucGxheWVyLm5ld0hhcmRMZXZlbDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRCb29zdENvdW50OiBmdW5jdGlvbiAoYm9vc3RUeXBlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBsYXllci5ib29zdE1hcFtib29zdFR5cGVdIHx8IDA7XG4gICAgfSxcblxuICAgIHVzZUJvb3N0OiBmdW5jdGlvbiAoYm9vc3RUeXBlKSB7XG4gICAgICAgIGlmICh0aGlzLmdldEJvb3N0Q291bnQoYm9vc3RUeXBlKSA+IDApIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLmJvb3N0TWFwW2Jvb3N0VHlwZV0tLTtcbiAgICAgICAgICAgIGlmIChib29zdFR5cGUgPT09IEJvb3N0VHlwZS5TUExJVCkge1xuICAgICAgICAgICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIuY29uc3VtZUl0ZW0oXCJib29zdF9zcGxpdFwiLCAxKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYm9vc3RUeXBlID09PSBCb29zdFR5cGUuVEhSRUVfQkFMTCkge1xuICAgICAgICAgICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIuY29uc3VtZUl0ZW0oXCJib29zdF9uZXdfM1wiLCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGdhbWUuYWN0aXZpdHlNYW4uYWRkQWN0aXZpdHlUYXNrQ291bnQoZ2FtZS5hY3Rpdml0eVRhc2tUeXBlLlVzZUJvb3N0KTtcbiAgICAgICAgICAgIHRoaXMuX2ZsdXNoVG9TdG9yYWdlKCk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIGFkZEJvb3N0OiBmdW5jdGlvbiAoYm9vc3RUeXBlLCBjb3VudCkge1xuICAgICAgICB0aGlzLnBsYXllci5ib29zdE1hcFtib29zdFR5cGVdICs9IGNvdW50O1xuICAgICAgICB0aGlzLl9mbHVzaFRvU3RvcmFnZSgpO1xuICAgICAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KEV2ZW50c05hbWUuUkVGUkVTSF9CT09TVCk7XG4gICAgfSxcblxuICAgIHNldEJvb3N0OiBmdW5jdGlvbiAoYm9vc3RUeXBlLCBjb3VudCkge1xuICAgICAgICB0aGlzLnBsYXllci5ib29zdE1hcFtib29zdFR5cGVdID0gY291bnQ7XG4gICAgICAgIHRoaXMuX2ZsdXNoVG9TdG9yYWdlKCk7XG4gICAgICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQoRXZlbnRzTmFtZS5SRUZSRVNIX0JPT1NUKTtcbiAgICB9LFxuXG4gICAgYWRkRGlhbW9uZHM6IGZ1bmN0aW9uIChkaWFtb25kcywgcmVhc29uLCBidXlJdGVtTmFtZSwgYnV5SXRlbUNvdW50LCBpc1VTRFB1cmNoYXNlZCkge1xuICAgICAgICBpZiAoaXNOYU4oZGlhbW9uZHMpKSB7XG4gICAgICAgICAgICBjYy5lcnJvcihcImRpYW1vbmRzIGlzIE5BTlwiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGlhbW9uZHMgPiAwKSB7XG4gICAgICAgICAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImRpYW1vbmRfYWRkXCIpO1xuICAgICAgICAgICAgaWYgKCFpc1VTRFB1cmNoYXNlZCkge1xuICAgICAgICAgICAgICAgIGlmIChyZWFzb24pIHtcbiAgICAgICAgICAgICAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci5hZGRWaXJ0dWFsQ3VycmVuY3kocmVhc29uLCBkaWFtb25kcyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci5hZGRWaXJ0dWFsQ3VycmVuY3koXCJ1bmtvbndfcmVhc29uXCIsIGRpYW1vbmRzKTtcbiAgICAgICAgICAgICAgICAgICAgY2MuZXJyb3IoXCJlcnJvciBhZGREaWFtb25kcyB1bmtub3duIHJlYXNvbjpcIiArIHJlYXNvbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGRpYW1vbmRzIDwgMCkge1xuICAgICAgICAgICAgaWYgKGJ1eUl0ZW1OYW1lICYmIGJ1eUl0ZW1Db3VudCkge1xuICAgICAgICAgICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIuY29uc3VtZVZpcnR1YWxDdXJyZW5jeShidXlJdGVtTmFtZSwgYnV5SXRlbUNvdW50LCAtZGlhbW9uZHMpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjYy5lcnJvcihcImVycm9yIGFkZERpYW1vbmRzIHVua25vd24gYnV5SXRlbU5hbWU6XCIgKyBidXlJdGVtTmFtZSArIFwiLGJ1eUl0ZW1Db3VudDpcIiArIGJ1eUl0ZW1Db3VudCk7XG4gICAgICAgICAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci5jb25zdW1lVmlydHVhbEN1cnJlbmN5KFwidW5rbm93bl9yZWFzb25cIiwgMCwgLWRpYW1vbmRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBsYXllci5kaWFtb25kcyArPSBkaWFtb25kcztcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICAgICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChFdmVudHNOYW1lLkRJQU1PTkRTX1VQREFURSwge1xuICAgICAgICAgICAgXCJkaWFtb25kc1wiOiB0aGlzLnBsYXllci5kaWFtb25kcyxcbiAgICAgICAgICAgIFwiZGVsdGFcIjogZGlhbW9uZHNcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGdldERpYW1vbmRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBsYXllci5kaWFtb25kcztcbiAgICB9LFxuXG4gICAgc2V0VGFza0NsYWltZWQ6IGZ1bmN0aW9uICh0YXNrSWQpIHtcbiAgICAgICAgY2MubG9nKFwiUGxheWVyTWFuIHNldFRhc2tDbGFpbWVkOlwiICsgdGFza0lkKTtcbiAgICAgICAgdGhpcy5wbGF5ZXIudGFza01hcFt0YXNrSWRdID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgaXNUYXNrQ2xhaW1lZDogZnVuY3Rpb24gKHRhc2tJZCkge1xuICAgICAgICBjYy5sb2coXCJQbGF5ZXJNYW4gaXNUYXNrQ2xhaW1lZDpcIiArIHRhc2tJZCk7XG4gICAgICAgIHJldHVybiAhIXRoaXMucGxheWVyLnRhc2tNYXBbdGFza0lkXTtcbiAgICB9LFxuXG4gICAgc2V0R3VpZGVkOiBmdW5jdGlvbiAoZ3VpZGVkKSB7XG4gICAgICAgIHRoaXMucGxheWVyLmd1aWRlZCA9IGd1aWRlZDtcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgc2V0TGFzdFdoZWVsVGltZTogZnVuY3Rpb24gKHdoZWVsVGltZSkge1xuICAgICAgICB0aGlzLnBsYXllci5sYXN0V2hlZWxUaW1lID0gd2hlZWxUaW1lO1xuICAgICAgICB0aGlzLl9mbHVzaFRvU3RvcmFnZSgpO1xuICAgIH0sXG5cbiAgICBnZXRMYXN0V2hlZWxUaW1lOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBsYXllci5sYXN0V2hlZWxUaW1lO1xuICAgIH0sXG5cbiAgICBzZXRDdXJyZW50U2tpbklkOiBmdW5jdGlvbiAoc2tpbklkKSB7XG4gICAgICAgIGlmIChza2luSWQgPT09IHRoaXMucGxheWVyLmN1cnJlbnRTa2luSWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgQmFsbFBvb2wgPSByZXF1aXJlKFwiLi4vZW50aXR5L0JhbGxQb29sXCIpO1xuICAgICAgICBCYWxsUG9vbC5kcmFpbkFsbFBvb2xzKCk7XG4gICAgICAgIHRoaXMucGxheWVyLmN1cnJlbnRTa2luSWQgPSBza2luSWQ7XG4gICAgICAgIHRoaXMuX2ZsdXNoVG9TdG9yYWdlKCk7XG4gICAgfSxcblxuICAgIGdldEN1cnJlbnRTa2luSWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGxheWVyLmN1cnJlbnRTa2luSWQ7XG4gICAgfSxcblxuICAgIHNldEN1cnJlbnRCb2FyZElkOiBmdW5jdGlvbiAoYm9hcmRJZCkge1xuICAgICAgICBpZiAoYm9hcmRJZCA9PT0gdGhpcy5wbGF5ZXIuY3VycmVudEJvYXJkSWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBsYXllci5jdXJyZW50Qm9hcmRJZCA9IGJvYXJkSWQ7XG4gICAgICAgIHRoaXMuX2ZsdXNoVG9TdG9yYWdlKCk7XG4gICAgfSxcblxuICAgIGdldEN1cnJlbnRCb2FyZElkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBsYXllci5jdXJyZW50Qm9hcmRJZDtcbiAgICB9LFxuXG4gICAgc2V0Q2xhaW1lZFNraW46IGZ1bmN0aW9uIChza2luSWQpIHtcbiAgICAgICAgdGhpcy5wbGF5ZXIuc2tpbk1hcFtza2luSWRdID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgaGFzU2tpbjogZnVuY3Rpb24gKHNraW5JZCkge1xuICAgICAgICByZXR1cm4gISF0aGlzLnBsYXllci5za2luTWFwW3NraW5JZF07XG4gICAgfSxcblxuICAgIHNldENsYWltZWRCb2FyZDogZnVuY3Rpb24gKGJvYXJkSWQpIHtcbiAgICAgICAgaWYgKHRoaXMucGxheWVyLmJvYXJkTWFwW2JvYXJkSWRdKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gZ2FtZS5hY3Rpdml0eU1hbi5hZGRBY3Rpdml0eVRhc2tDb3VudChnYW1lLmFjdGl2aXR5VGFza1R5cGUuQm9hcmRTa2luKTtcbiAgICAgICAgdGhpcy5wbGF5ZXIuYm9hcmRNYXBbYm9hcmRJZF0gPSB0cnVlO1xuICAgICAgICB0aGlzLl9mbHVzaFRvU3RvcmFnZSgpO1xuICAgIH0sXG5cbiAgICBoYXNCb2FyZDogZnVuY3Rpb24gKGJvYXJkSWQpIHtcbiAgICAgICAgcmV0dXJuICEhdGhpcy5wbGF5ZXIuYm9hcmRNYXBbYm9hcmRJZF07XG4gICAgfSxcblxuICAgIGlzTmV3UGxheWVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAoRGF0ZS5ub3coKSAtIHRoaXMucGxheWVyLmNyZWF0ZUR0IDwgMjQgKiAzNjAwICogMTAwMCk7XG4gICAgfSxcblxuICAgIGdldFJlZ2lzdGVyRGF5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBNYXRoLmZsb29yKChEYXRlLm5vdygpIC0gdGhpcy5wbGF5ZXIuY3JlYXRlRHQpIC8gKDI0ICogMzYwMCAqIDEwMDApKSArIDE7XG4gICAgfSxcblxuICAgIGN1cnJlbnREYXk6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiBnYW1lLnV0aWxzLmdldERheUJ5VHMoRGF0ZS5ub3coKSk7XG4gICAgfSxcblxuICAgIGNoZWNrQ29uc2VjdXRpdmVMb2dpbkRheTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB0b2RheSA9IHRoaXMuY3VycmVudERheSgpO1xuICAgICAgICB2YXIgZGF5cyA9IHRvZGF5IC0gdGhpcy5wbGF5ZXIubGFzdExvZ2luRGF5O1xuICAgICAgICBpZiAoZGF5cyA8IDApIHtcbiAgICAgICAgICAgIGNjLmVycm9yKFwiY29uc2VjdXRpdmUgbG9naW4gZGF5IGVycm9yLCB0b2RheSBpcyBzbWFsbGVyIHRoYW4gbGFzdExvZ2luRGF5LCBtYXliZSB5b3UgaGF2ZSBhZGp1c3QgdGhlIHRpbWUuXCIpO1xuICAgICAgICAgICAgZGF5cyA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRheXMgPD0gMSl7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5jb25zZWN1dGl2ZUxvZ2luRGF5cyArPSBkYXlzO1xuICAgICAgICB9XG4gICAgICAgIGVsc2V7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5jb25zZWN1dGl2ZUxvZ2luRGF5cyA9IDE7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnBsYXllci5sYXN0TG9naW5EYXkgPSB0b2RheTtcbiAgICAgICAgaWYgKHRoaXMucGxheWVyLmNvbnNlY3V0aXZlTG9naW5EYXlzIDwgMSkge1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuY29uc2VjdXRpdmVMb2dpbkRheXMgPSAxO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLnBsYXllci5jb25zZWN1dGl2ZUxvZ2luRGF5cztcbiAgICB9LFxuXG4gICAgc2V0TGFzdENsYWltRGFpbHlCb251c0RheTogZnVuY3Rpb24gKGRheSkge1xuICAgICAgICB0aGlzLnBsYXllci5sYXN0Q2xhaW1EYWlseUJvbnVzRGF5ID0gZGF5O1xuICAgICAgICB0aGlzLl9mbHVzaFRvU3RvcmFnZSgpO1xuICAgIH0sXG5cbiAgICBzZXROZXh0RGF5VGlwczogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnBsYXllci5uZXh0RGF5VGlwcyA9IHRydWU7XG4gICAgICAgIHRoaXMuX2ZsdXNoVG9TdG9yYWdlKCk7XG4gICAgfSxcblxuICAgIGlzU3BlY2lhbE9mZmVyUHVyY2hhc2VkOiBmdW5jdGlvbiAocGlkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBsYXllci5zcGVjaWFsT2ZmZXJNYXBbcGlkXSB8fCBmYWxzZTtcbiAgICB9LFxuXG4gICAgc2V0U3BlY2lhbE9mZmVyUHVyY2hhc2VkOiBmdW5jdGlvbiAocGlkKSB7XG4gICAgICAgIHRoaXMucGxheWVyLnNwZWNpYWxPZmZlck1hcFtwaWRdID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICAgICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChFdmVudHNOYW1lLlVQREFURV9TUEVDSUFMX09GRkVSKTtcbiAgICB9LFxuXG4gICAgc2V0U2tpbkFkanVzdGVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucGxheWVyLnNraW5BZGp1c3RlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuX2ZsdXNoVG9TdG9yYWdlKCk7XG4gICAgfSxcblxuICAgIHNldExhc3RTaG93UmF0ZVRpbWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5wbGF5ZXIubGFzdFNob3dSYXRlVGltZSA9IERhdGUubm93KCk7XG4gICAgICAgIHRoaXMuX2ZsdXNoVG9TdG9yYWdlKCk7XG4gICAgfSxcblxuICAgIGFkZFJld2FyZEFkQ291bnRQZXJEYXk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy50cnlDbGVhclByZXZpb3VzQWRDb3VudFBlckRheSgpO1xuICAgICAgICBpZiAoY2MuaXNVbmRlZmluZWQodGhpcy5wbGF5ZXIucmV3YXJkQWRDb3VudFBlckRheSkpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLnJld2FyZEFkQ291bnRQZXJEYXkgPSAwO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucGxheWVyLnJld2FyZEFkQ291bnRQZXJEYXkrKztcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICAgICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChFdmVudHNOYW1lLlJFV0FSREVEX1ZJREVPX0NPVU5UKTtcbiAgICB9LFxuXG4gICAgZ2V0UmV3YXJkQWRQbGFjZUNvdW50UGVyRGF5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudHJ5Q2xlYXJQcmV2aW91c0FkQ291bnRQZXJEYXkoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMucGxheWVyLnJld2FyZEFkQ291bnRQZXJEYXkgfHwgMDtcbiAgICB9LFxuXG4gICAgdHJ5Q2xlYXJQcmV2aW91c0FkQ291bnRQZXJEYXk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMucGxheWVyLnJld2FyZEFkUmVjb3JkRGF5ICE9PSB0aGlzLmdldFJlZ2lzdGVyRGF5KCkpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLnJld2FyZEFkQ291bnRQZXJEYXkgPSAwO1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIucmV3YXJkQWRSZWNvcmREYXkgPSB0aGlzLmdldFJlZ2lzdGVyRGF5KCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgYWRkSWFwQ291bnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5wbGF5ZXIuaWFwQ291bnQrKztcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgYWRkRmFpbENvdW50OiBmdW5jdGlvbiAobGV2ZWxJZCkge1xuICAgICAgICB0aGlzLnBsYXllci5mYWlsQ291bnRNYXBbbGV2ZWxJZF0gPSB0aGlzLmdldEZhaWxDb3VudChsZXZlbElkKSArIDE7XG4gICAgICAgIHRoaXMuX2ZsdXNoVG9TdG9yYWdlKCk7XG4gICAgfSxcblxuICAgIGdldEZhaWxDb3VudDogZnVuY3Rpb24gKGxldmVsSWQpIHtcbiAgICAgICAgY2MubG9nKFwic2tpcCBmYWlsIGNvdW50IG1hcDpcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMucGxheWVyLmZhaWxDb3VudE1hcCkpO1xuICAgICAgICByZXR1cm4gdGhpcy5wbGF5ZXIuZmFpbENvdW50TWFwW2xldmVsSWRdIHx8IDA7XG4gICAgfSxcblxuICAgIGFkZFNraW5BZHNDb3VudDogZnVuY3Rpb24gKHNraW5JZCkge1xuICAgICAgICB0aGlzLnBsYXllci5za2luQWRzQ291bnRNYXBbc2tpbklkXSA9IHRoaXMuZ2V0U2tpbkFkc0NvdW50KHNraW5JZCkgKyAxO1xuICAgICAgICB0aGlzLl9mbHVzaFRvU3RvcmFnZSgpO1xuICAgIH0sXG5cbiAgICBnZXRTa2luQWRzQ291bnQ6IGZ1bmN0aW9uIChza2luSWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGxheWVyLnNraW5BZHNDb3VudE1hcFtza2luSWRdIHx8IDA7XG4gICAgfSxcblxuICAgIGFkZEJvYXJkQWRzQ291bnQ6IGZ1bmN0aW9uIChib2FyZElkKSB7XG4gICAgICAgdGhpcy5wbGF5ZXIuYm9hcmRBZHNDb3VudE1hcFtib2FyZElkXSA9IHRoaXMuZ2V0Qm9hcmRBZHNDb3VudChib2FyZElkKSArIDE7XG4gICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgZ2V0Qm9hcmRBZHNDb3VudDogZnVuY3Rpb24gKGJvYXJkSWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGxheWVyLmJvYXJkQWRzQ291bnRNYXBbYm9hcmRJZF0gfHwgMDtcbiAgICB9LFxuXG4gICAgc2V0TGFzdExvZ2luVGltZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnBsYXllci5sYXN0TG9naW5UaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgc2V0TGFzdERhaWx5RGlhbW9uZHNUaW1lOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucGxheWVyLmxhc3REYWlseURpYW1vbmRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgcHVyY2hhc2VkQWltSXRlbTogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnBsYXllci5oYXNBaW1JdGVtID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgX2ZsdXNoVG9TdG9yYWdlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdhbWUuc3RvcmFnZUNvbnRyb2xsZXIuc2V0SXRlbShQTEFZRVJfS0VZLCBKU09OLnN0cmluZ2lmeSh0aGlzLnBsYXllcikpO1xuICAgIH0sXG5cbiAgICBzZXRDaGFsbGVuZ2VMZXZlbDogZnVuY3Rpb24gKGxldmVsLCBjaGFsbGVuZ2VJZCkge1xuICAgICAgICAvLyBpZiAodGhpcy5wbGF5ZXIuY2hhbGxlbmdlTGV2ZWwgPCBsZXZlbCkge1xuICAgICAgICAgICAgdGhpcy5nZXRPckNyZWF0ZUNoYWxsZW5nZShjaGFsbGVuZ2VJZCkuY2hhbGxlbmdlTGV2ZWwgPSBsZXZlbDtcbiAgICAgICAgICAgIC8vIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tQbGF5ZXJMZXZlbChsZXZlbCk7XG4gICAgICAgICAgICB0aGlzLl9mbHVzaFRvU3RvcmFnZSgpO1xuICAgICAgICAvLyB9XG4gICAgfSxcblxuICAgIHNldENoYWxsZW5nZU1pbGVzdG9uZVJld2FyZENsYWltZWQ6IGZ1bmN0aW9uIChtaWxlc3RvbmVJZCwgY2hhbGxlbmdlSWQpIHtcbiAgICAgICAgaWYgKHRoaXMuZ2V0T3JDcmVhdGVDaGFsbGVuZ2UoY2hhbGxlbmdlSWQpLmNoYWxsZW5nZU1pbGVzdG9uZUNsYWltSWQgPCBtaWxlc3RvbmVJZCkge1xuICAgICAgICAgICAgdGhpcy5nZXRPckNyZWF0ZUNoYWxsZW5nZShjaGFsbGVuZ2VJZCkuY2hhbGxlbmdlTWlsZXN0b25lQ2xhaW1JZCA9IG1pbGVzdG9uZUlkO1xuICAgICAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRPckNyZWF0ZUNoYWxsZW5nZTogZnVuY3Rpb24gKGNoYWxsZW5nZUlkKSB7XG4gICAgICAgIGlmICghdGhpcy5wbGF5ZXIuY2hhbGxlbmdlRGF0YU1hcFtjaGFsbGVuZ2VJZF0pIHtcbiAgICAgICAgICAgIHZhciBDaGFsbGVuZ2VEYXRhID0gcmVxdWlyZShcIi4uL2VudGl0eS9DaGFsbGVuZ2VEYXRhXCIpO1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuY2hhbGxlbmdlRGF0YU1hcFtjaGFsbGVuZ2VJZF0gPSBuZXcgQ2hhbGxlbmdlRGF0YSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLnBsYXllci5jaGFsbGVuZ2VEYXRhTWFwW2NoYWxsZW5nZUlkXTtcbiAgICB9LFxuXG4gICAgYWRkQ2hhbGxlbmdlUmV2aXZlQ291bnQ6IGZ1bmN0aW9uIChjaGFsbGVuZ2VJZCkge1xuICAgICAgICB0aGlzLmdldE9yQ3JlYXRlQ2hhbGxlbmdlKGNoYWxsZW5nZUlkKS5jaGFsbGVuZ2VSZXZpdmVDb3VudCArKztcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgcm9sbGJhY2tDaGFsbGVuZ2VSZXZpdmVDb3VudDogZnVuY3Rpb24gKGNoYWxsZW5nZUlkKSB7XG4gICAgICAgIHRoaXMuZ2V0T3JDcmVhdGVDaGFsbGVuZ2UoY2hhbGxlbmdlSWQpLmNoYWxsZW5nZVJldml2ZUNvdW50ID0gMDtcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgc2V0Q2hhbGxlbmdlVW5sb2NrVGlwc1Nob3dlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5wbGF5ZXIuY2hhbGxlbmdlVW5sb2NrVGlwcykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucGxheWVyLmNoYWxsZW5nZVVubG9ja1RpcHMgPSB0cnVlO1xuICAgICAgICB0aGlzLl9mbHVzaFRvU3RvcmFnZSgpO1xuICAgIH0sXG5cbiAgICBzZXRDaGFsbGVuZ2VMZXZlbFN1Y2Nlc3NlZDogZnVuY3Rpb24gKGxldmVsLCBjaGFsbGVuZ2VJZCkge1xuICAgICAgICB2YXIgY2hhbGxlbmdlID0gdGhpcy5nZXRPckNyZWF0ZUNoYWxsZW5nZShjaGFsbGVuZ2VJZCk7XG4gICAgICAgIGlmICghY2hhbGxlbmdlLmNoYWxsZW5nZUxldmVsTWFwKSB7XG4gICAgICAgICAgICBjaGFsbGVuZ2UuY2hhbGxlbmdlTGV2ZWxNYXAgPSB7fTtcbiAgICAgICAgfVxuICAgICAgICBjaGFsbGVuZ2UuY2hhbGxlbmdlTGV2ZWxNYXBbbGV2ZWxdID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgaXNDaGFsbGVuZ2VMZXZlbFN1Y2Nlc3NlZDogZnVuY3Rpb24gKGxldmVsLCBjaGFsbGVuZ2VJZCkge1xuICAgICAgICB2YXIgY2hhbGxlbmdlID0gdGhpcy5nZXRPckNyZWF0ZUNoYWxsZW5nZShjaGFsbGVuZ2VJZCk7XG4gICAgICAgIGlmICghY2hhbGxlbmdlLmNoYWxsZW5nZUxldmVsTWFwKSB7XG4gICAgICAgICAgICBjaGFsbGVuZ2UuY2hhbGxlbmdlTGV2ZWxNYXAgPSB7fTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gISFjaGFsbGVuZ2UuY2hhbGxlbmdlTGV2ZWxNYXBbbGV2ZWxdO1xuICAgIH0sXG5cbiAgICBzZXRDaGFsbGVuZ2VQbGF5aW5nOiBmdW5jdGlvbiAocGxheWluZywgY2hhbGxlbmdlSWQpIHtcbiAgICAgICAgdGhpcy5nZXRPckNyZWF0ZUNoYWxsZW5nZShjaGFsbGVuZ2VJZCkuY2hhbGxlbmdlUGxheWluZyA9IHBsYXlpbmc7XG4gICAgICAgIHRoaXMuX2ZsdXNoVG9TdG9yYWdlKCk7XG4gICAgfSxcblxuICAgIHNldENoYWxsZW5nZUVudGVyZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMucGxheWVyLmNoYWxsZW5nZUVudGVyZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBsYXllci5jaGFsbGVuZ2VFbnRlcmVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgc2V0V2hlZWxMb2NrZWQ6IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB0aGlzLnBsYXllci53aGVlbExvY2tJZHMucHVzaChpZCk7XG4gICAgICAgIHRoaXMuX2ZsdXNoVG9TdG9yYWdlKCk7XG4gICAgfSxcblxuICAgIGlzV2hlZWxMb2NrZWQ6IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wbGF5ZXIud2hlZWxMb2NrSWRzLmluZGV4T2YoaWQpICE9PSAtMTtcbiAgICB9LFxuXG4gICAgZ2V0V2hlZWxlZENvdW50OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBsYXllci53aGVlbExvY2tJZHMubGVuZ3RoO1xuICAgIH0sXG5cbiAgICByZXNldFdoZWVsTG9ja2VkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucGxheWVyLndoZWVsTG9ja0lkcyA9IFtdO1xuICAgICAgICB0aGlzLl9mbHVzaFRvU3RvcmFnZSgpO1xuICAgIH0sXG5cbiAgICBzZXRTdXBlckJvYXJkVW5sb2NrZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5wbGF5ZXIudW5sb2NrZWRTdXBlckJvYXJkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgYWRkQ3VycmVudEtleUNvdW50OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucGxheWVyLmN1cnJlbnRLZXlDb3VudCsrO1xuICAgICAgICB0aGlzLl9mbHVzaFRvU3RvcmFnZSgpO1xuICAgIH0sXG5cbiAgICBzZXRDdXJyZW50S2V5Q291bnQ6IGZ1bmN0aW9uIChjb3VudCkge1xuICAgICAgICB0aGlzLnBsYXllci5jdXJyZW50S2V5Q291bnQgPSBjb3VudDtcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgcmVkdWNlQ3VycmVudEtleUNvdW50OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucGxheWVyLmN1cnJlbnRLZXlDb3VudC0tO1xuICAgICAgICB0aGlzLl9mbHVzaFRvU3RvcmFnZSgpO1xuICAgIH0sXG5cbiAgICBnZXRBY3Rpdml0eVRhc2tDb3VudDogZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGxheWVyLmRhaWx5VGFza0NvdW50TWFwW3R5cGVdIHx8IDA7XG4gICAgfSxcblxuICAgIGFkZEFjdGl2aXR5VGFza0NvdW50OiBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICB0aGlzLnBsYXllci5kYWlseVRhc2tDb3VudE1hcFt0eXBlXSA9IHRoaXMuZ2V0QWN0aXZpdHlUYXNrQ291bnQodHlwZSkgKyAxO1xuICAgICAgICB0aGlzLl9mbHVzaFRvU3RvcmFnZSgpO1xuICAgIH0sXG5cbiAgICBzZXRBY3Rpdml0eVRhc2tDbGFpbWVkOiBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdGhpcy5wbGF5ZXIuZGFpbHlUYXNrQ2xhaW1NYXBbaWRdID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgaXNBY3Rpdml0eVRhc2tDbGFpbWVkOiBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGxheWVyLmRhaWx5VGFza0NsYWltTWFwW2lkXTtcbiAgICB9LFxuXG4gICAgc2V0RGFpbHlUYXNrUG9wZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5wbGF5ZXIuZGFpbHlUYXNrUG9wZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLl9mbHVzaFRvU3RvcmFnZSgpO1xuICAgIH0sXG5cbiAgICByZXNldERhaWx5VGFza0RhdGE6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5wbGF5ZXIuZGFpbHlUYXNrQ291bnRNYXAgPSB7fTtcbiAgICAgICAgdGhpcy5wbGF5ZXIuZGFpbHlUYXNrQ2xhaW1NYXAgPSB7fTtcbiAgICAgICAgdGhpcy5wbGF5ZXIuZGFpbHlUYXNrUG9wZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgcmVzZXRDdXJyZW50RGF5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucGxheWVyLmN1cnJlbnREYXkgPSBnYW1lLnV0aWxzLmdldEN1cnJlbnREYXkoKTtcbiAgICAgICAgdGhpcy5fZmx1c2hUb1N0b3JhZ2UoKTtcbiAgICB9LFxuXG4gICAgZ2V0R3JvdXA6IGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBsYXllci5hYlRlc3RHcm91cFt0eXBlXSB8fCBcImFcIjtcbiAgICB9LFxuXG4gICAgZ2V0UmVhbEdyb3VwOiBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5wbGF5ZXIuYWJUZXN0R3JvdXBbdHlwZV0gfHwgXCJcIjtcbiAgICB9LFxuXG4gICAgc2V0R3JvdXA6IGZ1bmN0aW9uICh0eXBlLCBncm91cCkge1xuICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuYWJUZXN0R3JvdXBbdHlwZV0gPSBncm91cDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXRTa2luUGVyY2VudDogZnVuY3Rpb24gKHBlcmNlbnQpIHtcbiAgICAgICAgdGhpcy5wbGF5ZXIuc2tpblBlcmNlbnQgPSBwZXJjZW50O1xuICAgICAgICB0aGlzLl9mbHVzaFRvU3RvcmFnZSgpO1xuICAgIH0sXG5cbiAgICBzZXRXYWl0U2tpbklkOiBmdW5jdGlvbiAoc2tpbklkKSB7XG4gICAgICAgIHRoaXMucGxheWVyLndhaXRTa2luSWQgPSBza2luSWQ7XG4gICAgICAgIHRoaXMuX2ZsdXNoVG9TdG9yYWdlKCk7XG4gICAgfVxuXG59KTtcblxuUGxheWVyTWFuLl9pbnN0YW5jZSA9IG51bGw7XG5QbGF5ZXJNYW4uX2ZpcnN0VXNlSW5zdGFuY2UgPSB0cnVlO1xuXG4vKipcbiAqXG4gKiBAcmV0dXJucyB7UGxheWVyTWFufVxuICovXG5QbGF5ZXJNYW4uZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKFBsYXllck1hbi5fZmlyc3RVc2VJbnN0YW5jZSkge1xuICAgICAgICBQbGF5ZXJNYW4uX2ZpcnN0VXNlSW5zdGFuY2UgPSBmYWxzZTtcbiAgICAgICAgUGxheWVyTWFuLl9pbnN0YW5jZSA9IG5ldyBQbGF5ZXJNYW4oKTtcbiAgICB9XG4gICAgcmV0dXJuIFBsYXllck1hbi5faW5zdGFuY2U7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFBsYXllck1hbjsiLCIvKipcbiAqIENyZWF0ZWQgYnkgb3llIG9uIDE1LzExLzIxLlxuICovXG5cbnZhciBOb3RpY2VDb250cm9sbGVyID0gcmVxdWlyZShcIi4uL2NvbnRyb2xsZXIvTm90aWNlQ29udHJvbGxlclwiKTtcbnZhciBHYW1lT3ZlckNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9HYW1lT3ZlckNvbnRyb2xsZXJcIik7XG52YXIgSGVscENvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9IZWxwQ29udHJvbGxlclwiKTtcbnZhciBHYW1lV2luQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL0dhbWVXaW5Db250cm9sbGVyXCIpO1xudmFyIFBhc3NDb250cm9sbGVyID0gcmVxdWlyZShcIi4uL2NvbnRyb2xsZXIvUGFzc0NvbnRyb2xsZXJcIik7XG52YXIgU3RvcmVDb250cm9sbGVyID0gcmVxdWlyZShcIi4uL2NvbnRyb2xsZXIvU3RvcmVDb250cm9sbGVyXCIpO1xudmFyIFBhdXNlQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL1BhdXNlQ29udHJvbGxlclwiKTtcbnZhciBGYWlsQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL0ZhaWxDb250cm9sbGVyXCIpO1xudmFyIFJhbmtDb250cm9sbGVyID0gcmVxdWlyZShcIi4uL2NvbnRyb2xsZXIvUmFua0NvbnRyb2xsZXJcIik7XG52YXIgUmV3YXJkVmlkZW9Db250cm9sbGVyID0gcmVxdWlyZShcIi4uL2NvbnRyb2xsZXIvUmV3YXJkVmlkZW9Db250cm9sbGVyXCIpO1xudmFyIFdoZWVsQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL1doZWVsQ29udHJvbGxlclwiKTtcbnZhciBSZXdhcmREb3VibGVDb250cm9sbGVyID0gcmVxdWlyZShcIi4uL2NvbnRyb2xsZXIvUmV3YXJkRG91YmxlQ29udHJvbGxlclwiKTtcbnZhciBCYWdDb250cm9sbGVyID0gcmVxdWlyZShcIi4uL2NvbnRyb2xsZXIvQmFnQ29udHJvbGxlclwiKTtcbnZhciBSZXdhcmRHaWZ0Q29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL1Jld2FyZEdpZnRDb250cm9sbGVyXCIpO1xudmFyIFNraW5Db250cm9sbGVyID0gcmVxdWlyZShcIi4uL2NvbnRyb2xsZXIvU2tpbkNvbnRyb2xsZXJcIik7XG52YXIgRGFpbHlCb251c0NvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9EYWlseUJvbnVzQ29udHJvbGxlclwiKTtcbnZhciBTcGVjaWFsT2ZmZXJDb250cm9sbGVyID0gcmVxdWlyZShcIi4uL2NvbnRyb2xsZXIvU3BlY2lhbE9mZmVyQ29udHJvbGxlclwiKTtcbnZhciBSZXdhcmROb3RpY2VDb250cm9sbGVyID0gcmVxdWlyZShcIi4uL2NvbnRyb2xsZXIvUmV3YXJkTm90aWNlQ29udHJvbGxlclwiKTtcbnZhciBUYXNrQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL1Rhc2tDb250cm9sbGVyXCIpO1xudmFyIFNldHRpbmdDb250cm9sbGVyID0gcmVxdWlyZShcIi4uL2NvbnRyb2xsZXIvU2V0dGluZ0NvbnRyb2xsZXJcIik7XG52YXIgUmVsaXZlQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL0NoYWxsZW5nZVJlbGl2ZUNvbnRyb2xsZXJcIik7XG52YXIgV2F0Y2hBZHNHZXRTa2luQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL1dhdGNoQWRzR2V0U2tpbkNvbnRyb2xsZXJcIik7XG52YXIgV2F0Y2hBZHNHZXRJdGVtQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL1dhdGNoQWRzR2V0SXRlbUNvbnRyb2xsZXJcIik7XG52YXIgV2F0Y2hBZHNHZXREaWFtb25kc0NvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9XYXRjaEFkc0dldERpYW1vbmRzQ29udHJvbGxlclwiKTtcbnZhciBXYXRjaEFkc0dldDNTdGFyQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL1dhdGNoQWRzR2V0M1N0YXJDb250cm9sbGVyXCIpO1xudmFyIFdhdGNoQWRzUmVsaWZlQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL1dhdGNoQWRzUmVsaWZlQ29udHJvbGxlclwiKTtcbnZhciBDYXJkQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL0NhcmRDb250cm9sbGVyXCIpO1xudmFyIFBhc3NDbkNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9QYXNzQ25Db250cm9sbGVyXCIpO1xudmFyIEZhaWxDbkNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9GYWlsQ25Db250cm9sbGVyXCIpO1xudmFyIFBhdXNlQ25Db250cm9sbGVyID0gcmVxdWlyZShcIi4uL2NvbnRyb2xsZXIvUGF1c2VDbkNvbnRyb2xsZXJcIik7XG52YXIgUmV3YXJkUmVtb3ZlQWRzQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL1Jld2FyZFJlbW92ZUFkc0NvbnRyb2xsZXJcIik7XG52YXIgU3VwZXJCb2FyZENvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9TdXBlckJvYXJkQ29udHJvbGxlclwiKTtcbnZhciBCb3hDb250cm9sbGVyID0gcmVxdWlyZShcIi4uL2NvbnRyb2xsZXIvQm94Q29udHJvbGxlclwiKTtcbnZhciBBY3Rpdml0eVRhc2tDb250cm9sbGVyID0gcmVxdWlyZShcIi4uL2NvbnRyb2xsZXIvQWN0aXZpdHlUYXNrQ29udHJvbGxlclwiKTtcbnZhciBBY3Rpdml0eVRhc2tFbnRyYW5jZUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9BY3Rpdml0eVRhc2tFbnRyYW5jZUNvbnRyb2xsZXJcIik7XG52YXIgQWN0aXZpdHlUYXNrVGlwc0NvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9BY3Rpdml0eVRhc2tUaXBzQ29udHJvbGxlclwiKTtcbnZhciBTa2luVW5sb2NrQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL1NraW5VbmxvY2tDb250cm9sbGVyXCIpO1xuXG52YXIgUG9wdXBNYW4gPSB7XG5cbiAgICBwb3B1cENvbW1vbkRsZzogZnVuY3Rpb24gKGluZm8sIHllc0NhbGxiYWNrKSB7XG4gICAgICAgIHZhciBub3RpY2VOb2RlID0gTm90aWNlQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG4gICAgICAgIG5vdGljZU5vZGUuY29udHJvbGxlci5pbml0V2l0aFllcyhpbmZvLCB5ZXNDYWxsYmFjaywgbnVsbCk7XG4gICAgICAgIG5vdGljZU5vZGUuY29udHJvbGxlci5wb3B1cCgpO1xuICAgIH0sXG5cbiAgICBwb3B1cFllc05vQ29tbW9uRGxnOiBmdW5jdGlvbiAoaW5mbywgeWVzSW5mbywgY2FuY2VsSW5mbywgeWVzQ2FsbGJhY2ssIG5vQ2FsbGJhY2ssIGlzU2hvd0Nsb3NlLCBpc1Nob3dBZHMpIHtcbiAgICAgICAgdmFyIG5vdGljZU5vZGUgPSBOb3RpY2VDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgbm90aWNlTm9kZS5jb250cm9sbGVyLmluaXRXaXRoWWVzTm8oaW5mbywgeWVzSW5mbywgY2FuY2VsSW5mbywgeWVzQ2FsbGJhY2ssIG5vQ2FsbGJhY2ssIGlzU2hvd0Nsb3NlLCBpc1Nob3dBZHMpO1xuICAgICAgICBub3RpY2VOb2RlLmNvbnRyb2xsZXIucG9wdXAoKTtcbiAgICB9LFxuXG4gICAgcG9wdXBSZXdhcmREbGc6IGZ1bmN0aW9uIChpbmZvLCB5ZXNDYWxsYmFjaywgcmV3YXJkMVNwcml0ZSwgcmV3YXJkMUNvdW50LCByZXdhcmQyU3ByaXRlLCByZXdhcmQyQ291bnQpIHtcbiAgICAgICAgdmFyIG5vdGljZU5vZGUgPSBOb3RpY2VDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgbm90aWNlTm9kZS5jb250cm9sbGVyLmluaXRXaXRoUmV3YXJkWWVzKGluZm8sIHllc0NhbGxiYWNrLCByZXdhcmQxU3ByaXRlLCByZXdhcmQxQ291bnQsIHJld2FyZDJTcHJpdGUsIHJld2FyZDJDb3VudCk7XG4gICAgICAgIG5vdGljZU5vZGUuY29udHJvbGxlci5wb3B1cCgpO1xuICAgIH0sXG5cbiAgICBwb3B1cE5ld1RpcENvbW1vbkRsZzogZnVuY3Rpb24gKGluZm8sIHllc0luZm8sIGNhbmNlbEluZm8sIHllc0NhbGxiYWNrLCBub0NhbGxiYWNrLCBpc1Nob3dDbG9zZSkge1xuICAgICAgICB2YXIgbm90aWNlTm9kZSA9IE5vdGljZUNvbnRyb2xsZXIuY3JlYXRlR3VpZGVGcm9tQ0NCKCk7XG4gICAgICAgIG5vdGljZU5vZGUuY29udHJvbGxlci5pbml0V2l0aFllc05vKGluZm8sIHllc0luZm8sIGNhbmNlbEluZm8sIHllc0NhbGxiYWNrLCBub0NhbGxiYWNrLCBpc1Nob3dDbG9zZSk7XG4gICAgICAgIG5vdGljZU5vZGUuY29udHJvbGxlci5wb3B1cCgpO1xuICAgIH0sXG5cbiAgICBwb3B1cEdhbWVPdmVyRGxnOiBmdW5jdGlvbiAocGVyY2VudCwgcmVwbGF5Q2FsbGJhY2spIHtcbiAgICAgICAgdmFyIGdhbWVPdmVyTm9kZSA9IEdhbWVPdmVyQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG4gICAgICAgIGdhbWVPdmVyTm9kZS5jb250cm9sbGVyLmluaXRXaXRoKHBlcmNlbnQsIHJlcGxheUNhbGxiYWNrKTtcbiAgICAgICAgZ2FtZU92ZXJOb2RlLmNvbnRyb2xsZXIucG9wdXAoKTtcbiAgICB9LFxuXG4gICAgcG9wdXBSYXRlRGxnOiBmdW5jdGlvbiAocmF0ZWRDYWxsYmFjaywgY2xvc2VDYWxsYmFjaykge1xuICAgICAgICB2YXIgcmF0ZUluZm8gPSBnYW1lLmxvY2FsLmdldFZhbHVlKFwicmF0ZV9pbmZvXCIpO1xuICAgICAgICB0aGlzLnBvcHVwWWVzTm9Db21tb25EbGcocmF0ZUluZm8sXG4gICAgICAgICAgICBnYW1lLmxvY2FsLmdldFZhbHVlKFwicmF0ZV9jb25maXJtXCIpLCBnYW1lLmxvY2FsLmdldFZhbHVlKFwicmF0ZV9jYW5jZWxcIiksIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAvL2NjLnN5cy5vcGVuVVJMKGdhbWUuY29uZmlnLmdldFBsYXRmb3JtRG93bmxvYWRVcmwoKSk7XG4gICAgICAgICAgICAgICAgaWYgKGdhbWUudXRpbHMuaXNJT1MoKSkge1xuICAgICAgICAgICAgICAgICAgICBjYy5zeXMub3BlblVSTChnYW1lLmNvbmZpZy5nZXRQbGF0Zm9ybURvd25sb2FkVXJsKCkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGpzYl9kcC5vbmVTZGtCcmlkZ2Uub3BlbkFwcGxpY2F0aW9uTWFya2V0KGdhbWUuY29uZmlnLmdldFBhY2thZ2VOYW1lKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBnYW1lLmFkc01hbmFnZXIucmF0ZVRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgICAgIGlmIChyYXRlZENhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIHJhdGVkQ2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChjbG9zZUNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNsb3NlQ2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBmYWxzZSk7XG4gICAgfSxcblxuICAgIHBvcHVwSGVscERsZzogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaGVscE5vZGUgPSBIZWxwQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG4gICAgICAgIGhlbHBOb2RlLmNvbnRyb2xsZXIucG9wdXAoKTtcbiAgICB9LFxuXG4gICAgcG9wdXBHYW1lV2luRGxnOiBmdW5jdGlvbiAocmVwbGF5Q2FsbGJhY2ssIG5leHRDYWxsYmFjaykge1xuICAgICAgICB2YXIgZ2FtZU92ZXJOb2RlID0gR2FtZVdpbkNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICBnYW1lT3Zlck5vZGUuY29udHJvbGxlci5pbml0V2l0aChyZXBsYXlDYWxsYmFjaywgbmV4dENhbGxiYWNrKTtcbiAgICAgICAgZ2FtZU92ZXJOb2RlLmNvbnRyb2xsZXIucG9wdXAoKTtcbiAgICB9LFxuXG4gICAgcG9wdXBQYXNzRGxnOiBmdW5jdGlvbiAocmVwbGF5Q2FsbGJhY2ssIG5leHRDYWxsYmFjaykge1xuICAgICAgICBpZiAoZ2FtZS51dGlscy5pc1NlbGZHYW1lKCkpIHtcbiAgICAgICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBQYXNzQ25EbGcocmVwbGF5Q2FsbGJhY2ssIG5leHRDYWxsYmFjayk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG5vZGUgPSBQYXNzQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG4gICAgICAgIG5vZGUuY29udHJvbGxlci5pbml0V2l0aChyZXBsYXlDYWxsYmFjaywgbmV4dENhbGxiYWNrKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLnBvcHVwKCk7XG4gICAgfSxcblxuICAgIHBvcHVwUGFzc0NuRGxnOiBmdW5jdGlvbiAocmVwbGF5Q2FsbGJhY2ssIG5leHRDYWxsYmFjaykge1xuICAgICAgICB2YXIgbm9kZSA9IFBhc3NDbkNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIuaW5pdFdpdGgocmVwbGF5Q2FsbGJhY2ssIG5leHRDYWxsYmFjayk7XG4gICAgICAgIG5vZGUuY29udHJvbGxlci5wb3B1cCgpO1xuICAgIH0sXG5cbiAgICBwb3B1cEZhaWxEbGc6IGZ1bmN0aW9uIChyZXBsYXlDYWxsYmFjaywgc2tpcENhbGxiYWNrKSB7XG4gICAgICAgIGlmIChnYW1lLnV0aWxzLmlzU2VsZkdhbWUoKSkge1xuICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cEZhaWxDbkRsZyhyZXBsYXlDYWxsYmFjaywgc2tpcENhbGxiYWNrKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgbm9kZSA9IEZhaWxDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLmluaXRXaXRoKHJlcGxheUNhbGxiYWNrLCBza2lwQ2FsbGJhY2spO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIucG9wdXAoKTtcbiAgICB9LFxuXG4gICAgcG9wdXBGYWlsQ25EbGc6IGZ1bmN0aW9uIChyZXBsYXlDYWxsYmFjaywgc2tpcENhbGxiYWNrKSB7XG4gICAgICAgIHZhciBub2RlID0gRmFpbENuQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG4gICAgICAgIG5vZGUuY29udHJvbGxlci5pbml0V2l0aChyZXBsYXlDYWxsYmFjaywgc2tpcENhbGxiYWNrKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLnBvcHVwKCk7XG4gICAgfSxcblxuICAgIHBvcHVwU3RvcmVEbGc6IGZ1bmN0aW9uICh0eXBlLCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgbm9kZSA9IFN0b3JlQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG4gICAgICAgIG5vZGUuY29udHJvbGxlci5pbml0V2l0aCh0eXBlLCBjYWxsYmFjayk7XG4gICAgICAgIG5vZGUuY29udHJvbGxlci5wb3B1cCgpO1xuICAgIH0sXG5cbiAgICBwb3B1cFBhdXNlRGxnOiBmdW5jdGlvbiAocmVzdWVtQ2FsbGJhY2spIHtcbiAgICAgICAgaWYgKGdhbWUudXRpbHMuaXNTZWxmR2FtZSgpKSB7XG4gICAgICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwUGF1c2VDbkRsZyhyZXN1ZW1DYWxsYmFjayk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG5vZGUgPSBQYXVzZUNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIuaW5pdFdpdGgocmVzdWVtQ2FsbGJhY2spO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIucG9wdXAoKTtcbiAgICB9LFxuXG4gICAgcG9wdXBQYXVzZUNuRGxnOiBmdW5jdGlvbiAocmVzdWVtQ2FsbGJhY2spIHtcbiAgICAgICAgdmFyIG5vZGUgPSBQYXVzZUNuQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG4gICAgICAgIG5vZGUuY29udHJvbGxlci5pbml0V2l0aChyZXN1ZW1DYWxsYmFjayk7XG4gICAgICAgIG5vZGUuY29udHJvbGxlci5wb3B1cCgpO1xuICAgIH0sXG5cbiAgICBwb3B1cFJhbmtEbGc6IGZ1bmN0aW9uIChyYW5rVHlwZSwgY2xvc2VDYWxsYmFjaykge1xuICAgICAgICB2YXIgbm9kZSA9IFJhbmtDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLmluaXQocmFua1R5cGUsIGNsb3NlQ2FsbGJhY2spO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIucG9wdXAoKTtcbiAgICAgICAgcmV0dXJuIG5vZGU7XG4gICAgfSxcbiAgICBwb3B1cEdyb3VwUmFua0RsZzogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5sYXN0R3JvdXBSYW5rTm9kZSkge1xuICAgICAgICAgICAgdGhpcy5sYXN0R3JvdXBSYW5rTm9kZS5jb250cm9sbGVyLmNsb3NlQ2FsbGJhY2sgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5sYXN0R3JvdXBSYW5rTm9kZS5jb250cm9sbGVyLmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIFJhbmtUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vUmFua1R5cGVcIik7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgdGhpcy5sYXN0R3JvdXBSYW5rTm9kZSA9IHRoaXMucG9wdXBSYW5rRGxnKFJhbmtUeXBlLkdyb3VwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzZWxmLmxhc3RHcm91cFJhbmtOb2RlID0gbnVsbDtcbiAgICAgICAgfSk7XG5cbiAgICB9LFxuICAgIHBvcHVwUmV3YXJkVmlkZW86IGZ1bmN0aW9uIChjbG9zZUNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBub2RlID0gUmV3YXJkVmlkZW9Db250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLmluaXQoY2xvc2VDYWxsYmFjayk7XG4gICAgICAgIG5vZGUuY29udHJvbGxlci5wb3B1cCgpO1xuICAgIH0sXG5cbiAgICBwb3B1cFdoZWVsRGxnOiBmdW5jdGlvbiAod2hlZWxUeXBlLCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgbm9kZSA9IFdoZWVsQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG4gICAgICAgIG5vZGUuY29udHJvbGxlci5pbml0V2l0aCh3aGVlbFR5cGUsIGNhbGxiYWNrKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLnBvcHVwKCk7XG4gICAgfSxcblxuICAgIHBvcHVwUmV3YXJkRG91YmxlVGlwRGxnOiBmdW5jdGlvbiAoaW1hZ2UsIGNvdW50LCByZXdhcmROYW1lLCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgbm9kZSA9IFJld2FyZERvdWJsZUNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIuaW5pdChpbWFnZSwgY291bnQsIHJld2FyZE5hbWUsIGNhbGxiYWNrKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLnBvcHVwKCk7XG4gICAgfSxcblxuICAgIHBvcHVwQmFnRGxnOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBub2RlID0gQmFnQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG4gICAgICAgIG5vZGUuY29udHJvbGxlci5wb3B1cCgpO1xuICAgIH0sXG5cbiAgICBwb3B1cFJld2FyZEdpZnQ6IGZ1bmN0aW9uIChjbG9zZUNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBub2RlID0gUmV3YXJkR2lmdENvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIuaW5pdChjbG9zZUNhbGxiYWNrKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLnBvcHVwKCk7XG4gICAgfSxcblxuICAgIHBvcHVwU2tpbkRsZzogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbm9kZSA9IFNraW5Db250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLnBvcHVwKCk7XG4gICAgfSxcblxuICAgIHBvcHVwRGFpbHlCb251czogZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBub2RlID0gRGFpbHlCb251c0NvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIuaW5pdFdpdGgoY2FsbGJhY2spO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIucG9wdXAoKTtcbiAgICB9LFxuXG4gICAgcG9wdXBTcGVpY2lhbE9mZmVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBub2RlID0gU3BlY2lhbE9mZmVyQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG4gICAgICAgIG5vZGUuY29udHJvbGxlci5wb3B1cCgpO1xuICAgIH0sXG5cbiAgICBwb3B1cFJld2FyZE5vdGljZURsZzogZnVuY3Rpb24gKGluZm8sIHllc0NhbGxiYWNrLCByZXdhcmQxU3ByaXRlLCByZXdhcmQxQ291bnQsIHJld2FyZDJTcHJpdGUsIHJld2FyZDJDb3VudCkge1xuICAgICAgICB2YXIgbm90aWNlTm9kZSA9IFJld2FyZE5vdGljZUNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICBub3RpY2VOb2RlLmNvbnRyb2xsZXIuaW5pdFdpdGhSZXdhcmRZZXMoaW5mbywgeWVzQ2FsbGJhY2ssIHJld2FyZDFTcHJpdGUsIHJld2FyZDFDb3VudCwgcmV3YXJkMlNwcml0ZSwgcmV3YXJkMkNvdW50KTtcbiAgICAgICAgbm90aWNlTm9kZS5jb250cm9sbGVyLnBvcHVwKCk7XG4gICAgfSxcblxuICAgIHBvcHVwVGFza0RsZzogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbm9kZSA9IFRhc2tDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLnBvcHVwKCk7XG4gICAgfSxcblxuICAgIHBvcHVwU2V0dGluZ0RsZzogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbm9kZSA9IFNldHRpbmdDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLnBvcHVwKCk7XG4gICAgfSxcblxuICAgIHBvcHVwUmVsaXZlRGxnOiBmdW5jdGlvbiAocmVhc29uLCByZWxpdmVDYWxsYmFjaywgY2FuY2VsQ2FsbGJhY2spIHtcbiAgICAgICAgdmFyIG5vZGUgPSBSZWxpdmVDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLmluaXRXaXRoKHJlYXNvbiwgcmVsaXZlQ2FsbGJhY2ssIGNhbmNlbENhbGxiYWNrKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLnBvcHVwKCk7XG4gICAgfSxcblxuICAgIHBvcHVwV2F0Y2hBZHNHZXRTa2luOiBmdW5jdGlvbiAoc2tpbkNmZywgY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIG5vZGUgPSBXYXRjaEFkc0dldFNraW5Db250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLmluaXRXaXRoKHNraW5DZmcsIGNhbGxiYWNrKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLnBvcHVwKCk7XG4gICAgfSxcblxuICAgIHBvcHVwU2tpblVubG9jazogZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBub2RlID0gU2tpblVubG9ja0NvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIuaW5pdFdpdGgoY2FsbGJhY2spO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIucG9wdXAoKTtcbiAgICB9LFxuXG4gICAgcG9wdXBXYXRjaEFkc0dldEl0ZW06IGZ1bmN0aW9uICh0aXRsZSwgc3ByaXRlTmFtZSwgcmV3YXJkTmFtZSwgY2xvc2VDYWxsYmFjaykge1xuICAgICAgICB2YXIgbm9kZSA9IFdhdGNoQWRzR2V0SXRlbUNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIuaW5pdFdpdGgodGl0bGUsIHNwcml0ZU5hbWUsIHJld2FyZE5hbWUsIGNsb3NlQ2FsbGJhY2spO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIucG9wdXAoKTtcbiAgICB9LFxuXG4gICAgcG9wdXBXYXRjaEFkc0dldERpYW1vbmRzOiBmdW5jdGlvbiAocmV3YXJkTmFtZSwgY2xvc2VDYWxsYmFjaykge1xuICAgICAgICB2YXIgbm9kZSA9IFdhdGNoQWRzR2V0RGlhbW9uZHNDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLmluaXRXaXRoKHJld2FyZE5hbWUsIGNsb3NlQ2FsbGJhY2spO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIucG9wdXAoKTtcbiAgICB9LFxuXG4gICAgcG9wdXBHZXQzU3RhcjogZnVuY3Rpb24gKHJld2FyZE5hbWUsIGNsb3NlQ2FsbGJhY2spIHtcbiAgICAgICAgdmFyIG5vZGUgPSBXYXRjaEFkc0dldDNTdGFyQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG4gICAgICAgIG5vZGUuY29udHJvbGxlci5pbml0V2l0aChyZXdhcmROYW1lLCBjbG9zZUNhbGxiYWNrKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLnBvcHVwKCk7XG4gICAgfSxcbiAgICBcbiAgICBwb3B1cFJlbGlmZTogZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBub2RlID0gV2F0Y2hBZHNSZWxpZmVDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLmluaXRXaXRoKGNhbGxiYWNrKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLnBvcHVwKCk7XG4gICAgfSxcblxuICAgIHBvcHVwQ2FyZDogZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBub2RlID0gQ2FyZENvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIuaW5pdFdpdGgoY2FsbGJhY2spO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIucG9wdXAoKTtcbiAgICB9LFxuXG4gICAgcG9wdXBHZXRSZXdhcmRzOiBmdW5jdGlvbiAocmV3YXJkcywgY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIFJld2FyZEdldENvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9SZXdhcmRHZXRDb250cm9sbGVyXCIpO1xuICAgICAgICB2YXIgbm9kZSA9IFJld2FyZEdldENvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIuaW5pdFdpdGhSZXdhcmRzKHJld2FyZHMsIGNhbGxiYWNrKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLnBvcHVwKCk7XG4gICAgfSxcblxuICAgIHBvcHVwTHVja3lTcGluOiBmdW5jdGlvbiAobXVsdGksIHJhbmdlLCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgTHVja3lTcGluQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL0x1Y2t5U3BpbkNvbnRyb2xsZXJcIik7XG4gICAgICAgIHZhciBub2RlID0gTHVja3lTcGluQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG4gICAgICAgIG5vZGUuY29udHJvbGxlci5pbml0V2l0aChtdWx0aSwgcmFuZ2UsIGNhbGxiYWNrKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLnBvcHVwKCk7XG4gICAgfSxcblxuICAgIHBvcHVwUmV3YXJkUmVtb3ZlQWRzOiBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIG5vZGUgPSBSZXdhcmRSZW1vdmVBZHNDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLmluaXRXaXRoKGNhbGxiYWNrKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLnBvcHVwKCk7XG4gICAgfSxcblxuICAgIHBvcHVwU3VwZXJCb2FyZDogZnVuY3Rpb24gKHJld2FyZE5hbWUsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBub2RlID0gU3VwZXJCb2FyZENvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIuaW5pdFdpdGgocmV3YXJkTmFtZSwgY2FsbGJhY2spO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIucG9wdXAoKTtcbiAgICB9LFxuXG4gICAgcG9wdXBCb3g6IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICB2YXIgbm9kZSA9IEJveENvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIuaW5pdFdpdGgoY2FsbGJhY2spO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIucG9wdXAoKTtcbiAgICB9LFxuXG4gICAgcG9wdXBBY3Rpdml0eVRhc2s6IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICB2YXIgbm9kZSA9IEFjdGl2aXR5VGFza0NvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIuaW5pdFdpdGgoY2FsbGJhY2spO1xuICAgICAgICBub2RlLmNvbnRyb2xsZXIucG9wdXAoKTtcbiAgICB9LFxuXG4gICAgcG9wdXBBY3Rpdml0eVRhc2tFbnRyYW5jZTogZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBub2RlID0gQWN0aXZpdHlUYXNrRW50cmFuY2VDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLmluaXRXaXRoKGNhbGxiYWNrKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLnBvcHVwKCk7XG4gICAgfSxcblxuICAgIHBvcHVwQWN0aXZpdHlUYXNrVGlwczogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbm9kZSA9IEFjdGl2aXR5VGFza1RpcHNDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLnBvcHVwKCk7XG4gICAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBQb3B1cE1hbjsiLCJ2YXIgRmlsZUNhY2hlU3R1YiA9IHJlcXVpcmUoXCIuLi8uLi9jb21tb24vdXRpbC9GaWxlQ2FjaGVTdHViXCIpO1xuXG52YXIgUmVzb3VyY2VzTWFuID0gY2MuQ2xhc3MuZXh0ZW5kKHtcblxuICAgIGZpbGVDYWNoZVN0dWI6IG51bGwsXG5cbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuZmlsZUNhY2hlU3R1YiA9IG5ldyBGaWxlQ2FjaGVTdHViKCk7XG4gICAgfSxcblxuICAgIHByZWxvYWQ6IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAvL2NjLmxvZyhcInByZWxvYWQgMTExXCIpO1xuICAgICAgICB2YXIgcmVzdWx0cyA9IGdhbWUudXRpbHMubG9hZEpzb24oXCJyZXMvcmVzb3VyY2VfbGlzdC9yZXNvdXJjZV9saXN0Lmpzb25cIik7XG4gICAgICAgIHZhciBhdWRpb3MgPSBnYW1lLnV0aWxzLmxvYWRKc29uKFwicmVzL3Jlc291cmNlX2xpc3QvYXVkaW9fbGlzdC5qc29uXCIpO1xuICAgICAgICB2YXIgZmlsZUNhY2hlU3R1YiA9IHRoaXMuZmlsZUNhY2hlU3R1YjtcblxuICAgICAgICB2YXIgcGljTGlzdCA9IFtdO1xuICAgICAgICB2YXIgcGxpc3RMaXN0ID0gW107XG4gICAgICAgIHZhciBjYWNoZUxpc3QgPSBbXTtcbiAgICAgICAgcmVzdWx0cy5mb3JFYWNoKGZ1bmN0aW9uIChmaWxlTmFtZSkge1xuICAgICAgICAgICAgdmFyIGV4dE5hbWUgPSBjYy5wYXRoLmV4dG5hbWUoZmlsZU5hbWUpO1xuICAgICAgICAgICAgaWYgKGV4dE5hbWUgPT09IFwiLnBuZ1wiIHx8IGV4dE5hbWUgPT09IFwiLmpwZ1wiKSB7XG4gICAgICAgICAgICAgICAgcGljTGlzdC5wdXNoKGZpbGVOYW1lKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXh0TmFtZSA9PT0gXCIucGxpc3RcIikge1xuICAgICAgICAgICAgICAgIHBsaXN0TGlzdC5wdXNoKGZpbGVOYW1lKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXh0TmFtZSA9PT0gXCIuY2NiaVwiIHx8IGV4dE5hbWUgPT09IFwiLmpzb25cIiB8fCBleHROYW1lID09PSBcIi5hdGxhc1wiIHx8IGV4dE5hbWUgPT09IFwiLm9nZ1wiKSB7XG4gICAgICAgICAgICAgICAgY2FjaGVMaXN0LnB1c2goZmlsZU5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB2YXIgbG9hZFBpY0Z1bmNzID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGljTGlzdC5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgLy9jYy5sb2coXCJwcmVsb2FkIDIyMlwiKTtcbiAgICAgICAgICAgIHZhciBsb2FkUGljRnVuYyA9IGZ1bmN0aW9uIChmaWxlTmFtZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNjLnRleHR1cmVDYWNoZS5hZGRJbWFnZShmaWxlTmFtZSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxvYWRQaWNGdW5jcy5wdXNoKGxvYWRQaWNGdW5jKHBpY0xpc3RbaV0pKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBsb2FkTGlzdEZ1YyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vY2MubG9nKFwicHJlbG9hZCAzMzNcIik7XG4gICAgICAgICAgICBwbGlzdExpc3QuZm9yRWFjaChmdW5jdGlvbiAoZmlsZU5hbWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBmaWxlTmFtZS5pbmRleE9mKFwiLlwiKTtcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcGxpc3ROYW1lID0gZmlsZU5hbWUuc3Vic3RyKDAsIGluZGV4KTtcbiAgICAgICAgICAgICAgICAgICAgY2Muc3ByaXRlRnJhbWVDYWNoZS5hZGRTcHJpdGVGcmFtZXMoZ2FtZS51dGlscy5zcHJpbnRmKFwiJXMucGxpc3RcIiwgcGxpc3ROYW1lKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUudXRpbHMuc3ByaW50ZihcIiVzLnBuZ1wiLCBwbGlzdE5hbWUpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgY2FjaGVGdW5jID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy9jYy5sb2coXCJwcmVsb2FkIDQ0NFwiKTtcbiAgICAgICAgICAgIGNhY2hlTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChmaWxlTmFtZSkge1xuICAgICAgICAgICAgICAgIGZpbGVDYWNoZVN0dWIuY2FjaGVGaWxlKGZpbGVOYW1lKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBwcmVsb2FkQXVkaW8gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvL2NjLmxvZyhcInByZWxvYWQgNTU1XCIpO1xuICAgICAgICAgICAgYXVkaW9zLmZvckVhY2goZnVuY3Rpb24gKGZpbGVOYW1lKSB7XG4gICAgICAgICAgICAgICAgZ2FtZS5hdWRpb1BsYXllci5wcmVsb2FkRWZmZWN0KGZpbGVOYW1lKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBmdW5jTGlzdCA9IGxvYWRQaWNGdW5jcy5jb25jYXQoW2xvYWRMaXN0RnVjLCBjYWNoZUZ1bmMsIHByZWxvYWRBdWRpb10pO1xuXG4gICAgICAgIGdhbWUudXRpbHMubG9hZEl0ZXJhdG9yKGZ1bmNMaXN0LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59KTtcblxuUmVzb3VyY2VzTWFuLl9pbnN0YW5jZSA9IG51bGw7XG5SZXNvdXJjZXNNYW4uX2ZpcnN0VXNlSW5zdGFuY2UgPSB0cnVlO1xuXG4vKipcbiAqXG4gKiBAcmV0dXJucyB7UmVzb3VyY2VzTWFufVxuICovXG5SZXNvdXJjZXNNYW4uZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKFJlc291cmNlc01hbi5fZmlyc3RVc2VJbnN0YW5jZSkge1xuICAgICAgICBSZXNvdXJjZXNNYW4uX2ZpcnN0VXNlSW5zdGFuY2UgPSBmYWxzZTtcbiAgICAgICAgUmVzb3VyY2VzTWFuLl9pbnN0YW5jZSA9IG5ldyBSZXNvdXJjZXNNYW4oKTtcbiAgICB9XG4gICAgcmV0dXJuIFJlc291cmNlc01hbi5faW5zdGFuY2U7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFJlc291cmNlc01hbjsiLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAyMDE4LzEvMS5cbiAqL1xuXG52YXIgU2NlbmVUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vU2NlbmVUeXBlXCIpO1xudmFyIE1lbnVTY2VuZSA9IHJlcXVpcmUoXCIuLi9zY2VuZS9NZW51U2NlbmVcIik7XG52YXIgTGV2ZWxTY2VuZSA9IHJlcXVpcmUoXCIuLi9zY2VuZS9MZXZlbFNjZW5lXCIpO1xudmFyIFBhY2thZ2VTY2VuZSA9IHJlcXVpcmUoXCIuLi9zY2VuZS9QYWNrYWdlU2NlbmVcIik7XG52YXIgR2FtZVNjZW5lID0gcmVxdWlyZShcIi4uL3NjZW5lL0dhbWVTY2VuZVwiKTtcbnZhciBHYW1lQnJpZGdlID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi9icmlkZ2UvR2FtZUJyaWRnZVwiKTtcbnZhciBDaGFsbGVuZ2VTY2VuZSA9IHJlcXVpcmUoXCIuLi9zY2VuZS9DaGFsbGVuZ2VTY2VuZVwiKTtcbnZhciBDaGFsbGVuZ2VMaXN0U2NlbmUgPSByZXF1aXJlKFwiLi4vc2NlbmUvQ2hhbGxlbmdlTGlzdFNjZW5lXCIpO1xuXG52YXIgU2NlbmVNYW4gPSBjYy5DbGFzcy5leHRlbmQoe1xuXG4gICAgc2NlbmVNYXA6IG51bGwsXG5cbiAgICBsYXN0U2NlbmU6IG51bGwsXG4gICAgY3VyU2NlbmU6IG51bGwsXG5cbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuc2NlbmVNYXAgPSB7fTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcigpO1xuICAgICAgICB0aGlzLmxhc3RTY2VuZSA9IFNjZW5lVHlwZS5OT05FO1xuICAgICAgICB0aGlzLmN1clNjZW5lID0gU2NlbmVUeXBlLk1FTlU7XG4gICAgfSxcblxuICAgIHNldEN1clNjZW5lOiBmdW5jdGlvbiAoc2NlbmUpIHtcbiAgICAgICAgdGhpcy5jdXJTY2VuZSA9IHNjZW5lO1xuICAgIH0sXG5cbiAgICByZWdpc3RlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnNjZW5lTWFwW1NjZW5lVHlwZS5NRU5VXSA9IEdhbWVCcmlkZ2UuZ2V0TWVudVNjZW5lO1xuICAgICAgICB0aGlzLnNjZW5lTWFwW1NjZW5lVHlwZS5QQUNLQUdFXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUGFja2FnZVNjZW5lKCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuc2NlbmVNYXBbU2NlbmVUeXBlLkxFVkVMXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgTGV2ZWxTY2VuZSgpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnNjZW5lTWFwW1NjZW5lVHlwZS5HQU1FXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgR2FtZVNjZW5lKCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuc2NlbmVNYXBbU2NlbmVUeXBlLkNIQUxMRU5HRV0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IENoYWxsZW5nZVNjZW5lKCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuc2NlbmVNYXBbU2NlbmVUeXBlLkNIQUxMRU5HRV9MSVNUXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQ2hhbGxlbmdlTGlzdFNjZW5lKCk7XG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIHN3aXRjaFNjZW5lOiBmdW5jdGlvbiAoc2NlbmVUeXBlKSB7XG4gICAgICAgIHRoaXMubGFzdFNjZW5lID0gdGhpcy5jdXJTY2VuZTtcbiAgICAgICAgdGhpcy5jdXJTY2VuZSA9IHNjZW5lVHlwZTtcbiAgICAgICAgdmFyIHNjZW5lID0gdGhpcy5zY2VuZU1hcFt0aGlzLmN1clNjZW5lXTtcbiAgICAgICAgaWYgKHNjZW5lKSB7XG4gICAgICAgICAgICBjYy5kaXJlY3Rvci5ydW5TY2VuZShzY2VuZSgpKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzd2l0Y2hMYXN0U2NlbmU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5zd2l0Y2hTY2VuZSh0aGlzLmxhc3RTY2VuZSk7XG4gICAgfVxufSk7XG5cblNjZW5lTWFuLl9pbnN0YW5jZSA9IG51bGw7XG5TY2VuZU1hbi5fZmlyc3RVc2VJbnN0YW5jZSA9IHRydWU7XG5cbi8qKlxuICpcbiAqIEByZXR1cm5zIHtTY2VuZU1hbn1cbiAqL1xuU2NlbmVNYW4uZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKFNjZW5lTWFuLl9maXJzdFVzZUluc3RhbmNlKSB7XG4gICAgICAgIFNjZW5lTWFuLl9maXJzdFVzZUluc3RhbmNlID0gZmFsc2U7XG4gICAgICAgIFNjZW5lTWFuLl9pbnN0YW5jZSA9IG5ldyBTY2VuZU1hbigpO1xuICAgIH1cbiAgICByZXR1cm4gU2NlbmVNYW4uX2luc3RhbmNlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBTY2VuZU1hbjsiLCIvKipcbiAqIENyZWF0ZWQgYnkgcWlubmluZyBvbiAyMDE3LzEvMjMuXG4gKi9cblxudmFyIFBheW1lbnRJbmZvID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi9lbnRpdHkvUGF5bWVudEluZm9cIik7XG52YXIgUGF5bWVudENvZGUgPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uL2VudW0vUGF5bWVudENvZGVcIik7XG52YXIgUHJvZHVjdEluZm8gPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uL2VudGl0eS9Qcm9kdWN0SW5mb1wiKTtcbnZhciBTdG9yZVR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9TdG9yZVR5cGVcIik7XG52YXIgQ29uZmlnTWFuID0gcmVxdWlyZShcIi4uL2NvbmZpZy9Db25maWdNYW5cIik7XG52YXIgQm9vc3RUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vQm9vc3RUeXBlXCIpO1xudmFyIEV2ZW50c05hbWUgPSByZXF1aXJlKFwiLi4vZXZlbnRzL0V2ZW50c05hbWVcIik7XG52YXIgU2tpblR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9Ta2luVHlwZVwiKTtcblxudmFyIFN0b3JlSGVscGVyID0gY2MuQ2xhc3MuZXh0ZW5kKHtcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtBcnJheS48UHJvZHVjdEluZm8+fVxuICAgICAqL1xuICAgIHByb2R1Y3RMaXN0OiBudWxsLFxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtBcnJheS48U3RvcmVDb25maWc+fVxuICAgICAqL1xuICAgIHN0b3JlTGlzdDogbnVsbCxcblxuICAgIGluaXRlZDogZmFsc2UsXG5cbiAgICBfcmV3YXJkQ0I6IG51bGwsXG5cbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdhbWUuc3RvcmVNYW5hZ2VyLnNldFBheW1lbnREZWxlZ2F0ZSh0aGlzKTtcbiAgICAgICAgZ2FtZS5hZHNNYW5hZ2VyLnNldEFkTGlzdGVuZXIodGhpcyk7XG4gICAgfSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuaW5pdGVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pbml0ZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLnN0b3JlTGlzdCA9IENvbmZpZ01hbi5nZXRJbnN0YW5jZSgpLmdldFN0b3JlTGlzdCgpO1xuICAgICAgICAvLyB0aGlzLnJlcXVlc3RQcm9kdWN0cygpO1xuICAgICAgICAvLyB0aGlzLmdldFVudmVyaWZpZWRSZWNlaXB0TGlzdCgpO1xuICAgIH0sXG5cbiAgICBjbGVhcjogZnVuY3Rpb24gKCkge1xuICAgICAgICBnYW1lLmFkc01hbmFnZXIuc2V0QWRMaXN0ZW5lcihudWxsKTtcbiAgICB9LFxuXG4gICAgb25SZXdhcmRlZFZpZGVvRmluaXNoZWQ6IGZ1bmN0aW9uIChpc1Jld2FyZGVkLCBjaGFubmVsTmFtZSkge1xuICAgICAgICBjYy5sb2coXCJTdG9yZUhlbHBlciBvblJld2FyZGVkVmlkZW9GaW5pc2hlZDpcIiArIGlzUmV3YXJkZWQpO1xuICAgICAgICB0aGlzLl9pc1Jld2FyZGVkID0gaXNSZXdhcmRlZDtcbiAgICAgICAgdGhpcy5fY2hhbm5lbE5hbWUgPSBjaGFubmVsTmFtZTtcbiAgICB9LFxuXG4gICAgb25TaG93VmlkZW9BZEJlZ2luOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNjLmxvZyhcIlN0b3JlSGVscGVyIG9uU2hvd1ZpZGVvQWRCZWdpblwiKTtcbiAgICAgICAgdGhpcy5faXNSZXdhcmRlZCA9IGZhbHNlO1xuICAgIH0sXG5cbiAgICBvblNob3dWaWRlb0FkRW5kOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNjLmxvZyhcIlN0b3JlSGVscGVyIG9uU2hvd1ZpZGVvQWRFbmRcIik7XG4gICAgICAgIHZhciB0aW1lID0gNTAwO1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9pc1Jld2FyZGVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vblJld2FyZGVkVmlkZW9SZXdhcmQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9pc1Jld2FyZGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9yZXdhcmRDQikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXdhcmRDQihmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Jld2FyZENCID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0uYmluZCh0aGlzKSwgdGltZSk7XG4gICAgfSxcblxuICAgIG9uUmV3YXJkZWRWaWRlb1Jld2FyZDogZnVuY3Rpb24gKCkge1xuICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRXZlbnQoXCJXYXRjaFJWU291cmNlXCIsIHtuYW1lOiB0aGlzLl9hZE5hbWUsIGNoYW5uZWw6IHRoaXMuX2NoYW5uZWxOYW1lfSk7XG4gICAgICAgIGlmICh0aGlzLl9yZXdhcmRDQikge1xuICAgICAgICAgICAgdGhpcy5fcmV3YXJkQ0IodHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLl9yZXdhcmRDQiA9IG51bGw7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGdhbWUucGxheWVyTWFuLmdldFJld2FyZEFkUGxhY2VDb3VudFBlckRheSgpID49IGdhbWUuY29uZmlnLnJld2FyZEFkTWF4Q291bnRQZXJEYXkpIHtcbiAgICAgICAgICAgIGNjLmxvZyhcIlN0b3JlSGVscGVyIG9uUmV3YXJkZWRWaWRlb1Jld2FyZCBoYXMgcmVhY2hlZCBtYXggY291bnQ6XCIgKyBnYW1lLnBsYXllck1hbi5nZXRSZXdhcmRBZFBsYWNlQ291bnRQZXJEYXkoKSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG5hbWUgPSBcIlwiO1xuICAgICAgICBpZiAodGhpcy5fYWRQYXJhbTEpIHtcbiAgICAgICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudCh0aGlzLl9hZFBhcmFtMSk7XG4gICAgICAgICAgICBuYW1lID0gdGhpcy5fYWRQYXJhbTE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBuYW1lID0gXCJ1bmtub3duXCI7XG4gICAgICAgICAgICBjYy5lcnJvcihcIlN0b3JlSGVscGVyIGFkUGFyYW0gaXMgbnVsbDpcIiArIHRoaXMuX2FkUGFyYW0xKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9hZFBhcmFtMSA9IG51bGw7XG4gICAgICAgIGdhbWUucGxheWVyTWFuLmFkZFJld2FyZEFkQ291bnRQZXJEYXkoKTtcbiAgICAgICAgdmFyIGZyZWVFbnRpdHkgPSB0aGlzLmdldFN0b3JlRW50aXR5QnlUeXBlKFN0b3JlVHlwZS5GUkVFKTtcbiAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFJld2FyZE5vdGljZURsZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwicmV3YXJkX3ZpZGVvX2RpYW1vbmRzXCIpLFxuICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLmFkZERpYW1vbmRzKGZyZWVFbnRpdHkuY291bnQsIFwicmV3YXJkX3ZpZGVvX1wiICsgbmFtZSk7XG4gICAgICAgICAgICB9LCB0aGlzLmdldEJvb3N0SW1hZ2UoQm9vc3RUeXBlLkRJQU1PTkQpLCBmcmVlRW50aXR5LmNvdW50KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHBpZFxuICAgICAqIEByZXR1cm5zIHtTdG9yZUNvbmZpZyB8IG51bGx9XG4gICAgICovXG4gICAgZ2V0U3RvcmVFbnRpdHk6IGZ1bmN0aW9uIChwaWQpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnN0b3JlTGlzdC5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RvcmVMaXN0W2ldLnBpZCA9PT0gcGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RvcmVMaXN0W2ldO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH0sXG5cbiAgICBnZXRTdG9yZUVudGl0eUJ5VHlwZTogZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnN0b3JlTGlzdC5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RvcmVMaXN0W2ldLnR5cGUgPT09IHR5cGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zdG9yZUxpc3RbaV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSxcblxuICAgIGdldEJvb3N0SW1hZ2U6IGZ1bmN0aW9uIChib29zdFR5cGUpIHtcbiAgICAgICAgc3dpdGNoIChib29zdFR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgQm9vc3RUeXBlLlNQTElUOlxuICAgICAgICAgICAgICAgIHJldHVybiBcInN0b3JlXzNfbXVsdGlwbGUucG5nXCI7XG4gICAgICAgICAgICBjYXNlIEJvb3N0VHlwZS5USFJFRV9CQUxMOlxuICAgICAgICAgICAgICAgIHJldHVybiBcInN0b3JlXzNfbmV3LnBuZ1wiO1xuICAgICAgICAgICAgY2FzZSBCb29zdFR5cGUuRElBTU9ORDpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJpY29uX2RpYW1vbmRfMS5wbmdcIjtcbiAgICAgICAgICAgIGNhc2UgQm9vc3RUeXBlLkFJTV9JVEVNOlxuICAgICAgICAgICAgICAgIHJldHVybiBcInN0b3JlX2FpbS5wbmdcIjtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBfZ2V0TnVtRnJvbVN0cmluZzogZnVuY3Rpb24gKHRleHQpIHtcbiAgICAgICAgcmV0dXJuIHRleHQucmVwbGFjZSgvW14wLTkuXS9pZywgXCJcIik7XG4gICAgfSxcblxuICAgIHVwZGF0ZVByaWNlOiBmdW5jdGlvbiAocHJvZHVjdCkge1xuICAgICAgICB2YXIgc3RvcmVQcm9kdWN0ID0gdGhpcy5nZXRTdG9yZUVudGl0eShwcm9kdWN0LnByb2R1Y3RJZCk7XG4gICAgICAgIGlmIChzdG9yZVByb2R1Y3QpIHtcbiAgICAgICAgICAgIHN0b3JlUHJvZHVjdC5wcmljZSA9IHByb2R1Y3QucHJpY2U7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGlmIChzdG9yZVByb2R1Y3Qub3JpZ2luYWxfcHJpY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHByaWNlU3RyID0gdGhpcy5fZ2V0TnVtRnJvbVN0cmluZyhwcm9kdWN0LnByaWNlKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHByaWNlTnVtID0gTnVtYmVyKHByaWNlU3RyKTtcbiAgICAgICAgICAgICAgICAgICAgc3RvcmVQcm9kdWN0Lm9yaWdpbmFsX3ByaWNlID0gcHJvZHVjdC5wcmljZS5yZXBsYWNlKHByaWNlU3RyLFxuICAgICAgICAgICAgICAgICAgICAgICAgKHByaWNlTnVtICogKHN0b3JlUHJvZHVjdC5kaXNjb3VudF9tdWx0aSArIDEpKS50b0ZpeGVkKDIpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGNhdGNoIChleCkge1xuICAgICAgICAgICAgICAgIGNjLmVycm9yKFwidXBkYXRlIHByaWNlOlwiICsgZXgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGNoZWNrQW5kU2hvd1Jld2FyZFZpZGVvOiBmdW5jdGlvbiAobmFtZSwgY2IsIHBhcmFtMSkge1xuICAgICAgICB0aGlzLl9hZFBhcmFtMSA9IHBhcmFtMTtcbiAgICAgICAgdGhpcy5fYWROYW1lID0gbmFtZTtcbiAgICAgICAgaWYgKGdhbWUuYWRzTWFuYWdlci5pc1Jld2FyZFZpZGVvUmVhZHkoKSkge1xuICAgICAgICAgICAgdGhpcy5fcmV3YXJkQ0IgPSBjYjtcbiAgICAgICAgICAgIGdhbWUuYWRzTWFuYWdlci5zaG93UmV3YXJkVmlkZW9BZChuYW1lKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcIldhdGNoUlZOb3RSZWFkeVwiLCB7bmFtZTogbmFtZX0pO1xuICAgICAgICAgICAgY2IgJiYgY2IoZmFsc2UpO1xuICAgICAgICAgICAgY2MubG9nKFwicmV3YXJkIHZpZGVvIG5vdCByZWFkeVwiKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge1N0b3JlQ29uZmlnfSBzdG9yZUVudGl0eVxuICAgICAqL1xuICAgIGJ1eVByb2R1Y3Q6IGZ1bmN0aW9uIChzdG9yZUVudGl0eSkge1xuICAgICAgICBzd2l0Y2ggKHN0b3JlRW50aXR5LnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgU3RvcmVUeXBlLk5FV18zOlxuICAgICAgICAgICAgY2FzZSBTdG9yZVR5cGUuU1BMSVQ6XG4gICAgICAgICAgICBjYXNlIFN0b3JlVHlwZS5GSVJTVF9QVVJDSEFTRTpcbiAgICAgICAgICAgICAgICBnYW1lLnN0b3JlTWFuYWdlci5wYXlGb3JQcm9kdWN0KHN0b3JlRW50aXR5LnBpZCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFN0b3JlVHlwZS5ESUFNT05EOlxuICAgICAgICAgICAgICAgIC8vZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiUHVyY2hhc2VEaWFtb25kc1wiLCB7XCJwaWRcIjogc3RvcmVFbnRpdHkucGlkfSk7XG4gICAgICAgICAgICAgICAgZ2FtZS5zdG9yZU1hbmFnZXIucGF5Rm9yUHJvZHVjdChzdG9yZUVudGl0eS5waWQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBTdG9yZVR5cGUuRlJFRTpcbiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrQW5kU2hvd1Jld2FyZFZpZGVvKGdhbWUudXRpbHMuaXNJT1MoKSA/IFwiZGFvanUwMVwiIDogXCJqaWxpMDNcIik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFN0b3JlVHlwZS5SRU1PVkVfQURTOlxuICAgICAgICAgICAgICAgIHRoaXMuYnV5UmVtb3ZlQWRzKHN0b3JlRW50aXR5LnBpZCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFN0b3JlVHlwZS5SRVNUT1JFOlxuICAgICAgICAgICAgICAgIGdhbWUuc3RvcmVNYW5hZ2VyLnJlc3RvcmVDb21wbGV0ZWRUcmFuc2FjdGlvbnMoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgU3RvcmVUeXBlLk5FV19BTkRfU1BMSVQ6XG4gICAgICAgICAgICAgICAgdGhpcy5idXlCb29zdHMoc3RvcmVFbnRpdHkpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBTdG9yZVR5cGUuQUlNX0lURU06XG4gICAgICAgICAgICAgICAgZ2FtZS5zdG9yZU1hbmFnZXIucGF5Rm9yUHJvZHVjdChzdG9yZUVudGl0eS5waWQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGJ1eVJlbW92ZUFkczogZnVuY3Rpb24gKHBpZCkge1xuICAgICAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4ucGxheWVyLnJlbW92ZWRBZHMpIHtcbiAgICAgICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBDb21tb25EbGcoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcInJlbW92ZWRfYWxsX2Fkc190aXBzXCIpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChjYy5zeXMub3MgPT09IGNjLnN5cy5PU19BTkRST0lEKSB7XG4gICAgICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFllc05vQ29tbW9uRGxnKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJwdXJjaGFzZV9ub19hZF90aXBzXCIpLFxuICAgICAgICAgICAgICAgICAgICBnYW1lLmxvY2FsLmdldFZhbHVlKFwiYnV5X3RpdGxlXCIpLCBnYW1lLmxvY2FsLmdldFZhbHVlKFwiY2FuY2VsX3RpdGxlXCIpLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBnYW1lLnN0b3JlTWFuYWdlci5wYXlGb3JQcm9kdWN0KHBpZCk7XG4gICAgICAgICAgICAgICAgICAgIH0sIG51bGwsIGZhbHNlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFllc05vQ29tbW9uRGxnKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJwdXJjaGFzZV9ub19hZF90aXBzXCIpLFxuICAgICAgICAgICAgICAgICAgICBnYW1lLmxvY2FsLmdldFZhbHVlKFwiYnV5X3RpdGxlXCIpLCBnYW1lLmxvY2FsLmdldFZhbHVlKFwicmVzdG9yZV90aXRsZVwiKSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBnYW1lLnN0b3JlTWFuYWdlci5wYXlGb3JQcm9kdWN0KHBpZCk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBnYW1lLnN0b3JlTWFuYWdlci5yZXN0b3JlQ29tcGxldGVkVHJhbnNhY3Rpb25zKCk7XG4gICAgICAgICAgICAgICAgfSwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgYnV5U2tpbjogZnVuY3Rpb24gKHNraW5DZmcsIHJld2FyZE5hbWUsIGNiKSB7XG4gICAgICAgIGlmICghZ2FtZS5wbGF5ZXJNYW4uaGFzU2tpbihza2luQ2ZnLmlkKSkge1xuICAgICAgICAgICAgc3dpdGNoIChza2luQ2ZnLnR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFNraW5UeXBlLkRpYW1vbmRzOlxuICAgICAgICAgICAgICAgICAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4uZ2V0RGlhbW9uZHMoKSA+PSBza2luQ2ZnLmNvdW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRDbGFpbWVkU2tpbihza2luQ2ZnLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLnNldEN1cnJlbnRTa2luSWQoc2tpbkNmZy5pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5hZGREaWFtb25kcygtc2tpbkNmZy5jb3VudCwgXCJwdXJjaGFzZV9za2luXCIsIFwic2tpblwiLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQoRXZlbnRzTmFtZS5VUERBVEVfU0tJTik7XG4gICAgICAgICAgICAgICAgICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRXZlbnQoXCJEaWFtb25kUHVyY2hhc2VTa2luXCIsIHtcInNraW5JZFwiOiBza2luQ2ZnLmlkfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYiAmJiBjYih0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucG9wdXBMYWNrRGlhbW9uZHMoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFNraW5UeXBlLldhdGNoQWRzOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNoZWNrQW5kU2hvd1Jld2FyZFZpZGVvKHJld2FyZE5hbWUsIGZ1bmN0aW9uIChyZXdhcmRlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJld2FyZGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uYWRkU2tpbkFkc0NvdW50KHNraW5DZmcuaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5nZXRTa2luQWRzQ291bnQoc2tpbkNmZy5pZCkgPj0gc2tpbkNmZy5jb3VudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRDbGFpbWVkU2tpbihza2luQ2ZnLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uc2V0Q3VycmVudFNraW5JZChza2luQ2ZnLmlkKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwUmV3YXJkTm90aWNlRGxnKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJza2luX2NsYWltZWRcIiksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBza2luQ2ZnLmltYWdlICsgXCJfbC5wbmdcIiwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNiICYmIGNiKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRXZlbnQoXCJSZXdhcmRWaWRlb1B1cmNoYXNlU2tpblwiLCB7XCJza2luSWRcIjogc2tpbkNmZy5pZH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQoRXZlbnRzTmFtZS5VUERBVEVfU0tJTik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBjYy5lcnJvcihcInVuZGVmaW5lZCBza2luIHR5cGU6XCIgKyBza2luQ2ZnLnR5cGUpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvblNraW5XYXRjaEFkc093bmVkOiBmdW5jdGlvbiAoc2tpbkNmZywgY2IpIHtcbiAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uYWRkU2tpbkFkc0NvdW50KHNraW5DZmcuaWQpO1xuICAgICAgICAvLyBpZiAoZ2FtZS5wbGF5ZXJNYW4uZ2V0U2tpbkFkc0NvdW50KHNraW5DZmcuaWQpID49IHNraW5DZmcuY291bnQpIHtcbiAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLnNldENsYWltZWRTa2luKHNraW5DZmcuaWQpO1xuICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uc2V0Q3VycmVudFNraW5JZChza2luQ2ZnLmlkKTtcblxuICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFJld2FyZE5vdGljZURsZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwic2tpbl9jbGFpbWVkXCIpLFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2IgJiYgY2IoKTtcbiAgICAgICAgICAgICAgICB9LCBza2luQ2ZnLmltYWdlICsgXCJfbC5wbmdcIiwgMSk7XG5cbiAgICAgICAgLy8gfVxuICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRXZlbnQoXCJSZXdhcmRWaWRlb1B1cmNoYXNlU2tpblwiLCB7XCJza2luSWRcIjogc2tpbkNmZy5pZH0pO1xuICAgICAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KEV2ZW50c05hbWUuVVBEQVRFX1NLSU4pO1xuICAgIH0sXG5cbiAgICBidXlCb2FyZDogZnVuY3Rpb24gKGJvYXJkQ2ZnLCByZXdhcmROYW1lLCBjYikge1xuICAgICAgICBpZiAoIWdhbWUucGxheWVyTWFuLmhhc0JvYXJkKGJvYXJkQ2ZnLmlkKSkge1xuICAgICAgICAgICAgc3dpdGNoIChib2FyZENmZy50eXBlKSB7XG4gICAgICAgICAgICAgICAgLy8gY2FzZSBTa2luVHlwZS5EaWFtb25kczpcbiAgICAgICAgICAgICAgICAvLyAgICAgaWYgKGdhbWUucGxheWVyTWFuLmdldERpYW1vbmRzKCkgPj0gc2tpbkNmZy5jb3VudCkge1xuICAgICAgICAgICAgICAgIC8vICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uc2V0Q2xhaW1lZFNraW4oc2tpbkNmZy5pZCk7XG4gICAgICAgICAgICAgICAgLy8gICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRDdXJyZW50U2tpbklkKHNraW5DZmcuaWQpO1xuICAgICAgICAgICAgICAgIC8vICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uYWRkRGlhbW9uZHMoLXNraW5DZmcuY291bnQsIFwicHVyY2hhc2Vfc2tpblwiLCBcInNraW5cIiwgMSk7XG4gICAgICAgICAgICAgICAgLy8gICAgICAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KEV2ZW50c05hbWUuVVBEQVRFX1NLSU4pO1xuICAgICAgICAgICAgICAgIC8vICAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiRGlhbW9uZFB1cmNoYXNlU2tpblwiLCB7XCJza2luSWRcIjogc2tpbkNmZy5pZH0pO1xuICAgICAgICAgICAgICAgIC8vICAgICAgICAgY2IgJiYgY2IodHJ1ZSk7XG4gICAgICAgICAgICAgICAgLy8gICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gICAgICAgICB0aGlzLnBvcHVwTGFja0RpYW1vbmRzKCk7XG4gICAgICAgICAgICAgICAgLy8gICAgIH1cbiAgICAgICAgICAgICAgICAvLyAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBTa2luVHlwZS5XYXRjaEFkczpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGVja0FuZFNob3dSZXdhcmRWaWRlbyhyZXdhcmROYW1lLCBmdW5jdGlvbiAocmV3YXJkZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXdhcmRlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLmFkZEJvYXJkQWRzQ291bnQoYm9hcmRDZmcuaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5nZXRCb2FyZEFkc0NvdW50KGJvYXJkQ2ZnLmlkKSA+PSBib2FyZENmZy5jb3VudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRDbGFpbWVkQm9hcmQoYm9hcmRDZmcuaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRDdXJyZW50Qm9hcmRJZChib2FyZENmZy5pZCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFJld2FyZE5vdGljZURsZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwiYm9hcmRfY2xhaW1lZFwiKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGJvYXJkQ2ZnLmltYWdlICsgXCIucG5nXCIsIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYiAmJiBjYih0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiUmV3YXJkVmlkZW9QdXJjaGFzZUJvYXJkXCIsIHtcImJvYXJkSWRcIjogYm9hcmRDZmcuaWR9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KEV2ZW50c05hbWUuVVBEQVRFX0JPQVJEKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIGNjLmVycm9yKFwidW5kZWZpbmVkIHNraW4gdHlwZTpcIiArIGJvYXJkQ2ZnLnR5cGUpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRDbGFpbWVkU2tpbkNvdW50OiBmdW5jdGlvbiAoc2tpblR5cGUpIHtcbiAgICAgICAgdmFyIGNvdW50ID0gMDtcbiAgICAgICAgdmFyIHNraW5MaXN0ID0gQ29uZmlnTWFuLmdldEluc3RhbmNlKCkuZ2V0U2tpbkxpc3RCeVR5cGUoc2tpblR5cGUpO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNraW5MaXN0Lmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB2YXIgc2tpbkNmZyA9IHNraW5MaXN0W2ldO1xuICAgICAgICAgICAgdmFyIG93bmVkID0gZ2FtZS5wbGF5ZXJNYW4uaGFzU2tpbihza2luQ2ZnLmlkKTtcbiAgICAgICAgICAgIGlmIChvd25lZCkge1xuICAgICAgICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvdW50O1xuICAgIH0sXG5cbiAgICBnZXRDbGFpbWVkQm9hcmRTa2luQ291bnQ6IGZ1bmN0aW9uIChza2luVHlwZSkge1xuICAgICAgICB2YXIgY291bnQgPSAwO1xuICAgICAgICB2YXIgc2tpbkxpc3QgPSBDb25maWdNYW4uZ2V0SW5zdGFuY2UoKS5nZXRCb2FyZExpc3RCeVR5cGUoc2tpblR5cGUpO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNraW5MaXN0Lmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB2YXIgc2tpbkNmZyA9IHNraW5MaXN0W2ldO1xuICAgICAgICAgICAgdmFyIG93bmVkID0gZ2FtZS5wbGF5ZXJNYW4uaGFzQm9hcmQoc2tpbkNmZy5pZCk7XG4gICAgICAgICAgICBpZiAob3duZWQpIHtcbiAgICAgICAgICAgICAgICBjb3VudCsrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb3VudDtcbiAgICB9LFxuXG4gICAgY2xhaW1Ta2luUmV3YXJkOiBmdW5jdGlvbiAoc2tpbkNmZywgbm90aWZ5LCBjYWxsYmFjaykge1xuICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRDbGFpbWVkU2tpbihza2luQ2ZnLmlkKTtcbiAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uc2V0Q3VycmVudFNraW5JZChza2luQ2ZnLmlkKTtcbiAgICAgICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChFdmVudHNOYW1lLlVQREFURV9TS0lOKTtcblxuICAgICAgICBpZiAoc2tpbkNmZy50eXBlID09PSBTa2luVHlwZS5LZXlBY3Rpdml0eSkge1xuICAgICAgICAgICAgdmFyIGNsYWltZWRDb3VudCA9IHRoaXMuZ2V0Q2xhaW1lZFNraW5Db3VudChTa2luVHlwZS5LZXlBY3Rpdml0eSk7XG4gICAgICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRXZlbnQoXCJDbGFpbWVkQ2hlc3RTa2luQ291bnRcIiwge1wiY291bnRcIjogY2xhaW1lZENvdW50fSk7XG5cbiAgICAgICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcIkNsYWltZWRDaGVzdFRvdGFsU2tpbkNvdW50XCIsIHtcImNvdW50XCI6IHRoaXMuZ2V0Q2xhaW1lZEJvYXJkU2tpbkNvdW50KFNraW5UeXBlLktleUFjdGl2aXR5KSArIGNsYWltZWRDb3VudH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFub3RpZnkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgaW1hZ2UgPSBza2luQ2ZnLmltYWdlICsgXCJfbC5wbmdcIjtcbiAgICAgICAgaWYgKCFjYy5zcHJpdGVGcmFtZUNhY2hlLmdldFNwcml0ZUZyYW1lKGltYWdlKSkge1xuICAgICAgICAgICAgaW1hZ2UgPSBza2luQ2ZnLmltYWdlICsgXCIucG5nXCI7XG4gICAgICAgIH1cbiAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFJld2FyZE5vdGljZURsZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwic2tpbl9jbGFpbWVkXCIpLFxuICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9LCBpbWFnZSwgMSk7XG4gICAgfSxcblxuICAgIGNsYWltQm9hcmRSZXdhcmQ6IGZ1bmN0aW9uIChib2FyZENmZywgbm90aWZ5LCBjYWxsYmFjaykge1xuICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRDbGFpbWVkQm9hcmQoYm9hcmRDZmcuaWQpO1xuICAgICAgICBnYW1lLnBsYXllck1hbi5zZXRDdXJyZW50Qm9hcmRJZChib2FyZENmZy5pZCk7XG5cbiAgICAgICAgaWYgKGJvYXJkQ2ZnLnR5cGUgPT09IFNraW5UeXBlLktleUFjdGl2aXR5KSB7XG4gICAgICAgICAgICB2YXIgY2xhaW1lZENvdW50ID0gdGhpcy5nZXRDbGFpbWVkQm9hcmRTa2luQ291bnQoU2tpblR5cGUuS2V5QWN0aXZpdHkpO1xuICAgICAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiQ2xhaW1lZENoZXN0Qm9hcmRTa2luQ291bnRcIiwge1wiY291bnRcIjogY2xhaW1lZENvdW50fSk7XG5cbiAgICAgICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcIkNsYWltZWRDaGVzdFRvdGFsU2tpbkNvdW50XCIsIHtcImNvdW50XCI6IHRoaXMuZ2V0Q2xhaW1lZFNraW5Db3VudChTa2luVHlwZS5LZXlBY3Rpdml0eSkgKyBjbGFpbWVkQ291bnR9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghbm90aWZ5KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFJld2FyZE5vdGljZURsZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwiYm9hcmRfY2xhaW1lZFwiKSxcbiAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfSwgYm9hcmRDZmcuaW1hZ2UgKyBcIi5wbmdcIiwgMSk7XG4gICAgfSxcblxuICAgIHVzZVNraW46IGZ1bmN0aW9uIChza2luQ2ZnKSB7XG4gICAgICAgIGdhbWUucGxheWVyTWFuLnNldEN1cnJlbnRTa2luSWQoc2tpbkNmZy5pZCk7XG4gICAgICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQoRXZlbnRzTmFtZS5VUERBVEVfU0tJTik7XG4gICAgfSxcblxuICAgIGJ1eUJvb3N0czogZnVuY3Rpb24gKHN0b3JlRW50aXR5KSB7XG4gICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5nZXREaWFtb25kcygpID49IHN0b3JlRW50aXR5LmNvdW50KSB7XG4gICAgICAgICAgICB2YXIgc3BsaXRDb3VudCA9IHN0b3JlRW50aXR5LmRhdGEubXVsdGlwbGVfMztcbiAgICAgICAgICAgIHZhciB0aHJlZUJhbGxDb3VudCA9IHN0b3JlRW50aXR5LmRhdGEubmV3XzM7XG4gICAgICAgICAgICB2YXIgc3BsaXRJbWFnZSA9IHRoaXMuZ2V0Qm9vc3RJbWFnZShCb29zdFR5cGUuU1BMSVQpO1xuICAgICAgICAgICAgdmFyIG5ldzNJbWFnZSA9IHRoaXMuZ2V0Qm9vc3RJbWFnZShCb29zdFR5cGUuVEhSRUVfQkFMTCk7XG4gICAgICAgICAgICBnYW1lLnBsYXllck1hbi5hZGREaWFtb25kcygtc3RvcmVFbnRpdHkuY291bnQgLyAyLCBcImJ1eV9ib29zdHNcIiwgXCJib29zdF9zcGxpdFwiLCBzcGxpdENvdW50KTtcbiAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLmFkZERpYW1vbmRzKC1zdG9yZUVudGl0eS5jb3VudCAvIDIsIFwiYnV5X2Jvb3N0c1wiLCBcImJvb3N0X25ld18zXCIsIHRocmVlQmFsbENvdW50KTtcbiAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLmFkZEJvb3N0KEJvb3N0VHlwZS5TUExJVCwgc3BsaXRDb3VudCk7XG4gICAgICAgICAgICBnYW1lLnBsYXllck1hbi5hZGRCb29zdChCb29zdFR5cGUuVEhSRUVfQkFMTCwgdGhyZWVCYWxsQ291bnQpO1xuICAgICAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiRGlhbW9uZFB1cmNoYXNlQm9vc3RzXCIsIHtcImRpYW1vbmRzXCI6IHN0b3JlRW50aXR5LmNvdW50fSk7XG4gICAgICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwUmV3YXJkRGxnKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJwdXJjaGFzZV9ib29zdF9zdWNjZXNzXCIpLFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB9LCBzcGxpdEltYWdlLCBzcGxpdENvdW50LCBuZXczSW1hZ2UsIHRocmVlQmFsbENvdW50KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucG9wdXBMYWNrRGlhbW9uZHMoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBidXlPbmVCb29zdDogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgc3RvcmVFbnRpdHkgPSB7XG4gICAgICAgICAgICBcImNvdW50XCI6IDIwLFxuICAgICAgICAgICAgXCJkYXRhXCI6IHtcbiAgICAgICAgICAgICAgICBcIm5ld18zXCI6IDEsXG4gICAgICAgICAgICAgICAgXCJtdWx0aXBsZV8zXCI6IDFcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgaWYgKGdhbWUucGxheWVyTWFuLmdldERpYW1vbmRzKCkgPj0gc3RvcmVFbnRpdHkuY291bnQpIHtcbiAgICAgICAgICAgIHZhciBzcGxpdENvdW50ID0gc3RvcmVFbnRpdHkuZGF0YS5tdWx0aXBsZV8zO1xuICAgICAgICAgICAgdmFyIHRocmVlQmFsbENvdW50ID0gc3RvcmVFbnRpdHkuZGF0YS5uZXdfMztcbiAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLmFkZERpYW1vbmRzKC1zdG9yZUVudGl0eS5jb3VudCAvIDIsIFwiYnV5X2Jvb3N0c1wiLCBcImJvb3N0X3NwbGl0XCIsIHNwbGl0Q291bnQpO1xuICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uYWRkRGlhbW9uZHMoLXN0b3JlRW50aXR5LmNvdW50IC8gMiwgXCJidXlfYm9vc3RzXCIsIFwiYm9vc3RfbmV3XzNcIiwgdGhyZWVCYWxsQ291bnQpO1xuICAgICAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiRGlhbW9uZFB1cmNoYXNlQm9vc3RzSW5HYW1lXCIsIHtcImRpYW1vbmRzXCI6IHN0b3JlRW50aXR5LmNvdW50fSk7XG4gICAgICAgICAgICBnYW1lLnBsYXllck1hbi5hZGRCb29zdChCb29zdFR5cGUuU1BMSVQsIHNwbGl0Q291bnQpO1xuICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uYWRkQm9vc3QoQm9vc3RUeXBlLlRIUkVFX0JBTEwsIHRocmVlQmFsbENvdW50KTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy90aGlzLnBvcHVwTGFja0RpYW1vbmRzKCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2tpcExldmVsOiBmdW5jdGlvbiAobGV2ZWxJZCkge1xuICAgICAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4uZ2V0RGlhbW9uZHMoKSA+PSBnYW1lLmNvbmZpZy5za2lwRGlhbW9uZHMpIHtcbiAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLmFkZERpYW1vbmRzKC1nYW1lLmNvbmZpZy5za2lwRGlhbW9uZHMsIFwic2tpcF9sZXZlbFwiLCBcInNraXBfbGV2ZWxcIiwgMSk7XG4gICAgICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLmNvbnN1bWVJdGVtKFwic2tpcF9sZXZlbFwiLCAxKTtcbiAgICAgICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcIkRpYW1vbmRQdXJjaGFzZVNraXBMZXZlbFwiLCB7XCJsZXZlbFwiOiBsZXZlbElkfSk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucG9wdXBMYWNrRGlhbW9uZHMoKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByZWxpdmVMZXZlbDogZnVuY3Rpb24gKGxldmVsSWQpIHtcbiAgICAgICAgaWYgKGdhbWUucGxheWVyTWFuLmdldERpYW1vbmRzKCkgPj0gZ2FtZS5jb25maWcucmVsaWZlRGlhbW9uZHMpIHtcbiAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLmFkZERpYW1vbmRzKC1nYW1lLmNvbmZpZy5yZWxpZmVEaWFtb25kcywgXCJyZXZpdmVcIiwgXCJyZXZpdmVcIiwgMSk7XG4gICAgICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLmNvbnN1bWVJdGVtKFwicmV2aXZlXCIsIDEpO1xuICAgICAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiRGlhbW9uZFB1cmNoYXNlUmVsaXZlTGV2ZWxcIiwge1wibGV2ZWxcIjogbGV2ZWxJZH0pO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnBvcHVwTGFja0RpYW1vbmRzKCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgdHJ5QWltSXRlbTogZnVuY3Rpb24gKGxldmVsSWQsIGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuY2hlY2tBbmRTaG93UmV3YXJkVmlkZW8oXCJ0cnlfYWltX2l0ZW1cIiwgZnVuY3Rpb24gKHJld2FyZGVkKSB7XG4gICAgICAgICAgICBpZiAocmV3YXJkZWQpIHtcbiAgICAgICAgICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRXZlbnQoXCJSZXdhcmRlZFZpZGVvVHJ5QWltSXRlbVwiLCB7XCJsZXZlbFwiOiBsZXZlbElkfSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9LFxuXG4gICAgb25PcGVuQm94OiBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgLy9vcGVuIHRoZSB3aGVlbC5cbiAgICAgICAgdmFyIFdoZWVsVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1doZWVsVHlwZVwiKTtcbiAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFdoZWVsRGxnKFdoZWVsVHlwZS5Cb3gsIGNhbGxiYWNrKTtcbiAgICB9LFxuXG4gICAgcG9wdXBMYWNrRGlhbW9uZHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy9nYW1lLnBvcHVwTWFuLnBvcHVwQ29tbW9uRGxnKF8oXCJkaWFtb25kX25vdF9lbm91Z2hcIikpO1xuICAgICAgICBpZiAoIWdhbWUuZ2FtZU1hbi5pc1NwZWNpYWxPZmZlclB1cmNoYXNlZCgpKSB7XG4gICAgICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwU3BlaWNpYWxPZmZlcigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIFN0b3JlVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1N0b3JlVHlwZVwiKTtcbiAgICAgICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBTdG9yZURsZyhTdG9yZVR5cGUuRElBTU9ORCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcmVxdWVzdFByb2R1Y3RzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBwcm9kdWN0SWRzID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zdG9yZUxpc3QubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciBlbnRpdHkgPSB0aGlzLnN0b3JlTGlzdFtpXTtcbiAgICAgICAgICAgIGlmIChlbnRpdHkgJiYgZW50aXR5LnBpZCkge1xuICAgICAgICAgICAgICAgIHByb2R1Y3RJZHMucHVzaChlbnRpdHkucGlkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYy5sb2coXCJyZXF1ZXN0cHJvZHVjdHM6XCIgKyBKU09OLnN0cmluZ2lmeShwcm9kdWN0SWRzKSk7XG4gICAgICAgIGdhbWUuc3RvcmVNYW5hZ2VyLnJlcXVlc3RQcm9kdWN0KHByb2R1Y3RJZHMpO1xuICAgIH0sXG5cbiAgICBnZXRVbnZlcmlmaWVkUmVjZWlwdExpc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZ2FtZS5zdG9yZU1hbmFnZXIuZ2V0VW52ZXJpZmllZFJlY2VpcHRMaXN0KCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7UGF5bWVudENvZGV9IGVycm9yXG4gICAgICogQHBhcmFtIHtQYXltZW50SW5mb30gcGF5bWVudEluZm9cbiAgICAgKi9cbiAgICBvblBheW1lbnRDb21wbGV0ZWQ6IGZ1bmN0aW9uIChlcnJvciwgcGF5bWVudEluZm8pIHtcbiAgICAgICAgdmFyIHBheW1lbnRTdWNjZXNzID0gZmFsc2U7XG4gICAgICAgIGlmIChlcnJvciA9PT0gUGF5bWVudENvZGUuUEFZTUVOVF9DT0RFX1NVQ0NFU1MpIHtcbiAgICAgICAgICAgIHRoaXMuX29uUGF5bWVudFN1Y2Nlc3MocGF5bWVudEluZm8sIHRydWUpO1xuICAgICAgICAgICAgcGF5bWVudFN1Y2Nlc3MgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cENvbW1vbkRsZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwicHVyY2hhc2VfZmFpbFwiKSk7XG4gICAgICAgIH1cbiAgICAgICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChFdmVudHNOYW1lLlBVUkNIQVNFX0VORCwgcGF5bWVudFN1Y2Nlc3MpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge0FycmF5LjxQYXltZW50SW5mbz59IHBheW1lbnRJbmZvTGlzdFxuICAgICAqL1xuICAgIG9uR2V0VW52ZXJpZmllZFJlY2VpcHRMaXN0OiBmdW5jdGlvbiAocGF5bWVudEluZm9MaXN0KSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGF5bWVudEluZm9MaXN0Lmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB0aGlzLl9vblBheW1lbnRTdWNjZXNzKHBheW1lbnRJbmZvTGlzdFtpXSwgZmFsc2UpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIG9uIGdldCBwcm9kdWN0IGxpc3QuXG4gICAgICogQHBhcmFtIHtBcnJheS48UHJvZHVjdEluZm8+fSBwcm9kdWN0TGlzdFxuICAgICAqL1xuICAgIG9uR2V0UHJvZHVjdExpc3Q6IGZ1bmN0aW9uIChwcm9kdWN0TGlzdCkge1xuICAgICAgICB0aGlzLnByb2R1Y3RMaXN0ID0gcHJvZHVjdExpc3Q7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvZHVjdExpc3QubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciBwcm9kdWN0ID0gcHJvZHVjdExpc3RbaV07XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVByaWNlKHByb2R1Y3QpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7UGF5bWVudEluZm99IHBheW1lbnRJbmZvXG4gICAgICogQHBhcmFtIGhhc05vdGljZVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX29uUGF5bWVudFN1Y2Nlc3M6IGZ1bmN0aW9uIChwYXltZW50SW5mbywgaGFzTm90aWNlKSB7XG4gICAgICAgIC8vIHZhciBzdG9yZUVudGl0eSA9IHRoaXMuZ2V0U3RvcmVFbnRpdHkoKVxuICAgICAgICAvLyB2YXIgcHJvZHVjdCA9IHRoaXMuX2dldFByb2R1Y3RCeUlkKHBheW1lbnRJbmZvLnByb2R1Y3RJZCk7XG4gICAgICAgIC8vIGlmIChwcm9kdWN0KSB7XG4gICAgICAgIC8vICAgICAvLyB2YXIgcHJpY2UgPSB0aGlzLl9nZXROdW1Gcm9tU3RyaW5nKHByb2R1Y3QucHJpY2UpICogMTAwO1xuICAgICAgICAvLyAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja1B1cmNoYXNlRXZlbnQocHJpY2UsIHByb2R1Y3QudGl0bGUsIHBheW1lbnRJbmZvLnByb2R1Y3RJZCxcbiAgICAgICAgLy8gICAgICAgICBwYXltZW50SW5mby5yZWNlaXB0KTtcbiAgICAgICAgLy8gfVxuICAgICAgICB2YXIgc3RvcmVFbnRpdHkgPSB0aGlzLmdldFN0b3JlRW50aXR5KHBheW1lbnRJbmZvLnByb2R1Y3RJZCk7XG4gICAgICAgIHZhciBzcGxpdEltYWdlID0gdGhpcy5nZXRCb29zdEltYWdlKEJvb3N0VHlwZS5TUExJVCk7XG4gICAgICAgIHZhciBuZXczSW1hZ2UgPSB0aGlzLmdldEJvb3N0SW1hZ2UoQm9vc3RUeXBlLlRIUkVFX0JBTEwpO1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIHN3aXRjaCAoc3RvcmVFbnRpdHkudHlwZSkge1xuICAgICAgICAgICAgY2FzZSBTdG9yZVR5cGUuUkVNT1ZFX0FEUzpcbiAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5yZW1vdmVkQWRzKCk7XG4gICAgICAgICAgICAgICAgaWYgKGhhc05vdGljZSkge1xuICAgICAgICAgICAgICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwQ29tbW9uRGxnKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJwdXJjaGFzZV9ub19hZF9zdWNjZXNzXCIpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGNjLnN5cy5vcyA9PT0gY2Muc3lzLk9TX0lPUykge1xuICAgICAgICAgICAgICAgICAgICBnYW1lLnN0b3JlTWFuYWdlci5jb25zdW1lKHBheW1lbnRJbmZvLnB1cmNoYXNlSWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzZWxmLmFkZElhcENvdW50KHN0b3JlRW50aXR5KTtcbiAgICAgICAgICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrQ2hhcmdlUmVxdWVzdChwYXltZW50SW5mby5wdXJjaGFzZUlkLCBwYXltZW50SW5mby5wcm9kdWN0SWQsIHN0b3JlRW50aXR5LnByaWNlVVMsIFwiVVNEXCIsIDAsIFwiSUFQXCIpO1xuICAgICAgICAgICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tDaGFyZ2VTdWNjZXNzKHBheW1lbnRJbmZvLnB1cmNoYXNlSWQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBTdG9yZVR5cGUuTkVXXzM6XG4gICAgICAgICAgICBjYXNlIFN0b3JlVHlwZS5TUExJVDpcbiAgICAgICAgICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwUmV3YXJkRGxnKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJwdXJjaGFzZV9ib29zdF9zdWNjZXNzXCIpLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLmFkZEJvb3N0KHN0b3JlRW50aXR5LnR5cGUsIHN0b3JlRW50aXR5LmNvdW50KTtcbiAgICAgICAgICAgICAgICAgICAgZ2FtZS5zdG9yZU1hbmFnZXIuY29uc3VtZShwYXltZW50SW5mby5wdXJjaGFzZUlkKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5hZGRJYXBDb3VudChzdG9yZUVudGl0eSk7XG4gICAgICAgICAgICAgICAgfSwgc3RvcmVFbnRpdHkuaW1hZ2UsIHN0b3JlRW50aXR5LmNvdW50KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgU3RvcmVUeXBlLkZJUlNUX1BVUkNIQVNFOlxuICAgICAgICAgICAgICAgIHZhciBkaWFtb25kQ291bnQgPSBzdG9yZUVudGl0eS5kYXRhLmRpYW1vbmRzO1xuICAgICAgICAgICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBSZXdhcmREbGcoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcInB1cmNoYXNlX3N1Y2Nlc3NcIiksXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLmFkZERpYW1vbmRzKGRpYW1vbmRDb3VudCwgXCJmaXJzdF9wdXJjaGFzZVwiLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBnYW1lLnN0b3JlTWFuYWdlci5jb25zdW1lKHBheW1lbnRJbmZvLnB1cmNoYXNlSWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uc2V0U3BlY2lhbE9mZmVyUHVyY2hhc2VkKHBheW1lbnRJbmZvLnByb2R1Y3RJZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRXZlbnQoXCJQdXJjaGFzZVNwZWNpYWxPZmZlclwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWRkSWFwQ291bnQoc3RvcmVFbnRpdHkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgc3BsaXRDb3VudCA9IHN0b3JlRW50aXR5LmRhdGEubXVsdGlwbGVfMztcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFyIHRocmVlQmFsbENvdW50ID0gc3RvcmVFbnRpdHkuZGF0YS5uZXdfMztcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vZ2FtZS5wb3B1cE1hbi5wb3B1cFJld2FyZERsZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwicHVyY2hhc2VfYm9vc3Rfc3VjY2Vzc1wiKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICBnYW1lLnBsYXllck1hbi5hZGRCb29zdChCb29zdFR5cGUuU1BMSVQsIHNwbGl0Q291bnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgIGdhbWUucGxheWVyTWFuLmFkZEJvb3N0KEJvb3N0VHlwZS5USFJFRV9CQUxMLCB0aHJlZUJhbGxDb3VudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICB9LCBzcGxpdEltYWdlLCBzcGxpdENvdW50LCBuZXczSW1hZ2UsIHRocmVlQmFsbENvdW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tDaGFyZ2VSZXF1ZXN0KHBheW1lbnRJbmZvLnB1cmNoYXNlSWQsIHBheW1lbnRJbmZvLnByb2R1Y3RJZCwgc3RvcmVFbnRpdHkucHJpY2VVUywgXCJVU0RcIiwgZGlhbW9uZENvdW50LCBcIklBUFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tDaGFyZ2VTdWNjZXNzKHBheW1lbnRJbmZvLnB1cmNoYXNlSWQpO1xuICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLmdldEJvb3N0SW1hZ2UoQm9vc3RUeXBlLkRJQU1PTkQpLCBkaWFtb25kQ291bnQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBTdG9yZVR5cGUuTkVXX0FORF9TUExJVDpcbiAgICAgICAgICAgICAgICB2YXIgc3BsaXRDb3VudCA9IHN0b3JlRW50aXR5LmRhdGEubXVsdGlwbGVfMztcbiAgICAgICAgICAgICAgICB2YXIgdGhyZWVCYWxsQ291bnQgPSBzdG9yZUVudGl0eS5kYXRhLm5ld18zO1xuICAgICAgICAgICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBSZXdhcmREbGcoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcInB1cmNoYXNlX2Jvb3N0X3N1Y2Nlc3NcIiksXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLmFkZEJvb3N0KEJvb3N0VHlwZS5TUExJVCwgc3BsaXRDb3VudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5hZGRCb29zdChCb29zdFR5cGUuVEhSRUVfQkFMTCwgdGhyZWVCYWxsQ291bnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5zdG9yZU1hbmFnZXIuY29uc3VtZShwYXltZW50SW5mby5wdXJjaGFzZUlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWRkSWFwQ291bnQoc3RvcmVFbnRpdHkpO1xuICAgICAgICAgICAgICAgICAgICB9LCBzcGxpdEltYWdlLCBzcGxpdENvdW50LCBuZXczSW1hZ2UsIHRocmVlQmFsbENvdW50KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgU3RvcmVUeXBlLkRJQU1PTkQ6XG4gICAgICAgICAgICAgICAgdmFyIGNvdW50ID0gc3RvcmVFbnRpdHkuY291bnQ7XG4gICAgICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFJld2FyZERsZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwicHVyY2hhc2Vfc3VjY2Vzc1wiKSxcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uYWRkRGlhbW9uZHMoY291bnQsIFwicHVyY2hhc2VcIiwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5zdG9yZU1hbmFnZXIuY29uc3VtZShwYXltZW50SW5mby5wdXJjaGFzZUlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWRkSWFwQ291bnQoc3RvcmVFbnRpdHkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0NoYXJnZVJlcXVlc3QocGF5bWVudEluZm8ucHVyY2hhc2VJZCwgcGF5bWVudEluZm8ucHJvZHVjdElkLCBzdG9yZUVudGl0eS5wcmljZVVTLCBcIlVTRFwiLCBjb3VudCwgXCJJQVBcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrQ2hhcmdlU3VjY2VzcyhwYXltZW50SW5mby5wdXJjaGFzZUlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgc3RvcmVFbnRpdHkuaW1hZ2UsIGNvdW50KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgU3RvcmVUeXBlLkFJTV9JVEVNOlxuICAgICAgICAgICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBSZXdhcmREbGcoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcInB1cmNoYXNlX3N1Y2Nlc3NcIiksXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLnB1cmNoYXNlZEFpbUl0ZW0oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuc3RvcmVNYW5hZ2VyLmNvbnN1bWUocGF5bWVudEluZm8ucHVyY2hhc2VJZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRXZlbnQoXCJQdXJjaGFzZUFpbUl0ZW1cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFkZElhcENvdW50KHN0b3JlRW50aXR5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tDaGFyZ2VSZXF1ZXN0KHBheW1lbnRJbmZvLnB1cmNoYXNlSWQsIHBheW1lbnRJbmZvLnByb2R1Y3RJZCwgc3RvcmVFbnRpdHkucHJpY2VVUywgXCJVU0RcIiwgMCwgXCJJQVBcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrQ2hhcmdlU3VjY2VzcyhwYXltZW50SW5mby5wdXJjaGFzZUlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQoRXZlbnRzTmFtZS5VUERBVEVfQUlNX0lURU0pO1xuICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLmdldEJvb3N0SW1hZ2UoQm9vc3RUeXBlLkFJTV9JVEVNKSwgMSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgYWRkSWFwQ291bnQ6IGZ1bmN0aW9uIChzdG9yZUVudGl0eSkge1xuICAgICAgICBnYW1lLnBsYXllck1hbi5hZGRJYXBDb3VudCgpO1xuICAgICAgICB2YXIgaWFwQ291bnQgPSBnYW1lLnBsYXllck1hbi5wbGF5ZXIuaWFwQ291bnQ7XG4gICAgICAgIGlmIChpYXBDb3VudCA9PT0gMSkge1xuICAgICAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiRmlyc3RQdXJjaGFzZVwiLCB7XCJwaWRcIjogc3RvcmVFbnRpdHkucGlkfSk7XG4gICAgICAgIH0gZWxzZSBpZiAoaWFwQ291bnQgPT09IDIpIHtcbiAgICAgICAgICAgIGdhbWUuYW5hbHlzZU1hbmFnZXIudHJhY2tFdmVudChcIlNlY29uZFB1cmNoYXNlXCIsIHtcInBpZFwiOiBzdG9yZUVudGl0eS5waWR9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaWFwQ291bnQgPj0gMikge1xuICAgICAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiTXVsdGlQdXJjaGFzZVwiLCB7XCJwaWRcIjogc3RvcmVFbnRpdHkucGlkfSk7XG4gICAgICAgIH1cbiAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiUHVyY2hhc2VMZXZlbFwiLCB7XCJsZXZlbElkXCI6IGdhbWUuZ2FtZU1hbi5sZXZlbElkLCBcInBpZFwiOiBzdG9yZUVudGl0eS5waWR9KTtcbiAgICB9LFxuXG4gICAgcG9wdXBCb29zdFJld2FyZERsZzogZnVuY3Rpb24gKHNwbGl0Q291bnQsIHRocmVlQmFsbENvdW50LCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgbmV3M0ltYWdlID0gdGhpcy5nZXRCb29zdEltYWdlKEJvb3N0VHlwZS5USFJFRV9CQUxMKTtcbiAgICAgICAgdmFyIHNwbGl0SW1hZ2UgPSB0aGlzLmdldEJvb3N0SW1hZ2UoQm9vc3RUeXBlLlNQTElUKTtcblxuICAgICAgICB2YXIgaW1hZ2UxID0gdW5kZWZpbmVkO1xuICAgICAgICB2YXIgY291bnQxID0gMDtcbiAgICAgICAgdmFyIGltYWdlMiA9IHVuZGVmaW5lZDtcbiAgICAgICAgdmFyIGNvdW50MiA9IDA7XG4gICAgICAgIGlmICh0aHJlZUJhbGxDb3VudCA+IDApIHtcbiAgICAgICAgICAgIGltYWdlMSA9IG5ldzNJbWFnZTtcbiAgICAgICAgICAgIGNvdW50MSA9IHRocmVlQmFsbENvdW50O1xuICAgICAgICAgICAgaWYgKHNwbGl0Q291bnQgPiAwKSB7XG4gICAgICAgICAgICAgICAgaW1hZ2UyID0gc3BsaXRJbWFnZTtcbiAgICAgICAgICAgICAgICBjb3VudDIgPSBzcGxpdENvdW50O1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaW1hZ2UxID0gc3BsaXRJbWFnZTtcbiAgICAgICAgICAgIGNvdW50MSA9IHNwbGl0Q291bnQ7XG4gICAgICAgIH1cblxuICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwUmV3YXJkTm90aWNlRGxnKGdhbWUubG9jYWwuZ2V0VmFsdWUoXCJyZXdhcmRfdmlkZW9fYm9vc3RzXCIpLFxuICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLmFkZEJvb3N0KEJvb3N0VHlwZS5TUExJVCwgc3BsaXRDb3VudCk7XG4gICAgICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uYWRkQm9vc3QoQm9vc3RUeXBlLlRIUkVFX0JBTEwsIHRocmVlQmFsbENvdW50KTtcbiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBpbWFnZTEsIGNvdW50MSwgaW1hZ2UyLCBjb3VudDIpO1xuICAgIH0sXG5cbiAgICBwb3B1cEFkZERpYW1vbmRzRGxnOiBmdW5jdGlvbiAoY291bnQsIHJld2FyZE5hbWUsIGNiKSB7XG4gICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBSZXdhcmROb3RpY2VEbGcoZ2FtZS5sb2NhbC5nZXRWYWx1ZShcInJld2FyZF92aWRlb19kaWFtb25kc1wiKSxcbiAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5hZGREaWFtb25kcyhjb3VudCwgcmV3YXJkTmFtZSk7XG4gICAgICAgICAgICAgICAgY2IgJiYgY2IoKTtcbiAgICAgICAgICAgIH0sIHRoaXMuZ2V0Qm9vc3RJbWFnZShCb29zdFR5cGUuRElBTU9ORCksIGNvdW50KTtcbiAgICB9LFxuXG4gICAgcG9wdXBSZXdhcmREb3VibGVEbGc6IGZ1bmN0aW9uIChpdGVtQ291bnQsIHR5cGUsIHJld2FyZE5hbWUsIGNiKSB7XG4gICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBSZXdhcmREb3VibGVUaXBEbGcodGhpcy5nZXRCb29zdEltYWdlKHR5cGUpLCBpdGVtQ291bnQsIHJld2FyZE5hbWUsIGZ1bmN0aW9uIChkb3VibGUpIHtcbiAgICAgICAgICAgIHZhciBjb3VudCA9IGRvdWJsZSA/IGl0ZW1Db3VudCAqIDIgOiBpdGVtQ291bnQ7XG4gICAgICAgICAgICB2YXIgc3BsaXRDb3VudCA9IDA7XG4gICAgICAgICAgICB2YXIgdGhyZWVCYWxsQ291bnQgPSAwO1xuICAgICAgICAgICAgdmFyIGRpYW1vbmRDb3VudCA9IDA7XG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gQm9vc3RUeXBlLlNQTElUKSB7XG4gICAgICAgICAgICAgICAgc3BsaXRDb3VudCA9IGNvdW50O1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSBCb29zdFR5cGUuVEhSRUVfQkFMTCkge1xuICAgICAgICAgICAgICAgIHRocmVlQmFsbENvdW50ID0gY291bnQ7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09IEJvb3N0VHlwZS5ESUFNT05EKSB7XG4gICAgICAgICAgICAgICAgZGlhbW9uZENvdW50ID0gY291bnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZG91YmxlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNwbGl0Q291bnQgPiAwIHx8IHRocmVlQmFsbENvdW50ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYucG9wdXBCb29zdFJld2FyZERsZyhzcGxpdENvdW50LCB0aHJlZUJhbGxDb3VudCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRpYW1vbmRDb3VudCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnBvcHVwQWRkRGlhbW9uZHNEbGcoZGlhbW9uZENvdW50LCByZXdhcmROYW1lLCBjYik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNiICYmIGNiKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkaWFtb25kQ291bnQgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBvcHVwQWRkRGlhbW9uZHNEbGcoZGlhbW9uZENvdW50LCByZXdhcmROYW1lLCBjYik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYiAmJiBjYigpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5hZGRCb29zdChCb29zdFR5cGUuU1BMSVQsIHNwbGl0Q291bnQpO1xuICAgICAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLmFkZEJvb3N0KEJvb3N0VHlwZS5USFJFRV9CQUxMLCB0aHJlZUJhbGxDb3VudCk7XG4gICAgICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uYWRkRGlhbW9uZHMoZGlhbW9uZENvdW50LCByZXdhcmROYW1lKTtcbiAgICAgICAgICAgICAgICBjYiAmJiBjYigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0sXG5cbiAgICBjaGVja0FuZEdldFJhbmRvbURpYW1vbmRzOiBmdW5jdGlvbiAobmFtZSwgY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIGRpYW1vbmRzQ291bnQgPSBnYW1lLmdhbWVNYW4uZ2V0RGlhbW9uZHNNdWx0aSgpO1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIHRoaXMuY2hlY2tBbmRTaG93UmV3YXJkVmlkZW8obmFtZSwgZnVuY3Rpb24gKHdhdGNoZWQpIHtcbiAgICAgICAgICAgIGlmICh3YXRjaGVkKSB7XG4gICAgICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cEx1Y2t5U3BpbihkaWFtb25kc0NvdW50LCBnYW1lLmNvbmZpZy5tdWx0aURpYW1vbmRzUmFuZ2UsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5wb3B1cEFkZERpYW1vbmRzRGxnKGRpYW1vbmRzQ291bnQsIG5hbWUsIGNhbGxiYWNrKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGNsYWltQm94UmV3YXJkOiBmdW5jdGlvbiAocmV3YXJkKSB7XG4gICAgICAgIHN3aXRjaCAocmV3YXJkLnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgQm9vc3RUeXBlLlNLSU46XG4gICAgICAgICAgICAgICAgdGhpcy5jbGFpbVNraW5SZXdhcmQocmV3YXJkLmV4dHJhLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEJvb3N0VHlwZS5CT0FSRF9TS0lOOlxuICAgICAgICAgICAgICAgIHRoaXMuY2xhaW1Cb2FyZFJld2FyZChyZXdhcmQuZXh0cmEsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgQm9vc3RUeXBlLkRJQU1PTkQ6XG4gICAgICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uYWRkRGlhbW9uZHMocmV3YXJkLmNvdW50LCBcImJveF9yZXdhcmRcIik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEJvb3N0VHlwZS5TUExJVDpcbiAgICAgICAgICAgICAgICBnYW1lLnBsYXllck1hbi5hZGRCb29zdChCb29zdFR5cGUuU1BMSVQsIHJld2FyZC5jb3VudCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEJvb3N0VHlwZS5USFJFRV9CQUxMOlxuICAgICAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLmFkZEJvb3N0KEJvb3N0VHlwZS5USFJFRV9CQUxMLCByZXdhcmQuY291bnQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxufSk7XG5cblN0b3JlSGVscGVyLl9pbnN0YW5jZSA9IG51bGw7XG5TdG9yZUhlbHBlci5fZmlyc3RVc2VJbnN0YW5jZSA9IHRydWU7XG5cbi8qKlxuICpcbiAqIEByZXR1cm5zIHtTdG9yZUhlbHBlcn1cbiAqL1xuU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKFN0b3JlSGVscGVyLl9maXJzdFVzZUluc3RhbmNlKSB7XG4gICAgICAgIFN0b3JlSGVscGVyLl9maXJzdFVzZUluc3RhbmNlID0gZmFsc2U7XG4gICAgICAgIFN0b3JlSGVscGVyLl9pbnN0YW5jZSA9IG5ldyBTdG9yZUhlbHBlcigpO1xuICAgIH1cbiAgICByZXR1cm4gU3RvcmVIZWxwZXIuX2luc3RhbmNlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBTdG9yZUhlbHBlcjsiLCJ2YXIgTWVudUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9NZW51Q29udHJvbGxlclwiKTtcbnZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcbnZhciBDaGFsbGVuZ2VMaXN0Q29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL0NoYWxsZW5nZUxpc3RDb250cm9sbGVyXCIpO1xuXG52YXIgTGV2ZWxTY2VuZSA9IGNjLlNjZW5lLmV4dGVuZCh7XG5cbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICAgIHZhciBsYXllciA9IENoYWxsZW5nZUxpc3RDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgdGhpcy5hZGRDaGlsZChsYXllcik7XG4gICAgfSxcblxuICAgIG9uRW50ZXI6ZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuXG4gICAgICAgIGNjLmV2ZW50TWFuYWdlci5hZGRMaXN0ZW5lcih7XG4gICAgICAgICAgICBldmVudDogY2MuRXZlbnRMaXN0ZW5lci5LRVlCT0FSRCxcbiAgICAgICAgICAgIG9uS2V5UmVsZWFzZWQ6IGZ1bmN0aW9uIChrZXlDb2RlLCBldmVudCkge1xuICAgICAgICAgICAgICAgIGlmIChrZXlDb2RlID09PSBjYy5LRVkuYmFjaykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2lzQmFja0NsaWNrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzQmFja0NsaWNrZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5NRU5VKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0uYmluZCh0aGlzKVxuICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICBnYW1lLmFkc01hbmFnZXIucmVtb3ZlQmFubmVyQWRzKFwiYm90dG9tXCIpO1xuICAgICAgICBnYW1lLmFkc01hbmFnZXIucmVtb3ZlQmFubmVyQWRzKFwidG9wXCIpO1xuICAgIH0sXG5cbiAgICBvbkV4aXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZ2FtZS5kaWFsb2dNYW5hZ2VyLmNsb3NlQWxsKCk7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gTGV2ZWxTY2VuZTsiLCJ2YXIgTWVudUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9NZW51Q29udHJvbGxlclwiKTtcbnZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcbnZhciBDaGFsbGVuZ2VQYXJlbnRDb250cm9sbGVyID0gcmVxdWlyZShcIi4uL2NvbnRyb2xsZXIvQ2hhbGxlbmdlUGFyZW50Q29udHJvbGxlclwiKTtcblxudmFyIExldmVsU2NlbmUgPSBjYy5TY2VuZS5leHRlbmQoe1xuXG4gICAgY3RvcjogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgICAgICB2YXIgbGF5ZXIgPSBDaGFsbGVuZ2VQYXJlbnRDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgdGhpcy5hZGRDaGlsZChsYXllcik7XG4gICAgfSxcblxuICAgIG9uRW50ZXI6ZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuXG4gICAgICAgIGNjLmV2ZW50TWFuYWdlci5hZGRMaXN0ZW5lcih7XG4gICAgICAgICAgICBldmVudDogY2MuRXZlbnRMaXN0ZW5lci5LRVlCT0FSRCxcbiAgICAgICAgICAgIG9uS2V5UmVsZWFzZWQ6IGZ1bmN0aW9uIChrZXlDb2RlLCBldmVudCkge1xuICAgICAgICAgICAgICAgIGlmIChrZXlDb2RlID09PSBjYy5LRVkuYmFjaykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2lzQmFja0NsaWNrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzQmFja0NsaWNrZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5DSEFMTEVOR0VfTElTVCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LmJpbmQodGhpcylcbiAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgZ2FtZS5hZHNNYW5hZ2VyLnJlbW92ZUJhbm5lckFkcyhcImJvdHRvbVwiKTtcbiAgICAgICAgZ2FtZS5hZHNNYW5hZ2VyLnJlbW92ZUJhbm5lckFkcyhcInRvcFwiKTtcbiAgICB9LFxuXG4gICAgb25FeGl0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdhbWUuZGlhbG9nTWFuYWdlci5jbG9zZUFsbCgpO1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IExldmVsU2NlbmU7IiwidmFyIEdhbWVDb250cm9sbGVyID0gcmVxdWlyZShcIi4uL2NvbnRyb2xsZXIvR2FtZUNvbnRyb2xsZXJcIik7XG52YXIgR2FtZU1hbiA9IHJlcXVpcmUoXCIuLi9tb2RlbC9HYW1lTWFuXCIpO1xudmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xuXG52YXIgR2FtZVNjZW5lID0gY2MuU2NlbmUuZXh0ZW5kKHtcbiAgICBfZ2FtZVR5cGU6IDAsXG4gICAgX2lzQmFja0NsaWNrZWQ6IGZhbHNlLFxuXG4gICAgY3RvcjogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgICAgICBnYW1lLmFkc01hbmFnZXIucmVtb3ZlQmFubmVyQWRzKFwiYm90dG9tXCIpO1xuICAgICAgICBnYW1lLmdhbWVNYW4ucmVzZXRUcnlBbmltSXRlbSgpO1xuICAgICAgICB2YXIgZ2FtZU5vZGUgPSBHYW1lQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG4gICAgICAgIHRoaXMuYWRkQ2hpbGQoZ2FtZU5vZGUpO1xuICAgIH0sXG5cbiAgICBvbkVudGVyOmZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICAgICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5pbml0KCk7XG4gICAgfSxcblxuICAgIG9uRXhpdDogZnVuY3Rpb24gKCkge1xuICAgICAgICBnYW1lLmRpYWxvZ01hbmFnZXIuY2xvc2VBbGwoKTtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBHYW1lU2NlbmU7XG4iLCJ2YXIgTWVudUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9NZW51Q29udHJvbGxlclwiKTtcbnZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcbnZhciBMZXZlbENvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9MZXZlbENvbnRyb2xsZXJcIik7XG5cbnZhciBMZXZlbFNjZW5lID0gY2MuU2NlbmUuZXh0ZW5kKHtcblxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICAgICAgdmFyIGxheWVyID0gTGV2ZWxDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgdGhpcy5hZGRDaGlsZChsYXllcik7XG4gICAgfSxcblxuICAgIG9uRW50ZXI6ZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuXG4gICAgICAgIGNjLmV2ZW50TWFuYWdlci5hZGRMaXN0ZW5lcih7XG4gICAgICAgICAgICBldmVudDogY2MuRXZlbnRMaXN0ZW5lci5LRVlCT0FSRCxcbiAgICAgICAgICAgIG9uS2V5UmVsZWFzZWQ6IGZ1bmN0aW9uIChrZXlDb2RlLCBldmVudCkge1xuICAgICAgICAgICAgICAgIGlmIChrZXlDb2RlID09PSBjYy5LRVkuYmFjaykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2lzQmFja0NsaWNrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzQmFja0NsaWNrZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5NRU5VKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0uYmluZCh0aGlzKVxuICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICBpZiAoZ2FtZS5nYW1lTWFuLmdldE1heExldmVsKCkgPj0gMykge1xuICAgICAgICAgICAgZ2FtZS5hZHNNYW5hZ2VyLnNob3dCYW5uZXJBZHMoXCJib3R0b21cIik7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgb25FeGl0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdhbWUuZGlhbG9nTWFuYWdlci5jbG9zZUFsbCgpO1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IExldmVsU2NlbmU7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IG95ZSBvbiAxNS00LTE5LlxuICovXG52YXIgTG9hZGluZ0NvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9Mb2FkaW5nQ29udHJvbGxlclwiKTtcblxudmFyIExvYWRpbmdTY2VuZSA9IGNjLlNjZW5lLmV4dGVuZCh7XG4gICAgY3RvcjpmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICAgIHZhciBsYXllciA9IExvYWRpbmdDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgdGhpcy5hZGRDaGlsZChsYXllcik7XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gTG9hZGluZ1NjZW5lOyIsInZhciBNZW51Q29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL01lbnVDb250cm9sbGVyXCIpO1xudmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xudmFyIEdhbWVNYW4gPSByZXF1aXJlKFwiLi4vbW9kZWwvR2FtZU1hblwiKTtcbnZhciBQbGF5ZXJNYW4gPSByZXF1aXJlKFwiLi4vbW9kZWwvUGxheWVyTWFuXCIpO1xudmFyIFNjZW5lTWFuID0gcmVxdWlyZShcIi4uL21vZGVsL1NjZW5lTWFuXCIpO1xudmFyIFNjZW5lVHlwZSA9IHJlcXVpcmUoXCIuLi9lbnVtL1NjZW5lVHlwZVwiKTtcbi8vdmFyIEJyaWNrc1ZpZXcgPSByZXF1aXJlKFwiLi4vdmlldy9Ccmlja3NWaWV3XCIpO1xuXG53aW5kb3cuaXNGaXJzdEVudGVyID0gdHJ1ZTtcblxudmFyIE1lbnVTY2VuZSA9IGNjLlNjZW5lLmV4dGVuZCh7XG5cbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG5cbiAgICAgICAgdmFyIGxheWVyID0gTWVudUNvbnRyb2xsZXIuY3JlYXRlRnJvbUNDQigpO1xuICAgICAgICB0aGlzLmFkZENoaWxkKGxheWVyKTtcbiAgICB9LFxuXG4gICAgb25FbnRlcjpmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG5cbiAgICAgICAgU3RvcmVIZWxwZXIuZ2V0SW5zdGFuY2UoKS5pbml0KCk7XG5cbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICBjYy5ldmVudE1hbmFnZXIuYWRkTGlzdGVuZXIoe1xuICAgICAgICAgICAgZXZlbnQ6IGNjLkV2ZW50TGlzdGVuZXIuS0VZQk9BUkQsXG4gICAgICAgICAgICBvbktleVJlbGVhc2VkOiBmdW5jdGlvbiAoa2V5Q29kZSwgZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAoa2V5Q29kZSA9PT0gY2MuS0VZLmJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFzZWxmLl9pc0JhY2tDbGlja2VkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9pc0JhY2tDbGlja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBZZXNOb0NvbW1vbkRsZyhfKFwiZXhpdF9nYW1lX2NvbmZpcm1cIiksIF8oXCJ5ZXNfdGl0bGVcIiksIF8oXCJub190aXRsZVwiKSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUubG9naWNNYW4uc2NoZWR1bGVMb2NhbE5vdGlmaWNhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNjLmRpcmVjdG9yLmVuZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2lzQmFja0NsaWNrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICBpZiAoZ2FtZS5nYW1lTWFuLmdldE1heExldmVsKCkgPj0gMykge1xuICAgICAgICAgICAgZ2FtZS5hZHNNYW5hZ2VyLnNob3dCYW5uZXJBZHMoXCJib3R0b21cIik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZ2FtZS5hZHNNYW5hZ2VyLnNob3dUb3BCYW5uZXIpIHtcbiAgICAgICAgICAgIGdhbWUuYWRzTWFuYWdlci5yZW1vdmVCYW5uZXJBZHMoXCJ0b3BcIik7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNjaGVkdWxlT25jZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBnYW1lLmdjTWFuYWdlci5yZXBvcnRTY29yZSgwLCBnYW1lLmNvbmZpZy5nZXRMZWFkZXJCb2FyZEtleSgpKTtcbiAgICAgICAgICAgIGlmICghd2luZG93LmlzRmlyc3RFbnRlcikge1xuICAgICAgICAgICAgICAgIGdhbWUuY3Jvc3NQcm9tTWFuLnRyeVRvUG9wdXBDcm9zc1Byb21EbGcoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgd2luZG93LmlzRmlyc3RFbnRlciA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCAxKTtcbiAgICB9LFxuXG4gICAgb25FeGl0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdhbWUuZGlhbG9nTWFuYWdlci5jbG9zZUFsbCgpO1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IE1lbnVTY2VuZTsiLCJ2YXIgTWVudUNvbnRyb2xsZXIgPSByZXF1aXJlKFwiLi4vY29udHJvbGxlci9NZW51Q29udHJvbGxlclwiKTtcbnZhciBTdG9yZUhlbHBlciA9IHJlcXVpcmUoXCIuLi9tb2RlbC9TdG9yZUhlbHBlclwiKTtcbnZhciBQYWNrYWdlQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL1BhY2thZ2VDb250cm9sbGVyXCIpO1xuXG52YXIgUGFja2FnZVNjZW5lID0gY2MuU2NlbmUuZXh0ZW5kKHtcbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICAgIHZhciBsYXllciA9IFBhY2thZ2VDb250cm9sbGVyLmNyZWF0ZUZyb21DQ0IoKTtcbiAgICAgICAgdGhpcy5hZGRDaGlsZChsYXllcik7XG4gICAgfSxcblxuICAgIG9uRW50ZXI6ZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuXG4gICAgICAgIGNjLmV2ZW50TWFuYWdlci5hZGRMaXN0ZW5lcih7XG4gICAgICAgICAgICBldmVudDogY2MuRXZlbnRMaXN0ZW5lci5LRVlCT0FSRCxcbiAgICAgICAgICAgIG9uS2V5UmVsZWFzZWQ6IGZ1bmN0aW9uIChrZXlDb2RlLCBldmVudCkge1xuICAgICAgICAgICAgICAgIGlmIChrZXlDb2RlID09PSBjYy5LRVkuYmFjaykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2lzQmFja0NsaWNrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzQmFja0NsaWNrZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5NRU5VKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0uYmluZCh0aGlzKVxuICAgICAgICB9LCB0aGlzKTtcbiAgICB9LFxuXG4gICAgb25FeGl0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdhbWUuZGlhbG9nTWFuYWdlci5jbG9zZUFsbCgpO1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFBhY2thZ2VTY2VuZTsiLCJ2YXIgR3JpZCA9IHJlcXVpcmUoXCIuLi9lbnRpdHkvR3JpZFwiKTtcbnZhciBCYWxsID0gcmVxdWlyZShcIi4uL2VudGl0eS9CYWxsXCIpO1xudmFyIEJvYXJkQ29udHJvbGxlciA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVyL0JvYXJkQ29udHJvbGxlclwiKTtcbnZhciBCYWxsUG9vbCA9IHJlcXVpcmUoXCIuLi9lbnRpdHkvQmFsbFBvb2xcIik7XG52YXIgVXRpbHMgPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uL3V0aWwvVXRpbHNcIik7XG52YXIgR3JpZFR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9HcmlkVHlwZVwiKTtcbnZhciBCb2FyZCA9IHJlcXVpcmUoXCIuLi9lbnRpdHkvQm9hcmRcIik7XG52YXIgU2hhcGVUeXBlID0gcmVxdWlyZShcIi4uL2VudW0vU2hhcGVUeXBlXCIpO1xudmFyIEJvb3N0ID0gcmVxdWlyZShcIi4uL2VudGl0eS9Cb29zdFwiKTtcbnZhciBCb29zdFR5cGUgPSByZXF1aXJlKFwiLi4vZW51bS9Cb29zdFR5cGVcIik7XG52YXIgT2JzdGFjbGUgPSByZXF1aXJlKFwiLi4vZW50aXR5L09ic3RhY2xlXCIpO1xudmFyIFdhbGwgPSByZXF1aXJlKFwiLi4vZW50aXR5L1dhbGxcIik7XG52YXIgR2FtZU1hbiA9IHJlcXVpcmUoXCIuLi9tb2RlbC9HYW1lTWFuXCIpO1xudmFyIFN0b3JlSGVscGVyID0gcmVxdWlyZShcIi4uL21vZGVsL1N0b3JlSGVscGVyXCIpO1xudmFyIEV2ZW50c05hbWUgPSByZXF1aXJlKFwiLi4vZXZlbnRzL0V2ZW50c05hbWVcIik7XG52YXIgSXRlbUNhdGVnb3J5ID0gcmVxdWlyZShcIi4uL2VudW0vSXRlbUNhdGVnb3J5XCIpO1xudmFyIEZhaWxSZWFzb24gPSByZXF1aXJlKFwiLi4vZW51bS9GYWlsUmVhc29uXCIpO1xudmFyIEtleSA9IHJlcXVpcmUoXCIuLi9lbnRpdHkvS2V5XCIpO1xudmFyIENoYWxsZW5nZUlkID0gcmVxdWlyZShcIi4uL2VudW0vQ2hhbGxlbmdlSWRcIik7XG5cbnZhciBDb2xvckNvbmZpZ3MgPSBbXG4gICAgY2MuY29sb3IoMjUyLCAxNzgsIDApLFxuICAgIGNjLmNvbG9yKDc0LCAyMzMsIDApLFxuICAgIGNjLmNvbG9yKDI3LCAyMjYsIDI1NSksXG4gICAgY2MuY29sb3IoMjU1LCAyNTIsIDI5KSxcbiAgICBjYy5jb2xvcigyNTUsIDU2LCA1NiksXG4gICAgY2MuY29sb3IoMjQ4LCA3MCwgMjU1KSxcbiAgICBjYy5jb2xvcigyNTUsIDEyOSwgMTcpLFxuICAgIGNjLmNvbG9yKDU3LCAxMDMsIDI0OSksXG4gICAgY2MuY29sb3IoOTAsIDE4MSwgMTEwKSxcblxuICAgIGNjLmNvbG9yKDI1NSwgOTAsIDE0MSksXG4gICAgY2MuY29sb3IoMjQyLCA4NiwgOSksXG4gICAgY2MuY29sb3IoODksIDU5LCAyNTUpLFxuICAgIGNjLmNvbG9yKDE1NywgODMsIDI1NSksXG4gICAgY2MuY29sb3IoNDUsIDIzMiwgMTUwKSxcbiAgICBjYy5jb2xvcigxNzYsIDcyLCAyMDYpLFxuICAgIGNjLmNvbG9yKDE2OCwgMjQ2LCAzMiksXG4gICAgY2MuY29sb3IoNDYsIDc2LCAyNTUpLFxuICAgIGNjLmNvbG9yKDIzOSwgMjIxLCAyMDEpLFxuICAgIGNjLmNvbG9yKDI1MywgMjA5LCAxMzMpLFxuICAgIGNjLmNvbG9yKDI0OSwgNzQsIDE1NSksXG4gICAgY2MuY29sb3IoMjksIDYwLCA5NClcbl07XG5cbnZhciBHcmF5Q29sb3IgPSBjYy5jb2xvcig4MiwgODIsIDgyKTtcblxudmFyIGdldENvbG9yID0gZnVuY3Rpb24gKHR5cGUpIHtcbiAgICByZXR1cm4gQ29sb3JDb25maWdzWyh0eXBlIC0gMSkgJSBDb2xvckNvbmZpZ3MubGVuZ3RoXTtcbn07XG5cbnZhciBHYW1lU3RlcCA9IHtcbiAgICBQUkVfU1RBUlQ6IDEsXG4gICAgQUlNX0dVSURFOiAyLFxuICAgIFNMSURFX0dVSURFOiAzLFxuICAgIFNUQVJUOiA0LFxuICAgIFJFTElGRTogNSxcbiAgICBCT01COiA2LFxuICAgIExBU0VSOiA3LFxuICAgIEZBSUxfQU5EX1dBSVRfUkVMSUZFOiA4LFxuICAgIEVORDogOVxufTtcblxudmFyIEdyaWRUeXBlID0ge1xuICAgIE5vbmU6IDAsXG4gICAgQnJpY2s6IDEsXG4gICAgV2FsbDogMlxufTtcblxudmFyIEJyaWNrc1ZpZXcgPSBjYy5Ob2RlLmV4dGVuZCh7XG4gICAgU1BBQ0VfU1RFUDogMSAvIDYwLFxuICAgIC8vIExJRkVfUE9TSUJJTElUWTogMC4wMDUsXG4gICAgU1VQRVJfQk9BUkRfUE9TSUJJTElUWTogMC4wMixcbiAgICBCT01CX1BPU0lCSUxJVFk6IDAuMTUsXG4gICAgQk9PU1RfUE9TSUJJTElUWTogMC4xMixcbiAgICBNQVhfU1BFRUQ6IDIzOCxcbiAgICBNQVhfTElGRTogMyxcbiAgICBCT09TVF9TUEVFRDogODAsXG4gICAgQk9NQl9TUEVFRDogMTAwLFxuICAgIE1BWF9CQUxMOiA4MDAsXG4gICAgVE9QX0lOTkVSX1dBTEw6IDYwLFxuICAgIE1BWF9TUExJVF9DT1VOVDogMTAwLFxuICAgIFRPUF9BRF9XQUxMOiAxMDAsXG4gICAgSElOVF9CQUxMOiAyMDAsXG4gICAgSElOVF9HUkFZX0JBTEw6IDE1MCxcbiAgICBTUExJVF9CQUxMX0FOR0xFOiBbNDUsIDkwLCAxMzVdLFxuICAgIE1VU1RfR0VOX0JPT1NUX1RJTUU6IDM1LFxuXG4gICAgLyoqXG4gICAgICogQHR5cGUge0xldmVsQ29uZmlnfVxuICAgICAqL1xuICAgIGNvbmZpZzogbnVsbCxcblxuICAgIHJvdzogMCxcbiAgICBjb2w6IDAsXG5cbiAgICBiYWxsTGlzdDogbnVsbCxcblxuICAgIGdhbWVTdGVwOiAtMSxcblxuICAgIGxpZmVDb3VudDogMixcblxuICAgIGdhbWVDb250cm9sbGVyOiBudWxsLFxuXG4gICAgLy9zdGFydFRpbWU6IDAsXG5cbiAgICBzdG9wZWQ6IGZhbHNlLFxuXG4gICAgbGFzdFRpbWU6IDAsXG5cbiAgICB0b3RhbFRpbWU6IDAsXG4gICAgbGFzdEFkanVzdFRpbWU6IDAsXG5cbiAgICBoYXJkTW9kZTogZmFsc2UsXG5cbiAgICBhY2N1bXVsYXRvcjogMCxcbiAgICBib29zdFR5cGVNYXA6IG51bGwsXG4gICAgbGFzdEdldEJvb3N0VGltZTogMCxcbiAgICBfY3VyVG91Y2hJZDogLTEsXG5cbiAgICBsYXN0UmVtb3ZlVGltZTogMCxcblxuICAgIGN1cnJlbnRGUFM6IDYwLFxuXG4gICAgaXNMb3dJT1M6IGZhbHNlLFxuXG4gICAgc2hvd2VkRmx5R2lmdDogZmFsc2UsXG5cbiAgICBzdXBlckJvYXJkTm9kZTogbnVsbCxcblxuICAgIGtleVNwcml0ZTogbnVsbCxcblxuICAgIGN0b3I6IGZ1bmN0aW9uIChjb25maWcsIGdhbWVDb250cm9sbGVyKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICAgIGlmIChnYW1lLnV0aWxzLmlzTG93QW5kcm9pZCgpKSB7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRGUFMgPSBnYW1lLmNvbmZpZy5sb3dBbmRyb2lkRlBTO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaXNMb3dJT1MgPSBnYW1lLnV0aWxzLmlzTG93SU9TKCk7XG4gICAgICAgIGlmIChnYW1lLmdhbWVNYW4ubGV2ZWxJZCA+PSAzMCkge1xuICAgICAgICAgICAgdGhpcy5NQVhfTElGRSA9IE1hdGgubWF4KDAsIGdhbWUuZ2FtZU1hbi5nZXRMaWZlQ291bnQoKSAtIDEpO1xuICAgICAgICAgICAgdGhpcy5saWZlQ291bnQgPSB0aGlzLk1BWF9MSUZFO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5saWZlQ291bnQgPSBnYW1lLmdhbWVNYW4uZ2V0TGlmZUNvdW50KCk7XG4gICAgICAgICAgICB0aGlzLk1BWF9MSUZFID0gdGhpcy5saWZlQ291bnQ7XG4gICAgICAgIH1cbiAgICAgICAgY2MubG9nKFwibWF4IGxpZmUgY291bnQ6XCIgKyB0aGlzLk1BWF9MSUZFKTtcbiAgICAgICAgaWYgKGdhbWUuZ2FtZU1hbi5pc0NoYWxsZW5nZUxldmVsKSB7XG4gICAgICAgICAgICB0aGlzLk1BWF9MSUZFID0gMDtcbiAgICAgICAgICAgIHRoaXMubGlmZUNvdW50ID0gMDtcbiAgICAgICAgICAgIGdhbWUucGxheWVyTWFuLnNldENoYWxsZW5nZVBsYXlpbmcodHJ1ZSwgZ2FtZS5jaGFsbGVuZ2VNYW4uY3VycmVudENoYWxsZW5nZUlkKTtcbiAgICAgICAgICAgIHRoaXMuQk9NQl9QT1NJQklMSVRZID0gdGhpcy5CT01CX1BPU0lCSUxJVFkgKiBjb25maWcuYm9tYlByb2JhYmlsaXR5O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5oYXJkTW9kZSA9IEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5pc0hhcmRNb2RlKCk7XG4gICAgICAgICAgICBpZiAodGhpcy5oYXJkTW9kZSkge1xuICAgICAgICAgICAgICAgIGNvbmZpZyA9IGNvbmZpZy5nZXRIYXJkQ2ZnKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5XSU5fV0lEVEggPSBjYy53aW5TaXplLndpZHRoO1xuICAgICAgICB0aGlzLldJTl9IRUlHSFQgPSBjYy53aW5TaXplLmhlaWdodDtcbiAgICAgICAgdGhpcy5sYXN0R2V0Qm9vc3RUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgdGhpcy5ib29zdFR5cGVNYXAgPSB7fTtcbiAgICAgICAgdGhpcy5ib29zdFR5cGVMaXN0ID0gW0Jvb3N0VHlwZS5TUExJVCwgQm9vc3RUeXBlLlRIUkVFX0JBTExdO1xuICAgICAgICBpZiAoY2Muc3lzLm9zID09PSBjYy5zeXMuT1NfSU9TICYmICF0aGlzLmlzTG93SU9TKSB7XG4gICAgICAgICAgICB0aGlzLk1BWF9CQUxMID0gMTAwMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZ2FtZS5nYW1lTWFuLmlzTGVzc0dyaWRDaGFsbGVuZ2UoKSkge1xuICAgICAgICAgICAgdGhpcy5NQVhfU1BFRUQgKj0gMS4zO1xuICAgICAgICB9XG4gICAgICAgIEJhbGxQb29sLnNldE1heFBvb2xTaXplKFwiYmFsbFwiLCB0aGlzLk1BWF9CQUxMKTtcbiAgICAgICAgQmFsbFBvb2wuc2V0TWF4UG9vbFNpemUoXCJicmlja1wiLCAyMDAwKTtcbiAgICAgICAgaWYgKGdhbWUudXRpbHMuaXNJT1NOb3RjaFNjcmVlbigpKSB7XG4gICAgICAgICAgICB0aGlzLlRPUF9BRF9XQUxMICs9IDcwO1xuICAgICAgICB9IGVsc2UgaWYgKGdhbWUudXRpbHMuaXNQYWQoKSkge1xuICAgICAgICAgICAgdGhpcy5UT1BfQURfV0FMTCAtPSA0MDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZ2FtZS5nYW1lTWFuLmlzQ2hhbGxlbmdlTGV2ZWwgJiYgZ2FtZS5jaGFsbGVuZ2VNYW4uY3VycmVudENoYWxsZW5nZUlkID09PSBDaGFsbGVuZ2VJZC5MYXNlcikge1xuICAgICAgICAgICAgdGhpcy5UT1BfQURfV0FMTCArPSA0MjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuQk9PU1RfUE9TSUJJTElUWSA9IGdhbWUuZ2FtZU1hbi5nZXRJbml0Qm9vc3RQcm9iYWJpbGl0eSgpO1xuICAgICAgICBjYy5sb2coXCJ0aGlzLkJPT1NUX1BPU0lCSUxJVFkgMTpcIiArIHRoaXMuQk9PU1RfUE9TSUJJTElUWSlcbiAgICAgICAgLy8gdGhpcy5CT09TVF9QT1NJQklMSVRZICo9IEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5nZXRCb29zdFByb2JhYmlsaXR5KGNvbmZpZyk7XG4gICAgICAgIHRoaXMuQk9PU1RfUE9TSUJJTElUWSA9IDAuMDg7XG4gICAgICAgIGNjLmxvZyhcInRoaXMuQk9PU1RfUE9TSUJJTElUWSAyOlwiICsgdGhpcy5CT09TVF9QT1NJQklMSVRZKTtcbiAgICAgICAgdGhpcy5nYW1lQ29udHJvbGxlciA9IGdhbWVDb250cm9sbGVyO1xuICAgICAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcbiAgICAgICAgdGhpcy5yb3cgPSBjb25maWcud2lkdGg7XG4gICAgICAgIHRoaXMuY29sID0gY29uZmlnLmhlaWdodDtcblxuICAgICAgICB0aGlzLkdSSURfV0lEVEggPSBjb25maWcucGl4ZWxXaWR0aCAvIGNvbmZpZy53aWR0aCAqIDAuNztcbiAgICAgICAgdGhpcy5HUklEX0hFSUdIVCA9IGNvbmZpZy5waXhlbEhlaWdodCAvIGNvbmZpZy5oZWlnaHQgKiAwLjc7XG5cbiAgICAgICAgdGhpcy5HQVBfV0lEVEggPSBjb25maWcucGl4ZWxXaWR0aCAvIGNvbmZpZy53aWR0aCAtIHRoaXMuR1JJRF9XSURUSDtcbiAgICAgICAgdGhpcy5HQVBfSEVJR0hUID0gY29uZmlnLnBpeGVsSGVpZ2h0IC8gY29uZmlnLmhlaWdodCAtIHRoaXMuR1JJRF9IRUlHSFQ7XG5cbiAgICAgICAgdGhpcy5HUklEX0FORF9HQVBfV0lEVEggPSB0aGlzLkdSSURfV0lEVEggKyB0aGlzLkdBUF9XSURUSDtcbiAgICAgICAgdGhpcy5HUklEX0FORF9HQVBfSEVJR0hUID0gdGhpcy5HUklEX0hFSUdIVCArIHRoaXMuR0FQX0hFSUdIVDtcblxuICAgICAgICAvL+mhtumDqOacgOWwj+eahOiDveWuuee6s+aVtOS4queQg+ebmOeahOepuumXtFxuICAgICAgICB2YXIgbWluQnJpY2tIZWlnaHQgPSA2MDAgKyB0aGlzLlRPUF9JTk5FUl9XQUxMICsgdGhpcy5UT1BfQURfV0FMTCArIDEwO1xuICAgICAgICB2YXIgbWF4QnJpY2tIZWlnaHQgPSB0aGlzLldJTl9IRUlHSFQgLSBtaW5Ccmlja0hlaWdodDtcblxuICAgICAgICBpZiAoZ2FtZS51dGlscy5pc0lPU05vdGNoU2NyZWVuKCkpIHtcbiAgICAgICAgICAgIHRoaXMuQlJJQ0tfWSA9IE1hdGgubWluKHRoaXMuV0lOX0hFSUdIVCAqIDAuMzUsIG1heEJyaWNrSGVpZ2h0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChnYW1lLnV0aWxzLmlzQW5kcm9pZE5vdGNoU2NyZWVuKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLkJSSUNLX1kgPSBNYXRoLm1pbih0aGlzLldJTl9IRUlHSFQgKiAwLjM2LCBtYXhCcmlja0hlaWdodCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuQlJJQ0tfWSA9IE1hdGgubWluKHRoaXMuV0lOX0hFSUdIVCAqIDAuMywgbWF4QnJpY2tIZWlnaHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5CT0FSRF9ZID0gdGhpcy5CUklDS19ZIC0gdGhpcy5XSU5fSEVJR0hUICogMC4xNjtcblxuICAgICAgICB0aGlzLnNldENvbnRlbnRTaXplKGNjLndpblNpemUpO1xuXG4gICAgICAgIHRoaXMuc3VwZXJCb2FyZE5vZGUgPSBuZXcgY2MuTm9kZSgpO1xuICAgICAgICB0aGlzLmFkZENoaWxkKHRoaXMuc3VwZXJCb2FyZE5vZGUpO1xuICAgICAgICB0aGlzLmluaXQoKTtcbiAgICB9LFxuXG4gICAgb25FbnRlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgICAgICBjYy5ldmVudE1hbmFnZXIuYWRkTGlzdGVuZXIoe1xuICAgICAgICAgICAgZXZlbnQ6IGNjLkV2ZW50TGlzdGVuZXIuVE9VQ0hfT05FX0JZX09ORSxcbiAgICAgICAgICAgIHN3YWxsb3dUb3VjaGVzOiB0cnVlLFxuICAgICAgICAgICAgb25Ub3VjaEJlZ2FuOiB0aGlzLm9uVG91Y2hCZWdhbi5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgb25Ub3VjaE1vdmVkOiB0aGlzLm9uVG91Y2hNb3ZlZC5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgb25Ub3VjaEVuZGVkOiB0aGlzLm9uVG91Y2hFbmRlZC5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgb25Ub3VjaENhbmNlbGxlZDogdGhpcy5vblRvdWNoQ2FuY2VsbGVkLmJpbmQodGhpcylcbiAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgdGhpcy5zY2hlZHVsZVVwZGF0ZSgpO1xuXG4gICAgICAgIHRoaXMuc3BhY2Uuc2V0RGVmYXVsdENvbGxpc2lvbkhhbmRsZXIoXG4gICAgICAgICAgICB0aGlzLmNvbGxpc2lvbkJlZ2luLmJpbmQodGhpcyksXG4gICAgICAgICAgICB0aGlzLmNvbGxpc2lvblByZS5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgdGhpcy5jb2xsaXNpb25Qb3N0LmJpbmQodGhpcyksXG4gICAgICAgICAgICB0aGlzLmNvbGxpc2lvblNlcGFyYXRlLmJpbmQodGhpcylcbiAgICAgICAgKTtcbiAgICAgICAgZ2FtZS5ldmVudERpc3BhdGNoZXIuYWRkQ3VzdG9tRXZlbnRMaXN0ZW5lcihjYy5nYW1lLkVWRU5UX0hJREUsIHRoaXMuZ2FtZU9uSGlkZSwgdGhpcyk7XG4gICAgICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLmFkZEV2ZW50TGlzdGVuZXIoRXZlbnRzTmFtZS5VUERBVEVfU0tJTiwgdGhpcy5vblVwZGF0ZVNraW4sIHRoaXMpO1xuICAgICAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5hZGRFdmVudExpc3RlbmVyKEV2ZW50c05hbWUuU0hPV19BSU1fR1VJREUsIHRoaXMub25TaG93QWltR3VpZGUsIHRoaXMpO1xuXG4gICAgICAgIHRoaXMuc2hvd1RvcEJhbm5lckFkcygpO1xuXG4gICAgICAgIGNjLmV2ZW50TWFuYWdlci5hZGRMaXN0ZW5lcih7XG4gICAgICAgICAgICBldmVudDogY2MuRXZlbnRMaXN0ZW5lci5LRVlCT0FSRCxcbiAgICAgICAgICAgIG9uS2V5UmVsZWFzZWQ6IGZ1bmN0aW9uIChrZXlDb2RlLCBldmVudCkge1xuICAgICAgICAgICAgICAgIGlmIChrZXlDb2RlID09PSBjYy5LRVkuYmFjaykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRyeVNob3dQYXVzZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0uYmluZCh0aGlzKVxuICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICBnYW1lLmdhbWVNYW4ub25HYW1lU3RhcnQoKTtcbiAgICB9LFxuXG4gICAgb25FeGl0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoRXZlbnRzTmFtZS5TSE9XX0FJTV9HVUlERSwgdGhpcy5vblNob3dBaW1HdWlkZSwgdGhpcyk7XG4gICAgICAgIGdhbWUuZXZlbnREaXNwYXRjaGVyLnJlbW92ZUN1c3RvbUV2ZW50TGlzdGVuZXIoY2MuZ2FtZS5FVkVOVF9ISURFLCB0aGlzLmdhbWVPbkhpZGUsIHRoaXMpO1xuICAgICAgICBnYW1lLmV2ZW50RGlzcGF0Y2hlci5yZW1vdmVFdmVudExpc3RlbmVyKEV2ZW50c05hbWUuVVBEQVRFX1NLSU4sIHRoaXMub25VcGRhdGVTa2luLCB0aGlzKTtcbiAgICAgICAgLy90aGlzLnNwYWNlLnJlbW92ZUNvbGxpc2lvbkhhbmRsZXIoU2hhcGVUeXBlLkJBTEwsXG4gICAgICAgIC8vICAgIFNoYXBlVHlwZS5CUklDSyk7XG4gICAgICAgIHRoaXMudW5zY2hlZHVsZVVwZGF0ZSgpO1xuICAgICAgICB0aGlzLnJlbW92ZVRvcEJhbm5lckFkcygpO1xuICAgICAgICAvL0JhbGxQb29sLmRyYWluQWxsUG9vbHMoKTtcbiAgICAgICAgdGhpcy5zcGFjZSA9IG51bGw7XG4gICAgICAgIHRoaXMuYmFsbExpc3QgPSBudWxsO1xuICAgICAgICB0aGlzLmJvb3N0cyA9IG51bGw7XG4gICAgICAgIHRoaXMub2JzdGFjbGVzID0gbnVsbDtcbiAgICAgICAgdGhpcy53YWxscyA9IG51bGw7XG4gICAgICAgIHRoaXMuYnJpY2tzID0gbnVsbDtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICB9LFxuXG4gICAgb25VcGRhdGVTa2luOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5iYWxsTGlzdC5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdGhpcy5iYWxsTGlzdFtpXS51cGRhdGVTa2luKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZ2FtZU9uSGlkZTogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5nYW1lU3RlcCA9PT0gR2FtZVN0ZXAuU1RBUlQpIHtcbiAgICAgICAgICAgIHRoaXMudHJ5U2hvd1BhdXNlKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgdHJ5U2hvd1BhdXNlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5zdG9wZWQpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmdhbWVDb250cm9sbGVyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5nYW1lQ29udHJvbGxlci5zaG93UGF1c2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBpbml0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaW5pdFdvcmxkKCk7XG4gICAgICAgIHRoaXMuaW5pdE9ic3RhY2xlcygpO1xuICAgICAgICB0aGlzLmluaXRCcmlja3MoKTtcbiAgICAgICAgdGhpcy5pbml0Qm9hcmQoKTtcbiAgICAgICAgdGhpcy5pbml0SGludExpbmVzKCk7XG4gICAgICAgIHRoaXMudXBkYXRlQ291bnREb3duQ2hhbGxlbmdlKCk7XG4gICAgICAgIHRoaXMuaW5pdEtleSgpO1xuXG4gICAgICAgIHRoaXMuYmFsbExpc3QgPSBbXTtcbiAgICAgICAgdGhpcy5ib29zdHMgPSBbXTtcblxuICAgICAgICB0aGlzLmxhc3RBZGp1c3RUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgdGhpcy5sYXN0UmVtb3ZlVGltZSA9IERhdGUubm93KCk7XG4gICAgICAgIHRoaXMuZ2FtZVN0ZXAgPSBHYW1lU3RlcC5QUkVfU1RBUlQ7XG4gICAgfSxcbiAgICBcbiAgICBjcmVhdGVEb3ROb2RlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBkb3QgPSBuZXcgY2MuU3ByaXRlKFwiI3NraW5fMC5wbmdcIik7XG4gICAgICAgIGRvdC5zY2FsZSA9IDAuMjtcbiAgICAgICAgZG90Lm9wYWNpdHkgPSAxNTA7XG4gICAgICAgIGRvdC5zZXRDb2xvcihjYy5jb2xvci5HUkFZKTtcbiAgICAgICAgcmV0dXJuIGRvdDtcbiAgICB9LFxuXG4gICAgaW5pdEhpbnRMaW5lczogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmRyYXdOb2RlID0gbmV3IGNjLk5vZGUoKTtcbiAgICAgICAgdGhpcy5hZGRDaGlsZCh0aGlzLmRyYXdOb2RlLCB0aGlzLkhJTlRfR1JBWV9CQUxMKTtcblxuICAgICAgICB2YXIgc2tpbkNmZyA9IEdhbWVNYW4uZ2V0SW5zdGFuY2UoKS5nZXRDdXJyZW50U2tpbkNmZygpO1xuICAgICAgICB0aGlzLmhpbnRTcHJpdGUgPSBuZXcgY2MuU3ByaXRlKFwiI1wiICsgc2tpbkNmZy5pbWFnZSArIFwiLnBuZ1wiKTtcbiAgICAgICAgdGhpcy5hZGRDaGlsZCh0aGlzLmhpbnRTcHJpdGUsIHRoaXMuSElOVF9CQUxMKTtcbiAgICAgICAgdGhpcy5oaW50U3ByaXRlLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5oaW50U3ByaXRlLnNjYWxlID0gdGhpcy5nZXRCYWxsV2lkdGgoKSAvIHRoaXMuaGludFNwcml0ZS53aWR0aCAqIHNraW5DZmcuc2NhbGU7XG5cdCAgICB0aGlzLmRvdHMgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA0MDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgZG90ID0gdGhpcy5jcmVhdGVEb3ROb2RlKCk7XG4gICAgICAgICAgICB0aGlzLmRvdHMucHVzaChkb3QpO1xuICAgICAgICAgICAgZG90LnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuZHJhd05vZGUuYWRkQ2hpbGQoZG90KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBpbml0T2JzdGFjbGVzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMub2JzdGFjbGVzID0gW107XG4gICAgICAgIHRoaXMud2FsbHMgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmNvbmZpZy5vYnN0YWNsZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHRoaXMuaW5pdE9ic3RhY2xlKHRoaXMuY29uZmlnLm9ic3RhY2xlc1tpXSwgdGhpcywgdGhpcy5vYnN0YWNsZXMsIHRoaXMud2FsbHMpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGluaXRPYnN0YWNsZTogZnVuY3Rpb24gKG9ic3RhY2xlQ2ZnLCBjb250YWluZXIsIG9ic3RhY2xlcywgd2FsbHMpIHtcbiAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBvYnN0YWNsZUNmZy53aWR0aDsgKyt4KSB7XG4gICAgICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IG9ic3RhY2xlQ2ZnLmhlaWdodDsgKyt5KSB7XG4gICAgICAgICAgICAgICAgdmFyIGxvY2FsQ29sID0geCArIG9ic3RhY2xlQ2ZnLng7XG4gICAgICAgICAgICAgICAgdmFyIGxvY2FsUm93ID0geSArIG9ic3RhY2xlQ2ZnLnk7XG4gICAgICAgICAgICAgICAgdmFyIG9ic3RhY2xlID0gQmFsbFBvb2wuZ2V0RnJvbVBvb2woXCJvYnN0YWNsZVwiKTtcbiAgICAgICAgICAgICAgICBpZiAoIW9ic3RhY2xlKSB7XG4gICAgICAgICAgICAgICAgICAgIG9ic3RhY2xlID0gbmV3IE9ic3RhY2xlKEdyYXlDb2xvciwgdGhpcy5HUklEX1dJRFRILCB0aGlzLkdSSURfSEVJR0hUKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBvYnN0YWNsZS5yZXNldChHcmF5Q29sb3IsIHRoaXMuR1JJRF9XSURUSCwgdGhpcy5HUklEX0hFSUdIVCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5hZGRDaGlsZChvYnN0YWNsZSk7XG4gICAgICAgICAgICAgICAgLy8gY2MubG9nKFwibG9jYWxSb3c6XCIgKyBsb2NhbFJvdyk7XG4gICAgICAgICAgICAgICAgdmFyIHBvcyA9IHRoaXMuZ2V0R3JpZFBvcyhsb2NhbFJvdywgbG9jYWxDb2wpO1xuICAgICAgICAgICAgICAgIC8vIGNjLmxvZyhcInBvczpcIiArIEpTT04uc3RyaW5naWZ5KHBvcykpO1xuICAgICAgICAgICAgICAgIG9ic3RhY2xlLnNldFBvc2l0aW9uKHBvcyk7XG4gICAgICAgICAgICAgICAgb2JzdGFjbGVzLnB1c2gob2JzdGFjbGUpO1xuICAgICAgICAgICAgICAgIC8vIHRoaXMuZ3JpZHNbbG9jYWxDb2xdW2xvY2FsUm93XSA9IEdyaWRUeXBlLldhbGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdmFyIFdBTExfRklMTF9TSVpFID0gY2Muc2l6ZSg2LCA2KTtcbiAgICAgICAgdmFyIHdhbGwgPSBuZXcgV2FsbCgpO1xuICAgICAgICB3YWxsLnNldENvbnRlbnRTaXplKGNjLnNpemUoXG4gICAgICAgICAgICB0aGlzLkdSSURfV0lEVEggKiBvYnN0YWNsZUNmZy53aWR0aCArIHRoaXMuR0FQX1dJRFRIICogKG9ic3RhY2xlQ2ZnLndpZHRoIC0gMSkgKyBXQUxMX0ZJTExfU0laRS53aWR0aCxcbiAgICAgICAgICAgIHRoaXMuR1JJRF9IRUlHSFQgKiBvYnN0YWNsZUNmZy5oZWlnaHQgKyB0aGlzLkdBUF9IRUlHSFQgKiAob2JzdGFjbGVDZmcuaGVpZ2h0IC0gMSkgKyBXQUxMX0ZJTExfU0laRS5oZWlnaHQpKTtcbiAgICAgICAgd2FsbHMucHVzaCh3YWxsKTtcbiAgICAgICAgY29udGFpbmVyLmFkZENoaWxkKHdhbGwpO1xuICAgICAgICB2YXIgcG9zID0gY2MucEFkZCh0aGlzLmdldEdyaWRQb3Mob2JzdGFjbGVDZmcueSwgb2JzdGFjbGVDZmcueCksXG4gICAgICAgICAgICBjYy5wKC0wLjUgKiB0aGlzLkdSSURfV0lEVEgsIC0wLjUgKiB0aGlzLkdSSURfSEVJR0hUKSk7XG4gICAgICAgIHBvcyA9IGNjLnBBZGQocG9zLCBjYy5wKC1XQUxMX0ZJTExfU0laRS53aWR0aCAqIDAuNSwgLVdBTExfRklMTF9TSVpFLmhlaWdodCAqIDAuNSkpO1xuICAgICAgICB3YWxsLmluaXRCb2R5KHRoaXMuc3BhY2UsIHBvcyk7XG4gICAgfSxcblxuICAgIGluaXRCcmlja3M6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5icmlja3MgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmNvbmZpZy5icmlja3MubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHZhciBicmlja0NmZyA9IHRoaXMuY29uZmlnLmJyaWNrc1tpXTtcbiAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgYnJpY2tDZmcud2lkdGg7ICsreCkge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgYnJpY2tDZmcuaGVpZ2h0OyArK3kpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJyaWNrID0gdGhpcy5jcmVhdGVCcmljayh4LCB5LCBicmlja0NmZyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYnJpY2tzLnB1c2goYnJpY2spO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBjcmVhdGVCcmljazogZnVuY3Rpb24gKHgsIHksIGJyaWNrQ2ZnKSB7XG4gICAgICAgIHZhciBsb2NhbENvbCA9IHggKyBicmlja0NmZy54O1xuICAgICAgICB2YXIgbG9jYWxSb3cgPSB5ICsgYnJpY2tDZmcueTtcbiAgICAgICAgdmFyIGJyaWNrID0gQmFsbFBvb2wuZ2V0RnJvbVBvb2woXCJicmlja1wiKTtcbiAgICAgICAgaWYgKCFicmljaykge1xuICAgICAgICAgICAgYnJpY2sgPSBuZXcgR3JpZChnZXRDb2xvcihicmlja0NmZy50eXBlKSwgdGhpcy5HUklEX1dJRFRILCB0aGlzLkdSSURfSEVJR0hULCBHcmlkVHlwZS5CUklDSyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBicmljay5yZXNldChnZXRDb2xvcihicmlja0NmZy50eXBlKSwgdGhpcy5HUklEX1dJRFRILCB0aGlzLkdSSURfSEVJR0hULCBHcmlkVHlwZS5CUklDSyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gdGhpcy5ncmlkc1tsb2NhbENvbF1bbG9jYWxSb3ddID0gR3JpZFR5cGUuQnJpY2s7XG4gICAgICAgIHRoaXMuYWRkQ2hpbGQoYnJpY2spO1xuICAgICAgICBicmljay5pbml0Qm9keSh0aGlzLnNwYWNlLCB0aGlzLmdldEdyaWRQb3MobG9jYWxSb3csIGxvY2FsQ29sKSwgdGhpcy5HUklEX0FORF9HQVBfV0lEVEggLSAyLCB0aGlzLkdSSURfQU5EX0dBUF9IRUlHSFQgLSAyKTtcbiAgICAgICAgcmV0dXJuIGJyaWNrO1xuICAgIH0sXG5cbiAgICBpbml0Qm9hcmQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5ib2FyZE5vZGUgPSBuZXcgQm9hcmQodGhpcy5nZXRCYWxsV2lkdGgoKSk7XG4gICAgICAgIHRoaXMuYWRkQ2hpbGQodGhpcy5ib2FyZE5vZGUpO1xuICAgICAgICB0aGlzLmJvYXJkTm9kZS5pbml0Qm9keSh0aGlzLnNwYWNlLCBjYy5wKHRoaXMuV0lOX1dJRFRIICogMC41LCB0aGlzLkJPQVJEX1kpKTtcbiAgICB9LFxuXG4gICAgZ2V0QmFsbFdpZHRoOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBNYXRoLm1heCh0aGlzLkdSSURfV0lEVEgsIDgpO1xuICAgIH0sXG5cbiAgICBpbml0V29ybGQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5XQUxMX1RISUNLID0gNTA7XG4gICAgICAgIHRoaXMuSU5ORVJfV0FMTCA9IDIwO1xuICAgICAgICAvL3RoaXMuVE9QX0lOTkVSX1dBTEwgPSA1MDtcbiAgICAgICAgdGhpcy5zcGFjZSA9IG5ldyBjcC5TcGFjZSgpO1xuICAgICAgICB2YXIgeE9mZnNldCA9IDA7XG4gICAgICAgIGlmICh3aW5kb3cuaXNFZGl0b3IpIHtcbiAgICAgICAgICAgIHhPZmZzZXQgPSBjYy53aW5TaXplLndpZHRoIC0gNjQwO1xuICAgICAgICB9XG4gICAgICAgIHZhciB3YWxscyA9IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBcInNoYXBlXCI6IGNjLnNpemUodGhpcy5XSU5fV0lEVEggKyB0aGlzLldBTExfVEhJQ0ssIHRoaXMuV0FMTF9USElDSyksIC8vdG9wXG4gICAgICAgICAgICAgICAgXCJwb3NcIjogY3Audih0aGlzLldJTl9XSURUSCAqIDAuNSAtIHRoaXMuV0FMTF9USElDSyAqIDAuNSwgdGhpcy5XSU5fSEVJR0hUICsgdGhpcy5XQUxMX1RISUNLICogMC41IC0gdGhpcy5UT1BfSU5ORVJfV0FMTCAtIHRoaXMuVE9QX0FEX1dBTEwpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIFwic2hhcGVcIjogY2Muc2l6ZSh0aGlzLldBTExfVEhJQ0ssIHRoaXMuV0lOX0hFSUdIVCArIHRoaXMuV0FMTF9USElDSyksIC8vbGVmdFxuICAgICAgICAgICAgICAgIFwicG9zXCI6IGNwLnYoeE9mZnNldCAqIDAuNSAtIHRoaXMuV0FMTF9USElDSyAqIDAuNSArIHRoaXMuSU5ORVJfV0FMTCwgdGhpcy5XSU5fSEVJR0hUICogMC41IC0gdGhpcy5XQUxMX1RISUNLICogMC41KVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBcInNoYXBlXCI6IGNjLnNpemUodGhpcy5XQUxMX1RISUNLLCB0aGlzLldJTl9IRUlHSFQgKyB0aGlzLldBTExfVEhJQ0spLCAvL3JpZ2h0XG4gICAgICAgICAgICAgICAgXCJwb3NcIjogY3AudigteE9mZnNldCAqIDAuNSArIHRoaXMuV0lOX1dJRFRIICsgdGhpcy5XQUxMX1RISUNLICogMC41IC0gdGhpcy5JTk5FUl9XQUxMLCB0aGlzLldJTl9IRUlHSFQgKiAwLjUgLSB0aGlzLldBTExfVEhJQ0sgKiAwLjUpXG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3YWxscy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGJvZHkgPSBuZXcgY3AuQm9keShJbmZpbml0eSwgSW5maW5pdHkpO1xuICAgICAgICAgICAgdmFyIHdhbGwgPSB3YWxsc1tpXTtcbiAgICAgICAgICAgIHZhciBzaGFwZSA9IG5ldyBjcC5Cb3hTaGFwZShib2R5LCB3YWxsLnNoYXBlLndpZHRoLCB3YWxsLnNoYXBlLmhlaWdodCk7XG4gICAgICAgICAgICBzaGFwZS5zZXRFbGFzdGljaXR5KDEpO1xuICAgICAgICAgICAgc2hhcGUuc2V0RnJpY3Rpb24oMCk7XG4gICAgICAgICAgICAvL3NoYXBlLmxheWVycyA9IDE7XG4gICAgICAgICAgICBib2R5LnNldFBvcyh3YWxsLnBvcyk7XG4gICAgICAgICAgICB0aGlzLnNwYWNlLmFkZFN0YXRpY1NoYXBlKHNoYXBlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vZm9yICh2YXIgaSA9IDA7IGkgPCB3YWxscy5sZW5ndGg7IGkrKykge1xuICAgICAgICAvLyAgICB2YXIgYm9keSA9IG5ldyBjcC5Cb2R5KEluZmluaXR5LCBJbmZpbml0eSk7XG4gICAgICAgIC8vICAgIHZhciB3YWxsID0gd2FsbHNbaV07XG4gICAgICAgIC8vICAgIHZhciBzaGFwZSA9IG5ldyBjcC5Cb3hTaGFwZShib2R5LCB3YWxsLnNoYXBlLndpZHRoLCB3YWxsLnNoYXBlLmhlaWdodCk7XG4gICAgICAgIC8vICAgIHNoYXBlLnNldEVsYXN0aWNpdHkoMSk7XG4gICAgICAgIC8vICAgIHNoYXBlLnNldEZyaWN0aW9uKDApO1xuICAgICAgICAvLyAgICBzaGFwZS5sYXllcnMgPSBISU5UX1dBTExfR1JPVVA7XG4gICAgICAgIC8vICAgIGJvZHkuc2V0UG9zKHdhbGwucG9zKTtcbiAgICAgICAgLy8gICAgdGhpcy5zcGFjZS5hZGRTdGF0aWNTaGFwZShzaGFwZSk7XG4gICAgICAgIC8vfVxuXG4gICAgICAgIC8vIEdyYXZpdHlcbiAgICAgICAgdGhpcy5zcGFjZS5ncmF2aXR5ID0gY3AudigwLCAwKTtcbiAgICAgICAgdGhpcy5zcGFjZS5zbGVlcFRpbWVUaHJlc2hvbGQgPSAwLjU7XG4gICAgICAgIHRoaXMuc3BhY2UuY29sbGlzaW9uU2xvcCA9IDAuNTtcbiAgICAgICAgdGhpcy5zcGFjZS5pdGVyYXRpb25zID0gNTtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAgdGhpcy5zcGFjZS51c2VTcGF0aWFsSGFzaCh0aGlzLmdldEJhbGxXaWR0aCgpLCB0aGlzLk1BWF9CQUxMICogMTApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy90aGlzLmluaXREZWJ1Z01vZGUoKTtcbiAgICB9LFxuXG4gICAgaW5pdERlYnVnTW9kZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9kZWJ1Z05vZGUgPSBjYy5QaHlzaWNzRGVidWdOb2RlLmNyZWF0ZSh0aGlzLnNwYWNlKTtcbiAgICAgICAgdGhpcy5hZGRDaGlsZCh0aGlzLl9kZWJ1Z05vZGUpO1xuICAgIH0sXG5cbiAgICBpbml0S2V5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKGdhbWUuZ2FtZU1hbi5sZXZlbElkIDwgMykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChnYW1lLmdhbWVNYW4uaXNDaGFsbGVuZ2VMZXZlbCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5wbGF5ZXIuY3VycmVudEtleUNvdW50ID49IDMpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgcmFuZG9tTnVtID0gZ2FtZS51dGlscy5yYW5kb21OZXh0SW50KDEwMCk7XG4gICAgICAgIGlmIChyYW5kb21OdW0gPCA2NSkge1xuICAgICAgICAgICAgdmFyIHBvcyA9IHRoaXMuZ2V0S2V5UG9zKCk7XG4gICAgICAgICAgICBpZiAoIXBvcykge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBrZXlTcHJpdGUgPSBuZXcgS2V5KCk7XG4gICAgICAgICAgICBrZXlTcHJpdGUuc2V0UG9zaXRpb24ocG9zKTtcbiAgICAgICAgICAgIHRoaXMuYWRkQ2hpbGQoa2V5U3ByaXRlKTtcbiAgICAgICAgICAgIHRoaXMua2V5U3ByaXRlID0ga2V5U3ByaXRlO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGZseUtleTogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5rZXlTcHJpdGUpIHtcbiAgICAgICAgICAgIHRoaXMua2V5U3ByaXRlLnN0b3BBbGxBY3Rpb25zKCk7XG4gICAgICAgICAgICB0aGlzLmtleVNwcml0ZS5vcGFjaXR5ID0gMjU1O1xuICAgICAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uYWRkQ3VycmVudEtleUNvdW50KCk7XG4gICAgICAgICAgICB2YXIgd29ybGRQb3NpdGlvbiA9IHRoaXMuZ2FtZUNvbnRyb2xsZXIubmRLZXlOb2RlLmNvbnZlcnRUb1dvcmxkU3BhY2UoY2MucCgwLCAwKSk7XG4gICAgICAgICAgICB2YXIgY3VycmVudFBvc2l0aW9uID0gdGhpcy5rZXlTcHJpdGUuZ2V0UG9zaXRpb24oKTtcbiAgICAgICAgICAgIHZhciBkaXN0YW5jZSA9IGNjLnBMZW5ndGgoY2MucFN1YihjdXJyZW50UG9zaXRpb24sIHdvcmxkUG9zaXRpb24pKTtcbiAgICAgICAgICAgIHRoaXMua2V5U3ByaXRlLnJ1bkFjdGlvbihjYy5zZXF1ZW5jZShjYy5tb3ZlVG8oZGlzdGFuY2UgKiAwLjAwMTQsIHdvcmxkUG9zaXRpb24pLCBjYy5jYWxsRnVuYyh0aGlzLnVwZGF0ZUtleUNvdW50LCB0aGlzKSwgY2MucmVtb3ZlU2VsZigpKSk7XG4gICAgICAgICAgICB0aGlzLmtleVNwcml0ZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcmVtb3ZlS2V5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLmtleVNwcml0ZSkge1xuICAgICAgICAgICAgLy8gdGhpcy5rZXlTcHJpdGUucmVtb3ZlQm9keSgpO1xuICAgICAgICAgICAgdGhpcy5rZXlTcHJpdGUucmVtb3ZlRnJvbVBhcmVudCgpO1xuICAgICAgICAgICAgdGhpcy5rZXlTcHJpdGUgPSBudWxsO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHVwZGF0ZUtleUNvdW50OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuZ2FtZUNvbnRyb2xsZXIudXBkYXRlS2V5Q291bnQoKTtcbiAgICB9LFxuXG4gICAgZ2V0S2V5UG9zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMua2V5UG9zaXRpb25zID0gW107XG4gICAgICAgIHRoaXMuZ2V0R2VuZXJhdGVLZXlQb3MoKTtcbiAgICAgICAgaWYgKHRoaXMua2V5UG9zaXRpb25zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHBvcyA9IHRoaXMua2V5UG9zaXRpb25zW2dhbWUudXRpbHMucmFuZG9tTmV4dEludCh0aGlzLmtleVBvc2l0aW9ucy5sZW5ndGgpXTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0R3JpZFBvcyhwb3MueSArIDEuNSwgcG9zLnggKyAwLjUpO1xuICAgIH0sXG5cbiAgICBnZXRHZW5lcmF0ZUtleVBvczogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZ3JpZHMgPSBbXTtcbiAgICAgICAgdmFyIGksIGosIGJyaWNrQ2ZnLCB4LCB5O1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5jb25maWcud2lkdGg7ICsraSkge1xuICAgICAgICAgICAgZ3JpZHNbaV0gPSBbXTtcbiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCB0aGlzLmNvbmZpZy5oZWlnaHQ7ICsraikge1xuICAgICAgICAgICAgICAgIGdyaWRzW2ldW2pdID0ge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiBHcmlkVHlwZS5Ob25lLFxuICAgICAgICAgICAgICAgICAgICBmaW5kOiBmYWxzZVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuY29uZmlnLmJyaWNrcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgYnJpY2tDZmcgPSB0aGlzLmNvbmZpZy5icmlja3NbaV07XG4gICAgICAgICAgICBmb3IgKHggPSAwOyB4IDwgYnJpY2tDZmcud2lkdGg7ICsreCkge1xuICAgICAgICAgICAgICAgIGZvciAoeSA9IDA7IHkgPCBicmlja0NmZy5oZWlnaHQ7ICsreSkge1xuICAgICAgICAgICAgICAgICAgICBncmlkc1ticmlja0NmZy54ICsgeF1bYnJpY2tDZmcueSArIHldID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogR3JpZFR5cGUuR3JpZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbmQ6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLmNvbmZpZy5vYnN0YWNsZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGJyaWNrQ2ZnID0gdGhpcy5jb25maWcub2JzdGFjbGVzW2ldO1xuICAgICAgICAgICAgZm9yICh4ID0gMDsgeCA8IGJyaWNrQ2ZnLndpZHRoOyArK3gpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHkgPSAwOyB5IDwgYnJpY2tDZmcuaGVpZ2h0OyArK3kpIHtcbiAgICAgICAgICAgICAgICAgICAgZ3JpZHNbYnJpY2tDZmcueCArIHhdW2JyaWNrQ2ZnLnkgKyB5XSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IEdyaWRUeXBlLldhbGwsXG4gICAgICAgICAgICAgICAgICAgICAgICBmaW5kOiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBmaW5kRmlyc3RHcmlkUG9zcyA9IHRoaXMuZmluZEZpcnN0R3JpZHModGhpcy5jb25maWcsIGdyaWRzKTtcbiAgICAgICAgaWYgKGZpbmRGaXJzdEdyaWRQb3NzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZ3JpZHMgPSBncmlkcztcbiAgICAgICAgd2hpbGUgKGZpbmRGaXJzdEdyaWRQb3NzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHZhciBpbmRleCA9IGdhbWUudXRpbHMucmFuZG9tTmV4dEludChmaW5kRmlyc3RHcmlkUG9zcy5sZW5ndGgpO1xuICAgICAgICAgICAgdmFyIGZpcnN0R3JpZFBvcyA9IGZpbmRGaXJzdEdyaWRQb3NzW2luZGV4XTtcbiAgICAgICAgICAgIGZpbmRGaXJzdEdyaWRQb3NzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICB0aGlzLnNlYXJjaEdyaWQoZmlyc3RHcmlkUG9zLngsIGZpcnN0R3JpZFBvcy55LCAwKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMua2V5UG9zaXRpb25zLmxlbmd0aCA+IDUwKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZmluZEZpcnN0R3JpZHM6IGZ1bmN0aW9uIChsZXZlbENmZywgZ3JpZHMpIHtcbiAgICAgICAgdmFyIGk7XG4gICAgICAgIHZhciByZXN1bHRzID0gW107XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZXZlbENmZy53aWR0aDsgKytpKSB7XG4gICAgICAgICAgICBpZiAoZ3JpZHNbaV1bMF0udHlwZSAhPT0gR3JpZFR5cGUuV2FsbCkge1xuICAgICAgICAgICAgICAgIHJlc3VsdHMucHVzaChjYy5wKGksIDApKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9LFxuXG4gICAgc2VhcmNoR3JpZDogZnVuY3Rpb24gKHgsIHksIGRlcHRoKSB7XG4gICAgICAgIGlmICh4ID49IDAgJiYgeCA8IHRoaXMuY29uZmlnLndpZHRoICYmIHkgPj0gMCAmJiB5IDwgdGhpcy5jb25maWcuaGVpZ2h0KSB7XG4gICAgICAgICAgICB2YXIgZ3JpZCA9IHRoaXMuZ3JpZHNbeF1beV07XG4gICAgICAgICAgICBpZiAoZ3JpZC50eXBlID09PSBHcmlkVHlwZS5XYWxsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyaWQuZmluZCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGdyaWQuZmluZCA9IHRydWU7XG4gICAgICAgICAgICB2YXIgZmluZCA9IHRydWU7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0geDsgaSA8IHggKyAyOyArK2kpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0geTsgaiA8IHkgKyA0OyArK2opIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmdyaWRzW2ldIHx8ICF0aGlzLmdyaWRzW2ldW2pdIHx8IHRoaXMuZ3JpZHNbaV1bal0udHlwZSAhPT0gR3JpZFR5cGUuTm9uZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmluZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFmaW5kKSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChmaW5kKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5rZXlQb3NpdGlvbnMucHVzaChjYy5wKHgsIHkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRlcHRoKys7XG4gICAgICAgICAgICBpZiAoZGVwdGggPiA1MDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnNlYXJjaEdyaWQoeCAtIDEsIHksIGRlcHRoKTtcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoR3JpZCh4ICsgMSwgeSwgZGVwdGgpO1xuICAgICAgICAgICAgdGhpcy5zZWFyY2hHcmlkKHgsIHkgKyAxLCBkZXB0aCk7XG4gICAgICAgICAgICB0aGlzLnNlYXJjaEdyaWQoeCwgeSAtIDEsIGRlcHRoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRHcmlkUG9zOiBmdW5jdGlvbiAobG9jYWxSb3csIGxvY2FsQ29sKSB7XG4gICAgICAgIHZhciBncmlkU2l6ZSA9IHRoaXMuZ2V0R3JpZFNpemUoKTtcbiAgICAgICAgcmV0dXJuIGNjLnAoKHRoaXMuV0lOX1dJRFRIIC0gdGhpcy5jb25maWcucGl4ZWxXaWR0aCkgKiAwLjUgKyAoZ3JpZFNpemUud2lkdGggKyB0aGlzLkdBUF9XSURUSCkgKiAobG9jYWxDb2wgKyAwLjUpLFxuICAgICAgICAgICAgKGdyaWRTaXplLmhlaWdodCArIHRoaXMuR0FQX0hFSUdIVCkgKiAobG9jYWxSb3cgKyAwLjUpICsgdGhpcy5CUklDS19ZKTtcbiAgICB9LFxuXG4gICAgZ2V0R3JpZFNpemU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCF0aGlzLmxhc3RHcmlkU2l6ZSkge1xuICAgICAgICAgICAgdGhpcy5sYXN0R3JpZFNpemUgPSBjYy5zaXplKHRoaXMuR1JJRF9XSURUSCwgdGhpcy5HUklEX0hFSUdIVCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMubGFzdEdyaWRTaXplO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uIChkdCkge1xuICAgICAgICBpZiAodGhpcy5zdG9wZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBzd2l0Y2ggKHRoaXMuZ2FtZVN0ZXApIHtcbiAgICAgICAgICAgIGNhc2UgR2FtZVN0ZXAuUFJFX1NUQVJUOlxuXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEdhbWVTdGVwLlNUQVJUOlxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlVGltZShkdCk7XG4gICAgICAgICAgICAgICAgLy92YXIgdDIgPSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgICAgIC8vY2MubG9nKFwidXBkYXRlIHN0YXJ0IHQyOlwiICsgKHQyIC0gdDEpKTtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUdyaWRzKGR0KTtcbiAgICAgICAgICAgICAgICAvL3ZhciB0MyA9IERhdGUubm93KCk7XG4gICAgICAgICAgICAgICAgLy9jYy5sb2coXCJ1cGRhdGUgc3RhcnQgdDM6XCIgKyAodDMgLSB0MikpO1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQ2hpcG11bmsoZHQpO1xuICAgICAgICAgICAgICAgIC8vdmFyIHQ0ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgICAgICAvL2NjLmxvZyhcInVwZGF0ZSBzdGFydCB0NDpcIiArICh0NCAtIHQzKSk7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVCb29zdChkdCk7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVLZXkoZHQpO1xuICAgICAgICAgICAgICAgIC8vdmFyIHQ1ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgICAgICAvL2NjLmxvZyhcInVwZGF0ZSBzdGFydCB0NTpcIiArICh0NSAtIHQ0KSk7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGVja0dhbWVPdmVyKCk7XG4gICAgICAgICAgICAgICAgLy92YXIgdDYgPSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgICAgIC8vY2MubG9nKFwidXBkYXRlIHN0YXJ0IHQ2OlwiICsgKHQ2IC0gdDUpKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrQW5kU2hvd0ZseUdpZnQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUxhc2VyKGR0KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgR2FtZVN0ZXAuUkVMSUZFOlxuICAgICAgICAgICAgICAgICBpZiAodGhpcy5nYW1lQ29udHJvbGxlcikge1xuICAgICAgICAgICAgICAgICAgICAgdGhpcy5nYW1lQ29udHJvbGxlci51cGRhdGVMaWZlQ291bnQoKTtcbiAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlQWxsQm9vc3RzKCk7XG4gICAgICAgICAgICAgICAgIGlmICh0aGlzLmJhbGxMaXN0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2FtZVN0ZXAgPSBHYW1lU3RlcC5TVEFSVDtcbiAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgIHRoaXMuYm9hcmROb2RlLnNob3dCYWxsKCk7XG4gICAgICAgICAgICAgICAgICAgICB0aGlzLmdhbWVTdGVwID0gR2FtZVN0ZXAuUFJFX1NUQVJUO1xuICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEdhbWVTdGVwLkVORDpcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNoaXBtdW5rKGR0KTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBHYW1lU3RlcC5BSU1fR1VJREU6XG4gICAgICAgICAgICAgICAgdmFyIHdvcmxkUG9zaXRpb24gPSB0aGlzLmdhbWVDb250cm9sbGVyLm5kQWltSGVscC5jb250cm9sbGVyLmdldEhhbmRXb3JsZFBvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmxhc3RBaW1IZWxwUG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYXN0QWltSGVscFBvc2l0aW9uID0gd29ybGRQb3NpdGlvbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIG9mZnNldCA9ICh3b3JsZFBvc2l0aW9uLnggLSB0aGlzLmxhc3RBaW1IZWxwUG9zaXRpb24ueCk7XG4gICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKG9mZnNldCkgPiAxMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFySGludE5vZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kcmF3QWltTGluZSh3b3JsZFBvc2l0aW9uKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgbGFzZXJGaXJlZDogdHJ1ZSxcblxuICAgIHVwZGF0ZUxhc2VyOiBmdW5jdGlvbiAoZHQpIHtcbiAgICAgICAgaWYgKCFnYW1lLmdhbWVNYW4uaXNDaGFsbGVuZ2VMZXZlbCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChnYW1lLmNoYWxsZW5nZU1hbi5jdXJyZW50Q2hhbGxlbmdlSWQgIT09IENoYWxsZW5nZUlkLkxhc2VyKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXRoaXMubGFzdFNob3dMYXNlclRpbWUpIHtcbiAgICAgICAgICAgIHRoaXMubGFzdFNob3dMYXNlclRpbWUgPSAwO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmVjbGlwc2VkVGltZSAtIHRoaXMubGFzdFNob3dMYXNlclRpbWUgPiAzMDAwICsgdGhpcy5jb25maWcubGF6ZXJJbnRlcnZhbCAqIDEwMDApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmdhbWVDb250cm9sbGVyKSB7XG4gICAgICAgICAgICAgICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJsYXNlcl9wcmVwYXJlXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuZ2FtZUNvbnRyb2xsZXIuc2hvd0xhc2VyKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5sYXNlckZpcmVkID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmxhc3RTaG93TGFzZXJUaW1lID0gdGhpcy5lY2xpcHNlZFRpbWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMubGFzZXJGaXJlZCAmJiB0aGlzLmVjbGlwc2VkVGltZSAtIHRoaXMubGFzdFNob3dMYXNlclRpbWUgPiAyMDAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYXNlckZpcmVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImxhc2VyX2ZpcmVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5nYW1lQ29udHJvbGxlcikge1xuICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZUNvbnRyb2xsZXIuaXNDb2xsaXNpb25XaXRoTGFzZXIodGhpcy5ib2FyZE5vZGUpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5TGFzZXJCb21iQW5pbSh0aGlzLmJvYXJkTm9kZS5nZXRQb3NpdGlvbigpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICB1cGRhdGVUaW1lOiBmdW5jdGlvbiAoZHQpIHtcbiAgICAgICAgaWYgKCF0aGlzLmVjbGlwc2VkVGltZSkge1xuICAgICAgICAgICAgdGhpcy5lY2xpcHNlZFRpbWUgPSAwO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZWNsaXBzZWRUaW1lICs9IGR0ICogMTAwMDtcbiAgICAgICAgaWYgKHRoaXMuZ2FtZUNvbnRyb2xsZXIpIHtcbiAgICAgICAgICAgIHRoaXMuZ2FtZUNvbnRyb2xsZXIudXBkYXRlVGltZSgpO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVDb3VudERvd25DaGFsbGVuZ2UoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICB1cGRhdGVDb3VudERvd25DaGFsbGVuZ2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGdhbWUuZ2FtZU1hbi5pc0NvdW50RG93bkNoYWxsZW5nZSgpKSB7XG4gICAgICAgICAgICB2YXIgbGVmdFRpbWUgPSB0aGlzLmdldENvdW50RG93bkxlZnRUaW1lKCk7XG4gICAgICAgICAgICBpZiAobGVmdFRpbWUgPCAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5nYW1lQ29udHJvbGxlci51cGRhdGVDb3VudERvd25UaW1lKDApO1xuICAgICAgICAgICAgICAgIHRoaXMucG9wdXBDaGFsbGVuZ2VSZXZpdmUoRmFpbFJlYXNvbi5UaW1lb3V0KTtcbiAgICAgICAgICAgICAgICBnYW1lLmF1ZGlvUGxheWVyLnN0b3BFZmZlY3QoXCJjb3VudF9kb3duXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5sYXN0TGVmdFRpbWUgPj0gMTAgJiYgbGVmdFRpbWUgPCAxMCkge1xuICAgICAgICAgICAgICAgICAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImNvdW50X2Rvd25cIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuZ2FtZUNvbnRyb2xsZXIudXBkYXRlQ291bnREb3duVGltZShsZWZ0VGltZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmxhc3RMZWZ0VGltZSA9IGxlZnRUaW1lO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGFkZGVkQ291bnREb3duVGltZTogMCxcblxuICAgIGdldENvdW50RG93bkxlZnRUaW1lOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5lY2xpcHNlZFRpbWUpIHtcbiAgICAgICAgICAgIHRoaXMuZWNsaXBzZWRUaW1lID0gMDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gTWF0aC5mbG9vcih0aGlzLmFkZGVkQ291bnREb3duVGltZSAqIDEwMDAgKyB0aGlzLmNvbmZpZy5zdGFyVGltZSAqIDEwMDAgLSB0aGlzLmVjbGlwc2VkVGltZSkgLyAxMDAwO1xuICAgIH0sXG5cbiAgICB1cGRhdGVCYWxsczogZnVuY3Rpb24gKGR0KSB7XG4gICAgICAgIHZhciByZW1vdmVDb3VudCA9IDA7XG4gICAgICAgIHZhciBjYW5SZW1vdmUgPSAoRGF0ZS5ub3coKSAtIHRoaXMubGFzdFJlbW92ZVRpbWUpID4gMjAwO1xuICAgICAgICBpZiAoIWNhblJlbW92ZSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuYmFsbExpc3QubGVuZ3RoIDw9IDIpIHtcbiAgICAgICAgICAgICAgICBjYW5SZW1vdmUgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHZhciBpLCBiYWxsO1xuICAgICAgICBpZiAoY2FuUmVtb3ZlKSB7XG4gICAgICAgICAgICB0aGlzLmxhc3RSZW1vdmVUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgIC8vY2MubG9nKFwidXBkYXRlIGJhbGxzIDpcIiArIGNhblJlbW92ZSArIFwiLCBiYWxsIGNvdW50OlwiICsgdGhpcy5iYWxsTGlzdC5sZW5ndGgpO1xuICAgICAgICAgICAgZm9yIChpID0gdGhpcy5iYWxsTGlzdC5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICAgICAgICAgIGJhbGwgPSB0aGlzLmJhbGxMaXN0W2ldO1xuICAgICAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IGJhbGwuZ2V0UG9zaXRpb24oKTtcbiAgICAgICAgICAgICAgICBpZiAocG9zaXRpb24ueSA8IHRoaXMuQk9BUkRfWSAtIDQwIHx8ICF0aGlzLmlzSW5WaWV3KHBvc2l0aW9uKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUJhbGwoYmFsbCk7XG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZUNvdW50Kys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChEYXRlLm5vdygpIC0gdGhpcy5sYXN0QWRqdXN0VGltZSA+IDEwMDApIHtcbiAgICAgICAgICAgIHRoaXMubGFzdEFkanVzdFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgZm9yIChpID0gdGhpcy5iYWxsTGlzdC5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICAgICAgICAgIGJhbGwgPSB0aGlzLmJhbGxMaXN0W2ldO1xuICAgICAgICAgICAgICAgIHRoaXMuYWRqdXN0QmFsbFNwZWVkKGJhbGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGFkanVzdEJhbGxTcGVlZDogZnVuY3Rpb24gKGJhbGwpIHtcbiAgICAgICAgdmFyIHZlbCA9IGJhbGwuZ2V0VmVsKCk7XG4gICAgICAgIHZhciBkaXN0YW5jZSA9IGNjLnBMZW5ndGgodmVsKTtcbiAgICAgICAgaWYgKGRpc3RhbmNlIDwgdGhpcy5NQVhfU1BFRUQgKiAwLjkgfHwgZGlzdGFuY2UgPiB0aGlzLk1BWF9TUEVFRCAqIDEuMSkge1xuICAgICAgICAgICAgdmFyIHJhZGlhbjtcbiAgICAgICAgICAgIGlmICh2ZWwueCA+IDApIHtcbiAgICAgICAgICAgICAgICByYWRpYW4gPSBNYXRoLmF0YW4odmVsLnkgLyB2ZWwueCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJhZGlhbiA9IE1hdGguYXRhbih2ZWwueSAvIHZlbC54KSArIE1hdGguUEk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBiYWxsLnNldFZlbChjYy5wKHRoaXMuTUFYX1NQRUVEICogTWF0aC5jb3MocmFkaWFuKSwgdGhpcy5NQVhfU1BFRUQgKiBNYXRoLnNpbihyYWRpYW4pKSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcmFuZG9tQmFsbFNwZWVkOiBmdW5jdGlvbiAoYmFsbCkge1xuICAgICAgICB0aGlzLmFkanVzdEJhbGxTcGVlZChiYWxsKTtcbiAgICAgICAgaWYgKCFiYWxsLl9sYXN0UmFuZG9tVGltZSkge1xuICAgICAgICAgICAgYmFsbC5fbGFzdFJhbmRvbVRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICB9XG4gICAgICAgIC8vbW9yZSB0aGFuIDUgc2Vjb25kcyx0aGVuIHRyeSB0byBhZGp1c3QgYmFsbCBzcGVlZC5cbiAgICAgICAgaWYgKERhdGUubm93KCkgLSBiYWxsLl9sYXN0UmFuZG9tVGltZSA+PSA1MDAwKSB7XG4gICAgICAgICAgICAvL2NjLmxvZyhcImJyaWNrIHZpZXc6YWRqdXN0IGJhbGwgc3BlZWQ6XCIgKyAoRGF0ZS5ub3coKSAtIGJhbGwuX2xhc3RSYW5kb21UaW1lKSk7XG4gICAgICAgICAgICBiYWxsLl9sYXN0UmFuZG9tVGltZSA9IERhdGUubm93KCk7XG4gICAgICAgICAgICB0aGlzLnJhbmRvbUFkanVzdEJhbGxTcGVlZChiYWxsKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICB1cGRhdGVHcmlkczogZnVuY3Rpb24gKGR0KSB7XG4gICAgICAgIGZvciAodmFyIGkgPSB0aGlzLmJyaWNrcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICAgICAgdmFyIGJyaWNrID0gdGhpcy5icmlja3NbaV07XG4gICAgICAgICAgICBpZiAoYnJpY2sucmVtb3ZlYWJsZSkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlQnJpY2soYnJpY2spO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIHVwZGF0ZUNoaXBtdW5rOiBmdW5jdGlvbiAoZHQpIHtcbiAgICAgICAgLy92YXIgdDEgPSBEYXRlLm5vdygpO1xuICAgICAgICB2YXIgZGVsdGEgPSB0aGlzLmN1cnJlbnRGUFM7XG4gICAgICAgIGlmIChjYy5zeXMub3MgPT09IGNjLnN5cy5PU19BTkRST0lEIHx8IHRoaXMuaXNMb3dJT1MpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmJhbGxMaXN0Lmxlbmd0aCA+IDIwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zcGFjZS5zdGVwKDEgLyBkZWx0YSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMjsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3BhY2Uuc3RlcCgxIC8gZGVsdGEgLyAyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy5iYWxsTGlzdC5sZW5ndGggPiA1MCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3BhY2Uuc3RlcCgxIC8gZGVsdGEpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmJhbGxMaXN0Lmxlbmd0aCA+IDIwKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAyOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zcGFjZS5zdGVwKDEgLyBkZWx0YSAvIDIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAzOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zcGFjZS5zdGVwKDEgLyBkZWx0YSAvIDMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvL3ZhciB0MiA9IERhdGUubm93KCk7XG4gICAgICAgIC8vY2MubG9nKFwidXBkYXRlIHQyOlwiICsgKHQyIC0gdDEpKTtcbiAgICAgICAgdGhpcy51cGRhdGVCYWxscyhkdCk7XG4gICAgICAgIC8vdmFyIHQzID0gRGF0ZS5ub3coKTtcbiAgICAgICAgLy9jYy5sb2coXCJ1cGRhdGUgdDM6XCIgKyAodDMgLSB0MikpO1xuICAgIH0sXG5cbiAgICByYW5kb21BZGp1c3RCYWxsU3BlZWQ6IGZ1bmN0aW9uIChiYWxsKSB7XG4gICAgICAgIHZhciBSQU5ET01fTUFYX0NPVU5UID0gNjA7XG4gICAgICAgIHZhciByYW5kb20xID0gZ2FtZS51dGlscy5yYW5nZU5leHROdW1iZXIoLVJBTkRPTV9NQVhfQ09VTlQgKiAwLjUsIFJBTkRPTV9NQVhfQ09VTlQgKiAwLjUpO1xuICAgICAgICB2YXIgcmFuZG9tMiA9IGdhbWUudXRpbHMucmFuZ2VOZXh0TnVtYmVyKC1SQU5ET01fTUFYX0NPVU5UICogMC41LCBSQU5ET01fTUFYX0NPVU5UICogMC41KTtcbiAgICAgICAgYmFsbC5zZXRWZWwoY2MucEFkZChiYWxsLmdldFZlbCgpLCBjYy5wKHJhbmRvbTEsIHJhbmRvbTIpKSk7XG4gICAgfSxcblxuICAgIHVwZGF0ZUJvb3N0OiBmdW5jdGlvbiAoZHQpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IHRoaXMuYm9vc3RzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7XG4gICAgICAgICAgICB2YXIgYm9vc3QgPSB0aGlzLmJvb3N0c1tpXTtcbiAgICAgICAgICAgIGlmIChib29zdC50eXBlID09PSBCb29zdFR5cGUuQk9NQikge1xuICAgICAgICAgICAgICAgIGJvb3N0LnkgLT0gZHQgKiB0aGlzLkJPTUJfU1BFRUQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGJvb3N0LnkgLT0gZHQgKiB0aGlzLkJPT1NUX1NQRUVEO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNjLnJlY3RJbnRlcnNlY3RzUmVjdChib29zdC5nZXRCb3VuZGluZ0JveCgpLCB0aGlzLmJvYXJkTm9kZS5nZXRCb3VuZGluZ0JveCgpKSkge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoYm9vc3QudHlwZSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIEJvb3N0VHlwZS5MSUZFOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkFkZExpZmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIEJvb3N0VHlwZS5TUExJVDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXNlU3BsaXRCYWxsQm9vc3QoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIEJvb3N0VHlwZS5USFJFRV9CQUxMOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51c2VOZXczQmFsbEJvb3N0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBCb29zdFR5cGUuQk9NQjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXNlQm9tYkJvb3N0KGJvb3N0LmdldFBvc2l0aW9uKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgQm9vc3RUeXBlLlNVUEVSX0JPQVJEOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51c2VTdXBlckJvYXJkKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5ib29zdHMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICAgIGJvb3N0LnJlbW92ZUZyb21QYXJlbnQoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYm9vc3QueSA8IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmJvb3N0cy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgYm9vc3QucmVtb3ZlRnJvbVBhcmVudCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIHVwZGF0ZUtleTogZnVuY3Rpb24gKGR0KSB7XG4gICAgICAgIGlmICh0aGlzLmtleVNwcml0ZSkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLnNob3dlZEtleVJlbW92ZUFuaW0gJiYgdGhpcy5lY2xpcHNlZFRpbWUgPj0gMTUwMDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dlZEtleVJlbW92ZUFuaW0gPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMua2V5U3ByaXRlLnJ1bkFjdGlvbihcbiAgICAgICAgICAgICAgICAgICAgY2Muc2VxdWVuY2UoXG4gICAgICAgICAgICAgICAgICAgICAgICBjYy5zZXF1ZW5jZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYy5mYWRlSW4oMC41KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYy5mYWRlT3V0KDAuNSlcbiAgICAgICAgICAgICAgICAgICAgICAgICkucmVwZWF0KDUpLCBjYy5jYWxsRnVuYyh0aGlzLnJlbW92ZUtleSwgdGhpcykpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBzcHJpdGVCb3VuZGluZ0JveCA9IHRoaXMua2V5U3ByaXRlLmdldEJvdW5kaW5nQm94KCk7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuYmFsbExpc3QubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICB2YXIgYmFsbCA9IHRoaXMuYmFsbExpc3RbaV07XG4gICAgICAgICAgICAgICAgaWYgKCBjYy5yZWN0Q29udGFpbnNQb2ludChzcHJpdGVCb3VuZGluZ0JveCwgYmFsbC5nZXRQb3NpdGlvbigpKSkge1xuICAgICAgICAgICAgICAgICAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImdldF9rZXlcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmx5S2V5KCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICB1c2VTcGxpdEJhbGxCb29zdDogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnRyeVNob290Rmlyc3RCYWxsKGNjLnAoMCwgMSkpO1xuICAgICAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImJvb3N0X2FkZFwiKTtcbiAgICAgICAgZ2FtZS5hdWRpb1BsYXllci52aWJyYXRlU2hvcnQoKTtcbiAgICAgICAgLy8gdmFyIHQxID0gRGF0ZS5ub3coKTtcbiAgICAgICAgZm9yICh2YXIgaiA9IHRoaXMuYmFsbExpc3QubGVuZ3RoIC0gMTsgaiA+PSAwOyAtLWopIHtcbiAgICAgICAgICAgIHZhciBiYWxsID0gdGhpcy5iYWxsTGlzdFtqXTtcbiAgICAgICAgICAgIHRoaXMub25TcGxpdEJhbGwoYmFsbC5nZXRQb3NpdGlvbigpKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmJhbGxMaXN0Lmxlbmd0aCA+IHRoaXMuTUFYX0JBTEwpIHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyB2YXIgdDIgPSBEYXRlLm5vdygpO1xuICAgICAgICAvL2NjLmxvZyhcInNwbGl0IGJhbGwgdGltZTpcIiArICh0MiAtIHQxKSk7XG4gICAgfSxcblxuICAgIHVzZU5ldzNCYWxsQm9vc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy50cnlTaG9vdEZpcnN0QmFsbChjYy5wKDAsIDEpKTtcbiAgICAgICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJib29zdF9hZGRcIik7XG4gICAgICAgIHRoaXMub25TaG9vdDNCYWxsKCk7XG4gICAgICAgIGdhbWUuYXVkaW9QbGF5ZXIudmlicmF0ZVNob3J0KCk7XG4gICAgfSxcblxuICAgIHVzZVN1cGVyQm9hcmQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5zdXBlckJvYXJkV2FsbHMgPSBbXTtcbiAgICAgICAgdGhpcy5zdXBlckJvYXJkT2JzdGFjbGVzID0gW107XG5cbiAgICAgICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJzdXBlcl9ib2FyZFwiKTtcblxuICAgICAgICB2YXIgeSA9IC1NYXRoLmZsb29yKCh0aGlzLkJSSUNLX1kgLSB0aGlzLkJPQVJEX1kpIC8gdGhpcy5HUklEX0FORF9HQVBfSEVJR0hUKSAtIDM7XG5cbiAgICAgICAgdGhpcy5pbml0T2JzdGFjbGUoe1xuICAgICAgICAgICAgeDogMCxcbiAgICAgICAgICAgIHk6IHksXG4gICAgICAgICAgICB3aWR0aDogdGhpcy5jb25maWcud2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IDJcbiAgICAgICAgfSwgdGhpcy5zdXBlckJvYXJkTm9kZSwgdGhpcy5zdXBlckJvYXJkT2JzdGFjbGVzLCB0aGlzLnN1cGVyQm9hcmRXYWxscyk7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgdmFyIHNlcSA9IGNjLnNlcXVlbmNlKFxuICAgICAgICAgICAgY2Muc2VxdWVuY2UoY2MuZmFkZU91dCgwLjIpLCBjYy5mYWRlSW4oMC4yKSkucmVwZWF0KDMpLFxuICAgICAgICAgICAgY2MuZGVsYXlUaW1lKDQuNiksXG4gICAgICAgICAgICBjYy5zZXF1ZW5jZShjYy5mYWRlSW4oMC4yKSwgY2MuZmFkZU91dCgwLjIpKS5yZXBlYXQoMykpO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc3VwZXJCb2FyZE9ic3RhY2xlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdGhpcy5zdXBlckJvYXJkT2JzdGFjbGVzW2ldLnNwcml0ZS5ydW5BY3Rpb24oc2VxLmNsb25lKCkpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc3VwZXJCb2FyZE5vZGUucnVuQWN0aW9uKGNjLnNlcXVlbmNlKFxuICAgICAgICAgICAgY2MuZGVsYXlUaW1lKDcuMiksXG4gICAgICAgICAgICBjYy5jYWxsRnVuYyhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5zdXBlckJvYXJkTm9kZS5yZW1vdmVBbGxDaGlsZHJlbigpO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5zdXBlckJvYXJkV2FsbHMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN1cGVyQm9hcmRXYWxsID0gc2VsZi5zdXBlckJvYXJkV2FsbHNbaV07XG4gICAgICAgICAgICAgICAgICAgIHN1cGVyQm9hcmRXYWxsLnJlbW92ZUJvZHkoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICApKTtcbiAgICB9LFxuXG4gICAgY2FuVXNlQm9vc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLmdhbWVTdGVwID09PSBHYW1lU3RlcC5TVEFSVCk7XG4gICAgfSxcblxuICAgIHVzZUJvbWJCb29zdDogZnVuY3Rpb24gKHBvcykge1xuICAgICAgICB0aGlzLmdhbWVTdGVwID0gR2FtZVN0ZXAuQk9NQjtcbiAgICAgICAgdmFyIHAxID0gbmV3IGNjLlBhcnRpY2xlU3lzdGVtKFwicmVzL21lbnUvYm9tYi5wbGlzdFwiKTtcbiAgICAgICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJib21iXCIpO1xuICAgICAgICBwMS5zZXRQb3NpdGlvbihwb3MpO1xuICAgICAgICBwMS5zY2FsZSA9IDI7XG4gICAgICAgIHRoaXMuYWRkQ2hpbGQocDEsIDEwMDApO1xuICAgICAgICB0aGlzLnJ1bkFjdGlvbihjYy5zZXF1ZW5jZShjYy5kZWxheVRpbWUoMSksIGNjLmNhbGxGdW5jKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMucG9wdXBDaGFsbGVuZ2VSZXZpdmUoRmFpbFJlYXNvbi5Cb21iKTtcbiAgICAgICAgfS5iaW5kKHRoaXMpLCB0aGlzKSkpO1xuICAgIH0sXG5cbiAgICBwbGF5TGFzZXJCb21iQW5pbTogZnVuY3Rpb24gKHBvcykge1xuICAgICAgICB0aGlzLmdhbWVTdGVwID0gR2FtZVN0ZXAuTEFTRVI7XG4gICAgICAgIHZhciBwMSA9IG5ldyBjYy5QYXJ0aWNsZVN5c3RlbShcInJlcy9tZW51L2JvbWIucGxpc3RcIik7XG4gICAgICAgIGdhbWUuYXVkaW9QbGF5ZXIucGxheUVmZmVjdEJ5S2V5KFwiYm9tYlwiKTtcbiAgICAgICAgcDEuc2V0UG9zaXRpb24ocG9zKTtcbiAgICAgICAgcDEuc2NhbGUgPSAyO1xuICAgICAgICB0aGlzLmFkZENoaWxkKHAxLCAxMDAwKTtcbiAgICAgICAgdGhpcy5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoY2MuZGVsYXlUaW1lKDEpLCBjYy5jYWxsRnVuYyhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLnBvcHVwQ2hhbGxlbmdlUmV2aXZlKEZhaWxSZWFzb24uTGFzZXIpO1xuICAgICAgICB9LmJpbmQodGhpcyksIHRoaXMpKSk7XG4gICAgfSxcblxuICAgIG9uQWRkTGlmZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmxpZmVDb3VudCsrO1xuICAgICAgICBpZiAodGhpcy5nYW1lQ29udHJvbGxlcikge1xuICAgICAgICAgICAgdGhpcy5nYW1lQ29udHJvbGxlci51cGRhdGVMaWZlQ291bnQoKTtcbiAgICAgICAgfVxuICAgICAgICBnYW1lLmF1ZGlvUGxheWVyLnBsYXlFZmZlY3RCeUtleShcImxpZmVfYWRkXCIpO1xuICAgICAgICBnYW1lLmF1ZGlvUGxheWVyLnZpYnJhdGVTaG9ydCgpO1xuICAgIH0sXG5cbiAgICBvblNwbGl0QmFsbDogZnVuY3Rpb24gKHBvc2l0aW9uKSB7XG4gICAgICAgIHZhciB2ZWwgPSB0aGlzLk1BWF9TUEVFRDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAzOyArK2kpIHtcbiAgICAgICAgICAgIHZhciBhbmdsZSA9IGdhbWUudXRpbHMucmFuZG9tTmV4dEludCg5MCk7XG4gICAgICAgICAgICB2YXIgc3ltYm9sMSA9IChnYW1lLnV0aWxzLnJhbmRvbU5leHRJbnQoMikgPT09IDEgPyAxIDogLTEpO1xuICAgICAgICAgICAgdmFyIHN5bWJvbDIgPSAoZ2FtZS51dGlscy5yYW5kb21OZXh0SW50KDIpID09PSAxID8gMSA6IC0xKTtcbiAgICAgICAgICAgIHZhciB4ID0gMTAseSA9IDEwO1xuICAgICAgICAgICAgdmFyIHJhbmRvbVBvcyA9IGNjLnBBZGQocG9zaXRpb24sIGNjLnAoLXggLyAyICsgeCAqIGdhbWUudXRpbHMucmFuZG9tTmV4dE51bWJlcigxKSxcbiAgICAgICAgICAgICAgICAteSAvIDIgKyB5ICogZ2FtZS51dGlscy5yYW5kb21OZXh0TnVtYmVyKDEpKSk7XG4gICAgICAgICAgICB0aGlzLnNob290QmFsbChyYW5kb21Qb3MsIGNjLnAoc3ltYm9sMSAqIHZlbCAqIE1hdGguc2luKE1hdGguUEkgLyAxODAgKiBhbmdsZSksXG4gICAgICAgICAgICAgICAgICAgIHN5bWJvbDIgKiB2ZWwgKiBNYXRoLmNvcyhNYXRoLlBJIC8gMTgwICogYW5nbGUpKSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgb25TaG9vdDNCYWxsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB2ZWwgPSB0aGlzLk1BWF9TUEVFRDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAzOyArK2kpIHtcbiAgICAgICAgICAgIHZhciBzcGVlZCA9IGNjLnAodmVsICogTWF0aC5jb3MoTWF0aC5QSSAvIDE4MCAqIHRoaXMuU1BMSVRfQkFMTF9BTkdMRVtpXSksXG4gICAgICAgICAgICAgICAgdmVsICogTWF0aC5zaW4oTWF0aC5QSSAvIDE4MCAqIHRoaXMuU1BMSVRfQkFMTF9BTkdMRVtpXSkpO1xuICAgICAgICAgICAgdGhpcy5zaG9vdEJhbGwodGhpcy5nZXRJbml0QmFsbFBvcygpLCBzcGVlZCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2hvd2VkV2luOiBmYWxzZSxcbiAgICBzd2l0Y2hQYXNzRGxnOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdhbWUuYXVkaW9QbGF5ZXIucGxheUVmZmVjdEJ5S2V5KFwidmljdG9yeVwiKTtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmIChnYW1lLmdhbWVNYW4uaXNOZXdSZXN1bHQoKSkge1xuICAgICAgICAgICAgICAgIHNlbGYuc2hvd2VkV2luID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdmFyIHNob3dlZCA9IGdhbWUuYWRzTWFuYWdlci5zaG93SW50ZXJzdGl0aWFsKGdhbWUuYWRzUGxhY2UuUGFzcywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXNlbGYuc2hvd2VkV2luKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNob3dlZFdpbiA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNob3dQYXNzKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoIXNob3dlZCkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnNob3dQYXNzKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXNlbGYuc2hvd2VkV2luKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zaG93ZWRXaW4gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2hvd1Bhc3MoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSwgMTAwMDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc2VsZi5zaG93UGFzcygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCA1MDApO1xuICAgIH0sXG5cbiAgICBzaG93UGFzczogZnVuY3Rpb24gKCkge1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBQYXNzRGxnKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBHYW1lTWFuLmdldEluc3RhbmNlKCkucmVzdW1lR2FtZSgpO1xuICAgICAgICAgICAgICAgIGdhbWUuc2NlbmVNYW4uc3dpdGNoU2NlbmUoZ2FtZS5zY2VuZVR5cGUuR0FNRSk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgY2MubG9nKFwiZ2FtZS5nYW1lTWFuLmxldmVsSWQ6XCIgKyBnYW1lLmdhbWVNYW4ubGV2ZWxJZCk7XG4gICAgICAgICAgICAgICAgaWYgKGdhbWUuZ2FtZU1hbi5pc0NoYWxsZW5nZUxldmVsICYmIChnYW1lLmdhbWVNYW4ubGV2ZWxJZCAtIDEpICUgNSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBnYW1lLnNjZW5lTWFuLnN3aXRjaFNjZW5lKGdhbWUuc2NlbmVUeXBlLkNIQUxMRU5HRSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmhhc05leHRMZXZlbCgpKSB7XG4gICAgICAgICAgICAgICAgICAgIGdhbWUuc2NlbmVNYW4uc3dpdGNoU2NlbmUoZ2FtZS5zY2VuZVR5cGUuR0FNRSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cENvbW1vbkRsZyhnYW1lLmxvY2FsLmdldFZhbHVlKFwiYWxsX2NvbXBsZXRlZFwiKSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5zY2VuZU1hbi5zd2l0Y2hTY2VuZShnYW1lLnNjZW5lVHlwZS5MRVZFTCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LCAyMDApO1xuICAgIH0sXG5cbiAgICBjaGVja0dhbWVPdmVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgaWYgKHRoaXMuYnJpY2tzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5pc0VkaXRvcikge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vcmV0dXJuO1xuICAgICAgICAgICAgdGhpcy5nYW1lU3RlcCA9IEdhbWVTdGVwLkVORDtcbiAgICAgICAgICAgIGdhbWUuYXVkaW9QbGF5ZXIuc3RvcEVmZmVjdChcImNvdW50X2Rvd25cIik7XG4gICAgICAgICAgICB0aGlzLnNob3dCYW5uZXJBZHMoKTtcbiAgICAgICAgICAgIHZhciBsZXZlbElkID0gR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmxldmVsSWQ7XG4gICAgICAgICAgICBHYW1lTWFuLmdldEluc3RhbmNlKCkuZ2FtZVdpbih0aGlzLmVjbGlwc2VkVGltZSAvIDEwMDApO1xuICAgICAgICAgICAgaWYgKGdhbWUuZ2FtZU1hbi5pc0NoYWxsZW5nZUxldmVsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zd2l0Y2hQYXNzRGxnKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBzdGFyID0gR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmN1cnJlbnRTdGFyO1xuICAgICAgICAgICAgICAgIGlmIChzdGFyIDwgMykge1xuICAgICAgICAgICAgICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwR2V0M1N0YXIoXCIzX3N0YXJcIiwgZnVuY3Rpb24gKHdhdGNoZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3YXRjaGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5nYW1lTWFuLm9uV2F0Y2hBZHNHZXQzU3RhcihsZXZlbElkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnN3aXRjaFBhc3NEbGcoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zd2l0Y2hQYXNzRGxnKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3dpdGNoUGFzc0RsZygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmJhbGxMaXN0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgaWYgKHRoaXMubGlmZUNvdW50ID4gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMubGlmZUNvdW50LS07XG4gICAgICAgICAgICAgICAgdGhpcy5nYW1lU3RlcCA9IEdhbWVTdGVwLlJFTElGRTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGdhbWUuZ2FtZU1hbi5pc0NoYWxsZW5nZUxldmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucG9wdXBDaGFsbGVuZ2VSZXZpdmUoRmFpbFJlYXNvbi5Ob3JtYWwpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChnYW1lLmFkc01hbmFnZXIuaXNSZXdhcmRWaWRlb1JlYWR5KCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2FtZVN0ZXAgPSBHYW1lU3RlcC5GQUlMX0FORF9XQUlUX1JFTElGRTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBSZWxpZmUoZnVuY3Rpb24gKHJlbGlmZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWxpZmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi53YXRjaEFkQW5kUmVsaWZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zd2l0Y2hUb0ZhaWwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc3dpdGNoVG9GYWlsKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcG9wdXBDaGFsbGVuZ2VSZXZpdmU6IGZ1bmN0aW9uIChyZWFzb24pIHtcbiAgICAgICAgdGhpcy5nYW1lU3RlcCA9IEdhbWVTdGVwLkZBSUxfQU5EX1dBSVRfUkVMSUZFO1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIGlmICghZ2FtZS5jaGFsbGVuZ2VNYW4uY2FuUmV2aXZlKCkpIHtcbiAgICAgICAgICAgIGdhbWUuY2hhbGxlbmdlTWFuLnJvbGxCYWNrUHJvZ3Jlc3MoKTtcbiAgICAgICAgICAgIGdhbWUucG9wdXBNYW4ucG9wdXBDb21tb25EbGcoZ2FtZS51dGlscy5zcHJpbnRmKF8oXCJjaGFsbGVuZ2VfcmVzZXRfdGlwc1wiKSwgZ2FtZS5jaGFsbGVuZ2VNYW4uZ2V0Um9sbGJhY2tMZXZlbCgpKSxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5zd2l0Y2hDaGFsbGVuZ2VGYWlsKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBnYW1lLnBvcHVwTWFuLnBvcHVwUmVsaXZlRGxnKHJlYXNvbiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc2VsZi5zd2l0Y2hUb0NoYWxsZW5nZVJlbGlmZSgpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBnYW1lLmNoYWxsZW5nZU1hbi5wb3B1cFF1aXRUaXBzKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBnYW1lLmNoYWxsZW5nZU1hbi5yb2xsQmFja1Byb2dyZXNzKCk7XG4gICAgICAgICAgICAgICAgc2VsZi5zd2l0Y2hDaGFsbGVuZ2VGYWlsKCk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5wb3B1cENoYWxsZW5nZVJldml2ZShGYWlsUmVhc29uLk5vcm1hbCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHN3aXRjaENoYWxsZW5nZUZhaWwgOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdhbWUuZ2FtZU1hbi5vbkdhbWVGYWlsKCk7XG4gICAgICAgIHRoaXMuZ2FtZVN0ZXAgPSBHYW1lU3RlcC5FTkQ7XG4gICAgICAgIGdhbWUuYXVkaW9QbGF5ZXIuc3RvcEVmZmVjdChcImNvdW50X2Rvd25cIik7XG4gICAgICAgIGdhbWUuc2NlbmVNYW4uc3dpdGNoU2NlbmUoZ2FtZS5zY2VuZVR5cGUuQ0hBTExFTkdFKTtcbiAgICB9LFxuXG4gICAgd2F0Y2hBZEFuZFJlbGlmZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIFN0b3JlSGVscGVyLmdldEluc3RhbmNlKCkuY2hlY2tBbmRTaG93UmV3YXJkVmlkZW8oZ2FtZS51dGlscy5pc0lPUygpID8gXCJmdWh1bzAxXCIgOiBcImZ1aHVvMDFcIiwgZnVuY3Rpb24gKHJld2FyZGVkKSB7XG4gICAgICAgICAgICBpZiAocmV3YXJkZWQpIHtcbiAgICAgICAgICAgICAgICBnYW1lLmFuYWx5c2VNYW5hZ2VyLnRyYWNrRXZlbnQoXCJXYXRjaEFkc1RvUmVsaWZlXCIpO1xuICAgICAgICAgICAgICAgIHNlbGYuc3dpdGNoVG9SZWxpZmUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc2VsZi5zd2l0Y2hUb0ZhaWwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8vc3dpdGNoVG9XYWl0RmFpbDogZnVuY3Rpb24gKCkge1xuICAgIC8vICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAvLyAgICB0aGlzLmdhbWVTdGVwID0gR2FtZVN0ZXAuRkFJTF9BTkRfV0FJVF9SRUxJRkU7XG4gICAgLy8gICAgZ2FtZS5wb3B1cE1hbi5wb3B1cFJlbGl2ZURsZyhmdW5jdGlvbiAoKSB7XG4gICAgLy8gICAgICAgIHNlbGYuc3dpdGNoVG9SZWxpZmUoKTtcbiAgICAvLyAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgLy8gICAgICAgIHNlbGYuc3dpdGNoVG9GYWlsKCk7XG4gICAgLy8gICAgfSk7XG4gICAgLy99LFxuXG4gICAgc3dpdGNoVG9SZWxpZmU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5saWZlQ291bnQgPSAyO1xuICAgICAgICB0aGlzLmdhbWVTdGVwID0gR2FtZVN0ZXAuUkVMSUZFO1xuICAgIH0sXG5cbiAgICBzd2l0Y2hUb0NoYWxsZW5nZVJlbGlmZTogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoZ2FtZS5nYW1lTWFuLmlzQ291bnREb3duQ2hhbGxlbmdlKCkpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmdldENvdW50RG93bkxlZnRUaW1lKCkgPCAxKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGRlZENvdW50RG93blRpbWUgKz0gdGhpcy5jb25maWcuc3RhclRpbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZ2FtZS5hbmFseXNlTWFuYWdlci50cmFja0V2ZW50KFwiQ2hhbGxlbmdlUmV2aXZlTGV2ZWxcIiwge1wibGV2ZWxcIjogR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmxldmVsSWR9KTtcbiAgICAgICAgZ2FtZS5wbGF5ZXJNYW4uYWRkQ2hhbGxlbmdlUmV2aXZlQ291bnQoZ2FtZS5jaGFsbGVuZ2VNYW4uY3VycmVudENoYWxsZW5nZUlkKTtcbiAgICAgICAgdGhpcy5saWZlQ291bnQgPSAwO1xuICAgICAgICB0aGlzLmdhbWVTdGVwID0gR2FtZVN0ZXAuUkVMSUZFO1xuICAgIH0sXG5cbiAgICBzd2l0Y2hUb0ZhaWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHdpbmRvdy5pc0VkaXRvcikge1xuICAgICAgICAgICAgdGhpcy5zd2l0Y2hUb1JlbGlmZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgR2FtZU1hbi5nZXRJbnN0YW5jZSgpLm9uR2FtZUZhaWwoKTtcbiAgICAgICAgICAgIHRoaXMuZ2FtZVN0ZXAgPSBHYW1lU3RlcC5FTkQ7XG4gICAgICAgICAgICBnYW1lLmF1ZGlvUGxheWVyLnN0b3BFZmZlY3QoXCJjb3VudF9kb3duXCIpO1xuICAgICAgICAgICAgZ2FtZS5wb3B1cE1hbi5wb3B1cEZhaWxEbGcoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGdhbWUuc2NlbmVNYW4uc3dpdGNoU2NlbmUoZ2FtZS5zY2VuZVR5cGUuR0FNRSk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgR2FtZU1hbi5nZXRJbnN0YW5jZSgpLnNraXBMZXZlbCgpO1xuICAgICAgICAgICAgICAgIGdhbWUuc2NlbmVNYW4uc3dpdGNoU2NlbmUoZ2FtZS5zY2VuZVR5cGUuR0FNRSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBpc0luVmlldzogZnVuY3Rpb24gKHdvcmxkUG9zKSB7XG4gICAgICAgIGlmICh3b3JsZFBvcy54IDwgMCB8fCB3b3JsZFBvcy54ID4gdGhpcy5XSU5fV0lEVEggfHwgd29ybGRQb3MueSA8IDAgfHwgd29ybGRQb3MueSA+IHRoaXMuV0lOX0hFSUdIVCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG5cbiAgICBvblNob3dBaW1HdWlkZTogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGlmICghZ2FtZS5wbGF5ZXJNYW4ucGxheWVyLmlzQWltVmVyc2lvbikge1xuICAgICAgICAgICAgdGhpcy5zaG93QWltR3VpZGVBbmltYXRpb24oKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzaG93QWltR3VpZGVBbmltYXRpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5nYW1lQ29udHJvbGxlci5uZEFpbUhlbHAudmlzaWJsZSA9IHRydWU7XG4gICAgICAgIHRoaXMuZ2FtZVN0ZXAgPSBHYW1lU3RlcC5BSU1fR1VJREU7XG4gICAgfSxcblxuICAgIHRyeVNob290Rmlyc3RCYWxsOiBmdW5jdGlvbiAoZGlyZWN0aW9uKSB7XG4gICAgICAgIGlmICh0aGlzLmdhbWVTdGVwID09PSBHYW1lU3RlcC5QUkVfU1RBUlQgJiYgZGlyZWN0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLmdhbWVTdGVwID0gR2FtZVN0ZXAuU1RBUlQ7XG4gICAgICAgICAgICB0aGlzLnNob290QmFsbCh0aGlzLmdldEluaXRCYWxsUG9zKCksIGNjLnAoZGlyZWN0aW9uLnggKiB0aGlzLk1BWF9TUEVFRCwgZGlyZWN0aW9uLnkgKiB0aGlzLk1BWF9TUEVFRCkpO1xuICAgICAgICAgICAgdGhpcy5ib2FyZE5vZGUuaGlkZUJhbGwoKTtcbiAgICAgICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5wbGF5ZXIuaXNBaW1WZXJzaW9uKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaGludEd1aWRlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NoZWR1bGVPbmNlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nYW1lQ29udHJvbGxlci5uZEhlbHAudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSwgMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldFJlZmxlY3Rpb25Ob3JtYWw6IGZ1bmN0aW9uIChzdGFydCwgaGl0UG9pbnQsIG4pIHtcbiAgICAgICAgdmFyIGFvID0gY2MucFN1YihoaXRQb2ludCwgc3RhcnQpO1xuICAgICAgICB2YXIgZG90ID0gY2MucERvdChhbywgbik7XG4gICAgICAgIHZhciBvYiA9IGNjLnBTdWIoYW8sIGNjLnBNdWx0KG4sIDIgKiBkb3QpKTtcbiAgICAgICAgdmFyIG5vcm1hbE9iID0gY2MucE5vcm1hbGl6ZShvYik7XG4gICAgICAgIC8vIGNjLmxvZyhcInJlZmxlY3Rpb24gbm9ybWFsOlwiICsgSlNPTi5zdHJpbmdpZnkobm9ybWFsT2IpKTtcbiAgICAgICAgcmV0dXJuIG5vcm1hbE9iO1xuICAgIH0sXG5cbiAgICBjYW5TaG9vdDogZnVuY3Rpb24gKHRvdWNoTG9jYXRpb24pIHtcbiAgICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5nZXRJbml0QmFsbFBvcygpO1xuICAgICAgICBpZiAodG91Y2hMb2NhdGlvbi55IDwgc3RhcnQueSArIDE1KSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIGRyYXdEYXNoTm9kZTogZnVuY3Rpb24gKHN0YXJ0LCBlbmQsIHN0YXJ0Q291bnQpIHtcbiAgICAgICAgdmFyIGNvdW50ID0gc3RhcnRDb3VudDtcbiAgICAgICAgZ2FtZS51dGlscy5nZXREYXNoUG9pbnRzTm9kZSh0aGlzLmRyYXdOb2RlLCBbc3RhcnQsIGVuZF0sIFsyMF0sIDIwLCBmdW5jdGlvbiAoeDEsIHkxKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuZG90c1tjb3VudF0pIHtcbiAgICAgICAgICAgICAgICB2YXIgbm9kZSA9IHRoaXMuY3JlYXRlRG90Tm9kZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuZG90cy5wdXNoKG5vZGUpO1xuICAgICAgICAgICAgICAgIHRoaXMuZHJhd05vZGUuYWRkQ2hpbGQobm9kZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmRvdHNbY291bnRdLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5kb3RzW2NvdW50KytdLnNldFBvc2l0aW9uKGNjLnAoeDEsIHkxKSk7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIHJldHVybiBjb3VudDtcbiAgICB9LFxuXG4gICAgb25Ub3VjaEJlZ2FuOmZ1bmN0aW9uKHRvdWNoLCBldmVudCkge1xuICAgICAgICAvL2NjLmxvZyhcImJyaWNrIHZpZXcgb25Ub3VjaEJlZ2FuOlwiICsgdG91Y2guZ2V0SUQoKSk7XG4gICAgICAgIGlmICh0aGlzLl9jdXJUb3VjaElkID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2N1clRvdWNoSWQgPSB0b3VjaC5nZXRJRCgpO1xuICAgICAgICBpZiAoZ2FtZS5wbGF5ZXJNYW4ucGxheWVyLmlzQWltVmVyc2lvbikge1xuICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZUNvbnRyb2xsZXIgJiYgdGhpcy5nYW1lQ29udHJvbGxlci5uZEhlbHAudmlzaWJsZSkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVzdW1lKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5nYW1lQ29udHJvbGxlci5uZEhlbHAudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGdhbWUuc3RvcmFnZUNvbnRyb2xsZXIuc2V0SXRlbShcImZpcnN0X2VudGVyXCIsIFwiZmFsc2VcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmdhbWVDb250cm9sbGVyICYmIHRoaXMuZ2FtZUNvbnRyb2xsZXIubmRBaW1IZWxwLnZpc2libGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdhbWVDb250cm9sbGVyLm5kQWltSGVscC52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5jbGVhckhpbnROb2RlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5oaW50R3VpZGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuZ2FtZVN0ZXAgPSBHYW1lU3RlcC5QUkVfU1RBUlQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmdhbWVTdGVwID09PSBHYW1lU3RlcC5QUkVfU1RBUlQgfHwgdGhpcy5nYW1lU3RlcCA9PT0gR2FtZVN0ZXAuU1RBUlQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxhc3RUb3VjaFBvcyA9IHRoaXMuZ2V0UGFyZW50KCkuY29udmVydFRvTm9kZVNwYWNlKHRvdWNoLmdldExvY2F0aW9uKCkpO1xuICAgICAgICAgICAgICAgIHRoaXMubGFzdERpcmVjdGlvbiA9IG51bGw7XG4gICAgICAgICAgICAgICAgdGhpcy5nYW1lQ29udHJvbGxlci5uZEdldEJvYXJkU2tpbi5jb250cm9sbGVyLnBsYXlIaWRlQW5pbSgpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZUNvbnRyb2xsZXIgJiYgdGhpcy5nYW1lQ29udHJvbGxlci5uZEhlbHAudmlzaWJsZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ2FtZUNvbnRyb2xsZXIubmRIZWxwLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBnYW1lLnN0b3JhZ2VDb250cm9sbGVyLnNldEl0ZW0oXCJmaXJzdF9lbnRlclwiLCBcImZhbHNlXCIpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZUNvbnRyb2xsZXIgJiYgdGhpcy5nYW1lQ29udHJvbGxlci5uZEFpbUhlbHAudmlzaWJsZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ2FtZUNvbnRyb2xsZXIubmRBaW1IZWxwLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLmNsZWFySGludE5vZGUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmdhbWVTdGVwID0gR2FtZVN0ZXAuUFJFX1NUQVJUO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmxhc3RUb3VjaFBvcyA9IHRoaXMuZ2V0UGFyZW50KCkuY29udmVydFRvTm9kZVNwYWNlKHRvdWNoLmdldExvY2F0aW9uKCkpO1xuICAgICAgICAgICAgdGhpcy5sYXN0RGlyZWN0aW9uID0gY2MucCgwLCAxKTtcbiAgICAgICAgICAgIHRoaXMuZ2FtZUNvbnRyb2xsZXIubmRBbmltSXRlbS5jb250cm9sbGVyLnBsYXlIaWRlQW5pbSgpO1xuICAgICAgICAgICAgdGhpcy5nYW1lQ29udHJvbGxlci5uZEdldEJvYXJkU2tpbi5jb250cm9sbGVyLnBsYXlIaWRlQW5pbSgpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICBvblRvdWNoTW92ZWQ6ZnVuY3Rpb24odG91Y2gsIGV2ZW50KSB7XG4gICAgICAgIGlmICh0b3VjaC5nZXRJRCgpICE9PSB0aGlzLl9jdXJUb3VjaElkKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgLy8gdmFyIHQxID0gRGF0ZS5ub3coKTtcbiAgICAgICAgdmFyIHRvdWNoTG9jYXRpb24gPSB0aGlzLmdldFBhcmVudCgpLmNvbnZlcnRUb05vZGVTcGFjZSh0b3VjaC5nZXRMb2NhdGlvbigpKTtcbiAgICAgICAgaWYgKHRoaXMubGFzdFRvdWNoUG9zKSB7XG4gICAgICAgICAgICB2YXIgb2Zmc2V0ID0gKHRvdWNoTG9jYXRpb24ueCAtIHRoaXMubGFzdFRvdWNoUG9zLngpO1xuICAgICAgICAgICAgdmFyIGNhbk1vdmUgPSBmYWxzZTtcbiAgICAgICAgICAgIGlmIChNYXRoLmFicyhvZmZzZXQpID4gMC41KSB7XG4gICAgICAgICAgICAgICAgY2FuTW92ZSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5nYW1lU3RlcCA9PT0gR2FtZVN0ZXAuTEFTRVIpIHtcbiAgICAgICAgICAgICAgICBjYW5Nb3ZlID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ2FtZS5nYW1lTWFuLmNhblVzZUFpbUl0ZW0oKSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmdhbWVTdGVwID09PSBHYW1lU3RlcC5QUkVfU1RBUlQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhckhpbnROb2RlKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGFzdERpcmVjdGlvbiA9IHRoaXMuZHJhd0FpbUxpbmUodG91Y2hMb2NhdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGFzdFRvdWNoUG9zID0gdG91Y2hMb2NhdGlvbjtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2FuTW92ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlQm9hcmQob2Zmc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubGFzdFRvdWNoUG9zID0gdG91Y2hMb2NhdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGNhbk1vdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlQm9hcmQob2Zmc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYXN0VG91Y2hQb3MgPSB0b3VjaExvY2F0aW9uO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBjYy5sb2coXCJvblRvdWNoTW92ZWQgdGltZTpcIiArIChEYXRlLm5vdygpIC0gdDEpKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIGRyYXdBaW1MaW5lOiBmdW5jdGlvbiAodG91Y2hMb2NhdGlvbikge1xuICAgICAgICAvLyB2YXIgdDEgPSBEYXRlLm5vdygpO1xuXG4gICAgICAgIHZhciBzdGFydCA9IHRoaXMuZ2V0SW5pdEJhbGxQb3MoKTtcbiAgICAgICAgaWYgKCF0aGlzLmNhblNob290KHRvdWNoTG9jYXRpb24pKSB7XG4gICAgICAgICAgICAvL3RvdWNoTG9jYXRpb24gPSBjYy5wKHN0YXJ0LngsIGNjLndpblNpemUuaGVpZ2h0KTtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIC8vIHZhciB0MiA9IERhdGUubm93KCk7XG4gICAgICAgIC8vIGNjLmxvZyhcImRyYXdBaW1MaW5lIDE6XCIgKyAodDIgLSB0MSkpO1xuICAgICAgICB2YXIgZGlyZWN0aW9uID0gY2MucE5vcm1hbGl6ZShjYy5wU3ViKHRvdWNoTG9jYXRpb24sIHN0YXJ0KSk7XG4gICAgICAgIHZhciBlbmQgPSBjYy5wQWRkKHN0YXJ0LCBjYy5wTXVsdChkaXJlY3Rpb24sIGNjLndpblNpemUuaGVpZ2h0ICsgY2Mud2luU2l6ZS53aWR0aCkpO1xuICAgICAgICB2YXIgcmFkaXVzID0gMTA7XG4gICAgICAgIHZhciBpbmZvID0gdGhpcy5zcGFjZS5zZWdtZW50UXVlcnlGaXJzdChzdGFydCwgZW5kLCByYWRpdXMsIHtcbiAgICAgICAgICAgIGdyb3VwOiBjcC5OT19HUk9VUCxcbiAgICAgICAgICAgIGNhdGVnb3JpZXM6IGNwLkFMTF9DQVRFR09SSUVTLFxuICAgICAgICAgICAgbWFzazogSXRlbUNhdGVnb3J5LldhbGxcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIHZhciB0MyA9IERhdGUubm93KCk7XG4gICAgICAgIC8vIGNjLmxvZyhcImRyYXdBaW1MaW5lIDI6XCIgKyAodDMgLSB0MikpO1xuICAgICAgICBpZiAoaW5mbykge1xuICAgICAgICAgICAgdmFyIGhpbnRQb2ludCA9IGluZm8ucG9pbnQ7XG4gICAgICAgICAgICB2YXIgbmV4dFN0YXJ0Q291bnQgPSB0aGlzLmRyYXdEYXNoTm9kZShzdGFydCwgaGludFBvaW50LCAwKTtcbiAgICAgICAgICAgIC8vIHZhciB0NCA9IERhdGUubm93KCk7XG4gICAgICAgICAgICAvLyBjYy5sb2coXCJkcmF3QWltTGluZSAzOlwiICsgKHQ0IC0gdDMpKTtcbiAgICAgICAgICAgIHZhciByZWZsZWN0aW9uTm9ybWFsID0gdGhpcy5nZXRSZWZsZWN0aW9uTm9ybWFsKHN0YXJ0LCBoaW50UG9pbnQsIGluZm8ubm9ybWFsKTtcbiAgICAgICAgICAgIHZhciByZWZsZWN0aW9uUG9pbnQgPSBjYy5wQWRkKGhpbnRQb2ludCwgY2MucE11bHQocmVmbGVjdGlvbk5vcm1hbCwgODApKTtcbiAgICAgICAgICAgIC8vIHZhciB0NSA9IERhdGUubm93KCk7XG4gICAgICAgICAgICAvLyBjYy5sb2coXCJkcmF3QWltTGluZSA0OlwiICsgKHQ1IC0gdDQpKTtcbiAgICAgICAgICAgIHRoaXMuZHJhd0Rhc2hOb2RlKGhpbnRQb2ludCwgcmVmbGVjdGlvblBvaW50LCBuZXh0U3RhcnRDb3VudCk7XG4gICAgICAgICAgICAvLyB2YXIgdDYgPSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgLy8gY2MubG9nKFwiZHJhd0FpbUxpbmUgNTpcIiArICh0NiAtIHQ1KSk7XG4gICAgICAgICAgICB0aGlzLmhpbnRTcHJpdGUudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmhpbnRTcHJpdGUuc2V0UG9zaXRpb24oaGludFBvaW50KTtcbiAgICAgICAgICAgIC8vIGNjLmxvZyhcImRyYXdBaW1MaW5lIHRvdGFsOlwiICsgKHQ2IC0gdDEpKTtcbiAgICAgICAgICAgIHJldHVybiBkaXJlY3Rpb247XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvL3JldHVybiBjYy5wKDAsIDEpO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgbW92ZUJvYXJkOiBmdW5jdGlvbiAob2Zmc2V0KSB7XG4gICAgICAgIHZhciBYX09GRlNFVCA9IHRoaXMuSU5ORVJfV0FMTCArIHRoaXMuZ2V0QmFsbFdpZHRoKCkgKiAwLjUgKyAyO1xuICAgICAgICB2YXIgeCA9IHRoaXMuYm9hcmROb2RlLnggKyBvZmZzZXQgKiAxLjY7XG4gICAgICAgIGlmICh4IDwgWF9PRkZTRVQpIHtcbiAgICAgICAgICAgIHggPSBYX09GRlNFVDtcbiAgICAgICAgfSBlbHNlIGlmICh4ID4gY2Mud2luU2l6ZS53aWR0aCAtIFhfT0ZGU0VUKSB7XG4gICAgICAgICAgICB4ID0gY2Mud2luU2l6ZS53aWR0aCAtIFhfT0ZGU0VUO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYm9hcmROb2RlLnNldFBvc1goeCk7XG4gICAgfSxcblxuICAgIG9uVG91Y2hFbmRlZDpmdW5jdGlvbih0b3VjaCwgZXZlbnQpIHtcbiAgICAgICAgLy9jYy5sb2coXCJicmljayB2aWV3IG9uVG91Y2hFbmRlZDpcIiArIHRvdWNoLmdldElEKCkpO1xuICAgICAgICBpZiAodG91Y2guZ2V0SUQoKSAhPT0gdGhpcy5fY3VyVG91Y2hJZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChnYW1lLmdhbWVNYW4uY2FuVXNlQWltSXRlbSgpKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5nYW1lU3RlcCA9PT0gR2FtZVN0ZXAuUFJFX1NUQVJUKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50cnlTaG9vdEZpcnN0QmFsbCh0aGlzLmxhc3REaXJlY3Rpb24pO1xuICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJIaW50Tm9kZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKGdhbWUucGxheWVyTWFuLnBsYXllci5pc0FpbVZlcnNpb24pIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRyeVNob290Rmlyc3RCYWxsKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudHJ5U2hvb3RGaXJzdEJhbGwoY2MucCgwLCAxKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sYXN0U2VsZWN0R3JpZCA9IG51bGw7XG4gICAgICAgIHRoaXMubGFzdFRvdWNoUG9zID0gbnVsbDtcbiAgICAgICAgdGhpcy5fY3VyVG91Y2hJZCA9IC0xO1xuICAgICAgICB0aGlzLmxhc3REaXJlY3Rpb24gPSBudWxsO1xuICAgIH0sXG5cbiAgICBvblRvdWNoQ2FuY2VsbGVkOmZ1bmN0aW9uKHRvdWNoLCBldmVudCkge1xuICAgICAgICAvL2NjLmxvZyhcImJyaWNrIHZpZXcgb25Ub3VjaENhbmNlbGxlZDpcIiArIHRvdWNoLmdldElEKCkpO1xuICAgICAgICB0aGlzLm9uVG91Y2hFbmRlZCh0b3VjaCwgZXZlbnQpO1xuICAgIH0sXG5cbiAgICBjbGVhckhpbnROb2RlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5kb3RzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB0aGlzLmRvdHNbaV0udmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaGludFNwcml0ZS52aXNpYmxlID0gZmFsc2U7XG4gICAgfSxcblxuICAgIGNvbGxpc2lvbkJlZ2luIDogZnVuY3Rpb24gKCBhcmJpdGVyLCBzcGFjZSApIHtcbiAgICAgICAgLy9jYy5sb2coJ2NvbGxpc2lvbiBiZWdpbicpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgY29sbGlzaW9uUHJlIDogZnVuY3Rpb24gKCBhcmJpdGVyLCBzcGFjZSApIHtcbiAgICAgICAgLy9jYy5sb2coJ2NvbGxpc2lvbiBwcmUnKTtcbiAgICAgICAgdmFyIHNoYXBlcyA9IGFyYml0ZXIuZ2V0U2hhcGVzKCk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2hhcGVzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB2YXIgc2hhcGUgPSBzaGFwZXNbaV07XG4gICAgICAgICAgICAvL2NjLmxvZyhcImNvbGxpc2lvbiBwcmUgc2hhcGUgY29sbGlzaW9uIHR5cGU6XCIgKyBzaGFwZS5jb2xsaXNpb25fdHlwZSk7XG4gICAgICAgICAgICBpZiAoc2hhcGUuY29sbGlzaW9uX3R5cGUgPT0gU2hhcGVUeXBlLkJSSUNLKSB7XG4gICAgICAgICAgICAgICAgdmFyIGJvZHkgPSBzaGFwZS5nZXRCb2R5KCk7XG4gICAgICAgICAgICAgICAgaWYgKGJvZHkudXNlckRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGdyaWQgPSBib2R5LnVzZXJEYXRhO1xuICAgICAgICAgICAgICAgICAgICB2YXIgb3RoZXJTaGFwZSA9IHRoaXMuZ2V0QW5vdGhlclNoYXBlKHNoYXBlcywgaSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvdGhlclNoYXBlQm9keSA9IG90aGVyU2hhcGUuZ2V0Qm9keSgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAob3RoZXJTaGFwZUJvZHkudXNlckRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiYWxsID0gb3RoZXJTaGFwZUJvZHkudXNlckRhdGE7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmFsbC5icmVha2luZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgYmFsbC5icmVha2luZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBncmlkLnJlbW92ZWFibGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZC5iYWxsID0gYmFsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVCb29zdChncmlkLmdldFBvc2l0aW9uKCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChzaGFwZS5jb2xsaXNpb25fdHlwZSA9PSBTaGFwZVR5cGUuQkFMTCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmdhbWVTdGVwID09PSBHYW1lU3RlcC5TVEFSVCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYXlLbm9ja0F1ZGlvKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChzaGFwZS5jb2xsaXNpb25fdHlwZSA9PSBTaGFwZVR5cGUuS0VZKSB7XG4gICAgICAgICAgICAgICAgY2MubG9nKFwiYnJpY2sgdmlldzogY29sbGlzaW9uIHByZSBrZXlcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIGdldEFub3RoZXJTaGFwZTogZnVuY3Rpb24gKHNoYXBlcywgaW5kZXgpIHtcbiAgICAgICAgaWYgKGluZGV4ID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gc2hhcGVzWzFdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzaGFwZXNbMF07XG4gICAgfSxcblxuICAgIGNvbGxpc2lvblBvc3QgOiBmdW5jdGlvbiAoIGFyYml0ZXIsIHNwYWNlICkge1xuICAgICAgICAvL2NjLmxvZygnY29sbGlzaW9uIHBvc3QnKTtcbiAgICB9LFxuXG4gICAgY29sbGlzaW9uU2VwYXJhdGUgOiBmdW5jdGlvbiAoIGFyYml0ZXIsIHNwYWNlICkge1xuICAgICAgICAvL2NjLmxvZygnY29sbGlzaW9uIHNlcGFyYXRlJyk7XG4gICAgICAgIHZhciBzaGFwZXMgPSBhcmJpdGVyLmdldFNoYXBlcygpO1xuICAgICAgICB2YXIgYmFsbFNoYXBlID0gbnVsbDtcbiAgICAgICAgdmFyIGJvYXJkU2hhcGUgPSBudWxsO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNoYXBlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgLy9jYy5sb2coXCJjb2xsaXNpb24gc2VwYXJhdGUgc2hhcGUgY29sbGlzaW9uIHR5cGU6XCIgKyBzaGFwZXNbaV0uY29sbGlzaW9uX3R5cGUpO1xuICAgICAgICAgICAgdmFyIHNoYXBlID0gc2hhcGVzW2ldO1xuICAgICAgICAgICAgaWYgKHNoYXBlLmNvbGxpc2lvbl90eXBlID09IFNoYXBlVHlwZS5CQUxMKSB7XG4gICAgICAgICAgICAgICAgdmFyIGJvZHkgPSBzaGFwZS5nZXRCb2R5KCk7XG4gICAgICAgICAgICAgICAgaWYgKGJvZHkgJiYgYm9keS51c2VyRGF0YSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJhbmRvbUJhbGxTcGVlZChib2R5LnVzZXJEYXRhKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYmFsbFNoYXBlID0gc2hhcGU7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHNoYXBlLmNvbGxpc2lvbl90eXBlID09IFNoYXBlVHlwZS5CT0FSRCkge1xuICAgICAgICAgICAgICAgIGJvYXJkU2hhcGUgPSBzaGFwZTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2hhcGUuY29sbGlzaW9uX3R5cGUgPT0gU2hhcGVUeXBlLktFWSkge1xuICAgICAgICAgICAgICAgIGNjLmxvZyhcImJyaWNrIHZpZXc6IGNvbGxpc2lvbiBzZXBhcmF0ZSBrZXlcIik7XG4gICAgICAgICAgICAgICAgdmFyIGJvZHkgPSBzaGFwZS5nZXRCb2R5KCk7XG4gICAgICAgICAgICAgICAgaWYgKGJvZHkudXNlckRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9jYy5sb2coXCJib2R5LnVzZXJEYXRhOlwiICsgYm9keS51c2VyRGF0YS5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgYm9keS51c2VyRGF0YS5yZW1vdmVhYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGJhbGxTaGFwZSAmJiBib2FyZFNoYXBlKSB7XG4gICAgICAgICAgICAvL2NjLmxvZyhcImJvYXJkIGNvbGxpc2lvbiAxXCIpO1xuICAgICAgICAgICAgaWYgKGJhbGxTaGFwZS5ib2R5ICYmIGJhbGxTaGFwZS5ib2R5LnVzZXJEYXRhICYmIGJvYXJkU2hhcGUuYm9keSAmJiBib2FyZFNoYXBlLmJvZHkudXNlckRhdGEpIHtcbiAgICAgICAgICAgICAgICAvL2NjLmxvZyhcImJvYXJkIGNvbGxpc2lvbiAyXCIpO1xuICAgICAgICAgICAgICAgIHZhciBiYWxsID0gYmFsbFNoYXBlLmJvZHkudXNlckRhdGE7XG4gICAgICAgICAgICAgICAgdmFyIGJvYXJkID0gYm9hcmRTaGFwZS5ib2R5LnVzZXJEYXRhO1xuICAgICAgICAgICAgICAgIC8vY2MubG9nKFwiYm9hcmQgY29sbGlzaW9uIDIgYmFsbC5nZXRQb3NpdGlvbigpLnk6XCIgKyBiYWxsLmdldFBvc2l0aW9uKCkueSk7XG4gICAgICAgICAgICAgICAgLy9jYy5sb2coXCJib2FyZCBjb2xsaXNpb24gMiBib2FyZC55ICsgYm9hcmQuaGVpZ2h0ICogMC41OlwiICsgKGJvYXJkLnkgKyBib2FyZC5oZWlnaHQgKiAwLjUgLSAxMCkpO1xuICAgICAgICAgICAgICAgIGlmIChiYWxsLmdldFBvc2l0aW9uKCkueSA8IGJvYXJkLnkgKyBib2FyZC5oZWlnaHQgKiAwLjUgLSAxMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vY2MubG9nKFwiYm9hcmQgY29sbGlzaW9uIDNcIik7XG4gICAgICAgICAgICAgICAgdmFyIGJvYXJkU2hhcGVYMSA9IGJhbGwuZ2V0UG9zaXRpb24oKS54IC0gKGJvYXJkLnggLSBib2FyZC53aWR0aCAvIDIpO1xuICAgICAgICAgICAgICAgIHZhciB4ID0gYm9hcmRTaGFwZVgxIC8gYm9hcmRTaGFwZS5ib2R5LnVzZXJEYXRhLndpZHRoICogMTAwIC8gNTAgLSAxO1xuICAgICAgICAgICAgICAgIHggPSBNYXRoLm1heChNYXRoLm1pbigwLjksIHgpLCAtMC45KTtcbiAgICAgICAgICAgICAgICAvL2NjLmxvZyhcImJvYXJkIGNvbGxpc2lvbiA0OlwiICsgeCk7XG4gICAgICAgICAgICAgICAgdmFyIHkgPSBNYXRoLnNxcnQoMSAtIHggKiB4KTtcbiAgICAgICAgICAgICAgICBiYWxsLnNldFZlbChjYy5wKHRoaXMuTUFYX1NQRUVEICogeCwgdGhpcy5NQVhfU1BFRUQgKiB5KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcGxheUtub2NrQXVkaW86IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKERhdGUubm93KCkgLSB0aGlzLmxhc3RUaW1lID4gODApIHtcbiAgICAgICAgICAgIHRoaXMubGFzdFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgZ2FtZS5hdWRpb1BsYXllci5wbGF5RWZmZWN0QnlLZXkoXCJrbm9ja1wiKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRJbml0QmFsbFBvczogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gY2MucEFkZCh0aGlzLmJvYXJkTm9kZS5nZXRQb3NpdGlvbigpLCBjYy5wKDAsIDIwKSk7XG4gICAgfSxcblxuICAgIHNob290QmFsbDogZnVuY3Rpb24gKHBvc2l0aW9uLCB2ZWwpIHtcbiAgICAgICAgaWYgKHRoaXMuYmFsbExpc3QubGVuZ3RoID4gdGhpcy5NQVhfQkFMTCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBiYWxsID0gQmFsbFBvb2wuZ2V0RnJvbVBvb2woXCJiYWxsXCIpO1xuICAgICAgICBpZiAoIWJhbGwpIHtcbiAgICAgICAgICAgIGJhbGwgPSBuZXcgQmFsbCh0aGlzLmdldEJhbGxXaWR0aCgpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGJhbGwucmVzZXQodGhpcy5nZXRCYWxsV2lkdGgoKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hZGRDaGlsZChiYWxsKTtcbiAgICAgICAgdGhpcy5iYWxsTGlzdC5wdXNoKGJhbGwpO1xuICAgICAgICBiYWxsLmluaXRCb2R5KHRoaXMuc3BhY2UsIHBvc2l0aW9uKTtcbiAgICAgICAgYmFsbC5zZXRWZWwodmVsKTtcbiAgICB9LFxuXG4gICAgcmVtb3ZlQmFsbDogZnVuY3Rpb24gKGJhbGwpIHtcbiAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5iYWxsTGlzdC5pbmRleE9mKGJhbGwpO1xuICAgICAgICBpZiAoaW5kZXggPiAtMSkge1xuICAgICAgICAgICAgdGhpcy5iYWxsTGlzdC5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICB9XG4gICAgICAgIGJhbGwucmVtb3ZlQm9keSgpO1xuICAgICAgICBCYWxsUG9vbC5wdXRJblBvb2woXCJiYWxsXCIsIGJhbGwpO1xuICAgICAgICBiYWxsLnJlbW92ZUZyb21QYXJlbnQoKTtcbiAgICB9LFxuXG4gICAgcmVtb3ZlQnJpY2s6IGZ1bmN0aW9uIChicmljaykge1xuICAgICAgICB2YXIgaW5kZXggPSB0aGlzLmJyaWNrcy5pbmRleE9mKGJyaWNrKTtcbiAgICAgICAgaWYgKGluZGV4ID4gLTEpIHtcbiAgICAgICAgICAgIHRoaXMuYnJpY2tzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cbiAgICAgICAgYnJpY2sucmVtb3ZlQm9keSgpO1xuICAgICAgICAvL2lmIChicmljay5pc0dpZnQpIHtcbiAgICAgICAgLy8gICAgdGhpcy5zdG9wKCk7XG4gICAgICAgIC8vICAgIGdhbWUucG9wdXBNYW4ucG9wdXBSZXdhcmRHaWZ0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gICAgICAgIHRoaXMucmVzdW1lKCk7XG4gICAgICAgIC8vICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIC8vfSBlbHNlIHtcbiAgICAgICAgQmFsbFBvb2wucHV0SW5Qb29sKFwiYnJpY2tcIiwgYnJpY2spO1xuICAgICAgICAvL31cbiAgICAgICAgYnJpY2sucmVtb3ZlRnJvbVBhcmVudCgpO1xuICAgIH0sXG5cbiAgICBnZXRNaW5HZW5lcmF0ZUJvb3N0VHlwZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYm9vc3RDb3VudFNwbGl0ID0gdGhpcy5ib29zdFR5cGVNYXBbQm9vc3RUeXBlLlNQTElUXSB8fCAwO1xuICAgICAgICB2YXIgYm9vc3RDb3VudFRocmVlID0gdGhpcy5ib29zdFR5cGVNYXBbQm9vc3RUeXBlLlRIUkVFX0JBTExdIHx8IDA7XG4gICAgICAgIGlmIChib29zdENvdW50U3BsaXQgPiBib29zdENvdW50VGhyZWUgKiAyKSB7XG4gICAgICAgICAgICByZXR1cm4gQm9vc3RUeXBlLlRIUkVFX0JBTEw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIEJvb3N0VHlwZS5TUExJVDtcbiAgICB9LFxuXG4gICAgZ2V0RXN0aW1hdGVkQmFsbENvdW50OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBiYWxsQ291bnQgPSB0aGlzLmJhbGxMaXN0Lmxlbmd0aDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmJvb3N0cy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuYm9vc3RzW2ldLnkgPCB0aGlzLmJvYXJkTm9kZS55IC0gMzApIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmJvb3N0c1tpXS50eXBlID09PSBCb29zdFR5cGUuU1BMSVQpIHtcbiAgICAgICAgICAgICAgICBiYWxsQ291bnQgPSBiYWxsQ291bnQgKiA0O1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmJvb3N0c1tpXS50eXBlID09PSBCb29zdFR5cGUuVEhSRUVfQkFMTCkge1xuICAgICAgICAgICAgICAgIGJhbGxDb3VudCArPSAzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBiYWxsQ291bnQ7XG4gICAgfSxcblxuICAgIGdldEJvb3N0UG9zaWJpbGl0eTogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcG9zaWJpbGl0eSA9IHRoaXMuQk9PU1RfUE9TSUJJTElUWSAvIHRoaXMuYmFsbExpc3QubGVuZ3RoO1xuICAgICAgICBpZiAodGhpcy5iYWxsTGlzdC5sZW5ndGggPCA1MCkge1xuICAgICAgICAgICAgaWYgKHBvc2liaWxpdHkgPCAwLjAxNSkge1xuICAgICAgICAgICAgICAgIHBvc2liaWxpdHkgPSAwLjAxNTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmJhbGxMaXN0Lmxlbmd0aCA8IDIwMCkge1xuICAgICAgICAgICAgaWYgKHBvc2liaWxpdHkgPCAwLjAxKSB7XG4gICAgICAgICAgICAgICAgcG9zaWJpbGl0eSA9IDAuMDE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5iYWxsTGlzdC5sZW5ndGggPCA0MDApIHtcbiAgICAgICAgICAgIGlmIChwb3NpYmlsaXR5IDwgMC4wMDUpIHtcbiAgICAgICAgICAgICAgICBwb3NpYmlsaXR5ID0gMC4wMDU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHBvc2liaWxpdHk7XG4gICAgfSxcblxuICAgIGNoZWNrSGFzQm9vc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHBvc2liaWxpdHkgPSB0aGlzLmdldEJvb3N0UG9zaWJpbGl0eSgpO1xuICAgICAgICB2YXIgaGFzQm9vc3QgPSBnYW1lLnV0aWxzLnJhbmRvbU5leHROdW1iZXIoNTAwKSA8IDUwMCAqIHBvc2liaWxpdHk7XG4gICAgICAgIGlmICghaGFzQm9vc3QpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnRyeUdlbmVyYXRlQm9vc3RDb3VudCA+ICgxLjAgLyBwb3NpYmlsaXR5ICogKDEgKyB0aGlzLmJhbGxMaXN0Lmxlbmd0aCAqIDAuMikpKSB7XG4gICAgICAgICAgICAgICAgaGFzQm9vc3QgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBoYXNCb29zdDtcbiAgICB9LFxuXG4gICAgdHJ5R2VuZXJhdGVCb29zdENvdW50OiAwLFxuXG4gICAgZ2VuZXJhdGVCb29zdDogZnVuY3Rpb24gKHBvcykge1xuICAgICAgICB2YXIgYm9vc3RUeXBlO1xuICAgICAgICB0aGlzLnRyeUdlbmVyYXRlQm9vc3RDb3VudCsrO1xuICAgICAgICB2YXIgaGFzQm9tYiA9IGZhbHNlO1xuXG4gICAgICAgIGlmIChnYW1lLmdhbWVNYW4uaXNDaGFsbGVuZ2VMZXZlbCAmJiBnYW1lLmNoYWxsZW5nZU1hbi5jdXJyZW50Q2hhbGxlbmdlSWQgPT09IENoYWxsZW5nZUlkLkJvbWIpIHtcbiAgICAgICAgICAgIGhhc0JvbWIgPSBnYW1lLnV0aWxzLnJhbmRvbU5leHROdW1iZXIoMTAwKSA8ICgxMDAgKiB0aGlzLkJPTUJfUE9TSUJJTElUWSAvIHRoaXMuYmFsbExpc3QubGVuZ3RoKTtcbiAgICAgICAgICAgIGlmIChoYXNCb21iKSB7XG4gICAgICAgICAgICAgICAgYm9vc3RUeXBlID0gQm9vc3RUeXBlLkJPTUI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaGFzQm9tYikge1xuICAgICAgICAgICAgaWYgKHRoaXMuZ2V0RHJvcHBpbmdCb29zdENvdW50KGJvb3N0VHlwZSkgPj0gMykge1xuICAgICAgICAgICAgICAgIGhhc0JvbWIgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBoYXNCb29zdCA9IGZhbHNlO1xuICAgICAgICB2YXIgaGFzU3VwZXJCb2FyZCA9IGZhbHNlO1xuXG4gICAgICAgIGlmICghaGFzQm9tYikge1xuICAgICAgICAgICAgaGFzQm9vc3QgPSB0aGlzLmNoZWNrSGFzQm9vc3QoKTtcbiAgICAgICAgICAgIC8vIGlmICghZ2FtZS5nYW1lTWFuLmlzQ2hhbGxlbmdlTGV2ZWwpIHtcbiAgICAgICAgICAgIC8vICAgICBpZiAoR2FtZU1hbi5nZXRJbnN0YW5jZSgpLmxldmVsSWQgPD0gMykge1xuICAgICAgICAgICAgLy8gICAgICAgICBpZiAoY2MuaXNVbmRlZmluZWQodGhpcy5nZW5lcmF0ZUJvb3N0Q291bnQpKSB7XG4gICAgICAgICAgICAvLyAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlQm9vc3RDb3VudCA9IDA7XG4gICAgICAgICAgICAvLyAgICAgICAgIH1cbiAgICAgICAgICAgIC8vICAgICAgICAgaWYgKHRoaXMuZ2VuZXJhdGVCb29zdENvdW50IDwgMykge1xuICAgICAgICAgICAgLy8gICAgICAgICAgICAgaGFzQm9vc3QgPSB0cnVlO1xuICAgICAgICAgICAgLy8gICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZUJvb3N0Q291bnQrKztcbiAgICAgICAgICAgIC8vICAgICAgICAgfVxuICAgICAgICAgICAgLy8gICAgIH1cbiAgICAgICAgICAgIC8vIH1cblxuICAgICAgICAgICAgLy8gcHJvdGVjdCBnZW4gYm9vc3QuXG4gICAgICAgICAgICBpZiAoIWhhc0Jvb3N0ICYmIChEYXRlLm5vdygpIC0gdGhpcy5sYXN0R2V0Qm9vc3RUaW1lID4gdGhpcy5NVVNUX0dFTl9CT09TVF9USU1FICogMTAwMCkpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWdhbWUuZ2FtZU1hbi5pc0xlc3NHcmlkQ2hhbGxlbmdlKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaGFzQm9vc3QgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYy5sb2coXCJicmlja3MtdmlldyBtdXN0IGdlbiBib29zdCB0aW1lXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaGFzQm9vc3QpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxhc3RHZXRCb29zdFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgICAgIGJvb3N0VHlwZSA9IHRoaXMuZ2V0TWluR2VuZXJhdGVCb29zdFR5cGUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmJvb3N0VHlwZU1hcFtib29zdFR5cGVdID0gKHRoaXMuYm9vc3RUeXBlTWFwW2Jvb3N0VHlwZV0gfHwgMCkgKyAxO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmdldERyb3BwaW5nQm9vc3RDb3VudChib29zdFR5cGUpID49IDUpIHtcbiAgICAgICAgICAgICAgICAgICAgaGFzQm9vc3QgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghaGFzQm9vc3QpIHtcbiAgICAgICAgICAgICAgICBpZiAoZ2FtZS5nYW1lTWFuLmlzU3VwZXJCb2FyZFVubG9ja2VkKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaGFzU3VwZXJCb2FyZCA9IGdhbWUudXRpbHMucmFuZG9tTmV4dE51bWJlcigxMDAwKSA8ICgxMDAwICogdGhpcy5TVVBFUl9CT0FSRF9QT1NJQklMSVRZIC8gdGhpcy5iYWxsTGlzdC5sZW5ndGgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaGFzU3VwZXJCb2FyZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1cGVyQm9hcmRCb29zdENvdW50ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5ib29zdHMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ib29zdHNbaV0udHlwZSA9PT0gQm9vc3RUeXBlLlNVUEVSX0JPQVJEKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1cGVyQm9hcmRCb29zdENvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1cGVyQm9hcmRCb29zdENvdW50ID09PSAwICYmIHRoaXMuYmFsbExpc3QubGVuZ3RoIDwgMTAwICYmIHRoaXMuc3VwZXJCb2FyZE5vZGUuZ2V0Q2hpbGRyZW4oKS5sZW5ndGggPD0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb3N0VHlwZSA9IEJvb3N0VHlwZS5TVVBFUl9CT0FSRDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzU3VwZXJCb2FyZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGhhc0Jvb3N0KSB7XG4gICAgICAgICAgICB0aGlzLnRyeUdlbmVyYXRlQm9vc3RDb3VudCA9IDA7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaGFzQm9tYiB8fCBoYXNTdXBlckJvYXJkIHx8IGhhc0Jvb3N0KSB7XG4gICAgICAgICAgICB2YXIgYm9vc3QgPSBuZXcgQm9vc3QoYm9vc3RUeXBlKTtcbiAgICAgICAgICAgIGJvb3N0LnNldFBvc2l0aW9uKHBvcyk7XG4gICAgICAgICAgICB0aGlzLmFkZENoaWxkKGJvb3N0KTtcbiAgICAgICAgICAgIHRoaXMuYm9vc3RzLnB1c2goYm9vc3QpO1xuICAgICAgICAgICAgdGhpcy5ib29zdHMuc29ydChmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgICAgICAgIHJldHVybiAoYS55IC0gYi55KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldERyb3BwaW5nQm9vc3RDb3VudDogZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgICAgdmFyIGNvdW50ID0gMDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmJvb3N0cy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuYm9vc3RzW2ldLnR5cGUgPT09IHR5cGUpIHtcbiAgICAgICAgICAgICAgICBjb3VudCsrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb3VudDtcbiAgICB9LFxuXG4gICAgb25SZW1vdmVCb29zdDogZnVuY3Rpb24gKGJvb3N0KSB7XG4gICAgICAgIHZhciBpbmRleCA9IHRoaXMuYm9vc3RzLmluZGV4T2YoYm9vc3QpO1xuICAgICAgICBpZiAoaW5kZXggPiAtMSkge1xuICAgICAgICAgICAgdGhpcy5ib29zdHMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgIGJvb3N0LnJlbW92ZUZyb21QYXJlbnQoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByZW1vdmVBbGxCb29zdHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmJvb3N0cy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdmFyIGJvb3N0ID0gdGhpcy5ib29zdHNbaV07XG4gICAgICAgICAgICBpZiAoYm9vc3QpIHtcbiAgICAgICAgICAgICAgICBib29zdC5yZW1vdmVGcm9tUGFyZW50KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5ib29zdHMgPSBbXTtcbiAgICB9LFxuXG4gICAgc3RvcDogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnN0b3BlZCA9IHRydWU7XG4gICAgICAgIC8vdGhpcy5zaG93QmFubmVyQWRzKCk7XG4gICAgICAgIGlmIChnYW1lLmFkc01hbmFnZXIuc2hvd1RvcEJhbm5lcikge1xuICAgICAgICAgICAgZ2FtZS5hZHNNYW5hZ2VyLnJlbW92ZUJhbm5lckFkcyhcInRvcFwiKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByZXN1bWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5zdG9wZWQgPSBmYWxzZTtcbiAgICAgICAgLy9nYW1lLmFkc01hbmFnZXIucmVtb3ZlQmFubmVyQWRzKFwiYm90dG9tXCIpO1xuICAgICAgICBpZiAoZ2FtZS5hZHNNYW5hZ2VyLnNob3dUb3BCYW5uZXIpIHtcbiAgICAgICAgICAgIGdhbWUuYWRzTWFuYWdlci5zaG93QmFubmVyQWRzKFwidG9wXCIpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNob3dCYW5uZXJBZHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy9pZiAoZ2FtZS5wbGF5ZXJNYW4uZ2V0TGV2ZWwoKSA+PSAzKSB7XG4gICAgICAgIC8vICAgIGdhbWUuYWRzTWFuYWdlci5zaG93QmFubmVyQWRzKFwiYm90dG9tXCIpO1xuICAgICAgICAvL31cbiAgICB9LFxuXG4gICAgc2hvd1RvcEJhbm5lckFkczogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoZ2FtZS5nYW1lTWFuLmdldE1heExldmVsKCkgPj0gMykge1xuICAgICAgICAgICAgaWYgKGdhbWUuYWRzTWFuYWdlci5zaG93VG9wQmFubmVyKSB7XG4gICAgICAgICAgICAgICAgLy9pZiAxID4gMFxuICAgICAgICAgICAgICAgIGlmIChnYW1lLnBsYXllck1hbi5nZXRSZWdpc3RlckRheSgpID4gZ2FtZS5hZHNNYW5hZ2VyLnRvcEJhbm5lckRheSkge1xuICAgICAgICAgICAgICAgICAgICBnYW1lLmFkc01hbmFnZXIuc2hvd0Jhbm5lckFkcyhcInRvcFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcmVtb3ZlVG9wQmFubmVyQWRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vaWYgKGdhbWUuYWRzTWFuYWdlci5zaG93VG9wQmFubmVyKSB7XG4gICAgICAgIC8vICAgIGdhbWUuYWRzTWFuYWdlci5yZW1vdmVCYW5uZXJBZHMoXCJ0b3BcIik7XG4gICAgICAgIC8vfVxuICAgIH0sXG5cbiAgICBGTFlfR0lGVF9NSU5fWDogNTAsXG5cbiAgICBsYXN0Q2hlY2tUaW1lOiAtMzAwMCxcblxuICAgIGNoZWNrQW5kU2hvd0ZseUdpZnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAodGhpcy5zaG93ZWRGbHlHaWZ0KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuZWNsaXBzZWRUaW1lIDwgMTAgKiAxMDAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGdhbWUuZ2FtZU1hbi5mbHlHaWZ0QXBwZWFyQ291bnQgPiBnYW1lLmFkc01hbmFnZXIuZmx5R2lmdENvdW50KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGdhbWUuZ2FtZU1hbi5nZXRQbGF5ZXJMZXZlbCgpIDw9IGdhbWUuYWRzTWFuYWdlci5mbHlHaWZ0T3BlbkxldmVsKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5lY2xpcHNlZFRpbWUgLSB0aGlzLmxhc3RDaGVja1RpbWUgPCAyMDAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sYXN0Q2hlY2tUaW1lID0gdGhpcy5lY2xpcHNlZFRpbWU7XG5cbiAgICAgICAgaWYgKCFnYW1lLmFkc01hbmFnZXIuaXNSZXdhcmRWaWRlb1JlYWR5KCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBnYW1lLmdhbWVNYW4uZmx5R2lmdEFwcGVhckNvdW50Kys7XG4gICAgICAgIHRoaXMuc2hvd2VkRmx5R2lmdCA9IHRydWU7XG4gICAgICAgIHRoaXMuc3RhcnRGbHlHaWZ0VGltZSA9IHRoaXMuZWNsaXBzZWRUaW1lO1xuICAgICAgICB0aGlzLmdhbWVDb250cm9sbGVyLm5kRmx5R2lmdC52aXNpYmxlID0gdHJ1ZTtcblxuICAgICAgICB0aGlzLmdhbWVDb250cm9sbGVyLm5kRmx5R2lmdC54ID0gLTEwIC0gdGhpcy5GTFlfR0lGVF9NSU5fWDtcbiAgICAgICAgdGhpcy5nYW1lQ29udHJvbGxlci5uZEZseUdpZnQueSA9IGdhbWUudXRpbHMucmFuZG9tTmV4dEludEluUmFuZ2UoY2Mud2luU2l6ZS5oZWlnaHQgKiAwLjUsIGNjLndpblNpemUuaGVpZ2h0ICogMC44KTtcbiAgICAgICAgdGhpcy5vbkZseUdpZnRFbmQoKTtcbiAgICB9LFxuXG4gICAgb25GbHlHaWZ0RW5kOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLmVjbGlwc2VkVGltZSAtIHRoaXMuc3RhcnRGbHlHaWZ0VGltZSA+IDE1ICogMTAwMCkge1xuICAgICAgICAgICAgLy8gdGhpcy5mbHlHaWZ0RW5kZWQgPSB0cnVlO1xuICAgICAgICAgICAgLy8gdGhpcy5nYW1lQ29udHJvbGxlci5uZEZseUdpZnQuc3RvcEFsbEFjdGlvbnMoKTtcbiAgICAgICAgICAgIC8vIHRoaXMuZ2FtZUNvbnRyb2xsZXIubmRGbHlHaWZ0LnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgIHZhciBwb3MgPSB0aGlzLmdhbWVDb250cm9sbGVyLm5kRmx5R2lmdC5nZXRQb3NpdGlvbigpO1xuICAgICAgICAgICAgaWYgKHBvcy54IDwgY2Mud2luU2l6ZS53aWR0aCAqIDAuNSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ2FtZUNvbnRyb2xsZXIubmRGbHlHaWZ0LnJ1bkFjdGlvbihjYy5zZXF1ZW5jZShcbiAgICAgICAgICAgICAgICAgICAgY2MubW92ZVRvKDEsIGNjLnAoLXRoaXMuRkxZX0dJRlRfTUlOX1gsIHBvcy55KSksXG4gICAgICAgICAgICAgICAgICAgIGNjLmhpZGUoKVxuICAgICAgICAgICAgICAgICkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdhbWVDb250cm9sbGVyLm5kRmx5R2lmdC5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoXG4gICAgICAgICAgICAgICAgICAgIGNjLm1vdmVUbygxLCBjYy5wKGNjLndpblNpemUud2lkdGggKyB0aGlzLkZMWV9HSUZUX01JTl9YLCBwb3MueSkpLFxuICAgICAgICAgICAgICAgICAgICBjYy5oaWRlKClcbiAgICAgICAgICAgICAgICApKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciByYW5kb21ZO1xuICAgICAgICBpZiAodGhpcy5nYW1lQ29udHJvbGxlci5uZEZseUdpZnQueCA8IHRoaXMuRkxZX0dJRlRfTUlOX1gpIHtcbiAgICAgICAgICAgIHJhbmRvbVkgPSBnYW1lLnV0aWxzLnJhbmRvbU5leHRJbnRJblJhbmdlKGNjLndpblNpemUuaGVpZ2h0ICogMC41LCBjYy53aW5TaXplLmhlaWdodCAqIDAuOCk7XG4gICAgICAgICAgICB0aGlzLmdhbWVDb250cm9sbGVyLm5kRmx5R2lmdC5ydW5BY3Rpb24oXG4gICAgICAgICAgICAgICAgY2Muc2VxdWVuY2UoXG4gICAgICAgICAgICAgICAgICAgIGNjLm1vdmVUbyg1LCBjYy5wKGNjLndpblNpemUud2lkdGggLSB0aGlzLkZMWV9HSUZUX01JTl9YICsgMTAsIHJhbmRvbVkpKSxcbiAgICAgICAgICAgICAgICAgICAgY2MuY2FsbEZ1bmModGhpcy5vbkZseUdpZnRFbmQsIHRoaXMpXG4gICAgICAgICAgICAgICAgKSk7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5nYW1lQ29udHJvbGxlci5uZEZseUdpZnQueCA+IGNjLndpblNpemUud2lkdGggLSB0aGlzLkZMWV9HSUZUX01JTl9YKSB7XG4gICAgICAgICAgICByYW5kb21ZID0gZ2FtZS51dGlscy5yYW5kb21OZXh0SW50SW5SYW5nZShjYy53aW5TaXplLmhlaWdodCAqIDAuNSwgY2Mud2luU2l6ZS5oZWlnaHQgKiAwLjgpO1xuICAgICAgICAgICAgdGhpcy5nYW1lQ29udHJvbGxlci5uZEZseUdpZnQucnVuQWN0aW9uKGNjLnNlcXVlbmNlKFxuICAgICAgICAgICAgICAgIGNjLm1vdmVUbyg1LCBjYy5wKC0xMCArIHRoaXMuRkxZX0dJRlRfTUlOX1gsIHJhbmRvbVkpKSxcbiAgICAgICAgICAgICAgICBjYy5jYWxsRnVuYyh0aGlzLm9uRmx5R2lmdEVuZCwgdGhpcylcbiAgICAgICAgICAgICkpO1xuICAgICAgICB9XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gQnJpY2tzVmlldzsiLCJcblxudmFyIFJld2FyZFZpZXcgPSBjYy5Ob2RlLmV4dGVuZCh7XG5cbiAgICBjb25maWdzOiBudWxsLFxuXG4gICAgY3RvcjogZnVuY3Rpb24gKGNvbmZpZ3MsIG9mZnNldFgsIGdldE5vZGVGdW5jKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICAgIHRoaXMuY29uZmlncyA9IGNvbmZpZ3M7XG4gICAgICAgIC8vIHNjYWxlID0gc2NhbGUgfHwgMTtcblxuICAgICAgICB2YXIgY291bnQgPSB0aGlzLmNvbmZpZ3MubGVuZ3RoO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY29uZmlncy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdmFyIHBvcyA9IGNjLnAoLTAuNSAqIChjb3VudCAtIGkgKiAyIC0gMSkgKiBvZmZzZXRYLCAwKTtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlSXRlbSh0aGlzLmNvbmZpZ3NbaV0sIHBvcywgZ2V0Tm9kZUZ1bmMpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGNyZWF0ZUl0ZW06IGZ1bmN0aW9uIChjb25maWcsIHBvcywgZ2V0Tm9kZUZ1bmMpIHtcbiAgICAgICAgLy8gdmFyIG5vZGUgPSBSZXdhcmRJdGVtQ29udHJvbGxlci5jcmVhdGVGcm9tQ0NCKCk7XG4gICAgICAgIHZhciBub2RlID0gZ2V0Tm9kZUZ1bmMoKTtcbiAgICAgICAgdGhpcy5hZGRDaGlsZChub2RlKTtcbiAgICAgICAgbm9kZS5jb250cm9sbGVyLmluaXRSZXdhcmQoY29uZmlnKTtcbiAgICAgICAgbm9kZS5zZXRQb3NpdGlvbihwb3MpO1xuICAgICAgICAvLyBub2RlLnNjYWxlID0gc2NhbGU7XG4gICAgfVxuXG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBSZXdhcmRWaWV3OyJdfQ==
